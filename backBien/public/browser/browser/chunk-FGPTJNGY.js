import{A as De,B as ke,C as $e,D as N,E as j,F as $,G as We,g as ge,h as fe,i as xe,k as he,m as be,n as Ce,o as Se,p as Ee,q as ye,r as Ie,s as k,t as Te,u as Re,v as Me,w as Pe,x as Ve,y as Fe,z as Be}from"./chunk-XA7H2WLZ.js";import{e as Oe}from"./chunk-BA3JPKMX.js";import{V as ve,W as we}from"./chunk-MIQLH5Q4.js";import{$a as H,$b as w,$d as ue,Ab as E,Ac as X,Ad as ce,Bb as c,Bc as Z,Cc as ee,Dc as te,Gb as V,Hb as F,Ib as B,Lb as P,Ld as me,Mb as i,Md as se,Nb as S,Ob as p,Pd as pe,Qa as l,Rb as I,Sb as T,Sc as ne,Tb as R,Ua as W,Vb as q,Vc as ie,Wb as D,Yb as z,_b as m,_c as ae,a as A,ac as _,ae as _e,bc as G,cc as M,db as x,fc as K,jb as Q,kb as u,lb as L,na as g,oa as f,od as oe,rd as re,sb as t,tb as n,ub as v,uc as U,ud as le,vb as b,vc as Y,vd as de,wb as C,wc as J,yb as y}from"./chunk-6RHC2QAT.js";var Ne=["filtroInput"],je=["nombreNuevoRef"],Ae=()=>["detail"],He=()=>[10,20,50,100],ze=(o,r)=>({"text-success":o,"text-danger":r}),Qe=()=>[];function qe(o,r){if(o&1){let e=y();t(0,"button",42),E("click",function(){g(e);let d=c();return f(d.limpiarFiltro())}),v(1,"fa-icon",43),n()}if(o&2){let e=c();u("disabled",e.cargando),l(),u("icon",e.faTimes)}}function Ge(o,r){if(o&1){let e=y();b(0),t(1,"button",44),E("click",function(){g(e);let d=c();return f(d.empezarAgregar())}),v(2,"fa-icon",43),i(3," Agregar "),n(),C()}if(o&2){let e=c();l(),u("disabled",e.cargando),l(),u("icon",e.faPlus)}}function Ke(o,r){if(o&1){let e=y();t(0,"button",45),E("click",function(){g(e);let d=c();return f(d.cancelarAgregar())}),v(1,"fa-icon",43),n(),t(2,"button",46),E("click",function(){g(e);let d=c();return f(d.agregarCliente())}),t(3,"mat-icon"),i(4,"save"),n()()}if(o&2){let e=c();u("disabled",e.cargando),l(),u("icon",e.faTimes),l(),u("disabled",!e.validoNuevo()||e.cargando)}}function Ue(o,r){o&1&&(t(0,"th",47),i(1,"Nombre"),n())}function Ye(o,r){if(o&1&&(b(0),i(1),C()),o&2){let e=c().$implicit;l(),p(" ",e.nombre," ")}}function Je(o,r){if(o&1){let e=y();t(0,"input",49),R("ngModelChange",function(d){g(e);let s=c().$implicit;return T(s.nombre,d)||(s.nombre=d),f(d)}),n()}if(o&2){let e=c().$implicit;I("ngModel",e.nombre)}}function Xe(o,r){if(o&1&&(t(0,"td",48),x(1,Ye,2,1,"ng-container",26)(2,Je,1,1,"ng-template",null,3,M),n()),o&2){let e=r.$implicit,a=P(3),d=c();l(),u("ngIf",d.editandoId!==e._id)("ngIfElse",a)}}function Ze(o,r){o&1&&(t(0,"th",47),i(1,"Tel\xE9fono"),n())}function et(o,r){if(o&1&&(b(0),i(1),C()),o&2){let e=c().$implicit;l(),p(" ",e.telefono," ")}}function tt(o,r){if(o&1){let e=y();t(0,"input",49),R("ngModelChange",function(d){g(e);let s=c().$implicit;return T(s.telefono,d)||(s.telefono=d),f(d)}),n()}if(o&2){let e=c().$implicit;I("ngModel",e.telefono)}}function nt(o,r){if(o&1&&(t(0,"td",48),x(1,et,2,1,"ng-container",26)(2,tt,1,1,"ng-template",null,4,M),n()),o&2){let e=r.$implicit,a=P(3),d=c();l(),u("ngIf",d.editandoId!==e._id)("ngIfElse",a)}}function it(o,r){o&1&&(t(0,"th",47),i(1,"Email"),n())}function at(o,r){if(o&1&&(b(0),i(1),C()),o&2){let e=c().$implicit;l(),p(" ",e.email," ")}}function ot(o,r){if(o&1){let e=y();t(0,"input",49),R("ngModelChange",function(d){g(e);let s=c().$implicit;return T(s.email,d)||(s.email=d),f(d)}),n()}if(o&2){let e=c().$implicit;I("ngModel",e.email)}}function rt(o,r){if(o&1&&(t(0,"td",48),x(1,at,2,1,"ng-container",26)(2,ot,1,1,"ng-template",null,5,M),n()),o&2){let e=r.$implicit,a=P(3),d=c();l(),u("ngIf",d.editandoId!==e._id)("ngIfElse",a)}}function lt(o,r){o&1&&(t(0,"th",47),i(1,"Domicilio"),n())}function dt(o,r){if(o&1&&(b(0),i(1),C()),o&2){let e=c().$implicit;l(),p(" ",e.domicilio," ")}}function ct(o,r){if(o&1){let e=y();t(0,"input",49),R("ngModelChange",function(d){g(e);let s=c().$implicit;return T(s.domicilio,d)||(s.domicilio=d),f(d)}),n()}if(o&2){let e=c().$implicit;I("ngModel",e.domicilio)}}function mt(o,r){if(o&1&&(t(0,"td",48),x(1,dt,2,1,"ng-container",26)(2,ct,1,1,"ng-template",null,6,M),n()),o&2){let e=r.$implicit,a=P(3),d=c();l(),u("ngIf",d.editandoId!==e._id)("ngIfElse",a)}}function st(o,r){o&1&&(t(0,"th",47),i(1,"Monedero"),n())}function pt(o,r){if(o&1&&(t(0,"td",48),i(1),m(2,"number"),n()),o&2){let e=r.$implicit;l(),p(" $",_(2,1,e.totalMonedero,"1.2-2")," ")}}function ut(o,r){o&1&&(t(0,"th",47),i(1,"Acciones"),n())}function _t(o,r){if(o&1){let e=y();b(0),t(1,"button",50),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.toggleSubtabla(d,"ventas"))}),v(2,"fa-icon",43),n(),t(3,"button",51),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.toggleSubtabla(d,"pedidos"))}),v(4,"fa-icon",43),n(),t(5,"button",52),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.toggleSubtabla(d,"devoluciones"))}),v(6,"fa-icon",43),n(),t(7,"button",53),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.toggleSubtabla(d,"cancelaciones"))}),v(8,"i",54),n(),t(9,"button",55),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.toggleSubtabla(d,"monedero"))}),v(10,"i",56),n(),t(11,"button",57),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.iniciarEdicion(d))}),v(12,"i",58),n(),C()}o&2&&(l(2),u("icon","cash-register"),l(2),u("icon","shopping-cart"),l(2),u("icon","undo"))}function gt(o,r){if(o&1){let e=y();t(0,"button",59),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.guardarEdicion(d))}),v(1,"fa-icon",43),n(),t(2,"button",60),E("click",function(){g(e);let d=c().$implicit,s=c();return f(s.cancelarEdicion(d))}),v(3,"fa-icon",43),n()}if(o&2){let e=c(2);l(),u("icon",e.faSave),l(2),u("icon",e.faTimes)}}function ft(o,r){if(o&1&&(t(0,"td",48),x(1,_t,13,3,"ng-container",26)(2,gt,4,2,"ng-template",null,2,M),n()),o&2){let e=r.$implicit,a=P(3),d=c();l(),u("ngIf",d.editandoId!==e._id)("ngIfElse",a)}}function xt(o,r){if(o&1&&(t(0,"div",86),i(1),n()),o&2){let e=c().$implicit;l(),p(" CB: ",e.codigoBarras||(e.producto==null?null:e.producto.codigoBarras)," ")}}function ht(o,r){if(o&1&&(t(0,"tr")(1,"td"),i(2),x(3,xt,2,1,"div",85),n(),t(4,"td",67),i(5),m(6,"number"),n(),t(7,"td",67),i(8),m(9,"number"),n(),t(10,"td",67),i(11),m(12,"number"),n(),t(13,"td"),i(14),n(),t(15,"td",67),i(16),m(17,"number"),n(),t(18,"td",67),i(19),m(20,"number"),n(),t(21,"td",67),i(22),m(23,"number"),n(),t(24,"td",67),i(25),m(26,"number"),n(),t(27,"td",67),i(28),m(29,"number"),n(),t(30,"td",67),i(31),m(32,"number"),n(),t(33,"td",67),i(34),m(35,"number"),n()()),o&2){let e=r.$implicit;l(2),p(" ",e.nombre||(e.producto==null?null:e.producto.nombre)||""," "),l(),u("ngIf",e.codigoBarras||(e.producto==null?null:e.producto.codigoBarras)),l(2),S(w(6,13,e.cantidad)),l(3),p("$",_(9,15,e.precio,"1.2-2"),""),l(3),p("$",_(12,18,e.precio,"1.2-2"),""),l(3),S(e.tipoDescuento||"Cliente"),l(2),p(" ",e.descuento?_(17,21,100*(e.descuento/(e.precio||1)),"1.0-0")+"%":"\u2014"," "),l(3),p("$",_(20,24,e.monederoCliente||0,"1.2-2"),""),l(3),p("$",_(23,27,e.descuento||0,"1.2-2"),""),l(3),p("$",_(26,30,e.costo||0,"1.2-2")," "),l(3),p(" $",_(29,33,(e.totalRen||0)-(e.costo||0),"1.2-2")," "),l(3),p(" ",(e.costo||0)>0?_(32,36,((e.totalRen||0)-(e.costo||0))/(e.costo||1)*100,"1.0-2")+"%":"\u2014"," "),l(3),p("$",_(35,39,e.totalRen,"1.2-2"),"")}}function bt(o,r){if(o&1&&(t(0,"tr",76)(1,"td",77)(2,"div",78)(3,"table",79)(4,"thead")(5,"tr")(6,"th"),i(7,"Producto"),n(),t(8,"th",67),i(9,"Cant."),n(),t(10,"th",67),i(11,"P. U."),n(),t(12,"th",67),i(13,"Imp. normal"),n(),t(14,"th"),i(15,"Promo"),n(),t(16,"th",67),i(17,"% desc"),n(),t(18,"th",67),i(19,"Monedero"),n(),t(20,"th",67),i(21,"Desc."),n(),t(22,"th",67),i(23,"Costo"),n(),t(24,"th",67),i(25,"Utilidad"),n(),t(26,"th",67),i(27,"% Gan."),n(),t(28,"th",67),i(29,"Total"),n()()(),t(30,"tbody"),x(31,ht,36,42,"tr",80),n()(),t(32,"div",81)(33,"span",82),i(34,"Forma de pago:"),n(),t(35,"span",83),i(36,"Efectivo:"),n(),t(37,"span",84),i(38),m(39,"number"),n(),t(40,"span",83),i(41,"Tarjeta:"),n(),t(42,"span",84),i(43),m(44,"number"),n(),t(45,"span",83),i(46,"Transferencia:"),n(),t(47,"span",84),i(48),m(49,"number"),n(),t(50,"span",83),i(51,"Monedero:"),n(),t(52,"span",84),i(53),m(54,"number"),n()()()()()),o&2){let e=c().$implicit;l(31),u("ngForOf",e.productos||D(17,Qe)),l(7),p("$",_(39,5,(e.formaPago==null?null:e.formaPago.efectivo)||0,"1.2-2"),""),l(5),p("$",_(44,8,(e.formaPago==null?null:e.formaPago.tarjeta)||0,"1.2-2"),""),l(5),p("$",_(49,11,(e.formaPago==null?null:e.formaPago.transferencia)||0,"1.2-2"),""),l(5),p("$",_(54,14,(e.formaPago==null?null:e.formaPago.vale)||0,"1.2-2"),"")}}function Ct(o,r){if(o&1){let e=y();b(0),t(1,"tr")(2,"td",66)(3,"button",69),E("click",function(){let d=g(e).$implicit,s=c(4);return f(s.toggleDetalleVenta(d,s.expandedRow))}),t(4,"span"),i(5,"\u25B8"),n()()(),t(6,"td"),i(7),n(),t(8,"td"),i(9),n(),t(10,"td"),i(11),m(12,"date"),n(),t(13,"td"),i(14),n(),t(15,"td",67),i(16),m(17,"number"),n(),t(18,"td",70),i(19),m(20,"number"),n(),t(21,"td",71),i(22),m(23,"number"),n(),t(24,"td",72),i(25),m(26,"number"),n(),t(27,"td",73),i(28),m(29,"number"),n(),t(30,"td",67),i(31),m(32,"number"),n(),t(33,"td",74),i(34),m(35,"number"),n()(),x(36,bt,55,18,"tr",75),C()}if(o&2){let e=r.$implicit,a=c(4);l(4),L("open",a.subVentaOpen[a.expandedRow]===e._id),l(3),S(e.farmaciaNombre),l(2),S(e.usuarioNombre),l(2),S(_(12,15,e.fecha,"dd/MM/yyyy HH:mm")||""),l(3),S(e.folio),l(2),S(w(17,18,e.numProductos)),l(3),p("$",_(20,20,e.alMonedero,"1.2-2"),""),l(3),p("$",_(23,23,e.descuento,"1.2-2"),""),l(3),p("$",_(26,26,e.costo,"1.2-2"),""),l(2),u("ngClass",z(38,ze,(e.utilidad||0)>=0,(e.utilidad||0)<0)),l(),p(" $",_(29,29,e.utilidad,"1.2-2")," "),l(3),p(" ",e.gananciaPct==null?"\u2014":_(32,32,e.gananciaPct,"1.0-2")+"%"," "),l(3),p("$",_(35,35,e.total,"1.2-2"),""),l(2),u("ngIf",a.subVentaOpen[a.expandedRow]===e._id)}}function St(o,r){if(o&1&&(t(0,"tfoot")(1,"tr"),v(2,"th",66),t(3,"th",87),i(4,"Totales:"),n(),v(5,"th"),t(6,"th",67),i(7),m(8,"number"),n(),t(9,"th",70),i(10),m(11,"number"),n(),t(12,"th",71),i(13),m(14,"number"),n(),t(15,"th",72),i(16),m(17,"number"),n(),t(18,"th",73),i(19),m(20,"number"),n(),v(21,"th"),t(22,"th",74),i(23),m(24,"number"),n()()()),o&2){let e=c(4);l(7),S(w(8,7,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].numProductos)),l(3),p("$",_(11,9,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].alMonedero,"1.2-2"),""),l(3),p("$",_(14,12,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].descuento,"1.2-2"),""),l(3),p("$",_(17,15,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].costo,"1.2-2"),""),l(2),u("ngClass",z(24,ze,((e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].utilidad)||0)>=0,((e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].utilidad)||0)<0)),l(),p(" $",_(20,18,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].utilidad,"1.2-2")," "),l(4),p("$",_(24,21,e.subFooter[e.expandedRow]==null?null:e.subFooter[e.expandedRow].total,"1.2-2")," ")}}function Et(o,r){if(o&1&&(b(0),t(1,"div",63),i(2),n(),t(3,"div",64)(4,"table",65)(5,"thead")(6,"tr")(7,"th",66),i(8,"Det."),n(),t(9,"th"),i(10,"Farmacia"),n(),t(11,"th"),i(12,"Usuario"),n(),t(13,"th"),i(14,"Fecha"),n(),t(15,"th"),i(16,"Folio"),n(),t(17,"th",67),i(18,"# Prod."),n(),t(19,"th",67),i(20,"Al moned."),n(),t(21,"th",67),i(22,"Descuento"),n(),t(23,"th",67),i(24,"Costo"),n(),t(25,"th",67),i(26,"Utilidad"),n(),t(27,"th",67),i(28,"% Gan."),n(),t(29,"th",67),i(30,"Total"),n()()(),t(31,"tbody"),x(32,Ct,37,41,"ng-container",68),n(),x(33,St,25,27,"tfoot",61),n()(),C()),o&2){let e=c(2).$implicit,a=c();l(2),p("Compras de: ",e.nombre,""),l(30),u("ngForOf",a.subRows[a.expandedRow])("ngForTrackBy",a.trackVentaBy),l(),u("ngIf",a.subFooter[a.expandedRow])}}function vt(o,r){if(o&1&&(b(0),x(1,Et,34,4,"ng-container",26),C()),o&2){let e;c();let a=P(3),d=c();l(),u("ngIf",((e=d.subRows[d.expandedRow]==null?null:d.subRows[d.expandedRow].length)!==null&&e!==void 0?e:0)>0)("ngIfElse",a)}}function wt(o,r){o&1&&(t(0,"div",88),i(1," Sin compras en el rango seleccionado. "),n())}function yt(o,r){if(o&1&&(t(0,"tr",76)(1,"td",89)(2,"div",78)(3,"table",79)(4,"thead")(5,"tr")(6,"th",90),i(7),n(),t(8,"th",90),i(9),m(10,"currency"),n()()(),t(11,"tbody")(12,"tr")(13,"td",91),i(14),m(15,"currency"),n(),t(16,"td",91),i(17),m(18,"currency"),n()(),t(19,"tr")(20,"td"),i(21,"Efectivo:"),n(),t(22,"td"),i(23),m(24,"currency"),n(),t(25,"td"),i(26,"Efectivo:"),n(),t(27,"td"),i(28),m(29,"currency"),n()(),t(30,"tr")(31,"td"),i(32,"Tarjeta:"),n(),t(33,"td"),i(34),m(35,"currency"),n(),t(36,"td"),i(37,"Tarjeta:"),n(),t(38,"td"),i(39),m(40,"currency"),n()(),t(41,"tr")(42,"td"),i(43,"Transferencia:"),n(),t(44,"td"),i(45),m(46,"currency"),n(),t(47,"td"),i(48,"Transferencia:"),n(),t(49,"td"),i(50),m(51,"currency"),n()(),t(52,"tr")(53,"td"),i(54,"Monedero:"),n(),t(55,"td"),i(56),m(57,"currency"),n(),t(58,"td"),i(59,"Monedero"),n(),t(60,"td"),i(61),m(62,"currency"),n()(),t(63,"tr")(64,"td",92),i(65,"Levant\xF3:"),n(),t(66,"td",90),i(67),n(),t(68,"td",92),i(69),m(70,"date"),n()()()(),t(71,"div",81)(72,"span",82),i(73," Forma de pago: "),n(),t(74,"span",83),i(75,"Efectivo:"),n(),t(76,"span",84),i(77),m(78,"number"),n(),t(79,"span",83),i(80,"Tarjeta:"),n(),t(81,"span",84),i(82),m(83,"number"),n(),t(84,"span",83),i(85,"Transferencia:"),n(),t(86,"span",84),i(87),m(88,"number"),n(),t(89,"span",83),i(90,"Monedero:"),n(),t(91,"span",84),i(92),m(93,"number"),n()()()()()),o&2){let e=c().$implicit;l(7),p("Estado: ",e.estado,""),l(2),p("Precio: ",w(10,18,e.precio),""),l(5),p("Anticipo: ",w(15,20,e.aCuenta),""),l(3),p("Resta: ",w(18,22,e.resta),""),l(6),S(w(24,24,e.formasPago.anticipo.efectivo)),l(5),S(w(29,26,e.formasPago.resta.efectivo)),l(6),S(w(35,28,e.formasPago.anticipo.tarjeta)),l(5),S(w(40,30,e.formasPago.resta.tarjeta)),l(6),S(w(46,32,e.formasPago.anticipo.transferencia)),l(5),S(w(51,34,e.formasPago.resta.transferencia)),l(6),S(w(57,36,e.formasPago.anticipo.vale)),l(5),S(w(62,38,e.formasPago.resta.vale)),l(6),S(e.usuarioPidio),l(2),p("",G(70,40,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")," "),l(8),p("$",_(78,44,e.formasPago.anticipo.efectivo+e.formasPago.resta.efectivo||0,"1.2-2"),""),l(5),p("$",_(83,47,e.formasPago.anticipo.tarjeta+e.formasPago.resta.tarjeta||0,"1.2-2"),""),l(5),p("$",_(88,50,e.formasPago.anticipo.transferencia+e.formasPago.resta.transferencia||0,"1.2-2"),""),l(5),p("$",_(93,53,e.formasPago.anticipo.vale+e.formasPago.resta.vale||0,"1.2-2"),"")}}function It(o,r){if(o&1){let e=y();b(0),t(1,"tr")(2,"td",66)(3,"button",69),E("click",function(){let d=g(e).$implicit,s=c(4);return f(s.toggleDetallePedido(d,s.expandedRow))}),t(4,"span"),i(5,"\u25B8"),n()()(),t(6,"td"),i(7),n(),t(8,"td"),i(9),n(),t(10,"td"),i(11),m(12,"date"),n(),t(13,"td"),i(14),n(),t(15,"td"),i(16),n(),t(17,"td",67),i(18),m(19,"number"),n(),t(20,"td",67),i(21),m(22,"number"),n(),t(23,"td",70),i(24),m(25,"number"),n(),t(26,"td",72),i(27),m(28,"number"),n(),t(29,"td",72),i(30),m(31,"number"),n(),t(32,"td",72),i(33),m(34,"number"),n(),t(35,"td",72),i(36),m(37,"number"),n()(),x(38,yt,94,56,"tr",75),C()}if(o&2){let e=r.$implicit,a=c(4);l(4),L("open",a.subPedidoOpen[a.expandedRow]===e._id),l(3),S(e.farmacia),l(2),S(e.folio),l(2),S(_(12,15,e.fechaPedido,"dd/MM/yyyy HH:mm")||""),l(3),S(e.descripcion),l(2),S(e.estado),l(2),p("$",_(19,18,e.costo,"1.2-2"),""),l(3),p("$",_(22,21,e.precio,"1.2-2"),""),l(3),p("$",_(25,24,e.aCuenta,"1.2-2"),""),l(3),p("$",_(28,27,e.resta,"1.2-2"),""),l(3),p("$",_(31,30,e.precio-e.resta,"1.2-2")," "),l(3),p("$",_(34,33,e.precio-e.resta-e.costo,"1.2-2"),""),l(3),p(" ",e.costo>0?_(37,36,(e.precio-e.resta-e.costo)/e.costo*100,"1.0-2")+"%":"100%"," "),l(2),u("ngIf",a.subPedidoOpen[a.expandedRow]===e._id)}}function Tt(o,r){if(o&1&&(b(0),t(1,"div",63),i(2),n(),t(3,"div",64)(4,"table",65)(5,"thead")(6,"tr")(7,"th"),i(8,"Det."),n(),t(9,"th"),i(10,"Farmacia"),n(),t(11,"th"),i(12,"Folio"),n(),t(13,"th"),i(14,"F. pedido"),n(),t(15,"th"),i(16,"Descripci\xF3n"),n(),t(17,"th"),i(18,"Estado"),n(),t(19,"th"),i(20,"Costo"),n(),t(21,"th"),i(22,"Precio"),n(),t(23,"th"),i(24,"A cuenta"),n(),t(25,"th"),i(26,"Resta"),n(),t(27,"th"),i(28,"Tot. Ingreso"),n(),t(29,"th"),i(30,"Utilidad"),n(),t(31,"th"),i(32,"% Gan"),n()()(),t(33,"tbody"),x(34,It,39,39,"ng-container",68),n()()(),C()),o&2){let e=c(2).$implicit,a=c();l(2),p("Pedidos de: ",e.nombre,""),l(32),u("ngForOf",a.subRows[a.expandedRow])("ngForTrackBy",a.trackPedidoBy)}}function Rt(o,r){if(o&1&&(b(0),x(1,Tt,35,3,"ng-container",26),C()),o&2){let e;c();let a=P(8),d=c();l(),u("ngIf",((e=d.subRows[d.expandedRow]==null?null:d.subRows[d.expandedRow].length)!==null&&e!==void 0?e:0)>0)("ngIfElse",a)}}function Mt(o,r){o&1&&(t(0,"div",93),i(1," Sin compras en el rango seleccionado. "),n())}function Pt(o,r){o&1&&(t(0,"div",93),i(1," Sin pedidos en el rango seleccionado. "),n())}function Vt(o,r){o&1&&(b(0),t(1,"div",94),i(2,"Las devoluciones est\xE1n en construcci\xF3n"),n(),C())}function Ft(o,r){o&1&&(b(0),t(1,"div",94),i(2,"Las cancelaciones est\xE1n en construcci\xF3n"),n(),C())}function Bt(o,r){o&1&&(b(0),t(1,"div",94),i(2,"Las movimientos del monedero est\xE1n en construcci\xF3n"),n(),C())}function Dt(o,r){if(o&1&&(t(0,"td",48),x(1,vt,2,2,"ng-container",61)(2,wt,2,0,"ng-template",null,7,M)(4,Rt,2,2,"ng-container",61)(5,Mt,2,0,"ng-template",62,7,M)(7,Pt,2,0,"ng-template",62,8,M)(9,Vt,3,0,"ng-container",61)(10,Ft,3,0,"ng-container",61)(11,Bt,3,0,"ng-container",61),n()),o&2){let e=r.$implicit,a=c();Q("colspan",a.displayedColumns.length),l(),u("ngIf",a.expandedRow===e._id+"_ventas"),l(3),u("ngIf",a.expandedRow===e._id+"_pedidos"),l(5),u("ngIf",a.expandedRow===e._id+"_devoluciones"),l(),u("ngIf",a.expandedRow===e._id+"_cancelaciones"),l(),u("ngIf",a.expandedRow===e._id+"_monedero")}}function kt(o,r){o&1&&v(0,"tr",95)}function $t(o,r){o&1&&v(0,"tr",96)}function Ot(o,r){o&1&&v(0,"tr",96)}function Wt(o,r){o&1&&(t(0,"div",97),i(1,` Sin resultados
`),n())}function Lt(){let o=new j;return o.itemsPerPageLabel="Items por p\xE1gina:",o.nextPageLabel="Siguiente",o.previousPageLabel="Anterior",o.firstPageLabel="Primera p\xE1gina",o.lastPageLabel="\xDAltima p\xE1gina",o.getRangeLabel=(r,e,a)=>{if(a===0||e===0)return`0 de ${a}`;let d=r*e+1,s=Math.min(d+e-1,a);return`${d} \u2013 ${s} de ${a}`},o}var Le=class o{constructor(r,e){this.clienteSrv=r;this.cdr=e;this.subFetchers={ventas:(a,d)=>this.clienteSrv.ventas(a,d),pedidos:(a,d)=>this.clienteSrv.pedidos(a,d),devoluciones:(a,d)=>this.clienteSrv.devoluciones(a,d),cancelaciones:(a,d)=>this.clienteSrv.cancelaciones(a,d),monedero:(a,d)=>this.clienteSrv.monedero(a,d)}}faEdit=ce;faSave=pe;faTimes=_e;faEye=se;faPlus=ue;faWallet=me;clientes=[];filtro="";page=1;limit=20;totalDocs=0;editandoId=null;nuevoCliente={nombre:"",telefono:"",email:"",domicilio:""};expandedRow=null;subRows={};subFooter={};cargando=!1;agregando=!1;paginacion={total:0,page:1,limit:20};fechaIni="";fechaFin="";lastExpandedKey=null;displayedColumns=["nombre","telefono","email","domicilio","monedero","acciones"];dataSource=new N([]);paginator;filtroInput;nombreNuevoRef;table;flashId=null;errorMsg="";subVentaOpen={};subPedidoOpen={};trackVentaBy(r,e){return e._id}trackPedidoBy(r,e){return e._id}isDetailRow=(r,e)=>{if(!this.expandedRow)return!1;let a=this.expandedRow.split("_")[0];return e&&e._id===a};trackById=(r,e)=>e?._id??r;subFetchers;toLocalISODate(r){return new Date(r.getTime()-r.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let r=new Date,e=new Date(r.getFullYear(),r.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(r)}isSubEmpty(r){if(!r)return!1;let e=this.subRows[r];return Array.isArray(e)&&e.length===1&&e[0]?.__empty__===!0}getFechaFinExclusiveISO(){let r=new Date(this.fechaFin);return r.setDate(r.getDate()+1),this.toLocalISODate(r)}ngOnInit(){this.setFechasPorDefecto(),this.buscar()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onChangeFechas(){let r=this.expandedRow;if(!r)return;let[e]=r.split("_"),a=r.endsWith("_ventas")?"ventas":r.endsWith("_pedidos")?"pedidos":r.endsWith("_devoluciones")?"devoluciones":r.endsWith("_cancelaciones")?"cancelaciones":r.endsWith("_monedero")?"monedero":null;a&&(this.subRows[r]=[],delete this.subFooter[r],this.subVentaOpen[r]=null,this.subPedidoOpen[r]=null,this.fetchSubtabla(e,a,r))}buscar(){this.cargando=!0,this.clienteSrv.listar({q:this.filtro,page:this.page,limit:this.limit}).subscribe({next:r=>{let e=r?.rows??[],a=r?.paginacion?.total??0,d=r?.paginacion?.page??this.page,s=r?.paginacion?.limit??this.limit;this.clientes=e,this.dataSource.data=e,this.paginacion={total:a,page:d,limit:s},this.totalDocs=a,this.cargando=!1},error:r=>{this.clientes=[],this.dataSource.data=[],this.paginacion={total:0,page:1,limit:this.limit},this.totalDocs=0,this.cargando=!1}})}cambioPagina(r){let e=r.pageSize!==this.limit;this.limit=r.pageSize,this.page=e?1:r.pageIndex+1,this.expandedRow&&(delete this.subRows[this.expandedRow],delete this.subFooter[this.expandedRow],delete this.subVentaOpen[this.expandedRow],delete this.subPedidoOpen[this.expandedRow],this.expandedRow=null),this.buscar()}iniciarEdicion(r){this.editandoId=r._id,r._backup=A({},r)}EDITABLE_KEYS=["nombre","telefono","email","domicilio"];cancelarEdicion(r){this.EDITABLE_KEYS.forEach(e=>{Object.prototype.hasOwnProperty.call(r._backup,e)?r[e]=r._backup[e]:delete r[e]}),delete r._backup,this.editandoId=null,this.dataSource instanceof N?this.dataSource.data=[...this.dataSource.data]:this.table?.renderRows?.(),this.flashId=r._id,setTimeout(()=>this.flashId=null,1200)}guardarEdicion(r){this.clienteSrv.actualizar(r._id,{nombre:r.nombre,telefono:r.telefono,email:r.email,domicilio:r.domicilio}).subscribe(()=>{this.editandoId=null,delete r._backup})}empezarAgregar(){this.agregando=!0,this.nuevoCliente={nombre:"",telefono:"",email:"",domicilio:""},setTimeout(()=>this.nombreNuevoRef?.nativeElement?.focus(),0)}cancelarAgregar(){this.agregando=!1,this.nuevoCliente={nombre:"",telefono:"",email:"",domicilio:""}}solo10Digitos(){this.nuevoCliente.telefono=(this.nuevoCliente.telefono||"").replace(/\D/g,"").slice(0,10)}validoNuevo(){let r=(this.nuevoCliente.nombre||"").trim(),e=this.nuevoCliente.telefono||"";return!!r&&/^\d{10}$/.test(e)}agregarCliente(){this.validoNuevo()&&(this.cargando=!0,this.clienteSrv.crear({nombre:this.nuevoCliente.nombre.trim(),telefono:this.nuevoCliente.telefono}).subscribe({next:()=>{this.cargando=!1,this.cancelarAgregar(),this.page=1,this.buscar()},error:()=>{this.cargando=!1}}))}toggleSubtabla(r,e){let a=`${r._id}_${e}`;if(this.expandedRow===a){this.expandedRow=null,delete this.subRows[a],delete this.subFooter[a],delete this.subVentaOpen[a],delete this.subPedidoOpen[a],this.table?.renderRows(),this.cdr.detectChanges();return}this.expandedRow&&(delete this.subRows[this.expandedRow],delete this.subFooter[this.expandedRow],delete this.subVentaOpen[this.expandedRow],delete this.subPedidoOpen[this.expandedRow]),this.expandedRow=a,this.subVentaOpen[a]=null,this.subPedidoOpen[a]=null,this.table?.renderRows(),this.cdr.detectChanges(),this.fetchSubtabla(r._id,e,a)}fetchSubtabla(r,e,a){let d=this.subFetchers[e],s={page:1,limit:20};this.fechaIni&&(s.fechaIni=this.fechaIni),this.fechaFin&&(s.fechaFin=this.getFechaFinExclusiveISO()),d(r,s).subscribe({next:h=>{let O=h?.rows??[];O.length===0?(this.subRows[a]=[],delete this.subFooter[a],this.subVentaOpen[a]=null,this.subPedidoOpen[a]=null):(this.subRows[a]=O,this.subFooter[a]=h?.footer??null,console.log("sub tabla",O),console.log("footer"),h.footer),this.table?.renderRows(),this.cdr.detectChanges()},error:h=>{this.subRows[a]=[],delete this.subFooter[a],this.subVentaOpen[a]=null,this.subPedidoOpen[a]=null,this.table?.renderRows(),this.cdr.detectChanges()}})}toggleDetalleVenta(r,e){this.subVentaOpen[e]===r._id?this.subVentaOpen[e]=null:this.subVentaOpen[e]=r._id,this.cdr.detectChanges()}toggleDetallePedido(r,e){this.subPedidoOpen[e]===r._id?this.subPedidoOpen[e]=null:this.subPedidoOpen[e]=r._id,this.cdr.detectChanges()}limpiarFiltro(){this.filtro="",this.page=1,this.buscar(),setTimeout(()=>this.filtroInput?.nativeElement.focus(),0)}static \u0275fac=function(e){return new(e||o)(W(Ee),W(K))};static \u0275cmp=H({type:o,selectors:[["app-clientes"]],viewQuery:function(e,a){if(e&1&&(V($,5),V(Ne,5),V(je,5),V(k,5)),e&2){let d;F(d=B())&&(a.paginator=d.first),F(d=B())&&(a.filtroInput=d.first),F(d=B())&&(a.nombreNuevoRef=d.first),F(d=B())&&(a.table=d.first)}},features:[q([{provide:j,useFactory:Lt}])],decls:60,vars:26,consts:[["filtroInput",""],["nombreNuevoRef",""],["editBtns",""],["editNombre",""],["editTel",""],["editEmail",""],["editDom",""],["sinCompras",""],["sinPedidos",""],[1,"titulo",2,"text-align","center"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],["appearance","outline",1,"filtro-nombre"],["matInput","",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","aria-label","Limpiar filtro","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","style","width: 40px; height: 40px;",3,"disabled","click",4,"ngIf"],["align","end"],[1,"fechas-movs",2,"margin-top","-1rem"],[1,"lbl"],[1,"fechas-row"],["type","date",3,"ngModelChange","change","ngModel","max"],[1,"sep"],["type","date",3,"ngModelChange","change","ngModel","min"],[1,"add-row","d-flex","items-center","gap-3","justify-end"],["appearance","outline",1,"w-56"],["matInput","","matInput","",3,"ngModelChange","keydown.enter","ngModel","disabled"],["appearance","outline",1,"w-48"],["matInput","","inputmode","numeric","maxlength","10",3,"ngModelChange","input","keydown.enter","ngModel","disabled"],[4,"ngIf","ngIfElse"],["mat-table","","multiTemplateDataRows","",1,"tabla",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","telefono"],["matColumnDef","email"],["matColumnDef","domicilio"],["matColumnDef","monedero"],["matColumnDef","acciones"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["class","text-center text-muted py-3",4,"ngIf"],[1,"paginator-custom",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],["matSuffix","","aria-label","Limpiar filtro",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"width","40px","height","40px",3,"click","disabled"],[3,"icon"],[1,"btn-gris",2,"height","3rem",3,"click","disabled"],["matTooltip","Cancelar",1,"btn-icon-chico","btn-rojo-chico",2,"font-size","larger","height","3rem","width","3rem",3,"click","disabled"],["matTooltip","Guardar",1,"btn-icon-chico","btn-gris-chico",2,"font-size","larger","height","3rem","width","3rem",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["matInput","",3,"ngModelChange","ngModel"],["matTooltip","Compras",1,"btn-icon-chico","btn-gris-chico",3,"click"],["matTooltip","Pedidos",1,"btn-icon-chico","btn-verde-chico",3,"click"],["matTooltip","Devoluciones de compras",1,"btn-icon-chico","btn-amarillo-chico",3,"click"],["matTooltip","Cancelaciones de pedidos",1,"btn-icon-chico","btn-rojo-chico",3,"click"],[1,"fas","fa-times"],["matTooltip","Movimientos del monedero",1,"btn-icon-chico","btn-monedero",3,"click"],[1,"fas","fa-wallet"],["matTooltip","Editar datos cliente",1,"btn-icon-chico","btn-editar",3,"click"],[1,"fas","fa-edit"],["matTooltip","Grabar cambios",1,"btn-icon-chico","btn-verde-chico",3,"click"],["matTooltip","Cancelar edici\xF3n",1,"btn-icon-chico","btn-cancelar-edicion",3,"click"],[4,"ngIf"],[1,"subtabla-vacia"],[1,"sub-title-tabla"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"col-det"],[1,"text-end"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn-det",3,"click"],[1,"text-end","text-success"],[1,"text-end","text-muted"],[1,"text-end","text-negativo"],[1,"text-end",3,"ngClass"],[1,"text-end","fw-600"],["class","venta-detail",4,"ngIf"],[1,"venta-detail"],["colspan","12",1,"no-pad"],[1,"subdetalle"],[1,"subdetalle-tabla"],[4,"ngFor","ngForOf"],[1,"forma-pago"],[2,"margin-right","3rem","color","rgb(255, 199, 110)"],[2,"margin-right","1rem"],[1,"forma-pago-cantidad",2,"margin-right","3rem"],["class","cb",4,"ngIf"],[1,"cb"],["colspan","3",1,"text-end"],[1,"subtabla-vacia","text-center","text-muted","p-2"],["colspan","100",1,"no-pad"],["colspan","2"],["colspan","2",1,"sub-title-tabla"],["colspan","1"],[1,"subtabla-vacia","text-center"],[2,"color","red"],["mat-header-row",""],["mat-row",""],[1,"text-center","text-muted","py-3"]],template:function(e,a){if(e&1){let d=y();t(0,"h2",9),i(1,"Mantenimiento y consultas de Clientes"),n(),t(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),i(5,"Buscar por nombre"),n(),t(6,"input",12,0),R("ngModelChange",function(h){return g(d),T(a.filtro,h)||(a.filtro=h),f(h)}),E("keyup.enter",function(){return g(d),f(a.buscar())}),n(),x(8,qe,2,2,"button",13),t(9,"mat-hint",14),i(10,"Ingresa nombre y enter"),n()(),t(11,"div",15)(12,"label",16),i(13,"Fechas de los movimientos"),n(),t(14,"div",17)(15,"input",18),R("ngModelChange",function(h){return g(d),T(a.fechaIni,h)||(a.fechaIni=h),f(h)}),E("change",function(){return g(d),f(a.onChangeFechas())}),n(),t(16,"span",19),i(17,"\u2014"),n(),t(18,"input",20),R("ngModelChange",function(h){return g(d),T(a.fechaFin,h)||(a.fechaFin=h),f(h)}),E("change",function(){return g(d),f(a.onChangeFechas())}),n()()(),t(19,"div",21)(20,"mat-form-field",22)(21,"mat-label"),i(22,"Nombre"),n(),t(23,"input",23,1),R("ngModelChange",function(h){return g(d),T(a.nuevoCliente.nombre,h)||(a.nuevoCliente.nombre=h),f(h)}),E("keydown.enter",function(){return g(d),f(a.agregarCliente())}),n()(),t(25,"mat-form-field",24)(26,"mat-label"),i(27,"Tel\xE9fono"),n(),t(28,"input",25),R("ngModelChange",function(h){return g(d),T(a.nuevoCliente.telefono,h)||(a.nuevoCliente.telefono=h),f(h)}),E("input",function(){return g(d),f(a.solo10Digitos())})("keydown.enter",function(){return g(d),f(a.agregarCliente())}),n(),t(29,"mat-hint",14),i(30),n()(),x(31,Ge,4,2,"ng-container",26)(32,Ke,5,3,"ng-template",null,2,M),n()(),t(34,"table",27),b(35,28),x(36,Ue,2,0,"th",29)(37,Xe,4,2,"td",30),C(),b(38,31),x(39,Ze,2,0,"th",29)(40,nt,4,2,"td",30),C(),b(41,32),x(42,it,2,0,"th",29)(43,rt,4,2,"td",30),C(),b(44,33),x(45,lt,2,0,"th",29)(46,mt,4,2,"td",30),C(),b(47,34),x(48,st,2,0,"th",29)(49,pt,3,4,"td",30),C(),b(50,35),x(51,ut,2,0,"th",29)(52,ft,4,2,"td",30),C(),b(53,36),x(54,Dt,12,6,"td",30),C(),x(55,kt,1,0,"tr",37)(56,$t,1,0,"tr",38)(57,Ot,1,0,"tr",39),n(),x(58,Wt,2,0,"div",40),t(59,"mat-paginator",41),E("page",function(h){return g(d),f(a.cambioPagina(h))}),n()}if(e&2){let d=P(33);l(6),I("ngModel",a.filtro),l(2),u("ngIf",a.filtro),l(7),I("ngModel",a.fechaIni),u("max",a.fechaFin),l(3),I("ngModel",a.fechaFin),u("min",a.fechaIni),l(5),I("ngModel",a.nuevoCliente.nombre),u("disabled",!a.agregando||a.cargando),l(5),I("ngModel",a.nuevoCliente.telefono),u("disabled",!a.agregando||a.cargando),l(2),p("",(a.nuevoCliente.telefono||"").length,"/10"),l(),u("ngIf",!a.agregando)("ngIfElse",d),l(3),u("dataSource",a.dataSource),l(21),u("matHeaderRowDef",a.displayedColumns),l(),u("matRowDefColumns",a.displayedColumns),l(),u("matRowDefColumns",D(24,Ae))("matRowDefWhen",a.isDetailRow),l(),u("ngIf",!a.cargando&&(!a.dataSource||(a.dataSource.data==null?null:a.dataSource.data.length)===0)),l(),u("length",a.paginacion.total||0)("pageSize",a.limit)("pageIndex",a.page-1)("pageSizeOptions",D(25,He))("showFirstLastButtons",!0)}},dependencies:[te,U,Y,J,Z,ee,X,re,ne,ie,oe,ae,$e,k,Re,Fe,Me,Te,Be,Pe,Ve,De,ke,We,$,be,he,ge,fe,xe,Se,Ce,Oe,Ie,ye,de,le,we,ve],styles:[`.tabla{width:100%}.subtabla-vacia{color:red!important}.sub-row{background:#f9f9f9}.mat-form-field{min-width:160px}.btn-monedero{font-size:small;font-weight:400;padding:3px;border-radius:6px;background:linear-gradient(45deg,#fc7813,#fcd30a);color:#00f}.btn-monedero:hover{background:linear-gradient(45deg,#a7f944,#fc7813);box-shadow:0 4px 8px #ffcc0080;color:#fff}.btn-monedero:disabled{cursor:not-allowed;opacity:.6}.btn-monedero[disabled]:hover{background:linear-gradient(45deg,#a7f944,#fc7813);box-shadow:none;color:#000}.btn-editar{font-size:small;font-weight:400;padding:3px;border-radius:6px;background:linear-gradient(45deg,#fcd30a,#13fc1f);color:#333131}.btn-editar:hover{background:linear-gradient(45deg,#13fc1f,#fcd30a);box-shadow:0 4px 8px #ffcc0080;color:red}.btn-editar:disabled{cursor:not-allowed;opacity:.6}.btn-editar[disabled]:hover{background:linear-gradient(45deg,#a7f944,#fc7813);box-shadow:none;color:#000}.btn-cancelar-edicion{font-size:small;font-weight:400;padding:3px;border-radius:6px;background:linear-gradient(45deg,orange,red);color:#00f}.btn-cancelar-edicion:hover{background:linear-gradient(45deg,red,orange);box-shadow:0 4px 8px #a8870180;color:#fff}.btn-cancelar-edicion:disabled{cursor:not-allowed;opacity:.6}.btn-cancelar-edicion[disabled]:hover{background:gray;box-shadow:none;color:#000}.paginator-custom .mat-mdc-paginator{background:#f5fbff;box-shadow:0 2px 6px #0000000f}.restore-flash td{animation:flashRestore 1.2s ease-out}.forma-pago{padding:4px;background:#2e04fe!important;text-align:center;font-size:large;color:#fff}.forma-pago-cantidad{color:#e1fcc0}@keyframes flashRestore{0%{background:#fff7cc}30%{background:#ffef99}to{background:transparent}}.paginator-custom .mat-mdc-paginator-container,.paginator-custom .mat-mdc-paginator-page-size,.paginator-custom .mat-mdc-paginator-range-actions{display:flex;align-items:center;gap:4px}.paginator-custom .mat-mdc-paginator-page-size-label,.paginator-custom .mat-mdc-paginator-range-label{font-size:1.3rem;color:#8a2be2;line-height:1}.paginator-custom .mat-mdc-icon-button{width:3.25rem;height:3.25rem;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .15s ease,transform .05s}.paginator-custom .mat-mdc-icon-button:hover{background:#8a2be2}.paginator-custom .mat-mdc-icon-button:active{transform:translateY(1px)}.paginator-custom .mat-mdc-paginator-icon{fill:#0ff;width:3.25rem;height:3.25rem}.paginator-custom .mat-mdc-paginator-range-actions .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:#cbd5e1}.paginator-custom{background-color:#fbdddd}.paginator-custom .mat-mdc-paginator-page-size .mat-mdc-select-trigger,.paginator-custom .mat-mdc-paginator-page-size .mat-mdc-select-value-text{font-size:1.3rem;color:#8a2be2;line-height:1.1}
`],encapsulation:2})};export{Le as ClientesComponent,Lt as paginatorEs};
