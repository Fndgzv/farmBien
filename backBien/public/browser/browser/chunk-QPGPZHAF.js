import{D as ee,E as ie,a as K}from"./chunk-TLW2RIS7.js";import{$c as J,Ab as c,Ad as Z,Bb as U,Bc as P,Cc as u,Ec as T,Fc as V,Gc as z,Ja as n,Jc as D,Mc as G,Na as f,Pc as $,Qc as B,Rc as R,Sc as L,Ua as F,Xa as v,Z as _,Zc as q,_c as H,a as S,ad as oe,b as x,bb as N,bd as Q,ca as y,cb as d,cd as W,d as re,dd as X,ec as k,fc as M,gb as t,hb as i,ia as C,ib as s,ja as I,lb as w,mc as j,nb as g,ob as E,pd as Y,tc as A,yc as O,zb as r}from"./chunk-3TU753TR.js";var p=re(oe());var h=class l{constructor(e){this.http=e}apiUrl=`${O.apiUrl}/usuarios`;obtenerUsuarios(){return this.http.get(this.apiUrl)}crearUsuario(e){return this.http.post(`${this.apiUrl}/register`,e)}actualizarUsuario(e,a){return this.http.put(`${this.apiUrl}/${e}`,a)}static \u0275fac=function(a){return new(a||l)(y(A))};static \u0275prov=_({token:l,factory:l.\u0275fac,providedIn:"root"})};function le(l,e){if(l&1){let a=w();t(0,"tr")(1,"td"),r(2),i(),t(3,"td"),r(4),i(),t(5,"td"),r(6),i(),t(7,"td"),r(8),i(),t(9,"td"),r(10),i(),t(11,"td"),r(12),i(),t(13,"td")(14,"button",31),g("click",function(){let m=C(a).$implicit,b=E();return I(b.editar(m))}),s(15,"fa-icon",3),i()()()}if(l&2){let a=e.$implicit,o=E();n(2),c(a.nombre),n(2),c(a.usuario),n(2),c(a.rol),n(2),c(a.telefono),n(2),c(a.email||"-"),n(2),c(o.obtenerNombreFarmacia(a.farmacia)),n(3),d("icon","pen")}}function me(l,e){if(l&1&&(t(0,"option",34),r(1),i()),l&2){let a=e.$implicit;d("value",a._id),n(),c(a.nombre)}}function se(l,e){if(l&1&&(t(0,"div",15)(1,"label"),r(2,"Farmacia asignada:"),i(),t(3,"select",32)(4,"option",23),r(5,"-- Selecciona una farmacia --"),i(),v(6,me,2,2,"option",33),i()()),l&2){let a=E();n(6),d("ngForOf",a.farmacias)}}function de(l,e){l&1&&(t(0,"div",15)(1,"label"),r(2,"C\xE9dula profesional:"),i(),s(3,"input",35),i())}var te=class l{constructor(e,a,o,m){this.fb=e;this.usuarioService=a;this.farmaciaService=o;this.library=m;m.addIcons(Y,Z)}usuarios=[];farmacias=[];formUsuario=new z({});guardando=!1;modoEdicion=!1;usuarioEditandoId=null;ngOnInit(){this.inicializarFormulario(),this.cargarUsuarios(),this.cargarFarmacias()}inicializarFormulario(){this.formUsuario=this.fb.group({nombre:["",u.required],usuario:["",u.required],telefono:["",[u.pattern(/^\d{10}$/)]],email:[""],password:["",[u.minLength(6)]],domicilio:[""],rol:["",u.required],farmacia:[""],cedulaProfesional:[""]})}obtenerNombreFarmacia(e){return typeof e=="object"&&e?.nombre?e.nombre:"-"}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe({next:e=>this.usuarios=e,error:()=>p.default.fire("Error","No se pudieron cargar los usuarios","error")})}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:e=>this.farmacias=e,error:()=>p.default.fire("Error","No se pudieron cargar las farmacias","error")})}abrirModalAgregar(){this.modoEdicion=!1,this.usuarioEditandoId=null,this.formUsuario.reset(),this.mostrarModal()}editar(e){this.modoEdicion=!0,this.usuarioEditandoId=e._id||null;let a=x(S({},e),{farmacia:typeof e.farmacia=="object"&&e.farmacia!==null?e.farmacia._id:"",cedulaProfesional:e.rol==="medico"&&e.cedulaProfesional||""});this.formUsuario.patchValue(a);let o=document.getElementById("modalUsuario");o&&new bootstrap.Modal(o,{backdrop:"static",keyboard:!1}).show()}mostrarModal(){let e=document.getElementById("modalUsuario");e&&new bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show()}guardar(){if(this.formUsuario.invalid||this.guardando)return;this.guardando=!0;let e=this.limpiarDatosUsuarioPorRol(this.formUsuario.value),a=()=>{let o=document.getElementById("modalUsuario");o&&bootstrap.Modal.getInstance(o)?.hide(),this.cargarUsuarios(),this.guardando=!1,this.usuarioEditandoId=null,this.modoEdicion=!1,this.formUsuario.reset()};if(!this.modoEdicion){let o=this.formUsuario.get("password");if(o?.setValidators([u.required,u.minLength(6)]),o?.updateValueAndValidity(),o?.invalid){this.formUsuario.markAllAsTouched(),this.guardando=!1;return}}this.modoEdicion&&this.usuarioEditandoId?this.usuarioService.actualizarUsuario(this.usuarioEditandoId,e).subscribe({next:()=>p.default.fire("Actualizado","Usuario actualizado","success").then(a),error:()=>{p.default.fire("Error","No se pudo actualizar","error"),this.guardando=!1}}):this.usuarioService.crearUsuario(e).subscribe({next:()=>p.default.fire("Registrado","Usuario creado","success").then(a),error:o=>{let m=o?.error?.mensaje||"No se pudo crear";p.default.fire("Error",m,"error"),this.guardando=!1}})}limpiarDatosUsuarioPorRol(e){switch(e.rol){case"admin":e.farmacia=null,e.cedulaProfesional=void 0;break;case"empleado":e.farmacia||(e.farmacia=null),e.cedulaProfesional=void 0;break;case"medico":e.farmacia||(e.farmacia=null),e.cedulaProfesional||(e.cedulaProfesional=void 0);break}return e.email||(e.email=void 0),e.domicilio||(e.domicilio=void 0),e.telefono||(e.telefono=void 0),e}static \u0275fac=function(a){return new(a||l)(f(q),f(h),f(K),f(Q))};static \u0275cmp=F({type:l,selectors:[["app-usuarios"]],decls:78,vars:9,consts:[[1,"container","mt-4"],[1,"titulo"],[1,"btn-verde","mb-3",3,"click"],[3,"icon"],[1,"tabla"],[4,"ngFor","ngForOf"],["id","modalUsuario","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content","p-3",2,"background-color","azure"],[1,"modal-header"],[1,"modal-title","titulo"],["type","button","data-bs-dismiss","modal","aria-label","Cerrar",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"row"],[1,"col-md-6","mb-2"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","usuario",1,"form-control"],["type","text","formControlName","telefono",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","password","formControlName","password",1,"form-control"],["type","text","formControlName","domicilio",1,"form-control"],["formControlName","rol",1,"form-control"],["value",""],["value","admin"],["value","empleado"],["value","medico"],["class","col-md-6 mb-2",4,"ngIf"],[1,"modal-footer","d-flex","justify-content-between"],["data-bs-dismiss","modal",1,"btn-rojo"],[1,"btn-gris",3,"click","disabled"],["matTooltip","Editar",1,"btn-icon-chico","btn-gris-chico",3,"click"],["formControlName","farmacia",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","text","formControlName","cedulaProfesional",1,"form-control"]],template:function(a,o){if(a&1&&(t(0,"div",0)(1,"h2",1),r(2,"Mantenimiento de Usuarios"),i(),t(3,"button",2),g("click",function(){return o.abrirModalAgregar()}),s(4,"fa-icon",3),r(5," Agregar Usuario "),i(),t(6,"table",4)(7,"thead")(8,"tr")(9,"th"),r(10,"Nombre"),i(),t(11,"th"),r(12,"Usuario"),i(),t(13,"th"),r(14,"Rol"),i(),t(15,"th"),r(16,"Tel\xE9fono"),i(),t(17,"th"),r(18,"Email"),i(),t(19,"th"),r(20,"Farmacia"),i(),t(21,"th"),r(22,"Acciones"),i()()(),t(23,"tbody"),v(24,le,16,7,"tr",5),i()()(),t(25,"div",6)(26,"div",7)(27,"div",8)(28,"div",9)(29,"h5",10),r(30),i(),s(31,"button",11),i(),t(32,"div",12)(33,"form",13)(34,"div",14)(35,"div",15)(36,"label"),r(37,"Nombre:"),i(),s(38,"input",16),i(),t(39,"div",15)(40,"label"),r(41,"Usuario:"),i(),s(42,"input",17),i(),t(43,"div",15)(44,"label"),r(45,"Tel\xE9fono:"),i(),s(46,"input",18),i(),t(47,"div",15)(48,"label"),r(49,"Email:"),i(),s(50,"input",19),i(),t(51,"div",15)(52,"label"),r(53,"Contrase\xF1a:"),i(),s(54,"input",20),i(),t(55,"div",15)(56,"label"),r(57,"Domicilio:"),i(),s(58,"input",21),i(),t(59,"div",15)(60,"label"),r(61,"Rol:"),i(),t(62,"select",22)(63,"option",23),r(64,"-- Selecciona un rol --"),i(),t(65,"option",24),r(66,"Admin"),i(),t(67,"option",25),r(68,"Empleado"),i(),t(69,"option",26),r(70,"M\xE9dico"),i()()(),v(71,se,7,1,"div",27)(72,de,4,0,"div",27),i()()(),t(73,"div",28)(74,"button",29),r(75,"Cancelar"),i(),t(76,"button",30),g("click",function(){return o.guardar()}),r(77),i()()()()()),a&2){let m,b;n(4),d("icon","plus"),n(20),d("ngForOf",o.usuarios),n(6),U(" ",o.modoEdicion?"Editar Usuario":"Agregar Usuario"," "),n(3),d("formGroup",o.formUsuario),n(21),N("placeholder",o.modoEdicion?"Dejar vac\xEDo para no cambiar":""),n(17),d("ngIf",o.formUsuario&&(((m=o.formUsuario.get("rol"))==null?null:m.value)==="empleado"||((m=o.formUsuario.get("rol"))==null?null:m.value)==="medico")),n(),d("ngIf",o.formUsuario&&((b=o.formUsuario.get("rol"))==null?null:b.value)==="medico"),n(4),d("disabled",o.formUsuario.invalid||o.guardando),n(),U(" ",o.guardando?"Guardando...":o.modoEdicion?"Actualizar":"Guardar"," ")}},dependencies:[j,k,M,J,D,R,L,P,B,T,V,G,$,H,X,W,ie,ee],encapsulation:2})};export{te as UsuariosComponent};
