import{a as jf,b as Wf}from"./chunk-BL6NNVQW.js";import{a as Va}from"./chunk-L62JPHCT.js";import{A as Yf,B as Qf,C as Jf,D as Zf,E as ep,F as tp,G as ip,H as E0,I as ap,J as op,a as Mf,b as Ff,c as Af,d as Ra,e as Of,f as Df,g as Vf,j as Uf,k as il,l as w0,m as Ba,n as nl,o as La,p as Sn,q as Mr,r as Qn,s as al,t as Hf,u as $f,v as zf,w as Gf,x as qf,y as Xf,z as Kf}from"./chunk-T2JU5RTM.js";import{a as rl}from"./chunk-Q6X2RQS5.js";import{a as Hs,c as $s,d as Yi,e as Vm,f as Um,g as jm,h as Ma}from"./chunk-2ZR7JFHQ.js";import{a as Xt}from"./chunk-MU2BUS7P.js";import{d as np,e as rp}from"./chunk-LT7ECYES.js";import{a as ki}from"./chunk-JKGFMHHD.js";import{A as sf,B as lf,D as cf,E as df,G as uf,H as Da,I as mf,J as ff,K as pf,L as hf,M as gf,N as Cn,O as vi,P as _f,Q as vf,R as xf,S as bf,U as yf,a as yi,b as ei,c as ti,d as zm,e as Gm,f as qm,h as Xm,i as Km,k as Ym,l as Oa,m as Qm,n as Jm,o as Zm,r as ef,s as tf,t as b0,u as nf,w as rf,x as af,y as Ks,z as of}from"./chunk-NLTCMIC6.js";import{a as Rm,b as Nm}from"./chunk-OIT4XKAV.js";import{$ as je,$a as Ro,$b as J,$c as Qe,A as Pi,Ad as at,Ae as Lf,Bb as l,Bd as Yn,Be as S0,C as cn,Ca as Do,Cb as s,Cd as Bi,Ce as dt,Db as y,Dd as Fa,De as Vt,E as Ds,Eb as Ze,Ed as $m,F as wm,Fa as Im,Fb as et,Fd as Aa,G as dn,Gd as Xs,H as Em,Ha as Ns,Hb as ae,Hd as Zt,Ic as si,Id as ot,Jb as w,Jc as We,Jd as Lt,Kb as _,Kc as Ne,Kd as Cf,Lb as Fm,Lc as Us,Ld as Sf,Mb as Am,Mc as js,Md as Ys,Nb as v0,Nd as wf,Ob as Qr,Oc as Ia,Od as Zr,P as Yr,Pb as x0,Pd as kr,Q as Ui,Qb as Tt,Qc as Ws,Qd as Ef,R as Rs,Rb as bt,S as Rn,Sb as yt,Sc as Nt,Sd as Tf,T as mt,Tc as wt,Td as Ir,U as Tm,Ua as mr,Uc as Bt,V as tt,Vb as Gt,Vc as Oe,Vd as Pf,W as Ao,Wa as Mm,Wb as d,Xa as Ta,Xb as T,Xd as y0,Y as wr,Ya as c,Yb as R,Zb as un,_ as lt,_a as _0,_b as yn,a as qn,ab as Pa,ac as Z,ad as Ht,bb as ie,bc as ee,bd as ct,be as kf,c as Xn,cd as Bm,ce as Qs,db as Bs,dc as Jr,dd as Lm,de as If,ea as Pm,ec as Jt,ed as He,ee as C0,f as St,fc as _i,fd as Wm,fe as Js,g as Kn,ga as Er,gc as ji,gd as li,ha as P,hb as Te,hc as Wi,hd as qe,i as xm,ia as k,ib as No,id as Pe,ie as Zs,ja as km,jb as Ls,k as As,kc as F,kd as ze,l as gt,lb as N,lc as se,ld as Ft,m as bm,mc as Q,me as el,na as Ea,nc as Ni,nd as Tr,ne as tl,oc as Om,od as zs,p as gi,pc as ka,pd as _t,pe as Rf,q as xt,qd as At,qe as Nf,ra as zt,rb as Ye,rc as Dt,rd as qt,s as Os,sa as bn,sb as p,sd as Pr,tb as Ri,td as Gs,ub as Be,uc as fr,ud as ci,ue as Bf,v as ym,va as Oo,vb as Vs,vc as Dm,vd as qs,w as Cm,wd as Hm,x as Sm,xa as g0,xd as di,xe as Na,y as Xr,yd as nt,z as Kr,zc as Bo,zd as rt}from"./chunk-WMSMSS64.js";import{a as Ke,b as Wt,c as vm,d as Le,e as hi,f as Ae}from"./chunk-EQDQRRRY.js";var rn=Le(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});function fM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var pM=function i(t,e){fM(this,i),this.data=t,this.text=e.text||t,this.options=e};Ed.default=pM});var f1=Le(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.CODE39=void 0;var hM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),gM=rn(),_M=vM(gM);function vM(i){return i&&i.__esModule?i:{default:i}}function xM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function bM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function yM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CM=function(i){yM(t,i);function t(e,n){return xM(this,t),e=e.toUpperCase(),n.mod43&&(e+=EM(TM(e))),bM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return hM(t,[{key:"encode",value:function(){for(var n=Td("*"),r=0;r<this.data.length;r++)n+=Td(this.data[r])+"0";return n+=Td("*"),{data:n,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),t}(_M.default),u1=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],SM=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function Td(i){return wM(m1(i))}function wM(i){return SM[i].toString(2)}function EM(i){return u1[i]}function m1(i){return u1.indexOf(i)}function TM(i){for(var t=0,e=0;e<i.length;e++)t+=m1(i[e]);return t=t%43,t}Pc.CODE39=CM});var ho=Le(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});var us;function Pd(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var p1=ai.SET_A=0,h1=ai.SET_B=1,g1=ai.SET_C=2,dU=ai.SHIFT=98,PM=ai.START_A=103,kM=ai.START_B=104,IM=ai.START_C=105,uU=ai.MODULO=103,mU=ai.STOP=106,fU=ai.FNC1=207,pU=ai.SET_BY_CODE=(us={},Pd(us,PM,p1),Pd(us,kM,h1),Pd(us,IM,g1),us),hU=ai.SWAP={101:p1,100:h1,99:g1},gU=ai.A_START_CHAR="\xD0",_U=ai.B_START_CHAR="\xD1",vU=ai.C_START_CHAR="\xD2",xU=ai.A_CHARS="[\0-_\xC8-\xCF]",bU=ai.B_CHARS="[ -\x7F\xC8-\xCF]",yU=ai.C_CHARS="(\xCF*[0-9]{2}\xCF*)",CU=ai.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011]});var ms=Le(kd=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});var MM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),FM=rn(),AM=OM(FM),vn=ho();function OM(i){return i&&i.__esModule?i:{default:i}}function DM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function RM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function NM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var BM=function(i){NM(t,i);function t(e,n){DM(this,t);var r=RM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.substring(1),n));return r.bytes=e.split("").map(function(a){return a.charCodeAt(0)}),r}return MM(t,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var n=this.bytes,r=n.shift()-105,a=vn.SET_BY_CODE[r];if(a===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&n.unshift(vn.FNC1);var o=t.next(n,1,a);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:t.getBar(r)+o.result+t.getBar((o.checksum+r)%vn.MODULO)+t.getBar(vn.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var n=this.options.ean128||!1;return typeof n=="string"&&(n=n.toLowerCase()==="true"),n}}],[{key:"getBar",value:function(n){return vn.BARS[n]?vn.BARS[n].toString():""}},{key:"correctIndex",value:function(n,r){if(r===vn.SET_A){var a=n.shift();return a<32?a+64:a-32}else return r===vn.SET_B?n.shift()-32:(n.shift()-48)*10+n.shift()-48}},{key:"next",value:function(n,r,a){if(!n.length)return{result:"",checksum:0};var o=void 0,u=void 0;if(n[0]>=200){u=n.shift()-105;var m=vn.SWAP[u];m!==void 0?o=t.next(n,r+1,m):((a===vn.SET_A||a===vn.SET_B)&&u===vn.SHIFT&&(n[0]=a===vn.SET_A?n[0]>95?n[0]-96:n[0]:n[0]<32?n[0]+96:n[0]),o=t.next(n,r+1,a))}else u=t.correctIndex(n,a),o=t.next(n,r+1,a);var f=t.getBar(u),h=u*r;return{result:f+o.result,checksum:h+o.checksum}}}]),t}(AM.default);kd.default=BM});var y1=Le(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});var Ur=ho(),_1=function(t){return t.match(new RegExp("^"+Ur.A_CHARS+"*"))[0].length},v1=function(t){return t.match(new RegExp("^"+Ur.B_CHARS+"*"))[0].length},x1=function(t){return t.match(new RegExp("^"+Ur.C_CHARS+"*"))[0]};function Id(i,t){var e=t?Ur.A_CHARS:Ur.B_CHARS,n=i.match(new RegExp("^("+e+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(n)return n[1]+"\xCC"+b1(i.substring(n[1].length));var r=i.match(new RegExp("^"+e+"+"))[0];return r.length===i.length?i:r+String.fromCharCode(t?205:206)+Id(i.substring(r.length),!t)}function b1(i){var t=x1(i),e=t.length;if(e===i.length)return i;i=i.substring(e);var n=_1(i)>=v1(i);return t+String.fromCharCode(n?206:205)+Id(i,n)}Md.default=function(i){var t=void 0,e=x1(i).length;if(e>=2)t=Ur.C_START_CHAR+b1(i);else{var n=_1(i)>v1(i);t=(n?Ur.A_START_CHAR:Ur.B_START_CHAR)+Id(i,n)}return t.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(r,a){return"\xCB"+a})}});var S1=Le(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});var LM=ms(),VM=C1(LM),UM=y1(),jM=C1(UM);function C1(i){return i&&i.__esModule?i:{default:i}}function WM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Fd(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function HM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var $M=function(i){HM(t,i);function t(e,n){if(WM(this,t),/^[\x00-\x7F\xC8-\xD3]+$/.test(e))var r=Fd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,jM.default)(e),n));else var r=Fd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Fd(r)}return t}(VM.default);Ad.default=$M});var E1=Le(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});var zM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),GM=ms(),qM=XM(GM),w1=ho();function XM(i){return i&&i.__esModule?i:{default:i}}function KM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function YM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function QM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var JM=function(i){QM(t,i);function t(e,n){return KM(this,t),YM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,w1.A_START_CHAR+e,n))}return zM(t,[{key:"valid",value:function(){return new RegExp("^"+w1.A_CHARS+"+$").test(this.data)}}]),t}(qM.default);Od.default=JM});var P1=Le(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});var ZM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),eF=ms(),tF=iF(eF),T1=ho();function iF(i){return i&&i.__esModule?i:{default:i}}function nF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function rF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function aF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var oF=function(i){aF(t,i);function t(e,n){return nF(this,t),rF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,T1.B_START_CHAR+e,n))}return ZM(t,[{key:"valid",value:function(){return new RegExp("^"+T1.B_CHARS+"+$").test(this.data)}}]),t}(tF.default);Dd.default=oF});var I1=Le(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});var sF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),lF=ms(),cF=dF(lF),k1=ho();function dF(i){return i&&i.__esModule?i:{default:i}}function uF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function mF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function fF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var pF=function(i){fF(t,i);function t(e,n){return uF(this,t),mF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,k1.C_START_CHAR+e,n))}return sF(t,[{key:"valid",value:function(){return new RegExp("^"+k1.C_CHARS+"+$").test(this.data)}}]),t}(cF.default);Rd.default=pF});var M1=Le(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.CODE128C=lr.CODE128B=lr.CODE128A=lr.CODE128=void 0;var hF=S1(),gF=kc(hF),_F=E1(),vF=kc(_F),xF=P1(),bF=kc(xF),yF=I1(),CF=kc(yF);function kc(i){return i&&i.__esModule?i:{default:i}}lr.CODE128=gF.default;lr.CODE128A=vF.default;lr.CODE128B=bF.default;lr.CODE128C=CF.default});var go=Le(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});var FU=jr.SIDE_BIN="101",AU=jr.MIDDLE_BIN="01010",OU=jr.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},DU=jr.EAN2_STRUCTURE=["LL","LG","GL","GG"],RU=jr.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],NU=jr.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]});var _o=Le(Nd=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});var SF=go(),wF=function(t,e,n){var r=t.split("").map(function(o,u){return SF.BINARIES[e[u]]}).map(function(o,u){return o?o[t[u]]:""});if(n){var a=t.length-1;r=r.map(function(o,u){return u<a?o+n:o})}return r.join("")};Nd.default=wF});var Ld=Le(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var EF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),vo=go(),TF=_o(),F1=A1(TF),PF=rn(),kF=A1(PF);function A1(i){return i&&i.__esModule?i:{default:i}}function IF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function MF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function FF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var AF=function(i){FF(t,i);function t(e,n){IF(this,t);var r=MF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.fontSize=!n.flat&&n.fontSize>n.width*10?n.width*10:n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return EF(t,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(n,r){return this.text.substr(n,r)}},{key:"leftEncode",value:function(n,r){return(0,F1.default)(n,r)}},{key:"rightText",value:function(n,r){return this.text.substr(n,r)}},{key:"rightEncode",value:function(n,r){return(0,F1.default)(n,r)}},{key:"encodeGuarded",value:function(){var n={fontSize:this.fontSize},r={height:this.guardHeight};return[{data:vo.SIDE_BIN,options:r},{data:this.leftEncode(),text:this.leftText(),options:n},{data:vo.MIDDLE_BIN,options:r},{data:this.rightEncode(),text:this.rightText(),options:n},{data:vo.SIDE_BIN,options:r}]}},{key:"encodeFlat",value:function(){var n=[vo.SIDE_BIN,this.leftEncode(),vo.MIDDLE_BIN,this.rightEncode(),vo.SIDE_BIN];return{data:n.join(""),text:this.text}}}]),t}(kF.default);Bd.default=AF});var D1=Le(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});var OF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),fs=function i(t,e,n){t===null&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(r===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,n)}else{if("value"in r)return r.value;var o=r.get;return o===void 0?void 0:o.call(n)}},DF=go(),RF=Ld(),NF=BF(RF);function BF(i){return i&&i.__esModule?i:{default:i}}function LF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function VF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function UF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var O1=function(t){var e=t.substr(0,12).split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r*3:n+r},0);return(10-e%10)%10},jF=function(i){UF(t,i);function t(e,n){LF(this,t),e.search(/^[0-9]{12}$/)!==-1&&(e+=O1(e));var r=VF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.lastChar=n.lastChar,r}return OF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===O1(this.data)}},{key:"leftText",value:function(){return fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var n=this.data.substr(1,6),r=DF.EAN13_STRUCTURE[this.data[0]];return fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,n,r)}},{key:"rightText",value:function(){return fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var n=this.data.substr(7,6);return fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,n,"RRRRRR")}},{key:"encodeGuarded",value:function(){var n=fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(n.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(n.push({data:"00"}),n.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),n}}]),t}(NF.default);Vd.default=jF});var N1=Le(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});var WF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Ic=function i(t,e,n){t===null&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(r===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,n)}else{if("value"in r)return r.value;var o=r.get;return o===void 0?void 0:o.call(n)}},HF=Ld(),$F=zF(HF);function zF(i){return i&&i.__esModule?i:{default:i}}function GF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function qF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function XF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var R1=function(t){var e=t.substr(0,7).split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r:n+r*3},0);return(10-e%10)%10},KF=function(i){XF(t,i);function t(e,n){return GF(this,t),e.search(/^[0-9]{7}$/)!==-1&&(e+=R1(e)),qF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return WF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===R1(this.data)}},{key:"leftText",value:function(){return Ic(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var n=this.data.substr(0,4);return Ic(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,n,"LLLL")}},{key:"rightText",value:function(){return Ic(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var n=this.data.substr(4,4);return Ic(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,n,"RRRR")}}]),t}($F.default);Ud.default=KF});var L1=Le(jd=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});var YF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),QF=go(),JF=_o(),ZF=B1(JF),eA=rn(),tA=B1(eA);function B1(i){return i&&i.__esModule?i:{default:i}}function iA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function nA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function rA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var aA=function(t){var e=t.split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r*9:n+r*3},0);return e%10},oA=function(i){rA(t,i);function t(e,n){return iA(this,t),nA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return YF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var n=QF.EAN5_STRUCTURE[aA(this.data)];return{data:"1011"+(0,ZF.default)(this.data,n,"01"),text:this.text}}}]),t}(tA.default);jd.default=oA});var U1=Le(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});var sA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),lA=go(),cA=_o(),dA=V1(cA),uA=rn(),mA=V1(uA);function V1(i){return i&&i.__esModule?i:{default:i}}function fA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function pA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function hA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var gA=function(i){hA(t,i);function t(e,n){return fA(this,t),pA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return sA(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var n=lA.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,dA.default)(this.data,n,"01"),text:this.text}}}]),t}(mA.default);Wd.default=gA});var $d=Le(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});var _A=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();Mc.checksum=Hd;var vA=_o(),xo=j1(vA),xA=rn(),bA=j1(xA);function j1(i){return i&&i.__esModule?i:{default:i}}function yA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function CA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function SA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var wA=function(i){SA(t,i);function t(e,n){yA(this,t),e.search(/^[0-9]{11}$/)!==-1&&(e+=Hd(e));var r=CA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.displayValue=n.displayValue,n.fontSize>n.width*10?r.fontSize=n.width*10:r.fontSize=n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return _A(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==Hd(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var n="";return n+="101",n+=(0,xo.default)(this.data.substr(0,6),"LLLLLL"),n+="01010",n+=(0,xo.default)(this.data.substr(6,6),"RRRRRR"),n+="101",{data:n,text:this.text}}},{key:"guardedEncoding",value:function(){var n=[];return this.displayValue&&n.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),n.push({data:"101"+(0,xo.default)(this.data[0],"L"),options:{height:this.guardHeight}}),n.push({data:(0,xo.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),n.push({data:"01010",options:{height:this.guardHeight}}),n.push({data:(0,xo.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),n.push({data:(0,xo.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&n.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),n}}]),t}(bA.default);function Hd(i){var t=0,e;for(e=1;e<11;e+=2)t+=parseInt(i[e]);for(e=0;e<11;e+=2)t+=parseInt(i[e])*3;return(10-t%10)%10}Mc.default=wA});var $1=Le(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});var EA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),TA=_o(),PA=H1(TA),kA=rn(),IA=H1(kA),MA=$d();function H1(i){return i&&i.__esModule?i:{default:i}}function FA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function zd(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function AA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var OA=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],DA=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],RA=function(i){AA(t,i);function t(e,n){FA(this,t);var r=zd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));if(r.isValid=!1,e.search(/^[0-9]{6}$/)!==-1)r.middleDigits=e,r.upcA=W1(e,"0"),r.text=n.text||""+r.upcA[0]+e+r.upcA[r.upcA.length-1],r.isValid=!0;else if(e.search(/^[01][0-9]{7}$/)!==-1)if(r.middleDigits=e.substring(1,e.length-1),r.upcA=W1(r.middleDigits,e[0]),r.upcA[r.upcA.length-1]===e[e.length-1])r.isValid=!0;else return zd(r);else return zd(r);return r.displayValue=n.displayValue,n.fontSize>n.width*10?r.fontSize=n.width*10:r.fontSize=n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return EA(t,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var n="";return n+="101",n+=this.encodeMiddleDigits(),n+="010101",{data:n,text:this.text}}},{key:"guardedEncoding",value:function(){var n=[];return this.displayValue&&n.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),n.push({data:"101",options:{height:this.guardHeight}}),n.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),n.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&n.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),n}},{key:"encodeMiddleDigits",value:function(){var n=this.upcA[0],r=this.upcA[this.upcA.length-1],a=DA[parseInt(r)][parseInt(n)];return(0,PA.default)(this.middleDigits,a)}}]),t}(IA.default);function W1(i,t){for(var e=parseInt(i[i.length-1]),n=OA[e],r="",a=0,o=0;o<n.length;o++){var u=n[o];u==="X"?r+=i[a++]:r+=u}return r=""+t+r,""+r+(0,MA.checksum)(r)}Gd.default=RA});var z1=Le(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.UPCE=an.UPC=an.EAN2=an.EAN5=an.EAN8=an.EAN13=void 0;var NA=D1(),BA=bo(NA),LA=N1(),VA=bo(LA),UA=L1(),jA=bo(UA),WA=U1(),HA=bo(WA),$A=$d(),zA=bo($A),GA=$1(),qA=bo(GA);function bo(i){return i&&i.__esModule?i:{default:i}}an.EAN13=BA.default;an.EAN8=VA.default;an.EAN5=jA.default;an.EAN2=HA.default;an.UPC=zA.default;an.UPCE=qA.default});var G1=Le(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});var qU=ps.START_BIN="1010",XU=ps.END_BIN="11101",KU=ps.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]});var Xd=Le(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});var XA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Fc=G1(),KA=rn(),YA=QA(KA);function QA(i){return i&&i.__esModule?i:{default:i}}function JA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ZA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function eO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var tO=function(i){eO(t,i);function t(){return JA(this,t),ZA(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return XA(t,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var n=this,r=this.data.match(/.{2}/g).map(function(a){return n.encodePair(a)}).join("");return{data:Fc.START_BIN+r+Fc.END_BIN,text:this.text}}},{key:"encodePair",value:function(n){var r=Fc.BINARIES[n[1]];return Fc.BINARIES[n[0]].split("").map(function(a,o){return(a==="1"?"111":"1")+(r[o]==="1"?"000":"0")}).join("")}}]),t}(YA.default);qd.default=tO});var X1=Le(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});var iO=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),nO=Xd(),rO=aO(nO);function aO(i){return i&&i.__esModule?i:{default:i}}function oO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function sO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function lO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var q1=function(t){var e=t.substr(0,13).split("").map(function(n){return parseInt(n,10)}).reduce(function(n,r,a){return n+r*(3-a%2*2)},0);return Math.ceil(e/10)*10-e},cO=function(i){lO(t,i);function t(e,n){return oO(this,t),e.search(/^[0-9]{13}$/)!==-1&&(e+=q1(e)),sO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return iO(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===q1(this.data)}}]),t}(rO.default);Kd.default=cO});var Y1=Le(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.ITF14=yo.ITF=void 0;var dO=Xd(),uO=K1(dO),mO=X1(),fO=K1(mO);function K1(i){return i&&i.__esModule?i:{default:i}}yo.ITF=uO.default;yo.ITF14=fO.default});var Co=Le(Yd=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});var pO=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),hO=rn(),gO=_O(hO);function _O(i){return i&&i.__esModule?i:{default:i}}function vO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function xO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function bO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var yO=function(i){bO(t,i);function t(e,n){return vO(this,t),xO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return pO(t,[{key:"encode",value:function(){for(var n="110",r=0;r<this.data.length;r++){var a=parseInt(this.data[r]),o=a.toString(2);o=CO(o,4-o.length);for(var u=0;u<o.length;u++)n+=o[u]=="0"?"100":"110"}return n+="1001",{data:n,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),t}(gO.default);function CO(i,t){for(var e=0;e<t;e++)i="0"+i;return i}Yd.default=yO});var hs=Le(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.mod10=SO;Ac.mod11=wO;function SO(i){for(var t=0,e=0;e<i.length;e++){var n=parseInt(i[e]);(e+i.length)%2===0?t+=n:t+=n*2%10+Math.floor(n*2/10)}return(10-t%10)%10}function wO(i){for(var t=0,e=[2,3,4,5,6,7],n=0;n<i.length;n++){var r=parseInt(i[i.length-1-n]);t+=e[n%e.length]*r}return(11-t%11)%11}});var Q1=Le(Qd=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});var EO=Co(),TO=kO(EO),PO=hs();function kO(i){return i&&i.__esModule?i:{default:i}}function IO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function MO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function FO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var AO=function(i){FO(t,i);function t(e,n){return IO(this,t),MO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,PO.mod10)(e),n))}return t}(TO.default);Qd.default=AO});var J1=Le(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});var OO=Co(),DO=NO(OO),RO=hs();function NO(i){return i&&i.__esModule?i:{default:i}}function BO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function LO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function VO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var UO=function(i){VO(t,i);function t(e,n){return BO(this,t),LO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,RO.mod11)(e),n))}return t}(DO.default);Jd.default=UO});var e_=Le(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});var jO=Co(),WO=HO(jO),Z1=hs();function HO(i){return i&&i.__esModule?i:{default:i}}function $O(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function zO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function GO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var qO=function(i){GO(t,i);function t(e,n){return $O(this,t),e+=(0,Z1.mod10)(e),e+=(0,Z1.mod10)(e),zO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return t}(WO.default);Zd.default=qO});var i_=Le(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});var XO=Co(),KO=YO(XO),t_=hs();function YO(i){return i&&i.__esModule?i:{default:i}}function QO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function JO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function ZO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var e5=function(i){ZO(t,i);function t(e,n){return QO(this,t),e+=(0,t_.mod11)(e),e+=(0,t_.mod10)(e),JO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return t}(KO.default);eu.default=e5});var n_=Le(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.MSI1110=Fn.MSI1010=Fn.MSI11=Fn.MSI10=Fn.MSI=void 0;var t5=Co(),i5=gs(t5),n5=Q1(),r5=gs(n5),a5=J1(),o5=gs(a5),s5=e_(),l5=gs(s5),c5=i_(),d5=gs(c5);function gs(i){return i&&i.__esModule?i:{default:i}}Fn.MSI=i5.default;Fn.MSI10=r5.default;Fn.MSI11=o5.default;Fn.MSI1010=l5.default;Fn.MSI1110=d5.default});var r_=Le(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.pharmacode=void 0;var u5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),m5=rn(),f5=p5(m5);function p5(i){return i&&i.__esModule?i:{default:i}}function h5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function g5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var v5=function(i){_5(t,i);function t(e,n){h5(this,t);var r=g5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.number=parseInt(e,10),r}return u5(t,[{key:"encode",value:function(){for(var n=this.number,r="";!isNaN(n)&&n!=0;)n%2===0?(r="11100"+r,n=(n-2)/2):(r="100"+r,n=(n-1)/2);return r=r.slice(0,-2),{data:r,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t}(f5.default);Oc.pharmacode=v5});var a_=Le(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.codabar=void 0;var x5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),b5=rn(),y5=C5(b5);function C5(i){return i&&i.__esModule?i:{default:i}}function S5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function w5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function E5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var T5=function(i){E5(t,i);function t(e,n){S5(this,t),e.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(e="A"+e+"A");var r=w5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.toUpperCase(),n));return r.text=r.options.text||r.text.replace(/[A-D]/g,""),r}return x5(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var n=[],r=this.getEncodings(),a=0;a<this.data.length;a++)n.push(r[this.data.charAt(a)]),a!==this.data.length-1&&n.push("0");return{text:this.text,data:n.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t}(y5.default);Dc.codabar=T5});var o_=Le(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});var cj=_s.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","\xFF"],dj=_s.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],uj=_s.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"\x7F":["(%)","T"]}});var iu=Le(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});var P5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Rc=o_(),k5=rn(),I5=M5(k5);function M5(i){return i&&i.__esModule?i:{default:i}}function F5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function A5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function O5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var D5=function(i){O5(t,i);function t(e,n){return F5(this,t),A5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return P5(t,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var n=this.data.split("").flatMap(function(u){return Rc.MULTI_SYMBOLS[u]||u}),r=n.map(function(u){return t.getEncoding(u)}).join(""),a=t.checksum(n,20),o=t.checksum(n.concat(a),15);return{text:this.text,data:t.getEncoding("\xFF")+r+t.getEncoding(a)+t.getEncoding(o)+t.getEncoding("\xFF")+"1"}}}],[{key:"getEncoding",value:function(n){return Rc.BINARIES[t.symbolValue(n)]}},{key:"getSymbol",value:function(n){return Rc.SYMBOLS[n]}},{key:"symbolValue",value:function(n){return Rc.SYMBOLS.indexOf(n)}},{key:"checksum",value:function(n,r){var a=n.slice().reverse().reduce(function(o,u,m){var f=m%r+1;return o+t.symbolValue(u)*f},0);return t.getSymbol(a%47)}}]),t}(I5.default);tu.default=D5});var s_=Le(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});var R5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),N5=iu(),B5=L5(N5);function L5(i){return i&&i.__esModule?i:{default:i}}function V5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function U5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function j5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var W5=function(i){j5(t,i);function t(e,n){return V5(this,t),U5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return R5(t,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),t}(B5.default);nu.default=W5});var c_=Le(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.CODE93FullASCII=So.CODE93=void 0;var H5=iu(),$5=l_(H5),z5=s_(),G5=l_(z5);function l_(i){return i&&i.__esModule?i:{default:i}}So.CODE93=$5.default;So.CODE93FullASCII=G5.default});var d_=Le(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.GenericBarcode=void 0;var q5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),X5=rn(),K5=Y5(X5);function Y5(i){return i&&i.__esModule?i:{default:i}}function Q5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function J5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function Z5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var eD=function(i){Z5(t,i);function t(e,n){return Q5(this,t),J5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return q5(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t}(K5.default);Nc.GenericBarcode=eD});var f_=Le(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});var tD=f1(),Bc=M1(),wo=z1(),u_=Y1(),vs=n_(),iD=r_(),nD=a_(),m_=c_(),rD=d_();ru.default={CODE39:tD.CODE39,CODE128:Bc.CODE128,CODE128A:Bc.CODE128A,CODE128B:Bc.CODE128B,CODE128C:Bc.CODE128C,EAN13:wo.EAN13,EAN8:wo.EAN8,EAN5:wo.EAN5,EAN2:wo.EAN2,UPC:wo.UPC,UPCE:wo.UPCE,ITF14:u_.ITF14,ITF:u_.ITF,MSI:vs.MSI,MSI10:vs.MSI10,MSI11:vs.MSI11,MSI1010:vs.MSI1010,MSI1110:vs.MSI1110,pharmacode:iD.pharmacode,codabar:nD.codabar,CODE93:m_.CODE93,CODE93FullASCII:m_.CODE93FullASCII,GenericBarcode:rD.GenericBarcode}});var xs=Le(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});var aD=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i};au.default=function(i,t){return aD({},i,t)}});var p_=Le(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.default=oD;function oD(i){var t=[];function e(n){if(Array.isArray(n))for(var r=0;r<n.length;r++)e(n[r]);else n.text=n.text||"",n.data=n.data||"",t.push(n)}return e(i),t}});var h_=Le(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.default=sD;function sD(i){return i.marginTop=i.marginTop||i.margin,i.marginBottom=i.marginBottom||i.margin,i.marginRight=i.marginRight||i.margin,i.marginLeft=i.marginLeft||i.margin,i}});var cu=Le(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.default=lD;function lD(i){var t=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var e in t)t.hasOwnProperty(e)&&(e=t[e],typeof i[e]=="string"&&(i[e]=parseInt(i[e],10)));return typeof i.displayValue=="string"&&(i.displayValue=i.displayValue!="false"),i}});var uu=Le(du=>{"use strict";Object.defineProperty(du,"__esModule",{value:!0});var cD={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};du.default=cD});var v_=Le(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});var dD=cu(),uD=__(dD),mD=uu(),g_=__(mD);function __(i){return i&&i.__esModule?i:{default:i}}function fD(i){var t={};for(var e in g_.default)g_.default.hasOwnProperty(e)&&(i.hasAttribute("jsbarcode-"+e.toLowerCase())&&(t[e]=i.getAttribute("jsbarcode-"+e.toLowerCase())),i.hasAttribute("data-"+e.toLowerCase())&&(t[e]=i.getAttribute("data-"+e.toLowerCase())));return t.value=i.getAttribute("jsbarcode-value")||i.getAttribute("data-value"),t=(0,uD.default)(t),t}mu.default=fD});var fu=Le(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.getTotalWidthOfEncodings=An.calculateEncodingAttributes=An.getBarcodePadding=An.getEncodingHeight=An.getMaximumHeightOfEncodings=void 0;var pD=xs(),hD=gD(pD);function gD(i){return i&&i.__esModule?i:{default:i}}function x_(i,t){return t.height+(t.displayValue&&i.text.length>0?t.fontSize+t.textMargin:0)+t.marginTop+t.marginBottom}function b_(i,t,e){if(e.displayValue&&t<i){if(e.textAlign=="center")return Math.floor((i-t)/2);if(e.textAlign=="left")return 0;if(e.textAlign=="right")return Math.floor(i-t)}return 0}function _D(i,t,e){for(var n=0;n<i.length;n++){var r=i[n],a=(0,hD.default)(t,r.options),o;a.displayValue?o=bD(r.text,a,e):o=0;var u=r.data.length*a.width;r.width=Math.ceil(Math.max(o,u)),r.height=x_(r,a),r.barcodePadding=b_(o,u,a)}}function vD(i){for(var t=0,e=0;e<i.length;e++)t+=i[e].width;return t}function xD(i){for(var t=0,e=0;e<i.length;e++)i[e].height>t&&(t=i[e].height);return t}function bD(i,t,e){var n;if(e)n=e;else if(typeof document<"u")n=document.createElement("canvas").getContext("2d");else return 0;n.font=t.fontOptions+" "+t.fontSize+"px "+t.font;var r=n.measureText(i);if(!r)return 0;var a=r.width;return a}An.getMaximumHeightOfEncodings=xD;An.getEncodingHeight=x_;An.getBarcodePadding=b_;An.calculateEncodingAttributes=_D;An.getTotalWidthOfEncodings=vD});var y_=Le(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});var yD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),CD=xs(),SD=wD(CD),pu=fu();function wD(i){return i&&i.__esModule?i:{default:i}}function ED(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var TD=function(){function i(t,e,n){ED(this,i),this.canvas=t,this.encodings=e,this.options=n}return yD(i,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var e=0;e<this.encodings.length;e++){var n=(0,SD.default)(this.options,this.encodings[e].options);this.drawCanvasBarcode(n,this.encodings[e]),this.drawCanvasText(n,this.encodings[e]),this.moveCanvasDrawing(this.encodings[e])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var e=this.canvas.getContext("2d");e.save(),(0,pu.calculateEncodingAttributes)(this.encodings,this.options,e);var n=(0,pu.getTotalWidthOfEncodings)(this.encodings),r=(0,pu.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=n+this.options.marginLeft+this.options.marginRight,this.canvas.height=r,e.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(e.fillStyle=this.options.background,e.fillRect(0,0,this.canvas.width,this.canvas.height)),e.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(e,n){var r=this.canvas.getContext("2d"),a=n.data,o;e.textPosition=="top"?o=e.marginTop+e.fontSize+e.textMargin:o=e.marginTop,r.fillStyle=e.lineColor;for(var u=0;u<a.length;u++){var m=u*e.width+n.barcodePadding;a[u]==="1"?r.fillRect(m,o,e.width,e.height):a[u]&&r.fillRect(m,o,e.width,e.height*a[u])}}},{key:"drawCanvasText",value:function(e,n){var r=this.canvas.getContext("2d"),a=e.fontOptions+" "+e.fontSize+"px "+e.font;if(e.displayValue){var o,u;e.textPosition=="top"?u=e.marginTop+e.fontSize-e.textMargin:u=e.height+e.textMargin+e.marginTop+e.fontSize,r.font=a,e.textAlign=="left"||n.barcodePadding>0?(o=0,r.textAlign="left"):e.textAlign=="right"?(o=n.width-1,r.textAlign="right"):(o=n.width/2,r.textAlign="center"),r.fillText(n.text,o,u)}}},{key:"moveCanvasDrawing",value:function(e){var n=this.canvas.getContext("2d");n.translate(e.width,0)}},{key:"restoreCanvas",value:function(){var e=this.canvas.getContext("2d");e.restore()}}]),i}();hu.default=TD});var C_=Le(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});var PD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),kD=xs(),ID=MD(kD),gu=fu();function MD(i){return i&&i.__esModule?i:{default:i}}function FD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Lc="http://www.w3.org/2000/svg",AD=function(){function i(t,e,n){FD(this,i),this.svg=t,this.encodings=e,this.options=n,this.document=n.xmlDocument||document}return PD(i,[{key:"render",value:function(){var e=this.options.marginLeft;this.prepareSVG();for(var n=0;n<this.encodings.length;n++){var r=this.encodings[n],a=(0,ID.default)(this.options,r.options),o=this.createGroup(e,a.marginTop,this.svg);this.setGroupOptions(o,a),this.drawSvgBarcode(o,a,r),this.drawSVGText(o,a,r),e+=r.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,gu.calculateEncodingAttributes)(this.encodings,this.options);var e=(0,gu.getTotalWidthOfEncodings)(this.encodings),n=(0,gu.getMaximumHeightOfEncodings)(this.encodings),r=e+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(r,n),this.options.background&&this.drawRect(0,0,r,n,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(e,n,r){var a=r.data,o;n.textPosition=="top"?o=n.fontSize+n.textMargin:o=0;for(var u=0,m=0,f=0;f<a.length;f++)m=f*n.width+r.barcodePadding,a[f]==="1"?u++:u>0&&(this.drawRect(m-n.width*u,o,n.width*u,n.height,e),u=0);u>0&&this.drawRect(m-n.width*(u-1),o,n.width*u,n.height,e)}},{key:"drawSVGText",value:function(e,n,r){var a=this.document.createElementNS(Lc,"text");if(n.displayValue){var o,u;a.setAttribute("style","font:"+n.fontOptions+" "+n.fontSize+"px "+n.font),n.textPosition=="top"?u=n.fontSize-n.textMargin:u=n.height+n.textMargin+n.fontSize,n.textAlign=="left"||r.barcodePadding>0?(o=0,a.setAttribute("text-anchor","start")):n.textAlign=="right"?(o=r.width-1,a.setAttribute("text-anchor","end")):(o=r.width/2,a.setAttribute("text-anchor","middle")),a.setAttribute("x",o),a.setAttribute("y",u),a.appendChild(this.document.createTextNode(r.text)),e.appendChild(a)}}},{key:"setSvgAttributes",value:function(e,n){var r=this.svg;r.setAttribute("width",e+"px"),r.setAttribute("height",n+"px"),r.setAttribute("x","0px"),r.setAttribute("y","0px"),r.setAttribute("viewBox","0 0 "+e+" "+n),r.setAttribute("xmlns",Lc),r.setAttribute("version","1.1"),r.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(e,n,r){var a=this.document.createElementNS(Lc,"g");return a.setAttribute("transform","translate("+e+", "+n+")"),r.appendChild(a),a}},{key:"setGroupOptions",value:function(e,n){e.setAttribute("style","fill:"+n.lineColor+";")}},{key:"drawRect",value:function(e,n,r,a,o){var u=this.document.createElementNS(Lc,"rect");return u.setAttribute("x",e),u.setAttribute("y",n),u.setAttribute("width",r),u.setAttribute("height",a),o.appendChild(u),u}}]),i}();_u.default=AD});var S_=Le(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});var OD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function DD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var RD=function(){function i(t,e,n){DD(this,i),this.object=t,this.encodings=e,this.options=n}return OD(i,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),i}();vu.default=RD});var w_=Le(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});var ND=y_(),BD=xu(ND),LD=C_(),VD=xu(LD),UD=S_(),jD=xu(UD);function xu(i){return i&&i.__esModule?i:{default:i}}bu.default={CanvasRenderer:BD.default,SVGRenderer:VD.default,ObjectRenderer:jD.default}});var wu=Le(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});function yu(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Cu(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function Su(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var WD=function(i){Su(t,i);function t(e,n){yu(this,t);var r=Cu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.name="InvalidInputException",r.symbology=e,r.input=n,r.message='"'+r.input+'" is not a valid input for '+r.symbology,r}return t}(Error),HD=function(i){Su(t,i);function t(){yu(this,t);var e=Cu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="InvalidElementException",e.message="Not supported type to render on",e}return t}(Error),$D=function(i){Su(t,i);function t(){yu(this,t);var e=Cu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="NoElementException",e.message="No element to render on.",e}return t}(Error);bs.InvalidInputException=WD;bs.InvalidElementException=HD;bs.NoElementException=$D});var T_=Le(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});var zD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},GD=v_(),Eu=E_(GD),qD=w_(),ys=E_(qD),XD=wu();function E_(i){return i&&i.__esModule?i:{default:i}}function Tu(i){if(typeof i=="string")return KD(i);if(Array.isArray(i)){for(var t=[],e=0;e<i.length;e++)t.push(Tu(i[e]));return t}else{if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLImageElement)return YD(i);if(i&&i.nodeName&&i.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&i instanceof SVGElement)return{element:i,options:(0,Eu.default)(i),renderer:ys.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement)return{element:i,options:(0,Eu.default)(i),renderer:ys.default.CanvasRenderer};if(i&&i.getContext)return{element:i,renderer:ys.default.CanvasRenderer};if(i&&(typeof i>"u"?"undefined":zD(i))==="object"&&!i.nodeName)return{element:i,renderer:ys.default.ObjectRenderer};throw new XD.InvalidElementException}}function KD(i){var t=document.querySelectorAll(i);if(t.length!==0){for(var e=[],n=0;n<t.length;n++)e.push(Tu(t[n]));return e}}function YD(i){var t=document.createElement("canvas");return{element:t,options:(0,Eu.default)(i),renderer:ys.default.CanvasRenderer,afterRender:function(){i.setAttribute("src",t.toDataURL())}}}Pu.default=Tu});var P_=Le(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});var QD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function JD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var ZD=function(){function i(t){JD(this,i),this.api=t}return QD(i,[{key:"handleCatch",value:function(e){if(e.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw e.message;else throw e;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(e){try{var n=e.apply(void 0,arguments);return this.api._options.valid(!0),n}catch(r){return this.handleCatch(r),this.api}}}]),i}();ku.default=ZD});var Fu=Le((Aj,D_)=>{"use strict";var e6=f_(),xa=Wr(e6),t6=xs(),Cs=Wr(t6),i6=p_(),I_=Wr(i6),n6=h_(),k_=Wr(n6),r6=T_(),a6=Wr(r6),o6=cu(),s6=Wr(o6),l6=P_(),c6=Wr(l6),M_=wu(),d6=uu(),F_=Wr(d6);function Wr(i){return i&&i.__esModule?i:{default:i}}var Cr=function(){},Vc=function(t,e,n){var r=new Cr;if(typeof t>"u")throw Error("No element to render on was provided.");return r._renderProperties=(0,a6.default)(t),r._encodings=[],r._options=F_.default,r._errorHandler=new c6.default(r),typeof e<"u"&&(n=n||{},n.format||(n.format=O_()),r.options(n)[n.format](e,n).render()),r};Vc.getModule=function(i){return xa.default[i]};for(Iu in xa.default)xa.default.hasOwnProperty(Iu)&&u6(xa.default,Iu);var Iu;function u6(i,t){Cr.prototype[t]=Cr.prototype[t.toUpperCase()]=Cr.prototype[t.toLowerCase()]=function(e,n){var r=this;return r._errorHandler.wrapBarcodeCall(function(){n.text=typeof n.text>"u"?void 0:""+n.text;var a=(0,Cs.default)(r._options,n);a=(0,s6.default)(a);var o=i[t],u=A_(e,o,a);return r._encodings.push(u),r})}}function A_(i,t,e){i=""+i;var n=new t(i,e);if(!n.valid())throw new M_.InvalidInputException(n.constructor.name,i);var r=n.encode();r=(0,I_.default)(r);for(var a=0;a<r.length;a++)r[a].options=(0,Cs.default)(e,r[a].options);return r}function O_(){return xa.default.CODE128?"CODE128":Object.keys(xa.default)[0]}Cr.prototype.options=function(i){return this._options=(0,Cs.default)(this._options,i),this};Cr.prototype.blank=function(i){var t=new Array(i+1).join("0");return this._encodings.push({data:t}),this};Cr.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var i;for(var t in this._renderProperties){i=this._renderProperties[t];var e=(0,Cs.default)(this._options,i.options);e.format=="auto"&&(e.format=O_()),this._errorHandler.wrapBarcodeCall(function(){var n=e.value,r=xa.default[e.format.toUpperCase()],a=A_(n,r,e);Mu(i,a,e)})}}};Cr.prototype.render=function(){if(!this._renderProperties)throw new M_.NoElementException;if(Array.isArray(this._renderProperties))for(var i=0;i<this._renderProperties.length;i++)Mu(this._renderProperties[i],this._encodings,this._options);else Mu(this._renderProperties,this._encodings,this._options);return this};Cr.prototype._defaults=F_.default;function Mu(i,t,e){t=(0,I_.default)(t);for(var n=0;n<t.length;n++)t[n].options=(0,Cs.default)(e,t[n].options),(0,k_.default)(t[n].options);(0,k_.default)(e);var r=i.renderer,a=new r(i.element,t,e);a.render(),i.afterRender&&i.afterRender()}typeof window<"u"&&(window.JsBarcode=Vc);typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(i,t){var e=[];return jQuery(this).each(function(){e.push(this)}),Vc(e,i,t)});D_.exports=Vc});var sp=He.apiUrl,Kt=class i{constructor(t,e){this.router=t;this.http=e;this.cargarStorage()}apiUrl=`${He.apiUrl}/auth`;isLoginVisible=new Kn(!1);isEditProfileVisible=new Kn(!1);isChangePasswordVisible=new Kn(!1);userNombreSubject=new Kn(localStorage.getItem("user_nombre"));userRolSubject=new Kn(localStorage.getItem("user_rol"));usuarioSubject=new Kn(this.getUserData());usuario$=this.usuarioSubject.asObservable();farmaciaSubject=new Kn(this.getFarmaciaData());farmacia$=this.farmaciaSubject.asObservable();usuario=null;userNombre$=this.userNombreSubject.asObservable();userRol$=this.userRolSubject.asObservable();login(t,e,n){let r=`${sp}/auth/login`,a={usuario:t,password:e};return n&&(a.firma=n),this.http.post(r,a).pipe(Rn(o=>{o?.token&&o?.user&&(this.guardarToken(o.token),localStorage.setItem("usuario",JSON.stringify(o.user)),this.usuario=o.user,this.usuarioSubject.next(o.user))}))}register(t,e,n,r,a){let o=new Qe({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/auto-register`,{nombre:t,password:e,email:n,telefono:r,domicilio:a},{headers:o})}setUserData(t,e,n,r="",a=null,o="",u=""){localStorage.setItem("auth_token",t),localStorage.setItem("user_nombre",e),localStorage.setItem("user_rol",n),localStorage.setItem("user_email",r),o&&localStorage.setItem("user_telefono",o),u&&localStorage.setItem("user_domicilio",u);let m=a&&typeof a=="object"?{_id:a._id,nombre:a.nombre,direccion:a.direccion,telefono:a.telefono,titulo1:a.titulo1,titulo2:a.titulo2,imagen:a.imagen}:null;m?(localStorage.setItem("user_farmacia",JSON.stringify(m)),this.setFarmacia(m)):(localStorage.removeItem("user_farmacia"),this.setFarmacia(null)),this.userNombreSubject.next(e),this.userRolSubject.next(n),this.setFarmacia(m)}logout(){this.usuario=null,localStorage.clear(),this.farmaciaSubject.next(null),this.usuarioSubject.next(null),this.router.navigateByUrl("/")}guardarToken(t){localStorage.setItem("token",t)}cargarStorage(){let t=localStorage.getItem("usuario");try{this.usuario=t&&t!=="undefined"?JSON.parse(t):null}catch(e){console.error("\u274C Error al parsear usuario en cargarStorage:",e),this.usuario=null,localStorage.removeItem("usuario")}}getUsuario(){return this.usuario}getUserData(){let t=localStorage.getItem("usuario");try{return t&&t!=="undefined"?JSON.parse(t):null}catch(e){return console.error("Error al parsear usuario del localStorage:",e),null}}getFarmaciaData(){let t=localStorage.getItem("user_farmacia");try{return t?JSON.parse(t):null}catch{return null}}showLogin(){this.isLoginVisible.next(!0)}hideLogin(){this.isLoginVisible.next(!1)}changePassword(t,e,n){let r=localStorage.getItem("auth_token");if(!r)return console.error("No hay token en localStorage"),bm(()=>new Error("No hay token disponible"));let a=new Qe({"x-auth-token":r||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/change-password`,{passwordActual:t,nuevaPassword:e,confirmarPassword:n},{headers:a})}showChangePassword(){this.isChangePasswordVisible.next(!0),this.isEditProfileVisible.next(!1)}hideChangePassword(){this.isChangePasswordVisible.next(!1)}showEditProfile(){this.isEditProfileVisible.next(!0)}hideEditProfile(){this.isEditProfileVisible.next(!1)}updateUser(t,e,n,r,a){let o=localStorage.getItem("auth_token");if(!o)return console.error("\u274C No hay token disponible, la solicitud ser\xE1 rechazada."),new Xn(m=>{m.error({mensaje:"No hay token de autenticaci\xF3n."})});let u=new Qe({"Content-Type":"application/json","x-auth-token":o});return this.http.put(`${this.apiUrl}/update`,{nombre:t,password:e,email:n,telefono:r,domicilio:a},{headers:u})}isAuthenticated(){let t=localStorage.getItem("token");if(!t)return!1;try{let n=JSON.parse(atob(t.split(".")[1])).exp,r=Math.floor(Date.now()/1e3);return n>r}catch{return!1}}get isLoggedIn(){return this.isAuthenticated()}tieneRol(t){let e=this.getUserData();return e&&t.includes(e.rol)}verificaToken(){let t=`${sp}/auth/renew`;return this.http.get(t).pipe(Rn(e=>{this.guardarToken(e.token),localStorage.setItem("usuario",JSON.stringify(e.usuario)),this.usuario=e.usuario,this.usuarioSubject.next(e.usuario)}),xt(()=>!0),Pi(()=>(this.logout(),gt(!1))))}notifyUserChange(){let t=this.getUserData(),e=localStorage.getItem("token");t&&e?(this.usuarioSubject.next(t),this.userNombreSubject.next(t.nombre),this.userRolSubject.next(t.rol)):(this.usuarioSubject.next(null),this.userNombreSubject.next(null),this.userRolSubject.next(null))}getUserId(){return localStorage.getItem("user_id")}setFarmacia(t){t?localStorage.setItem("user_farmacia",JSON.stringify(t)):localStorage.removeItem("user_farmacia"),this.farmaciaSubject.next(t)}obtenerFirma(t){return this.http.get(`${He.apiUrl}/farmacias/firma/${t}`)}static \u0275fac=function(e){return new(e||i)(lt(Yi),lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var ol=class i{constructor(t){this.authService=t}ngOnInit(){this.authService.notifyUserChange()}static \u0275fac=function(e){return new(e||i)(ie(Kt))};static \u0275cmp=Te({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(e,n){e&1&&y(0,"router-outlet")},dependencies:[$s],encapsulation:2})};var Qi=i=>{let t=je(Kt),e=je(Yi);if(!t.isAuthenticated())return e.navigate(["/login"]),!1;let n=t.getUserData(),r=n?.rol,a=i.data?.rolesPermitidos;if(!r)return console.warn("\u26A0\uFE0F Usuario inv\xE1lido o sin rol:",n),e.navigate(["/login"]),!1;if(!a||a.includes(r)){if(r==="empleado"){let o=["ventas","pedidos","devoluciones"],u=localStorage.getItem("corte_activo");if(o.includes(i.routeConfig?.path||"")&&!u)return e.navigate(["/inicio-turno"]),!1}return!0}return e.navigate(["/home"]),!1};function Jv(i,t){if(i&1&&y(0,"button",18),i&2){let e=t.index,n=_(2);Be("active",e===n.activeSlideIndex),Ye("data-bs-slide-to",e)("aria-label","Slide "+(e+1))}}function Zv(i,t){if(i&1&&(l(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"div",11),y(5,"img",12),l(6,"div",13)(7,"h5",14),d(8),s(),l(9,"p",15),d(10),s()()()()()(),l(11,"div",16),N(12,Jv,1,4,"button",17),s()()),i&2){let e=t.$implicit,n=t.index,r=_();Be("active",n===0),c(5),p("src",e.image,mr)("alt",e.image),c(3),T(e.title),c(2),T(e.description),c(2),p("ngForOf",r.carouselItems)}}var sl=class i{carouselItems=[{image:"./assets/images/PromoLunes.jfif",title:"LUNES !! de Bienestar",description:"Aprovecha nuestros descuentos en medicamentos seleccionados."},{image:"./assets/images/ofer4x3.png",title:"Paga 3 y ll\xE9vate 4",description:"Ahorra a\xFAn m\xE1s con nuestras grandes ofertas, consulta productos participantes"},{image:"./assets/images/bebes.jfif",title:"Cuida a tu Beb\xE9",description:"Encuentra productos esenciales para el cuidado de tu beb\xE9."},{image:"./assets/images/prodBelleza.jfif",title:"Productos de Belleza",description:"Descubre nuestra l\xEDnea de productos de belleza y bienestar."},{image:"./assets/images/saludSex.jfif",title:"Salud Sexual y Bienestar",description:"Todo lo que necesitas para tu salud y bienestar \xEDntimo."}];activeSlideIndex=0;ngAfterViewInit(){let t=document.getElementById("carouselExampleIndicators");t&&t.addEventListener("slid.bs.carousel",e=>{this.activeSlideIndex=e.to})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-carousel"]],decls:7,vars:1,consts:[["id","carouselExampleIndicators","data-bs-ride","carousel",1,"carousel","slide","mt-6","mx-auto"],[1,"carousel-inner","text-center"],["class","carousel-item",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"carousel-item"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6"],[1,"card","custom-carousel-card"],[1,"card-img-top","custom-carousel-image",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"carousel-indicators"],["type","button","data-bs-target","#carouselExampleIndicators",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1),N(2,Zv,13,7,"div",2),s(),l(3,"button",3),y(4,"span",4),s(),l(5,"button",5),y(6,"span",6),s()()),e&2&&(c(2),p("ngForOf",n.carouselItems))},dependencies:[Oe,We],styles:[".carousel[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto;padding-top:50px}.mt-6[_ngcontent-%COMP%]{margin-top:4rem}.carousel-inner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;overflow:hidden}.carousel-item[_ngcontent-%COMP%]{margin-right:0;backface-visibility:hidden;transition:transform .6s ease-in-out}.custom-carousel-card[_ngcontent-%COMP%]{width:100%;max-width:800px;margin:auto;border-radius:10px;overflow:hidden;box-shadow:0 4px 6px #0003;background-color:#007bff;color:#fff}.custom-carousel-image[_ngcontent-%COMP%]{width:100%;object-fit:cover}.carousel-control-prev[_ngcontent-%COMP%], .carousel-control-next[_ngcontent-%COMP%]{filter:invert(100%);width:6%;opacity:.8;transition:all .3s ease-in-out}.carousel-control-prev[_ngcontent-%COMP%]{left:8rem}.carousel-control-next[_ngcontent-%COMP%]{right:8rem}.carousel-control-prev[_ngcontent-%COMP%]:hover, .carousel-control-next[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.2)}.card-body[_ngcontent-%COMP%]{padding:5px}.card-text[_ngcontent-%COMP%]{margin-bottom:0}.carousel-indicators[_ngcontent-%COMP%]{position:relative;bottom:-10px;margin-top:0;display:flex;justify-content:center;align-items:center}.carousel-indicators[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background-color:#00000080;border:none;margin:10px;transition:background-color .3s ease-in-out}.carousel-indicators[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{background-color:#007bff;width:14px;height:14px}"]})};function ex(i,t){i&1&&y(0,"img",5)}var ll=class i{constructor(t,e){this.authService=t;this.cdRef=e}ngOnInit(){this.authService.isEditProfileVisible.subscribe(()=>{this.cdRef.detectChanges()})}isLoginVisible(){return this.authService.isLoginVisible.value}static \u0275fac=function(e){return new(e||i)(ie(Kt),ie(Dt))};static \u0275cmp=Te({type:i,selectors:[["app-home"]],decls:8,vars:1,consts:[[1,"home-container"],["src","assets/images/farmBienLogo.png","alt","Imagen Home","class","home-image",4,"ngIf"],[1,"text-container"],[1,"text-2xl","font-bold"],[1,"mt-1"],["src","assets/images/farmBienLogo.png","alt","Imagen Home",1,"home-image"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,ex,1,0,"img",1),l(2,"div",2)(3,"h2",3),d(4,"Bienvenido a Farmacias del Bienestar"),s(),l(5,"p",4),d(6,"Encuentra los mejores productos y consultorio m\xE9dico."),s()()(),y(7,"app-carousel")),e&2&&(c(),p("ngIf",!n.authService.isLoginVisible.value&&!n.authService.isEditProfileVisible.value))},dependencies:[Oe,Ne,sl],styles:[".home-container[_ngcontent-%COMP%]{position:relative;z-index:10;text-align:left;padding:0;margin-top:0}.text-container[_ngcontent-%COMP%]{position:absolute;text-align:left;max-width:600px;margin-left:40px}.home-image[_ngcontent-%COMP%]{position:absolute;top:10px;right:20px!important;width:150px;height:auto}"]})};var ul=hi(ki());var cl=hi(ki());function tx(i,t){if(i&1&&(l(0,"option",6),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}var dl=class i{constructor(t,e){this.farmaciaService=t;this.http=e}farmacias=[];farmaciaSeleccionada="";farmaciaConfirmada=new zt;ngOnInit(){let t=localStorage.getItem("token");this.farmaciaService.obtenerFarmacias().subscribe({next:e=>this.farmacias=e,error:()=>cl.default.fire("Error","No se pudieron cargar las farmacias","error")})}confirmar(){if(!this.farmaciaSeleccionada){cl.default.fire({icon:"error",title:"Selecci\xF3n de Farmacia",text:"\xA1Por favor, selecciona una farmacia para continuar!"});return}let t=this.farmacias.find(n=>n._id===this.farmaciaSeleccionada);if(!t){console.error("Farmacia no encontrada");return}let e={_id:t._id,nombre:t.nombre,direccion:t.direccion,telefono:t.telefono,titulo1:t.titulo1,titulo2:t.titulo2,imagen:t.imagen};localStorage.setItem("user_farmacia",JSON.stringify(e)),this.farmaciaConfirmada.emit(e),cl.default.fire({icon:"success",title:"Inicio de sesi\xF3n exitoso",text:"Bienvenido, administrador",timer:1e3,showConfirmButton:!1})}static \u0275fac=function(e){return new(e||i)(ie(Xt),ie(ct))};static \u0275cmp=Te({type:i,selectors:[["app-farmacia-selector"]],outputs:{farmaciaConfirmada:"farmaciaConfirmada"},decls:10,vars:2,consts:[[1,"modal-overlay"],[1,"modal-content"],[1,"selectPharma",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"mt-3","login-logout-button",3,"click"],[3,"value"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h4"),d(3,"Selecciona una farmacia"),s(),l(4,"select",2),ee("ngModelChange",function(a){return Z(n.farmaciaSeleccionada,a)||(n.farmaciaSeleccionada=a),a}),l(5,"option",3),d(6,"-- Elige una farmacia --"),s(),N(7,tx,2,2,"option",4),s(),l(8,"button",5),w("click",function(){return n.confirmar()}),d(9,"Confirmar"),s()()()),e&2&&(c(4),J("ngModel",n.farmaciaSeleccionada),c(3),p("ngForOf",n.farmacias))},dependencies:[Oe,We,ot,rt,at,nt,ze,_t],styles:[".modal-overlay[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding-top:20px;padding-bottom:20px}.modal-content[_ngcontent-%COMP%]{padding:8px;background:#f1fbfb;border-radius:5px;box-shadow:-6px 0 6px #1303fa33;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.selectPharma[_ngcontent-%COMP%]{border-radius:5px;width:90%;height:32px;color:#00f}"]})};var ix=i=>({"-webkit-text-security":i});function nx(i,t){if(i&1){let e=ae();l(0,"form",6),w("ngSubmit",function(){P(e);let r=_();return k(r.onSubmit())}),l(1,"div",7),y(2,"input",8),s(),l(3,"div",7),y(4,"input",9),l(5,"button",10),w("click",function(){P(e);let r=_();return k(r.toggleMostrarPassword())}),y(6,"fa-icon",11),s()(),l(7,"button",12),d(8,"Iniciar"),s()()}if(i&2){let e=_();p("formGroup",e.loginForm),c(4),p("type","text")("ngStyle",_i(5,ix,e.mostrarPassword?"none":"disc")),c(2),p("icon",e.mostrarPassword?"eye-slash":"eye"),c(),p("disabled",e.loginForm.invalid)}}function rx(i,t){if(i&1){let e=ae();l(0,"app-farmacia-selector",13),w("farmaciaConfirmada",function(r){P(e);let a=_();return k(a.onFarmaciaConfirmada(r))}),s()}}var Ua=class i{constructor(t,e,n,r,a,o){this.fb=t;this.http=e;this.authService=n;this.router=r;this.cdr=a;o.addIcons(af,Oa),this.loginForm=this.fb.group({usuario:["",Pe.required],password:["",Pe.required]})}loginForm;errorMessage="";showFarmaciaSelector=!1;farmaciaSubject;mostrarPassword=!1;farmaciaId="";closeLogin(){this.authService.hideLogin(),this.cdr.detectChanges()}onSubmit(){if(!this.loginForm.valid){this.showErrorAlert("Por favor, completa todos los campos correctamente.");return}let{usuario:t,password:e}=this.loginForm.value,n=r=>{this.authService.login(t,e,r).subscribe({next:a=>{a&&a.token&&a.user?(this.authService.setUserData(a.token,a.user.nombre,a.user.rol,a.user.email,a.user.farmacia,a.user.telefono,a.user.domicilio),a.user.rol==="admin"?this.showFarmaciaSelector=!0:(this.farmaciaId=a.user.farmacia?._id||"",this.verificarCorteActivoYRedirigir())):this.showErrorAlert("Respuesta del servidor no v\xE1lida")},error:a=>Ae(this,null,function*(){if(a?.status===401&&a?.error?.requiereFirma){let{value:u}=yield ul.default.fire({title:"Autorizaci\xF3n requerida",input:"password",inputLabel:"Firma de la farmacia",inputPlaceholder:"Ingresa la firma",inputAttributes:{autocapitalize:"off",autocorrect:"off"},showCancelButton:!0,confirmButtonText:"Autorizar",cancelButtonText:"Cancelar"});if(!u)return;n(u);return}console.error("\u274C Error en login:",a),this.showErrorAlert(a?.error?.mensaje||"Error en autenticaci\xF3n")})})};n()}onFarmaciaConfirmada(t){this.authService.setFarmacia(t),this.showFarmaciaSelector=!1,this.farmaciaId=t._id,this.verificarCorteActivoYRedirigir()}toggleMostrarPassword(){this.mostrarPassword=!this.mostrarPassword}showErrorAlert(t){ul.default.fire({icon:"error",title:"Error en el inicio de sesi\xF3n",text:t,confirmButtonText:"Intentar de nuevo"})}verificarCorteActivoYRedirigir(){let t=JSON.parse(localStorage.getItem("usuario")||"null"),e=localStorage.getItem("auth_token");if(!t||!t.id||!t.rol){console.error("Usuario no v\xE1lido en localStorage"),this.router.navigate(["/home"]);return}let n=new Qe({"x-auth-token":e||""});this.http.get(`${He.apiUrl}/cortes/activo/${t.id}/${this.farmaciaId}`,{headers:n}).subscribe({next:r=>{if(r?.corte){localStorage.setItem("corte_activo",r.corte._id);let a=new Date(r.corte.fechaInicio).toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),o=Number(r.corte.efectivoInicial||0).toFixed(2),u=r.corte.saldoInicialRecargas!==void 0?`<p><strong>Saldo inicial recargas:</strong> $${Number(r.corte.saldoInicialRecargas).toFixed(2)}</p>`:"";ul.default.fire({title:"Turno ya activo",html:`
              <p>Ya tienes un turno abierto.</p>
              <p><strong>Inicio:</strong> ${a}</p>
              <p><strong>Efectivo inicial:</strong> $${o}</p>
              ${u}
            `,icon:"info",timer:2e3,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.authService.hideLogin(),this.router.navigate(["/home"])})}else localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])},error:r=>{console.error("Error al verificar corte activo:",r),localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])}})}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(ct),ie(Kt),ie(Yi),ie(Dt),ie(yi))};static \u0275cmp=Te({type:i,selectors:[["app-login"]],decls:9,vars:2,consts:[[1,"login-overlay"],[1,"login-container"],[1,"close-button",3,"click"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"login-image"],["class","login-form",3,"formGroup","ngSubmit",4,"ngIf"],[3,"farmaciaConfirmada",4,"ngIf"],[1,"login-form",3,"ngSubmit","formGroup"],[1,"input-group"],["formControlName","usuario","placeholder","Usuario","required","","autocomplete","off","spellcheck","false","autocapitalize","off",1,"form-control"],["formControlName","password","placeholder","Contrase\xF1a","autocomplete","new-password","spellcheck","false","autocapitalize","off","required","",1,"form-control",3,"type","ngStyle"],["type","button","tabindex","-1","title","Mostrar/Ocultar contrase\xF1a",1,"btn-gris",3,"click"],[3,"icon"],["type","submit",1,"login-logout-button","mb-3","mt-3",3,"disabled"],[3,"farmaciaConfirmada"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),w("click",function(){return n.closeLogin()}),d(3,"\u2716"),s(),y(4,"img",3),l(5,"h2"),d(6,"Iniciar sesi\xF3n"),s(),N(7,nx,9,7,"form",4)(8,rx,1,0,"app-farmacia-selector",5),s()()),e&2&&(c(7),p("ngIf",!n.showFarmaciaSelector),c(),p("ngIf",n.showFarmaciaSelector))},dependencies:[Lt,At,qe,ze,Ft,Fa,ci,di,Oe,Ne,Ia,dl,ti,ei],styles:[".login-overlay[_ngcontent-%COMP%]{position:absolute;top:80px;right:0;width:100%;height:calc(100vh - 80px);background:#00000080;display:flex;justify-content:flex-end;align-items:center;z-index:1050}.login-container[_ngcontent-%COMP%]{width:350px;background:#fff;padding:0;border-radius:10px;box-shadow:-4px 0 6px #0003;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.login-image[_ngcontent-%COMP%]{width:80%;max-height:120px;object-fit:contain;margin-bottom:10px;margin-top:20px}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;font-weight:700;cursor:pointer;color:#333}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;margin-top:2rem}.input-group[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:center;margin-bottom:2rem}"]})};function ax(i,t){if(i&1&&(Ze(0),d(1),et()),i&2){let e=_();c(),R(" Tel\xE9fono: ",e.telefono," ")}}var er=class i{farmacia;nombreFarmacia="";titulo1="";titulo2="";direccion="";telefono="";imagen="";logoReady=new zt;safeLogoSrc="";ngOnChanges(t){let e=this.farmacia??{};this.nombreFarmacia=e.nombre??this.nombreFarmacia??"",this.direccion=e.direccion??this.direccion??"",this.telefono=e.telefono??this.telefono??"",this.titulo1=e.titulo1??this.titulo1??"",this.titulo2=e.titulo2??this.titulo2??"",this.safeLogoSrc=e.imagen||this.imagen||this.defaultLogo(),setTimeout(()=>{let n=new Image;n.onload=()=>this.logoReady.emit(),n.onerror=()=>this.logoReady.emit(),n.src=this.safeLogoSrc},0)}defaultLogo(){return`${typeof window<"u"?window.location.origin.replace(/\/+$/,""):""}/assets/images/farmBienIcon.png`}onLogoError(t){let e=t.target,n=this.defaultLogo();e.src!==n&&(e.src=n),this.logoReady.emit()}onLogoLoad(){this.logoReady.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-ticket-header"]],inputs:{farmacia:"farmacia",nombreFarmacia:"nombreFarmacia",titulo1:"titulo1",titulo2:"titulo2",direccion:"direccion",telefono:"telefono",imagen:"imagen"},outputs:{logoReady:"logoReady"},features:[Er],decls:14,vars:6,consts:[[1,"lineBottom","ticket-header"],[1,"encabezado-flex"],["alt","Logo","loading","eager","decoding","sync",1,"logo","logo-ticket",3,"load","error","src"],[1,"titulos"],[1,"titulo1"],[1,"titulo2"],[1,"datos-farmacia",2,"font-size","16px"],[4,"ngIf"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"img",2),w("load",function(){return n.onLogoLoad()})("error",function(a){return n.onLogoError(a)}),s(),l(3,"div",3)(4,"div",4),d(5),s(),l(6,"div",5),d(7),s()()(),l(8,"div",6),d(9),y(10,"br"),d(11),y(12,"br"),N(13,ax,2,1,"ng-container",7),s()()),e&2&&(c(2),p("src",n.safeLogoSrc,mr),c(3),T(n.titulo1),c(2),T(n.titulo2),c(2),R(" Sucursal: ",n.nombreFarmacia,""),c(2),R(" ",n.direccion,""),c(2),p("ngIf",n.telefono&&n.telefono.trim()))},dependencies:[Oe,Ne],styles:[".encabezado-flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]{width:40px;height:auto}.logo-ticket[_ngcontent-%COMP%]{display:block;width:40px;height:auto}.titulos[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.titulo1[_ngcontent-%COMP%], .titulo2[_ngcontent-%COMP%]{line-height:1.1}.title-line[_ngcontent-%COMP%]{font-size:large}.datos-farmacia[_ngcontent-%COMP%]{font-size:16px;line-height:1.3;margin-top:4px;text-align:center}"]})};var tr=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-ticket-footer"]],decls:5,vars:0,consts:[[1,"mensaje-final",2,"font-style","oblique","font-size","18px"]],template:function(e,n){e&1&&(l(0,"div",0),d(1," \xA1Gracias por su preferencia!"),y(2,"br"),d(3," Bienestar para todos"),y(4,"br"),s())},styles:[".mensaje-final[_ngcontent-%COMP%]{text-align:center;margin-top:10px;font-weight:700}"]})};function ox(i,t){if(i&1&&(l(0,"td",24),d(1),s()),i&2){let e=_().$implicit;c(),R("Desc. ",e.cadenaDescuento,"")}}function sx(i,t){if(i&1&&(l(0,"td",25)(1,"strong"),d(2),F(3,"number"),s()()),i&2){let e=_().$implicit;c(2),R("$",Q(3,1,e.descuento,"1.2-2"),"")}}function lx(i,t){if(i&1&&(Ze(0,17),l(1,"tr")(2,"td",7)(3,"span",18),d(4),s()()(),l(5,"tr")(6,"td"),d(7),F(8,"number"),s(),l(9,"td"),d(10),s(),l(11,"td",19)(12,"span",20),d(13),s()(),l(14,"td",21),d(15),F(16,"number"),s()(),l(17,"tr"),N(18,ox,2,1,"td",22)(19,sx,4,4,"td",23),s(),et()),i&2){let e=t.$implicit;c(4),R(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),c(3),R("$",Q(8,7,e.precioOriginal,"1.2-2"),""),c(3),T(e.cantidad),c(3),R(" ",e.descuento>0?e.tipoDescuento:""," "),c(2),R("$",Q(16,10,e.precioOriginal*e.cantidad,"1.2-2"),""),c(3),p("ngIf",e.cadenaDescuento!=""),c(),p("ngIf",e.descuento>0)}}function cx(i,t){if(i&1&&(l(0,"div",26),d(1,"Felicidades!!! usted us\xF3 su monedero: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.venta.formaPago.vale,"1.2-2"),"")}}function dx(i,t){if(i&1&&(l(0,"div"),d(1,"Usted ahorr\xF3: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.venta.totalDescuento,"1.2-2"),"")}}function ux(i,t){if(i&1&&(l(0,"div"),d(1,"Abon\xF3 a su monedero: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.venta.totalMonederoCliente,"1.2-2"),"")}}function mx(i,t){if(i&1&&(l(0,"div"),d(1,"Su monedero ahora cuenta con: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.venta.AsiQuedaMonedero,"1.2-2"),"")}}var ml=class i{venta;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-venta-ticket"]],inputs:{venta:"venta"},decls:53,vars:22,consts:[["id","ticketVenta",1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"farmacia"],[1,"productos","lineBottom"],[1,"col-unit"],[1,"col-cant"],[1,"col-promo"],[1,"col-importe"],["colspan","4"],[1,"lineBottom"],[1,"th-promo"],["style","font-size: 16px;",4,"ngFor","ngForOf"],[1,"totales-line","lineBottom"],[1,"totales"],["class","text-right",4,"ngIf"],[4,"ngIf"],[1,"info-general","lineBottom"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"producto-nombre"],[1,"promo-cell"],[1,"promo-value"],[1,"importe-cell"],["colspan","3",4,"ngIf"],["colspan","1","class","text-right",4,"ngIf"],["colspan","3"],["colspan","1",1,"text-right"],[1,"text-right"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"table",2)(3,"colgroup"),y(4,"col",3)(5,"col",4)(6,"col",5)(7,"col",6),s(),l(8,"thead")(9,"tr")(10,"th",7),d(11,"PRODUCTO"),s()(),l(12,"tr",8)(13,"th"),d(14,"P.U."),s(),l(15,"th"),d(16,"CAN"),s(),l(17,"th",9),d(18,"PROMO"),s(),l(19,"th"),d(20,"IMPORTE"),s()()(),l(21,"tbody"),N(22,lx,20,13,"ng-container",10),s()(),l(23,"div",11)(24,"div"),d(25,"Cantidad de productos: "),l(26,"strong"),d(27),s()(),l(28,"div"),d(29,"Total: "),l(30,"strong"),d(31),F(32,"number"),s()()(),l(33,"div",12)(34,"div"),d(35,"Cambio: "),l(36,"strong"),d(37),F(38,"number"),s()(),N(39,cx,5,4,"div",13)(40,dx,5,4,"div",14)(41,ux,5,4,"div",14)(42,mx,5,4,"div",14),s(),l(43,"div",15)(44,"div",16),d(45),s(),d(46),F(47,"date"),y(48,"br"),d(49),y(50,"br"),d(51),s(),y(52,"app-ticket-footer"),s()),e&2&&(c(),p("farmacia",n.venta.farmacia),c(21),p("ngForOf",n.venta.productos),c(5),T(n.venta.cantidadProductos),c(4),R("$",Q(32,13,n.venta.total,"1.2-2"),""),c(6),R("$",Q(38,16,n.venta.elcambio,"1.2-2"),""),c(2),p("ngIf",n.venta.formaPago.vale),c(),p("ngIf",n.venta.totalDescuento>0),c(),p("ngIf",n.venta.totalMonederoCliente>0&&n.venta.cliente),c(),p("ngIf",n.venta.AsiQuedaMonedero>0&&n.venta.cliente),c(3),R("Folio: ",n.venta.folio,""),c(),R(" Fecha: ",Q(47,19,n.venta.fecha,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",n.venta.usuario,""),c(2),R(" Cliente: ",n.venta.cliente||"P\xFAblico general"," "))},dependencies:[Oe,We,Ne,wt,Nt,er,tr],styles:[".totales[_ngcontent-%COMP%]{font-size:17px!important;line-height:1.5}.totales[_ngcontent-%COMP%]{text-align:end}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}.productos[_ngcontent-%COMP%]{width:100%;table-layout:fixed;border-collapse:collapse}.productos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1px 0;font-size:17px}.col-unit[_ngcontent-%COMP%]{width:24%}.col-cant[_ngcontent-%COMP%]{width:12%}.col-promo[_ngcontent-%COMP%]{width:36%}.col-importe[_ngcontent-%COMP%]{width:28%}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){text-align:left}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){text-align:left}.promo-cell[_ngcontent-%COMP%]{text-align:right;padding-right:0}.importe-cell[_ngcontent-%COMP%]{text-align:right;padding-left:0}.th-promo[_ngcontent-%COMP%]{text-align:right}.promo-value[_ngcontent-%COMP%]{display:inline-block;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:clip;font-size:16px;letter-spacing:-.2px}.totales-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;font-size:17px;margin-top:2px}.text-right[_ngcontent-%COMP%]{text-align:right!important}"]})};var lp={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var gx=["panel"],_x=["*"];function vx(i,t){if(i&1&&(l(0,"div",1,0),Am(2),s()),i&2){let e=t.id,n=_();Vs(n._classList),Be("mat-mdc-autocomplete-visible",n.showPanel)("mat-mdc-autocomplete-hidden",!n.showPanel)("mat-autocomplete-panel-animations-enabled",!n._animationsDisabled)("mat-primary",n._color==="primary")("mat-accent",n._color==="accent")("mat-warn",n._color==="warn"),p("id",n.id),Ye("aria-label",n.ariaLabel||null)("aria-labelledby",n._getPanelAriaLabelledby(e))}}var T0=class{source;option;constructor(t,e){this.source=t,this.option=e}},up=new wr("mat-autocomplete-default-options",{providedIn:"root",factory:xx});function xx(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1}}var fl=(()=>{class i{_changeDetectorRef=je(Dt);_elementRef=je(Oo);_defaults=je(up);_animationsDisabled=je(Do,{optional:!0})==="NoopAnimations";_activeOptionChanges=qn.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new zt;opened=new zt;closed=new zt;optionActivated=new zt;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=je(kf).getId("mat-autocomplete-");inertGroups;constructor(){let e=je(Ef);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new If(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let n=new T0(this,e);this.optionSelected.emit(n)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let n=e?e+" ":"";return this.ariaLabelledby?n+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Te({type:i,selectors:[["mat-autocomplete"]],contentQueries:function(n,r,a){if(n&1&&(x0(a,Ra,5),x0(a,Ff,5)),n&2){let o;bt(o=yt())&&(r.options=o),bt(o=yt())&&(r.optionGroups=o)}},viewQuery:function(n,r){if(n&1&&(Tt(_0,7),Tt(gx,5)),n&2){let a;bt(a=yt())&&(r.template=a.first),bt(a=yt())&&(r.panel=a.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",fr],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",fr],requireSelection:[2,"requireSelection","requireSelection",fr],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",fr],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",fr]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[Jr([{provide:Mf,useExisting:i}])],ngContentSelectors:_x,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(n,r){n&1&&(Fm(),N(0,vx,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return i})();var bx={provide:Wm,useExisting:Tm(()=>ea),multi:!0};var mp=new wr("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let i=je(Na);return()=>i.scrollStrategies.reposition()}});function yx(i){return()=>i.scrollStrategies.reposition()}var Cx={provide:mp,deps:[Na],useFactory:yx},ea=(()=>{class i{_environmentInjector=je(Pm);_element=je(Oo);_overlay=je(Na);_viewContainerRef=je(Bs);_zone=je(bn);_changeDetectorRef=je(Dt);_dir=je(Zs,{optional:!0});_formField=je(Uf,{optional:!0,host:!0});_viewportRuler=je(el);_scrollStrategy=je(mp);_renderer=je(Pa);_defaults=je(up,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new St;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=qn.EMPTY;_breakpointObserver=je(y0);_handsetLandscapeSubscription=qn.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new St;_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&Js(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Xr(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Kr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Kr(()=>this._overlayAttached)):gt()).pipe(xt(e=>e instanceof Af?e:null))}optionSelections=ym(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(Yr(e),Ui(()=>Xr(...e.map(n=>n.onSelectionChange)))):this._initialized.pipe(Ui(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new Xn(e=>{let n=a=>{let o=Zr(a),u=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,m=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&o!==this._element.nativeElement&&!this._hasFocus()&&(!u||!u.contains(o))&&(!m||!m.contains(o))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(o)&&e.next(a)},r=[this._renderer.listen("document","click",n),this._renderer.listen("document","auxclick",n),this._renderer.listen("document","touchend",n)];return()=>{r.forEach(a=>a())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let n=e.keyCode,r=Qs(e);if(n===27&&!r&&e.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&n===13&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){let a=this.autocomplete._keyManager.activeItem,o=n===38||n===40;n===9||o&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):o&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(o||this.autocomplete._keyManager.activeItem!==a)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let n=e.target,r=n.value;if(n.type==="number"&&(r=r==""?null:parseFloat(r)),this._previousValue!==r){if(this._previousValue=r,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(r),!r)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let a=this.autocomplete.options?.find(o=>o.selected);if(a){let o=this._getDisplayValue(a.value);r!==o&&a.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let a=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(a)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return wf()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new Xn(r=>{Ns(()=>{r.next()},{injector:this._environmentInjector})}),n=this.autocomplete.options?.changes.pipe(Rn(()=>this._positionStrategy.reapplyLastPosition()),wm(0))??gt();return Xr(e,n).pipe(Ui(()=>this._zone.run(()=>{let r=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),r!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),Ds(1)).subscribe(r=>this._setValueAndClose(r))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let n=this.autocomplete;return n&&n.displayWith?n.displayWith(e):e}_assignOptionValue(e){let n=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(n??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let n=this.autocomplete,r=e?e.source:this._pendingAutoselectedOption;r?(this._clearPreviousSelectedOption(r),this._assignOptionValue(r.value),this._onChange(r.value),n._emitSelectEvent(r),this._element.nativeElement.focus()):n.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,n){this.autocomplete?.options?.forEach(r=>{r!==e&&r.selected&&r.deselect(n)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let n=this.autocomplete.id;C0(this._trackedModal,"aria-owns",n)}}_attachOverlay(e){this.autocomplete;let n=this._overlayRef;n?(this._positionStrategy.setOrigin(this._getConnectedElement()),n.updateSize({width:this._getPanelWidth()})):(this._portal=new Nf(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),n=this._overlay.create(this._getOverlayConfig()),this._overlayRef=n,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&n&&n.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(lp.HandsetLandscape).subscribe(a=>{a.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),n&&!n.hasAttached()&&(n.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let r=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&r!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!Qs(e)||e.keyCode===38&&Qs(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new Bf({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){let e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let n=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,a=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}],o;this.position==="above"?o=a:this.position==="below"?o=n:o=[...n,...a],e.withPositions(o)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let n=-1;for(let r=0;r<e.options.length;r++)if(!e.options.get(r).disabled){n=r;break}e._keyManager.setActiveItem(n)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let n=this.autocomplete,r=Of(e,n.options,n.optionGroups);if(e===0&&r===1)n._setScrollTop(0);else if(n.panel){let a=n.options.toArray()[e];if(a){let o=a._getHostElement(),u=Df(o.offsetTop,o.offsetHeight,n._getScrollTop(),n.panel.nativeElement.offsetHeight);n._setScrollTop(u)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let n=this.autocomplete.id;this._trackedModal&&Js(this._trackedModal,"aria-owns",n),C0(e,"aria-owns",n),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;Js(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ls({type:i,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(n,r){n&1&&w("focusin",function(){return r._handleFocus()})("blur",function(){return r._onTouched()})("input",function(o){return r._handleInput(o)})("keydown",function(o){return r._handleKeydown(o)})("click",function(){return r._handleClick()}),n&2&&Ye("autocomplete",r.autocompleteAttribute)("role",r.autocompleteDisabled?null:"combobox")("aria-autocomplete",r.autocompleteDisabled?null:"list")("aria-activedescendant",r.panelOpen&&r.activeOption?r.activeOption.id:null)("aria-expanded",r.autocompleteDisabled?null:r.panelOpen.toString())("aria-controls",r.autocompleteDisabled||!r.panelOpen||r.autocomplete==null?null:r.autocomplete.id)("aria-haspopup",r.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",fr]},exportAs:["matAutocompleteTrigger"],features:[Jr([bx]),Er]})}return i})(),ja=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=No({type:i});static \u0275inj=Ao({providers:[Cx],imports:[Lf,w0,S0,tl,w0,S0]})}return i})();var xi=hi(ki());function pp(i,t,e){try{i(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{try{window.print()}finally{t(),e?.()}},0)})})}catch{t(),e?.()}}function ta(){return Ae(this,null,function*(){yield new Promise(i=>requestAnimationFrame(()=>requestAnimationFrame(()=>i())))})}function Sx(){try{return typeof window<"u"&&window.location?.origin?window.location.origin:""}catch{return""}}function Fr(i){let t=Sx();if(!i||!i.trim())return`${t}/assets/images/farmBienIcon.png`;if(/^(data:|blob:|https?:)/i.test(i))return i;let e=i.replace(/^\/+/,"");return e.startsWith("assets/")?`${t}/${e}`:e.startsWith("browser/assets/")?`${t}/${e.replace(/^browser\//,"")}`:`${t}/assets/images/${e}`}function Wa(i,t=9e3){return Ae(this,null,function*(){let e=document.createElement("div");e.id="__print_portal__",e.setAttribute("data-print","1"),e.style=`
    all: initial;
    position: fixed;
    inset: 0;
    background: #fff;
    z-index: 2147483647;
    display: block;
  `;let n=i.cloneNode(!0);n.id="ticketPedido",n.style.position="absolute",n.style.left="0",n.style.top="0",e.appendChild(n),document.body.appendChild(e),yield ta(),yield new Promise(r=>{let a=!1,o=()=>{if(!a){a=!0;try{document.body.removeChild(e)}catch{}window.removeEventListener("afterprint",o),u?.removeEventListener?.("change",m),f&&clearTimeout(f),r()}},u="matchMedia"in window?window.matchMedia("print"):null,m=h=>{h.matches||o()};window.addEventListener("afterprint",o),u?.addEventListener?.("change",m);let f=window.setTimeout(o,t);try{window.print()}catch{o()}})})}function Ar(i,t=2500){return Ae(this,null,function*(){try{return!i||i.startsWith("data:")?i||"":(yield new Promise(e=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>e(),n.onerror=()=>e(),n.src=i,setTimeout(e,t)}),yield new Promise(e=>{try{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{let r=document.createElement("canvas");r.width=n.naturalWidth||64,r.height=n.naturalHeight||64,r.getContext("2d").drawImage(n,0,0),e(r.toDataURL("image/png"))}catch{e(i)}},n.onerror=()=>e(i),n.src=i}catch{e(i)}}))}catch{return i}})}var pl=class i{constructor(t){this.http=t}apiUrl=`${He.apiUrl}/ventas`;crearVenta(t){let e=localStorage.getItem("auth_token"),n=new Qe({"Content-Type":"application/json","x-auth-token":e||""});return this.http.post(`${this.apiUrl}`,t,{headers:n})}obtenerHistorialCompras(t,e){let n=localStorage.getItem("auth_token");if(!n)return console.error("\u274C No hay token disponible."),new Xn(a=>a.next([]));let r=new Qe({"x-auth-token":n});return this.http.get(`${this.apiUrl}/historial/${t}/${e}`,{headers:r})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ji=class i{constructor(t){this.http=t}apiUrl=`${He.apiUrl}/productos`;imgCache=new Map;crearProducto(t){return this.http.post(`${He.apiUrl}/productos`,t)}buscarPorCodigoBarras(t){let e=localStorage.getItem("auth_token")||"",n=new Qe({"x-auth-token":e}),r=new Ht().set("codigoBarras",t);return this.http.get(`${this.apiUrl}/buscar-por-cb`,{params:r,headers:n})}obtenerProductos(){return this.http.get(`${this.apiUrl}`)}consultarPrecioPorCodigo(t,e){return this.http.get(`${this.apiUrl}/precio/${t}/${e}`)}existenciaPorId(t){return this.http.get(`${this.apiUrl}/ver-existencia/${t}`)}existenciaPorFarmaciaYProducto(t,e){return this.http.get(`${this.apiUrl}/inventario/${t}/${e}`)}actualizarProductos(t){return this.http.put(`${this.apiUrl}/actualizar-masivo`,t)}actualizarProductoIndividual(t,e){return this.http.put(`${this.apiUrl}/actualizar-producto/${t}`,e)}obtenerProductoPorId(t){return this.http.get(`${this.apiUrl}/${t}`)}buscar(t,e=12){let n=new Ht().set("q",t).set("limit",e);return this.http.get(`${this.apiUrl}/search`,{params:n})}eliminarProducto(t){return this.http.delete(`${this.apiUrl}/${t}`)}actualizarImagenProducto(t,e){let n=new FormData;return n.append("imagen",e),this.http.put(`${this.apiUrl}/${t}/imagen`,n)}obtenerImagenProductoUrl(t){return`${this.apiUrl}/${t}/imagen`}getPublicImageUrl(t){if(!t)return"";if(/^https?:\/\//i.test(t))return t;let e=He.apiUrl,n=new URL(e,window.location.origin).origin,r=String(t).replace(/^\/+/,"");return`${n}/${r}`}farmIconFallback(){let t=He.apiUrl;return`${new URL(t,window.location.origin).origin}/browser/assets/images/farmBienIcon.png`}getImagenObjectUrl(t){return this.http.get(`${this.apiUrl}/${t}/imagen`,{responseType:"blob"}).pipe(xt(e=>URL.createObjectURL(e)),Pi(()=>gt("")))}clearImagenFromCache(t){let e=this.imgCache.get(t);e&&(URL.revokeObjectURL(e),this.imgCache.delete(t))}ngOnDestroy(){for(let[,t]of this.imgCache)URL.revokeObjectURL(t);this.imgCache.clear()}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var $a=class i{clavePausadas="ventas_pausadas";setVentasPausadas(t){localStorage.setItem(this.clavePausadas,JSON.stringify(t))}getVentasPausadas(){let t=localStorage.getItem(this.clavePausadas);return t?JSON.parse(t):[]}limpiarVentasPausadas(){localStorage.removeItem(this.clavePausadas)}existenVentasPausadas(){return this.getVentasPausadas().length>0}static \u0275fac=function(e){return new(e||i)};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var Tx=["codigoBarrasRef"],Px=["efectivoRecibidoRef"],kx=["cliTrigger"];function Ix(i,t){if(i&1&&(l(0,"option",64),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e),c(),R("",e,"\xD7")}}function Mx(i,t){if(i&1&&(l(0,"small"),d(1),s()),i&2){let e=_().$implicit;c(),R(" \u2014 ",e.telefono,"")}}function Fx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),N(2,Mx,2,1,"small",21),s()),i&2){let e=t.$implicit;p("value",e),c(),R(" ",e.nombre," "),c(),p("ngIf",e.telefono)}}function Ax(i,t){i&1&&(l(0,"mat-option"),d(1," Sin coincidencias "),s())}function Ox(i,t){if(i&1&&y(0,"option",65),i&2){let e=t.$implicit;p("value",e.nombre+(e.telefono?" \u2014 "+e.telefono:""))}}function Dx(i,t){if(i&1){let e=ae();l(0,"button",66),w("click",function(){P(e);let r=_();return k(r.limpiarCliente())}),y(1,"fa-icon",67),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Rx(i,t){if(i&1&&(l(0,"span",68),d(1),s()),i&2){let e=_();c(),T(e.nombreCliente)}}function Nx(i,t){if(i&1){let e=ae();l(0,"div",16)(1,"input",69),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.aplicaInapam,r)||(a.aplicaInapam=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return r.yaPreguntoInapam=!0,k(r.VerSiPreguntaINAPAM())}),s(),l(2,"label",70),d(3,"Presenta cred. INAPAM"),s()()}if(i&2){let e=_();c(),J("ngModel",e.aplicaInapam)}}function Bx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),un(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function Lx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),R(" ",e.nombre," ")}}function Vx(i,t){if(i&1&&(l(0,"div",82)(1,"strong"),d(2,"Ubicaci\xF3n:"),s(),l(3,"div"),d(4),s()()),i&2){let e=_(3);c(4),R(" ",e.productoConsultado.ubicacionEnFarmacia," ")}}function Ux(i,t){if(i&1){let e=ae();l(0,"div",78)(1,"div",79)(2,"img",80),w("error",function(){P(e);let r=_(2);return k(r.consultaImgUrl=r.placeholderSrc)}),s()(),N(3,Vx,5,1,"div",81),s()}if(i&2){let e=_(2);c(2),p("src",e.consultaImgUrl,mr),c(),p("ngIf",e.productoConsultado)}}function jx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e.codigoBarras),c(),un(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function Wx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e.codigoBarras),c(),R(" ",e.nombre," ")}}function Hx(i,t){if(i&1){let e=ae();l(0,"div")(1,"mat-form-field",83)(2,"input",84),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.busquedaConsultaCodigo,r)||(a.busquedaConsultaCodigo=r),k(r)}),w("input",function(){P(e);let r=_(2);return k(r.filtrarConsultaPorCodigo())}),s(),l(3,"mat-autocomplete",85,5),w("optionSelected",function(r){P(e);let a=_(2);return k(a.onSelectConsultaCodigo(r))}),N(5,jx,2,3,"mat-option",20),s()(),l(6,"mat-form-field",83)(7,"input",86),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.busquedaConsultaNombre,r)||(a.busquedaConsultaNombre=r),k(r)}),w("input",function(){P(e);let r=_(2);return k(r.filtrarConsultaPorNombre())}),s(),l(8,"mat-autocomplete",85,6),w("optionSelected",function(r){P(e);let a=_(2);return k(a.onSelectConsultaNombre(r))}),N(10,Wx,2,2,"mat-option",20),s()()()}if(i&2){let e=Gt(4),n=Gt(9),r=_(2);c(2),J("ngModel",r.busquedaConsultaCodigo),p("matAutocomplete",e),c(3),p("ngForOf",r.productosConsultaFiltradosPorCodigo),c(2),J("ngModel",r.busquedaConsultaNombre),p("matAutocomplete",n),c(3),p("ngForOf",r.productosConsultaFiltradosPorNombre)}}function $x(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo1),c(),T(e.productoConsultado.precioLunes)}}function zx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.lunesMasInapam)}}function Gx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo2),c(),T(e.productoConsultado.precioMartes)}}function qx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.martesMasInapam)}}function Xx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo3),c(),T(e.productoConsultado.precioMiercoles)}}function Kx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.miercolesMasInapam)}}function Yx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo4),c(),T(e.productoConsultado.precioJueves)}}function Qx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.juevesMasInapam)}}function Jx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo5),c(),T(e.productoConsultado.precioViernes)}}function Zx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.viernesMasInapam)}}function e2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo6),c(),T(e.productoConsultado.precioSabado)}}function t2(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.sabadoMasInapam)}}function i2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),T(e.productoConsultado.promo0),c(),T(e.productoConsultado.precioDomingo)}}function n2(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.domingoMasInapam)}}function r2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Promo: "),s(),d(3),s()),i&2){let e=_(3);c(3),T(e.productoConsultado.promo)}}function a2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio c/promo: "),s(),d(3),s()),i&2){let e=_(3);c(3),T(e.productoConsultado.precioConDescuento)}}function o2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio promo + inapam: "),s(),d(3),s()),i&2){let e=_(3);c(3),T(e.productoConsultado.precioDescuentoMasInapam)}}function s2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio Inapam: "),s(),d(3),s()),i&2){let e=_(3);c(3),R("",e.productoConsultado.precioInapam," ")}}function l2(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),T(e.productoConsultado.promoCliente)}}function c2(i,t){if(i&1&&(l(0,"div")(1,"p")(2,"strong"),d(3,"Nombre: "),s(),d(4),s(),l(5,"p")(6,"strong"),d(7,"Precio Normal:"),s(),d(8),F(9,"currency"),s(),N(10,$x,4,2,"p",21)(11,zx,2,1,"p",21)(12,Gx,4,2,"p",21)(13,qx,2,1,"p",21)(14,Xx,4,2,"p",21)(15,Kx,2,1,"p",21)(16,Yx,4,2,"p",21)(17,Qx,2,1,"p",21)(18,Jx,4,2,"p",21)(19,Zx,2,1,"p",21)(20,e2,4,2,"p",21)(21,t2,2,1,"p",21)(22,i2,4,2,"p",21)(23,n2,2,1,"p",21)(24,r2,4,1,"p",21)(25,a2,4,1,"p",21)(26,o2,4,1,"p",21)(27,s2,4,1,"p",21)(28,l2,2,1,"p",21),s()),i&2){let e=_(2);c(4),T(e.productoConsultado.nombre),c(4),R(" ",se(9,21,e.productoConsultado.precioNormal),""),c(2),p("ngIf",e.productoConsultado.promo1),c(),p("ngIf",e.productoConsultado.lunesMasInapam),c(),p("ngIf",e.productoConsultado.promo2),c(),p("ngIf",e.productoConsultado.martesMasInapam),c(),p("ngIf",e.productoConsultado.promo3),c(),p("ngIf",e.productoConsultado.miercolesMasInapam),c(),p("ngIf",e.productoConsultado.promo4),c(),p("ngIf",e.productoConsultado.juevesMasInapam),c(),p("ngIf",e.productoConsultado.promo5),c(),p("ngIf",e.productoConsultado.viernesMasInapam),c(),p("ngIf",e.productoConsultado.promo6),c(),p("ngIf",e.productoConsultado.sabadoMasInapam),c(),p("ngIf",e.productoConsultado.promo0),c(),p("ngIf",e.productoConsultado.domingoMasInapam),c(),p("ngIf",e.productoConsultado.promo),c(),p("ngIf",e.productoConsultado.precioConDescuento),c(),p("ngIf",e.productoConsultado.precioDescuentoMasInapam),c(),p("ngIf",e.productoConsultado.precioInapam),c(),p("ngIf",e.productoConsultado.promoCliente)}}function d2(i,t){if(i&1){let e=ae();l(0,"div",71)(1,"div",72)(2,"h2"),d(3,"Consultar Precio"),s(),l(4,"div",73)(5,"input",74),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.codigoConsulta,r)||(a.codigoConsulta=r),k(r)}),w("keyup.enter",function(){P(e);let r=_();return k(r.consultarPrecio())}),s(),l(6,"button",75),w("click",function(){P(e);let r=_();return k(r.limpiarBarras())}),y(7,"fa-icon",67),s()(),N(8,Ux,4,2,"div",76)(9,Hx,11,6,"div",21)(10,c2,29,23,"div",21),l(11,"button",77),w("click",function(){P(e);let r=_();return k(r.cerrarModalConsultaPrecio())}),d(12,"Cerrar"),s()()()}if(i&2){let e=_();c(5),J("ngModel",e.codigoConsulta),c(2),p("icon",e.faTimes),c(),p("ngIf",e.consultaEncontrado),c(),p("ngIf",!e.consultaEncontrado),c(),p("ngIf",e.productoConsultado)}}function u2(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td",44)(2,"div",87)(3,"button",88),w("click",function(){let r=P(e).index,a=_();return k(a.eliminarProducto(r))}),y(4,"i",40),s(),l(5,"button",89),w("click",function(){let r=P(e).index,a=_();return k(a.incrementarCantidad(r))}),y(6,"i",90),s(),l(7,"button",91),w("click",function(){let r=P(e).index,a=_();return k(a.decrementarCantidad(r))}),y(8,"i",92),s()()(),l(9,"td",45)(10,"div",93)(11,"button",94),w("click",function(){let r=P(e).$implicit,a=_();return k(a.openPreviewVenta(r))}),l(12,"img",95),w("error",function(r){let a=P(e).$implicit,o=_();return k(o.onThumbError(r,a))}),s()()()(),l(13,"td",46)(14,"div",96),d(15),s(),l(16,"small",97),d(17),s()(),l(18,"td"),d(19),s(),l(20,"td"),d(21),F(22,"currency"),s(),l(23,"td"),d(24),F(25,"currency"),s(),l(26,"td"),d(27),s(),l(28,"td"),d(29),s(),l(30,"td"),d(31),F(32,"currency"),s(),l(33,"td"),d(34),F(35,"currency"),s(),l(36,"td"),d(37),F(38,"currency"),s()()}if(i&2){let e=t.$implicit,n=_();c(3),Be("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(2),Be("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(2),Be("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(5),p("src",n.thumbs[e.producto]||n.placeholderSrc,mr),c(3),T(e.nombre),c(2),T(e.ubicacionEnFarmacia),c(2),T(e.cantidad),c(2),T(se(22,20,e.precioOriginal)),c(3),T(se(25,22,e.precioOriginal*e.cantidad)),c(3),T(e.tipoDescuento!=="Ninguno"?e.tipoDescuento:"-"),c(2),T(e.cadDesc),c(2),T(se(32,24,e.alMonedero*e.cantidad)),c(3),T(se(35,26,e.descuentoUnitario*e.cantidad)),c(3),T(se(38,28,e.precioFinal*e.cantidad))}}function m2(i,t){if(i&1){let e=ae();l(0,"div",98)(1,"button",99),w("click",function(){P(e);let r=_();return k(r.pausarVenta())}),d(2,"Pausar Venta"),s(),l(3,"button",100),w("click",function(){P(e);let r=_();return k(r.cancelarVenta())}),d(4,"Cancelar Venta"),s(),l(5,"button",101),w("click",function(){P(e);let r=_();return k(r.abrirModalPago())}),d(6,"Finalizar Venta"),s()()}}function f2(i,t){if(i&1){let e=ae();l(0,"button",104),w("click",function(){let r=P(e).index,a=_(2);return k(a.reanudarVenta(r))}),d(1),s()}if(i&2){let e=t.$implicit;c(),R(" ",e.captionButtomReanudar," ")}}function p2(i,t){if(i&1&&(l(0,"div",102)(1,"h2",34),d(2,"Ventas Pausadas"),s(),N(3,f2,2,1,"button",103),s()),i&2){let e=_();c(3),p("ngForOf",e.ventasPausadas)}}function h2(i,t){if(i&1&&(l(0,"div",110)(1,"label",135),d(2,"Monto monedero usado:"),s(),l(3,"div",136)(4,"span",137),d(5),F(6,"currency"),s()()()),i&2){let e=_(3);c(5),R(" ",se(6,1,e.montoVale)," ")}}function g2(i,t){if(i&1){let e=ae();l(0,"div",127)(1,"div",110)(2,"label",128),d(3),F(4,"currency"),s()(),l(5,"div",110)(6,"div",129)(7,"label",130),d(8,"Usar monedero:"),s()(),l(9,"div",131)(10,"input",132),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.usarMonedero,r)||(a.usarMonedero=r),k(r)}),w("ngModelChange",function(){P(e);let r=_(2);return k(r.onToggleMonedero())}),s(),l(11,"label",133),d(12,"S\xED"),s()()(),N(13,h2,7,3,"div",134),s()}if(i&2){let e=_(2);c(3),R(" Tiene en monedero: ",se(4,3,e.montoMonederoCliente)," "),c(7),J("ngModel",e.usarMonedero),c(3),p("ngIf",e.usarMonedero)}}function _2(i,t){i&1&&(l(0,"p",138),d(1," A\xFAn falta cubrir el total de la venta. "),s())}function v2(i,t){i&1&&(l(0,"p",139),d(1," El total de la venta ha sido cubierto. "),s())}function x2(i,t){if(i&1){let e=ae();l(0,"button",140),w("click",function(){P(e);let r=_(2);return k(r.habilitarInputs())}),y(1,"i",141),d(2," Habilitar pagos "),s()}}function b2(i,t){if(i&1){let e=ae();l(0,"div",71)(1,"div",105)(2,"div",106)(3,"h5",107),d(4,"M\xE9todo de Pago"),s()(),l(5,"div",108)(6,"p",109),d(7,"Total a pagar: "),l(8,"strong"),d(9),F(10,"currency"),s()(),l(11,"div",110)(12,"label",111),d(13,"Efectivo:"),s(),l(14,"div",112)(15,"input",113,7),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.efectivoRecibido,r)||(a.efectivoRecibido=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return k(r.calculaCambio())}),s()()(),l(17,"div",110)(18,"label",114),d(19,"Tarjeta:"),s(),l(20,"div",112)(21,"input",115),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.montoTarjeta,r)||(a.montoTarjeta=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return k(r.pagoTarjeta())}),s()()(),l(22,"div",110)(23,"label",116),d(24,"Transferencia:"),s(),l(25,"div",112)(26,"input",117),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.montoTransferencia,r)||(a.montoTransferencia=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return k(r.pagoTransferencia())}),s()()(),N(27,g2,14,5,"div",118),l(28,"p",119),d(29,"Cambio: "),l(30,"strong"),d(31),F(32,"currency"),s()(),N(33,_2,2,0,"p",120)(34,v2,2,0,"p",121),s(),l(35,"div",122)(36,"button",123),w("click",function(){P(e);let r=_();return k(r.cancelarPago())}),d(37,"Cancelar"),s(),l(38,"button",124),d(39," Imprimir "),s()(),l(40,"div",125),N(41,x2,3,0,"button",126),s()()()}if(i&2){let e=_();c(9),T(se(10,19,e.total)),c(6),J("ngModel",e.efectivoRecibido),p("min",0)("disabled",e.ocultarEfectivo),Ye("autofocus",!0),c(6),J("ngModel",e.montoTarjeta),p("min",0)("max",e.total-e.pagoTransferencia1-e.pagoVale1)("disabled",e.ocultaTarjeta),c(5),J("ngModel",e.montoTransferencia),p("min",0)("max",e.total-e.pagoTarjeta1-e.pagoVale1)("disabled",e.ocultaTransferencia),c(),p("ngIf",e.montoMonederoCliente>0),c(4),T(se(32,21,e.cambio)),c(2),p("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),c(),p("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1>=e.total),c(4),p("disabled",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),c(3),p("ngIf",e.inputsHabilitados)}}function y2(i,t){if(i&1&&(l(0,"div",142),y(1,"app-venta-ticket",143),s()),i&2){let e=t.ngIf;c(),p("venta",e)}}var hl=class i{constructor(t,e,n,r,a,o,u,m){this.fb=t;this.ventasService=e;this.productoService=n;this.clienteService=r;this.ventaService=a;this.farmaciaService=o;this.cdRef=u;this.ngZone=m;this.ventaForm=this.fb.group({cliente:[""],producto:[""],cantidad:[1]})}codigoBarrasRef;efectivoRecibidoRef;cliTrigger;opcionesClientes=[];pendingFocusEfectivo=!1;barcodeFocusTimer=null;telefonoCliente="";nombreCliente="";cliente="";montoMonederoCliente=0;usarMonedero=!1;hayProducto=!1;ventaForm;carrito=[];precioEnFarmacia=0;ubicacionEnFarmacia="";total=0;totalArticulos=0;totalDescuento=0;totalAlmonedero=0;ventasPausadas=[];captionButtomReanudar="";efectivoRecibido=null;montoTarjeta=null;montoTransferencia=null;montoVale=null;cambio=0;inputsHabilitados=!1;tipoDescuento="";cadDesc="";ptjeDescuento=0;alMonedero=0;productoAplicaMonedero=!1;hayCliente=!1;aplicaGratis=!1;ocultarEfectivo=!1;ocultaTarjeta=!1;ocultaTransferencia=!1;ocultaVale=!1;mostrarModalPago=!1;codigoBarras="";busquedaProducto="";busquedaPorCodigo="";productosFiltrados=[];productosFiltradosPorCodigo=[];productos=[];clientes=[];farmaciaId="";farmaciaNombre="";farmaciaTitulo1="";farmaciaTitulo2="";farmaciaImagen="";farmaciaDireccion="";farmaciaTelefono="";nombreUs="";mostrarModalConsultaPrecio=!1;codigoConsulta="";productoConsultado=null;busquedaConsultaCodigo="";busquedaConsultaNombre="";productosConsultaFiltradosPorCodigo=[];productosConsultaFiltradosPorNombre=[];aplicaInapam=!1;yaPreguntoInapam=!1;fechaIni=new Date;fechaFin=new Date;faTimes=vi;ventaParaImpresion=null;mostrarTicket=!1;folioVentaGenerado=null;venta=null;ventaEnProceso=!1;clienteNombreCtrl=new zs({value:"",disabled:!1});filteredClientes$=gt([]);placeholderSrc="assets/images/farmBienIcon.png";thumbs={};consultaEncontrado=!1;consultaImgUrl=this.placeholderSrc;thumbScale=2;scales=[1,1.5,2,2.5,3,3.5,4];onScaleChange(t){this.thumbScale=t,localStorage.setItem("thumbScale",String(t))}resetConsulta(){this.codigoConsulta="",this.busquedaConsultaCodigo="",this.busquedaConsultaNombre="",this.productoConsultado=null,this.productosConsultaFiltradosPorCodigo=[],this.productosConsultaFiltradosPorNombre=[],this.consultaEncontrado=!1,this.consultaImgUrl=this.placeholderSrc}toNum(t){let e=Number(t);return Number.isFinite(e)?e:0}round2(t){return Math.round((t+Number.EPSILON)*100)/100}get pagoEfectivo(){return this.toNum(this.efectivoRecibido)}get pagoTarjeta1(){return this.toNum(this.montoTarjeta)}get pagoTransferencia1(){return this.toNum(this.montoTransferencia)}get pagoVale1(){return this.toNum(this.montoVale)}get totalPagado(){return this.round2(this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)}trackByProducto=(t,e)=>e.producto;ngAfterViewInit(){this.focusBarcode(),this.clienteNombreCtrl.valueChanges.pipe(Yr(this.clienteNombreCtrl.value??""),cn(50),dn()).subscribe(()=>{this.clienteNombreCtrl.enabled&&this.cliTrigger&&(this.cliTrigger.panelOpen?this.cliTrigger.updatePosition():this.cliTrigger.openPanel())})}ngAfterViewChecked(){this.pendingFocusEfectivo&&this.mostrarModalPago&&(this.pendingFocusEfectivo=!1,setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0))}ngOnInit(){return Ae(this,null,function*(){this.obtenerProductos();let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono),yield this.cargarFarmacia();let n=localStorage.getItem("user_nombre");this.nombreUs=n||"",this.ventasPausadas=this.ventaService.getVentasPausadas(),this.filteredClientes$=this.clienteNombreCtrl.valueChanges.pipe(xt(r=>typeof r=="string"?r:r?.nombre??""),xt(r=>r.trim()),cn(200),dn(),Ui(r=>r.length<2?gt([]):this.clienteService.buscarClientesPorNombre(r,20).pipe(xt(a=>a?.rows??[]),Pi(()=>gt([]))))),this.clienteNombreCtrl.valueChanges.pipe(Yr(""),cn(120),dn(),xt(r=>typeof r=="string"?r:r?.nombre??"")).subscribe(r=>{this.opcionesClientes=this.filtraClientesLocal(r),(r||"").length&&this.opcionesClientes.length&&!this.clienteNombreCtrl.disabled?this.cliTrigger?.openPanel():this.cliTrigger?.closePanel()})})}cargarFarmacia(){return Ae(this,null,function*(){try{let t=yield gi(this.farmaciaService.getFarmaciaById(this.farmaciaId));this.farmaciaTitulo1=t?.titulo1??"",this.farmaciaTitulo2=t?.titulo2??"",this.farmaciaImagen=t?.imagen??""}catch(t){console.error("Error farmacia:",t)}})}onClienteInput(){let t=this.clienteNombreCtrl.value;typeof t=="string"&&t.trim()&&this.cliTrigger?.openPanel()}displayCliente=t=>t?.nombre||"";onClienteSelected(t){t&&(this.cliente=t._id,this.nombreCliente=t.nombre||"",this.telefonoCliente=t.telefono||"",this.montoMonederoCliente=Number(t.totalMonedero||0),this.recalcularRenglones(),this.hayCliente=!0,this.focusBarcode(60))}ngOnDestroy(){this.carrito.length>0&&this.pausarVenta()}handleEnter(t){this.mostrarModalPago&&(t.preventDefault(),this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total&&this.finalizarVenta())}clearBarcodeFocusTimer(){this.barcodeFocusTimer&&(clearTimeout(this.barcodeFocusTimer),this.barcodeFocusTimer=null)}focusBarcode(t=60){this.clearBarcodeFocusTimer(),this.barcodeFocusTimer=setTimeout(()=>{let e=document.activeElement,n=!!e&&(e.tagName==="INPUT"||e.getAttribute("contenteditable")==="true");!this.mostrarModalPago&&!n&&this.codigoBarrasRef&&this.codigoBarrasRef.nativeElement.focus(),this.barcodeFocusTimer=null},t)}nombreDiaSemana(t){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][t]||""}abrirAutoClientes(){this.clienteNombreCtrl.enabled&&setTimeout(()=>this.cliTrigger?.openPanel(),0)}VerSiPreguntaINAPAM(){return Ae(this,null,function*(){if(this.aplicaInapam){let t=yield xi.default.fire({icon:"question",title:"Credencial INAPAM vigente",html:`<h4>Me puede mostrar su credencial de INAPAM por favor?</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=t.isConfirmed}this.recalcularRenglones()})}recalcularRenglones(){return Ae(this,null,function*(){if(this.carrito.length>0){for(let t=0;t<this.carrito.length;t++){let e=this.productos.find(r=>r._id===this.carrito[t].producto);this.descuentoMenorA25(this.carrito[t].producto)&&(yield this.preguntaINAPAM(e)),e.categoria==="Recargas"||e.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(e);let n=this.carrito[t].precioOriginal;n*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=n*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=e.nombre),this.carrito[t].precioFinal=n,this.carrito[t].tipoDescuento=this.tipoDescuento,this.carrito[t].cadDesc=this.cadDesc,this.carrito[t].alMonedero=this.alMonedero,this.carrito[t].descuentoUnitario=this.carrito[t].precioOriginal-n,this.carrito[t].iva=e.iva?n*.16:0,this.aplicaGratis&&this.validarProductoGratis(e._id)}this.calcularTotal()}})}buscarCliente(){this.telefonoCliente.length===10&&this.clienteService.buscarClientePorTelefono(this.telefonoCliente).subscribe({next:t=>{t&&t.nombre?(this.nombreCliente=t.nombre,this.ventaForm.controls.cliente.setValue(t._id),this.cliente=t._id,this.montoMonederoCliente=t.totalMonedero,this.hayCliente=!0,this.recalcularRenglones(),this.focusBarcode()):this.mostrarModalCrearCliente()},error:t=>{console.error("\u274C Error al buscar cliente:",t),this.mostrarModalCrearCliente()}})}mostrarModalCrearCliente(){xi.default.fire({icon:"warning",title:"Cliente no encontrado",text:"\xBFDesea registrar un nuevo cliente?",showCancelButton:!0,confirmButtonText:"Crear Cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{t.isConfirmed?this.abrirFormularioNuevoCliente():(this.limpiarCliente(),this.focusBarcode())})}abrirFormularioNuevoCliente(){xi.default.fire({title:"Registrar Cliente",html:'<input id="nuevoNombreCliente" class="swal2-input" style="width: 80%;" placeholder="Ap. paterno Ap. materno Nombre(s)">',showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let t=document.getElementById("nuevoNombreCliente").value;return t||xi.default.showValidationMessage("El nombre es obligatorio"),{nombre:t,telefono:this.telefonoCliente,totalMonedero:this.montoMonederoCliente}}}).then(t=>{t.isConfirmed?this.registrarNuevoCliente(t.value):t.dismiss===xi.default.DismissReason.cancel&&(this.limpiarCliente(),this.focusBarcode())})}registrarNuevoCliente(t){this.clienteService.crearCliente(t).subscribe({next:e=>{let n=e?.cliente??e?.data??e?.result??e,r=n?._id??e?.insertedId??e?._id??null,a=n?.nombre??t?.nombre??"",o=n?.telefono??t?.telefono??"",u=Number(n?.totalMonedero??0);if(r&&a){this.nombreCliente=a,this.ventaForm.controls.cliente.setValue(r),this.hayCliente=!0,this.cliente=r,this.montoMonederoCliente=u;try{(this.clientes||[]).some(f=>f?._id===r)||(this.clientes=[{_id:r,nombre:a,telefono:o,totalMonedero:u},...this.clientes||[]])}catch{}this.recalcularRenglones(),xi.default.fire({icon:"success",title:"Cliente registrado",text:`El cliente ${a} ha sido registrado correctamente.`,timer:1500,showConfirmButton:!1})}else console.error("\u26A0\uFE0F Respuesta inesperada del backend:",e),xi.default.fire({icon:"warning",title:"Cliente registrado",text:"Se registr\xF3 el cliente, pero no pude leer su ID desde la respuesta.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("\u274C Error al registrar cliente:",e),xi.default.fire({icon:"error",title:"Error",text:"No se pudo registrar el cliente. Int\xE9ntelo de nuevo.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})}})}limpiarCliente(){this.cliente="",this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.hayCliente=!1,this.ventaForm.controls.cliente.setValue(""),this.clienteNombreCtrl.setValue(""),this.recalcularRenglones(),this.focusBarcode(60)}limpiarBarras(){this.resetConsulta()}limpiarProducto(){this.codigoBarras="",this.busquedaProducto="",this.busquedaPorCodigo="",this.productosFiltrados=this.productos,this.productosFiltradosPorCodigo=this.productos,this.filtrarProductos(),this.filtrarPorCodigo(),this.focusBarcode()}filtrarProductos(){this.busquedaProducto?this.productosFiltrados=this.productos.filter(t=>t.nombre.toLowerCase().includes(this.busquedaProducto.toLowerCase())):this.productosFiltrados=this.productos}filtrarPorCodigo(){this.busquedaPorCodigo?this.productosFiltradosPorCodigo=this.productos.filter(t=>t.codigoBarras.includes(this.busquedaPorCodigo)):this.productosFiltradosPorCodigo=this.productos}seleccionarProducto(t){let e=t.option.value,n=this.productos.find(r=>r._id===e);n&&(this.busquedaProducto=n.nombre,this.existenciaProducto(this.farmaciaId,n._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(n)}).catch(r=>{console.error("Error en existenciaProducto: ",r)})),this.focusBarcode(100)}seleccionarPorCodigo(t){let e=t.option.value,n=this.productos.find(r=>r._id===e);n&&(this.busquedaPorCodigo=n.codigoBarras,this.existenciaProducto(this.farmaciaId,n._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(n)}).catch(r=>{console.error("Error en existenciaProducto: ",r)})),this.focusBarcode(100)}displayNombre=t=>{let e=this.productos.find(n=>n._id===t);return e?e.nombre:""};displayCodigo=t=>{let e=this.productos.find(n=>n._id===t);return e?`${e.codigoBarras} \u2014 ${e.nombre}`:""};pausarVenta(){this.ventasPausadas.push({_uid:"p"+Date.now()+Math.random().toString(36).slice(2,8),cliente:this.ventaForm.value.cliente,productos:[...this.carrito],clienteId:this.cliente||null,telefonoCliente:this.telefonoCliente||null,nombreCliente:this.nombreCliente||null,montoMonederoCliente:this.montoMonederoCliente||null,total:this.total,totalArticulos:this.totalArticulos,totalDescuento:this.totalDescuento,totalAlmonedero:this.totalAlmonedero,aplicaInapam:this.aplicaInapam,captionButtomReanudar:this.captionButtomReanudar||"(venta pausada)"}),this.ventaService.setVentasPausadas(this.ventasPausadas),this.ventasPausadas=this.ventaService.getVentasPausadas()||[],this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.aplicaInapam=!1,this.cliente="",this.captionButtomReanudar="",this.ventaForm.controls.cliente.setValue(""),this.hayCliente=!1,this.focusBarcode()}reanudarVenta(t){this.carrito.length&&this.pausarVenta();let e=this.ventasPausadas[t];this.ventaForm.patchValue({cliente:e.cliente}),this.carrito=[...e.productos],this.telefonoCliente=e.telefonoCliente,this.nombreCliente=e.nombreCliente,this.montoMonederoCliente=e.montoMonederoCliente,this.cliente=e.clienteId,this.total=e.total,this.totalArticulos=e.totalArticulos,this.totalDescuento=e.totalDescuento,this.totalAlmonedero=e.totalAlmonedero,this.aplicaInapam=e.aplicaInapam,this.captionButtomReanudar=e.captionButtomReanudar,this.ventasPausadas.splice(t,1),this.ventaService.setVentasPausadas(this.ventasPausadas),this.focusBarcode(0)}obtenerProductos(){this.productoService.obtenerProductos().subscribe({next:t=>{this.productos=t||[],this.thumbs={};for(let e of this.productos)this.thumbs[e._id]=this.placeholderSrc;As(this.productos).pipe(Os(e=>e?.imagen?this.productoService.getImagenObjectUrl(e._id).pipe(Rn(n=>{this.thumbs[e._id]=n||this.placeholderSrc}),Pi(()=>gt(null))):gt(null),6)).subscribe()},error:t=>console.error("Error al obtener productos",t)})}onThumbError(t,e){let n=t.target;n&&n.src!==this.placeholderSrc&&(n.src=this.placeholderSrc)}agregarProductoPorCodigo(){if(this.codigoBarras.length===0&&this.carrito.length>0)this.abrirModalPago();else{let t=this.productos.find(e=>e.codigoBarras===this.codigoBarras);t?this.existenciaProducto(this.farmaciaId,t._id,1).then(()=>{if(!this.hayProducto){this.codigoBarras="";return}this.agregarProductoAlCarrito(t)}).catch(e=>{console.error("Error en existenciaProducto: ",e)}):xi.default.fire({icon:"warning",title:"Producto no encontrado",text:"Verifica el c\xF3digo de barras",timer:1300,showConfirmButton:!1,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>this.focusBarcode(60)),this.codigoBarras="",this.focusBarcode()}}agregarProductoAlCarrito(t){return Ae(this,null,function*(){let e=this.carrito.find(n=>n.producto===t._id&&!n.esGratis);if(e)this.existenciaProducto(this.farmaciaId,t._id,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(n=>{console.error("Error en existenciaProducto: ",n)});else{let n=this.precioEnFarmacia;this.descuentoMenorA25(t)&&(yield this.preguntaINAPAM(t)),t.categoria==="Recargas"||t.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(t),n*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=n*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=t.nombre);let r={producto:t._id,codBarras:t.codigoBarras,nombre:t.nombre,cantidad:1,precioFinal:n,precioOriginal:this.precioEnFarmacia,ubicacionEnFarmacia:this.ubicacionEnFarmacia,tipoDescuento:this.tipoDescuento,cadDesc:this.cadDesc,alMonedero:this.alMonedero,descuentoUnitario:this.precioEnFarmacia-n,iva:t.iva?n*.16:0,cantidadPagada:1,farmacia:this.farmaciaId,promoCantidadRequerida:t.promoCantidadRequerida};this.carrito=[r,...this.carrito]}this.aplicaGratis&&this.validarProductoGratis(t._id),this.calcularTotal()})}limpiarPromocion(t){let e=(t||"").toString();return e.startsWith("-")?e.slice(1):e}preguntaINAPAM(t){return Ae(this,null,function*(){if(t.descuentoINAPAM&&!this.yaPreguntoInapam){this.yaPreguntoInapam=!0;let e=yield xi.default.fire({icon:"question",title:"\xBFTiene credencial INAPAM vigente?",html:`<h4>Me la puede mostrar por favor</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=e.isConfirmed}})}descuentoMenorA25(t){let n=new Date().getDay(),r=0;switch(n){case 0:r=t?.descuentoDomingo??null;break;case 1:r=t?.descuentoLunes??null;break;case 2:r=t?.descuentoMartes??null;break;case 3:r=t?.descuentoMiercoles??null;break;case 4:r=t?.descuentoJueves??null;break;case 5:r=t?.descuentoViernes??null;break;case 6:r=t?.descuentoSabado??null;break;default:r=0}return r?r<25:!0}descuentoYpromo(t){let e=this.soloFecha(new Date),n=e.getDay();if(this.tipoDescuento="",this.cadDesc="",this.ptjeDescuento=0,this.productoAplicaMonedero=this.hayCliente,this.alMonedero=0,this.fechaIni=this.soloFecha(new Date(e)),this.fechaFin=this.soloFecha(new Date(e)),this.aplicaGratis=!0,t.promoCantidadRequerida&&this.soloFecha(new Date(t.inicioPromoCantidad))<=this.soloFecha(e)&&this.soloFecha(new Date(t.finPromoCantidad))>=this.soloFecha(e))this.aplicaGratis=!1,this.cadDesc="",this.tipoDescuento=`${t.promoCantidadRequerida}x${t.promoCantidadRequerida-1}`,this.productoAplicaMonedero=!1,t.promoCantidadRequerida===2&&(this.aplicaGratis=!0),this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento+="-INAPAM",this.cadDesc="5%");else{let r=0,a=!1;switch(n){case 1:this.fechaIni=t?.promoLunes?.inicio??null,this.fechaFin=t?.promoLunes?.fin??null,r=t?.promoLunes?.porcentaje??null,this.productoAplicaMonedero=t?.promoLunes?.monedero??null;break;case 2:this.fechaIni=t?.promoMartes?.inicio??null,this.fechaFin=t?.promoMartes?.fin??null,r=t?.promoMartes?.porcentaje??null,this.productoAplicaMonedero=t?.promoMartes?.monedero??null;break;case 3:this.fechaIni=t?.promoMiercoles?.inicio??null,this.fechaFin=t?.promoMiercoles?.fin??null,r=t?.promoMiercoles?.porcentaje??null,this.productoAplicaMonedero=t?.promoMiercoles?.monedero??null;break;case 4:this.fechaIni=t?.promoJueves?.inicio??null,this.fechaFin=t?.promoJueves?.fin??null,r=t?.promoJueves?.porcentaje??null,this.productoAplicaMonedero=t?.promoJueves?.monedero??null;break;case 5:this.fechaIni=t?.promoViernes?.inicio??null,this.fechaFin=t?.promoViernes?.fin??null,r=t?.promoViernes?.porcentaje??null,this.productoAplicaMonedero=t?.promoViernes?.monedero??null;break;case 6:this.fechaIni=t?.promoSabado?.inicio??null,this.fechaFin=t?.promoSabado?.fin??null,r=t?.promoSabado?.porcentaje??null,this.productoAplicaMonedero=t?.promoSadado?.monedero??null;break;case 0:this.fechaIni=t?.promoDomingo?.inicio??null,this.fechaFin=t?.promoDomingo?.fin??null,r=t?.promoDomingo?.porcentaje??null,this.productoAplicaMonedero=t?.promoDomingo?.monedero??null;break}if(!r||r<=0?(this.fechaIni=this.soloFecha(new Date(e)),this.fechaIni.setDate(this.fechaIni.getDate()+5),this.fechaIni=this.soloFecha(this.fechaIni)):a=!0,a&&this.soloFecha(new Date(this.fechaIni))<=e&&this.soloFecha(new Date(this.fechaFin))>=e&&(this.tipoDescuento=this.nombreDiaSemana(n),this.ptjeDescuento=r,this.cadDesc=`${r}%`,this.productoAplicaMonedero=this.productoAplicaMonedero&&this.hayCliente),t.promoDeTemporada&&this.soloFecha(new Date(t.promoDeTemporada.inicio))<=e&&this.soloFecha(new Date(t.promoDeTemporada.fin))>=e){let o=t.promoDeTemporada.porcentaje;o>this.ptjeDescuento&&(this.ptjeDescuento=o,this.tipoDescuento="Temporada",this.cadDesc=`${o}%`,this.productoAplicaMonedero=t.promoDeTemporada.monedero&&this.hayCliente)}if(this.ptjeDescuento>0){if(this.ptjeDescuento<25&&this.aplicaInapam&&t.descuentoINAPAM){let o=this.precioEnFarmacia*(1-this.ptjeDescuento/100)*.95;this.ptjeDescuento=(1-o/this.precioEnFarmacia)*100,this.tipoDescuento+="-INAPAM",this.cadDesc+="+ 5%",this.productoAplicaMonedero=this.hayCliente}}else this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento="INAPAM",this.cadDesc="5%",this.productoAplicaMonedero=this.hayCliente);this.ptjeDescuento<=0&&(this.productoAplicaMonedero=this.hayCliente)}}soloFecha(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}eliminarProducto(t){let e=this.carrito[t];if(e.esGratis)this.carrito.splice(t,1);else{let n=e.producto;this.carrito.splice(t,1);let r=this.carrito.findIndex(a=>a.producto===n&&a.esGratis);r!==-1&&this.carrito.splice(r,1)}this.calcularTotal()}incrementarCantidad(t){let e=this.carrito[t];e.esGratis||this.existenciaProducto(this.farmaciaId,e.producto,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(n=>{console.error("Error en existenciaProducto: ",n)}),this.calcularTotal()}decrementarCantidad(t){let e=this.carrito[t];e.cantidad>1&&!e.esGratis?(e.cantidad--,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal()):e.cantidad===1&&!e.esGratis&&(e.cantidad--,this.eliminarProducto(t))}esPromocionPorCantidad(t){return["2x1","3x2","4x3"].some(n=>t?.startsWith(n))}validarProductoGratis(t){let e=this.carrito.find(o=>o.producto===t&&!o.esGratis);if(!e||!e.promoCantidadRequerida)return;let n=e.cantidad,r=e.promoCantidadRequerida,a=this.carrito.some(o=>o.producto===t&&o.esGratis);if(n>=r-1){let o=Math.floor(n/(r-1));if(this.existenciaProducto(this.farmaciaId,t,n+o),!this.hayProducto)return;if(!a)this.carrito.push({producto:e.producto,nombre:e.nombre,cantidad:1,precioFinal:0,precioOriginal:e.precioOriginal,tipoDescuento:`${r}x${r-1}-Gratis`,cadDesc:"100%",alMonedero:0,descuentoUnitario:e.precioOriginal,iva:0,lote:e.lote,fechaCaducidad:e.fechaCaducidad,cantidadPagada:0,esGratis:!0,controlesDeshabilitados:!0,lotes:e.lotes,farmacia:this.farmaciaId});else{let u=this.carrito.find(m=>m.producto===t&&m.esGratis);u&&(u.cantidad=o,u.cadDesc="100%",u.tipoDescuento=`${r}x${r-1}-Gratis`)}}else{let o=this.carrito.findIndex(u=>u.producto===t&&u.esGratis);o!==-1&&this.carrito.splice(o,1)}}calcularTotal(){this.total=this.round2(this.carrito.reduce((t,e)=>t+e.precioFinal*e.cantidad,0)),this.totalDescuento=this.round2(this.carrito.reduce((t,e)=>t+e.descuentoUnitario*e.cantidad,0)),this.totalArticulos=this.carrito.reduce((t,e)=>t+e.cantidad,0),this.totalAlmonedero=this.round2(this.carrito.reduce((t,e)=>t+e.alMonedero*e.cantidad,0))}cancelarVenta(){this.captionButtomReanudar="",this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1,this.folioVentaGenerado=null,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.hayCliente=!1}abrirModalPago(){xi.default.fire({icon:"question",title:"\xBFDESEA AGREGAR ALGO M\xC1S?",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,focusConfirm:!0,confirmButtonText:"NO, ir a cobrar",cancelButtonText:"SI, agregar m\xE1s productos"}).then(t=>{t.isConfirmed&&(this.usarMonedero=!1,this.mostrarModalPago=!0,this.montoTarjeta=null,this.montoTransferencia=null,this.montoVale=null,this.efectivoRecibido=null,this.cambio=0,this.clearBarcodeFocusTimer(),this.codigoBarrasRef?.nativeElement?.blur(),this.cdRef.detectChanges(),setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0),this.calcularTotal())})}calculaCambio(){this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.efectivoRecibido=0,this.cambio=0):this.total-this.pagoEfectivo-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1<0?this.cambio=this.pagoEfectivo-(this.total-(this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)):this.cambio=0}pagoTarjeta(){this.pagoTarjeta1>=this.total?(this.montoTarjeta=this.total,this.efectivoRecibido=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTarjeta=this.total-this.pagoTransferencia1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.ocultaTarjeta=!1,this.calculaCambio())}pagoTransferencia(){this.pagoTransferencia1>=this.total?(this.montoTransferencia=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTransferencia=this.total-this.pagoTarjeta1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}pagoVale(){this.pagoVale1>=this.total?(this.montoVale=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoVale=this.total-this.pagoTarjeta1-this.pagoTransferencia1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}onToggleMonedero(){this.usarMonedero?this.montoMonederoCliente>=this.total?this.montoVale=this.total:this.montoVale=this.montoMonederoCliente:this.habilitarInputs(),this.pagoVale()}habilitarInputs(){this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.inputsHabilitados=!1,this.montoVale=0,this.usarMonedero=!1,this.calculaCambio()}inhabilitarInputs(){this.ocultarEfectivo=!0,this.ocultaTarjeta=!0,this.ocultaTransferencia=!0,this.ocultaVale=!0,this.inputsHabilitados=!0}cancelarPago(){this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.mostrarModalPago=!1,this.focusBarcode(50)}finalizarVenta(){return Ae(this,null,function*(){this.efectivoRecibido=Math.max(0,this.pagoEfectivo),this.montoTarjeta=Math.max(0,this.pagoTarjeta1),this.montoTransferencia=Math.max(0,this.pagoTransferencia1),this.montoVale=Math.max(0,this.pagoVale1),this.cambio=Math.max(0,this.cambio);let t=this.efectivoRecibido+this.montoTarjeta+this.montoTransferencia+this.montoVale;if(this.montoTarjeta+this.montoTransferencia+this.montoVale>this.total){xi.default.fire("Error","El monto con tarjeta, transferencia y/o monedero no puede exceder el total.","error");return}if(t<this.total){xi.default.fire("Pago incompleto","La suma de pagos no cubre el total de la venta.","warning");return}let n=this.folioVentaGenerado||this.generarFolioLocal();this.folioVentaGenerado=n;let r=this.carrito.map(f=>({producto:f.producto,nombre:f.nombre,barrasYNombre:`${f.codBarras.slice(-3)} ${f.nombre}`,cantidad:f.cantidad,precio:f.precioFinal,totalRen:f.precioFinal*f.cantidad,precioOriginal:f.precioOriginal,iva:f.iva,tipoDescuento:f.tipoDescuento,descuento:(f.descuentoUnitario??0)*f.cantidad,cadenaDescuento:f.cadDesc??"",monederoCliente:(f.almonedero??0)*f.cantidad})),a=Fr(this.farmaciaImagen),o="";try{o=yield Ar(a)}catch{o=a}let u={nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono,titulo1:this.farmaciaTitulo1,titulo2:this.farmaciaTitulo2,imagen:o};this.ventaParaImpresion={folio:this.folioVentaGenerado,cliente:this.nombreCliente,farmacia:u,productos:r,cantidadProductos:this.totalArticulos,total:this.total,totalDescuento:this.totalDescuento,totalMonederoCliente:this.totalAlmonedero,formaPago:{efectivo:this.total-this.montoTarjeta-this.montoTransferencia-this.montoVale,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,vale:this.montoVale},AsiQuedaMonedero:this.montoMonederoCliente-this.montoVale+this.totalAlmonedero,elcambio:this.cambio,fecha:new Date().toISOString(),usuario:this.nombreUs},console.log("VENTA \u2192 farmacia para imprimir:",this.ventaParaImpresion.farmacia),pp(()=>{this.mostrarTicket=!0,this.cdRef.detectChanges()},()=>{this.mostrarTicket=!1},()=>this.guardarVentaDespuesDeImpresion(n))})}limpiarVenta(){this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1}yyyymmddLocal(t=new Date){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}${n}${r}`}generarFolioLocal(){let t="FB",e=this.yyyymmddLocal(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";for(let a=0;a<6;a++){let o=Math.floor(Math.random()*n.length);r+=n[o]}return`${t}${e}-${r}`}guardarVentaDespuesDeImpresion(t){let e=this.carrito.map(r=>({producto:r.producto,cantidad:r.cantidad,precio:r.precioFinal,totalRen:r.precioFinal*r.cantidad,precioOriginal:r.precioOriginal,iva:r.iva,tipoDescuento:r.tipoDescuento,descuento:(r.descuentoUnitario??0)*r.cantidad})),n={folio:t,clienteId:this.cliente,productos:e,aplicaInapam:this.aplicaInapam,efectivo:this.total-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,importeVale:this.pagoVale1,farmacia:this.farmaciaId,totaMonederoCliente:this.totalAlmonedero};this.ventasService.crearVenta(n).subscribe({next:()=>{this.folioVentaGenerado=null,this.limpiarVenta(),this.mostrarModalPago=!1,this.ventaService.setVentasPausadas(this.ventasPausadas),xi.default.fire({icon:"success",title:"Venta Registrada",text:"Venta finalizada correctamente",timer:1300,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1,didClose:()=>{this.focusBarcode(50)}})},error:r=>{let a=r?.error?.mensaje||"Error al finalizar la venta";xi.default.fire("Error",a,"error"),a.includes("**")||(this.mostrarModalPago=!1,this.limpiarVenta(),setTimeout(()=>this.focusBarcode(50),0))}})}abrirModalConsultaPrecio(){this.mostrarModalConsultaPrecio=!0,this.codigoConsulta="",this.productoConsultado=null,this.limpiarProducto()}cerrarModalConsultaPrecio(){this.resetConsulta(),this.mostrarModalConsultaPrecio=!1,this.focusBarcode(50)}consultarPrecio(){this.codigoConsulta.trim()&&this.productoService.consultarPrecioPorCodigo(this.farmaciaId,this.codigoConsulta).subscribe({next:t=>{let e=!!t&&t.nombre!==void 0;if(this.consultaEncontrado=e,!e){this.productoConsultado=null,this.consultaImgUrl=this.placeholderSrc;return}!t||t.nombre===void 0?this.productoConsultado={nombre:"Producto no encontrado",precioNormal:null,promo1:null,precioLunes:null,lunesMasInapam:null,promo2:null,precioMartes:null,martesMasInapam:null,promo3:null,precioMiercoles:null,miercolesMasInapam:null,promo4:null,precioJueves:null,juevesMasInapam:null,promo5:null,precioViernes:null,viernesMasInapam:null,promo6:null,precioSabado:null,sabadoMasInapam:null,promo0:null,precioDomingo:null,domingoMasInapam:null,promo:null,precioConDescuento:null,precioInapam:null,precioDescuentoMasInapam:null,promoCliente:null,ubicacionEnFarmacia:null}:this.productoConsultado={nombre:t.nombre,precioNormal:t.precioNormal,promo1:t.promo1,precioLunes:t.precioLunes,lunesMasInapam:t.lunesMasInapam,promo2:t.promo2,precioMartes:t.precioMartes,martesMasInapam:t.martesMasInapam,promo3:t.promo3,precioMiercoles:t.precioMiercoles,miercolesMasInapam:t.miercolesMasInapam,promo4:t.promo4,precioJueves:t.precioJueves,juevesMasInapam:t.juevesMasInapam,promo5:t.promo5,precioViernes:t.precioViernes,viernesMasInapam:t.viernesMasInapam,promo6:t.promo6,precioSabado:t.precioSabado,sabadoMasInapam:t.sabadoMasInapam,promo0:t.promo0,precioDomingo:t.precioDomingo,domingoMasInapam:t.domingoMasInapam,promo:t.promo,precioConDescuento:t.precioConDescuento,precioInapam:t.precioInapam,precioDescuentoMasInapam:t.precioDescuentoMasInapam,promoCliente:t.promoCliente,ubicacionEnFarmacia:t.ubicacionEnFarmacia};let n=t._id??(this.productos||[]).find(r=>r.codigoBarras===this.codigoConsulta)?._id;this.consultaImgUrl=n?this.productoService.obtenerImagenProductoUrl(n):this.placeholderSrc},error:t=>{console.error("\u274C Error al consultar precio:",t),this.productoConsultado={nombre:"Error en la consulta",precioNormal:null,promo:null,precioFinal:null}}})}filtrarConsultaPorCodigo(){let t=(this.busquedaConsultaCodigo||"").trim();if(!t){this.productosConsultaFiltradosPorCodigo=[];return}this.productosConsultaFiltradosPorCodigo=this.productos.filter(e=>(e.codigoBarras||"").includes(t))}filtrarConsultaPorNombre(){let t=(this.busquedaConsultaNombre||"").trim().toLowerCase();if(!t){this.productosConsultaFiltradosPorNombre=[];return}this.productosConsultaFiltradosPorNombre=this.productos.filter(e=>(e.nombre||"").toLowerCase().includes(t))}onSelectConsultaCodigo(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaCodigo=t.option.viewValue,this.consultarPrecio()}onSelectConsultaNombre(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaNombre=t.option.viewValue,this.consultarPrecio()}existenciaProducto(t,e,n){return new Promise((r,a)=>{this.productoService.existenciaPorFarmaciaYProducto(t,e).subscribe({next:o=>{this.precioEnFarmacia=o.precioVenta,this.ubicacionEnFarmacia=o.ubicacionEnFarmacia,o.existencia>=n?(this.hayProducto=!0,r()):(xi.default.fire({icon:"error",title:"No hay suficiente existencia",html:`Producto: ${o.nombre}<br>Cantidad disponible: ${o.existencia}<br>Cantidad requerida: ${n}`,confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1}),this.hayProducto=!1,r())},error:o=>{console.error("Error al obtener la existencia del producto:",o),this.hayProducto=!1,a(o)}})})}clienteBoxVisible=!1;clienteIndex=-1;onClienteBlur(){setTimeout(()=>{this.clienteBoxVisible=!1},120)}onClienteKeyDown(t){!this.clienteBoxVisible||this.opcionesClientes.length===0||(t.key==="ArrowDown"?(t.preventDefault(),this.clienteIndex=Math.min(this.clienteIndex+1,this.opcionesClientes.length-1)):t.key==="ArrowUp"?(t.preventDefault(),this.clienteIndex=Math.max(this.clienteIndex-1,0)):t.key==="Enter"?(t.preventDefault(),this.clienteIndex>=0&&this.selectCliente(this.opcionesClientes[this.clienteIndex])):t.key==="Escape"&&(this.clienteBoxVisible=!1))}selectCliente(t){t&&(this.clienteNombreCtrl.setValue(t.nombre,{emitEvent:!1}),this.clienteBoxVisible=!1,this.onClienteSelected(t))}trackByCliente=(t,e)=>e?._id||e?.nombre||t;ensureClientesArray(t){return Array.isArray(t)?t:Array.isArray(t?.rows)?t.rows:Array.isArray(t?.data)?t.data:Array.isArray(t?.clientes)?t.clientes:[]}filtraClientesLocal(t){let e=Array.isArray(this.clientes)?this.clientes:Array.isArray(this.clientes?.rows)?this.clientes.rows:[],n=(t||"").trim().toLowerCase();if(!n)return e.slice(0,50);let r=t.replace(/\D/g,"");return e.filter(a=>{let o=(a?.nombre||"").toLowerCase(),u=String(a?.telefono||"");return o.includes(n)||r&&u.includes(r)}).slice(0,50)}filtraClientesDatalist(t){this.opcionesClientes=this.filtraClientesLocal(t)}onClienteElegidoDesdeTexto(t){let e=String(t||"").split(" \u2014 ")[0].trim().toLowerCase();if(!e)return;let r=this.ensureClientesArray(this.clientes).find(a=>String(a?.nombre||"").toLowerCase()===e);r&&this.onClienteSelected(r)}openPreviewVenta(t){let n=(this.productos||[]).find(a=>a._id===t.producto)?.imagen?this.productoService.obtenerImagenProductoUrl(t.producto):this.placeholderSrc,r=new Image;r.src=n,r.onload=()=>{let a=r.naturalWidth||0,o=r.naturalHeight||0,u=a*3,m=o*3,f=Math.floor(window.innerWidth*.9),h=Math.floor(window.innerHeight*.9),g=Math.min(f/u,h/m,1),x=Math.max(1,Math.round(u*g)),b=Math.max(1,Math.round(m*g));xi.default.fire({width:"auto",background:"#000",showConfirmButton:!1,showCloseButton:!0,padding:0,html:`
        <div style="max-width:${f}px;max-height:${h}px;display:flex;align-items:center;justify-content:center;">
          <img src="${n}" alt=""
               style="width:${x}px;height:${b}px;object-fit:contain;display:block;"/>
        </div>`})},r.onerror=()=>{xi.default.fire({icon:"error",title:"No se pudo cargar la imagen",text:"Int\xE9ntalo de nuevo."})}}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(pl),ie(Ji),ie(Sn),ie($a),ie(Xt),ie(Dt),ie(bn))};static \u0275cmp=Te({type:i,selectors:[["app-ventas"]],viewQuery:function(e,n){if(e&1&&(Tt(Tx,5),Tt(Px,5),Tt(kx,5,ea)),e&2){let r;bt(r=yt())&&(n.codigoBarrasRef=r.first),bt(r=yt())&&(n.efectivoRecibidoRef=r.first),bt(r=yt())&&(n.cliTrigger=r.first)}},hostBindings:function(e,n){e&1&&w("keydown.enter",function(a){return n.handleEnter(a)},!1,Ta)},decls:116,vars:46,consts:[["autoClientes","matAutocomplete"],["codigoBarrasRef",""],["autoCodigo","matAutocomplete"],["autoNombre","matAutocomplete"],["payForm","ngForm"],["autoConsCodigo","matAutocomplete"],["autoConsNombre","matAutocomplete"],["efectivoRecibidoRef",""],[1,"row","align-items-center","titulo-row"],[1,"col-6","text-end"],[1,"titulo","mb-0"],[1,"col-6","d-flex","justify-content-center"],[1,"me-2","mb-0"],[1,"form-select","form-select-sm","scale-select",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"row","align-items-center","mb-1"],[1,"col-md-2"],["appearance","outline",1,"compact-field"],["type","text","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["id","clientesList"],[1,"col-md-1","text-end"],[1,"cliente-tel"],[1,"col-md-2","position-relative"],["type","text",1,"form-control","pe-5",3,"ngModelChange","input","ngModel"],["type","button","matTooltip","Limpiar cliente","class","btn btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-3"],["class","cliente-nombre",4,"ngIf"],["class","col-md-2",4,"ngIf"],[1,"col-md-2","text-end"],[1,"btn-gris","consultar-precio",3,"click"],[1,"productos-container"],[1,"subtitulo"],["type","text","id","codigoBarras","placeholder","Escanear C\xF3d. barras",1,"input-text","input-cb",3,"ngModelChange","keyup.enter","ngModel","disabled"],["appearance","outline",1,"compact-field","wide-field","mr-field"],["matInput","",3,"ngModelChange","input","ngModel","matAutocomplete"],["appearance","outline",1,"compact-field","wider-field"],["matTooltip","Limpiar producto",1,"btn-rojo-tache",3,"click"],[1,"fas","fa-times"],["class","modal-overlay",4,"ngIf"],[1,"ventas-container"],[1,"tabla"],[1,"col-acciones"],[1,"col-img"],[1,"col-producto"],[1,"col-cant"],[1,"col-precio"],[1,"col-imp-normal"],[1,"col-promo"],[1,"col-desc-porc"],[1,"col-monedero"],[1,"col-desc"],[1,"col-precio-final"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"total-container"],[1,"left"],[1,"center"],[1,"right"],["class","botones-container",4,"ngIf"],["class","mt-4",4,"ngIf"],[3,"ngSubmit"],["id","ticketVenta","class","ticket-impresion",4,"ngIf"],[3,"ngValue"],[3,"value"],["type","button","matTooltip","Limpiar cliente",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"cliente-nombre"],["type","checkbox","id","aplicaInapam","name","aplicaInapam",3,"ngModelChange","ngModel"],["for","aplicaInapam"],[1,"modal-overlay"],[1,"modal-content",2,"width","600px"],[1,"input-container","position-relative"],["type","text","placeholder","C\xF3digo de barras",1,"input-field",3,"ngModelChange","keyup.enter","ngModel"],["matTooltip","Limpiar c\xF3d. barras",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["class","row",4,"ngIf"],["matTooltip","Salir de consultar",1,"btn-rojo-tache",3,"click"],[1,"row"],[1,"consulta-img-wrap","col-sm-7","text-center"],["alt","Imagen de producto",3,"error","src"],["class","col-sm-5 text-center mt-4",4,"ngIf"],[1,"col-sm-5","text-center","mt-4"],["appearance","outline",1,"w-100","mb-1","compact-field"],["matInput","","placeholder","Buscar C\xF3d. barras",3,"ngModelChange","input","ngModel","matAutocomplete"],[3,"optionSelected"],["matInput","","placeholder","Buscar producto por nombre",3,"ngModelChange","input","ngModel","matAutocomplete"],["role","group","aria-label","Acciones",1,"acciones-group"],["matTooltip","Eliminar rengl\xF3n",1,"btn-icono","btn-rojo-tache",3,"click","disabled"],["matTooltip","Aumentar uno",1,"btn-icono","btn-verde",3,"click","disabled"],[1,"fas","fa-plus"],["matTooltip","Quitar uno",1,"btn-icono","btn-gris",3,"click","disabled"],[1,"fas","fa-minus"],[1,"img-cell"],["type","button",1,"img-button",3,"click"],["alt","","loading","lazy","decoding","async","matTooltip","Ver imagen","matTooltipPosition","right","matTooltipClass","tip-tight",3,"error","src"],[1,"prod-nombre"],[1,"prod-ubicacion"],[1,"botones-container"],[1,"btn-amarillo",3,"click"],[1,"btn-rojo",3,"click"],[1,"btn-verde","btn-right",3,"click"],[1,"mt-4"],["class","btn-gris d-block w-100 mb-2",3,"click",4,"ngFor","ngForOf"],[1,"btn-gris","d-block","w-100","mb-2",3,"click"],[1,"modal-content"],[1,"modal-header","bg-info-subtle","text-blue"],[1,"modal-title"],[1,"modal-body"],[1,"total-pago"],[1,"form-group","row","mb-2"],["for","efectivoRecibido",1,"col-sm-4","col-form-label","text-left"],[1,"col-sm-7","offset-sm-1","d-flex","justify-content-end"],["id","efectivoRecibido","name","efectivoRecibido","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","disabled"],["for","montoTarjeta",1,"col-sm-4","col-form-label","text-left"],["id","montoTarjeta","name","montoTarjeta","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["for","montoTransferencia",1,"col-sm-4","col-form-label"],["id","montoTransferencia","name","montoTransferencia","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["class","monedero-container",4,"ngIf"],[1,"mt-3","cambio"],["class","text-danger mt-3",4,"ngIf"],["class","text-success mt-3",4,"ngIf"],[1,"btns-container"],["type","button",1,"btn-rojo-tache",3,"click"],["type","submit",1,"btn-gris",3,"disabled"],[1,"button-container"],["type","button","class","btn-amarillo",3,"click",4,"ngIf"],[1,"monedero-container"],[1,"col-12","text-center",2,"color","rgb(3, 7, 83)","font-weight","bold","font-size","large"],[1,"col-sm-8"],["for","usarMonedero",1,"col-form-label"],[1,"col-sm-4","d-flex","align-items-center"],["id","usarMonedero","type","checkbox","name","usarMonedero",1,"form-check-input",3,"ngModelChange","ngModel"],["for","usarMonedero",1,"ms-2"],["class","form-group row mb-2",4,"ngIf"],[1,"col-sm-8","col-form-label","text-left"],[1,"col-sm-4","d-flex","justify-content-end"],[1,"form-control-plaintext","text-end"],[1,"text-danger","mt-3"],[1,"text-success","mt-3"],["type","button",1,"btn-amarillo",3,"click"],[1,"fas","fa-sync-alt"],["id","ticketVenta",1,"ticket-impresion"],[3,"venta"]],template:function(e,n){if(e&1){let r=ae();l(0,"div")(1,"div",8)(2,"div",9)(3,"h1",10),d(4,"Ventas"),s()(),l(5,"div",11)(6,"label",12),d(7,"Tama\xF1o imagen:"),s(),l(8,"select",13),ee("ngModelChange",function(o){return P(r),Z(n.thumbScale,o)||(n.thumbScale=o),k(o)}),w("ngModelChange",function(o){return P(r),k(n.onScaleChange(o))}),N(9,Ix,2,2,"option",14),s()()(),l(10,"div",15)(11,"div",16)(12,"mat-form-field",17)(13,"mat-label"),d(14,"Busca cliente, nombre"),s(),y(15,"input",18),l(16,"mat-autocomplete",19,0),w("optionSelected",function(o){return P(r),k(n.onClienteSelected(o.option.value))}),N(18,Fx,3,3,"mat-option",20),F(19,"async"),N(20,Ax,2,0,"mat-option",21),F(21,"async"),s()(),l(22,"datalist",22),N(23,Ox,1,1,"option",20),s()(),l(24,"div",23)(25,"label",24),d(26,"Tel.:"),s()(),l(27,"div",25)(28,"input",26),ee("ngModelChange",function(o){return P(r),Z(n.telefonoCliente,o)||(n.telefonoCliente=o),k(o)}),w("input",function(){return P(r),k(n.buscarCliente())}),s(),N(29,Dx,2,1,"button",27),s(),l(30,"div",28),N(31,Rx,2,1,"span",29),s(),N(32,Nx,4,1,"div",30),l(33,"div",31)(34,"button",32),w("click",function(){return P(r),k(n.abrirModalConsultaPrecio())}),d(35,"Consultar Precio"),s()()(),l(36,"div",33)(37,"h2",34),d(38,"Producto:"),s(),l(39,"input",35,1),ee("ngModelChange",function(o){return P(r),Z(n.codigoBarras,o)||(n.codigoBarras=o),k(o)}),w("keyup.enter",function(){return P(r),k(n.agregarProductoPorCodigo())}),s(),l(41,"mat-form-field",36)(42,"mat-label"),d(43,"Buscar C\xF3d. barras"),s(),l(44,"input",37),ee("ngModelChange",function(o){return P(r),Z(n.busquedaPorCodigo,o)||(n.busquedaPorCodigo=o),k(o)}),w("input",function(){return P(r),k(n.filtrarPorCodigo())}),s(),l(45,"mat-autocomplete",19,2),w("optionSelected",function(o){return P(r),k(n.seleccionarPorCodigo(o))}),N(47,Bx,2,3,"mat-option",20),s()(),l(48,"mat-form-field",38)(49,"mat-label"),d(50,"Buscar producto"),s(),l(51,"input",37),ee("ngModelChange",function(o){return P(r),Z(n.busquedaProducto,o)||(n.busquedaProducto=o),k(o)}),w("input",function(){return P(r),k(n.filtrarProductos())}),s(),l(52,"mat-autocomplete",19,3),w("optionSelected",function(o){return P(r),k(n.seleccionarProducto(o))}),N(54,Lx,2,2,"mat-option",20),s()(),l(55,"button",39),w("click",function(){return P(r),k(n.limpiarProducto())}),y(56,"i",40),s()(),N(57,d2,13,5,"div",41),l(58,"div",42)(59,"table",43)(60,"colgroup"),y(61,"col",44)(62,"col",45)(63,"col",46)(64,"col",47)(65,"col",48)(66,"col",49)(67,"col",50)(68,"col",51)(69,"col",52)(70,"col",53)(71,"col",54),s(),l(72,"thead")(73,"tr")(74,"th",44),d(75,"Acc."),s(),l(76,"th",45),d(77,"Imagen"),s(),l(78,"th"),d(79,"Producto / ubic."),s(),l(80,"th"),d(81,"Cant."),s(),l(82,"th"),d(83,"P. U."),s(),l(84,"th"),d(85,"Imp. normal"),s(),l(86,"th"),d(87,"Promo"),s(),l(88,"th"),d(89,"% desc."),s(),l(90,"th"),d(91,"Moned."),s(),l(92,"th"),d(93,"Desc."),s(),l(94,"th"),d(95,"Precio Final"),s()()(),l(96,"tbody"),N(97,u2,39,30,"tr",55),s()()(),l(98,"div",56)(99,"div",57),d(100),s(),l(101,"div",58),d(102),F(103,"currency"),s(),l(104,"div",58),d(105),F(106,"currency"),s(),l(107,"div",59),d(108),F(109,"currency"),s()(),N(110,m2,7,0,"div",60)(111,p2,4,1,"div",61),s(),l(112,"form",62,4),w("ngSubmit",function(){return P(r),k(n.finalizarVenta())}),N(114,b2,42,23,"div",41),s(),N(115,y2,2,1,"div",63)}if(e&2){let r,a=Gt(17),o=Gt(46),u=Gt(53);c(8),J("ngModel",n.thumbScale),c(),p("ngForOf",n.scales),c(6),p("formControl",n.clienteNombreCtrl)("matAutocomplete",a),c(),p("displayWith",n.displayCliente),c(2),p("ngForOf",se(19,36,n.filteredClientes$)),c(2),p("ngIf",((r=se(21,38,n.filteredClientes$))==null?null:r.length)===0),c(3),p("ngForOf",n.opcionesClientes),c(5),J("ngModel",n.telefonoCliente),c(),p("ngIf",n.telefonoCliente),c(2),p("ngIf",n.nombreCliente),c(),p("ngIf",n.carrito.length>0),c(7),J("ngModel",n.codigoBarras),p("disabled",n.mostrarModalPago),Ye("tabindex",n.mostrarModalPago?-1:0),c(5),J("ngModel",n.busquedaPorCodigo),p("matAutocomplete",o),c(),p("displayWith",n.displayCodigo),c(2),p("ngForOf",n.productosFiltradosPorCodigo),c(4),J("ngModel",n.busquedaProducto),p("matAutocomplete",u),c(),p("displayWith",n.displayNombre),c(2),p("ngForOf",n.productosFiltrados),c(3),p("ngIf",n.mostrarModalConsultaPrecio),c(),Ri("--thumb-scale",n.thumbScale),c(39),p("ngForOf",n.carrito)("ngForTrackBy",n.trackByProducto),c(3),R("Total de art\xEDculos: ",n.totalArticulos,""),c(2),R("Abono al Monedero: ",se(103,40,n.totalAlmonedero),""),c(3),R("Usted ahorr\xF3: ",se(106,42,n.totalDescuento),""),c(3),R("Total: ",se(109,44,n.total),""),c(2),p("ngIf",n.carrito.length),c(),p("ngIf",n.ventasPausadas.length),c(3),p("ngIf",n.mostrarModalPago),c(),p("ngIf",n.mostrarTicket&&n.ventaParaImpresion)}},dependencies:[Oe,We,Ne,Ws,Bt,ot,At,rt,at,qe,qt,li,nt,ze,Ft,Bi,Yn,_t,Tr,Lt,Gs,ti,ei,ml,ja,fl,Ra,ea,La,nl,il,Vf,Ba,dt],styles:[".ventas-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.cliente[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.cliente-tel[_ngcontent-%COMP%]{font-size:large}.cliente-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:700;padding:10px 15px;border-radius:5px;margin-left:15px}.consultar-precio[_ngcontent-%COMP%]{margin-left:auto}.productos-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;flex-wrap:wrap;border-bottom:2px solid #0453b3}.productos-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.productos-container[_ngcontent-%COMP%]   .subtitulo[_ngcontent-%COMP%]{margin:0 6px 0 0}.input-text.input-cb[_ngcontent-%COMP%]{height:40px;padding:8px 10px;width:180px;margin-right:5rem}.wide-field[_ngcontent-%COMP%]{width:400px}.wider-field[_ngcontent-%COMP%]{width:340px}.wide-client[_ngcontent-%COMP%]{width:360px}.mr-field[_ngcontent-%COMP%]{margin-right:5rem}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}[_nghost-%COMP%]     .compact-field{transform:translateY(10px)}.total-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;margin-top:10px;padding:10px;border-top:2px solid #ccc;font-size:16px;line-height:1.5}.left[_ngcontent-%COMP%]{text-align:left;font-size:xx-large;color:#8a2be2}.center[_ngcontent-%COMP%]{text-align:center}.right[_ngcontent-%COMP%]{text-align:right;font-size:xx-large;color:#8a2be2}.botones-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px}.botones-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:45px;min-width:130px;font-size:16px;padding:6px 12px;border-radius:8px;vertical-align:middle;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 5px 15px #0000004d;text-align:center;width:400px;align-items:center;background-color:var(--fondo-modal);padding:5px}.select[_ngcontent-%COMP%]{width:300px;height:41px}.input-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1000;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.modal-dialog[_ngcontent-%COMP%]{width:400px;margin:auto}.show-modal[_ngcontent-%COMP%]{display:block!important}.input-field[_ngcontent-%COMP%]{flex-grow:1;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}.deshabilitado[_ngcontent-%COMP%]{opacity:.5!important;cursor:not-allowed!important;pointer-events:none!important}.cambio[_ngcontent-%COMP%]{font-size:30px;color:#030753;font-weight:700}.total-pago[_ngcontent-%COMP%]{font-size:20px;color:#030753;font-weight:700}.modal-body[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{text-align:left!important}.monedero-container[_ngcontent-%COMP%]{padding-top:1rem;border-top:1px solid rgb(3,7,83);border-bottom:1px solid rgb(3,7,83);color:#030753}.btns-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between!important;width:90%;border-top:1px solid rgb(3,7,83);padding:1rem}.button-container[_ngcontent-%COMP%]{flex-grow:1;text-align:center}.mr-2[_ngcontent-%COMP%]{margin-right:8px!important}.btn[_ngcontent-%COMP%]{width:1.7rem;margin-right:15px}.ventas-container[_ngcontent-%COMP%]{--thumb-w-base: 56px;--thumb-h-base: 56px;--thumb-w: calc(var(--thumb-w-base) * var(--thumb-scale));--thumb-h: calc(var(--thumb-h-base) * var(--thumb-scale))}.tabla[_ngcontent-%COMP%]{table-layout:fixed;width:100%}col.col-acciones[_ngcontent-%COMP%]{width:48px}col.col-img[_ngcontent-%COMP%]{width:var(--thumb-w)}col.col-cant[_ngcontent-%COMP%]{width:65px}col.col-precio[_ngcontent-%COMP%]{width:80px}col.col-imp-normal[_ngcontent-%COMP%]{width:110px}col.col-promo[_ngcontent-%COMP%]{width:160px}col.col-desc-porc[_ngcontent-%COMP%]{width:165px}col.col-monedero[_ngcontent-%COMP%]{width:75px}col.col-desc[_ngcontent-%COMP%]{width:80px}col.col-precio-final[_ngcontent-%COMP%]{width:115px}col.col-producto[_ngcontent-%COMP%]{width:auto}.col-img[_ngcontent-%COMP%]{text-align:center;padding:0}.img-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.img-button[_ngcontent-%COMP%]{background:transparent;border:0;padding:4px;position:relative;line-height:0;display:inline-block;width:var(--thumb-w)!important;height:var(--thumb-h)!important;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%!important;height:100%!important;object-fit:contain!important;max-width:100%}.col-acciones[_ngcontent-%COMP%]{text-align:center}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;align-items:center;justify-content:center}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row}}.img-button[_ngcontent-%COMP%]   .zoom-corner[_ngcontent-%COMP%]{position:absolute;right:6px;bottom:6px;background:#0000008c;color:#fff;border-radius:4px;padding:2px 4px;font-size:12px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:auto}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{vertical-align:middle}.consulta-img-wrap[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:8px 0 6px}.consulta-img-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:70%;max-height:220px;object-fit:contain;border-radius:6px;box-shadow:0 2px 10px #00000040}.col-acciones[_ngcontent-%COMP%]{width:48px;min-width:48px;text-align:center;vertical-align:middle}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row;gap:8px}}.col-img[_ngcontent-%COMP%]{width:calc(var(--thumb-col-base) * var(--thumb-scale));min-width:calc(var(--thumb-col-base) * var(--thumb-scale))}.col-cant[_ngcontent-%COMP%]{width:70px}.col-precio[_ngcontent-%COMP%]{width:100px}.col-imp-normal[_ngcontent-%COMP%]{width:120px}.col-promo[_ngcontent-%COMP%]{width:150px}.col-desc-porc[_ngcontent-%COMP%], .col-monedero[_ngcontent-%COMP%]{width:80px}.col-desc[_ngcontent-%COMP%]{width:100px}.col-precio-final[_ngcontent-%COMP%]{width:120px}.col-producto[_ngcontent-%COMP%]{width:auto}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){white-space:normal;overflow-wrap:anywhere;line-height:1.3}.tabla[_ngcontent-%COMP%]   td.col-precio[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-imp-normal[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-monedero[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-desc[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-precio-final[_ngcontent-%COMP%]{text-align:right}.titulo-row[_ngcontent-%COMP%]{margin-bottom:6px}.scale-select[_ngcontent-%COMP%]{width:120px}@media (max-width: 576px){.scale-select[_ngcontent-%COMP%]{width:100px}}"]})};function C2(i,t){if(i&1&&(l(0,"div",3),d(1," Resta: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function S2(i,t){if(i&1&&(l(0,"div",3),d(1," Pago final: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function w2(i,t){if(i&1&&(l(0,"div",3),d(1," Dinero devuelto: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Q(4,1,e.pedido.pedido.aCuenta,"1.2-2"),"")}}function E2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido pronto se entregar\xE1"),s()())}function T2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido le ha sido entregado"),s()())}function P2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido fue CANCELADO"),s()())}var Uo=class i{pedido;get header(){return this.pedido.farmacia}get detalle(){return this.pedido.pedido}get cliente(){return this.pedido.cliente}get usuario(){return this.pedido.usuario}get mov(){return this.pedido.movimiento}fechaActual=new Date;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-pedido-ticket"]],inputs:{pedido:"pedido"},decls:36,vars:23,consts:[["id","ticketPedido",1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"farmacia"],[1,"info-pedido"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["style","text-align: center;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[2,"text-align","center"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"div",2)(3,"div"),d(4,"Pedido: "),l(5,"strong"),d(6),s()(),l(7,"div",3),d(8,"Total: "),l(9,"strong"),d(10),F(11,"number"),s()(),l(12,"div",3),d(13,"Anticipo: "),l(14,"strong"),d(15),F(16,"number"),s()(),N(17,C2,5,4,"div",4)(18,S2,5,4,"div",4)(19,w2,5,4,"div",4),y(20,"hr"),N(21,E2,3,0,"div",5)(22,T2,3,0,"div",5)(23,P2,3,0,"div",5),y(24,"hr"),l(25,"div",6)(26,"div",7),d(27),s(),d(28),F(29,"date"),y(30,"br"),d(31),y(32,"br"),d(33),s(),y(34,"hr")(35,"app-ticket-footer"),s()()),e&2&&(c(),p("farmacia",n.header),c(5),T(n.pedido.pedido.descripcion),c(4),R("$",Q(11,14,n.pedido.pedido.total,"1.2-2"),""),c(5),R("$",Q(16,17,n.pedido.pedido.aCuenta,"1.2-2"),""),c(2),p("ngIf",n.pedido.movimiento==="agregar"),c(),p("ngIf",n.pedido.movimiento==="surtir"),c(),p("ngIf",n.pedido.movimiento==="cancelar"),c(2),p("ngIf",n.pedido.movimiento==="agregar"),c(),p("ngIf",n.pedido.movimiento==="surtir"),c(),p("ngIf",n.pedido.movimiento==="cancelar"),c(4),R("Folio pedido: ",n.pedido.pedido.folio,""),c(),R(" Fecha: ",Q(29,20,n.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",n.pedido.usuario,""),c(2),R(" Cliente: ",n.pedido.cliente||"P\xFAblico general"," "))},dependencies:[Oe,Ne,wt,Nt,tr,er],styles:[".info-general[_ngcontent-%COMP%]{font-size:14px!important}.info-pedido[_ngcontent-%COMP%]{font-size:16px!important}"]})};var Je=hi(ki());var Ge=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}(Ge||{}),wn="*";function na(i,t){return{type:Ge.Trigger,name:i,definitions:t,options:{}}}function ra(i,t=null){return{type:Ge.Animate,styles:t,timings:i}}function gp(i,t=null){return{type:Ge.Sequence,steps:i,options:t}}function mn(i){return{type:Ge.Style,styles:i,offset:null}}function nr(i,t,e){return{type:Ge.State,name:i,styles:t,options:e}}function aa(i,t,e=null){return{type:Ge.Transition,expr:i,animation:t,options:e}}var ir=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(t=0,e=0){this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},ia=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(t){this.players=t;let e=0,n=0,r=0,a=this.players.length;a==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++e==a&&this._onFinish()}),o.onDestroy(()=>{++n==a&&this._onDestroy()}),o.onStart(()=>{++r==a&&this._onStart()})}),this.totalTime=this.players.reduce((o,u)=>Math.max(o,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){let e=t*this.totalTime;this.players.forEach(n=>{let r=n.totalTime?Math.min(1,e/n.totalTime):1;n.setPosition(r)})}getPosition(){let t=this.players.reduce((e,n)=>e===null||n.totalTime>e.totalTime?n:e,null);return t!=null?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},za="!";var Ga=class i{constructor(t){this.http=t}apiUrl=`${He.apiUrl}/pedidos/`;obtenerPedidos(t,...e){let n;if(typeof t=="string"){let[o,u,m,f,h,g]=e;n={farmaciaId:t,fechaIni:o,fechaFin:u,folio:m,estado:f,descripcion:h,descripcionMinima:g}}else n=t;let r=new Ht().set("farmacia",n.farmaciaId),a=(o,u)=>{if(!o||!u)return;let m=new Date(o);r=r.set(u,m.toISOString().slice(0,10))};return a(n.fechaIni,"fechaInicio"),a(n.fechaFin,"fechaFin"),n.folio&&/^[A-Za-z0-9]{6}$/.test(n.folio)&&(r=r.set("folio",n.folio)),n.estado&&(r=r.set("estado",n.estado)),n.descripcion&&(r=r.set("descripcion",n.descripcion)),n.descripcionMinima!==void 0&&(r=r.set("descripcionMinima",String(!!n.descripcionMinima))),n.page&&(r=r.set("page",String(n.page))),n.limit&&(r=r.set("limit",String(n.limit))),n.sortBy&&(r=r.set("sortBy",n.sortBy)),n.sortDir&&(r=r.set("sortDir",(n.sortDir||"desc").toLowerCase())),n.clienteNombre&&(r=r.set("clienteNombre",n.clienteNombre)),n.clienteNull!==void 0&&(r=r.set("clienteNull",String(!!n.clienteNull))),this.http.get(this.apiUrl,{params:r})}agregarPedido(t){return this.http.post(this.apiUrl,t)}surtirPedido(t){let e=localStorage.getItem("auth_token"),n=new Qe({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}surtir`,t,{headers:n})}cancelarPedido(t){let e=localStorage.getItem("auth_token"),n=new Qe({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}cancelar`,t,{headers:n})}actualizarCostoPedido(t,e){return this.http.patch(`${this.apiUrl}actualizar-costo/${t}`,{costo:e})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var k2=["contenedorTicket"],I2=["ticketPedidoRef"];function M2(i,t){if(i&1){let e=ae();l(0,"button",22),w("click",function(){P(e);let r=_();return k(r.limpiarFiltroCompleto())}),y(1,"i",23),s()}}function F2(i,t){if(i&1){let e=ae();l(0,"button",24),w("click",function(){P(e);let r=_();return k(r.buscarSinFolio())}),d(1,"Buscar"),s()}if(i&2){let e=_();p("disabled",e.pedidos.length>0)}}function A2(i,t){i&1&&(l(0,"h2",25),d(1,"Pedidos pendientes de entrega"),s())}function O2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Levant\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T(e.usuarioPidio.nombre),c(2),R("",Ni(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")," ")}}function D2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Surti\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T(e.usuarioSurtio.nombre),c(2),R("",Ni(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City")," ")}}function R2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Cancel\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T(e.usuarioCancelo.nombre),c(2),R("",Ni(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City")," ")}}function N2(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td",38)(2,"button",31),w("click",function(){P(e);let r=_(2).$implicit,a=_(2);return k(a.surtirPedido(r))}),y(3,"fa-icon",17),s()(),l(4,"td",38)(5,"button",32),w("click",function(){P(e);let r=_(2).$implicit,a=_(2);return k(a.CancelarPedido(r))}),y(6,"i",23),s()()()}i&2&&(c(3),p("icon","shopping-cart"))}function B2(i,t){if(i&1&&(l(0,"tr")(1,"td",35)(2,"div",36)(3,"table",37)(4,"thead")(5,"tr")(6,"th",38),d(7),s(),l(8,"th",38),d(9),F(10,"currency"),s()()(),l(11,"tbody")(12,"tr")(13,"td",39),d(14),F(15,"currency"),s(),l(16,"td",39),d(17),F(18,"currency"),s()(),l(19,"tr")(20,"td"),d(21,"Efectivo:"),s(),l(22,"td"),d(23),F(24,"currency"),s(),l(25,"td"),d(26,"Efectivo:"),s(),l(27,"td"),d(28),F(29,"currency"),s()(),l(30,"tr")(31,"td"),d(32,"Tarjeta:"),s(),l(33,"td"),d(34),F(35,"currency"),s(),l(36,"td"),d(37,"Tarjeta:"),s(),l(38,"td"),d(39),F(40,"currency"),s()(),l(41,"tr")(42,"td"),d(43,"Transferencia:"),s(),l(44,"td"),d(45),F(46,"currency"),s(),l(47,"td"),d(48,"Transferencia:"),s(),l(49,"td"),d(50),F(51,"currency"),s()(),l(52,"tr")(53,"td"),d(54,"Monedero:"),s(),l(55,"td"),d(56),F(57,"currency"),s(),l(58,"td"),d(59,"Monedero"),s(),l(60,"td"),d(61),F(62,"currency"),s()(),N(63,O2,8,6,"tr",34)(64,D2,8,6,"tr",34)(65,R2,8,6,"tr",34)(66,N2,7,1,"tr",34),s()()()()()),i&2){let e=_().$implicit,n=_(2);c(7),R("Estado: ",e.estado,""),c(2),R("Precio: ",se(10,16,e.total),""),c(5),R("Anticipo: ",se(15,18,e.aCuenta),""),c(3),R("Resta: ",se(18,20,e.resta),""),c(6),T(se(24,22,e.pagoACuenta.efectivo)),c(5),T(se(29,24,e.pagoResta.efectivo)),c(6),T(se(35,26,e.pagoACuenta.tarjeta)),c(5),T(se(40,28,e.pagoResta.tarjeta)),c(6),T(se(46,30,e.pagoACuenta.transferencia)),c(5),T(se(51,32,e.pagoResta.transferencia)),c(6),T(se(57,34,e.pagoACuenta.vale)),c(5),T(se(62,36,e.pagoResta.vale)),c(2),p("ngIf",n.esAdmin),c(),p("ngIf",e.estado==="entregado"&&n.esAdmin),c(),p("ngIf",e.estado==="cancelado"&&n.esAdmin),c(),p("ngIf",e.estado==="inicial")}}function L2(i,t){if(i&1){let e=ae();Ze(0),l(1,"tr")(2,"td")(3,"button",28),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.pedidoDetalleAbiertoId===r._id?a.cerrarDetallePedido(r):a.abrirDetallePedido(r))}),y(4,"fa-icon",29),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"date"),s(),l(10,"td"),d(11),s(),l(12,"td"),d(13),s(),l(14,"td"),d(15),F(16,"currency"),s(),l(17,"td"),d(18),F(19,"currency"),s(),l(20,"td"),d(21),F(22,"currency"),s(),l(23,"td",30)(24,"button",31),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.surtirPedido(r))}),y(25,"fa-icon",17),s(),l(26,"button",32),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.CancelarPedido(r))}),y(27,"i",23),s(),l(28,"button",33),w("click",function(){P(e);let r=_(2);return k(r.limpiarFiltroCompleto())}),y(29,"fa-icon",17),s()()(),N(30,B2,67,38,"tr",34),et()}if(i&2){let e=t.$implicit,n=_(2);c(3),p("matTooltip",n.pedidoDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),c(),p("icon",n.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",n.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),T(e.folio),c(2),T(Ni(9,13,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),c(3),T((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),c(2),T(e.descripcion),c(2),T(se(16,17,e.total)),c(3),T(se(19,19,e.aCuenta)),c(3),T(se(22,21,e.resta)),c(4),p("icon","shopping-cart"),c(4),p("icon","eye-slash"),c(),p("ngIf",n.pedidoDetalleAbiertoId===e._id)}}function V2(i,t){if(i&1&&(l(0,"table",26)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th"),d(7,"F. pedido"),s(),l(8,"th"),d(9,"Cliente"),s(),l(10,"th"),d(11,"Descripci\xF3n"),s(),l(12,"th"),d(13,"Precio"),s(),l(14,"th"),d(15,"A cuenta"),s(),l(16,"th"),d(17,"Resta"),s(),l(18,"th"),d(19,"Acciones"),s()()(),l(20,"tbody"),N(21,L2,31,23,"ng-container",27),s()()),i&2){let e=_();c(21),p("ngForOf",e.pedidos)}}function U2(i,t){i&1&&(l(0,"p",41),d(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),s())}function j2(i,t){if(i&1&&(l(0,"div",42),y(1,"app-pedido-ticket",43),s()),i&2){let e=t.ngIf;c(),p("pedido",e)}}var gl=class i{constructor(t,e,n,r,a,o){this.library=t;this.pedidosService=e;this.authService=n;this.clienteService=r;this.FarmaciaService=a;this.cdr=o;this.library.addIcons(Cn,Da,Oa,vi)}contenedorTicket;pedidoTicketComp;ticketPedidoRef;pedidos=[];filtroFolio="";filtroDescripcion="";filtroFechaPedido="";esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmaciaId=null;farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";farmaciaImagen="";titulo1="";titulo2="";usuarioId="";usuarioRol="";usuarioNombre="";firmaAutorizada="";yaImprimio=!1;paraGuardar=null;folioGenerado=null;faTimes=vi;mostrarTicket=!1;paraImpresion=null;ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){Je.default.fire("Error","No se encontr\xF3 la farmacia en localStorage","error");return}e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaTelefono=e.telefono,this.farmaciaDireccion=e.direccion,this.farmaciaImagen=e.imagen,this.titulo1=e.titulo1,this.titulo2=e.titulo2);let n=this.authService.getUserData(),r=n?.rol,a=n?.nombre,o=n?.id;this.usuarioId=o,this.usuarioRol=r,this.usuarioNombre=a}formatearFecha(t){let e=new Date(t),n=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${n}/${r}/${a}`}obtenerPedido(t){if(!this.farmaciaId){Je.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio=t.trim(),/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.pedidosService.obtenerPedidos(this.farmaciaId,void 0,void 0,this.filtroFolio,"inicial").subscribe({next:e=>{this.pedidos=e.pedidos},error:e=>{console.error("Error al buscar por folio:",e),this.pedidos=[]}}):this.pedidos=[]}buscarSinFolio(){return Ae(this,null,function*(){if(!this.farmaciaId){Je.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio="";let t=this.filtroFechaPedido,e=this.filtroDescripcion?.trim();if(!t||!e){yield Je.default.fire("Campos incompletos","Debes proporcionar fecha y descripci\xF3n para buscar sin folio.","warning");return}if(e.length<5){yield Je.default.fire({icon:"info",title:"Descripci\xF3n muy corta",text:"Ingresa al menos 5 caracteres.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.pedidosService.obtenerPedidos(this.farmaciaId,t,void 0,void 0,"inicial",e,!0).subscribe({next:n=>{this.filtroFechaPedido="",this.filtroDescripcion="",!n.pedidos||n.pedidos.length===0?(Je.default.fire({icon:"info",title:"No encontrado",text:`El d\xEDa ${t} no existe un pedido pendiente de entrega de ${e}`,timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[]):this.pedidos=n.pedidos},error:n=>{console.error("Error al buscar sin folio:",n),Je.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.filtroFechaPedido="",this.filtroDescripcion=""}})})}limpiarFiltro(){this.filtroFolio=""}limpiarFiltroCompleto(){return Ae(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroDescripcion="",this.pedidos=[]})}CancelarPedido(t){return Ae(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){yield Je.default.fire({icon:"success",title:"En pedidos entregados, NO se aceptan cancelaciones",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(t.estado==="cancelado"){yield Je.default.fire({icon:"success",title:"El pedido ya fue cancelado con anterioridad.",html:`Fecha: ${this.formatearFecha(t.fechaCancelacion)}<br><br>Cancelado por: ${t.usuarioCancelo?.nombre||"\u2014"}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(this.nombreCliente=t?.cliente?t.cliente.nombre:"P\xFAblico general",!(yield Je.default.fire({icon:"question",title:`Cancelar: ${t.folio}`,html:`<p><strong>Cliente:</strong></p><p><strong>${this.nombreCliente}</strong></p><p><strong>\xBFRealmente deseas CANCELAR el pedido de:</strong></p><p><strong>${t.descripcion}?</strong></p>`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed||!(yield Je.default.fire({title:"Autorizaci\xF3n requerida",html:`
      <p style="color:#030753">Debes devolver en efectivo: <strong>$${(t.aCuenta-t.pagoACuenta.vale).toFixed(2)}</strong></p>
      <p style="color:#030753">Debes devolver en monedero: <strong>$${t.pagoACuenta.vale.toFixed(2)}</strong></p>
      <div id="firma-container"></div>
    `,didOpen:()=>{let m=document.createElement("input");m.type="text",m.id="firma-autorizada",m.placeholder="Ingrese la firma",m.autocomplete="off",m.autocapitalize="off",m.spellcheck=!1,m.className="swal2-input",m.style.fontFamily="text-security-disc, sans-serif",m.style.webkitTextSecurity="disc",m.name="firma_"+Date.now(),m.focus(),document.getElementById("firma-container")?.appendChild(m)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Ae(this,null,function*(){let m=Je.default.getConfirmButton(),f=document.getElementById("firma-autorizada")?.value?.trim();if(!f)return Je.default.showValidationMessage("Debes ingresar la firma para continuar."),!1;try{return(yield gi(this.FarmaciaService.verificarFirma(this.farmaciaId,f))).autenticado?!0:(Je.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),!1)}catch(h){return console.error(h),Je.default.showValidationMessage("Error al verificar la firma."),!1}finally{m&&(m.disabled=!1)}})})).isConfirmed)return;let r=Fr(this.farmaciaImagen||this.user_farmacia?.imagen||""),a="";try{a=yield Ar(r)}catch{a=r}let o={nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono,titulo1:this.titulo1||"",titulo2:this.titulo2||"",imagen:a};this.paraImpresion={movimiento:"cancelar",pedido:Ke({},t),cliente:this.nombreCliente,usuario:this.usuarioNombre,farmacia:o};let u=()=>{let m={folio:t.folio};this.pedidosService.cancelarPedido(m).subscribe({next:()=>{Je.default.fire({icon:"success",title:"Pedido cancelado correctamente",timer:1600,timerProgressBar:!0}),this.limpiarFiltroCompleto()},error:f=>{console.error("Error al cancelar pedido:",f),Je.default.fire({icon:"error",title:"Error",text:f.error?.mensaje||"No se pudo cancelar el pedido"})}})};this.mostrarTicket=!0,this.cdr.detectChanges(),yield ta();{let m=document.getElementById("ticketPedido");m&&(yield Wa(m))}this.mostrarTicket=!1,u()})}surtirPedido(t){return Ae(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){yield Je.default.fire({icon:"success",title:"El pedido ya fue entregado",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}t.cliente?(this.nombreCliente=t.cliente.nombre,this.idCliente=t.cliente._id,this.totalMonedero=t.cliente.totalMonedero):(this.nombreCliente="P\xFAblico general",this.idCliente="",this.totalMonedero=0);let e=yield this.mostrarModalPago(t.resta,"Captura del resto","Faltante","Guardar");if(!e)return;let n={folio:t.folio,pagoResta:{efectivo:t.resta-(e.tarjeta+e.transferencia+e.vale),tarjeta:e.tarjeta,transferencia:e.transferencia,vale:e.vale}},r=Wt(Ke({},t),{pagoResta:Ke({},n.pagoResta)}),a=Fr(this.farmaciaImagen||this.user_farmacia?.imagen||""),o="";try{o=yield Ar(a)}catch{o=a}let u={nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono,titulo1:this.titulo1||"",titulo2:this.titulo2||"",imagen:o};this.paraImpresion={movimiento:"surtir",pedido:r,cliente:this.nombreCliente,usuario:this.usuarioNombre,farmacia:u};let m=()=>{this.pedidosService.surtirPedido(n).subscribe({next:()=>Ae(this,null,function*(){yield Je.default.fire({icon:"success",title:"\xC9xito",html:"<h3>Pedido surtido y registrado correctamente</h3>",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto()}),error:f=>{console.error("Error al surtir pedido:",f),Je.default.fire({icon:"error",title:"Error",text:f.error?.mensaje||"No se pudo surtir el pedido"})}})};this.mostrarTicket=!0,this.cdr.detectChanges(),yield ta();{let f=document.getElementById("ticketPedido");f&&(yield Wa(f))}this.mostrarTicket=!1,m()})}isPrinting=!1;agregarPedido(){return Ae(this,null,function*(){if(!this.isPrinting){this.isPrinting=!0;try{this.pedidoDetalleAbiertoId=null;let t=yield this.capturarCliente();if(t===null)return;let e=t==="sin-cliente"?null:t._id;t==="sin-cliente"?(this.nombreCliente="P\xFAblico general",this.totalMonedero=0):(this.nombreCliente=t.nombre,this.totalMonedero=t.totalMonedero);let n=yield this.solicitarDatosPedido();if(!n)return;let{descripcion:r,total:a,anticipo:o}=n,u=yield this.mostrarModalPago(o,"Captura del pago a cuenta","Anticipo","Imprimir");if(!u)return;let m=u.efectivo+u.tarjeta+u.transferencia+u.vale,f=this.folioGenerado||this.generarFolioLocal();this.folioGenerado=f,this.paraGuardar={folio:f,farmacia:this.farmaciaId,clienteId:e,usuarioPidio:this.usuarioId,descripcion:r,total:a,aCuenta:m,pagoACuenta:u};let h=Fr(this.farmaciaImagen||this.user_farmacia?.imagen||""),g="";try{g=yield Ar(h)}catch{g=h}let x={nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono,titulo1:this.titulo1||"",titulo2:this.titulo2||"",imagen:g};this.paraImpresion={movimiento:"agregar",pedido:this.paraGuardar,cliente:this.nombreCliente,usuario:this.usuarioNombre,farmacia:x};let b=()=>this.guardarPedido();this.mostrarTicket=!0,this.cdr.detectChanges(),yield ta();{let S=document.getElementById("ticketPedido");S&&(yield Wa(S))}this.mostrarTicket=!1,b()}finally{this.isPrinting=!1}}})}guardarPedido(){this.pedidosService.agregarPedido(this.paraGuardar).subscribe({next:t=>Ae(this,null,function*(){yield Je.default.fire({icon:"success",title:"\xC9xito",html:"<h3><strong>Pedido agregado correctamente</strong></h3>",confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto(),this.folioGenerado=""}),error:t=>{let e=t.error?.mensaje||t.error?.message||"Falla en el sistema";Je.default.fire({icon:"error",title:"Error al registrar pedido",html:`<p>${e}</p>
                  <p><strong>No se registr\xF3 el pedido</strong></p>`,confirmButtonText:"Continuar",allowOutsideClick:!1,allowEscapeKey:!1})}})}yyyymmddLocal(t=new Date){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}${n}`}generarFolioLocal(){let t="FBPed",e=this.yyyymmddLocal(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";for(let a=0;a<6;a++){let o=Math.floor(Math.random()*n.length);r+=n[o]}return`${t}${e}-${r}`}solicitarDatosPedido(){return Ae(this,null,function*(){let{value:t}=yield Je.default.fire({title:"Nuevo pedido",html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><input id="swal-input-descripcion" class="swal2-input" placeholder="Descripci\xF3n del pedido"><input id="swal-input-total" class="swal2-input" type="number" min="0" placeholder="Total $"><input id="swal-input-anticipo" class="swal2-input" type="number" min="0" placeholder="Anticipo $">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let e=document.getElementById("swal-input-descripcion").value.trim(),n=document.getElementById("swal-input-total").value.trim(),r=parseFloat(n),a=document.getElementById("swal-input-anticipo").value.trim(),o=parseFloat(a);if(!e||isNaN(r)||r<=0||isNaN(o)||o<=0){Je.default.showValidationMessage("Completa todos los campos correctamente");return}if(o>r){Je.default.showValidationMessage("El anticipo no puede ser mayor que el total a pagar");return}return{descripcion:e,total:r,anticipo:o}}});return t||null})}mostrarModalPago(t,e,n,r){return Ae(this,null,function*(){let{value:a}=yield Je.default.fire({title:e,html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><h2><strong>${n} a pagar:</strong> $${t}</h2><input id="swal-efectivo" type="number" class="swal2-input" placeholder="Efectivo" min="0"><input id="swal-tarjeta" type="number" class="swal2-input" placeholder="Tarjeta" min="0"><input id="swal-transferencia" type="number" class="swal2-input" placeholder="Transferencia" min="0">`+(this.totalMonedero>0?`<label style="color: rgb(3, 7, 83); font-weight: bold; font-size: large; display: block; margin-top: 14px;">
                    Tiene en monedero: $${this.totalMonedero.toFixed(2)}
            </label>
            <input id="swal-vale" type="number" class="swal2-input" style="margin-top: 2px; width: 50%"
              placeholder="monedero"
              min="0"
              max="${this.totalMonedero}">`:""),focusConfirm:!1,showCancelButton:!0,confirmButtonText:r,cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let o=parseFloat(document.getElementById("swal-efectivo").value)||0,u=parseFloat(document.getElementById("swal-tarjeta").value)||0,m=parseFloat(document.getElementById("swal-transferencia").value)||0,f=document.getElementById("swal-vale"),h=f&&parseFloat(f.value)||0,g=u+m+h;if(h>this.totalMonedero)return Je.default.showValidationMessage(`El monto del monedero no puede ser mayor a $${this.totalMonedero.toFixed(2)}`),!1;if(g>t){Je.default.showValidationMessage(`El pago con tarjeta + transferencia + monedero = $${g} no puede exceder de ($${t})`);return}if(g===t&&o>0){Je.default.showValidationMessage("Revisa bien los montos, el pago es excesivo");return}if(g+o<t){Je.default.showValidationMessage("El pago a\xFAn no es suficiente");return}return{efectivo:o,tarjeta:u,transferencia:m,vale:h}}});if(a){let u=a.efectivo+a.tarjeta+a.transferencia+a.vale-t;a.efectivo=a.efectivo-u,u>0&&(yield Je.default.fire({icon:"info",html:`<h1><strong>$${u.toFixed(2)}</strong></h1>`,title:"favor de entregar el cambio",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}))}return a||null})}capturarCliente(){return Ae(this,null,function*(){for(;;){let t=yield Je.default.fire({title:"Buscar cliente",input:"text",inputLabel:"Tel\xE9fono del cliente (opcional)",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Buscar cliente",denyButtonText:"Continuar sin cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:r=>{let a=r?.trim();return a?/^\d{10}$/.test(a)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":null}});if(t.isDismissed)return null;if(t.isDenied)return"sin-cliente";let e=t.value?.trim();if(!e)continue;let n=yield this.buscarClientePorTelefono(e);if(n){if((yield Je.default.fire({title:"Cliente encontrado",html:`<p style = "color: blue"><strong>${n.nombre}</strong></p><p>\xBFDeseas continuar con este cliente?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return n}else if(yield this.preguntarCrearCliente(e)){let a=yield this.mostrarModalAltaCliente(e);if(a)return a}}})}buscarClientePorTelefono(t){return Ae(this,null,function*(){try{return yield gi(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}preguntarCrearCliente(t){return Ae(this,null,function*(){return(yield Je.default.fire({title:"Cliente no encontrado",text:`\xBFDeseas dar de alta un nuevo cliente con el tel\xE9fono ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, crear",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed})}mostrarModalAltaCliente(t){return Ae(this,null,function*(){let{value:e}=yield Je.default.fire({title:"Nuevo cliente",html:'<input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let r=document.getElementById("swal-input-nombre").value.trim(),a=document.getElementById("swal-input-domicilio").value.trim();if(!r){Je.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:r,domicilio:a}}});if(!e)return null;let n={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let r=yield gi(this.clienteService.crearCliente(n));return Je.default.fire("\xC9xito","Cliente registrado correctamente","success"),r}catch{return Je.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}static \u0275fac=function(e){return new(e||i)(ie(yi),ie(Ga),ie(Kt),ie(Sn),ie(Xt),ie(Dt))};static \u0275cmp=Te({type:i,selectors:[["app-pedidos"]],viewQuery:function(e,n){if(e&1&&(Tt(k2,5),Tt(Uo,5),Tt(I2,5)),e&2){let r;bt(r=yt())&&(n.contenedorTicket=r.first),bt(r=yt())&&(n.pedidoTicketComp=r.first),bt(r=yt())&&(n.ticketPedidoRef=r.first)}},decls:32,vars:12,consts:[[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","align-items-center","filter-container"],[1,"col-md-1","text-end"],["for","filtroFolio",1,"lbl-folio-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-2","position-relative"],["type","text","id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio del pedido","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFolio",1,"lbl-folio-pedido"],[1,"col-md-2"],["type","date",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Descripci\xF3n...","minlength","5","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-md-1"],["class","btn-gris",3,"disabled","click",4,"ngIf"],[1,"col-2","text-end"],["matTooltip","Levantar un pedido",1,"btn-verde",3,"click"],[3,"icon"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["id","ticketPedido","class","ticket-impresion",4,"ngIf"],["matTooltip","Limpiar folio del pedido",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fas","fa-times"],[1,"btn-gris",3,"click","disabled"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[1,"d-flex","gap-1","align-items-center"],["matTooltip","Surtir pedido",1,"btn-verde","btn-icono",3,"click"],["matTooltip","Cancelar pedido",1,"btn-rojo-tache","btn-icono",3,"click"],["matTooltip","Cierra la tabla",1,"btn-gris","btn-icono",3,"click"],[4,"ngIf"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","2",1,"sub-title-tabla"],["colspan","1"],[1,"no-found-error"],["id","ticketPedido",1,"ticket-impresion"],[3,"pedido"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Pedidos"),s()(),l(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Folio:"),s()(),l(8,"div",6)(9,"input",7),ee("ngModelChange",function(a){return Z(n.filtroFolio,a)||(n.filtroFolio=a),a}),w("ngModelChange",function(a){return n.obtenerPedido(a)}),s(),N(10,M2,2,0,"button",8),s(),l(11,"div",4)(12,"label",9),d(13,"Fecha:"),s()(),l(14,"div",10)(15,"input",11),ee("ngModelChange",function(a){return Z(n.filtroFechaPedido,a)||(n.filtroFechaPedido=a),a}),s()(),l(16,"div",4)(17,"label",9),d(18,"Descripci\xF3n:"),s()(),l(19,"div",10)(20,"input",12),ee("ngModelChange",function(a){return Z(n.filtroDescripcion,a)||(n.filtroDescripcion=a),a}),s()(),l(21,"div",13),N(22,F2,2,1,"button",14),s(),l(23,"div",15)(24,"button",16),w("click",function(){return n.agregarPedido()}),d(25," Agregar Pedido "),y(26,"fa-icon",17),s()()(),N(27,A2,2,0,"h2",18)(28,V2,22,1,"table",19)(29,U2,2,0,"p",20),s(),Ze(30),N(31,j2,2,1,"div",21),et()),e&2&&(c(9),J("ngModel",n.filtroFolio),c(),p("ngIf",n.filtroFolio),c(5),J("ngModel",n.filtroFechaPedido),p("disabled",n.pedidos.length>0),c(5),J("ngModel",n.filtroDescripcion),p("disabled",n.pedidos.length>0),c(2),p("ngIf",n.filtroFechaPedido&&n.filtroDescripcion),c(4),p("icon","plus"),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.filtroFolio.length===6&&n.pedidos.length===0),c(2),p("ngIf",n.mostrarTicket&&n.paraImpresion))},dependencies:[ti,ei,ot,qe,ze,Fa,$m,Aa,Xs,_t,Oe,si,We,Ne,Bt,Nt,Uo,Vt,dt],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-folio-pedido[_ngcontent-%COMP%]{font-size:large}"],data:{animation:[na("expandCollapse",[nr("true",mn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",mn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),aa("true <=> false",ra("300ms ease-in-out"))])]}})};var ui=hi(ki());function W2(i,t){if(i&1&&(Ze(0),l(1,"tr")(2,"td",4)(3,"span",13),d(4),s()()(),l(5,"tr")(6,"td"),d(7),F(8,"number"),s(),l(9,"td"),d(10),s(),l(11,"td",6),d(12),F(13,"number"),s()(),l(14,"tr")(15,"td",4),d(16),s()(),et()),i&2){let e=t.$implicit;c(4),R(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),c(3),R("$",Q(8,5,e.precio,"1.2-2"),""),c(3),T(e.cantidad),c(2),R("$",Q(13,8,e.precio*e.cantidad,"1.2-2")," "),c(4),R("Motivo: ",e.motivo,"")}}function H2(i,t){if(i&1&&(l(0,"strong"),d(1),F(2,"number"),s()),i&2){let e=_(3);c(),R("+$",Q(2,1,e.venta.monederoIngreso,"1.2-2"),"")}}function $2(i,t){if(i&1&&(l(0,"span"),d(1," \u2014 "),l(2,"strong"),d(3),F(4,"number"),s(),d(5," (reverso) "),s()),i&2){let e=_(3);c(3),R("-$",Q(4,1,e.venta.monederoReverso,"1.2-2"),"")}}function z2(i,t){if(i&1&&(l(0,"div",6),d(1," Saldo antes: "),l(2,"strong"),d(3),F(4,"number"),s(),d(5," \xA0|\xA0 Saldo final: "),l(6,"strong"),d(7),F(8,"number"),s()()),i&2){let e=_(3);c(3),R("$",Q(4,2,e.venta.monederoSaldoAntes,"1.2-2"),""),c(4),R("$",Q(8,5,e.venta.monederoSaldoDespues,"1.2-2"),"")}}function G2(i,t){if(i&1&&(Ze(0),l(1,"div",6),d(2," Monedero: "),N(3,H2,3,4,"strong",9)(4,$2,6,4,"span",9),s(),N(5,z2,9,8,"div",14),et()),i&2){let e=_(2);c(3),p("ngIf",e.venta.monederoIngreso),c(),p("ngIf",e.venta.monederoReverso&&e.venta.monederoReverso>0),c(),p("ngIf",e.venta.monederoSaldoAntes!==void 0)}}function q2(i,t){if(i&1&&(l(0,"div",15),d(1," Devoluci\xF3n de efectivo: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_(2);c(3),R("$",Q(4,1,e.venta.totalDevolverEfectivo,"1.2-2"),"")}}function X2(i,t){if(i&1&&(l(0,"div",1),y(1,"app-ticket-header",2)(2,"hr"),l(3,"table",3)(4,"thead")(5,"tr")(6,"th",4),d(7,"PRODUCTO DEVUELTO"),s()(),l(8,"tr",5)(9,"th"),d(10,"P.UNIT"),s(),l(11,"th"),d(12,"CANT"),s(),l(13,"th",6),d(14,"IMPORTE"),s()()(),l(15,"tbody"),N(16,W2,17,11,"ng-container",7),s()(),y(17,"hr"),l(18,"div",8)(19,"div",6),d(20," Total: "),l(21,"strong"),d(22),F(23,"number"),s()(),N(24,G2,6,3,"ng-container",9)(25,q2,5,4,"div",10),s(),y(26,"hr"),l(27,"div",11)(28,"div",12),d(29),s(),d(30),F(31,"date"),y(32,"br"),d(33),y(34,"br"),d(35),s(),y(36,"hr")(37,"app-ticket-footer"),s()),i&2){let e=_();c(),p("nombreFarmacia",e.venta.farmacia.nombre)("direccion",e.venta.farmacia.direccion)("telefono",e.venta.farmacia.telefono)("imagen",(e.venta==null||e.venta.farmacia==null?null:e.venta.farmacia.imagen)||e.venta.farmaImagen||"")("titulo1",e.venta.farmacia.titulo1)("titulo2",e.venta.farmacia.titulo2),c(15),p("ngForOf",e.venta.devolucion.productos),c(6),R("$",Q(23,14,e.venta.totalADevolver,"1.2-2"),""),c(2),p("ngIf",e.venta.monederoIngreso||e.venta.monederoReverso),c(),p("ngIf",e.venta.totalDevolverEfectivo>0),c(4),R("Folio venta: ",e.venta.devolucion.folioVenta,""),c(),R(" Fecha devoluci\xF3n: ",Q(31,17,e.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",e.venta.usuario,""),c(2),R(" Cliente: ",e.venta.cliente||"P\xFAblico general"," ")}}var _l=class i{venta;fechaActual=new Date;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-devolucion-ticket"]],inputs:{venta:"venta"},decls:1,vars:1,consts:[["class","ticket-impresion","style","font-family: Roboto Condensed, Arial, sans-serif;",4,"ngIf"],[1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono","imagen","titulo1","titulo2"],[1,"productos"],["colspan","3"],[1,"productos-header-bottom"],[2,"text-align","right"],[4,"ngFor","ngForOf"],[1,"totales"],[4,"ngIf"],["style","text-align: right; font-size: larger;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[1,"producto-nombre"],["style","text-align: right;",4,"ngIf"],[2,"text-align","right","font-size","larger"]],template:function(e,n){e&1&&N(0,X2,38,20,"div",0),e&2&&p("ngIf",n.venta)},dependencies:[Oe,We,Ne,wt,Nt,tr,er],styles:[".info-general[_ngcontent-%COMP%], .totales[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}.productos-header-bottom[_ngcontent-%COMP%]{border-bottom:1px solid black}hr[_ngcontent-%COMP%]{border:none;border-top:1px dashed #000;margin:8px 0}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}"]})};var vl=class i{constructor(t){this.http=t}apiUrl=`${He.apiUrl}`;buscarVentaPorCodigo(t){return this.http.get(`${this.apiUrl}/devoluciones/buscarVenta/${t}`)}registrarDevolucion(t){return this.http.post(`${this.apiUrl}/devoluciones/registrar`,t)}obtenerVentasRecientes(t,e){let n=new Ht;return e&&/^[A-Za-z0-9]{6}$/.test(e)&&(n=n.set("folio",e)),this.http.get(`${this.apiUrl}/ventasRecientes/${t}`,{params:n})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var Y2=["contenedorTicket"],Q2=["ticketDevolucionRef"],J2=i=>({"checkbox-disabled":i});function Z2(i,t){if(i&1){let e=ae();l(0,"button",14),w("click",function(){P(e);let r=_();return k(r.limpiarFolio())}),y(1,"fa-icon",15),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function eb(i,t){i&1&&(l(0,"h2",16),d(1,"Datos de la venta"),s())}function tb(i,t){if(i&1&&(l(0,"option",31),d(1),s()),i&2){let e=t.$implicit,n=t.index;p("ngValue",n),c(),T(e)}}function ib(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td")(2,"input",26),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.seleccionado,r)||(a.seleccionado=r),k(r)}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"currency"),s(),l(10,"td"),d(11),s(),l(12,"td")(13,"input",27),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.cantidadDevuelta,r)||(a.cantidadDevuelta=r),k(r)}),s()(),l(14,"td")(15,"select",28),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.motivoIndex,r)||(a.motivoIndex=r),k(r)}),l(16,"option",29),d(17,"Seleccione motivo"),s(),N(18,tb,2,2,"option",30),s()()()}if(i&2){let e=t.$implicit,n=_(4);c(2),J("ngModel",e.seleccionado),p("disabled",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("ngClass",_i(19,J2,n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Editar cant. a devolver y motivo"),c(2),T(e.producto.nombre),c(2),T(e.cantidad),c(2),T(se(9,17,e.precio)),c(3),T(e.tipoDescuento),c(2),p("max",e.cantidad),J("ngModel",e.cantidadDevuelta),p("disabled",!e.seleccionado||n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Modificar cantidad"),c(2),J("ngModel",e.motivoIndex),p("disabled",!e.seleccionado||n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Elegir motivo"),c(),p("ngValue",null),c(2),p("ngForOf",n.motivosDevolucion)}}function nb(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td",22)(2,"div",23)(3,"h5"),d(4,"Selecciona productos a devolver"),s(),l(5,"table",24)(6,"thead")(7,"tr"),y(8,"th"),l(9,"th"),d(10,"Producto"),s(),l(11,"th"),d(12,"Cant."),s(),l(13,"th"),d(14,"P. U. c/dcto"),s(),l(15,"th"),d(16,"Promo"),s(),l(17,"th"),d(18,"Devolver"),s(),l(19,"th"),d(20,"Motivo de devoluci\xF3n"),s()()(),l(21,"tbody"),N(22,ib,19,21,"tr",18),s()(),l(23,"button",25),w("click",function(){P(e);let r=_().$implicit,a=_(2);return k(a.confirmarDevolucion(r))}),d(24," Confirmar devoluci\xF3n "),s()()()()}if(i&2){let e=_().$implicit;c(22),p("ngForOf",e.productos)}}function rb(i,t){if(i&1){let e=ae();Ze(0),l(1,"tr")(2,"td")(3,"button",19),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.ventaDetalleAbiertoId===r._id?a.cerrarDetalleVenta(r):a.abrirDetalleVenta(r))}),y(4,"fa-icon",20),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),F(11,"currency"),s(),l(12,"td"),d(13),F(14,"currency"),s(),l(15,"td"),d(16),s(),l(17,"td"),d(18),F(19,"date"),s()(),N(20,nb,25,1,"tr",21),et()}if(i&2){let e=t.$implicit,n=_(2);c(3),p("matTooltip",n.ventaDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),c(),p("icon",n.ventaDetalleAbiertoId===e._id?"minus":"plus")("ngClass",n.ventaDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),T(e.folio),c(2),T((e.cliente==null?null:e.cliente.nombre)||"Mostrador"),c(2),T(se(11,10,e.total)),c(3),T(se(14,12,e.totalDescuento)),c(3),T(e.cantidadProductos),c(2),T(Ni(19,14,e.fecha,"dd/MM/yyyy","America/Mexico_City")),c(2),p("ngIf",n.ventaDetalleAbiertoId===e._id)}}function ab(i,t){if(i&1&&(l(0,"table",17)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th"),d(7,"Cliente"),s(),l(8,"th"),d(9,"Total"),s(),l(10,"th"),d(11,"Total Descuento"),s(),l(12,"th"),d(13,"# Art."),s(),l(14,"th"),d(15,"Fecha"),s()()(),l(16,"tbody"),N(17,rb,21,18,"ng-container",18),s()()),i&2){let e=_();c(17),p("ngForOf",e.ventas)}}function ob(i,t){i&1&&(l(0,"p",32),d(1," No se encontr\xF3 ninguna venta con ese folio en los \xFAltimos 7 d\xEDas. "),s())}function sb(i,t){if(i&1&&(l(0,"div",33),y(1,"app-devolucion-ticket",34),s()),i&2){let e=_();c(),p("venta",e.paraImpresion)}}var xl=class i{constructor(t,e,n,r,a,o){this.devolucionService=t;this.clienteService=e;this.FarmaciaService=n;this.cdr=r;this.library=a;this.authService=o;this.library.addIcons(Cn,Da,vi)}contenedorTicket;ticketDevolucionRef;ventas=[];esCliente=!1;pagoVentaEnEfectivo=0;pagoVentaEnElectronico=0;filtroFolio="";farmaciaId="";farmaciaNombre="";farmaciaDireccion="";farmaciaTelefono="";farmaciaImagen="";farmaciaTitulo1="";farmaciaTitulo2="";usuarioId="";usuarioRol="";usuarioNombre="";ventaDetalleAbiertoId=null;idCliente=null;nombreCliente=null;motivosDevolucion=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];firmaAutorizada="";mostrarTicket=!1;paraImpresion=null;paraGuardar=null;faTimes=vi;ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){ui.default.fire("Error","No se ha seleccionado una farmacia activa","error");return}this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono,this.farmaciaImagen=e.imagen,this.farmaciaTitulo1=e.titulo1,this.farmaciaTitulo2=e.titulo2;let n=this.authService.getUserData(),r=n?.rol,a=n?.nombre,o=n?.id;this.usuarioId=o,this.usuarioRol=r,this.usuarioNombre=a,this.authService.obtenerFirma(e._id).subscribe({next:u=>{this.firmaAutorizada=u.firma},error:u=>{console.error("\u274C Error al obtener firma de farmacia:",u),ui.default.fire("Error","No se pudo obtener la firma de la farmacia","error")}})}onFolioChange(t){this.filtroFolio=t.trim(),this.idCliente=null,/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.devolucionService.obtenerVentasRecientes(this.farmaciaId,this.filtroFolio).subscribe({next:e=>{if(e.length===0){this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1;return}let n=e[0];this.ventas=[n],this.pagoVentaEnEfectivo=n.formaPago.efectivo||0,this.pagoVentaEnElectronico=(n.formaPago.tarjeta||0)+(n.formaPago.transferencia||0)+(n.formaPago.vale||0),this.esCliente=!!n.cliente,this.esCliente&&(this.idCliente=n.cliente._id)},error:e=>{console.error("Error al buscar por folio:",e),this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1}}):(this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1)}toNum=t=>Number(t??0)||0;round2=t=>Math.round((t+Number.EPSILON)*100)/100;calcularProporcionVale(t){let e=this.toNum(t?.formaPago.vale),n=this.toNum(t?.formaPago.efectivo),r=this.toNum(t?.formaPago.tarjeta),a=this.toNum(t?.formaPago.transferencia),o=this.round2(e+n+r+a),u=0;return o>0&&e>0&&(u=Math.max(0,Math.min(1,e/o))),{pagoMonedero:e,pagoEfectivo:n,pagoTarjeta:r,pagoTransferencia:a,totalPagado:o,proporcionVale:u}}calcReversoMonedero(t,e){let n=0;for(let r of e){let a=r.producto?._id??r.producto,o=(t.productos||[]).find(h=>String(h.producto?._id??h.producto)===String(a));if(!o)continue;let u=this.toNum(o.monederoCliente),m=this.toNum(o.cantidad),f=this.toNum(r.cantidadDevuelta);u>0&&m>0&&f>0&&(n+=u*(f/m))}return this.round2(n)}confirmarDevolucion(t){return Ae(this,null,function*(){let e=(t.productos||[]).filter(z=>z.seleccionado&&this.toNum(z.cantidadDevuelta)>0);if(e.length===0){yield ui.default.fire("Aviso","Selecciona al menos un producto con cantidad v\xE1lida","info");return}let n=e.filter(z=>z.motivoIndex==null||typeof z.motivoIndex!="number"||z.motivoIndex<0||!this.motivosDevolucion?.[z.motivoIndex]);if(n.length>0){let z=n.map(_e=>_e.producto.nombre).join(", ");yield ui.default.fire("Aviso",`Debes indicar un motivo de devoluci\xF3n para: ${z}`,"warning");return}let r=this.round2(e.reduce((z,_e)=>z+this.toNum(_e.cantidadDevuelta)*this.toNum(_e.precio),0)),{proporcionVale:a}=this.calcularProporcionVale(t),o=this.round2(r*a),u=this.round2(r-o);if(this.esCliente=!!t?.cliente,this.esCliente?(this.idCliente=t.cliente._id,this.nombreCliente=t.cliente.nombre):(this.idCliente=null,this.nombreCliente=""),!this.esCliente&&o>0){let z=yield this.capturarTelefono();if(!z)return;this.esCliente=!0,this.idCliente=z._id,this.nombreCliente=z.nombre}let m=0;if(this.esCliente&&this.idCliente)try{let z=yield gi(this.clienteService.getClienteById(this.idCliente));m=this.toNum(z?.totalMonedero)}catch{m=0}let f=this.calcReversoMonedero(t,e),h=this.round2(Math.min(f,m+o)),g=o,x=h,b=this.round2(g-x),S=this.round2(m+b);if(!(yield ui.default.fire({title:"Autorizaci\xF3n requerida",html:`
      <p style="color: blue"><strong>Cliente: </strong>${this.nombreCliente||"\u2014"}</p>
      <h4>Debes devolver en total: <strong>$${r.toFixed(2)}</strong></h4>
      <h2>Monedero: <strong>$${o.toFixed(2)}</strong></h2>
      <h2 style="color: red">Efectivo: <strong>$${u.toFixed(2)}</strong></h2>
      <div id="firma-container"></div>
    `,didOpen:()=>{let z=document.createElement("input");z.type="text",z.id="firma-autorizada",z.placeholder="Ingrese la firma",z.autocomplete="off",z.autocapitalize="off",z.spellcheck=!1,z.className="swal2-input",z.style.fontFamily="text-security-disc, sans-serif",z.style.webkitTextSecurity="disc",z.name="firma_"+Date.now(),z.focus(),document.getElementById("firma-container")?.appendChild(z)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Ae(this,null,function*(){let z=ui.default.getConfirmButton();z&&(z.disabled=!0);let _e=document.getElementById("firma-autorizada")?.value?.trim();if(yield new Promise(W=>setTimeout(W,200)),!_e)return ui.default.showValidationMessage("Debes ingresar la firma para continuar."),z&&(z.disabled=!1),!1;try{return(yield gi(this.FarmaciaService.verificarFirma(this.farmaciaId,_e))).autenticado?!0:(ui.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),z&&(z.disabled=!1),!1)}catch(W){return console.error("\u274C Error al verificar firma:",W),ui.default.showValidationMessage("Error al verificar la firma. Intenta m\xE1s tarde."),z&&(z.disabled=!1),!1}})})).isConfirmed)return;this.paraGuardar={folioVenta:t.folio,farmaciaQueDevuelve:this.farmaciaId,idCliente:this.idCliente,productosDevueltos:e.map(z=>{let _e=this.motivosDevolucion[z.motivoIndex];return{producto:z.producto._id??z.producto,cantidad:this.toNum(z.cantidadDevuelta),motivoIndex:z.motivoIndex,motivo:_e,precioXCantidad:this.round2(this.toNum(z.cantidadDevuelta)*this.toNum(z.precio))}})};let E=this.farmaciaImagen||this.user_farmacia?.imagen||"",j=Fr(E),U="";try{U=yield Ar(j)}catch{U=j}let H={nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono,titulo1:this.farmaciaTitulo1,titulo2:this.farmaciaTitulo2,imagen:U};this.paraImpresion={devolucion:{folioVenta:t.folio,fecha:new Date,productos:e.map(z=>({productoNombre:z.producto?.nombre,barrasYNombre:`${(z.producto?.codigoBarras||"").slice(-3)} ${z.producto?.nombre||""}`,cantidad:this.toNum(z.cantidadDevuelta),precio:this.toNum(z.precio),importe:this.round2(this.toNum(z.cantidadDevuelta)*this.toNum(z.precio)),motivo:this.motivosDevolucion[z.motivoIndex]}))},cliente:this.nombreCliente||"\u2014",totalADevolver:r,totalDevolverEfectivo:u,totalDevolverVales:o,monederoIngreso:g,monederoReverso:x,monederoSaldoAntes:m,monederoSaldoDespues:S,monederoCambioNeto:b,usuario:this.usuarioNombre,farmacia:H},console.log("[DEVOLUCI\xD3N] header.logo startsWith(data:)?",this.paraImpresion.farmacia.imagen?.startsWith("data:"),this.paraImpresion.farmacia.imagen?.slice(0,50));let Y=()=>Ae(this,null,function*(){(yield ui.default.fire({icon:"question",title:"\xBFSe imprimi\xF3 correctamente el ticket?",showCancelButton:!0,confirmButtonText:"S\xED, guardar devoluci\xF3n",cancelButtonText:"No, reintentar"})).isConfirmed?this.guardarDespuesDeImpresion():yield ui.default.fire("Atenci\xF3n","La devoluci\xF3n no ha sido registrada. Puedes reintentar la impresi\xF3n.","info")});this.mostrarTicket=!0,this.cdr.detectChanges(),yield ta();{let z=document.getElementById("ticketDevolucion");z&&(yield Wa(z))}this.mostrarTicket=!1,yield Y()})}guardarDespuesDeImpresion(){this.devolucionService.registrarDevolucion(this.paraGuardar).subscribe({next:t=>{ui.default.fire("\xC9xito",t.mensaje||"Devoluci\xF3n registrada correctamente","success"),this.ventaDetalleAbiertoId=null,this.limpiarFolio()},error:t=>{ui.default.fire("Error",t.error?.mensaje||"No se pudo registrar la devoluci\xF3n","error")}})}capturarTelefono(){return Ae(this,null,function*(){for(;;){let t=yield ui.default.fire({title:"Buscar al cliente que nos compr\xF3",input:"text",inputLabel:"Tel\xE9fono del cliente",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,confirmButtonText:"Buscar cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:r=>{let a=r?.trim();return a?/^\d{10}$/.test(a)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":"El tel\xE9fono es obligatorio"}});if(t.isDismissed)return null;let e=t.value?.trim();if(!e)continue;let n=yield this.buscarClientePorTelefono(e);if(n){if((yield ui.default.fire({title:"Cliente encontrado",html:`<p><strong>${n.nombre}</strong></p>
          <p>\xBFEs el cliente que esta haciendo la devoluci\xF3n?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return n}else{let r=yield this.altaCliente(e);if(r)return r}}})}buscarClientePorTelefono(t){return Ae(this,null,function*(){try{return yield gi(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}altaCliente(t){return Ae(this,null,function*(){let{value:e}=yield ui.default.fire({title:"Nuevo cliente",html:`<label><strong>Tel\xE9fono: </strong>${t}</label><input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let r=document.getElementById("swal-input-nombre").value.trim(),a=document.getElementById("swal-input-domicilio").value.trim();if(!r){ui.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:r,domicilio:a}}});if(!e)return null;let n={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let r=yield gi(this.clienteService.crearCliente(n));return ui.default.fire("\xC9xito","Cliente registrado correctamente","success"),r}catch{return ui.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetalleVenta(t){this.ventaDetalleAbiertoId=t._id,t.productos.forEach(e=>{e.seleccionado=!1,e.cantidadDevuelta=1,e.motivo=null})}cerrarDetalleVenta(t){this.ventaDetalleAbiertoId=null}esPromocionNoReembolsable(t,e){return t?.includes("2x1")||t?.includes("3x2")||t?.includes("4x3")||e==="Recargas"||e==="Servicio M\xE9dico"}limpiarFolio(){this.filtroFolio="",this.ventas=[],this.mostrarTicket=!1}static \u0275fac=function(e){return new(e||i)(ie(vl),ie(Sn),ie(Xt),ie(Dt),ie(yi),ie(Kt))};static \u0275cmp=Te({type:i,selectors:[["app-devoluciones"]],viewQuery:function(e,n){if(e&1&&(Tt(Y2,5),Tt(Q2,5)),e&2){let r;bt(r=yt())&&(n.contenedorTicket=r.first),bt(r=yt())&&(n.ticketDevolucionRef=r.first)}},decls:16,vars:6,consts:[[1,"container","mt-4"],[1,"titulo-container"],[1,"titulo"],[1,"row","filter-container"],[1,"col-1"],[1,"col-2"],["for","filtroFolio",1,"lbl-folio-venta"],[1,"position-relative"],["id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pr-4",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio de la venta","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["id","ticketDevolucion","class","ticket-impresion",4,"ngIf"],["matTooltip","Limpiar folio de la venta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-gris","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[4,"ngIf"],["colspan","9"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"btn-rojo","mt-2",3,"click"],["type","checkbox",3,"ngModelChange","ngModel","disabled","ngClass","title"],["type","number","min","1",1,"form-control",3,"ngModelChange","max","ngModel","disabled","title"],[1,"form-select",3,"ngModelChange","ngModel","disabled","title"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"no-found-error"],["id","ticketDevolucion",1,"ticket-impresion"],[3,"venta"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Devoluciones"),s()(),l(4,"div",3),y(5,"div",4),l(6,"div",5)(7,"label",6),d(8,"Folio de la venta:"),s(),l(9,"div",7)(10,"input",8),ee("ngModelChange",function(a){return Z(n.filtroFolio,a)||(n.filtroFolio=a),a}),w("ngModelChange",function(a){return n.onFolioChange(a)}),s(),N(11,Z2,2,1,"button",9),s()()(),N(12,eb,2,0,"h2",10)(13,ab,18,1,"table",11)(14,ob,2,0,"p",12),s(),N(15,sb,2,1,"div",13)),e&2&&(c(10),J("ngModel",n.filtroFolio),c(),p("ngIf",n.filtroFolio.length>0),c(),p("ngIf",n.ventas.length>0),c(),p("ngIf",n.ventas.length>0),c(),p("ngIf",n.filtroFolio.length===6&&n.ventas.length===0),c(),p("ngIf",n.paraImpresion&&n.mostrarTicket))},dependencies:[Oe,si,We,Ne,Bt,Nt,ot,rt,at,qe,qt,li,nt,ze,Aa,Xs,Bi,Yn,_t,ti,ei,_l,dt],styles:[".icono-normal[_ngcontent-%COMP%], .icono-rotado[_ngcontent-%COMP%]{display:inline-block;transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0)}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg)}.checkbox-disabled[_ngcontent-%COMP%], input[disabled][_ngcontent-%COMP%], select[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.folio-venta[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.lbl-folio-venta[_ngcontent-%COMP%]{font-size:large;margin-right:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}"],data:{animation:[na("expandCollapse",[nr("true",mn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",mn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),aa("true <=> false",ra("300ms ease-in-out"))])]}})};var fn=hi(ki());var bl=class i{datosCorte;fechaActual=new Date;ngOnChanges(t){t.datosCorte&&console.log("\u{1F7E2} datosCorte recibidos en ticket:",this.datosCorte)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-corte-caja-ticket"]],inputs:{datosCorte:"datosCorte"},features:[Er],decls:54,vars:22,consts:[[1,"ticket-corteCaja",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono","imagen","titulo1","titulo2"],[1,"corte-caja-encabezado"],[2,"text-align","center","font-size","large"],[1,"corte-caja-datos"],[2,"font-style","italic"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"div",2)(3,"div",3),d(4,"Corte de Caja"),s(),l(5,"strong"),d(6),s(),y(7,"br"),d(8," Inicio: "),l(9,"strong"),d(10),F(11,"date"),s(),y(12,"br"),d(13," Fin: "),l(14,"strong"),d(15),F(16,"date"),s(),y(17,"br"),s(),y(18,"hr"),l(19,"div",4)(20,"p",5),d(21,"Movimientos"),s(),d(22," Ventas: "),l(23,"strong"),d(24),s(),y(25,"br"),d(26," Devoluciones: "),l(27,"strong"),d(28),s(),y(29,"br"),d(30," Pedidos levantados: "),l(31,"strong"),d(32),s(),y(33,"br"),d(34," Pedidos entregados: "),l(35,"strong"),d(36),s(),y(37,"br"),d(38," Pedidos cancelados: "),l(39,"strong"),d(40),s(),y(41,"br")(42,"br"),l(43,"p",5),d(44,"Recargas telef\xF3nicas"),s(),d(45," Saldo inicial: "),l(46,"strong"),d(47),s(),y(48,"br"),d(49," Saldo final: "),l(50,"strong"),d(51),s()(),y(52,"hr")(53,"app-ticket-footer"),s()),e&2&&(c(),p("nombreFarmacia",n.datosCorte.nomFarm)("direccion",n.datosCorte.dirFarm)("telefono",n.datosCorte.telFarm)("imagen",n.datosCorte.imgFarm)("titulo1",n.datosCorte.ti1Farm)("titulo2",n.datosCorte.ti2Farm),c(5),T(n.datosCorte.responsable),c(4),T(Q(11,16,n.datosCorte.fechaInicio,"dd/MM/yyyy HH:mm")),c(5),T(Q(16,19,n.datosCorte.fechaFin,"dd/MM/yyyy HH:mm")),c(9),T(n.datosCorte.ventasRealizadas),c(4),T(n.datosCorte.devolucionesRealizadas),c(4),T(n.datosCorte.pedidosLevantados),c(4),T(n.datosCorte.pedidosEntregados),c(4),T(n.datosCorte.pedidosCancelados),c(7),R("$",n.datosCorte.saldoInicialRecargas," "),c(4),R("$",n.datosCorte.saldoInicialRecargas-n.datosCorte.totalRecargas," "))},dependencies:[Oe,Nt,tr,er],styles:[`.corte-caja-encabezado,.corte-caja-datos{font-size:16px!important;line-height:1.4!important;box-sizing:border-box}.corte-caja-datos{text-align:center}@media print{@page{margin-left:10pt!important;size:95mm auto}html,body{margin:0!important;padding:0!important}body *{visibility:hidden!important}.ticket-corteCaja,.ticket-corteCaja *{visibility:visible!important}.ticket-corteCaja{width:95mm!important;margin-left:10pt!important;padding:0!important;box-sizing:border-box!important;font-size:12px!important;line-height:1.4!important;position:absolute!important;left:0!important;top:0!important}}
`],encapsulation:2})};function lb(i,t){i&1&&(Ze(0),d(1,"Iniciar turno de caja"),et())}function cb(i,t){i&1&&(Ze(0),y(1,"span",13),d(2," Iniciando... "),et())}function db(i,t){if(i&1){let e=ae();l(0,"div",3)(1,"h2",4),d(2,"Inicio de Turno"),s(),l(3,"div",5)(4,"label",6),d(5,"Efectivo inicial recibido:"),s(),l(6,"input",7),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.efectivoInicial,r)||(a.efectivoInicial=r),k(r)}),s()(),l(7,"div",5)(8,"label",8),d(9,"Saldo inicial de recargas:"),s(),l(10,"input",9),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.saldoInicialRecargas,r)||(a.saldoInicialRecargas=r),k(r)}),s(),l(11,"small",10),d(12,"Coloca 0.00 si no tienes recargas al inicio."),s()(),l(13,"button",11),w("click",function(){P(e);let r=_();return k(r.iniciarTurno())}),N(14,lb,2,0,"ng-container",12)(15,cb,3,0,"ng-container",12),s()()}if(i&2){let e=_();c(6),J("ngModel",e.efectivoInicial),c(4),J("ngModel",e.saldoInicialRecargas),c(3),p("disabled",e.procesando),c(),p("ngIf",!e.procesando),c(),p("ngIf",e.procesando)}}function ub(i,t){if(i&1){let e=ae();l(0,"div",3)(1,"h2",14),d(2,"Turno activo"),s(),l(3,"p",15)(4,"strong"),d(5,"Fecha de inicio:"),s(),d(6),F(7,"date"),s(),l(8,"p",15)(9,"strong"),d(10,"Efectivo inicial:"),s(),d(11),F(12,"number"),s(),l(13,"p",15)(14,"strong"),d(15,"Recargas inicial:"),s(),d(16),F(17,"number"),s(),l(18,"button",16),w("click",function(){P(e);let r=_();return k(r.finalizarTurno())}),d(19," Finalizar turno de caja "),s()()}if(i&2){let e=_();c(6),R(" ",Ni(7,3,e.corteActivo.fechaInicio,"dd/MM/yyyy HH:mm","America/Mexico_City")," hrs."),c(5),R(" $",Q(12,7,e.corteActivo.efectivoInicial,"1.2-2"),""),c(5),R(" $",Q(17,10,e.corteActivo.saldoInicialRecargas,"1.2-2"),"")}}function mb(i,t){if(i&1&&y(0,"app-corte-caja-ticket",17),i&2){let e=_();p("datosCorte",e.datosCorteParaImpresion)}}var yl=class i{constructor(t,e,n,r){this.authService=t;this.http=e;this.router=n;this.cdr=r}efectivoInicial=0;saldoInicialRecargas=0;corteActivo=null;usuarioId=null;usuarioNombre=null;farmaciaId=null;farmaciaNombre=null;farmaciaDireccion=null;farmaciaTelefono=null;farmaciaImagen=null;farmaciaTitulo1=null;farmaciaTitulo2=null;mostrarFormulario=!1;procesando=!1;mostrarTicketCorte=!1;datosCorteParaImpresion=null;ngOnInit(){let t=localStorage.getItem("usuario"),e=localStorage.getItem("user_farmacia");if(t&&(this.usuarioId=JSON.parse(t)?.id,this.usuarioNombre=JSON.parse(t)?.nombre),e&&(this.farmaciaId=JSON.parse(e)._id,this.farmaciaNombre=JSON.parse(e).nombre,this.farmaciaDireccion=JSON.parse(e).direccion,this.farmaciaTelefono=JSON.parse(e).telefono,this.farmaciaImagen=JSON.parse(e).imagen,this.farmaciaTitulo1=JSON.parse(e).titulo1,this.farmaciaTitulo2=JSON.parse(e).titulo2),!this.usuarioId||!this.farmaciaId){fn.default.fire("Error","Faltan datos de sesi\xF3n o farmacia activa.","error");return}this.verificarCorteActivo()}verificarCorteActivo(){let t=localStorage.getItem("auth_token"),e=new Qe({"x-auth-token":t||""});this.http.get(`${He.apiUrl}/cortes/activo/${this.usuarioId}/${this.farmaciaId}`,{headers:e}).subscribe({next:n=>{n.corte?this.corteActivo=n.corte:(this.mostrarFormulario=!0,this.cdr.detectChanges())},error:n=>{n.status===409?fn.default.fire({icon:"error",title:"Corte duplicado detectado",text:n.error?.mensaje||"Conflicto en cortes activos"}):fn.default.fire("Error","No se pudo verificar el corte activo.","error")}})}iniciarTurno(){if(this.efectivoInicial<=0){fn.default.fire({icon:"warning",title:"Error",text:"El efectivo inicial debe ser mayor a cero.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(this.saldoInicialRecargas===null||this.saldoInicialRecargas===void 0||this.saldoInicialRecargas<0){fn.default.fire({icon:"warning",title:"Error",text:"El saldo inicial de recargas debe ser 0 o mayor.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.procesando=!0;let t=localStorage.getItem("auth_token"),e=new Qe({"x-auth-token":t||"","Content-Type":"application/json"}),n={efectivoInicial:this.efectivoInicial,saldoInicialRecargas:this.saldoInicialRecargas,farmaciaId:this.farmaciaId};this.http.post(`${He.apiUrl}/cortes`,n,{headers:e}).subscribe({next:r=>{let a=r.corte;localStorage.setItem("corte_activo",a._id),fn.default.fire({icon:"success",title:"Turno iniciado",html:`
          <div style="text-align:left">
            <p><strong>Efectivo inicial:</strong> $${this.efectivoInicial.toFixed(2)}</p>
            <p><strong>Saldo inicial de recargas:</strong> $${this.saldoInicialRecargas.toFixed(2)}</p>
          </div>`,timer:2200,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.router.navigate(["/home"])})},error:r=>{console.error("Error al iniciar turno:",r),fn.default.fire("Error",r.error?.mensaje||"No se pudo iniciar el turno.","error")}}).add(()=>{this.procesando=!1})}finalizarTurno(){fn.default.fire({title:"\xBFFinalizar turno de caja?",text:"Se generar\xE1 el corte con los balances actuales.",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, finalizar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{if(!t.isConfirmed)return;let e=localStorage.getItem("auth_token"),n=new Qe({"x-auth-token":e||""});this.http.put(`${He.apiUrl}/cortes/${this.corteActivo._id}/finalizar/false`,{},{headers:n}).subscribe({next:r=>{this.datosCorteParaImpresion=Ke({responsable:this.usuarioNombre,fechaInicio:this.corteActivo.fechaInicio,fechaFin:new Date().toISOString(),nomFarm:this.farmaciaNombre,dirFarm:this.farmaciaDireccion,telFarm:this.farmaciaTelefono,imgFarm:this.farmaciaImagen,ti1Farm:this.farmaciaTitulo1,ti2Farm:this.farmaciaTitulo2},r.corte),this.mostrarTicketCorte=!0,setTimeout(()=>{requestAnimationFrame(()=>{window.print(),setTimeout(()=>{this.mostrarTicketCorte=!1,fn.default.fire({title:"\xBFLa impresi\xF3n fue exitosa?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(a=>{a.isConfirmed?this.http.put(`${He.apiUrl}/cortes/${this.corteActivo._id}/finalizar/true`,{},{headers:n}).subscribe({next:()=>{localStorage.removeItem("corte_activo"),this.authService.logout(),this.router.navigate(["/home"])},error:o=>{console.error("Error al guardar corte:",o),fn.default.fire("Error","No se pudo guardar el corte.","error")}}):fn.default.fire("Aviso","La impresi\xF3n no fue confirmada. El corte sigue activo.","info")})},300)})},300)},error:r=>{console.error("Error al cerrar turno:",r),fn.default.fire("Error","No se pudo generar el corte.","error")}})})}static \u0275fac=function(e){return new(e||i)(ie(Kt),ie(ct),ie(Yi),ie(Dt))};static \u0275cmp=Te({type:i,selectors:[["app-inicio-turno"]],decls:4,vars:3,consts:[[1,"container","mt-5"],["class","card p-4 shadow",4,"ngIf"],[3,"datosCorte",4,"ngIf"],[1,"card","p-4","shadow"],[1,"mb-4"],[1,"form-group","mb-3"],["for","efectivoInicial",1,"form-label"],["type","number","id","efectivoInicial","placeholder","Ej. 500.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],["for","saldoInicialRecargas",1,"form-label"],["type","number","id","saldoInicialRecargas","placeholder","Ej. 0.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-muted"],[1,"btn-verde","w-100","d-flex","align-items-center","justify-content-center",3,"click","disabled"],[4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"titulo","mb-4"],[1,"subtitulo"],[1,"btn-gris",3,"click"],[3,"datosCorte"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,db,16,5,"div",1)(2,ub,20,13,"div",1),s(),N(3,mb,1,1,"app-corte-caja-ticket",2)),e&2&&(c(),p("ngIf",n.mostrarFormulario),c(),p("ngIf",n.corteActivo&&!n.mostrarFormulario),c(),p("ngIf",n.mostrarTicketCorte))},dependencies:[Oe,Ne,wt,Nt,ot,qe,qt,ze,Bi,_t,bl],encapsulation:2})};var Wn=hi(ki());var Ko={};Ko.version="0.18.5";var sa=1200,no=1252,fb=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],pb={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},rh=function(i){fb.indexOf(i)!=-1&&(no=pb[0]=i)};function hb(){rh(1252)}var Yo=function(i){sa=i,rh(i)};function gb(){Yo(1200),hb()}function _b(i){for(var t=[],e=0;e<i.length>>1;++e)t[e]=String.fromCharCode(i.charCodeAt(2*e+1)+(i.charCodeAt(2*e)<<8));return t.join("")}var Cl=function(t){return String.fromCharCode(t)},vp=function(t){return String.fromCharCode(t)},Rt;var or=null,jo=!0,Dr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Qo(i){for(var t="",e=0,n=0,r=0,a=0,o=0,u=0,m=0,f=0;f<i.length;)e=i.charCodeAt(f++),a=e>>2,n=i.charCodeAt(f++),o=(e&3)<<4|n>>4,r=i.charCodeAt(f++),u=(n&15)<<2|r>>6,m=r&63,isNaN(n)?u=m=64:isNaN(r)&&(m=64),t+=Dr.charAt(a)+Dr.charAt(o)+Dr.charAt(u)+Dr.charAt(m);return t}function vr(i){var t="",e=0,n=0,r=0,a=0,o=0,u=0,m=0;i=i.replace(/[^\w\+\/\=]/g,"");for(var f=0;f<i.length;)a=Dr.indexOf(i.charAt(f++)),o=Dr.indexOf(i.charAt(f++)),e=a<<2|o>>4,t+=String.fromCharCode(e),u=Dr.indexOf(i.charAt(f++)),n=(o&15)<<4|u>>2,u!==64&&(t+=String.fromCharCode(n)),m=Dr.indexOf(i.charAt(f++)),r=(u&3)<<6|m,m!==64&&(t+=String.fromCharCode(r));return t}var Ct=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),br=function(){if(typeof Buffer<"u"){var i=!Buffer.from;if(!i)try{Buffer.from("foo","utf8")}catch{i=!0}return i?function(t,e){return e?new Buffer(t,e):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}}();function ca(i){return Ct?Buffer.alloc?Buffer.alloc(i):new Buffer(i):typeof Uint8Array<"u"?new Uint8Array(i):new Array(i)}function xp(i){return Ct?Buffer.allocUnsafe?Buffer.allocUnsafe(i):new Buffer(i):typeof Uint8Array<"u"?new Uint8Array(i):new Array(i)}var Vn=function(t){return Ct?br(t,"binary"):t.split("").map(function(e){return e.charCodeAt(0)&255})};function $l(i){if(typeof ArrayBuffer>"u")return Vn(i);for(var t=new ArrayBuffer(i.length),e=new Uint8Array(t),n=0;n!=i.length;++n)e[n]=i.charCodeAt(n)&255;return t}function is(i){if(Array.isArray(i))return i.map(function(n){return String.fromCharCode(n)}).join("");for(var t=[],e=0;e<i.length;++e)t[e]=String.fromCharCode(i[e]);return t.join("")}function vb(i){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(i)}var Fi=Ct?function(i){return Buffer.concat(i.map(function(t){return Buffer.isBuffer(t)?t:br(t)}))}:function(i){if(typeof Uint8Array<"u"){var t=0,e=0;for(t=0;t<i.length;++t)e+=i[t].length;var n=new Uint8Array(e),r=0;for(t=0,e=0;t<i.length;e+=r,++t)if(r=i[t].length,i[t]instanceof Uint8Array)n.set(i[t],e);else{if(typeof i[t]=="string")throw"wtf";n.set(new Uint8Array(i[t]),e)}return n}return[].concat.apply([],i.map(function(a){return Array.isArray(a)?a:[].slice.call(a)}))};function xb(i){for(var t=[],e=0,n=i.length+250,r=ca(i.length+255),a=0;a<i.length;++a){var o=i.charCodeAt(a);if(o<128)r[e++]=o;else if(o<2048)r[e++]=192|o>>6&31,r[e++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var u=i.charCodeAt(++a)&1023;r[e++]=240|o>>8&7,r[e++]=128|o>>2&63,r[e++]=128|u>>6&15|(o&3)<<4,r[e++]=128|u&63}else r[e++]=224|o>>12&15,r[e++]=128|o>>6&63,r[e++]=128|o&63;e>n&&(t.push(r.slice(0,e)),e=0,r=ca(65535),n=65530)}return t.push(r.slice(0,e)),Fi(t)}var Ja=/\u0000/g,Sl=/[\u0001-\u0006]/g;function Za(i){for(var t="",e=i.length-1;e>=0;)t+=i.charAt(e--);return t}function Un(i,t){var e=""+i;return e.length>=t?e:ii("0",t-e.length)+e}function V0(i,t){var e=""+i;return e.length>=t?e:ii(" ",t-e.length)+e}function Fl(i,t){var e=""+i;return e.length>=t?e:e+ii(" ",t-e.length)}function bb(i,t){var e=""+Math.round(i);return e.length>=t?e:ii("0",t-e.length)+e}function yb(i,t){var e=""+i;return e.length>=t?e:ii("0",t-e.length)+e}var bp=Math.pow(2,32);function qa(i,t){if(i>bp||i<-bp)return bb(i,t);var e=Math.round(i);return yb(e,t)}function Al(i,t){return t=t||0,i.length>=7+t&&(i.charCodeAt(t)|32)===103&&(i.charCodeAt(t+1)|32)===101&&(i.charCodeAt(t+2)|32)===110&&(i.charCodeAt(t+3)|32)===101&&(i.charCodeAt(t+4)|32)===114&&(i.charCodeAt(t+5)|32)===97&&(i.charCodeAt(t+6)|32)===108}var yp=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],P0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function Cb(i){return i||(i={}),i[0]="General",i[1]="0",i[2]="0.00",i[3]="#,##0",i[4]="#,##0.00",i[9]="0%",i[10]="0.00%",i[11]="0.00E+00",i[12]="# ?/?",i[13]="# ??/??",i[14]="m/d/yy",i[15]="d-mmm-yy",i[16]="d-mmm",i[17]="mmm-yy",i[18]="h:mm AM/PM",i[19]="h:mm:ss AM/PM",i[20]="h:mm",i[21]="h:mm:ss",i[22]="m/d/yy h:mm",i[37]="#,##0 ;(#,##0)",i[38]="#,##0 ;[Red](#,##0)",i[39]="#,##0.00;(#,##0.00)",i[40]="#,##0.00;[Red](#,##0.00)",i[45]="mm:ss",i[46]="[h]:mm:ss",i[47]="mmss.0",i[48]="##0.0E+0",i[49]="@",i[56]='"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "',i}var ni={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "'},Cp={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Sb={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Ol(i,t,e){for(var n=i<0?-1:1,r=i*n,a=0,o=1,u=0,m=1,f=0,h=0,g=Math.floor(r);f<t&&(g=Math.floor(r),u=g*o+a,h=g*f+m,!(r-g<5e-8));)r=1/(r-g),a=o,o=u,m=f,f=h;if(h>t&&(f>t?(h=m,u=a):(h=f,u=o)),!e)return[0,n*u,h];var x=Math.floor(n*u/h);return[x,n*u-x*h,h]}function wl(i,t,e){if(i>2958465||i<0)return null;var n=i|0,r=Math.floor(86400*(i-n)),a=0,o=[],u={D:n,T:r,u:86400*(i-n)-r,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(u.u)<1e-6&&(u.u=0),t&&t.date1904&&(n+=1462),u.u>.9999&&(u.u=0,++r==86400&&(u.T=r=0,++n,++u.D)),n===60)o=e?[1317,10,29]:[1900,2,29],a=3;else if(n===0)o=e?[1317,8,29]:[1900,1,0],a=6;else{n>60&&--n;var m=new Date(1900,0,1);m.setDate(m.getDate()+n-1),o=[m.getFullYear(),m.getMonth()+1,m.getDate()],a=m.getDay(),n<60&&(a=(a+6)%7),e&&(a=Mb(m,o))}return u.y=o[0],u.m=o[1],u.d=o[2],u.S=r%60,r=Math.floor(r/60),u.M=r%60,r=Math.floor(r/60),u.H=r,u.q=a,u}var ah=new Date(1899,11,31,0,0,0),wb=ah.getTime(),Eb=new Date(1900,2,1,0,0,0);function oh(i,t){var e=i.getTime();return t?e-=1461*24*60*60*1e3:i>=Eb&&(e+=24*60*60*1e3),(e-(wb+(i.getTimezoneOffset()-ah.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function U0(i){return i.indexOf(".")==-1?i:i.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Tb(i){return i.indexOf("E")==-1?i:i.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function Pb(i){var t=i<0?12:11,e=U0(i.toFixed(12));return e.length<=t||(e=i.toPrecision(10),e.length<=t)?e:i.toExponential(5)}function kb(i){var t=U0(i.toFixed(11));return t.length>(i<0?12:11)||t==="0"||t==="-0"?i.toPrecision(6):t}function Ib(i){var t=Math.floor(Math.log(Math.abs(i))*Math.LOG10E),e;return t>=-4&&t<=-1?e=i.toPrecision(10+t):Math.abs(t)<=9?e=Pb(i):t===10?e=i.toFixed(10).substr(0,12):e=kb(i),U0(Tb(e.toUpperCase()))}function R0(i,t){switch(typeof i){case"string":return i;case"boolean":return i?"TRUE":"FALSE";case"number":return(i|0)===i?i.toString(10):Ib(i);case"undefined":return"";case"object":if(i==null)return"";if(i instanceof Date)return Nr(14,oh(i,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+i)}function Mb(i,t){t[0]-=581;var e=i.getDay();return i<60&&(e=(e+6)%7),e}function Fb(i,t,e,n){var r="",a=0,o=0,u=e.y,m,f=0;switch(i){case 98:u=e.y+543;case 121:switch(t.length){case 1:case 2:m=u%100,f=2;break;default:m=u%1e4,f=4;break}break;case 109:switch(t.length){case 1:case 2:m=e.m,f=t.length;break;case 3:return P0[e.m-1][1];case 5:return P0[e.m-1][0];default:return P0[e.m-1][2]}break;case 100:switch(t.length){case 1:case 2:m=e.d,f=t.length;break;case 3:return yp[e.q][0];default:return yp[e.q][1]}break;case 104:switch(t.length){case 1:case 2:m=1+(e.H+11)%12,f=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:m=e.H,f=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:m=e.M,f=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return e.u===0&&(t=="s"||t=="ss")?Un(e.S,t.length):(n>=2?o=n===3?1e3:100:o=n===1?10:1,a=Math.round(o*(e.S+e.u)),a>=60*o&&(a=0),t==="s"?a===0?"0":""+a/o:(r=Un(a,2+n),t==="ss"?r.substr(0,2):"."+r.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":m=e.D*24+e.H;break;case"[m]":case"[mm]":m=(e.D*24+e.H)*60+e.M;break;case"[s]":case"[ss]":m=((e.D*24+e.H)*60+e.M)*60+Math.round(e.S+e.u);break;default:throw"bad abstime format: "+t}f=t.length===3?1:2;break;case 101:m=u,f=1;break}var h=f>0?Un(m,f):"";return h}function Rr(i){var t=3;if(i.length<=t)return i;for(var e=i.length%t,n=i.substr(0,e);e!=i.length;e+=t)n+=(n.length>0?",":"")+i.substr(e,t);return n}var sh=/%/g;function Ab(i,t,e){var n=t.replace(sh,""),r=t.length-n.length;return hr(i,n,e*Math.pow(10,2*r))+ii("%",r)}function Ob(i,t,e){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return hr(i,t.substr(0,n),e/Math.pow(10,3*(t.length-n)))}function lh(i,t){var e,n=i.indexOf("E")-i.indexOf(".")-1;if(i.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+lh(i,-t);var r=i.indexOf(".");r===-1&&(r=i.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%r;if(a<0&&(a+=r),e=(t/Math.pow(10,a)).toPrecision(n+1+(r+a)%r),e.indexOf("e")===-1){var o=Math.floor(Math.log(t)*Math.LOG10E);for(e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+a):e+="E+"+(o-a);e.substr(0,2)==="0.";)e=e.charAt(0)+e.substr(2,r)+"."+e.substr(2+r),e=e.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(u,m,f,h){return m+f+h.substr(0,(r+a)%r)+"."+h.substr(a)+"E"})}else e=t.toExponential(n);return i.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),i.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}var ch=/# (\?+)( ?)\/( ?)(\d+)/;function Db(i,t,e){var n=parseInt(i[4],10),r=Math.round(t*n),a=Math.floor(r/n),o=r-a*n,u=n;return e+(a===0?"":""+a)+" "+(o===0?ii(" ",i[1].length+1+i[4].length):V0(o,i[1].length)+i[2]+"/"+i[3]+Un(u,i[4].length))}function Rb(i,t,e){return e+(t===0?"":""+t)+ii(" ",i[1].length+2+i[4].length)}var dh=/^#*0*\.([0#]+)/,uh=/\).*[0#]/,mh=/\(###\) ###\\?-####/;function $i(i){for(var t="",e,n=0;n!=i.length;++n)switch(e=i.charCodeAt(n)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(e)}return t}function Sp(i,t){var e=Math.pow(10,t);return""+Math.round(i*e)/e}function wp(i,t){var e=i-Math.floor(i),n=Math.pow(10,t);return t<(""+Math.round(e*n)).length?0:Math.round(e*n)}function Nb(i,t){return t<(""+Math.round((i-Math.floor(i))*Math.pow(10,t))).length?1:0}function Bb(i){return i<2147483647&&i>-2147483648?""+(i>=0?i|0:i-1|0):""+Math.floor(i)}function Tn(i,t,e){if(i.charCodeAt(0)===40&&!t.match(uh)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?Tn("n",n,e):"("+Tn("n",n,-e)+")"}if(t.charCodeAt(t.length-1)===44)return Ob(i,t,e);if(t.indexOf("%")!==-1)return Ab(i,t,e);if(t.indexOf("E")!==-1)return lh(t,e);if(t.charCodeAt(0)===36)return"$"+Tn(i,t.substr(t.charAt(1)==" "?2:1),e);var r,a,o,u,m=Math.abs(e),f=e<0?"-":"";if(t.match(/^00+$/))return f+qa(m,t.length);if(t.match(/^[#?]+$/))return r=qa(e,0),r==="0"&&(r=""),r.length>t.length?r:$i(t.substr(0,t.length-r.length))+r;if(a=t.match(ch))return Db(a,m,f);if(t.match(/^#+0+$/))return f+qa(m,t.length-t.indexOf("0"));if(a=t.match(dh))return r=Sp(e,a[1].length).replace(/^([^\.]+)$/,"$1."+$i(a[1])).replace(/\.$/,"."+$i(a[1])).replace(/\.(\d*)$/,function(S,v){return"."+v+ii("0",$i(a[1]).length-v.length)}),t.indexOf("0.")!==-1?r:r.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return f+Sp(m,a[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return f+Rr(qa(m,0));if(a=t.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+Tn(i,t,-e):Rr(""+(Math.floor(e)+Nb(e,a[1].length)))+"."+Un(wp(e,a[1].length),a[1].length);if(a=t.match(/^#,#*,#0/))return Tn(i,t.replace(/^#,#*,/,""),e);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return r=Za(Tn(i,t.replace(/[\\-]/g,""),e)),o=0,Za(Za(t.replace(/\\/g,"")).replace(/[0#]/g,function(S){return o<r.length?r.charAt(o++):S==="0"?"0":""}));if(t.match(mh))return r=Tn(i,"##########",e),"("+r.substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var h="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(a[4].length,7),u=Ol(m,Math.pow(10,o)-1,!1),r=""+f,h=hr("n",a[1],u[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),r+=h+a[2]+"/"+a[3],h=Fl(u[2],o),h.length<a[4].length&&(h=$i(a[4].substr(a[4].length-h.length))+h),r+=h,r;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(a[1].length,a[4].length),7),u=Ol(m,Math.pow(10,o)-1,!0),f+(u[0]||(u[1]?"":"0"))+" "+(u[1]?V0(u[1],o)+a[2]+"/"+a[3]+Fl(u[2],o):ii(" ",2*o+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return r=qa(e,0),t.length<=r.length?r:$i(t.substr(0,t.length-r.length))+r;if(a=t.match(/^([#0?]+)\.([#0]+)$/)){r=""+e.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),o=r.indexOf(".");var g=t.indexOf(".")-o,x=t.length-r.length-g;return $i(t.substr(0,g)+r+t.substr(t.length-x))}if(a=t.match(/^00,000\.([#0]*0)$/))return o=wp(e,a[1].length),e<0?"-"+Tn(i,t,-e):Rr(Bb(e)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(S){return"00,"+(S.length<3?Un(0,3-S.length):"")+S})+"."+Un(o,a[1].length);switch(t){case"###,##0.00":return Tn(i,"#,##0.00",e);case"###,###":case"##,###":case"#,###":var b=Rr(qa(m,0));return b!=="0"?f+b:"";case"###,###.00":return Tn(i,"###,##0.00",e).replace(/^0\./,".");case"#,###.00":return Tn(i,"#,##0.00",e).replace(/^0\./,".");default:}throw new Error("unsupported format |"+t+"|")}function Lb(i,t,e){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return hr(i,t.substr(0,n),e/Math.pow(10,3*(t.length-n)))}function Vb(i,t,e){var n=t.replace(sh,""),r=t.length-n.length;return hr(i,n,e*Math.pow(10,2*r))+ii("%",r)}function fh(i,t){var e,n=i.indexOf("E")-i.indexOf(".")-1;if(i.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+fh(i,-t);var r=i.indexOf(".");r===-1&&(r=i.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%r;if(a<0&&(a+=r),e=(t/Math.pow(10,a)).toPrecision(n+1+(r+a)%r),!e.match(/[Ee]/)){var o=Math.floor(Math.log(t)*Math.LOG10E);e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+a):e+="E+"+(o-a),e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(u,m,f,h){return m+f+h.substr(0,(r+a)%r)+"."+h.substr(a)+"E"})}else e=t.toExponential(n);return i.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),i.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}function rr(i,t,e){if(i.charCodeAt(0)===40&&!t.match(uh)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?rr("n",n,e):"("+rr("n",n,-e)+")"}if(t.charCodeAt(t.length-1)===44)return Lb(i,t,e);if(t.indexOf("%")!==-1)return Vb(i,t,e);if(t.indexOf("E")!==-1)return fh(t,e);if(t.charCodeAt(0)===36)return"$"+rr(i,t.substr(t.charAt(1)==" "?2:1),e);var r,a,o,u,m=Math.abs(e),f=e<0?"-":"";if(t.match(/^00+$/))return f+Un(m,t.length);if(t.match(/^[#?]+$/))return r=""+e,e===0&&(r=""),r.length>t.length?r:$i(t.substr(0,t.length-r.length))+r;if(a=t.match(ch))return Rb(a,m,f);if(t.match(/^#+0+$/))return f+Un(m,t.length-t.indexOf("0"));if(a=t.match(dh))return r=(""+e).replace(/^([^\.]+)$/,"$1."+$i(a[1])).replace(/\.$/,"."+$i(a[1])),r=r.replace(/\.(\d*)$/,function(S,v){return"."+v+ii("0",$i(a[1]).length-v.length)}),t.indexOf("0.")!==-1?r:r.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return f+(""+m).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return f+Rr(""+m);if(a=t.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+rr(i,t,-e):Rr(""+e)+"."+ii("0",a[1].length);if(a=t.match(/^#,#*,#0/))return rr(i,t.replace(/^#,#*,/,""),e);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return r=Za(rr(i,t.replace(/[\\-]/g,""),e)),o=0,Za(Za(t.replace(/\\/g,"")).replace(/[0#]/g,function(S){return o<r.length?r.charAt(o++):S==="0"?"0":""}));if(t.match(mh))return r=rr(i,"##########",e),"("+r.substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var h="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(a[4].length,7),u=Ol(m,Math.pow(10,o)-1,!1),r=""+f,h=hr("n",a[1],u[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),r+=h+a[2]+"/"+a[3],h=Fl(u[2],o),h.length<a[4].length&&(h=$i(a[4].substr(a[4].length-h.length))+h),r+=h,r;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(a[1].length,a[4].length),7),u=Ol(m,Math.pow(10,o)-1,!0),f+(u[0]||(u[1]?"":"0"))+" "+(u[1]?V0(u[1],o)+a[2]+"/"+a[3]+Fl(u[2],o):ii(" ",2*o+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return r=""+e,t.length<=r.length?r:$i(t.substr(0,t.length-r.length))+r;if(a=t.match(/^([#0]+)\.([#0]+)$/)){r=""+e.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),o=r.indexOf(".");var g=t.indexOf(".")-o,x=t.length-r.length-g;return $i(t.substr(0,g)+r+t.substr(t.length-x))}if(a=t.match(/^00,000\.([#0]*0)$/))return e<0?"-"+rr(i,t,-e):Rr(""+e).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(S){return"00,"+(S.length<3?Un(0,3-S.length):"")+S})+"."+Un(0,a[1].length);switch(t){case"###,###":case"##,###":case"#,###":var b=Rr(""+m);return b!=="0"?f+b:"";default:if(t.match(/\.[0#?]*$/))return rr(i,t.slice(0,t.lastIndexOf(".")),e)+$i(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function hr(i,t,e){return(e|0)===e?rr(i,t,e):Tn(i,t,e)}function Ub(i){for(var t=[],e=!1,n=0,r=0;n<i.length;++n)switch(i.charCodeAt(n)){case 34:e=!e;break;case 95:case 42:case 92:++n;break;case 59:t[t.length]=i.substr(r,n-r),r=n+1}if(t[t.length]=i.substr(r),e===!0)throw new Error("Format |"+i+"| unterminated string ");return t}var ph=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function hh(i){for(var t=0,e="",n="";t<i.length;)switch(e=i.charAt(t)){case"G":Al(i,t)&&(t+=6),t++;break;case'"':for(;i.charCodeAt(++t)!==34&&t<i.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(i.charAt(t+1)==="1"||i.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4E0A":if(i.substr(t,3).toUpperCase()==="A/P"||i.substr(t,5).toUpperCase()==="AM/PM"||i.substr(t,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348")return!0;++t;break;case"[":for(n=e;i.charAt(t++)!=="]"&&t<i.length;)n+=i.charAt(t);if(n.match(ph))return!0;break;case".":case"0":case"#":for(;t<i.length&&("0#?.,E+-%".indexOf(e=i.charAt(++t))>-1||e=="\\"&&i.charAt(t+1)=="-"&&"0#".indexOf(i.charAt(t+2))>-1););break;case"?":for(;i.charAt(++t)===e;);break;case"*":++t,(i.charAt(t)==" "||i.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<i.length&&"0123456789".indexOf(i.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function jb(i,t,e,n){for(var r=[],a="",o=0,u="",m="t",f,h,g,x="H";o<i.length;)switch(u=i.charAt(o)){case"G":if(!Al(i,o))throw new Error("unrecognized character "+u+" in "+i);r[r.length]={t:"G",v:"General"},o+=7;break;case'"':for(a="";(g=i.charCodeAt(++o))!==34&&o<i.length;)a+=String.fromCharCode(g);r[r.length]={t:"t",v:a},++o;break;case"\\":var b=i.charAt(++o),S=b==="("||b===")"?b:"t";r[r.length]={t:S,v:b},++o;break;case"_":r[r.length]={t:"t",v:" "},o+=2;break;case"@":r[r.length]={t:"T",v:t},++o;break;case"B":case"b":if(i.charAt(o+1)==="1"||i.charAt(o+1)==="2"){if(f==null&&(f=wl(t,e,i.charAt(o+1)==="2"),f==null))return"";r[r.length]={t:"X",v:i.substr(o,2)},m=u,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":u=u.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||f==null&&(f=wl(t,e),f==null))return"";for(a=u;++o<i.length&&i.charAt(o).toLowerCase()===u;)a+=u;u==="m"&&m.toLowerCase()==="h"&&(u="M"),u==="h"&&(u=x),r[r.length]={t:u,v:a},m=u;break;case"A":case"a":case"\u4E0A":var v={t:u,v:u};if(f==null&&(f=wl(t,e)),i.substr(o,3).toUpperCase()==="A/P"?(f!=null&&(v.v=f.H>=12?"P":"A"),v.t="T",x="h",o+=3):i.substr(o,5).toUpperCase()==="AM/PM"?(f!=null&&(v.v=f.H>=12?"PM":"AM"),v.t="T",o+=5,x="h"):i.substr(o,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348"?(f!=null&&(v.v=f.H>=12?"\u4E0B\u5348":"\u4E0A\u5348"),v.t="T",o+=5,x="h"):(v.t="t",++o),f==null&&v.t==="T")return"";r[r.length]=v,m=u;break;case"[":for(a=u;i.charAt(o++)!=="]"&&o<i.length;)a+=i.charAt(o);if(a.slice(-1)!=="]")throw'unterminated "[" block: |'+a+"|";if(a.match(ph)){if(f==null&&(f=wl(t,e),f==null))return"";r[r.length]={t:"Z",v:a.toLowerCase()},m=a.charAt(1)}else a.indexOf("$")>-1&&(a=(a.match(/\$([^-\[\]]*)/)||[])[1]||"$",hh(i)||(r[r.length]={t:"t",v:a}));break;case".":if(f!=null){for(a=u;++o<i.length&&(u=i.charAt(o))==="0";)a+=u;r[r.length]={t:"s",v:a};break}case"0":case"#":for(a=u;++o<i.length&&"0#?.,E+-%".indexOf(u=i.charAt(o))>-1;)a+=u;r[r.length]={t:"n",v:a};break;case"?":for(a=u;i.charAt(++o)===u;)a+=u;r[r.length]={t:u,v:a},m=u;break;case"*":++o,(i.charAt(o)==" "||i.charAt(o)=="*")&&++o;break;case"(":case")":r[r.length]={t:n===1?"t":u,v:u},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(a=u;o<i.length&&"0123456789".indexOf(i.charAt(++o))>-1;)a+=i.charAt(o);r[r.length]={t:"D",v:a};break;case" ":r[r.length]={t:u,v:u},++o;break;case"$":r[r.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=\u20ACacfijklopqrtuvwxzP".indexOf(u)===-1)throw new Error("unrecognized character "+u+" in "+i);r[r.length]={t:"t",v:u},++o;break}var E=0,j=0,U;for(o=r.length-1,m="t";o>=0;--o)switch(r[o].t){case"h":case"H":r[o].t=x,m="h",E<1&&(E=1);break;case"s":(U=r[o].v.match(/\.0+$/))&&(j=Math.max(j,U[0].length-1)),E<3&&(E=3);case"d":case"y":case"M":case"e":m=r[o].t;break;case"m":m==="s"&&(r[o].t="M",E<2&&(E=2));break;case"X":break;case"Z":E<1&&r[o].v.match(/[Hh]/)&&(E=1),E<2&&r[o].v.match(/[Mm]/)&&(E=2),E<3&&r[o].v.match(/[Ss]/)&&(E=3)}switch(E){case 0:break;case 1:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M),f.M>=60&&(f.M=0,++f.H);break;case 2:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M);break}var H="",Y;for(o=0;o<r.length;++o)switch(r[o].t){case"t":case"T":case" ":case"D":break;case"X":r[o].v="",r[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":r[o].v=Fb(r[o].t.charCodeAt(0),r[o].v,f,j),r[o].t="t";break;case"n":case"?":for(Y=o+1;r[Y]!=null&&((u=r[Y].t)==="?"||u==="D"||(u===" "||u==="t")&&r[Y+1]!=null&&(r[Y+1].t==="?"||r[Y+1].t==="t"&&r[Y+1].v==="/")||r[o].t==="("&&(u===" "||u==="n"||u===")")||u==="t"&&(r[Y].v==="/"||r[Y].v===" "&&r[Y+1]!=null&&r[Y+1].t=="?"));)r[o].v+=r[Y].v,r[Y]={v:"",t:";"},++Y;H+=r[o].v,o=Y-1;break;case"G":r[o].t="t",r[o].v=R0(t,e);break}var z="",_e,W;if(H.length>0){H.charCodeAt(0)==40?(_e=t<0&&H.charCodeAt(0)===45?-t:t,W=hr("n",H,_e)):(_e=t<0&&n>1?-t:t,W=hr("n",H,_e),_e<0&&r[0]&&r[0].t=="t"&&(W=W.substr(1),r[0].v="-"+r[0].v)),Y=W.length-1;var le=r.length;for(o=0;o<r.length;++o)if(r[o]!=null&&r[o].t!="t"&&r[o].v.indexOf(".")>-1){le=o;break}var te=r.length;if(le===r.length&&W.indexOf("E")===-1){for(o=r.length-1;o>=0;--o)r[o]==null||"n?".indexOf(r[o].t)===-1||(Y>=r[o].v.length-1?(Y-=r[o].v.length,r[o].v=W.substr(Y+1,r[o].v.length)):Y<0?r[o].v="":(r[o].v=W.substr(0,Y+1),Y=-1),r[o].t="t",te=o);Y>=0&&te<r.length&&(r[te].v=W.substr(0,Y+1)+r[te].v)}else if(le!==r.length&&W.indexOf("E")===-1){for(Y=W.indexOf(".")-1,o=le;o>=0;--o)if(!(r[o]==null||"n?".indexOf(r[o].t)===-1)){for(h=r[o].v.indexOf(".")>-1&&o===le?r[o].v.indexOf(".")-1:r[o].v.length-1,z=r[o].v.substr(h+1);h>=0;--h)Y>=0&&(r[o].v.charAt(h)==="0"||r[o].v.charAt(h)==="#")&&(z=W.charAt(Y--)+z);r[o].v=z,r[o].t="t",te=o}for(Y>=0&&te<r.length&&(r[te].v=W.substr(0,Y+1)+r[te].v),Y=W.indexOf(".")+1,o=le;o<r.length;++o)if(!(r[o]==null||"n?(".indexOf(r[o].t)===-1&&o!==le)){for(h=r[o].v.indexOf(".")>-1&&o===le?r[o].v.indexOf(".")+1:0,z=r[o].v.substr(0,h);h<r[o].v.length;++h)Y<W.length&&(z+=W.charAt(Y++));r[o].v=z,r[o].t="t",te=o}}}for(o=0;o<r.length;++o)r[o]!=null&&"n?".indexOf(r[o].t)>-1&&(_e=n>1&&t<0&&o>0&&r[o-1].v==="-"?-t:t,r[o].v=hr(r[o].t,r[o].v,_e),r[o].t="t");var ce="";for(o=0;o!==r.length;++o)r[o]!=null&&(ce+=r[o].v);return ce}var Ep=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Tp(i,t){if(t==null)return!1;var e=parseFloat(t[2]);switch(t[1]){case"=":if(i==e)return!0;break;case">":if(i>e)return!0;break;case"<":if(i<e)return!0;break;case"<>":if(i!=e)return!0;break;case">=":if(i>=e)return!0;break;case"<=":if(i<=e)return!0;break}return!1}function Wb(i,t){var e=Ub(i),n=e.length,r=e[n-1].indexOf("@");if(n<4&&r>-1&&--n,e.length>4)throw new Error("cannot find right format for |"+e.join("|")+"|");if(typeof t!="number")return[4,e.length===4||r>-1?e[e.length-1]:"@"];switch(e.length){case 1:e=r>-1?["General","General","General",e[0]]:[e[0],e[0],e[0],"@"];break;case 2:e=r>-1?[e[0],e[0],e[0],e[1]]:[e[0],e[1],e[0],"@"];break;case 3:e=r>-1?[e[0],e[1],e[0],e[2]]:[e[0],e[1],e[2],"@"];break;case 4:break}var a=t>0?e[0]:t<0?e[1]:e[2];if(e[0].indexOf("[")===-1&&e[1].indexOf("[")===-1)return[n,a];if(e[0].match(/\[[=<>]/)!=null||e[1].match(/\[[=<>]/)!=null){var o=e[0].match(Ep),u=e[1].match(Ep);return Tp(t,o)?[n,e[0]]:Tp(t,u)?[n,e[1]]:[n,e[o!=null&&u!=null?2:1]]}return[n,a]}function Nr(i,t,e){e==null&&(e={});var n="";switch(typeof i){case"string":i=="m/d/yy"&&e.dateNF?n=e.dateNF:n=i;break;case"number":i==14&&e.dateNF?n=e.dateNF:n=(e.table!=null?e.table:ni)[i],n==null&&(n=e.table&&e.table[Cp[i]]||ni[Cp[i]]),n==null&&(n=Sb[i]||"General");break}if(Al(n,0))return R0(t,e);t instanceof Date&&(t=oh(t,e.date1904));var r=Wb(n,t);if(Al(r[1]))return R0(t,e);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return jb(r[1],t,e,r[0])}function gh(i,t){if(typeof t!="number"){t=+t||-1;for(var e=0;e<392;++e){if(ni[e]==null){t<0&&(t=e);continue}if(ni[e]==i){t=e;break}}t<0&&(t=391)}return ni[t]=i,t}function zl(i){for(var t=0;t!=392;++t)i[t]!==void 0&&gh(i[t],t)}function Gl(){ni=Cb()}var _h=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function Hb(i){var t=typeof i=="number"?ni[i]:i;return t=t.replace(_h,"(\\d+)"),new RegExp("^"+t+"$")}function $b(i,t,e){var n=-1,r=-1,a=-1,o=-1,u=-1,m=-1;(t.match(_h)||[]).forEach(function(g,x){var b=parseInt(e[x+1],10);switch(g.toLowerCase().charAt(0)){case"y":n=b;break;case"d":a=b;break;case"h":o=b;break;case"s":m=b;break;case"m":o>=0?u=b:r=b;break}}),m>=0&&u==-1&&r>=0&&(u=r,r=-1);var f=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(r>=1?r:1)).slice(-2)+"-"+("00"+(a>=1?a:1)).slice(-2);f.length==7&&(f="0"+f),f.length==8&&(f="20"+f);var h=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(u>=0?u:0)).slice(-2)+":"+("00"+(m>=0?m:0)).slice(-2);return o==-1&&u==-1&&m==-1?f:n==-1&&r==-1&&a==-1?h:f+"T"+h}var zb=function(){var i={};i.version="1.2.0";function t(){for(var W=0,le=new Array(256),te=0;te!=256;++te)W=te,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,le[te]=W;return typeof Int32Array<"u"?new Int32Array(le):le}var e=t();function n(W){var le=0,te=0,ce=0,ue=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(ce=0;ce!=256;++ce)ue[ce]=W[ce];for(ce=0;ce!=256;++ce)for(te=W[ce],le=256+ce;le<4096;le+=256)te=ue[le]=te>>>8^W[te&255];var me=[];for(ce=1;ce!=16;++ce)me[ce-1]=typeof Int32Array<"u"?ue.subarray(ce*256,ce*256+256):ue.slice(ce*256,ce*256+256);return me}var r=n(e),a=r[0],o=r[1],u=r[2],m=r[3],f=r[4],h=r[5],g=r[6],x=r[7],b=r[8],S=r[9],v=r[10],E=r[11],j=r[12],U=r[13],H=r[14];function Y(W,le){for(var te=le^-1,ce=0,ue=W.length;ce<ue;)te=te>>>8^e[(te^W.charCodeAt(ce++))&255];return~te}function z(W,le){for(var te=le^-1,ce=W.length-15,ue=0;ue<ce;)te=H[W[ue++]^te&255]^U[W[ue++]^te>>8&255]^j[W[ue++]^te>>16&255]^E[W[ue++]^te>>>24]^v[W[ue++]]^S[W[ue++]]^b[W[ue++]]^x[W[ue++]]^g[W[ue++]]^h[W[ue++]]^f[W[ue++]]^m[W[ue++]]^u[W[ue++]]^o[W[ue++]]^a[W[ue++]]^e[W[ue++]];for(ce+=15;ue<ce;)te=te>>>8^e[(te^W[ue++])&255];return~te}function _e(W,le){for(var te=le^-1,ce=0,ue=W.length,me=0,Me=0;ce<ue;)me=W.charCodeAt(ce++),me<128?te=te>>>8^e[(te^me)&255]:me<2048?(te=te>>>8^e[(te^(192|me>>6&31))&255],te=te>>>8^e[(te^(128|me&63))&255]):me>=55296&&me<57344?(me=(me&1023)+64,Me=W.charCodeAt(ce++)&1023,te=te>>>8^e[(te^(240|me>>8&7))&255],te=te>>>8^e[(te^(128|me>>2&63))&255],te=te>>>8^e[(te^(128|Me>>6&15|(me&3)<<4))&255],te=te>>>8^e[(te^(128|Me&63))&255]):(te=te>>>8^e[(te^(224|me>>12&15))&255],te=te>>>8^e[(te^(128|me>>6&63))&255],te=te>>>8^e[(te^(128|me&63))&255]);return~te}return i.table=e,i.bstr=Y,i.buf=z,i.str=_e,i}(),Ot=function(){var t={};t.version="1.2.1";function e(C,A){for(var I=C.split("/"),M=A.split("/"),O=0,D=0,G=Math.min(I.length,M.length);O<G;++O){if(D=I[O].length-M[O].length)return D;if(I[O]!=M[O])return I[O]<M[O]?-1:1}return I.length-M.length}function n(C){if(C.charAt(C.length-1)=="/")return C.slice(0,-1).indexOf("/")===-1?C:n(C.slice(0,-1));var A=C.lastIndexOf("/");return A===-1?C:C.slice(0,A+1)}function r(C){if(C.charAt(C.length-1)=="/")return r(C.slice(0,-1));var A=C.lastIndexOf("/");return A===-1?C:C.slice(A+1)}function a(C,A){typeof A=="string"&&(A=new Date(A));var I=A.getHours();I=I<<6|A.getMinutes(),I=I<<5|A.getSeconds()>>>1,C.write_shift(2,I);var M=A.getFullYear()-1980;M=M<<4|A.getMonth()+1,M=M<<5|A.getDate(),C.write_shift(2,M)}function o(C){var A=C.read_shift(2)&65535,I=C.read_shift(2)&65535,M=new Date,O=I&31;I>>>=5;var D=I&15;I>>>=4,M.setMilliseconds(0),M.setFullYear(I+1980),M.setMonth(D-1),M.setDate(O);var G=A&31;A>>>=5;var oe=A&63;return A>>>=6,M.setHours(A),M.setMinutes(oe),M.setSeconds(G<<1),M}function u(C){hn(C,0);for(var A={},I=0;C.l<=C.length-4;){var M=C.read_shift(2),O=C.read_shift(2),D=C.l+O,G={};switch(M){case 21589:I=C.read_shift(1),I&1&&(G.mtime=C.read_shift(4)),O>5&&(I&2&&(G.atime=C.read_shift(4)),I&4&&(G.ctime=C.read_shift(4))),G.mtime&&(G.mt=new Date(G.mtime*1e3));break}C.l=D,A[M]=G}return A}var m;function f(){return m||(m={})}function h(C,A){if(C[0]==80&&C[1]==75)return _m(C,A);if((C[0]|32)==109&&(C[1]|32)==105)return Gv(C,A);if(C.length<512)throw new Error("CFB file size "+C.length+" < 512");var I=3,M=512,O=0,D=0,G=0,oe=0,X=0,q=[],K=C.slice(0,512);hn(K,0);var pe=g(K);switch(I=pe[0],I){case 3:M=512;break;case 4:M=4096;break;case 0:if(pe[1]==0)return _m(C,A);default:throw new Error("Major Version: Expected 3 or 4 saw "+I)}M!==512&&(K=C.slice(0,M),hn(K,28));var xe=C.slice(0,M);x(K,I);var Ie=K.read_shift(4,"i");if(I===3&&Ie!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ie);K.l+=4,G=K.read_shift(4,"i"),K.l+=4,K.chk("00100000","Mini Stream Cutoff Size: "),oe=K.read_shift(4,"i"),O=K.read_shift(4,"i"),X=K.read_shift(4,"i"),D=K.read_shift(4,"i");for(var be=-1,Se=0;Se<109&&(be=K.read_shift(4,"i"),!(be<0));++Se)q[Se]=be;var $e=b(C,M);E(X,D,$e,M,q);var jt=U($e,G,q,M);jt[G].name="!Directory",O>0&&oe!==Me&&(jt[oe].name="!MiniFAT"),jt[q[0]].name="!FAT",jt.fat_addrs=q,jt.ssz=M;var Ki={},oi=[],ln=[],Mo=[];H(G,jt,$e,oi,O,Ki,ln,oe),S(ln,Mo,oi),oi.shift();var Fo={FileIndex:ln,FullPaths:Mo};return A&&A.raw&&(Fo.raw={header:xe,sectors:$e}),Fo}function g(C){if(C[C.l]==80&&C[C.l+1]==75)return[0,0];C.chk(ut,"Header Signature: "),C.l+=16;var A=C.read_shift(2,"u");return[C.read_shift(2,"u"),A]}function x(C,A){var I=9;switch(C.l+=2,I=C.read_shift(2)){case 9:if(A!=3)throw new Error("Sector Shift: Expected 9 saw "+I);break;case 12:if(A!=4)throw new Error("Sector Shift: Expected 12 saw "+I);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+I)}C.chk("0600","Mini Sector Shift: "),C.chk("000000000000","Reserved: ")}function b(C,A){for(var I=Math.ceil(C.length/A)-1,M=[],O=1;O<I;++O)M[O-1]=C.slice(O*A,(O+1)*A);return M[I-1]=C.slice(I*A),M}function S(C,A,I){for(var M=0,O=0,D=0,G=0,oe=0,X=I.length,q=[],K=[];M<X;++M)q[M]=K[M]=M,A[M]=I[M];for(;oe<K.length;++oe)M=K[oe],O=C[M].L,D=C[M].R,G=C[M].C,q[M]===M&&(O!==-1&&q[O]!==O&&(q[M]=q[O]),D!==-1&&q[D]!==D&&(q[M]=q[D])),G!==-1&&(q[G]=M),O!==-1&&M!=q[M]&&(q[O]=q[M],K.lastIndexOf(O)<oe&&K.push(O)),D!==-1&&M!=q[M]&&(q[D]=q[M],K.lastIndexOf(D)<oe&&K.push(D));for(M=1;M<X;++M)q[M]===M&&(D!==-1&&q[D]!==D?q[M]=q[D]:O!==-1&&q[O]!==O&&(q[M]=q[O]));for(M=1;M<X;++M)if(C[M].type!==0){if(oe=M,oe!=q[oe])do oe=q[oe],A[M]=A[oe]+"/"+A[M];while(oe!==0&&q[oe]!==-1&&oe!=q[oe]);q[M]=-1}for(A[0]+="/",M=1;M<X;++M)C[M].type!==2&&(A[M]+="/")}function v(C,A,I){for(var M=C.start,O=C.size,D=[],G=M;I&&O>0&&G>=0;)D.push(A.slice(G*me,G*me+me)),O-=me,G=oa(I,G*4);return D.length===0?ne(0):Fi(D).slice(0,C.size)}function E(C,A,I,M,O){var D=Me;if(C===Me){if(A!==0)throw new Error("DIFAT chain shorter than expected")}else if(C!==-1){var G=I[C],oe=(M>>>2)-1;if(!G)return;for(var X=0;X<oe&&(D=oa(G,X*4))!==Me;++X)O.push(D);E(oa(G,M-4),A-1,I,M,O)}}function j(C,A,I,M,O){var D=[],G=[];O||(O=[]);var oe=M-1,X=0,q=0;for(X=A;X>=0;){O[X]=!0,D[D.length]=X,G.push(C[X]);var K=I[Math.floor(X*4/M)];if(q=X*4&oe,M<4+q)throw new Error("FAT boundary crossed: "+X+" 4 "+M);if(!C[K])break;X=oa(C[K],q)}return{nodes:D,data:Dp([G])}}function U(C,A,I,M){var O=C.length,D=[],G=[],oe=[],X=[],q=M-1,K=0,pe=0,xe=0,Ie=0;for(K=0;K<O;++K)if(oe=[],xe=K+A,xe>=O&&(xe-=O),!G[xe]){X=[];var be=[];for(pe=xe;pe>=0;){be[pe]=!0,G[pe]=!0,oe[oe.length]=pe,X.push(C[pe]);var Se=I[Math.floor(pe*4/M)];if(Ie=pe*4&q,M<4+Ie)throw new Error("FAT boundary crossed: "+pe+" 4 "+M);if(!C[Se]||(pe=oa(C[Se],Ie),be[pe]))break}D[xe]={nodes:oe,data:Dp([X])}}return D}function H(C,A,I,M,O,D,G,oe){for(var X=0,q=M.length?2:0,K=A[C].data,pe=0,xe=0,Ie;pe<K.length;pe+=128){var be=K.slice(pe,pe+128);hn(be,64),xe=be.read_shift(2),Ie=Kl(be,0,xe-q),M.push(Ie);var Se={name:Ie,type:be.read_shift(1),color:be.read_shift(1),L:be.read_shift(4,"i"),R:be.read_shift(4,"i"),C:be.read_shift(4,"i"),clsid:be.read_shift(16),state:be.read_shift(4,"i"),start:0,size:0},$e=be.read_shift(2)+be.read_shift(2)+be.read_shift(2)+be.read_shift(2);$e!==0&&(Se.ct=Y(be,be.l-8));var jt=be.read_shift(2)+be.read_shift(2)+be.read_shift(2)+be.read_shift(2);jt!==0&&(Se.mt=Y(be,be.l-8)),Se.start=be.read_shift(4,"i"),Se.size=be.read_shift(4,"i"),Se.size<0&&Se.start<0&&(Se.size=Se.type=0,Se.start=Me,Se.name=""),Se.type===5?(X=Se.start,O>0&&X!==Me&&(A[X].name="!StreamData")):Se.size>=4096?(Se.storage="fat",A[Se.start]===void 0&&(A[Se.start]=j(I,Se.start,A.fat_addrs,A.ssz)),A[Se.start].name=Se.name,Se.content=A[Se.start].data.slice(0,Se.size)):(Se.storage="minifat",Se.size<0?Se.size=0:X!==Me&&Se.start!==Me&&A[X]&&(Se.content=v(Se,A[X].data,(A[oe]||{}).data))),Se.content&&hn(Se.content,0),D[Ie]=Se,G.push(Se)}}function Y(C,A){return new Date((Ci(C,A+4)/1e7*Math.pow(2,32)+Ci(C,A)/1e7-11644473600)*1e3)}function z(C,A){return f(),h(m.readFileSync(C),A)}function _e(C,A){var I=A&&A.type;switch(I||Ct&&Buffer.isBuffer(C)&&(I="buffer"),I||"base64"){case"file":return z(C,A);case"base64":return h(Vn(vr(C)),A);case"binary":return h(Vn(C),A)}return h(C,A)}function W(C,A){var I=A||{},M=I.root||"Root Entry";if(C.FullPaths||(C.FullPaths=[]),C.FileIndex||(C.FileIndex=[]),C.FullPaths.length!==C.FileIndex.length)throw new Error("inconsistent CFB structure");C.FullPaths.length===0&&(C.FullPaths[0]=M+"/",C.FileIndex[0]={name:M,type:5}),I.CLSID&&(C.FileIndex[0].clsid=I.CLSID),le(C)}function le(C){var A="Sh33tJ5";if(!Ot.find(C,"/"+A)){var I=ne(4);I[0]=55,I[1]=I[3]=50,I[2]=54,C.FileIndex.push({name:A,type:2,content:I,size:4,L:69,R:69,C:69}),C.FullPaths.push(C.FullPaths[0]+A),te(C)}}function te(C,A){W(C);for(var I=!1,M=!1,O=C.FullPaths.length-1;O>=0;--O){var D=C.FileIndex[O];switch(D.type){case 0:M?I=!0:(C.FileIndex.pop(),C.FullPaths.pop());break;case 1:case 2:case 5:M=!0,isNaN(D.R*D.L*D.C)&&(I=!0),D.R>-1&&D.L>-1&&D.R==D.L&&(I=!0);break;default:I=!0;break}}if(!(!I&&!A)){var G=new Date(1987,1,19),oe=0,X=Object.create?Object.create(null):{},q=[];for(O=0;O<C.FullPaths.length;++O)X[C.FullPaths[O]]=!0,C.FileIndex[O].type!==0&&q.push([C.FullPaths[O],C.FileIndex[O]]);for(O=0;O<q.length;++O){var K=n(q[O][0]);M=X[K],M||(q.push([K,{name:r(K).replace("/",""),type:1,clsid:ye,ct:G,mt:G,content:null}]),X[K]=!0)}for(q.sort(function(Ie,be){return e(Ie[0],be[0])}),C.FullPaths=[],C.FileIndex=[],O=0;O<q.length;++O)C.FullPaths[O]=q[O][0],C.FileIndex[O]=q[O][1];for(O=0;O<q.length;++O){var pe=C.FileIndex[O],xe=C.FullPaths[O];if(pe.name=r(xe).replace("/",""),pe.L=pe.R=pe.C=-(pe.color=1),pe.size=pe.content?pe.content.length:0,pe.start=0,pe.clsid=pe.clsid||ye,O===0)pe.C=q.length>1?1:-1,pe.size=0,pe.type=5;else if(xe.slice(-1)=="/"){for(oe=O+1;oe<q.length&&n(C.FullPaths[oe])!=xe;++oe);for(pe.C=oe>=q.length?-1:oe,oe=O+1;oe<q.length&&n(C.FullPaths[oe])!=n(xe);++oe);pe.R=oe>=q.length?-1:oe,pe.type=1}else n(C.FullPaths[O+1]||"")==n(xe)&&(pe.R=O+1),pe.type=2}}}function ce(C,A){var I=A||{};if(I.fileType=="mad")return qv(C,I);switch(te(C),I.fileType){case"zip":return Uv(C,I)}var M=function(Ie){for(var be=0,Se=0,$e=0;$e<Ie.FileIndex.length;++$e){var jt=Ie.FileIndex[$e];if(jt.content){var Ki=jt.content.length;Ki>0&&(Ki<4096?be+=Ki+63>>6:Se+=Ki+511>>9)}}for(var oi=Ie.FullPaths.length+3>>2,ln=be+7>>3,Mo=be+127>>7,Fo=ln+Se+oi+Mo,qr=Fo+127>>7,h0=qr<=109?0:Math.ceil((qr-109)/127);Fo+qr+h0+127>>7>qr;)h0=++qr<=109?0:Math.ceil((qr-109)/127);var ur=[1,h0,qr,Mo,oi,Se,be,0];return Ie.FileIndex[0].size=be<<6,ur[7]=(Ie.FileIndex[0].start=ur[0]+ur[1]+ur[2]+ur[3]+ur[4]+ur[5])+(ur[6]+7>>3),ur}(C),O=ne(M[7]<<9),D=0,G=0;{for(D=0;D<8;++D)O.write_shift(1,Re[D]);for(D=0;D<8;++D)O.write_shift(2,0);for(O.write_shift(2,62),O.write_shift(2,3),O.write_shift(2,65534),O.write_shift(2,9),O.write_shift(2,6),D=0;D<3;++D)O.write_shift(2,0);for(O.write_shift(4,0),O.write_shift(4,M[2]),O.write_shift(4,M[0]+M[1]+M[2]+M[3]-1),O.write_shift(4,0),O.write_shift(4,4096),O.write_shift(4,M[3]?M[0]+M[1]+M[2]-1:Me),O.write_shift(4,M[3]),O.write_shift(-4,M[1]?M[0]-1:Me),O.write_shift(4,M[1]),D=0;D<109;++D)O.write_shift(-4,D<M[2]?M[1]+D:-1)}if(M[1])for(G=0;G<M[1];++G){for(;D<236+G*127;++D)O.write_shift(-4,D<M[2]?M[1]+D:-1);O.write_shift(-4,G===M[1]-1?Me:G+1)}var oe=function(Ie){for(G+=Ie;D<G-1;++D)O.write_shift(-4,D+1);Ie&&(++D,O.write_shift(-4,Me))};for(G=D=0,G+=M[1];D<G;++D)O.write_shift(-4,Ee.DIFSECT);for(G+=M[2];D<G;++D)O.write_shift(-4,Ee.FATSECT);oe(M[3]),oe(M[4]);for(var X=0,q=0,K=C.FileIndex[0];X<C.FileIndex.length;++X)K=C.FileIndex[X],K.content&&(q=K.content.length,!(q<4096)&&(K.start=G,oe(q+511>>9)));for(oe(M[6]+7>>3);O.l&511;)O.write_shift(-4,Ee.ENDOFCHAIN);for(G=D=0,X=0;X<C.FileIndex.length;++X)K=C.FileIndex[X],K.content&&(q=K.content.length,!(!q||q>=4096)&&(K.start=G,oe(q+63>>6)));for(;O.l&511;)O.write_shift(-4,Ee.ENDOFCHAIN);for(D=0;D<M[4]<<2;++D){var pe=C.FullPaths[D];if(!pe||pe.length===0){for(X=0;X<17;++X)O.write_shift(4,0);for(X=0;X<3;++X)O.write_shift(4,-1);for(X=0;X<12;++X)O.write_shift(4,0);continue}K=C.FileIndex[D],D===0&&(K.start=K.size?K.start-1:Me);var xe=D===0&&I.root||K.name;if(q=2*(xe.length+1),O.write_shift(64,xe,"utf16le"),O.write_shift(2,q),O.write_shift(1,K.type),O.write_shift(1,K.color),O.write_shift(-4,K.L),O.write_shift(-4,K.R),O.write_shift(-4,K.C),K.clsid)O.write_shift(16,K.clsid,"hex");else for(X=0;X<4;++X)O.write_shift(4,0);O.write_shift(4,K.state||0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,K.start),O.write_shift(4,K.size),O.write_shift(4,0)}for(D=1;D<C.FileIndex.length;++D)if(K=C.FileIndex[D],K.size>=4096)if(O.l=K.start+1<<9,Ct&&Buffer.isBuffer(K.content))K.content.copy(O,O.l,0,K.size),O.l+=K.size+511&-512;else{for(X=0;X<K.size;++X)O.write_shift(1,K.content[X]);for(;X&511;++X)O.write_shift(1,0)}for(D=1;D<C.FileIndex.length;++D)if(K=C.FileIndex[D],K.size>0&&K.size<4096)if(Ct&&Buffer.isBuffer(K.content))K.content.copy(O,O.l,0,K.size),O.l+=K.size+63&-64;else{for(X=0;X<K.size;++X)O.write_shift(1,K.content[X]);for(;X&63;++X)O.write_shift(1,0)}if(Ct)O.l=O.length;else for(;O.l<O.length;)O.write_shift(1,0);return O}function ue(C,A){var I=C.FullPaths.map(function(X){return X.toUpperCase()}),M=I.map(function(X){var q=X.split("/");return q[q.length-(X.slice(-1)=="/"?2:1)]}),O=!1;A.charCodeAt(0)===47?(O=!0,A=I[0].slice(0,-1)+A):O=A.indexOf("/")!==-1;var D=A.toUpperCase(),G=O===!0?I.indexOf(D):M.indexOf(D);if(G!==-1)return C.FileIndex[G];var oe=!D.match(Sl);for(D=D.replace(Ja,""),oe&&(D=D.replace(Sl,"!")),G=0;G<I.length;++G)if((oe?I[G].replace(Sl,"!"):I[G]).replace(Ja,"")==D||(oe?M[G].replace(Sl,"!"):M[G]).replace(Ja,"")==D)return C.FileIndex[G];return null}var me=64,Me=-2,ut="d0cf11e0a1b11ae1",Re=[208,207,17,224,161,177,26,225],ye="00000000000000000000000000000000",Ee={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Me,FREESECT:-1,HEADER_SIGNATURE:ut,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ye,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function ke(C,A,I){f();var M=ce(C,I);m.writeFileSync(A,M)}function Ue(C){for(var A=new Array(C.length),I=0;I<C.length;++I)A[I]=String.fromCharCode(C[I]);return A.join("")}function it(C,A){var I=ce(C,A);switch(A&&A.type||"buffer"){case"file":return f(),m.writeFileSync(A.filename,I),I;case"binary":return typeof I=="string"?I:Ue(I);case"base64":return Qo(typeof I=="string"?I:Ue(I));case"buffer":if(Ct)return Buffer.isBuffer(I)?I:br(I);case"array":return typeof I=="string"?Vn(I):I}return I}var Ut;function B(C){try{var A=C.InflateRaw,I=new A;if(I._processChunk(new Uint8Array([3,0]),I._finishFlushFlag),I.bytesRead)Ut=C;else throw new Error("zlib does not expose bytesRead")}catch(M){console.error("cannot use native zlib: "+(M.message||M))}}function re(C,A){if(!Ut)return hm(C,A);var I=Ut.InflateRaw,M=new I,O=M._processChunk(C.slice(C.l),M._finishFlushFlag);return C.l+=M.bytesRead,O}function L(C){return Ut?Ut.deflateRawSync(C):cm(C)}var V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Ce=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function De(C){var A=(C<<1|C<<11)&139536|(C<<5|C<<15)&558144;return(A>>16|A>>8|A)&255}for(var we=typeof Uint8Array<"u",he=we?new Uint8Array(256):[],pt=0;pt<256;++pt)he[pt]=De(pt);function st(C,A){var I=he[C&255];return A<=8?I>>>8-A:(I=I<<8|he[C>>8&255],A<=16?I>>>16-A:(I=I<<8|he[C>>16&255],I>>>24-A))}function Ti(C,A){var I=A&7,M=A>>>3;return(C[M]|(I<=6?0:C[M+1]<<8))>>>I&3}function ht(C,A){var I=A&7,M=A>>>3;return(C[M]|(I<=5?0:C[M+1]<<8))>>>I&7}function Dn(C,A){var I=A&7,M=A>>>3;return(C[M]|(I<=4?0:C[M+1]<<8))>>>I&15}function Qt(C,A){var I=A&7,M=A>>>3;return(C[M]|(I<=3?0:C[M+1]<<8))>>>I&31}function Fe(C,A){var I=A&7,M=A>>>3;return(C[M]|(I<=1?0:C[M+1]<<8))>>>I&127}function xn(C,A,I){var M=A&7,O=A>>>3,D=(1<<I)-1,G=C[O]>>>M;return I<8-M||(G|=C[O+1]<<8-M,I<16-M)||(G|=C[O+2]<<16-M,I<24-M)||(G|=C[O+3]<<24-M),G&D}function dr(C,A,I){var M=A&7,O=A>>>3;return M<=5?C[O]|=(I&7)<<M:(C[O]|=I<<M&255,C[O+1]=(I&7)>>8-M),A+3}function zr(C,A,I){var M=A&7,O=A>>>3;return I=(I&1)<<M,C[O]|=I,A+1}function wa(C,A,I){var M=A&7,O=A>>>3;return I<<=M,C[O]|=I&255,I>>>=8,C[O+1]=I,A+8}function lm(C,A,I){var M=A&7,O=A>>>3;return I<<=M,C[O]|=I&255,I>>>=8,C[O+1]=I&255,C[O+2]=I>>>8,A+16}function u0(C,A){var I=C.length,M=2*I>A?2*I:A+5,O=0;if(I>=A)return C;if(Ct){var D=xp(M);if(C.copy)C.copy(D);else for(;O<C.length;++O)D[O]=C[O];return D}else if(we){var G=new Uint8Array(M);if(G.set)G.set(C);else for(;O<I;++O)G[O]=C[O];return G}return C.length=M,C}function Gn(C){for(var A=new Array(C),I=0;I<C;++I)A[I]=0;return A}function Ms(C,A,I){var M=1,O=0,D=0,G=0,oe=0,X=C.length,q=we?new Uint16Array(32):Gn(32);for(D=0;D<32;++D)q[D]=0;for(D=X;D<I;++D)C[D]=0;X=C.length;var K=we?new Uint16Array(X):Gn(X);for(D=0;D<X;++D)q[O=C[D]]++,M<O&&(M=O),K[D]=0;for(q[0]=0,D=1;D<=M;++D)q[D+16]=oe=oe+q[D-1]<<1;for(D=0;D<X;++D)oe=C[D],oe!=0&&(K[D]=q[oe+16]++);var pe=0;for(D=0;D<X;++D)if(pe=C[D],pe!=0)for(oe=st(K[D],M)>>M-pe,G=(1<<M+4-pe)-1;G>=0;--G)A[oe|G<<pe]=pe&15|D<<4;return M}var m0=we?new Uint16Array(512):Gn(512),f0=we?new Uint16Array(32):Gn(32);if(!we){for(var Gr=0;Gr<512;++Gr)m0[Gr]=0;for(Gr=0;Gr<32;++Gr)f0[Gr]=0}(function(){for(var C=[],A=0;A<32;A++)C.push(5);Ms(C,f0,32);var I=[];for(A=0;A<=143;A++)I.push(8);for(;A<=255;A++)I.push(9);for(;A<=279;A++)I.push(7);for(;A<=287;A++)I.push(8);Ms(I,m0,288)})();var Nv=function(){for(var A=we?new Uint8Array(32768):[],I=0,M=0;I<Ce.length-1;++I)for(;M<Ce[I+1];++M)A[M]=I;for(;M<32768;++M)A[M]=29;var O=we?new Uint8Array(259):[];for(I=0,M=0;I<fe.length-1;++I)for(;M<fe[I+1];++M)O[M]=I;function D(oe,X){for(var q=0;q<oe.length;){var K=Math.min(65535,oe.length-q),pe=q+K==oe.length;for(X.write_shift(1,+pe),X.write_shift(2,K),X.write_shift(2,~K&65535);K-- >0;)X[X.l++]=oe[q++]}return X.l}function G(oe,X){for(var q=0,K=0,pe=we?new Uint16Array(32768):[];K<oe.length;){var xe=Math.min(65535,oe.length-K);if(xe<10){for(q=dr(X,q,+(K+xe==oe.length)),q&7&&(q+=8-(q&7)),X.l=q/8|0,X.write_shift(2,xe),X.write_shift(2,~xe&65535);xe-- >0;)X[X.l++]=oe[K++];q=X.l*8;continue}q=dr(X,q,+(K+xe==oe.length)+2);for(var Ie=0;xe-- >0;){var be=oe[K];Ie=(Ie<<5^be)&32767;var Se=-1,$e=0;if((Se=pe[Ie])&&(Se|=K&-32768,Se>K&&(Se-=32768),Se<K))for(;oe[Se+$e]==oe[K+$e]&&$e<250;)++$e;if($e>2){be=O[$e],be<=22?q=wa(X,q,he[be+1]>>1)-1:(wa(X,q,3),q+=5,wa(X,q,he[be-23]>>5),q+=3);var jt=be<8?0:be-4>>2;jt>0&&(lm(X,q,$e-fe[be]),q+=jt),be=A[K-Se],q=wa(X,q,he[be]>>3),q-=3;var Ki=be<4?0:be-2>>1;Ki>0&&(lm(X,q,K-Se-Ce[be]),q+=Ki);for(var oi=0;oi<$e;++oi)pe[Ie]=K&32767,Ie=(Ie<<5^oe[K])&32767,++K;xe-=$e-1}else be<=143?be=be+48:q=zr(X,q,1),q=wa(X,q,he[be]),pe[Ie]=K&32767,++K}q=wa(X,q,0)-1}return X.l=(q+7)/8|0,X.l}return function(X,q){return X.length<8?D(X,q):G(X,q)}}();function cm(C){var A=ne(50+Math.floor(C.length*1.1)),I=Nv(C,A);return A.slice(0,I)}var dm=we?new Uint16Array(32768):Gn(32768),um=we?new Uint16Array(32768):Gn(32768),mm=we?new Uint16Array(128):Gn(128),fm=1,pm=1;function Bv(C,A){var I=Qt(C,A)+257;A+=5;var M=Qt(C,A)+1;A+=5;var O=Dn(C,A)+4;A+=4;for(var D=0,G=we?new Uint8Array(19):Gn(19),oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],X=1,q=we?new Uint8Array(8):Gn(8),K=we?new Uint8Array(8):Gn(8),pe=G.length,xe=0;xe<O;++xe)G[V[xe]]=D=ht(C,A),X<D&&(X=D),q[D]++,A+=3;var Ie=0;for(q[0]=0,xe=1;xe<=X;++xe)K[xe]=Ie=Ie+q[xe-1]<<1;for(xe=0;xe<pe;++xe)(Ie=G[xe])!=0&&(oe[xe]=K[Ie]++);var be=0;for(xe=0;xe<pe;++xe)if(be=G[xe],be!=0){Ie=he[oe[xe]]>>8-be;for(var Se=(1<<7-be)-1;Se>=0;--Se)mm[Ie|Se<<be]=be&7|xe<<3}var $e=[];for(X=1;$e.length<I+M;)switch(Ie=mm[Fe(C,A)],A+=Ie&7,Ie>>>=3){case 16:for(D=3+Ti(C,A),A+=2,Ie=$e[$e.length-1];D-- >0;)$e.push(Ie);break;case 17:for(D=3+ht(C,A),A+=3;D-- >0;)$e.push(0);break;case 18:for(D=11+Fe(C,A),A+=7;D-- >0;)$e.push(0);break;default:$e.push(Ie),X<Ie&&(X=Ie);break}var jt=$e.slice(0,I),Ki=$e.slice(I);for(xe=I;xe<286;++xe)jt[xe]=0;for(xe=M;xe<30;++xe)Ki[xe]=0;return fm=Ms(jt,dm,286),pm=Ms(Ki,um,30),A}function Lv(C,A){if(C[0]==3&&!(C[1]&3))return[ca(A),2];for(var I=0,M=0,O=xp(A||1<<18),D=0,G=O.length>>>0,oe=0,X=0;(M&1)==0;){if(M=ht(C,I),I+=3,M>>>1)M>>1==1?(oe=9,X=5):(I=Bv(C,I),oe=fm,X=pm);else{I&7&&(I+=8-(I&7));var q=C[I>>>3]|C[(I>>>3)+1]<<8;if(I+=32,q>0)for(!A&&G<D+q&&(O=u0(O,D+q),G=O.length);q-- >0;)O[D++]=C[I>>>3],I+=8;continue}for(;;){!A&&G<D+32767&&(O=u0(O,D+32767),G=O.length);var K=xn(C,I,oe),pe=M>>>1==1?m0[K]:dm[K];if(I+=pe&15,pe>>>=4,(pe>>>8&255)===0)O[D++]=pe;else{if(pe==256)break;pe-=257;var xe=pe<8?0:pe-4>>2;xe>5&&(xe=0);var Ie=D+fe[pe];xe>0&&(Ie+=xn(C,I,xe),I+=xe),K=xn(C,I,X),pe=M>>>1==1?f0[K]:um[K],I+=pe&15,pe>>>=4;var be=pe<4?0:pe-2>>1,Se=Ce[pe];for(be>0&&(Se+=xn(C,I,be),I+=be),!A&&G<Ie&&(O=u0(O,Ie+100),G=O.length);D<Ie;)O[D]=O[D-Se],++D}}}return A?[O,I+7>>>3]:[O.slice(0,D),I+7>>>3]}function hm(C,A){var I=C.slice(C.l||0),M=Lv(I,A);return C.l+=M[1],M[0]}function gm(C,A){if(C)typeof console<"u"&&console.error(A);else throw new Error(A)}function _m(C,A){var I=C;hn(I,0);var M=[],O=[],D={FileIndex:M,FullPaths:O};W(D,{root:A.root});for(var G=I.length-4;(I[G]!=80||I[G+1]!=75||I[G+2]!=5||I[G+3]!=6)&&G>=0;)--G;I.l=G+4,I.l+=4;var oe=I.read_shift(2);I.l+=6;var X=I.read_shift(4);for(I.l=X,G=0;G<oe;++G){I.l+=20;var q=I.read_shift(4),K=I.read_shift(4),pe=I.read_shift(2),xe=I.read_shift(2),Ie=I.read_shift(2);I.l+=8;var be=I.read_shift(4),Se=u(I.slice(I.l+pe,I.l+pe+xe));I.l+=pe+xe+Ie;var $e=I.l;I.l=be+4,Vv(I,q,K,D,Se),I.l=$e}return D}function Vv(C,A,I,M,O){C.l+=2;var D=C.read_shift(2),G=C.read_shift(2),oe=o(C);if(D&8257)throw new Error("Unsupported ZIP encryption");for(var X=C.read_shift(4),q=C.read_shift(4),K=C.read_shift(4),pe=C.read_shift(2),xe=C.read_shift(2),Ie="",be=0;be<pe;++be)Ie+=String.fromCharCode(C[C.l++]);if(xe){var Se=u(C.slice(C.l,C.l+xe));(Se[21589]||{}).mt&&(oe=Se[21589].mt),((O||{})[21589]||{}).mt&&(oe=O[21589].mt)}C.l+=xe;var $e=C.slice(C.l,C.l+q);switch(G){case 8:$e=re(C,K);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+G)}var jt=!1;D&8&&(X=C.read_shift(4),X==134695760&&(X=C.read_shift(4),jt=!0),q=C.read_shift(4),K=C.read_shift(4)),q!=A&&gm(jt,"Bad compressed size: "+A+" != "+q),K!=I&&gm(jt,"Bad uncompressed size: "+I+" != "+K),p0(M,Ie,$e,{unsafe:!0,mt:oe})}function Uv(C,A){var I=A||{},M=[],O=[],D=ne(1),G=I.compression?8:0,oe=0,X=!1;X&&(oe|=8);var q=0,K=0,pe=0,xe=0,Ie=C.FullPaths[0],be=Ie,Se=C.FileIndex[0],$e=[],jt=0;for(q=1;q<C.FullPaths.length;++q)if(be=C.FullPaths[q].slice(Ie.length),Se=C.FileIndex[q],!(!Se.size||!Se.content||be=="Sh33tJ5")){var Ki=pe,oi=ne(be.length);for(K=0;K<be.length;++K)oi.write_shift(1,be.charCodeAt(K)&127);oi=oi.slice(0,oi.l),$e[xe]=zb.buf(Se.content,0);var ln=Se.content;G==8&&(ln=L(ln)),D=ne(30),D.write_shift(4,67324752),D.write_shift(2,20),D.write_shift(2,oe),D.write_shift(2,G),Se.mt?a(D,Se.mt):D.write_shift(4,0),D.write_shift(-4,oe&8?0:$e[xe]),D.write_shift(4,oe&8?0:ln.length),D.write_shift(4,oe&8?0:Se.content.length),D.write_shift(2,oi.length),D.write_shift(2,0),pe+=D.length,M.push(D),pe+=oi.length,M.push(oi),pe+=ln.length,M.push(ln),oe&8&&(D=ne(12),D.write_shift(-4,$e[xe]),D.write_shift(4,ln.length),D.write_shift(4,Se.content.length),pe+=D.l,M.push(D)),D=ne(46),D.write_shift(4,33639248),D.write_shift(2,0),D.write_shift(2,20),D.write_shift(2,oe),D.write_shift(2,G),D.write_shift(4,0),D.write_shift(-4,$e[xe]),D.write_shift(4,ln.length),D.write_shift(4,Se.content.length),D.write_shift(2,oi.length),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(4,0),D.write_shift(4,Ki),jt+=D.l,O.push(D),jt+=oi.length,O.push(oi),++xe}return D=ne(22),D.write_shift(4,101010256),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,xe),D.write_shift(2,xe),D.write_shift(4,jt),D.write_shift(4,pe),D.write_shift(2,0),Fi([Fi(M),Fi(O),D])}var Fs={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function jv(C,A){if(C.ctype)return C.ctype;var I=C.name||"",M=I.match(/\.([^\.]+)$/);return M&&Fs[M[1]]||A&&(M=(I=A).match(/[\.\\]([^\.\\])+$/),M&&Fs[M[1]])?Fs[M[1]]:"application/octet-stream"}function Wv(C){for(var A=Qo(C),I=[],M=0;M<A.length;M+=76)I.push(A.slice(M,M+76));return I.join(`\r
`)+`\r
`}function Hv(C){var A=C.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(q){var K=q.charCodeAt(0).toString(16).toUpperCase();return"="+(K.length==1?"0"+K:K)});A=A.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),A.charAt(0)==`
`&&(A="=0D"+A.slice(1)),A=A.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var I=[],M=A.split(`\r
`),O=0;O<M.length;++O){var D=M[O];if(D.length==0){I.push("");continue}for(var G=0;G<D.length;){var oe=76,X=D.slice(G,G+oe);X.charAt(oe-1)=="="?oe--:X.charAt(oe-2)=="="?oe-=2:X.charAt(oe-3)=="="&&(oe-=3),X=D.slice(G,G+oe),G+=oe,G<D.length&&(X+="="),I.push(X)}}return I.join(`\r
`)}function $v(C){for(var A=[],I=0;I<C.length;++I){for(var M=C[I];I<=C.length&&M.charAt(M.length-1)=="=";)M=M.slice(0,M.length-1)+C[++I];A.push(M)}for(var O=0;O<A.length;++O)A[O]=A[O].replace(/[=][0-9A-Fa-f]{2}/g,function(D){return String.fromCharCode(parseInt(D.slice(1),16))});return Vn(A.join(`\r
`))}function zv(C,A,I){for(var M="",O="",D="",G,oe=0;oe<10;++oe){var X=A[oe];if(!X||X.match(/^\s*$/))break;var q=X.match(/^(.*?):\s*([^\s].*)$/);if(q)switch(q[1].toLowerCase()){case"content-location":M=q[2].trim();break;case"content-type":D=q[2].trim();break;case"content-transfer-encoding":O=q[2].trim();break}}switch(++oe,O.toLowerCase()){case"base64":G=Vn(vr(A.slice(oe).join("")));break;case"quoted-printable":G=$v(A.slice(oe));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+O)}var K=p0(C,M.slice(I.length),G,{unsafe:!0});D&&(K.ctype=D)}function Gv(C,A){if(Ue(C.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var I=A&&A.root||"",M=(Ct&&Buffer.isBuffer(C)?C.toString("binary"):Ue(C)).split(`\r
`),O=0,D="";for(O=0;O<M.length;++O)if(D=M[O],!!/^Content-Location:/i.test(D)&&(D=D.slice(D.indexOf("file")),I||(I=D.slice(0,D.lastIndexOf("/")+1)),D.slice(0,I.length)!=I))for(;I.length>0&&(I=I.slice(0,I.length-1),I=I.slice(0,I.lastIndexOf("/")+1),D.slice(0,I.length)!=I););var G=(M[1]||"").match(/boundary="(.*?)"/);if(!G)throw new Error("MAD cannot find boundary");var oe="--"+(G[1]||""),X=[],q=[],K={FileIndex:X,FullPaths:q};W(K);var pe,xe=0;for(O=0;O<M.length;++O){var Ie=M[O];Ie!==oe&&Ie!==oe+"--"||(xe++&&zv(K,M.slice(pe,O),I),pe=O)}return K}function qv(C,A){var I=A||{},M=I.boundary||"SheetJS";M="------="+M;for(var O=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+M.slice(2)+'"',"","",""],D=C.FullPaths[0],G=D,oe=C.FileIndex[0],X=1;X<C.FullPaths.length;++X)if(G=C.FullPaths[X].slice(D.length),oe=C.FileIndex[X],!(!oe.size||!oe.content||G=="Sh33tJ5")){G=G.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function($e){return"_x"+$e.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function($e){return"_u"+$e.charCodeAt(0).toString(16)+"_"});for(var q=oe.content,K=Ct&&Buffer.isBuffer(q)?q.toString("binary"):Ue(q),pe=0,xe=Math.min(1024,K.length),Ie=0,be=0;be<=xe;++be)(Ie=K.charCodeAt(be))>=32&&Ie<128&&++pe;var Se=pe>=xe*4/5;O.push(M),O.push("Content-Location: "+(I.root||"file:///C:/SheetJS/")+G),O.push("Content-Transfer-Encoding: "+(Se?"quoted-printable":"base64")),O.push("Content-Type: "+jv(oe,G)),O.push(""),O.push(Se?Hv(K):Wv(K))}return O.push(M+`--\r
`),O.join(`\r
`)}function Xv(C){var A={};return W(A,C),A}function p0(C,A,I,M){var O=M&&M.unsafe;O||W(C);var D=!O&&Ot.find(C,A);if(!D){var G=C.FullPaths[0];A.slice(0,G.length)==G?G=A:(G.slice(-1)!="/"&&(G+="/"),G=(G+A).replace("//","/")),D={name:r(A),type:2},C.FileIndex.push(D),C.FullPaths.push(G),O||Ot.utils.cfb_gc(C)}return D.content=I,D.size=I?I.length:0,M&&(M.CLSID&&(D.clsid=M.CLSID),M.mt&&(D.mt=M.mt),M.ct&&(D.ct=M.ct)),D}function Kv(C,A){W(C);var I=Ot.find(C,A);if(I){for(var M=0;M<C.FileIndex.length;++M)if(C.FileIndex[M]==I)return C.FileIndex.splice(M,1),C.FullPaths.splice(M,1),!0}return!1}function Yv(C,A,I){W(C);var M=Ot.find(C,A);if(M){for(var O=0;O<C.FileIndex.length;++O)if(C.FileIndex[O]==M)return C.FileIndex[O].name=r(I),C.FullPaths[O]=I,!0}return!1}function Qv(C){te(C,!0)}return t.find=ue,t.read=_e,t.parse=h,t.write=it,t.writeFile=ke,t.utils={cfb_new:Xv,cfb_add:p0,cfb_del:Kv,cfb_mov:Yv,cfb_gc:Qv,ReadShift:zo,CheckField:Mh,prep_blob:hn,bconcat:Fi,use_zlib:B,_deflateRaw:cm,_inflateRaw:hm,consts:Ee},t}(),El;function Gb(i){return typeof i=="string"?$l(i):Array.isArray(i)?vb(i):i}function ns(i,t,e){if(typeof El<"u"&&El.writeFileSync)return e?El.writeFileSync(i,t,e):El.writeFileSync(i,t);if(typeof Deno<"u"){if(e&&typeof t=="string")switch(e){case"utf8":t=new TextEncoder(e).encode(t);break;case"binary":t=$l(t);break;default:throw new Error("Unsupported encoding "+e)}return Deno.writeFileSync(i,t)}var n=e=="utf8"?pr(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(n,i);if(typeof Blob<"u"){var r=new Blob([Gb(n)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(r,i);if(typeof saveAs<"u")return saveAs(r,i);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var a=URL.createObjectURL(r);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),chrome.downloads.download({url:a,filename:i,saveAs:!0});var o=document.createElement("a");if(o.download!=null)return o.download=i,o.href=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),a}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var u=File(i);return u.open("w"),u.encoding="binary",Array.isArray(t)&&(t=is(t)),u.write(t),u.close(),t}catch(m){if(!m.message||!m.message.match(/onstruct/))throw m}throw new Error("cannot save file "+i)}function Di(i){for(var t=Object.keys(i),e=[],n=0;n<t.length;++n)Object.prototype.hasOwnProperty.call(i,t[n])&&e.push(t[n]);return e}function Pp(i,t){for(var e=[],n=Di(i),r=0;r!==n.length;++r)e[i[n[r]][t]]==null&&(e[i[n[r]][t]]=n[r]);return e}function j0(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]=e[n];return t}function ql(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]=parseInt(e[n],10);return t}function qb(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]==null&&(t[i[e[n]]]=[]),t[i[e[n]]].push(e[n]);return t}var Dl=new Date(1899,11,30,0,0,0);function en(i,t){var e=i.getTime();t&&(e-=1462*24*60*60*1e3);var n=Dl.getTime()+(i.getTimezoneOffset()-Dl.getTimezoneOffset())*6e4;return(e-n)/(24*60*60*1e3)}var vh=new Date,Xb=Dl.getTime()+(vh.getTimezoneOffset()-Dl.getTimezoneOffset())*6e4,kp=vh.getTimezoneOffset();function xh(i){var t=new Date;return t.setTime(i*24*60*60*1e3+Xb),t.getTimezoneOffset()!==kp&&t.setTime(t.getTime()+(t.getTimezoneOffset()-kp)*6e4),t}var Ip=new Date("2017-02-19T19:06:09.000Z"),bh=isNaN(Ip.getFullYear())?new Date("2/19/17"):Ip,Kb=bh.getFullYear()==2017;function Gi(i,t){var e=new Date(i);if(Kb)return t>0?e.setTime(e.getTime()+e.getTimezoneOffset()*60*1e3):t<0&&e.setTime(e.getTime()-e.getTimezoneOffset()*60*1e3),e;if(i instanceof Date)return i;if(bh.getFullYear()==1917&&!isNaN(e.getFullYear())){var n=e.getFullYear();return i.indexOf(""+n)>-1||e.setFullYear(e.getFullYear()+100),e}var r=i.match(/\d+/g)||["2017","2","19","0","0","0"],a=new Date(+r[0],+r[1]-1,+r[2],+r[3]||0,+r[4]||0,+r[5]||0);return i.indexOf("Z")>-1&&(a=new Date(a.getTime()-a.getTimezoneOffset()*60*1e3)),a}function Xl(i,t){if(Ct&&Buffer.isBuffer(i)){if(t){if(i[0]==255&&i[1]==254)return pr(i.slice(2).toString("utf16le"));if(i[1]==254&&i[2]==255)return pr(_b(i.slice(2).toString("binary")))}return i.toString("binary")}if(typeof TextDecoder<"u")try{if(t){if(i[0]==255&&i[1]==254)return pr(new TextDecoder("utf-16le").decode(i.slice(2)));if(i[0]==254&&i[1]==255)return pr(new TextDecoder("utf-16be").decode(i.slice(2)))}var e={"\u20AC":"\x80","\u201A":"\x82",\u0192:"\x83","\u201E":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87","\u02C6":"\x88","\u2030":"\x89",\u0160:"\x8A","\u2039":"\x8B",\u0152:"\x8C",\u017D:"\x8E","\u2018":"\x91","\u2019":"\x92","\u201C":"\x93","\u201D":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02DC":"\x98","\u2122":"\x99",\u0161:"\x9A","\u203A":"\x9B",\u0153:"\x9C",\u017E:"\x9E",\u0178:"\x9F"};return Array.isArray(i)&&(i=new Uint8Array(i)),new TextDecoder("latin1").decode(i).replace(/[]/g,function(a){return e[a]||a})}catch{}for(var n=[],r=0;r!=i.length;++r)n.push(String.fromCharCode(i[r]));return n.join("")}function tn(i){if(typeof JSON<"u"&&!Array.isArray(i))return JSON.parse(JSON.stringify(i));if(typeof i!="object"||i==null)return i;if(i instanceof Date)return new Date(i.getTime());var t={};for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=tn(i[e]));return t}function ii(i,t){for(var e="";e.length<t;)e+=i;return e}function gr(i){var t=Number(i);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(i))return t;var e=1,n=i.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return e*=100,""});return!isNaN(t=Number(n))||(n=n.replace(/[(](.*)[)]/,function(r,a){return e=-e,a}),!isNaN(t=Number(n)))?t/e:t}var Yb=["january","february","march","april","may","june","july","august","september","october","november","december"];function Jo(i){var t=new Date(i),e=new Date(NaN),n=t.getYear(),r=t.getMonth(),a=t.getDate();if(isNaN(a))return e;var o=i.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&Yb.indexOf(o)==-1)return e}else if(o.match(/[a-z]/))return e;return n<0||n>8099?e:(r>0||a>1)&&n!=101?t:i.match(/[^-0-9:,\/\\]/)?e:t}function Xe(i,t,e){if(i.FullPaths){if(typeof e=="string"){var n;return Ct?n=br(e):n=xb(e),Ot.utils.cfb_add(i,t,n)}Ot.utils.cfb_add(i,t,e)}else i.file(t,e)}function W0(){return Ot.utils.cfb_new()}var pi=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`;var Qb={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},H0=j0(Qb);var $0=/[&<>'"]/g,Jb=/[\u0000-\u0008\u000b-\u001f]/g;function It(i){var t=i+"";return t.replace($0,function(e){return H0[e]}).replace(Jb,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"})}function Mp(i){return It(i).replace(/ /g,"_x0020_")}var yh=/[\u0000-\u001f]/g;function Zb(i){var t=i+"";return t.replace($0,function(e){return H0[e]}).replace(/\n/g,"<br/>").replace(yh,function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})}function ey(i){var t=i+"";return t.replace($0,function(e){return H0[e]}).replace(yh,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}function ty(i){return i.replace(/(\r\n|[\r\n])/g,"&#10;")}function iy(i){switch(i){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function k0(i){for(var t="",e=0,n=0,r=0,a=0,o=0,u=0;e<i.length;){if(n=i.charCodeAt(e++),n<128){t+=String.fromCharCode(n);continue}if(r=i.charCodeAt(e++),n>191&&n<224){o=(n&31)<<6,o|=r&63,t+=String.fromCharCode(o);continue}if(a=i.charCodeAt(e++),n<240){t+=String.fromCharCode((n&15)<<12|(r&63)<<6|a&63);continue}o=i.charCodeAt(e++),u=((n&7)<<18|(r&63)<<12|(a&63)<<6|o&63)-65536,t+=String.fromCharCode(55296+(u>>>10&1023)),t+=String.fromCharCode(56320+(u&1023))}return t}function Fp(i){var t=ca(2*i.length),e,n,r=1,a=0,o=0,u;for(n=0;n<i.length;n+=r)r=1,(u=i.charCodeAt(n))<128?e=u:u<224?(e=(u&31)*64+(i.charCodeAt(n+1)&63),r=2):u<240?(e=(u&15)*4096+(i.charCodeAt(n+1)&63)*64+(i.charCodeAt(n+2)&63),r=3):(r=4,e=(u&7)*262144+(i.charCodeAt(n+1)&63)*4096+(i.charCodeAt(n+2)&63)*64+(i.charCodeAt(n+3)&63),e-=65536,o=55296+(e>>>10&1023),e=56320+(e&1023)),o!==0&&(t[a++]=o&255,t[a++]=o>>>8,o=0),t[a++]=e%256,t[a++]=e>>>8;return t.slice(0,a).toString("ucs2")}function Ap(i){return br(i,"binary").toString("utf8")}var Tl="foo bar baz\xE2\x98\x83\xF0\x9F\x8D\xA3",$o=Ct&&(Ap(Tl)==k0(Tl)&&Ap||Fp(Tl)==k0(Tl)&&Fp)||k0,pr=Ct?function(i){return br(i,"utf8").toString("binary")}:function(i){for(var t=[],e=0,n=0,r=0;e<i.length;)switch(n=i.charCodeAt(e++),!0){case n<128:t.push(String.fromCharCode(n));break;case n<2048:t.push(String.fromCharCode(192+(n>>6))),t.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,r=i.charCodeAt(e++)-56320+(n<<10),t.push(String.fromCharCode(240+(r>>18&7))),t.push(String.fromCharCode(144+(r>>12&63))),t.push(String.fromCharCode(128+(r>>6&63))),t.push(String.fromCharCode(128+(r&63)));break;default:t.push(String.fromCharCode(224+(n>>12))),t.push(String.fromCharCode(128+(n>>6&63))),t.push(String.fromCharCode(128+(n&63)))}return t.join("")};var ny=function(){var i=[["nbsp"," "],["middot","\xB7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(e){for(var n=e.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),r=0;r<i.length;++r)n=n.replace(i[r][0],i[r][1]);return n}}();var Ch=/(^\s|\s$|\n)/;function Ai(i,t){return"<"+i+(t.match(Ch)?' xml:space="preserve"':"")+">"+t+"</"+i+">"}function Zo(i){return Di(i).map(function(t){return" "+t+'="'+i[t]+'"'}).join("")}function ge(i,t,e){return"<"+i+(e!=null?Zo(e):"")+(t!=null?(t.match(Ch)?' xml:space="preserve"':"")+">"+t+"</"+i:"/")+">"}function N0(i,t){try{return i.toISOString().replace(/\.\d*/,"")}catch(e){if(t)throw e}return""}function ry(i,t){switch(typeof i){case"string":var e=ge("vt:lpwstr",It(i));return t&&(e=e.replace(/&quot;/g,"_x0022_")),e;case"number":return ge((i|0)==i?"vt:i4":"vt:r8",It(String(i)));case"boolean":return ge("vt:bool",i?"true":"false")}if(i instanceof Date)return ge("vt:filetime",N0(i));throw new Error("Unable to serialize "+i)}var Si={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},ao=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],gn={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function ay(i,t){for(var e=1-2*(i[t+7]>>>7),n=((i[t+7]&127)<<4)+(i[t+6]>>>4&15),r=i[t+6]&15,a=5;a>=0;--a)r=r*256+i[t+a];return n==2047?r==0?e*(1/0):NaN:(n==0?n=-1022:(n-=1023,r+=Math.pow(2,52)),e*Math.pow(2,n-52)*r)}function oy(i,t,e){var n=(t<0||1/t==-1/0?1:0)<<7,r=0,a=0,o=n?-t:t;isFinite(o)?o==0?r=a=0:(r=Math.floor(Math.log(o)/Math.LN2),a=o*Math.pow(2,52-r),r<=-1023&&(!isFinite(a)||a<Math.pow(2,52))?r=-1022:(a-=Math.pow(2,52),r+=1023)):(r=2047,a=isNaN(t)?26985:0);for(var u=0;u<=5;++u,a/=256)i[e+u]=a&255;i[e+6]=(r&15)<<4|a&15,i[e+7]=r>>4|n}var Op=function(i){for(var t=[],e=10240,n=0;n<i[0].length;++n)if(i[0][n])for(var r=0,a=i[0][n].length;r<a;r+=e)t.push.apply(t,i[0][n].slice(r,r+e));return t},Dp=Ct?function(i){return i[0].length>0&&Buffer.isBuffer(i[0][0])?Buffer.concat(i[0].map(function(t){return Buffer.isBuffer(t)?t:br(t)})):Op(i)}:Op,Rp=function(i,t,e){for(var n=[],r=t;r<e;r+=2)n.push(String.fromCharCode(Ho(i,r)));return n.join("").replace(Ja,"")},Kl=Ct?function(i,t,e){return Buffer.isBuffer(i)?i.toString("utf16le",t,e).replace(Ja,""):Rp(i,t,e)}:Rp,Np=function(i,t,e){for(var n=[],r=t;r<t+e;++r)n.push(("0"+i[r].toString(16)).slice(-2));return n.join("")},Sh=Ct?function(i,t,e){return Buffer.isBuffer(i)?i.toString("hex",t,t+e):Np(i,t,e)}:Np,Bp=function(i,t,e){for(var n=[],r=t;r<e;r++)n.push(String.fromCharCode(Ya(i,r)));return n.join("")},oo=Ct?function(t,e,n){return Buffer.isBuffer(t)?t.toString("utf8",e,n):Bp(t,e,n)}:Bp,wh=function(i,t){var e=Ci(i,t);return e>0?oo(i,t+4,t+4+e-1):""},z0=wh,Eh=function(i,t){var e=Ci(i,t);return e>0?oo(i,t+4,t+4+e-1):""},G0=Eh,Th=function(i,t){var e=2*Ci(i,t);return e>0?oo(i,t+4,t+4+e-1):""},q0=Th,Ph=function(t,e){var n=Ci(t,e);return n>0?Kl(t,e+4,e+4+n):""},X0=Ph,kh=function(i,t){var e=Ci(i,t);return e>0?oo(i,t+4,t+4+e):""},K0=kh,Ih=function(i,t){return ay(i,t)},Rl=Ih,Y0=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};Ct&&(z0=function(t,e){if(!Buffer.isBuffer(t))return wh(t,e);var n=t.readUInt32LE(e);return n>0?t.toString("utf8",e+4,e+4+n-1):""},G0=function(t,e){if(!Buffer.isBuffer(t))return Eh(t,e);var n=t.readUInt32LE(e);return n>0?t.toString("utf8",e+4,e+4+n-1):""},q0=function(t,e){if(!Buffer.isBuffer(t))return Th(t,e);var n=2*t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+n-1)},X0=function(t,e){if(!Buffer.isBuffer(t))return Ph(t,e);var n=t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+n)},K0=function(t,e){if(!Buffer.isBuffer(t))return kh(t,e);var n=t.readUInt32LE(e);return t.toString("utf8",e+4,e+4+n)},Rl=function(t,e){return Buffer.isBuffer(t)?t.readDoubleLE(e):Ih(t,e)},Y0=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});function sy(){Kl=function(i,t,e){return Rt.utils.decode(1200,i.slice(t,e)).replace(Ja,"")},oo=function(i,t,e){return Rt.utils.decode(65001,i.slice(t,e))},z0=function(i,t){var e=Ci(i,t);return e>0?Rt.utils.decode(no,i.slice(t+4,t+4+e-1)):""},G0=function(i,t){var e=Ci(i,t);return e>0?Rt.utils.decode(sa,i.slice(t+4,t+4+e-1)):""},q0=function(i,t){var e=2*Ci(i,t);return e>0?Rt.utils.decode(1200,i.slice(t+4,t+4+e-1)):""},X0=function(i,t){var e=Ci(i,t);return e>0?Rt.utils.decode(1200,i.slice(t+4,t+4+e)):""},K0=function(i,t){var e=Ci(i,t);return e>0?Rt.utils.decode(65001,i.slice(t+4,t+4+e)):""}}typeof Rt<"u"&&sy();var Ya=function(i,t){return i[t]},Ho=function(i,t){return i[t+1]*256+i[t]},ly=function(i,t){var e=i[t+1]*256+i[t];return e<32768?e:(65535-e+1)*-1},Ci=function(i,t){return i[t+3]*(1<<24)+(i[t+2]<<16)+(i[t+1]<<8)+i[t]},oa=function(i,t){return i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t]},cy=function(i,t){return i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3]};function zo(i,t){var e="",n,r,a=[],o,u,m,f;switch(t){case"dbcs":if(f=this.l,Ct&&Buffer.isBuffer(this))e=this.slice(this.l,this.l+2*i).toString("utf16le");else for(m=0;m<i;++m)e+=String.fromCharCode(Ho(this,f)),f+=2;i*=2;break;case"utf8":e=oo(this,this.l,this.l+i);break;case"utf16le":i*=2,e=Kl(this,this.l,this.l+i);break;case"wstr":if(typeof Rt<"u")e=Rt.utils.decode(sa,this.slice(this.l,this.l+2*i));else return zo.call(this,i,"dbcs");i=2*i;break;case"lpstr-ansi":e=z0(this,this.l),i=4+Ci(this,this.l);break;case"lpstr-cp":e=G0(this,this.l),i=4+Ci(this,this.l);break;case"lpwstr":e=q0(this,this.l),i=4+2*Ci(this,this.l);break;case"lpp4":i=4+Ci(this,this.l),e=X0(this,this.l),i&2&&(i+=2);break;case"8lpp4":i=4+Ci(this,this.l),e=K0(this,this.l),i&3&&(i+=4-(i&3));break;case"cstr":for(i=0,e="";(o=Ya(this,this.l+i++))!==0;)a.push(Cl(o));e=a.join("");break;case"_wstr":for(i=0,e="";(o=Ho(this,this.l+i))!==0;)a.push(Cl(o)),i+=2;i+=2,e=a.join("");break;case"dbcs-cont":for(e="",f=this.l,m=0;m<i;++m){if(this.lens&&this.lens.indexOf(f)!==-1)return o=Ya(this,f),this.l=f+1,u=zo.call(this,i-m,o?"dbcs-cont":"sbcs-cont"),a.join("")+u;a.push(Cl(Ho(this,f))),f+=2}e=a.join(""),i*=2;break;case"cpstr":if(typeof Rt<"u"){e=Rt.utils.decode(sa,this.slice(this.l,this.l+i));break}case"sbcs-cont":for(e="",f=this.l,m=0;m!=i;++m){if(this.lens&&this.lens.indexOf(f)!==-1)return o=Ya(this,f),this.l=f+1,u=zo.call(this,i-m,o?"dbcs-cont":"sbcs-cont"),a.join("")+u;a.push(Cl(Ya(this,f))),f+=1}e=a.join("");break;default:switch(i){case 1:return n=Ya(this,this.l),this.l++,n;case 2:return n=(t==="i"?ly:Ho)(this,this.l),this.l+=2,n;case 4:case-4:return t==="i"||(this[this.l+3]&128)===0?(n=(i>0?oa:cy)(this,this.l),this.l+=4,n):(r=Ci(this,this.l),this.l+=4,r);case 8:case-8:if(t==="f")return i==8?r=Rl(this,this.l):r=Rl([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;i=8;case 16:e=Sh(this,this.l,i);break}}return this.l+=i,e}var dy=function(i,t,e){i[e]=t&255,i[e+1]=t>>>8&255,i[e+2]=t>>>16&255,i[e+3]=t>>>24&255},uy=function(i,t,e){i[e]=t&255,i[e+1]=t>>8&255,i[e+2]=t>>16&255,i[e+3]=t>>24&255},my=function(i,t,e){i[e]=t&255,i[e+1]=t>>>8&255};function fy(i,t,e){var n=0,r=0;if(e==="dbcs"){for(r=0;r!=t.length;++r)my(this,t.charCodeAt(r),this.l+2*r);n=2*t.length}else if(e==="sbcs"){if(typeof Rt<"u"&&no==874)for(r=0;r!=t.length;++r){var a=Rt.utils.encode(no,t.charAt(r));this[this.l+r]=a[0]}else for(t=t.replace(/[^\x00-\x7F]/g,"_"),r=0;r!=t.length;++r)this[this.l+r]=t.charCodeAt(r)&255;n=t.length}else if(e==="hex"){for(;r<i;++r)this[this.l++]=parseInt(t.slice(2*r,2*r+2),16)||0;return this}else if(e==="utf16le"){var o=Math.min(this.l+i,this.length);for(r=0;r<Math.min(t.length,i);++r){var u=t.charCodeAt(r);this[this.l++]=u&255,this[this.l++]=u>>8}for(;this.l<o;)this[this.l++]=0;return this}else switch(i){case 1:n=1,this[this.l]=t&255;break;case 2:n=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:n=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:n=4,dy(this,t,this.l);break;case 8:if(n=8,e==="f"){oy(this,t,this.l);break}case 16:break;case-4:n=4,uy(this,t,this.l);break}return this.l+=n,this}function Mh(i,t){var e=Sh(this,this.l,i.length>>1);if(e!==i)throw new Error(t+"Expected "+i+" saw "+e);this.l+=i.length>>1}function hn(i,t){i.l=t,i.read_shift=zo,i.chk=Mh,i.write_shift=fy}function sr(i,t){i.l+=t}function ne(i){var t=ca(i);return hn(t,0),t}function Zi(){var i=[],t=Ct?256:2048,e=function(f){var h=ne(f);return hn(h,0),h},n=e(t),r=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&i.push(n),n=null)},a=function(f){return n&&f<n.length-n.l?n:(r(),n=e(Math.max(f+1,t)))},o=function(){return r(),Fi(i)},u=function(f){r(),n=f,n.l==null&&(n.l=n.length),a(t)};return{next:a,push:u,end:o,_bufs:i}}function de(i,t,e,n){var r=+t,a;if(!isNaN(r)){n||(n=oT[r].p||(e||[]).length||0),a=1+(r>=128?1:0)+1,n>=128&&++a,n>=16384&&++a,n>=2097152&&++a;var o=i.next(a);r<=127?o.write_shift(1,r):(o.write_shift(1,(r&127)+128),o.write_shift(1,r>>7));for(var u=0;u!=4;++u)if(n>=128)o.write_shift(1,(n&127)+128),n>>=7;else{o.write_shift(1,n);break}n>0&&Y0(e)&&i.push(e)}}function Go(i,t,e){var n=tn(i);if(t.s?(n.cRel&&(n.c+=t.s.c),n.rRel&&(n.r+=t.s.r)):(n.cRel&&(n.c+=t.c),n.rRel&&(n.r+=t.r)),!e||e.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function Lp(i,t,e){var n=tn(i);return n.s=Go(n.s,t.s,e),n.e=Go(n.e,t.s,e),n}function qo(i,t){if(i.cRel&&i.c<0)for(i=tn(i);i.c<0;)i.c+=t>8?16384:256;if(i.rRel&&i.r<0)for(i=tn(i);i.r<0;)i.r+=t>8?1048576:t>5?65536:16384;var e=Mt(i);return!i.cRel&&i.cRel!=null&&(e=gy(e)),!i.rRel&&i.rRel!=null&&(e=py(e)),e}function I0(i,t){return i.s.r==0&&!i.s.rRel&&i.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!i.e.rRel?(i.s.cRel?"":"$")+Li(i.s.c)+":"+(i.e.cRel?"":"$")+Li(i.e.c):i.s.c==0&&!i.s.cRel&&i.e.c==(t.biff>=12?16383:255)&&!i.e.cRel?(i.s.rRel?"":"$")+Oi(i.s.r)+":"+(i.e.rRel?"":"$")+Oi(i.e.r):qo(i.s,t.biff)+":"+qo(i.e,t.biff)}function Q0(i){return parseInt(hy(i),10)-1}function Oi(i){return""+(i+1)}function py(i){return i.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function hy(i){return i.replace(/\$(\d+)$/,"$1")}function J0(i){for(var t=_y(i),e=0,n=0;n!==t.length;++n)e=26*e+t.charCodeAt(n)-64;return e-1}function Li(i){if(i<0)throw new Error("invalid column "+i);var t="";for(++i;i;i=Math.floor((i-1)/26))t=String.fromCharCode((i-1)%26+65)+t;return t}function gy(i){return i.replace(/^([A-Z])/,"$$$1")}function _y(i){return i.replace(/^\$([A-Z])/,"$1")}function vy(i){return i.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function wi(i){for(var t=0,e=0,n=0;n<i.length;++n){var r=i.charCodeAt(n);r>=48&&r<=57?t=10*t+(r-48):r>=65&&r<=90&&(e=26*e+(r-64))}return{c:e-1,r:t-1}}function Mt(i){for(var t=i.c+1,e="";t;t=(t-1)/26|0)e=String.fromCharCode((t-1)%26+65)+e;return e+(i.r+1)}function _n(i){var t=i.indexOf(":");return t==-1?{s:wi(i),e:wi(i)}:{s:wi(i.slice(0,t)),e:wi(i.slice(t+1))}}function fi(i,t){return typeof t>"u"||typeof t=="number"?fi(i.s,i.e):(typeof i!="string"&&(i=Mt(i)),typeof t!="string"&&(t=Mt(t)),i==t?i:i+":"+t)}function $t(i){var t={s:{c:0,r:0},e:{c:0,r:0}},e=0,n=0,r=0,a=i.length;for(e=0;n<a&&!((r=i.charCodeAt(n)-64)<1||r>26);++n)e=26*e+r;for(t.s.c=--e,e=0;n<a&&!((r=i.charCodeAt(n)-48)<0||r>9);++n)e=10*e+r;if(t.s.r=--e,n===a||r!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++n,e=0;n!=a&&!((r=i.charCodeAt(n)-64)<1||r>26);++n)e=26*e+r;for(t.e.c=--e,e=0;n!=a&&!((r=i.charCodeAt(n)-48)<0||r>9);++n)e=10*e+r;return t.e.r=--e,t}function Vp(i,t){var e=i.t=="d"&&t instanceof Date;if(i.z!=null)try{return i.w=Nr(i.z,e?en(t):t)}catch{}try{return i.w=Nr((i.XF||{}).numFmtId||(e?14:0),e?en(t):t)}catch{return""+t}}function xr(i,t,e){return i==null||i.t==null||i.t=="z"?"":i.w!==void 0?i.w:(i.t=="d"&&!i.z&&e&&e.dateNF&&(i.z=e.dateNF),i.t=="e"?rs[i.v]||i.v:t==null?Vp(i,i.v):Vp(i,t))}function ma(i,t){var e=t&&t.sheet?t.sheet:"Sheet1",n={};return n[e]=i,{SheetNames:[e],Sheets:n}}function Fh(i,t,e){var n=e||{},r=i?Array.isArray(i):n.dense;or!=null&&r==null&&(r=or);var a=i||(r?[]:{}),o=0,u=0;if(a&&n.origin!=null){if(typeof n.origin=="number")o=n.origin;else{var m=typeof n.origin=="string"?wi(n.origin):n.origin;o=m.r,u=m.c}a["!ref"]||(a["!ref"]="A1:A1")}var f={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(a["!ref"]){var h=$t(a["!ref"]);f.s.c=h.s.c,f.s.r=h.s.r,f.e.c=Math.max(f.e.c,h.e.c),f.e.r=Math.max(f.e.r,h.e.r),o==-1&&(f.e.r=o=h.e.r+1)}for(var g=0;g!=t.length;++g)if(t[g]){if(!Array.isArray(t[g]))throw new Error("aoa_to_sheet expects an array of arrays");for(var x=0;x!=t[g].length;++x)if(!(typeof t[g][x]>"u")){var b={v:t[g][x]},S=o+g,v=u+x;if(f.s.r>S&&(f.s.r=S),f.s.c>v&&(f.s.c=v),f.e.r<S&&(f.e.r=S),f.e.c<v&&(f.e.c=v),t[g][x]&&typeof t[g][x]=="object"&&!Array.isArray(t[g][x])&&!(t[g][x]instanceof Date))b=t[g][x];else if(Array.isArray(b.v)&&(b.f=t[g][x][1],b.v=b.v[0]),b.v===null)if(b.f)b.t="n";else if(n.nullError)b.t="e",b.v=0;else if(n.sheetStubs)b.t="z";else continue;else typeof b.v=="number"?b.t="n":typeof b.v=="boolean"?b.t="b":b.v instanceof Date?(b.z=n.dateNF||ni[14],n.cellDates?(b.t="d",b.w=Nr(b.z,en(b.v))):(b.t="n",b.v=en(b.v),b.w=Nr(b.z,b.v))):b.t="s";if(r)a[S]||(a[S]=[]),a[S][v]&&a[S][v].z&&(b.z=a[S][v].z),a[S][v]=b;else{var E=Mt({c:v,r:S});a[E]&&a[E].z&&(b.z=a[E].z),a[E]=b}}}return f.s.c<1e7&&(a["!ref"]=fi(f)),a}function so(i,t){return Fh(null,i,t)}function xy(i){return i.read_shift(4,"i")}function jn(i,t){return t||(t=ne(4)),t.write_shift(4,i),t}function Vi(i){var t=i.read_shift(4);return t===0?"":i.read_shift(t,"dbcs")}function Ei(i,t){var e=!1;return t==null&&(e=!0,t=ne(4+2*i.length)),t.write_shift(4,i.length),i.length>0&&t.write_shift(0,i,"dbcs"),e?t.slice(0,t.l):t}function by(i){return{ich:i.read_shift(2),ifnt:i.read_shift(2)}}function yy(i,t){return t||(t=ne(4)),t.write_shift(2,i.ich||0),t.write_shift(2,i.ifnt||0),t}function Z0(i,t){var e=i.l,n=i.read_shift(1),r=Vi(i),a=[],o={t:r,h:r};if((n&1)!==0){for(var u=i.read_shift(4),m=0;m!=u;++m)a.push(by(i));o.r=a}else o.r=[{ich:0,ifnt:0}];return i.l=e+t,o}function Cy(i,t){var e=!1;return t==null&&(e=!0,t=ne(15+4*i.t.length)),t.write_shift(1,0),Ei(i.t,t),e?t.slice(0,t.l):t}var Sy=Z0;function wy(i,t){var e=!1;return t==null&&(e=!0,t=ne(23+4*i.t.length)),t.write_shift(1,1),Ei(i.t,t),t.write_shift(4,1),yy({ich:0,ifnt:0},t),e?t.slice(0,t.l):t}function kn(i){var t=i.read_shift(4),e=i.read_shift(2);return e+=i.read_shift(1)<<16,i.l++,{c:t,iStyleRef:e}}function fa(i,t){return t==null&&(t=ne(8)),t.write_shift(-4,i.c),t.write_shift(3,i.iStyleRef||i.s),t.write_shift(1,0),t}function pa(i){var t=i.read_shift(2);return t+=i.read_shift(1)<<16,i.l++,{c:-1,iStyleRef:t}}function ha(i,t){return t==null&&(t=ne(4)),t.write_shift(3,i.iStyleRef||i.s),t.write_shift(1,0),t}var Ey=Vi,Ah=Ei;function ed(i){var t=i.read_shift(4);return t===0||t===4294967295?"":i.read_shift(t,"dbcs")}function Nl(i,t){var e=!1;return t==null&&(e=!0,t=ne(127)),t.write_shift(4,i.length>0?i.length:4294967295),i.length>0&&t.write_shift(0,i,"dbcs"),e?t.slice(0,t.l):t}var Ty=Vi,B0=ed,td=Nl;function Oh(i){var t=i.slice(i.l,i.l+4),e=t[0]&1,n=t[0]&2;i.l+=4;var r=n===0?Rl([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):oa(t,0)>>2;return e?r/100:r}function Dh(i,t){t==null&&(t=ne(4));var e=0,n=0,r=i*100;if(i==(i|0)&&i>=-(1<<29)&&i<1<<29?n=1:r==(r|0)&&r>=-(1<<29)&&r<1<<29&&(n=1,e=1),n)t.write_shift(-4,((e?r:i)<<2)+(e+2));else throw new Error("unsupported RkNumber "+i)}function Rh(i){var t={s:{},e:{}};return t.s.r=i.read_shift(4),t.e.r=i.read_shift(4),t.s.c=i.read_shift(4),t.e.c=i.read_shift(4),t}function Py(i,t){return t||(t=ne(16)),t.write_shift(4,i.s.r),t.write_shift(4,i.e.r),t.write_shift(4,i.s.c),t.write_shift(4,i.e.c),t}var ga=Rh,lo=Py;function co(i){if(i.length-i.l<8)throw"XLS Xnum Buffer underflow";return i.read_shift(8,"f")}function da(i,t){return(t||ne(8)).write_shift(8,i,"f")}function ky(i){var t={},e=i.read_shift(1),n=e>>>1,r=i.read_shift(1),a=i.read_shift(2,"i"),o=i.read_shift(1),u=i.read_shift(1),m=i.read_shift(1);switch(i.l++,n){case 0:t.auto=1;break;case 1:t.index=r;var f=By[r];f&&(t.rgb=Yp(f));break;case 2:t.rgb=Yp([o,u,m]);break;case 3:t.theme=r;break}return a!=0&&(t.tint=a>0?a/32767:a/32768),t}function Bl(i,t){if(t||(t=ne(8)),!i||i.auto)return t.write_shift(4,0),t.write_shift(4,0),t;i.index!=null?(t.write_shift(1,2),t.write_shift(1,i.index)):i.theme!=null?(t.write_shift(1,6),t.write_shift(1,i.theme)):(t.write_shift(1,5),t.write_shift(1,0));var e=i.tint||0;if(e>0?e*=32767:e<0&&(e*=32768),t.write_shift(2,e),!i.rgb||i.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var n=i.rgb||"FFFFFF";typeof n=="number"&&(n=("000000"+n.toString(16)).slice(-6)),t.write_shift(1,parseInt(n.slice(0,2),16)),t.write_shift(1,parseInt(n.slice(2,4),16)),t.write_shift(1,parseInt(n.slice(4,6),16)),t.write_shift(1,255)}return t}function Iy(i){var t=i.read_shift(1);i.l++;var e={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return e}function My(i,t){t||(t=ne(2));var e=(i.italic?2:0)|(i.strike?8:0)|(i.outline?16:0)|(i.shadow?32:0)|(i.condense?64:0)|(i.extend?128:0);return t.write_shift(1,e),t.write_shift(1,0),t}var Nh=2,pn=3,Pl=11;var Ll=19;var kl=64,Fy=65,Ay=71;var Oy=4108,Dy=4126,Mi=80;var Up={1:{n:"CodePage",t:Nh},2:{n:"Category",t:Mi},3:{n:"PresentationFormat",t:Mi},4:{n:"ByteCount",t:pn},5:{n:"LineCount",t:pn},6:{n:"ParagraphCount",t:pn},7:{n:"SlideCount",t:pn},8:{n:"NoteCount",t:pn},9:{n:"HiddenCount",t:pn},10:{n:"MultimediaClipCount",t:pn},11:{n:"ScaleCrop",t:Pl},12:{n:"HeadingPairs",t:Oy},13:{n:"TitlesOfParts",t:Dy},14:{n:"Manager",t:Mi},15:{n:"Company",t:Mi},16:{n:"LinksUpToDate",t:Pl},17:{n:"CharacterCount",t:pn},19:{n:"SharedDoc",t:Pl},22:{n:"HyperlinksChanged",t:Pl},23:{n:"AppVersion",t:pn,p:"version"},24:{n:"DigSig",t:Fy},26:{n:"ContentType",t:Mi},27:{n:"ContentStatus",t:Mi},28:{n:"Language",t:Mi},29:{n:"Version",t:Mi},255:{},2147483648:{n:"Locale",t:Ll},2147483651:{n:"Behavior",t:Ll},1919054434:{}},jp={1:{n:"CodePage",t:Nh},2:{n:"Title",t:Mi},3:{n:"Subject",t:Mi},4:{n:"Author",t:Mi},5:{n:"Keywords",t:Mi},6:{n:"Comments",t:Mi},7:{n:"Template",t:Mi},8:{n:"LastAuthor",t:Mi},9:{n:"RevNumber",t:Mi},10:{n:"EditTime",t:kl},11:{n:"LastPrinted",t:kl},12:{n:"CreatedDate",t:kl},13:{n:"ModifiedDate",t:kl},14:{n:"PageCount",t:pn},15:{n:"WordCount",t:pn},16:{n:"CharCount",t:pn},17:{n:"Thumbnail",t:Ay},18:{n:"Application",t:Mi},19:{n:"DocSecurity",t:pn},255:{},2147483648:{n:"Locale",t:Ll},2147483651:{n:"Behavior",t:Ll},1919054434:{}};function Ry(i){return i.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var Ny=Ry([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),By=tn(Ny),rs={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"};var Ly={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Il={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function Bh(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function Lh(i,t){var e=qb(Ly),n=[],r;n[n.length]=pi,n[n.length]=ge("Types",null,{xmlns:Si.CT,"xmlns:xsd":Si.xsd,"xmlns:xsi":Si.xsi}),n=n.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(m){return ge("Default",null,{Extension:m[0],ContentType:m[1]})}));var a=function(m){i[m]&&i[m].length>0&&(r=i[m][0],n[n.length]=ge("Override",null,{PartName:(r[0]=="/"?"":"/")+r,ContentType:Il[m][t.bookType]||Il[m].xlsx}))},o=function(m){(i[m]||[]).forEach(function(f){n[n.length]=ge("Override",null,{PartName:(f[0]=="/"?"":"/")+f,ContentType:Il[m][t.bookType]||Il[m].xlsx})})},u=function(m){(i[m]||[]).forEach(function(f){n[n.length]=ge("Override",null,{PartName:(f[0]=="/"?"":"/")+f,ContentType:e[m][0]})})};return a("workbooks"),o("sheets"),o("charts"),u("themes"),["strs","styles"].forEach(a),["coreprops","extprops","custprops"].forEach(u),u("vba"),u("comments"),u("threadedcomments"),u("drawings"),o("metadata"),u("people"),n.length>2&&(n[n.length]="</Types>",n[1]=n[1].replace("/>",">")),n.join("")}var vt={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Vh(i){var t=i.lastIndexOf("/");return i.slice(0,t+1)+"_rels/"+i.slice(t+1)+".rels"}function eo(i){var t=[pi,ge("Relationships",null,{xmlns:Si.RELS})];return Di(i["!id"]).forEach(function(e){t[t.length]=ge("Relationship",null,i["!id"][e])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function kt(i,t,e,n,r,a){if(r||(r={}),i["!id"]||(i["!id"]={}),i["!idx"]||(i["!idx"]=1),t<0)for(t=i["!idx"];i["!id"]["rId"+t];++t);if(i["!idx"]=t+1,r.Id="rId"+t,r.Type=n,r.Target=e,a?r.TargetMode=a:[vt.HLINK,vt.XPATH,vt.XMISS].indexOf(r.Type)>-1&&(r.TargetMode="External"),i["!id"][r.Id])throw new Error("Cannot rewrite rId "+t);return i["!id"][r.Id]=r,i[("/"+r.Target).replace("//","/")]=r,t}function Vy(i){var t=[pi];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var e=0;e<i.length;++e)t.push('  <manifest:file-entry manifest:full-path="'+i[e][0]+'" manifest:media-type="'+i[e][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function Wp(i,t,e){return['  <rdf:Description rdf:about="'+i+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(e||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function Uy(i,t){return['  <rdf:Description rdf:about="'+i+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function jy(i){var t=[pi];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var e=0;e!=i.length;++e)t.push(Wp(i[e][0],i[e][1])),t.push(Uy("",i[e][0]));return t.push(Wp("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function Uh(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+Ko.version+"</meta:generator></office:meta></office:document-meta>"}var la=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function M0(i,t,e,n,r){r[i]!=null||t==null||t===""||(r[i]=t,t=It(t),n[n.length]=e?ge(i,t,e):Ai(i,t))}function jh(i,t){var e=t||{},n=[pi,ge("cp:coreProperties",null,{"xmlns:cp":Si.CORE_PROPS,"xmlns:dc":Si.dc,"xmlns:dcterms":Si.dcterms,"xmlns:dcmitype":Si.dcmitype,"xmlns:xsi":Si.xsi})],r={};if(!i&&!e.Props)return n.join("");i&&(i.CreatedDate!=null&&M0("dcterms:created",typeof i.CreatedDate=="string"?i.CreatedDate:N0(i.CreatedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},n,r),i.ModifiedDate!=null&&M0("dcterms:modified",typeof i.ModifiedDate=="string"?i.ModifiedDate:N0(i.ModifiedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},n,r));for(var a=0;a!=la.length;++a){var o=la[a],u=e.Props&&e.Props[o[1]]!=null?e.Props[o[1]]:i?i[o[1]]:null;u===!0?u="1":u===!1?u="0":typeof u=="number"&&(u=String(u)),u!=null&&M0(o[0],u,null,n,r)}return n.length>2&&(n[n.length]="</cp:coreProperties>",n[1]=n[1].replace("/>",">")),n.join("")}var to=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],Wh=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Hh(i){var t=[],e=ge;return i||(i={}),i.Application="SheetJS",t[t.length]=pi,t[t.length]=ge("Properties",null,{xmlns:Si.EXT_PROPS,"xmlns:vt":Si.vt}),to.forEach(function(n){if(i[n[1]]!==void 0){var r;switch(n[2]){case"string":r=It(String(i[n[1]]));break;case"bool":r=i[n[1]]?"true":"false";break}r!==void 0&&(t[t.length]=e(n[0],r))}}),t[t.length]=e("HeadingPairs",e("vt:vector",e("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+e("vt:variant",e("vt:i4",String(i.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=e("TitlesOfParts",e("vt:vector",i.SheetNames.map(function(n){return"<vt:lpstr>"+It(n)+"</vt:lpstr>"}).join(""),{size:i.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function $h(i){var t=[pi,ge("Properties",null,{xmlns:Si.CUST_PROPS,"xmlns:vt":Si.vt})];if(!i)return t.join("");var e=1;return Di(i).forEach(function(r){++e,t[t.length]=ge("property",ry(i[r],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:e,name:It(r)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var Hp={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Wy(i,t){var e=[];return Di(Hp).map(function(n){for(var r=0;r<la.length;++r)if(la[r][1]==n)return la[r];for(r=0;r<to.length;++r)if(to[r][1]==n)return to[r];throw n}).forEach(function(n){if(i[n[1]]!=null){var r=t&&t.Props&&t.Props[n[1]]!=null?t.Props[n[1]]:i[n[1]];switch(n[2]){case"date":r=new Date(r).toISOString().replace(/\.\d*Z/,"Z");break}typeof r=="number"?r=String(r):r===!0||r===!1?r=r?"1":"0":r instanceof Date&&(r=new Date(r).toISOString().replace(/\.\d*Z/,"")),e.push(Ai(Hp[n[1]]||n[1],r))}}),ge("DocumentProperties",e.join(""),{xmlns:gn.o})}function Hy(i,t){var e=["Worksheets","SheetNames"],n="CustomDocumentProperties",r=[];return i&&Di(i).forEach(function(a){if(Object.prototype.hasOwnProperty.call(i,a)){for(var o=0;o<la.length;++o)if(a==la[o][1])return;for(o=0;o<to.length;++o)if(a==to[o][1])return;for(o=0;o<e.length;++o)if(a==e[o])return;var u=i[a],m="string";typeof u=="number"?(m="float",u=String(u)):u===!0||u===!1?(m="boolean",u=u?"1":"0"):u=String(u),r.push(ge(Mp(a),u,{"dt:dt":m}))}}),t&&Di(t).forEach(function(a){if(Object.prototype.hasOwnProperty.call(t,a)&&!(i&&Object.prototype.hasOwnProperty.call(i,a))){var o=t[a],u="string";typeof o=="number"?(u="float",o=String(o)):o===!0||o===!1?(u="boolean",o=o?"1":"0"):o instanceof Date?(u="dateTime.tz",o=o.toISOString()):o=String(o),r.push(ge(Mp(a),o,{"dt:dt":u}))}}),"<"+n+' xmlns="'+gn.o+'">'+r.join("")+"</"+n+">"}function $y(i){var t=typeof i=="string"?new Date(Date.parse(i)):i,e=t.getTime()/1e3+11644473600,n=e%Math.pow(2,32),r=(e-n)/Math.pow(2,32);n*=1e7,r*=1e7;var a=n/Math.pow(2,32)|0;a>0&&(n=n%Math.pow(2,32),r+=a);var o=ne(8);return o.write_shift(4,n),o.write_shift(4,r),o}function $p(i,t){var e=ne(4),n=ne(4);switch(e.write_shift(4,i==80?31:i),i){case 3:n.write_shift(-4,t);break;case 5:n=ne(8),n.write_shift(8,t,"f");break;case 11:n.write_shift(4,t?1:0);break;case 64:n=$y(t);break;case 31:case 80:for(n=ne(4+2*(t.length+1)+(t.length%2?0:2)),n.write_shift(4,t.length+1),n.write_shift(0,t,"dbcs");n.l!=n.length;)n.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+i+" "+t)}return Fi([e,n])}var zh=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function zy(i){switch(typeof i){case"boolean":return 11;case"number":return(i|0)==i?3:5;case"string":return 31;case"object":if(i instanceof Date)return 64;break}return-1}function zp(i,t,e){var n=ne(8),r=[],a=[],o=8,u=0,m=ne(8),f=ne(8);if(m.write_shift(4,2),m.write_shift(4,1200),f.write_shift(4,1),a.push(m),r.push(f),o+=8+m.length,!t){f=ne(8),f.write_shift(4,0),r.unshift(f);var h=[ne(4)];for(h[0].write_shift(4,i.length),u=0;u<i.length;++u){var g=i[u][0];for(m=ne(8+2*(g.length+1)+(g.length%2?0:2)),m.write_shift(4,u+2),m.write_shift(4,g.length+1),m.write_shift(0,g,"dbcs");m.l!=m.length;)m.write_shift(1,0);h.push(m)}m=Fi(h),a.unshift(m),o+=8+m.length}for(u=0;u<i.length;++u)if(!(t&&!t[i[u][0]])&&!(zh.indexOf(i[u][0])>-1||Wh.indexOf(i[u][0])>-1)&&i[u][1]!=null){var x=i[u][1],b=0;if(t){b=+t[i[u][0]];var S=e[b];if(S.p=="version"&&typeof x=="string"){var v=x.split(".");x=(+v[0]<<16)+(+v[1]||0)}m=$p(S.t,x)}else{var E=zy(x);E==-1&&(E=31,x=String(x)),m=$p(E,x)}a.push(m),f=ne(8),f.write_shift(4,t?b:2+u),r.push(f),o+=8+m.length}var j=8*(a.length+1);for(u=0;u<a.length;++u)r[u].write_shift(4,j),j+=a[u].length;return n.write_shift(4,o),n.write_shift(4,a.length),Fi([n].concat(r).concat(a))}function Gp(i,t,e,n,r,a){var o=ne(r?68:48),u=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,Ot.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,r?2:1),o.write_shift(16,t,"hex"),o.write_shift(4,r?68:48);var m=zp(i,e,n);if(u.push(m),r){var f=zp(r,null,null);o.write_shift(16,a,"hex"),o.write_shift(4,68+m.length),u.push(f)}return Fi(u)}function Gy(i,t){t||(t=ne(i));for(var e=0;e<i;++e)t.write_shift(1,0);return t}function qy(i,t){return i.read_shift(t)===1}function zi(i,t){return t||(t=ne(2)),t.write_shift(2,+!!i),t}function Gh(i){return i.read_shift(2,"u")}function Pn(i,t){return t||(t=ne(2)),t.write_shift(2,i),t}function qh(i,t,e){return e||(e=ne(2)),e.write_shift(1,t=="e"?+i:+!!i),e.write_shift(1,t=="e"?1:0),e}function Xh(i,t,e){var n=i.read_shift(e&&e.biff>=12?2:1),r="sbcs-cont",a=sa;if(e&&e.biff>=8&&(sa=1200),!e||e.biff==8){var o=i.read_shift(1);o&&(r="dbcs-cont")}else e.biff==12&&(r="wstr");e.biff>=2&&e.biff<=5&&(r="cpstr");var u=n?i.read_shift(n,r):"";return sa=a,u}function Xy(i){var t=i.t||"",e=1,n=ne(3+(e>1?2:0));n.write_shift(2,t.length),n.write_shift(1,(e>1?8:0)|1),e>1&&n.write_shift(2,e);var r=ne(2*t.length);r.write_shift(2*t.length,t,"utf16le");var a=[n,r];return Fi(a)}function Ky(i,t,e){var n;if(e){if(e.biff>=2&&e.biff<=5)return i.read_shift(t,"cpstr");if(e.biff>=12)return i.read_shift(t,"dbcs-cont")}var r=i.read_shift(1);return r===0?n=i.read_shift(t,"sbcs-cont"):n=i.read_shift(t,"dbcs-cont"),n}function Yy(i,t,e){var n=i.read_shift(e&&e.biff==2?1:2);return n===0?(i.l++,""):Ky(i,n,e)}function Qy(i,t,e){if(e.biff>5)return Yy(i,t,e);var n=i.read_shift(1);return n===0?(i.l++,""):i.read_shift(n,e.biff<=4||!i.lens?"cpstr":"sbcs-cont")}function Kh(i,t,e){return e||(e=ne(3+2*i.length)),e.write_shift(2,i.length),e.write_shift(1,1),e.write_shift(31,i,"utf16le"),e}function qp(i,t){t||(t=ne(6+i.length*2)),t.write_shift(4,1+i.length);for(var e=0;e<i.length;++e)t.write_shift(2,i.charCodeAt(e));return t.write_shift(2,0),t}function Jy(i){var t=ne(512),e=0,n=i.Target;n.slice(0,7)=="file://"&&(n=n.slice(7));var r=n.indexOf("#"),a=r>-1?31:23;switch(n.charAt(0)){case"#":a=28;break;case".":a&=-3;break}t.write_shift(4,2),t.write_shift(4,a);var o=[8,6815827,6619237,4849780,83];for(e=0;e<o.length;++e)t.write_shift(4,o[e]);if(a==28)n=n.slice(1),qp(n,t);else if(a&2){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),e=0;e<o.length;++e)t.write_shift(1,parseInt(o[e],16));var u=r>-1?n.slice(0,r):n;for(t.write_shift(4,2*(u.length+1)),e=0;e<u.length;++e)t.write_shift(2,u.charCodeAt(e));t.write_shift(2,0),a&8&&qp(r>-1?n.slice(r+1):"",t)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),e=0;e<o.length;++e)t.write_shift(1,parseInt(o[e],16));for(var m=0;n.slice(m*3,m*3+3)=="../"||n.slice(m*3,m*3+3)=="..\\";)++m;for(t.write_shift(2,m),t.write_shift(4,n.length-3*m+1),e=0;e<n.length-3*m;++e)t.write_shift(1,n.charCodeAt(e+3*m)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),e=0;e<6;++e)t.write_shift(4,0)}return t.slice(0,t.l)}function ua(i,t,e,n){return n||(n=ne(6)),n.write_shift(2,i),n.write_shift(2,t),n.write_shift(2,e||0),n}function Zy(i,t,e){var n=e.biff>8?4:2,r=i.read_shift(n),a=i.read_shift(n,"i"),o=i.read_shift(n,"i");return[r,a,o]}function eC(i){var t=i.read_shift(2),e=i.read_shift(2),n=i.read_shift(2),r=i.read_shift(2);return{s:{c:n,r:t},e:{c:r,r:e}}}function Yh(i,t){return t||(t=ne(8)),t.write_shift(2,i.s.r),t.write_shift(2,i.e.r),t.write_shift(2,i.s.c),t.write_shift(2,i.e.c),t}function id(i,t,e){var n=1536,r=16;switch(e.bookType){case"biff8":break;case"biff5":n=1280,r=8;break;case"biff4":n=4,r=6;break;case"biff3":n=3,r=6;break;case"biff2":n=2,r=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var a=ne(r);return a.write_shift(2,n),a.write_shift(2,t),r>4&&a.write_shift(2,29282),r>6&&a.write_shift(2,1997),r>8&&(a.write_shift(2,49161),a.write_shift(2,1),a.write_shift(2,1798),a.write_shift(2,0)),a}function tC(i,t){var e=!t||t.biff==8,n=ne(e?112:54);for(n.write_shift(t.biff==8?2:1,7),e&&n.write_shift(1,0),n.write_shift(4,859007059),n.write_shift(4,5458548|(e?0:536870912));n.l<n.length;)n.write_shift(1,e?0:32);return n}function iC(i,t){var e=!t||t.biff>=8?2:1,n=ne(8+e*i.name.length);n.write_shift(4,i.pos),n.write_shift(1,i.hs||0),n.write_shift(1,i.dt),n.write_shift(1,i.name.length),t.biff>=8&&n.write_shift(1,1),n.write_shift(e*i.name.length,i.name,t.biff<8?"sbcs":"utf16le");var r=n.slice(0,n.l);return r.l=n.l,r}function nC(i,t){var e=ne(8);e.write_shift(4,i.Count),e.write_shift(4,i.Unique);for(var n=[],r=0;r<i.length;++r)n[r]=Xy(i[r],t);var a=Fi([e].concat(n));return a.parts=[e.length].concat(n.map(function(o){return o.length})),a}function rC(){var i=ne(18);return i.write_shift(2,0),i.write_shift(2,0),i.write_shift(2,29280),i.write_shift(2,17600),i.write_shift(2,56),i.write_shift(2,0),i.write_shift(2,0),i.write_shift(2,1),i.write_shift(2,500),i}function aC(i){var t=ne(18),e=1718;return i&&i.RTL&&(e|=64),t.write_shift(2,e),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function oC(i,t){var e=i.name||"Arial",n=t&&t.biff==5,r=n?15+e.length:16+2*e.length,a=ne(r);return a.write_shift(2,(i.sz||12)*20),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,e.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*e.length,e,n?"sbcs":"utf16le"),a}function sC(i,t,e,n){var r=ne(10);return ua(i,t,n,r),r.write_shift(4,e),r}function lC(i,t,e,n,r){var a=!r||r.biff==8,o=ne(8+ +a+(1+a)*e.length);return ua(i,t,n,o),o.write_shift(2,e.length),a&&o.write_shift(1,1),o.write_shift((1+a)*e.length,e,a?"utf16le":"sbcs"),o}function cC(i,t,e,n){var r=e&&e.biff==5;n||(n=ne(r?3+t.length:5+2*t.length)),n.write_shift(2,i),n.write_shift(r?1:2,t.length),r||n.write_shift(1,1),n.write_shift((r?1:2)*t.length,t,r?"sbcs":"utf16le");var a=n.length>n.l?n.slice(0,n.l):n;return a.l==null&&(a.l=a.length),a}function dC(i,t){var e=t.biff==8||!t.biff?4:2,n=ne(2*e+6);return n.write_shift(e,i.s.r),n.write_shift(e,i.e.r+1),n.write_shift(2,i.s.c),n.write_shift(2,i.e.c+1),n.write_shift(2,0),n}function Xp(i,t,e,n){var r=e&&e.biff==5;n||(n=ne(r?16:20)),n.write_shift(2,0),i.style?(n.write_shift(2,i.numFmtId||0),n.write_shift(2,65524)):(n.write_shift(2,i.numFmtId||0),n.write_shift(2,t<<4));var a=0;return i.numFmtId>0&&r&&(a|=1024),n.write_shift(4,a),n.write_shift(4,0),r||n.write_shift(4,0),n.write_shift(2,0),n}function uC(i){var t=ne(8);return t.write_shift(4,0),t.write_shift(2,i[0]?i[0]+1:0),t.write_shift(2,i[1]?i[1]+1:0),t}function mC(i,t,e,n,r,a){var o=ne(8);return ua(i,t,n,o),qh(e,a,o),o}function fC(i,t,e,n){var r=ne(14);return ua(i,t,n,r),da(e,r),r}function pC(i,t,e){if(e.biff<8)return hC(i,t,e);for(var n=[],r=i.l+t,a=i.read_shift(e.biff>8?4:2);a--!==0;)n.push(Zy(i,e.biff>8?12:6,e));if(i.l!=r)throw new Error("Bad ExternSheet: "+i.l+" != "+r);return n}function hC(i,t,e){i[i.l+1]==3&&i[i.l]++;var n=Xh(i,t,e);return n.charCodeAt(0)==3?n.slice(1):n}function gC(i){var t=ne(2+i.length*8);t.write_shift(2,i.length);for(var e=0;e<i.length;++e)Yh(i[e],t);return t}function _C(i){var t=ne(24),e=wi(i[0]);t.write_shift(2,e.r),t.write_shift(2,e.r),t.write_shift(2,e.c),t.write_shift(2,e.c);for(var n="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<16;++r)t.write_shift(1,parseInt(n[r],16));return Fi([t,Jy(i[1])])}function vC(i){var t=i[1].Tooltip,e=ne(10+2*(t.length+1));e.write_shift(2,2048);var n=wi(i[0]);e.write_shift(2,n.r),e.write_shift(2,n.r),e.write_shift(2,n.c),e.write_shift(2,n.c);for(var r=0;r<t.length;++r)e.write_shift(2,t.charCodeAt(r));return e.write_shift(2,0),e}function xC(i){return i||(i=ne(4)),i.write_shift(2,1),i.write_shift(2,1),i}function bC(i,t,e){if(!e.cellStyles)return sr(i,t);var n=e&&e.biff>=12?4:2,r=i.read_shift(n),a=i.read_shift(n),o=i.read_shift(n),u=i.read_shift(n),m=i.read_shift(2);n==2&&(i.l+=2);var f={s:r,e:a,w:o,ixfe:u,flags:m};return(e.biff>=5||!e.biff)&&(f.level=m>>8&7),f}function yC(i,t){var e=ne(12);e.write_shift(2,t),e.write_shift(2,t),e.write_shift(2,i.width*256),e.write_shift(2,0);var n=0;return i.hidden&&(n|=1),e.write_shift(1,n),n=i.level||0,e.write_shift(1,n),e.write_shift(2,0),e}function CC(i){for(var t=ne(2*i),e=0;e<i;++e)t.write_shift(2,e+1);return t}function SC(i,t,e){var n=ne(15);return os(n,i,t),n.write_shift(8,e,"f"),n}function wC(i,t,e){var n=ne(9);return os(n,i,t),n.write_shift(2,e),n}var EC=function(){var i={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=j0({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function e(u,m){var f=[],h=ca(1);switch(m.type){case"base64":h=Vn(vr(u));break;case"binary":h=Vn(u);break;case"buffer":case"array":h=u;break}hn(h,0);var g=h.read_shift(1),x=!!(g&136),b=!1,S=!1;switch(g){case 2:break;case 3:break;case 48:b=!0,x=!0;break;case 49:b=!0,x=!0;break;case 131:break;case 139:break;case 140:S=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+g.toString(16))}var v=0,E=521;g==2&&(v=h.read_shift(2)),h.l+=3,g!=2&&(v=h.read_shift(4)),v>1048576&&(v=1e6),g!=2&&(E=h.read_shift(2));var j=h.read_shift(2),U=m.codepage||1252;g!=2&&(h.l+=16,h.read_shift(1),h[h.l]!==0&&(U=i[h[h.l]]),h.l+=1,h.l+=2),S&&(h.l+=36);for(var H=[],Y={},z=Math.min(h.length,g==2?521:E-10-(b?264:0)),_e=S?32:11;h.l<z&&h[h.l]!=13;)switch(Y={},Y.name=Rt.utils.decode(U,h.slice(h.l,h.l+_e)).replace(/[\u0000\r\n].*$/g,""),h.l+=_e,Y.type=String.fromCharCode(h.read_shift(1)),g!=2&&!S&&(Y.offset=h.read_shift(4)),Y.len=h.read_shift(1),g==2&&(Y.offset=h.read_shift(2)),Y.dec=h.read_shift(1),Y.name.length&&H.push(Y),g!=2&&(h.l+=S?13:14),Y.type){case"B":(!b||Y.len!=8)&&m.WTF&&console.log("Skipping "+Y.name+":"+Y.type);break;case"G":case"P":m.WTF&&console.log("Skipping "+Y.name+":"+Y.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+Y.type)}if(h[h.l]!==13&&(h.l=E-1),h.read_shift(1)!==13)throw new Error("DBF Terminator not found "+h.l+" "+h[h.l]);h.l=E;var W=0,le=0;for(f[0]=[],le=0;le!=H.length;++le)f[0][le]=H[le].name;for(;v-- >0;){if(h[h.l]===42){h.l+=j;continue}for(++h.l,f[++W]=[],le=0,le=0;le!=H.length;++le){var te=h.slice(h.l,h.l+H[le].len);h.l+=H[le].len,hn(te,0);var ce=Rt.utils.decode(U,te);switch(H[le].type){case"C":ce.trim().length&&(f[W][le]=ce.replace(/\s+$/,""));break;case"D":ce.length===8?f[W][le]=new Date(+ce.slice(0,4),+ce.slice(4,6)-1,+ce.slice(6,8)):f[W][le]=ce;break;case"F":f[W][le]=parseFloat(ce.trim());break;case"+":case"I":f[W][le]=S?te.read_shift(-4,"i")^2147483648:te.read_shift(4,"i");break;case"L":switch(ce.trim().toUpperCase()){case"Y":case"T":f[W][le]=!0;break;case"N":case"F":f[W][le]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+ce+"|")}break;case"M":if(!x)throw new Error("DBF Unexpected MEMO for type "+g.toString(16));f[W][le]="##MEMO##"+(S?parseInt(ce.trim(),10):te.read_shift(4));break;case"N":ce=ce.replace(/\u0000/g,"").trim(),ce&&ce!="."&&(f[W][le]=+ce||0);break;case"@":f[W][le]=new Date(te.read_shift(-8,"f")-621356832e5);break;case"T":f[W][le]=new Date((te.read_shift(4)-2440588)*864e5+te.read_shift(4));break;case"Y":f[W][le]=te.read_shift(4,"i")/1e4+te.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":f[W][le]=-te.read_shift(-8,"f");break;case"B":if(b&&H[le].len==8){f[W][le]=te.read_shift(8,"f");break}case"G":case"P":te.l+=H[le].len;break;case"0":if(H[le].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+H[le].type)}}}if(g!=2&&h.l<h.length&&h[h.l++]!=26)throw new Error("DBF EOF Marker missing "+(h.l-1)+" of "+h.length+" "+h[h.l-1].toString(16));return m&&m.sheetRows&&(f=f.slice(0,m.sheetRows)),m.DBF=H,f}function n(u,m){var f=m||{};f.dateNF||(f.dateNF="yyyymmdd");var h=so(e(u,f),f);return h["!cols"]=f.DBF.map(function(g){return{wch:g.len,DBF:g}}),delete f.DBF,h}function r(u,m){try{return ma(n(u,m),m)}catch(f){if(m&&m.WTF)throw f}return{SheetNames:[],Sheets:{}}}var a={B:8,C:250,L:1,D:8,"?":0,"":0};function o(u,m){var f=m||{};if(+f.codepage>=0&&Yo(+f.codepage),f.type=="string")throw new Error("Cannot write DBF to JS string");var h=Zi(),g=Hl(u,{header:1,raw:!0,cellDates:!0}),x=g[0],b=g.slice(1),S=u["!cols"]||[],v=0,E=0,j=0,U=1;for(v=0;v<x.length;++v){if(((S[v]||{}).DBF||{}).name){x[v]=S[v].DBF.name,++j;continue}if(x[v]!=null){if(++j,typeof x[v]=="number"&&(x[v]=x[v].toString(10)),typeof x[v]!="string")throw new Error("DBF Invalid column name "+x[v]+" |"+typeof x[v]+"|");if(x.indexOf(x[v])!==v){for(E=0;E<1024;++E)if(x.indexOf(x[v]+"_"+E)==-1){x[v]+="_"+E;break}}}}var H=$t(u["!ref"]),Y=[],z=[],_e=[];for(v=0;v<=H.e.c-H.s.c;++v){var W="",le="",te=0,ce=[];for(E=0;E<b.length;++E)b[E][v]!=null&&ce.push(b[E][v]);if(ce.length==0||x[v]==null){Y[v]="?";continue}for(E=0;E<ce.length;++E){switch(typeof ce[E]){case"number":le="B";break;case"string":le="C";break;case"boolean":le="L";break;case"object":le=ce[E]instanceof Date?"D":"C";break;default:le="C"}te=Math.max(te,String(ce[E]).length),W=W&&W!=le?"C":le}te>250&&(te=250),le=((S[v]||{}).DBF||{}).type,le=="C"&&S[v].DBF.len>te&&(te=S[v].DBF.len),W=="B"&&le=="N"&&(W="N",_e[v]=S[v].DBF.dec,te=S[v].DBF.len),z[v]=W=="C"||le=="N"?te:a[W]||0,U+=z[v],Y[v]=W}var ue=h.next(32);for(ue.write_shift(4,318902576),ue.write_shift(4,b.length),ue.write_shift(2,296+32*j),ue.write_shift(2,U),v=0;v<4;++v)ue.write_shift(4,0);for(ue.write_shift(4,0|(+t[no]||3)<<8),v=0,E=0;v<x.length;++v)if(x[v]!=null){var me=h.next(32),Me=(x[v].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);me.write_shift(1,Me,"sbcs"),me.write_shift(1,Y[v]=="?"?"C":Y[v],"sbcs"),me.write_shift(4,E),me.write_shift(1,z[v]||a[Y[v]]||0),me.write_shift(1,_e[v]||0),me.write_shift(1,2),me.write_shift(4,0),me.write_shift(1,0),me.write_shift(4,0),me.write_shift(4,0),E+=z[v]||a[Y[v]]||0}var ut=h.next(264);for(ut.write_shift(4,13),v=0;v<65;++v)ut.write_shift(4,0);for(v=0;v<b.length;++v){var Re=h.next(U);for(Re.write_shift(1,0),E=0;E<x.length;++E)if(x[E]!=null)switch(Y[E]){case"L":Re.write_shift(1,b[v][E]==null?63:b[v][E]?84:70);break;case"B":Re.write_shift(8,b[v][E]||0,"f");break;case"N":var ye="0";for(typeof b[v][E]=="number"&&(ye=b[v][E].toFixed(_e[E]||0)),j=0;j<z[E]-ye.length;++j)Re.write_shift(1,32);Re.write_shift(1,ye,"sbcs");break;case"D":b[v][E]?(Re.write_shift(4,("0000"+b[v][E].getFullYear()).slice(-4),"sbcs"),Re.write_shift(2,("00"+(b[v][E].getMonth()+1)).slice(-2),"sbcs"),Re.write_shift(2,("00"+b[v][E].getDate()).slice(-2),"sbcs")):Re.write_shift(8,"00000000","sbcs");break;case"C":var Ee=String(b[v][E]!=null?b[v][E]:"").slice(0,z[E]);for(Re.write_shift(1,Ee,"sbcs"),j=0;j<z[E]-Ee.length;++j)Re.write_shift(1,32);break}}return h.next(1).write_shift(1,26),h.end()}return{to_workbook:r,to_sheet:n,from_sheet:o}}(),TC=function(){var i={AA:"\xC0",BA:"\xC1",CA:"\xC2",DA:195,HA:"\xC4",JA:197,AE:"\xC8",BE:"\xC9",CE:"\xCA",HE:"\xCB",AI:"\xCC",BI:"\xCD",CI:"\xCE",HI:"\xCF",AO:"\xD2",BO:"\xD3",CO:"\xD4",DO:213,HO:"\xD6",AU:"\xD9",BU:"\xDA",CU:"\xDB",HU:"\xDC",Aa:"\xE0",Ba:"\xE1",Ca:"\xE2",Da:227,Ha:"\xE4",Ja:229,Ae:"\xE8",Be:"\xE9",Ce:"\xEA",He:"\xEB",Ai:"\xEC",Bi:"\xED",Ci:"\xEE",Hi:"\xEF",Ao:"\xF2",Bo:"\xF3",Co:"\xF4",Do:245,Ho:"\xF6",Au:"\xF9",Bu:"\xFA",Cu:"\xFB",Hu:"\xFC",KC:"\xC7",Kc:"\xE7",q:"\xE6",z:"\u0153",a:"\xC6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+Di(i).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),e=function(x,b){var S=i[b];return typeof S=="number"?vp(S):S},n=function(x,b,S){var v=b.charCodeAt(0)-32<<4|S.charCodeAt(0)-48;return v==59?x:vp(v)};i["|"]=254;function r(x,b){switch(b.type){case"base64":return a(vr(x),b);case"binary":return a(x,b);case"buffer":return a(Ct&&Buffer.isBuffer(x)?x.toString("binary"):is(x),b);case"array":return a(Xl(x),b)}throw new Error("Unrecognized type "+b.type)}function a(x,b){var S=x.split(/[\n\r]+/),v=-1,E=-1,j=0,U=0,H=[],Y=[],z=null,_e={},W=[],le=[],te=[],ce=0,ue;for(+b.codepage>=0&&Yo(+b.codepage);j!==S.length;++j){ce=0;var me=S[j].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(t,e),Me=me.replace(/;;/g,"\0").split(";").map(function(V){return V.replace(/\u0000/g,";")}),ut=Me[0],Re;if(me.length>0)switch(ut){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Me[1].charAt(0)=="P"&&Y.push(me.slice(3).replace(/;;/g,";"));break;case"C":var ye=!1,Ee=!1,ke=!1,Ue=!1,it=-1,Ut=-1;for(U=1;U<Me.length;++U)switch(Me[U].charAt(0)){case"A":break;case"X":E=parseInt(Me[U].slice(1))-1,Ee=!0;break;case"Y":for(v=parseInt(Me[U].slice(1))-1,Ee||(E=0),ue=H.length;ue<=v;++ue)H[ue]=[];break;case"K":Re=Me[U].slice(1),Re.charAt(0)==='"'?Re=Re.slice(1,Re.length-1):Re==="TRUE"?Re=!0:Re==="FALSE"?Re=!1:isNaN(gr(Re))?isNaN(Jo(Re).getDate())||(Re=Gi(Re)):(Re=gr(Re),z!==null&&hh(z)&&(Re=xh(Re))),typeof Rt<"u"&&typeof Re=="string"&&(b||{}).type!="string"&&(b||{}).codepage&&(Re=Rt.utils.decode(b.codepage,Re)),ye=!0;break;case"E":Ue=!0;var B=wS(Me[U].slice(1),{r:v,c:E});H[v][E]=[H[v][E],B];break;case"S":ke=!0,H[v][E]=[H[v][E],"S5S"];break;case"G":break;case"R":it=parseInt(Me[U].slice(1))-1;break;case"C":Ut=parseInt(Me[U].slice(1))-1;break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}if(ye&&(H[v][E]&&H[v][E].length==2?H[v][E][0]=Re:H[v][E]=Re,z=null),ke){if(Ue)throw new Error("SYLK shared formula cannot have own formula");var re=it>-1&&H[it][Ut];if(!re||!re[1])throw new Error("SYLK shared formula cannot find base");H[v][E][1]=ES(re[1],{r:v-it,c:E-Ut})}break;case"F":var L=0;for(U=1;U<Me.length;++U)switch(Me[U].charAt(0)){case"X":E=parseInt(Me[U].slice(1))-1,++L;break;case"Y":for(v=parseInt(Me[U].slice(1))-1,ue=H.length;ue<=v;++ue)H[ue]=[];break;case"M":ce=parseInt(Me[U].slice(1))/20;break;case"F":break;case"G":break;case"P":z=Y[parseInt(Me[U].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(te=Me[U].slice(1).split(" "),ue=parseInt(te[0],10);ue<=parseInt(te[1],10);++ue)ce=parseInt(te[2],10),le[ue-1]=ce===0?{hidden:!0}:{wch:ce},nd(le[ue-1]);break;case"C":E=parseInt(Me[U].slice(1))-1,le[E]||(le[E]={});break;case"R":v=parseInt(Me[U].slice(1))-1,W[v]||(W[v]={}),ce>0?(W[v].hpt=ce,W[v].hpx=tg(ce)):ce===0&&(W[v].hidden=!0);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}L<1&&(z=null);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}}return W.length>0&&(_e["!rows"]=W),le.length>0&&(_e["!cols"]=le),b&&b.sheetRows&&(H=H.slice(0,b.sheetRows)),[H,_e]}function o(x,b){var S=r(x,b),v=S[0],E=S[1],j=so(v,b);return Di(E).forEach(function(U){j[U]=E[U]}),j}function u(x,b){return ma(o(x,b),b)}function m(x,b,S,v){var E="C;Y"+(S+1)+";X"+(v+1)+";K";switch(x.t){case"n":E+=x.v||0,x.f&&!x.F&&(E+=";E"+ad(x.f,{r:S,c:v}));break;case"b":E+=x.v?"TRUE":"FALSE";break;case"e":E+=x.w||x.v;break;case"d":E+='"'+(x.w||x.v)+'"';break;case"s":E+='"'+x.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return E}function f(x,b){b.forEach(function(S,v){var E="F;W"+(v+1)+" "+(v+1)+" ";S.hidden?E+="0":(typeof S.width=="number"&&!S.wpx&&(S.wpx=Vl(S.width)),typeof S.wpx=="number"&&!S.wch&&(S.wch=Ul(S.wpx)),typeof S.wch=="number"&&(E+=Math.round(S.wch))),E.charAt(E.length-1)!=" "&&x.push(E)})}function h(x,b){b.forEach(function(S,v){var E="F;";S.hidden?E+="M0;":S.hpt?E+="M"+20*S.hpt+";":S.hpx&&(E+="M"+20*jl(S.hpx)+";"),E.length>2&&x.push(E+"R"+(v+1))})}function g(x,b){var S=["ID;PWXL;N;E"],v=[],E=$t(x["!ref"]),j,U=Array.isArray(x),H=`\r
`;S.push("P;PGeneral"),S.push("F;P0;DG0G8;M255"),x["!cols"]&&f(S,x["!cols"]),x["!rows"]&&h(S,x["!rows"]),S.push("B;Y"+(E.e.r-E.s.r+1)+";X"+(E.e.c-E.s.c+1)+";D"+[E.s.c,E.s.r,E.e.c,E.e.r].join(" "));for(var Y=E.s.r;Y<=E.e.r;++Y)for(var z=E.s.c;z<=E.e.c;++z){var _e=Mt({r:Y,c:z});j=U?(x[Y]||[])[z]:x[_e],!(!j||j.v==null&&(!j.f||j.F))&&v.push(m(j,x,Y,z,b))}return S.join(H)+H+v.join(H)+H+"E"+H}return{to_workbook:u,to_sheet:o,from_sheet:g}}(),PC=function(){function i(a,o){switch(o.type){case"base64":return t(vr(a),o);case"binary":return t(a,o);case"buffer":return t(Ct&&Buffer.isBuffer(a)?a.toString("binary"):is(a),o);case"array":return t(Xl(a),o)}throw new Error("Unrecognized type "+o.type)}function t(a,o){for(var u=a.split(`
`),m=-1,f=-1,h=0,g=[];h!==u.length;++h){if(u[h].trim()==="BOT"){g[++m]=[],f=0;continue}if(!(m<0)){var x=u[h].trim().split(","),b=x[0],S=x[1];++h;for(var v=u[h]||"";(v.match(/["]/g)||[]).length&1&&h<u.length-1;)v+=`
`+u[++h];switch(v=v.trim(),+b){case-1:if(v==="BOT"){g[++m]=[],f=0;continue}else if(v!=="EOD")throw new Error("Unrecognized DIF special command "+v);break;case 0:v==="TRUE"?g[m][f]=!0:v==="FALSE"?g[m][f]=!1:isNaN(gr(S))?isNaN(Jo(S).getDate())?g[m][f]=S:g[m][f]=Gi(S):g[m][f]=gr(S),++f;break;case 1:v=v.slice(1,v.length-1),v=v.replace(/""/g,'"'),jo&&v&&v.match(/^=".*"$/)&&(v=v.slice(2,-1)),g[m][f++]=v!==""?v:null;break}if(v==="EOD")break}}return o&&o.sheetRows&&(g=g.slice(0,o.sheetRows)),g}function e(a,o){return so(i(a,o),o)}function n(a,o){return ma(e(a,o),o)}var r=function(){var a=function(m,f,h,g,x){m.push(f),m.push(h+","+g),m.push('"'+x.replace(/"/g,'""')+'"')},o=function(m,f,h,g){m.push(f+","+h),m.push(f==1?'"'+g.replace(/"/g,'""')+'"':g)};return function(m){var f=[],h=$t(m["!ref"]),g,x=Array.isArray(m);a(f,"TABLE",0,1,"sheetjs"),a(f,"VECTORS",0,h.e.r-h.s.r+1,""),a(f,"TUPLES",0,h.e.c-h.s.c+1,""),a(f,"DATA",0,0,"");for(var b=h.s.r;b<=h.e.r;++b){o(f,-1,0,"BOT");for(var S=h.s.c;S<=h.e.c;++S){var v=Mt({r:b,c:S});if(g=x?(m[b]||[])[S]:m[v],!g){o(f,1,0,"");continue}switch(g.t){case"n":var E=jo?g.w:g.v;!E&&g.v!=null&&(E=g.v),E==null?jo&&g.f&&!g.F?o(f,1,0,"="+g.f):o(f,1,0,""):o(f,0,E,"V");break;case"b":o(f,0,g.v?1:0,g.v?"TRUE":"FALSE");break;case"s":o(f,1,0,!jo||isNaN(g.v)?g.v:'="'+g.v+'"');break;case"d":g.w||(g.w=Nr(g.z||ni[14],en(Gi(g.v)))),jo?o(f,0,g.w,"V"):o(f,1,0,g.w);break;default:o(f,1,0,"")}}}o(f,-1,0,"EOD");var j=`\r
`,U=f.join(j);return U}}();return{to_workbook:n,to_sheet:e,from_sheet:r}}(),Qh=function(){function i(g){return g.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(g){return g.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function e(g,x){for(var b=g.split(`
`),S=-1,v=-1,E=0,j=[];E!==b.length;++E){var U=b[E].trim().split(":");if(U[0]==="cell"){var H=wi(U[1]);if(j.length<=H.r)for(S=j.length;S<=H.r;++S)j[S]||(j[S]=[]);switch(S=H.r,v=H.c,U[2]){case"t":j[S][v]=i(U[3]);break;case"v":j[S][v]=+U[3];break;case"vtf":var Y=U[U.length-1];case"vtc":switch(U[3]){case"nl":j[S][v]=!!+U[4];break;default:j[S][v]=+U[4];break}U[2]=="vtf"&&(j[S][v]=[j[S][v],Y])}}}return x&&x.sheetRows&&(j=j.slice(0,x.sheetRows)),j}function n(g,x){return so(e(g,x),x)}function r(g,x){return ma(n(g,x),x)}var a=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,u=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),m="--SocialCalcSpreadsheetControlSave--";function f(g){if(!g||!g["!ref"])return"";for(var x=[],b=[],S,v="",E=_n(g["!ref"]),j=Array.isArray(g),U=E.s.r;U<=E.e.r;++U)for(var H=E.s.c;H<=E.e.c;++H)if(v=Mt({r:U,c:H}),S=j?(g[U]||[])[H]:g[v],!(!S||S.v==null||S.t==="z")){switch(b=["cell",v,"t"],S.t){case"s":case"str":b.push(t(S.v));break;case"n":S.f?(b[2]="vtf",b[3]="n",b[4]=S.v,b[5]=t(S.f)):(b[2]="v",b[3]=S.v);break;case"b":b[2]="vt"+(S.f?"f":"c"),b[3]="nl",b[4]=S.v?"1":"0",b[5]=t(S.f||(S.v?"TRUE":"FALSE"));break;case"d":var Y=en(Gi(S.v));b[2]="vtc",b[3]="nd",b[4]=""+Y,b[5]=S.w||Nr(S.z||ni[14],Y);break;case"e":continue}x.push(b.join(":"))}return x.push("sheet:c:"+(E.e.c-E.s.c+1)+":r:"+(E.e.r-E.s.r+1)+":tvf:1"),x.push("valueformat:1:text-wiki"),x.join(`
`)}function h(g){return[a,o,u,o,f(g),m].join(`
`)}return{to_workbook:r,to_sheet:n,from_sheet:h}}(),kC=function(){function i(h,g,x,b,S){S.raw?g[x][b]=h:h===""||(h==="TRUE"?g[x][b]=!0:h==="FALSE"?g[x][b]=!1:isNaN(gr(h))?isNaN(Jo(h).getDate())?g[x][b]=h:g[x][b]=Gi(h):g[x][b]=gr(h))}function t(h,g){var x=g||{},b=[];if(!h||h.length===0)return b;for(var S=h.split(/[\r\n]/),v=S.length-1;v>=0&&S[v].length===0;)--v;for(var E=10,j=0,U=0;U<=v;++U)j=S[U].indexOf(" "),j==-1?j=S[U].length:j++,E=Math.max(E,j);for(U=0;U<=v;++U){b[U]=[];var H=0;for(i(S[U].slice(0,E).trim(),b,U,H,x),H=1;H<=(S[U].length-E)/10+1;++H)i(S[U].slice(E+(H-1)*10,E+H*10).trim(),b,U,H,x)}return x.sheetRows&&(b=b.slice(0,x.sheetRows)),b}var e={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function r(h){for(var g={},x=!1,b=0,S=0;b<h.length;++b)(S=h.charCodeAt(b))==34?x=!x:!x&&S in e&&(g[S]=(g[S]||0)+1);S=[];for(b in g)Object.prototype.hasOwnProperty.call(g,b)&&S.push([g[b],b]);if(!S.length){g=n;for(b in g)Object.prototype.hasOwnProperty.call(g,b)&&S.push([g[b],b])}return S.sort(function(v,E){return v[0]-E[0]||n[v[1]]-n[E[1]]}),e[S.pop()[1]]||44}function a(h,g){var x=g||{},b="";or!=null&&x.dense==null&&(x.dense=or);var S=x.dense?[]:{},v={s:{c:0,r:0},e:{c:0,r:0}};h.slice(0,4)=="sep="?h.charCodeAt(5)==13&&h.charCodeAt(6)==10?(b=h.charAt(4),h=h.slice(7)):h.charCodeAt(5)==13||h.charCodeAt(5)==10?(b=h.charAt(4),h=h.slice(6)):b=r(h.slice(0,1024)):x&&x.FS?b=x.FS:b=r(h.slice(0,1024));var E=0,j=0,U=0,H=0,Y=0,z=b.charCodeAt(0),_e=!1,W=0,le=h.charCodeAt(0);h=h.replace(/\r\n/mg,`
`);var te=x.dateNF!=null?Hb(x.dateNF):null;function ce(){var ue=h.slice(H,Y),me={};if(ue.charAt(0)=='"'&&ue.charAt(ue.length-1)=='"'&&(ue=ue.slice(1,-1).replace(/""/g,'"')),ue.length===0)me.t="z";else if(x.raw)me.t="s",me.v=ue;else if(ue.trim().length===0)me.t="s",me.v=ue;else if(ue.charCodeAt(0)==61)ue.charCodeAt(1)==34&&ue.charCodeAt(ue.length-1)==34?(me.t="s",me.v=ue.slice(2,-1).replace(/""/g,'"')):TS(ue)?(me.t="n",me.f=ue.slice(1)):(me.t="s",me.v=ue);else if(ue=="TRUE")me.t="b",me.v=!0;else if(ue=="FALSE")me.t="b",me.v=!1;else if(!isNaN(U=gr(ue)))me.t="n",x.cellText!==!1&&(me.w=ue),me.v=U;else if(!isNaN(Jo(ue).getDate())||te&&ue.match(te)){me.z=x.dateNF||ni[14];var Me=0;te&&ue.match(te)&&(ue=$b(ue,x.dateNF,ue.match(te)||[]),Me=1),x.cellDates?(me.t="d",me.v=Gi(ue,Me)):(me.t="n",me.v=en(Gi(ue,Me))),x.cellText!==!1&&(me.w=Nr(me.z,me.v instanceof Date?en(me.v):me.v)),x.cellNF||delete me.z}else me.t="s",me.v=ue;if(me.t=="z"||(x.dense?(S[E]||(S[E]=[]),S[E][j]=me):S[Mt({c:j,r:E})]=me),H=Y+1,le=h.charCodeAt(H),v.e.c<j&&(v.e.c=j),v.e.r<E&&(v.e.r=E),W==z)++j;else if(j=0,++E,x.sheetRows&&x.sheetRows<=E)return!0}e:for(;Y<h.length;++Y)switch(W=h.charCodeAt(Y)){case 34:le===34&&(_e=!_e);break;case z:case 10:case 13:if(!_e&&ce())break e;break;default:break}return Y-H>0&&ce(),S["!ref"]=fi(v),S}function o(h,g){return!(g&&g.PRN)||g.FS||h.slice(0,4)=="sep="||h.indexOf("	")>=0||h.indexOf(",")>=0||h.indexOf(";")>=0?a(h,g):so(t(h,g),g)}function u(h,g){var x="",b=g.type=="string"?[0,0,0,0]:UT(h,g);switch(g.type){case"base64":x=vr(h);break;case"binary":x=h;break;case"buffer":g.codepage==65001?x=h.toString("utf8"):g.codepage&&typeof Rt<"u"?x=Rt.utils.decode(g.codepage,h):x=Ct&&Buffer.isBuffer(h)?h.toString("binary"):is(h);break;case"array":x=Xl(h);break;case"string":x=h;break;default:throw new Error("Unrecognized type "+g.type)}return b[0]==239&&b[1]==187&&b[2]==191?x=$o(x.slice(3)):g.type!="string"&&g.type!="buffer"&&g.codepage==65001?x=$o(x):g.type=="binary"&&typeof Rt<"u"&&g.codepage&&(x=Rt.utils.decode(g.codepage,Rt.utils.encode(28591,x))),x.slice(0,19)=="socialcalc:version:"?Qh.to_sheet(g.type=="string"?x:$o(x),g):o(x,g)}function m(h,g){return ma(u(h,g),g)}function f(h){for(var g=[],x=$t(h["!ref"]),b,S=Array.isArray(h),v=x.s.r;v<=x.e.r;++v){for(var E=[],j=x.s.c;j<=x.e.c;++j){var U=Mt({r:v,c:j});if(b=S?(h[v]||[])[j]:h[U],!b||b.v==null){E.push("          ");continue}for(var H=(b.w||(xr(b),b.w)||"").slice(0,10);H.length<10;)H+=" ";E.push(H+(j===0?" ":""))}g.push(E.join(""))}return g.join(`
`)}return{to_workbook:m,to_sheet:u,from_sheet:f}}();var Kp=function(){function i(B,re,L){if(B){hn(B,B.l||0);for(var V=L.Enum||it;B.l<B.length;){var fe=B.read_shift(2),Ce=V[fe]||V[65535],De=B.read_shift(2),we=B.l+De,he=Ce.f&&Ce.f(B,De,L);if(B.l=we,re(he,Ce,fe))return}}}function t(B,re){switch(re.type){case"base64":return e(Vn(vr(B)),re);case"binary":return e(Vn(B),re);case"buffer":case"array":return e(B,re)}throw"Unsupported type "+re.type}function e(B,re){if(!B)return B;var L=re||{};or!=null&&L.dense==null&&(L.dense=or);var V=L.dense?[]:{},fe="Sheet1",Ce="",De=0,we={},he=[],pt=[],st={s:{r:0,c:0},e:{r:0,c:0}},Ti=L.sheetRows||0;if(B[2]==0&&(B[3]==8||B[3]==9)&&B.length>=16&&B[14]==5&&B[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(B[2]==2)L.Enum=it,i(B,function(Fe,xn,dr){switch(dr){case 0:L.vers=Fe,Fe>=4096&&(L.qpro=!0);break;case 6:st=Fe;break;case 204:Fe&&(Ce=Fe);break;case 222:Ce=Fe;break;case 15:case 51:L.qpro||(Fe[1].v=Fe[1].v.slice(1));case 13:case 14:case 16:dr==14&&(Fe[2]&112)==112&&(Fe[2]&15)>1&&(Fe[2]&15)<15&&(Fe[1].z=L.dateNF||ni[14],L.cellDates&&(Fe[1].t="d",Fe[1].v=xh(Fe[1].v))),L.qpro&&Fe[3]>De&&(V["!ref"]=fi(st),we[fe]=V,he.push(fe),V=L.dense?[]:{},st={s:{r:0,c:0},e:{r:0,c:0}},De=Fe[3],fe=Ce||"Sheet"+(De+1),Ce="");var zr=L.dense?(V[Fe[0].r]||[])[Fe[0].c]:V[Mt(Fe[0])];if(zr){zr.t=Fe[1].t,zr.v=Fe[1].v,Fe[1].z!=null&&(zr.z=Fe[1].z),Fe[1].f!=null&&(zr.f=Fe[1].f);break}L.dense?(V[Fe[0].r]||(V[Fe[0].r]=[]),V[Fe[0].r][Fe[0].c]=Fe[1]):V[Mt(Fe[0])]=Fe[1];break;default:}},L);else if(B[2]==26||B[2]==14)L.Enum=Ut,B[2]==14&&(L.qpro=!0,B.l=0),i(B,function(Fe,xn,dr){switch(dr){case 204:fe=Fe;break;case 22:Fe[1].v=Fe[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Fe[3]>De&&(V["!ref"]=fi(st),we[fe]=V,he.push(fe),V=L.dense?[]:{},st={s:{r:0,c:0},e:{r:0,c:0}},De=Fe[3],fe="Sheet"+(De+1)),Ti>0&&Fe[0].r>=Ti)break;L.dense?(V[Fe[0].r]||(V[Fe[0].r]=[]),V[Fe[0].r][Fe[0].c]=Fe[1]):V[Mt(Fe[0])]=Fe[1],st.e.c<Fe[0].c&&(st.e.c=Fe[0].c),st.e.r<Fe[0].r&&(st.e.r=Fe[0].r);break;case 27:Fe[14e3]&&(pt[Fe[14e3][0]]=Fe[14e3][1]);break;case 1537:pt[Fe[0]]=Fe[1],Fe[0]==De&&(fe=Fe[1]);break;default:break}},L);else throw new Error("Unrecognized LOTUS BOF "+B[2]);if(V["!ref"]=fi(st),we[Ce||fe]=V,he.push(Ce||fe),!pt.length)return{SheetNames:he,Sheets:we};for(var ht={},Dn=[],Qt=0;Qt<pt.length;++Qt)we[he[Qt]]?(Dn.push(pt[Qt]||he[Qt]),ht[pt[Qt]]=we[pt[Qt]]||we[he[Qt]]):(Dn.push(pt[Qt]),ht[pt[Qt]]={"!ref":"A1"});return{SheetNames:Dn,Sheets:ht}}function n(B,re){var L=re||{};if(+L.codepage>=0&&Yo(+L.codepage),L.type=="string")throw new Error("Cannot write WK1 to JS string");var V=Zi(),fe=$t(B["!ref"]),Ce=Array.isArray(B),De=[];ve(V,0,a(1030)),ve(V,6,m(fe));for(var we=Math.min(fe.e.r,8191),he=fe.s.r;he<=we;++he)for(var pt=Oi(he),st=fe.s.c;st<=fe.e.c;++st){he===fe.s.r&&(De[st]=Li(st));var Ti=De[st]+pt,ht=Ce?(B[he]||[])[st]:B[Ti];if(!(!ht||ht.t=="z"))if(ht.t=="n")(ht.v|0)==ht.v&&ht.v>=-32768&&ht.v<=32767?ve(V,13,b(he,st,ht.v)):ve(V,14,v(he,st,ht.v));else{var Dn=xr(ht);ve(V,15,g(he,st,Dn.slice(0,239)))}}return ve(V,1),V.end()}function r(B,re){var L=re||{};if(+L.codepage>=0&&Yo(+L.codepage),L.type=="string")throw new Error("Cannot write WK3 to JS string");var V=Zi();ve(V,0,o(B));for(var fe=0,Ce=0;fe<B.SheetNames.length;++fe)(B.Sheets[B.SheetNames[fe]]||{})["!ref"]&&ve(V,27,Ue(B.SheetNames[fe],Ce++));var De=0;for(fe=0;fe<B.SheetNames.length;++fe){var we=B.Sheets[B.SheetNames[fe]];if(!(!we||!we["!ref"])){for(var he=$t(we["!ref"]),pt=Array.isArray(we),st=[],Ti=Math.min(he.e.r,8191),ht=he.s.r;ht<=Ti;++ht)for(var Dn=Oi(ht),Qt=he.s.c;Qt<=he.e.c;++Qt){ht===he.s.r&&(st[Qt]=Li(Qt));var Fe=st[Qt]+Dn,xn=pt?(we[ht]||[])[Qt]:we[Fe];if(!(!xn||xn.t=="z"))if(xn.t=="n")ve(V,23,ce(ht,Qt,De,xn.v));else{var dr=xr(xn);ve(V,22,W(ht,Qt,De,dr.slice(0,239)))}}++De}}return ve(V,1),V.end()}function a(B){var re=ne(2);return re.write_shift(2,B),re}function o(B){var re=ne(26);re.write_shift(2,4096),re.write_shift(2,4),re.write_shift(4,0);for(var L=0,V=0,fe=0,Ce=0;Ce<B.SheetNames.length;++Ce){var De=B.SheetNames[Ce],we=B.Sheets[De];if(!(!we||!we["!ref"])){++fe;var he=_n(we["!ref"]);L<he.e.r&&(L=he.e.r),V<he.e.c&&(V=he.e.c)}}return L>8191&&(L=8191),re.write_shift(2,L),re.write_shift(1,fe),re.write_shift(1,V),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(1,1),re.write_shift(1,2),re.write_shift(4,0),re.write_shift(4,0),re}function u(B,re,L){var V={s:{c:0,r:0},e:{c:0,r:0}};return re==8&&L.qpro?(V.s.c=B.read_shift(1),B.l++,V.s.r=B.read_shift(2),V.e.c=B.read_shift(1),B.l++,V.e.r=B.read_shift(2),V):(V.s.c=B.read_shift(2),V.s.r=B.read_shift(2),re==12&&L.qpro&&(B.l+=2),V.e.c=B.read_shift(2),V.e.r=B.read_shift(2),re==12&&L.qpro&&(B.l+=2),V.s.c==65535&&(V.s.c=V.e.c=V.s.r=V.e.r=0),V)}function m(B){var re=ne(8);return re.write_shift(2,B.s.c),re.write_shift(2,B.s.r),re.write_shift(2,B.e.c),re.write_shift(2,B.e.r),re}function f(B,re,L){var V=[{c:0,r:0},{t:"n",v:0},0,0];return L.qpro&&L.vers!=20768?(V[0].c=B.read_shift(1),V[3]=B.read_shift(1),V[0].r=B.read_shift(2),B.l+=2):(V[2]=B.read_shift(1),V[0].c=B.read_shift(2),V[0].r=B.read_shift(2)),V}function h(B,re,L){var V=B.l+re,fe=f(B,re,L);if(fe[1].t="s",L.vers==20768){B.l++;var Ce=B.read_shift(1);return fe[1].v=B.read_shift(Ce,"utf8"),fe}return L.qpro&&B.l++,fe[1].v=B.read_shift(V-B.l,"cstr"),fe}function g(B,re,L){var V=ne(7+L.length);V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(1,39);for(var fe=0;fe<V.length;++fe){var Ce=L.charCodeAt(fe);V.write_shift(1,Ce>=128?95:Ce)}return V.write_shift(1,0),V}function x(B,re,L){var V=f(B,re,L);return V[1].v=B.read_shift(2,"i"),V}function b(B,re,L){var V=ne(7);return V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(2,L,"i"),V}function S(B,re,L){var V=f(B,re,L);return V[1].v=B.read_shift(8,"f"),V}function v(B,re,L){var V=ne(13);return V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(8,L,"f"),V}function E(B,re,L){var V=B.l+re,fe=f(B,re,L);if(fe[1].v=B.read_shift(8,"f"),L.qpro)B.l=V;else{var Ce=B.read_shift(2);Y(B.slice(B.l,B.l+Ce),fe),B.l+=Ce}return fe}function j(B,re,L){var V=re&32768;return re&=-32769,re=(V?B:0)+(re>=8192?re-16384:re),(V?"":"$")+(L?Li(re):Oi(re))}var U={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},H=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function Y(B,re){hn(B,0);for(var L=[],V=0,fe="",Ce="",De="",we="";B.l<B.length;){var he=B[B.l++];switch(he){case 0:L.push(B.read_shift(8,"f"));break;case 1:Ce=j(re[0].c,B.read_shift(2),!0),fe=j(re[0].r,B.read_shift(2),!1),L.push(Ce+fe);break;case 2:{var pt=j(re[0].c,B.read_shift(2),!0),st=j(re[0].r,B.read_shift(2),!1);Ce=j(re[0].c,B.read_shift(2),!0),fe=j(re[0].r,B.read_shift(2),!1),L.push(pt+st+":"+Ce+fe)}break;case 3:if(B.l<B.length){console.error("WK1 premature formula end");return}break;case 4:L.push("("+L.pop()+")");break;case 5:L.push(B.read_shift(2));break;case 6:{for(var Ti="";he=B[B.l++];)Ti+=String.fromCharCode(he);L.push('"'+Ti.replace(/"/g,'""')+'"')}break;case 8:L.push("-"+L.pop());break;case 23:L.push("+"+L.pop());break;case 22:L.push("NOT("+L.pop()+")");break;case 20:case 21:we=L.pop(),De=L.pop(),L.push(["AND","OR"][he-20]+"("+De+","+we+")");break;default:if(he<32&&H[he])we=L.pop(),De=L.pop(),L.push(De+H[he]+we);else if(U[he]){if(V=U[he][1],V==69&&(V=B[B.l++]),V>L.length){console.error("WK1 bad formula parse 0x"+he.toString(16)+":|"+L.join("|")+"|");return}var ht=L.slice(-V);L.length-=V,L.push(U[he][0]+"("+ht.join(",")+")")}else return he<=7?console.error("WK1 invalid opcode "+he.toString(16)):he<=24?console.error("WK1 unsupported op "+he.toString(16)):he<=30?console.error("WK1 invalid opcode "+he.toString(16)):he<=115?console.error("WK1 unsupported function opcode "+he.toString(16)):console.error("WK1 unrecognized opcode "+he.toString(16))}}L.length==1?re[1].f=""+L[0]:console.error("WK1 bad formula parse |"+L.join("|")+"|")}function z(B){var re=[{c:0,r:0},{t:"n",v:0},0];return re[0].r=B.read_shift(2),re[3]=B[B.l++],re[0].c=B[B.l++],re}function _e(B,re){var L=z(B,re);return L[1].t="s",L[1].v=B.read_shift(re-4,"cstr"),L}function W(B,re,L,V){var fe=ne(6+V.length);fe.write_shift(2,B),fe.write_shift(1,L),fe.write_shift(1,re),fe.write_shift(1,39);for(var Ce=0;Ce<V.length;++Ce){var De=V.charCodeAt(Ce);fe.write_shift(1,De>=128?95:De)}return fe.write_shift(1,0),fe}function le(B,re){var L=z(B,re);L[1].v=B.read_shift(2);var V=L[1].v>>1;if(L[1].v&1)switch(V&7){case 0:V=(V>>3)*5e3;break;case 1:V=(V>>3)*500;break;case 2:V=(V>>3)/20;break;case 3:V=(V>>3)/200;break;case 4:V=(V>>3)/2e3;break;case 5:V=(V>>3)/2e4;break;case 6:V=(V>>3)/16;break;case 7:V=(V>>3)/64;break}return L[1].v=V,L}function te(B,re){var L=z(B,re),V=B.read_shift(4),fe=B.read_shift(4),Ce=B.read_shift(2);if(Ce==65535)return V===0&&fe===3221225472?(L[1].t="e",L[1].v=15):V===0&&fe===3489660928?(L[1].t="e",L[1].v=42):L[1].v=0,L;var De=Ce&32768;return Ce=(Ce&32767)-16446,L[1].v=(1-De*2)*(fe*Math.pow(2,Ce+32)+V*Math.pow(2,Ce)),L}function ce(B,re,L,V){var fe=ne(14);if(fe.write_shift(2,B),fe.write_shift(1,L),fe.write_shift(1,re),V==0)return fe.write_shift(4,0),fe.write_shift(4,0),fe.write_shift(2,65535),fe;var Ce=0,De=0,we=0,he=0;return V<0&&(Ce=1,V=-V),De=Math.log2(V)|0,V/=Math.pow(2,De-31),he=V>>>0,(he&2147483648)==0&&(V/=2,++De,he=V>>>0),V-=he,he|=2147483648,he>>>=0,V*=Math.pow(2,32),we=V>>>0,fe.write_shift(4,we),fe.write_shift(4,he),De+=16383+(Ce?32768:0),fe.write_shift(2,De),fe}function ue(B,re){var L=te(B,14);return B.l+=re-14,L}function me(B,re){var L=z(B,re),V=B.read_shift(4);return L[1].v=V>>6,L}function Me(B,re){var L=z(B,re),V=B.read_shift(8,"f");return L[1].v=V,L}function ut(B,re){var L=Me(B,14);return B.l+=re-10,L}function Re(B,re){return B[B.l+re-1]==0?B.read_shift(re,"cstr"):""}function ye(B,re){var L=B[B.l++];L>re-1&&(L=re-1);for(var V="";V.length<L;)V+=String.fromCharCode(B[B.l++]);return V}function Ee(B,re,L){if(!(!L.qpro||re<21)){var V=B.read_shift(1);B.l+=17,B.l+=1,B.l+=2;var fe=B.read_shift(re-21,"cstr");return[V,fe]}}function ke(B,re){for(var L={},V=B.l+re;B.l<V;){var fe=B.read_shift(2);if(fe==14e3){for(L[fe]=[0,""],L[fe][0]=B.read_shift(2);B[B.l];)L[fe][1]+=String.fromCharCode(B[B.l]),B.l++;B.l++}}return L}function Ue(B,re){var L=ne(5+B.length);L.write_shift(2,14e3),L.write_shift(2,re);for(var V=0;V<B.length;++V){var fe=B.charCodeAt(V);L[L.l++]=fe>127?95:fe}return L[L.l++]=0,L}var it={0:{n:"BOF",f:Gh},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:u},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:x},14:{n:"NUMBER",f:S},15:{n:"LABEL",f:h},16:{n:"FORMULA",f:E},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:h},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Re},222:{n:"SHEETNAMELP",f:ye},65535:{n:""}},Ut={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:_e},23:{n:"NUMBER17",f:te},24:{n:"NUMBER18",f:le},25:{n:"FORMULA19",f:ue},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:ke},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:me},38:{n:"??"},39:{n:"NUMBER27",f:Me},40:{n:"FORMULA28",f:ut},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Re},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Ee},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:r,to_workbook:t}}();var IC=/^\s|\s$|[\t\n\r]/;function Jh(i,t){if(!t.bookSST)return"";var e=[pi];e[e.length]=ge("sst",null,{xmlns:ao[0],count:i.Count,uniqueCount:i.Unique});for(var n=0;n!=i.length;++n)if(i[n]!=null){var r=i[n],a="<si>";r.r?a+=r.r:(a+="<t",r.t||(r.t=""),r.t.match(IC)&&(a+=' xml:space="preserve"'),a+=">"+It(r.t)+"</t>"),a+="</si>",e[e.length]=a}return e.length>2&&(e[e.length]="</sst>",e[1]=e[1].replace("/>",">")),e.join("")}function MC(i){return[i.read_shift(4),i.read_shift(4)]}function FC(i,t){return t||(t=ne(8)),t.write_shift(4,i.Count),t.write_shift(4,i.Unique),t}var AC=Cy;function OC(i){var t=Zi();de(t,159,FC(i));for(var e=0;e<i.length;++e)de(t,19,AC(i[e]));return de(t,160),t.end()}function DC(i){if(typeof Rt<"u")return Rt.utils.encode(no,i);for(var t=[],e=i.split(""),n=0;n<e.length;++n)t[n]=e[n].charCodeAt(0);return t}function Zh(i){var t=0,e,n=DC(i),r=n.length+1,a,o,u,m,f;for(e=ca(r),e[0]=n.length,a=1;a!=r;++a)e[a]=n[a-1];for(a=r-1;a>=0;--a)o=e[a],u=(t&16384)===0?0:1,m=t<<1&32767,f=u|m,t=f^o;return t^52811}var RC=function(){function i(r,a){switch(a.type){case"base64":return t(vr(r),a);case"binary":return t(r,a);case"buffer":return t(Ct&&Buffer.isBuffer(r)?r.toString("binary"):is(r),a);case"array":return t(Xl(r),a)}throw new Error("Unrecognized type "+a.type)}function t(r,a){var o=a||{},u=o.dense?[]:{},m=r.match(/\\trowd.*?\\row\b/g);if(!m.length)throw new Error("RTF missing table");var f={s:{c:0,r:0},e:{c:0,r:m.length-1}};return m.forEach(function(h,g){Array.isArray(u)&&(u[g]=[]);for(var x=/\\\w+\b/g,b=0,S,v=-1;S=x.exec(h);){switch(S[0]){case"\\cell":var E=h.slice(b,x.lastIndex-S[0].length);if(E[0]==" "&&(E=E.slice(1)),++v,E.length){var j={v:E,t:"s"};Array.isArray(u)?u[g][v]=j:u[Mt({r:g,c:v})]=j}break}b=x.lastIndex}v>f.e.c&&(f.e.c=v)}),u["!ref"]=fi(f),u}function e(r,a){return ma(i(r,a),a)}function n(r){for(var a=["{\\rtf1\\ansi"],o=$t(r["!ref"]),u,m=Array.isArray(r),f=o.s.r;f<=o.e.r;++f){a.push("\\trowd\\trautofit1");for(var h=o.s.c;h<=o.e.c;++h)a.push("\\cellx"+(h+1));for(a.push("\\pard\\intbl"),h=o.s.c;h<=o.e.c;++h){var g=Mt({r:f,c:h});u=m?(r[f]||[])[h]:r[g],!(!u||u.v==null&&(!u.f||u.F))&&(a.push(" "+(u.w||(xr(u),u.w))),a.push("\\cell"))}a.push("\\pard\\intbl\\row")}return a.join("")+"}"}return{to_workbook:e,to_sheet:i,from_sheet:n}}();function Yp(i){for(var t=0,e=1;t!=3;++t)e=e*256+(i[t]>255?255:i[t]<0?0:i[t]);return e.toString(16).toUpperCase().slice(1)}var NC=6;var _r=NC;function Vl(i){return Math.floor((i+Math.round(128/_r)/256)*_r)}function Ul(i){return Math.floor((i-5)/_r*100+.5)/100}function L0(i){return Math.round((i*_r+5)/_r*256)/256}function nd(i){i.width?(i.wpx=Vl(i.width),i.wch=Ul(i.wpx),i.MDW=_r):i.wpx?(i.wch=Ul(i.wpx),i.width=L0(i.wch),i.MDW=_r):typeof i.wch=="number"&&(i.width=L0(i.wch),i.wpx=Vl(i.width),i.MDW=_r),i.customWidth&&delete i.customWidth}var BC=96,eg=BC;function jl(i){return i*96/eg}function tg(i){return i*eg/96}function LC(i){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(e){for(var n=e[0];n<=e[1];++n)i[n]!=null&&(t[t.length]=ge("numFmt",null,{numFmtId:n,formatCode:It(i[n])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=ge("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function VC(i){var t=[];return t[t.length]=ge("cellXfs",null),i.forEach(function(e){t[t.length]=ge("xf",null,e)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=ge("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function ig(i,t){var e=[pi,ge("styleSheet",null,{xmlns:ao[0],"xmlns:vt":Si.vt})],n;return i.SSF&&(n=LC(i.SSF))!=null&&(e[e.length]=n),e[e.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',e[e.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',e[e.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',e[e.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=VC(t.cellXfs))&&(e[e.length]=n),e[e.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',e[e.length]='<dxfs count="0"/>',e[e.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',e.length>2&&(e[e.length]="</styleSheet>",e[1]=e[1].replace("/>",">")),e.join("")}function UC(i,t){var e=i.read_shift(2),n=Vi(i,t-2);return[e,n]}function jC(i,t,e){e||(e=ne(6+4*t.length)),e.write_shift(2,i),Ei(t,e);var n=e.length>e.l?e.slice(0,e.l):e;return e.l==null&&(e.l=e.length),n}function WC(i,t,e){var n={};n.sz=i.read_shift(2)/20;var r=Iy(i,2,e);r.fItalic&&(n.italic=1),r.fCondense&&(n.condense=1),r.fExtend&&(n.extend=1),r.fShadow&&(n.shadow=1),r.fOutline&&(n.outline=1),r.fStrikeout&&(n.strike=1);var a=i.read_shift(2);switch(a===700&&(n.bold=1),i.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var o=i.read_shift(1);o!=0&&(n.underline=o);var u=i.read_shift(1);u>0&&(n.family=u);var m=i.read_shift(1);switch(m>0&&(n.charset=m),i.l++,n.color=ky(i,8),i.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=Vi(i,t-21),n}function HC(i,t){t||(t=ne(25+4*32)),t.write_shift(2,i.sz*20),My(i,t),t.write_shift(2,i.bold?700:400);var e=0;i.vertAlign=="superscript"?e=1:i.vertAlign=="subscript"&&(e=2),t.write_shift(2,e),t.write_shift(1,i.underline||0),t.write_shift(1,i.family||0),t.write_shift(1,i.charset||0),t.write_shift(1,0),Bl(i.color,t);var n=0;return i.scheme=="major"&&(n=1),i.scheme=="minor"&&(n=2),t.write_shift(1,n),Ei(i.name,t),t.length>t.l?t.slice(0,t.l):t}var $C=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],F0,zC=sr;function Qp(i,t){t||(t=ne(4*3+8*7+16*1)),F0||(F0=j0($C));var e=F0[i.patternType];e==null&&(e=40),t.write_shift(4,e);var n=0;if(e!=40)for(Bl({auto:1},t),Bl({auto:1},t);n<12;++n)t.write_shift(4,0);else{for(;n<4;++n)t.write_shift(4,0);for(;n<12;++n)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function GC(i,t){var e=i.l+t,n=i.read_shift(2),r=i.read_shift(2);return i.l=e,{ixfe:n,numFmtId:r}}function ng(i,t,e){e||(e=ne(16)),e.write_shift(2,t||0),e.write_shift(2,i.numFmtId||0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);var n=0;return e.write_shift(1,n),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(1,0),e}function Wo(i,t){return t||(t=ne(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var qC=sr;function XC(i,t){return t||(t=ne(51)),t.write_shift(1,0),Wo(null,t),Wo(null,t),Wo(null,t),Wo(null,t),Wo(null,t),t.length>t.l?t.slice(0,t.l):t}function KC(i,t){return t||(t=ne(12+4*10)),t.write_shift(4,i.xfId),t.write_shift(2,1),t.write_shift(1,+i.builtinId),t.write_shift(1,0),Nl(i.name||"",t),t.length>t.l?t.slice(0,t.l):t}function YC(i,t,e){var n=ne(2052);return n.write_shift(4,i),Nl(t,n),Nl(e,n),n.length>n.l?n.slice(0,n.l):n}function QC(i,t){if(t){var e=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&++e}),e!=0&&(de(i,615,jn(e)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&de(i,44,jC(r,t[r]))}),de(i,616))}}function JC(i){var t=1;t!=0&&(de(i,611,jn(t)),de(i,43,HC({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),de(i,612))}function ZC(i){var t=2;t!=0&&(de(i,603,jn(t)),de(i,45,Qp({patternType:"none"})),de(i,45,Qp({patternType:"gray125"})),de(i,604))}function eS(i){var t=1;t!=0&&(de(i,613,jn(t)),de(i,46,XC({})),de(i,614))}function tS(i){var t=1;de(i,626,jn(t)),de(i,47,ng({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),de(i,627)}function iS(i,t){de(i,617,jn(t.length)),t.forEach(function(e){de(i,47,ng(e,0))}),de(i,618)}function nS(i){var t=1;de(i,619,jn(t)),de(i,48,KC({xfId:0,builtinId:0,name:"Normal"})),de(i,620)}function rS(i){var t=0;de(i,505,jn(t)),de(i,506)}function aS(i){var t=0;de(i,508,YC(t,"TableStyleMedium9","PivotStyleMedium4")),de(i,509)}function oS(i,t){var e=Zi();return de(e,278),QC(e,i.SSF),JC(e,i),ZC(e,i),eS(e,i),tS(e,i),iS(e,t.cellXfs),nS(e,i),rS(e,i),aS(e,i),de(e,279),e.end()}function rg(i,t){if(t&&t.themeXLSX)return t.themeXLSX;if(i&&typeof i.raw=="string")return i.raw;var e=[pi];return e[e.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',e[e.length]="<a:themeElements>",e[e.length]='<a:clrScheme name="Office">',e[e.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',e[e.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',e[e.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',e[e.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',e[e.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',e[e.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',e[e.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',e[e.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',e[e.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',e[e.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',e[e.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',e[e.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',e[e.length]="</a:clrScheme>",e[e.length]='<a:fontScheme name="Office">',e[e.length]="<a:majorFont>",e[e.length]='<a:latin typeface="Cambria"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',e[e.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',e[e.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',e[e.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',e[e.length]='<a:font script="Arab" typeface="Times New Roman"/>',e[e.length]='<a:font script="Hebr" typeface="Times New Roman"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="MoolBoran"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Times New Roman"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:majorFont>",e[e.length]="<a:minorFont>",e[e.length]='<a:latin typeface="Calibri"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',e[e.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',e[e.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',e[e.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',e[e.length]='<a:font script="Arab" typeface="Arial"/>',e[e.length]='<a:font script="Hebr" typeface="Arial"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="DaunPenh"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Arial"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:minorFont>",e[e.length]="</a:fontScheme>",e[e.length]='<a:fmtScheme name="Office">',e[e.length]="<a:fillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="1"/>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="0"/>',e[e.length]="</a:gradFill>",e[e.length]="</a:fillStyleLst>",e[e.length]="<a:lnStyleLst>",e[e.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]="</a:lnStyleLst>",e[e.length]="<a:effectStyleLst>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',e[e.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',e[e.length]="</a:effectStyle>",e[e.length]="</a:effectStyleLst>",e[e.length]="<a:bgFillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]="</a:bgFillStyleLst>",e[e.length]="</a:fmtScheme>",e[e.length]="</a:themeElements>",e[e.length]="<a:objectDefaults>",e[e.length]="<a:spDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',e[e.length]="</a:spDef>",e[e.length]="<a:lnDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',e[e.length]="</a:lnDef>",e[e.length]="</a:objectDefaults>",e[e.length]="<a:extraClrSchemeLst/>",e[e.length]="</a:theme>",e.join("")}function sS(i,t){return{flags:i.read_shift(4),version:i.read_shift(4),name:Vi(i,t-8)}}function lS(i){var t=ne(12+2*i.name.length);return t.write_shift(4,i.flags),t.write_shift(4,i.version),Ei(i.name,t),t.slice(0,t.l)}function cS(i){for(var t=[],e=i.read_shift(4);e-- >0;)t.push([i.read_shift(4),i.read_shift(4)]);return t}function dS(i){var t=ne(4+8*i.length);t.write_shift(4,i.length);for(var e=0;e<i.length;++e)t.write_shift(4,i[e][0]),t.write_shift(4,i[e][1]);return t}function uS(i,t){var e=ne(8+2*t.length);return e.write_shift(4,i),Ei(t,e),e.slice(0,e.l)}function mS(i){return i.l+=4,i.read_shift(4)!=0}function fS(i,t){var e=ne(8);return e.write_shift(4,i),e.write_shift(4,t?1:0),e}function pS(){var i=Zi();return de(i,332),de(i,334,jn(1)),de(i,335,lS({name:"XLDAPR",version:12e4,flags:3496657072})),de(i,336),de(i,339,uS(1,"XLDAPR")),de(i,52),de(i,35,jn(514)),de(i,4096,jn(0)),de(i,4097,Pn(1)),de(i,36),de(i,53),de(i,340),de(i,337,fS(1,!0)),de(i,51,dS([[1,0]])),de(i,338),de(i,333),i.end()}function ag(){var i=[pi];return i.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),i.join("")}function hS(i){var t={};t.i=i.read_shift(4);var e={};e.r=i.read_shift(4),e.c=i.read_shift(4),t.r=Mt(e);var n=i.read_shift(1);return n&2&&(t.l="1"),n&8&&(t.a="1"),t}var Qa=1024;function og(i,t){for(var e=[21600,21600],n=["m0,0l0",e[1],e[0],e[1],e[0],"0xe"].join(","),r=[ge("xml",null,{"xmlns:v":gn.v,"xmlns:o":gn.o,"xmlns:x":gn.x,"xmlns:mv":gn.mv}).replace(/\/>/,">"),ge("o:shapelayout",ge("o:idmap",null,{"v:ext":"edit",data:i}),{"v:ext":"edit"}),ge("v:shapetype",[ge("v:stroke",null,{joinstyle:"miter"}),ge("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:e.join(","),path:n})];Qa<i*1e3;)Qa+=1e3;return t.forEach(function(a){var o=wi(a[0]),u={color2:"#BEFF82",type:"gradient"};u.type=="gradient"&&(u.angle="-180");var m=u.type=="gradient"?ge("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,f=ge("v:fill",m,u),h={on:"t",obscured:"t"};++Qa,r=r.concat(["<v:shape"+Zo({id:"_x0000_s"+Qa,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(a[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",f,ge("v:shadow",null,h),ge("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Ai("x:Anchor",[o.c+1,0,o.r+1,0,o.c+3,20,o.r+5,20].join(",")),Ai("x:AutoFill","False"),Ai("x:Row",String(o.r)),Ai("x:Column",String(o.c)),a[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),r.push("</xml>"),r.join("")}function sg(i){var t=[pi,ge("comments",null,{xmlns:ao[0]})],e=[];return t.push("<authors>"),i.forEach(function(n){n[1].forEach(function(r){var a=It(r.a);e.indexOf(a)==-1&&(e.push(a),t.push("<author>"+a+"</author>")),r.T&&r.ID&&e.indexOf("tc="+r.ID)==-1&&(e.push("tc="+r.ID),t.push("<author>tc="+r.ID+"</author>"))})}),e.length==0&&(e.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),i.forEach(function(n){var r=0,a=[];if(n[1][0]&&n[1][0].T&&n[1][0].ID?r=e.indexOf("tc="+n[1][0].ID):n[1].forEach(function(m){m.a&&(r=e.indexOf(It(m.a))),a.push(m.t||"")}),t.push('<comment ref="'+n[0]+'" authorId="'+r+'"><text>'),a.length<=1)t.push(Ai("t",It(a[0]||"")));else{for(var o=`Comment:
    `+a[0]+`
`,u=1;u<a.length;++u)o+=`Reply:
    `+a[u]+`
`;t.push(Ai("t",It(o)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function gS(i,t,e){var n=[pi,ge("ThreadedComments",null,{xmlns:Si.TCMNT}).replace(/[\/]>/,">")];return i.forEach(function(r){var a="";(r[1]||[]).forEach(function(o,u){if(!o.T){delete o.ID;return}o.a&&t.indexOf(o.a)==-1&&t.push(o.a);var m={ref:r[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+e.tcid++).slice(-12)+"}"};u==0?a=m.id:m.parentId=a,o.ID=m.id,o.a&&(m.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(o.a)).slice(-12)+"}"),n.push(ge("threadedComment",Ai("text",o.t||""),m))})}),n.push("</ThreadedComments>"),n.join("")}function _S(i){var t=[pi,ge("personList",null,{xmlns:Si.TCMNT,"xmlns:x":ao[0]}).replace(/[\/]>/,">")];return i.forEach(function(e,n){t.push(ge("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:e,providerId:"None"}))}),t.push("</personList>"),t.join("")}function vS(i){var t={};t.iauthor=i.read_shift(4);var e=ga(i,16);return t.rfx=e.s,t.ref=Mt(e.s),i.l+=16,t}function xS(i,t){return t==null&&(t=ne(36)),t.write_shift(4,i[1].iauthor),lo(i[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var bS=Vi;function yS(i){return Ei(i.slice(0,54))}function CS(i){var t=Zi(),e=[];return de(t,628),de(t,630),i.forEach(function(n){n[1].forEach(function(r){e.indexOf(r.a)>-1||(e.push(r.a.slice(0,54)),de(t,632,yS(r.a)))})}),de(t,631),de(t,633),i.forEach(function(n){n[1].forEach(function(r){r.iauthor=e.indexOf(r.a);var a={s:wi(n[0]),e:wi(n[0])};de(t,635,xS([a,r])),r.t&&r.t.length>0&&de(t,637,wy(r)),de(t,636),delete r.iauthor})}),de(t,634),de(t,629),t.end()}function SS(i,t){t.FullPaths.forEach(function(e,n){if(n!=0){var r=e.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");r.slice(-1)!=="/"&&Ot.utils.cfb_add(i,r,t.FileIndex[n].content)}})}var lg=["xlsb","xlsm","xlam","biff8","xla"];var wS=function(){var i=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function e(n,r,a,o){var u=!1,m=!1;a.length==0?m=!0:a.charAt(0)=="["&&(m=!0,a=a.slice(1,-1)),o.length==0?u=!0:o.charAt(0)=="["&&(u=!0,o=o.slice(1,-1));var f=a.length>0?parseInt(a,10)|0:0,h=o.length>0?parseInt(o,10)|0:0;return u?h+=t.c:--h,m?f+=t.r:--f,r+(u?"":"$")+Li(h)+(m?"":"$")+Oi(f)}return function(r,a){return t=a,r.replace(i,e)}}(),rd=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,ad=function(){return function(t,e){return t.replace(rd,function(n,r,a,o,u,m){var f=J0(o)-(a?0:e.c),h=Q0(m)-(u?0:e.r),g=h==0?"":u?h+1:"["+h+"]",x=f==0?"":a?f+1:"["+f+"]";return r+"R"+g+"C"+x})}}();function ES(i,t){return i.replace(rd,function(e,n,r,a,o,u){return n+(r=="$"?r+a:Li(J0(a)+t.c))+(o=="$"?o+u:Oi(Q0(u)+t.r))})}function TS(i){return i.length!=1}function mi(i){i.l+=1}function Br(i,t){var e=i.read_shift(t==1?1:2);return[e&16383,e>>14&1,e>>15&1]}function cg(i,t,e){var n=2;if(e){if(e.biff>=2&&e.biff<=5)return dg(i,t,e);e.biff==12&&(n=4)}var r=i.read_shift(n),a=i.read_shift(n),o=Br(i,2),u=Br(i,2);return{s:{r,c:o[0],cRel:o[1],rRel:o[2]},e:{r:a,c:u[0],cRel:u[1],rRel:u[2]}}}function dg(i){var t=Br(i,2),e=Br(i,2),n=i.read_shift(1),r=i.read_shift(1);return{s:{r:t[0],c:n,cRel:t[1],rRel:t[2]},e:{r:e[0],c:r,cRel:e[1],rRel:e[2]}}}function PS(i,t,e){if(e.biff<8)return dg(i,t,e);var n=i.read_shift(e.biff==12?4:2),r=i.read_shift(e.biff==12?4:2),a=Br(i,2),o=Br(i,2);return{s:{r:n,c:a[0],cRel:a[1],rRel:a[2]},e:{r,c:o[0],cRel:o[1],rRel:o[2]}}}function ug(i,t,e){if(e&&e.biff>=2&&e.biff<=5)return kS(i,t,e);var n=i.read_shift(e&&e.biff==12?4:2),r=Br(i,2);return{r:n,c:r[0],cRel:r[1],rRel:r[2]}}function kS(i){var t=Br(i,2),e=i.read_shift(1);return{r:t[0],c:e,cRel:t[1],rRel:t[2]}}function IS(i){var t=i.read_shift(2),e=i.read_shift(2);return{r:t,c:e&255,fQuoted:!!(e&16384),cRel:e>>15,rRel:e>>15}}function MS(i,t,e){var n=e&&e.biff?e.biff:8;if(n>=2&&n<=5)return FS(i,t,e);var r=i.read_shift(n>=12?4:2),a=i.read_shift(2),o=(a&16384)>>14,u=(a&32768)>>15;if(a&=16383,u==1)for(;r>524287;)r-=1048576;if(o==1)for(;a>8191;)a=a-16384;return{r,c:a,cRel:o,rRel:u}}function FS(i){var t=i.read_shift(2),e=i.read_shift(1),n=(t&32768)>>15,r=(t&16384)>>14;return t&=16383,n==1&&t>=8192&&(t=t-16384),r==1&&e>=128&&(e=e-256),{r:t,c:e,cRel:r,rRel:n}}function AS(i,t,e){var n=(i[i.l++]&96)>>5,r=cg(i,e.biff>=2&&e.biff<=5?6:8,e);return[n,r]}function OS(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2,"i"),a=8;if(e)switch(e.biff){case 5:i.l+=12,a=6;break;case 12:a=12;break}var o=cg(i,a,e);return[n,r,o]}function DS(i,t,e){var n=(i[i.l++]&96)>>5;return i.l+=e&&e.biff>8?12:e.biff<8?6:8,[n]}function RS(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2),a=8;if(e)switch(e.biff){case 5:i.l+=12,a=6;break;case 12:a=12;break}return i.l+=a,[n,r]}function NS(i,t,e){var n=(i[i.l++]&96)>>5,r=PS(i,t-1,e);return[n,r]}function BS(i,t,e){var n=(i[i.l++]&96)>>5;return i.l+=e.biff==2?6:e.biff==12?14:7,[n]}function Jp(i){var t=i[i.l+1]&1,e=1;return i.l+=4,[t,e]}function LS(i,t,e){i.l+=2;for(var n=i.read_shift(e&&e.biff==2?1:2),r=[],a=0;a<=n;++a)r.push(i.read_shift(e&&e.biff==2?1:2));return r}function VS(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=2,[n,i.read_shift(e&&e.biff==2?1:2)]}function US(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=2,[n,i.read_shift(e&&e.biff==2?1:2)]}function jS(i){var t=i[i.l+1]&255?1:0;return i.l+=2,[t,i.read_shift(2)]}function WS(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=e&&e.biff==2?3:4,[n]}function mg(i){var t=i.read_shift(1),e=i.read_shift(1);return[t,e]}function HS(i){return i.read_shift(2),mg(i,2)}function $S(i){return i.read_shift(2),mg(i,2)}function zS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=ug(i,0,e);return[n,r]}function GS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=MS(i,0,e);return[n,r]}function qS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=i.read_shift(2);e&&e.biff==5&&(i.l+=12);var a=ug(i,0,e);return[n,r,a]}function XS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=i.read_shift(e&&e.biff<=3?1:2);return[Xw[r],hg[r],n]}function KS(i,t,e){var n=i[i.l++],r=i.read_shift(1),a=e&&e.biff<=3?[n==88?-1:0,i.read_shift(1)]:YS(i);return[r,(a[0]===0?hg:qw)[a[1]]]}function YS(i){return[i[i.l+1]>>7,i.read_shift(2)&32767]}function QS(i,t,e){i.l+=e&&e.biff==2?3:4}function JS(i,t,e){if(i.l++,e&&e.biff==12)return[i.read_shift(4,"i"),0];var n=i.read_shift(2),r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function ZS(i){return i.l++,rs[i.read_shift(1)]}function ew(i){return i.l++,i.read_shift(2)}function tw(i){return i.l++,i.read_shift(1)!==0}function iw(i){return i.l++,co(i,8)}function nw(i,t,e){return i.l++,Xh(i,t-1,e)}function rw(i,t){var e=[i.read_shift(1)];if(t==12)switch(e[0]){case 2:e[0]=4;break;case 4:e[0]=16;break;case 0:e[0]=1;break;case 1:e[0]=2;break}switch(e[0]){case 4:e[1]=qy(i,1)?"TRUE":"FALSE",t!=12&&(i.l+=7);break;case 37:case 16:e[1]=rs[i[i.l]],i.l+=t==12?4:8;break;case 0:i.l+=8;break;case 1:e[1]=co(i,8);break;case 2:e[1]=Qy(i,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+e[0])}return e}function aw(i,t,e){for(var n=i.read_shift(e.biff==12?4:2),r=[],a=0;a!=n;++a)r.push((e.biff==12?ga:eC)(i,8));return r}function ow(i,t,e){var n=0,r=0;e.biff==12?(n=i.read_shift(4),r=i.read_shift(4)):(r=1+i.read_shift(1),n=1+i.read_shift(2)),e.biff>=2&&e.biff<8&&(--n,--r==0&&(r=256));for(var a=0,o=[];a!=n&&(o[a]=[]);++a)for(var u=0;u!=r;++u)o[a][u]=rw(i,e.biff);return o}function sw(i,t,e){var n=i.read_shift(1)>>>5&3,r=!e||e.biff>=8?4:2,a=i.read_shift(r);switch(e.biff){case 2:i.l+=5;break;case 3:case 4:i.l+=8;break;case 5:i.l+=12;break}return[n,0,a]}function lw(i,t,e){if(e.biff==5)return cw(i,t,e);var n=i.read_shift(1)>>>5&3,r=i.read_shift(2),a=i.read_shift(4);return[n,r,a]}function cw(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2,"i");i.l+=8;var n=i.read_shift(2);return i.l+=12,[t,e,n]}function dw(i,t,e){var n=i.read_shift(1)>>>5&3;i.l+=e&&e.biff==2?3:4;var r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function uw(i,t,e){var n=i.read_shift(1)>>>5&3,r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function mw(i,t,e){var n=i.read_shift(1)>>>5&3;return i.l+=4,e.biff<8&&i.l--,e.biff==12&&(i.l+=2),[n]}function fw(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2),a=4;if(e)switch(e.biff){case 5:a=15;break;case 12:a=6;break}return i.l+=a,[n,r]}var pw=sr,hw=sr,gw=sr;function as(i,t,e){return i.l+=2,[IS(i,4,e)]}function od(i){return i.l+=6,[]}var _w=as,vw=od,xw=od,bw=as;function fg(i){return i.l+=2,[Gh(i),i.read_shift(2)&1]}var yw=as,Cw=fg,Sw=od,ww=as,Ew=as,Tw=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function Pw(i){i.l+=2;var t=i.read_shift(2),e=i.read_shift(2),n=i.read_shift(4),r=i.read_shift(2),a=i.read_shift(2),o=Tw[e>>2&31];return{ixti:t,coltype:e&3,rt:o,idx:n,c:r,C:a}}function kw(i){return i.l+=2,[i.read_shift(4)]}function Iw(i,t,e){return i.l+=5,i.l+=2,i.l+=e.biff==2?1:4,["PTGSHEET"]}function Mw(i,t,e){return i.l+=e.biff==2?4:5,["PTGENDSHEET"]}function Fw(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2);return[t,e]}function Aw(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2);return[t,e]}function Ow(i){return i.l+=4,[0,0]}var Zp={1:{n:"PtgExp",f:JS},2:{n:"PtgTbl",f:gw},3:{n:"PtgAdd",f:mi},4:{n:"PtgSub",f:mi},5:{n:"PtgMul",f:mi},6:{n:"PtgDiv",f:mi},7:{n:"PtgPower",f:mi},8:{n:"PtgConcat",f:mi},9:{n:"PtgLt",f:mi},10:{n:"PtgLe",f:mi},11:{n:"PtgEq",f:mi},12:{n:"PtgGe",f:mi},13:{n:"PtgGt",f:mi},14:{n:"PtgNe",f:mi},15:{n:"PtgIsect",f:mi},16:{n:"PtgUnion",f:mi},17:{n:"PtgRange",f:mi},18:{n:"PtgUplus",f:mi},19:{n:"PtgUminus",f:mi},20:{n:"PtgPercent",f:mi},21:{n:"PtgParen",f:mi},22:{n:"PtgMissArg",f:mi},23:{n:"PtgStr",f:nw},26:{n:"PtgSheet",f:Iw},27:{n:"PtgEndSheet",f:Mw},28:{n:"PtgErr",f:ZS},29:{n:"PtgBool",f:tw},30:{n:"PtgInt",f:ew},31:{n:"PtgNum",f:iw},32:{n:"PtgArray",f:BS},33:{n:"PtgFunc",f:XS},34:{n:"PtgFuncVar",f:KS},35:{n:"PtgName",f:sw},36:{n:"PtgRef",f:zS},37:{n:"PtgArea",f:AS},38:{n:"PtgMemArea",f:dw},39:{n:"PtgMemErr",f:pw},40:{n:"PtgMemNoMem",f:hw},41:{n:"PtgMemFunc",f:uw},42:{n:"PtgRefErr",f:mw},43:{n:"PtgAreaErr",f:DS},44:{n:"PtgRefN",f:GS},45:{n:"PtgAreaN",f:NS},46:{n:"PtgMemAreaN",f:Fw},47:{n:"PtgMemNoMemN",f:Aw},57:{n:"PtgNameX",f:lw},58:{n:"PtgRef3d",f:qS},59:{n:"PtgArea3d",f:OS},60:{n:"PtgRefErr3d",f:fw},61:{n:"PtgAreaErr3d",f:RS},255:{}},Dw={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Rw={1:{n:"PtgElfLel",f:fg},2:{n:"PtgElfRw",f:ww},3:{n:"PtgElfCol",f:_w},6:{n:"PtgElfRwV",f:Ew},7:{n:"PtgElfColV",f:bw},10:{n:"PtgElfRadical",f:yw},11:{n:"PtgElfRadicalS",f:Sw},13:{n:"PtgElfColS",f:vw},15:{n:"PtgElfColSV",f:xw},16:{n:"PtgElfRadicalLel",f:Cw},25:{n:"PtgList",f:Pw},29:{n:"PtgSxName",f:kw},255:{}},Nw={0:{n:"PtgAttrNoop",f:Ow},1:{n:"PtgAttrSemi",f:WS},2:{n:"PtgAttrIf",f:US},4:{n:"PtgAttrChoose",f:LS},8:{n:"PtgAttrGoto",f:VS},16:{n:"PtgAttrSum",f:QS},32:{n:"PtgAttrBaxcel",f:Jp},33:{n:"PtgAttrBaxcel",f:Jp},64:{n:"PtgAttrSpace",f:HS},65:{n:"PtgAttrSpaceSemi",f:$S},128:{n:"PtgAttrIfError",f:jS},255:{}};function Bw(i,t,e,n){if(n.biff<8)return sr(i,t);for(var r=i.l+t,a=[],o=0;o!==e.length;++o)switch(e[o][0]){case"PtgArray":e[o][1]=ow(i,0,n),a.push(e[o][1]);break;case"PtgMemArea":e[o][2]=aw(i,e[o][1],n),a.push(e[o][2]);break;case"PtgExp":n&&n.biff==12&&(e[o][1][1]=i.read_shift(4),a.push(e[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+e[o][0];default:break}return t=r-i.l,t!==0&&a.push(sr(i,t)),a}function Lw(i,t,e){for(var n=i.l+t,r,a,o=[];n!=i.l;)t=n-i.l,a=i[i.l],r=Zp[a]||Zp[Dw[a]],(a===24||a===25)&&(r=(a===24?Rw:Nw)[i[i.l+1]]),!r||!r.f?sr(i,t):o.push([r.n,r.f(i,t,e)]);return o}function Vw(i){for(var t=[],e=0;e<i.length;++e){for(var n=i[e],r=[],a=0;a<n.length;++a){var o=n[a];if(o)switch(o[0]){case 2:r.push('"'+o[1].replace(/"/g,'""')+'"');break;default:r.push(o[1])}else r.push("")}t.push(r.join(","))}return t.join(";")}var Uw={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function jw(i,t){if(!i&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(i)?"'"+i+"'":i}function pg(i,t,e){if(!i)return"SH33TJSERR0";if(e.biff>8&&(!i.XTI||!i.XTI[t]))return i.SheetNames[t];if(!i.XTI)return"SH33TJSERR6";var n=i.XTI[t];if(e.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":i.XTI[t-1];if(!n)return"SH33TJSERR1";var r="";if(e.biff>8)switch(i[n[0]][0]){case 357:return r=n[1]==-1?"#REF":i.SheetNames[n[1]],n[1]==n[2]?r:r+":"+i.SheetNames[n[2]];case 358:return e.SID!=null?i.SheetNames[e.SID]:"SH33TJSSAME"+i[n[0]][0];case 355:default:return"SH33TJSSRC"+i[n[0]][0]}switch(i[n[0]][0][0]){case 1025:return r=n[1]==-1?"#REF":i.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?r:r+":"+i.SheetNames[n[2]];case 14849:return i[n[0]].slice(1).map(function(a){return a.Name}).join(";;");default:return i[n[0]][0][3]?(r=n[1]==-1?"#REF":i[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?r:r+":"+i[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function eh(i,t,e){var n=pg(i,t,e);return n=="#REF"?n:jw(n,e)}function ro(i,t,e,n,r){var a=r&&r.biff||8,o={s:{c:0,r:0},e:{c:0,r:0}},u=[],m,f,h,g=0,x=0,b,S="";if(!i[0]||!i[0][0])return"";for(var v=-1,E="",j=0,U=i[0].length;j<U;++j){var H=i[0][j];switch(H[0]){case"PtgUminus":u.push("-"+u.pop());break;case"PtgUplus":u.push("+"+u.pop());break;case"PtgPercent":u.push(u.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(m=u.pop(),f=u.pop(),v>=0){switch(i[0][v][1][0]){case 0:E=ii(" ",i[0][v][1][1]);break;case 1:E=ii("\r",i[0][v][1][1]);break;default:if(E="",r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+i[0][v][1][0])}f=f+E,v=-1}u.push(f+Uw[H[0]]+m);break;case"PtgIsect":m=u.pop(),f=u.pop(),u.push(f+" "+m);break;case"PtgUnion":m=u.pop(),f=u.pop(),u.push(f+","+m);break;case"PtgRange":m=u.pop(),f=u.pop(),u.push(f+":"+m);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":h=Go(H[1][1],o,r),u.push(qo(h,a));break;case"PtgRefN":h=e?Go(H[1][1],e,r):H[1][1],u.push(qo(h,a));break;case"PtgRef3d":g=H[1][1],h=Go(H[1][2],o,r),S=eh(n,g,r);var Y=S;u.push(S+"!"+qo(h,a));break;case"PtgFunc":case"PtgFuncVar":var z=H[1][0],_e=H[1][1];z||(z=0),z&=127;var W=z==0?[]:u.slice(-z);u.length-=z,_e==="User"&&(_e=W.shift()),u.push(_e+"("+W.join(",")+")");break;case"PtgBool":u.push(H[1]?"TRUE":"FALSE");break;case"PtgInt":u.push(H[1]);break;case"PtgNum":u.push(String(H[1]));break;case"PtgStr":u.push('"'+H[1].replace(/"/g,'""')+'"');break;case"PtgErr":u.push(H[1]);break;case"PtgAreaN":b=Lp(H[1][1],e?{s:e}:o,r),u.push(I0(b,r));break;case"PtgArea":b=Lp(H[1][1],o,r),u.push(I0(b,r));break;case"PtgArea3d":g=H[1][1],b=H[1][2],S=eh(n,g,r),u.push(S+"!"+I0(b,r));break;case"PtgAttrSum":u.push("SUM("+u.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":x=H[1][2];var le=(n.names||[])[x-1]||(n[0]||[])[x],te=le?le.Name:"SH33TJSNAME"+String(x);te&&te.slice(0,6)=="_xlfn."&&!r.xlfn&&(te=te.slice(6)),u.push(te);break;case"PtgNameX":var ce=H[1][1];x=H[1][2];var ue;if(r.biff<=5)ce<0&&(ce=-ce),n[ce]&&(ue=n[ce][x]);else{var me="";if(((n[ce]||[])[0]||[])[0]==14849||(((n[ce]||[])[0]||[])[0]==1025?n[ce][x]&&n[ce][x].itab>0&&(me=n.SheetNames[n[ce][x].itab-1]+"!"):me=n.SheetNames[x-1]+"!"),n[ce]&&n[ce][x])me+=n[ce][x].Name;else if(n[0]&&n[0][x])me+=n[0][x].Name;else{var Me=(pg(n,ce,r)||"").split(";;");Me[x-1]?me=Me[x-1]:me+="SH33TJSERRX"}u.push(me);break}ue||(ue={Name:"SH33TJSERRY"}),u.push(ue.Name);break;case"PtgParen":var ut="(",Re=")";if(v>=0){switch(E="",i[0][v][1][0]){case 2:ut=ii(" ",i[0][v][1][1])+ut;break;case 3:ut=ii("\r",i[0][v][1][1])+ut;break;case 4:Re=ii(" ",i[0][v][1][1])+Re;break;case 5:Re=ii("\r",i[0][v][1][1])+Re;break;default:if(r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+i[0][v][1][0])}v=-1}u.push(ut+u.pop()+Re);break;case"PtgRefErr":u.push("#REF!");break;case"PtgRefErr3d":u.push("#REF!");break;case"PtgExp":h={c:H[1][1],r:H[1][0]};var ye={c:e.c,r:e.r};if(n.sharedf[Mt(h)]){var Ee=n.sharedf[Mt(h)];u.push(ro(Ee,o,ye,n,r))}else{var ke=!1;for(m=0;m!=n.arrayf.length;++m)if(f=n.arrayf[m],!(h.c<f[0].s.c||h.c>f[0].e.c)&&!(h.r<f[0].s.r||h.r>f[0].e.r)){u.push(ro(f[1],o,ye,n,r)),ke=!0;break}ke||u.push(H[1])}break;case"PtgArray":u.push("{"+Vw(H[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":v=j;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":u.push("");break;case"PtgAreaErr":u.push("#REF!");break;case"PtgAreaErr3d":u.push("#REF!");break;case"PtgList":u.push("Table"+H[1].idx+"[#"+H[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(H));default:throw new Error("Unrecognized Formula Token: "+String(H))}var Ue=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(r.biff!=3&&v>=0&&Ue.indexOf(i[0][j][0])==-1){H=i[0][v];var it=!0;switch(H[1][0]){case 4:it=!1;case 0:E=ii(" ",H[1][1]);break;case 5:it=!1;case 1:E=ii("\r",H[1][1]);break;default:if(E="",r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+H[1][0])}u.push((it?E:"")+u.pop()+(it?"":E)),v=-1}}if(u.length>1&&r.WTF)throw new Error("bad formula stack");return u[0]}function Ww(i){if(i==null){var t=ne(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof i=="number")return da(i);return da(0)}function Hw(i,t,e,n,r){var a=ua(t,e,r),o=Ww(i.v),u=ne(6),m=33;u.write_shift(2,m),u.write_shift(4,0);for(var f=ne(i.bf.length),h=0;h<i.bf.length;++h)f[h]=i.bf[h];var g=Fi([a,o,u,f]);return g}function Yl(i,t,e){var n=i.read_shift(4),r=Lw(i,n,e),a=i.read_shift(4),o=a>0?Bw(i,a,r,e):null;return[r,o]}var $w=Yl,Ql=Yl,zw=Yl,Gw=Yl,qw={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},hg={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Xw={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Kw(i){var t="of:="+i.replace(rd,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function Yw(i){return i.replace(/\./,"!")}var Xo=typeof Map<"u";function sd(i,t,e){var n=0,r=i.length;if(e){if(Xo?e.has(t):Object.prototype.hasOwnProperty.call(e,t)){for(var a=Xo?e.get(t):e[t];n<a.length;++n)if(i[a[n]].t===t)return i.Count++,a[n]}}else for(;n<r;++n)if(i[n].t===t)return i.Count++,n;return i[r]={t},i.Count++,i.Unique++,e&&(Xo?(e.has(t)||e.set(t,[]),e.get(t).push(r)):(Object.prototype.hasOwnProperty.call(e,t)||(e[t]=[]),e[t].push(r))),r}function Jl(i,t){var e={min:i+1,max:i+1},n=-1;return t.MDW&&(_r=t.MDW),t.width!=null?e.customWidth=1:t.wpx!=null?n=Ul(t.wpx):t.wch!=null&&(n=t.wch),n>-1?(e.width=L0(n),e.customWidth=1):t.width!=null&&(e.width=t.width),t.hidden&&(e.hidden=!0),t.level!=null&&(e.outlineLevel=e.level=t.level),e}function gg(i,t){if(i){var e=[.7,.7,.75,.75,.3,.3];t=="xlml"&&(e=[1,1,1,1,.5,.5]),i.left==null&&(i.left=e[0]),i.right==null&&(i.right=e[1]),i.top==null&&(i.top=e[2]),i.bottom==null&&(i.bottom=e[3]),i.header==null&&(i.header=e[4]),i.footer==null&&(i.footer=e[5])}}function Vr(i,t,e){var n=e.revssf[t.z!=null?t.z:"General"],r=60,a=i.length;if(n==null&&e.ssf){for(;r<392;++r)if(e.ssf[r]==null){gh(t.z,r),e.ssf[r]=t.z,e.revssf[t.z]=n=r;break}}for(r=0;r!=a;++r)if(i[r].numFmtId===n)return r;return i[a]={numFmtId:n,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},a}function Qw(i,t,e){if(i&&i["!ref"]){var n=$t(i["!ref"]);if(n.e.c<n.s.c||n.e.r<n.s.r)throw new Error("Bad range ("+e+"): "+i["!ref"])}}function Jw(i){if(i.length===0)return"";for(var t='<mergeCells count="'+i.length+'">',e=0;e!=i.length;++e)t+='<mergeCell ref="'+fi(i[e])+'"/>';return t+"</mergeCells>"}function Zw(i,t,e,n,r){var a=!1,o={},u=null;if(n.bookType!=="xlsx"&&t.vbaraw){var m=t.SheetNames[e];try{t.Workbook&&(m=t.Workbook.Sheets[e].CodeName||m)}catch{}a=!0,o.codeName=pr(It(m))}if(i&&i["!outline"]){var f={summaryBelow:1,summaryRight:1};i["!outline"].above&&(f.summaryBelow=0),i["!outline"].left&&(f.summaryRight=0),u=(u||"")+ge("outlinePr",null,f)}!a&&!u||(r[r.length]=ge("sheetPr",u,o))}var eE=["objects","scenarios","selectLockedCells","selectUnlockedCells"],tE=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function iE(i){var t={sheet:1};return eE.forEach(function(e){i[e]!=null&&i[e]&&(t[e]="1")}),tE.forEach(function(e){i[e]!=null&&!i[e]&&(t[e]="0")}),i.password&&(t.password=Zh(i.password).toString(16).toUpperCase()),ge("sheetProtection",null,t)}function nE(i){return gg(i),ge("pageMargins",null,i)}function rE(i,t){for(var e=["<cols>"],n,r=0;r!=t.length;++r)(n=t[r])&&(e[e.length]=ge("col",null,Jl(r,n)));return e[e.length]="</cols>",e.join("")}function aE(i,t,e,n){var r=typeof i.ref=="string"?i.ref:fi(i.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var a=e.Workbook.Names,o=_n(r);o.s.r==o.e.r&&(o.e.r=_n(t["!ref"]).e.r,r=fi(o));for(var u=0;u<a.length;++u){var m=a[u];if(m.Name=="_xlnm._FilterDatabase"&&m.Sheet==n){m.Ref="'"+e.SheetNames[n]+"'!"+r;break}}return u==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+e.SheetNames[n]+"'!"+r}),ge("autoFilter",null,{ref:r})}function oE(i,t,e,n){var r={workbookViewId:"0"};return(((n||{}).Workbook||{}).Views||[])[0]&&(r.rightToLeft=n.Workbook.Views[0].RTL?"1":"0"),ge("sheetViews",ge("sheetView",null,r),{})}function sE(i,t,e,n){if(i.c&&e["!comments"].push([t,i.c]),i.v===void 0&&typeof i.f!="string"||i.t==="z"&&!i.f)return"";var r="",a=i.t,o=i.v;if(i.t!=="z")switch(i.t){case"b":r=i.v?"1":"0";break;case"n":r=""+i.v;break;case"e":r=rs[i.v];break;case"d":n&&n.cellDates?r=Gi(i.v,-1).toISOString():(i=tn(i),i.t="n",r=""+(i.v=en(Gi(i.v)))),typeof i.z>"u"&&(i.z=ni[14]);break;default:r=i.v;break}var u=Ai("v",It(r)),m={r:t},f=Vr(n.cellXfs,i,n);switch(f!==0&&(m.s=f),i.t){case"n":break;case"d":m.t="d";break;case"b":m.t="b";break;case"e":m.t="e";break;case"z":break;default:if(i.v==null){delete i.t;break}if(i.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(n&&n.bookSST){u=Ai("v",""+sd(n.Strings,i.v,n.revStrings)),m.t="s";break}m.t="str";break}if(i.t!=a&&(i.t=a,i.v=o),typeof i.f=="string"&&i.f){var h=i.F&&i.F.slice(0,t.length)==t?{t:"array",ref:i.F}:null;u=ge("f",It(i.f),h)+(i.v!=null?u:"")}return i.l&&e["!links"].push([t,i.l]),i.D&&(m.cm=1),ge("c",u,m)}function lE(i,t,e,n){var r=[],a=[],o=$t(i["!ref"]),u="",m,f="",h=[],g=0,x=0,b=i["!rows"],S=Array.isArray(i),v={r:f},E,j=-1;for(x=o.s.c;x<=o.e.c;++x)h[x]=Li(x);for(g=o.s.r;g<=o.e.r;++g){for(a=[],f=Oi(g),x=o.s.c;x<=o.e.c;++x){m=h[x]+f;var U=S?(i[g]||[])[x]:i[m];U!==void 0&&(u=sE(U,m,i,t,e,n))!=null&&a.push(u)}(a.length>0||b&&b[g])&&(v={r:f},b&&b[g]&&(E=b[g],E.hidden&&(v.hidden=1),j=-1,E.hpx?j=jl(E.hpx):E.hpt&&(j=E.hpt),j>-1&&(v.ht=j,v.customHeight=1),E.level&&(v.outlineLevel=E.level)),r[r.length]=ge("row",a.join(""),v))}if(b)for(;g<b.length;++g)b&&b[g]&&(v={r:g+1},E=b[g],E.hidden&&(v.hidden=1),j=-1,E.hpx?j=jl(E.hpx):E.hpt&&(j=E.hpt),j>-1&&(v.ht=j,v.customHeight=1),E.level&&(v.outlineLevel=E.level),r[r.length]=ge("row","",v));return r.join("")}function _g(i,t,e,n){var r=[pi,ge("worksheet",null,{xmlns:ao[0],"xmlns:r":Si.r})],a=e.SheetNames[i],o=0,u="",m=e.Sheets[a];m==null&&(m={});var f=m["!ref"]||"A1",h=$t(f);if(h.e.c>16383||h.e.r>1048575){if(t.WTF)throw new Error("Range "+f+" exceeds format limit A1:XFD1048576");h.e.c=Math.min(h.e.c,16383),h.e.r=Math.min(h.e.c,1048575),f=fi(h)}n||(n={}),m["!comments"]=[];var g=[];Zw(m,e,i,t,r),r[r.length]=ge("dimension",null,{ref:f}),r[r.length]=oE(m,t,i,e),t.sheetFormat&&(r[r.length]=ge("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),m["!cols"]!=null&&m["!cols"].length>0&&(r[r.length]=rE(m,m["!cols"])),r[o=r.length]="<sheetData/>",m["!links"]=[],m["!ref"]!=null&&(u=lE(m,t,i,e,n),u.length>0&&(r[r.length]=u)),r.length>o+1&&(r[r.length]="</sheetData>",r[o]=r[o].replace("/>",">")),m["!protect"]&&(r[r.length]=iE(m["!protect"])),m["!autofilter"]!=null&&(r[r.length]=aE(m["!autofilter"],m,e,i)),m["!merges"]!=null&&m["!merges"].length>0&&(r[r.length]=Jw(m["!merges"]));var x=-1,b,S=-1;return m["!links"].length>0&&(r[r.length]="<hyperlinks>",m["!links"].forEach(function(v){v[1].Target&&(b={ref:v[0]},v[1].Target.charAt(0)!="#"&&(S=kt(n,-1,It(v[1].Target).replace(/#.*$/,""),vt.HLINK),b["r:id"]="rId"+S),(x=v[1].Target.indexOf("#"))>-1&&(b.location=It(v[1].Target.slice(x+1))),v[1].Tooltip&&(b.tooltip=It(v[1].Tooltip)),r[r.length]=ge("hyperlink",null,b))}),r[r.length]="</hyperlinks>"),delete m["!links"],m["!margins"]!=null&&(r[r.length]=nE(m["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(r[r.length]=Ai("ignoredErrors",ge("ignoredError",null,{numberStoredAsText:1,sqref:f}))),g.length>0&&(S=kt(n,-1,"../drawings/drawing"+(i+1)+".xml",vt.DRAW),r[r.length]=ge("drawing",null,{"r:id":"rId"+S}),m["!drawing"]=g),m["!comments"].length>0&&(S=kt(n,-1,"../drawings/vmlDrawing"+(i+1)+".vml",vt.VML),r[r.length]=ge("legacyDrawing",null,{"r:id":"rId"+S}),m["!legacy"]=S),r.length>1&&(r[r.length]="</worksheet>",r[1]=r[1].replace("/>",">")),r.join("")}function cE(i,t){var e={},n=i.l+t;e.r=i.read_shift(4),i.l+=4;var r=i.read_shift(2);i.l+=1;var a=i.read_shift(1);return i.l=n,a&7&&(e.level=a&7),a&16&&(e.hidden=!0),a&32&&(e.hpt=r/20),e}function dE(i,t,e){var n=ne(145),r=(e["!rows"]||[])[i]||{};n.write_shift(4,i),n.write_shift(4,0);var a=320;r.hpx?a=jl(r.hpx)*20:r.hpt&&(a=r.hpt*20),n.write_shift(2,a),n.write_shift(1,0);var o=0;r.level&&(o|=r.level),r.hidden&&(o|=16),(r.hpx||r.hpt)&&(o|=32),n.write_shift(1,o),n.write_shift(1,0);var u=0,m=n.l;n.l+=4;for(var f={r:i,c:0},h=0;h<16;++h)if(!(t.s.c>h+1<<10||t.e.c<h<<10)){for(var g=-1,x=-1,b=h<<10;b<h+1<<10;++b){f.c=b;var S=Array.isArray(e)?(e[f.r]||[])[f.c]:e[Mt(f)];S&&(g<0&&(g=b),x=b)}g<0||(++u,n.write_shift(4,g),n.write_shift(4,x))}var v=n.l;return n.l=m,n.write_shift(4,u),n.l=v,n.length>n.l?n.slice(0,n.l):n}function uE(i,t,e,n){var r=dE(n,e,t);(r.length>17||(t["!rows"]||[])[n])&&de(i,0,r)}var mE=ga,fE=lo;function pE(){}function hE(i,t){var e={},n=i[i.l];return++i.l,e.above=!(n&64),e.left=!(n&128),i.l+=18,e.name=Ey(i,t-19),e}function gE(i,t,e){e==null&&(e=ne(84+4*i.length));var n=192;t&&(t.above&&(n&=-65),t.left&&(n&=-129)),e.write_shift(1,n);for(var r=1;r<3;++r)e.write_shift(1,0);return Bl({auto:1},e),e.write_shift(-4,-1),e.write_shift(-4,-1),Ah(i,e),e.slice(0,e.l)}function _E(i){var t=kn(i);return[t]}function vE(i,t,e){return e==null&&(e=ne(8)),fa(t,e)}function xE(i){var t=pa(i);return[t]}function bE(i,t,e){return e==null&&(e=ne(4)),ha(t,e)}function yE(i){var t=kn(i),e=i.read_shift(1);return[t,e,"b"]}function CE(i,t,e){return e==null&&(e=ne(9)),fa(t,e),e.write_shift(1,i.v?1:0),e}function SE(i){var t=pa(i),e=i.read_shift(1);return[t,e,"b"]}function wE(i,t,e){return e==null&&(e=ne(5)),ha(t,e),e.write_shift(1,i.v?1:0),e}function EE(i){var t=kn(i),e=i.read_shift(1);return[t,e,"e"]}function TE(i,t,e){return e==null&&(e=ne(9)),fa(t,e),e.write_shift(1,i.v),e}function PE(i){var t=pa(i),e=i.read_shift(1);return[t,e,"e"]}function kE(i,t,e){return e==null&&(e=ne(8)),ha(t,e),e.write_shift(1,i.v),e.write_shift(2,0),e.write_shift(1,0),e}function IE(i){var t=kn(i),e=i.read_shift(4);return[t,e,"s"]}function ME(i,t,e){return e==null&&(e=ne(12)),fa(t,e),e.write_shift(4,t.v),e}function FE(i){var t=pa(i),e=i.read_shift(4);return[t,e,"s"]}function AE(i,t,e){return e==null&&(e=ne(8)),ha(t,e),e.write_shift(4,t.v),e}function OE(i){var t=kn(i),e=co(i);return[t,e,"n"]}function DE(i,t,e){return e==null&&(e=ne(16)),fa(t,e),da(i.v,e),e}function RE(i){var t=pa(i),e=co(i);return[t,e,"n"]}function NE(i,t,e){return e==null&&(e=ne(12)),ha(t,e),da(i.v,e),e}function BE(i){var t=kn(i),e=Oh(i);return[t,e,"n"]}function LE(i,t,e){return e==null&&(e=ne(12)),fa(t,e),Dh(i.v,e),e}function VE(i){var t=pa(i),e=Oh(i);return[t,e,"n"]}function UE(i,t,e){return e==null&&(e=ne(8)),ha(t,e),Dh(i.v,e),e}function jE(i){var t=kn(i),e=Z0(i);return[t,e,"is"]}function WE(i){var t=kn(i),e=Vi(i);return[t,e,"str"]}function HE(i,t,e){return e==null&&(e=ne(12+4*i.v.length)),fa(t,e),Ei(i.v,e),e.length>e.l?e.slice(0,e.l):e}function $E(i){var t=pa(i),e=Vi(i);return[t,e,"str"]}function zE(i,t,e){return e==null&&(e=ne(8+4*i.v.length)),ha(t,e),Ei(i.v,e),e.length>e.l?e.slice(0,e.l):e}function GE(i,t,e){var n=i.l+t,r=kn(i);r.r=e["!row"];var a=i.read_shift(1),o=[r,a,"b"];if(e.cellFormula){i.l+=2;var u=Ql(i,n-i.l,e);o[3]=ro(u,null,r,e.supbooks,e)}else i.l=n;return o}function qE(i,t,e){var n=i.l+t,r=kn(i);r.r=e["!row"];var a=i.read_shift(1),o=[r,a,"e"];if(e.cellFormula){i.l+=2;var u=Ql(i,n-i.l,e);o[3]=ro(u,null,r,e.supbooks,e)}else i.l=n;return o}function XE(i,t,e){var n=i.l+t,r=kn(i);r.r=e["!row"];var a=co(i),o=[r,a,"n"];if(e.cellFormula){i.l+=2;var u=Ql(i,n-i.l,e);o[3]=ro(u,null,r,e.supbooks,e)}else i.l=n;return o}function KE(i,t,e){var n=i.l+t,r=kn(i);r.r=e["!row"];var a=Vi(i),o=[r,a,"str"];if(e.cellFormula){i.l+=2;var u=Ql(i,n-i.l,e);o[3]=ro(u,null,r,e.supbooks,e)}else i.l=n;return o}var YE=ga,QE=lo;function JE(i,t){return t==null&&(t=ne(4)),t.write_shift(4,i),t}function ZE(i,t){var e=i.l+t,n=ga(i,16),r=ed(i),a=Vi(i),o=Vi(i),u=Vi(i);i.l=e;var m={rfx:n,relId:r,loc:a,display:u};return o&&(m.Tooltip=o),m}function e3(i,t){var e=ne(50+4*(i[1].Target.length+(i[1].Tooltip||"").length));lo({s:wi(i[0]),e:wi(i[0])},e),td("rId"+t,e);var n=i[1].Target.indexOf("#"),r=n==-1?"":i[1].Target.slice(n+1);return Ei(r||"",e),Ei(i[1].Tooltip||"",e),Ei("",e),e.slice(0,e.l)}function t3(){}function i3(i,t,e){var n=i.l+t,r=Rh(i,16),a=i.read_shift(1),o=[r];if(o[2]=a,e.cellFormula){var u=$w(i,n-i.l,e);o[1]=u}else i.l=n;return o}function n3(i,t,e){var n=i.l+t,r=ga(i,16),a=[r];if(e.cellFormula){var o=Gw(i,n-i.l,e);a[1]=o,i.l=n}else i.l=n;return a}function r3(i,t,e){e==null&&(e=ne(18));var n=Jl(i,t);e.write_shift(-4,i),e.write_shift(-4,i),e.write_shift(4,(n.width||10)*256),e.write_shift(4,0);var r=0;return t.hidden&&(r|=1),typeof n.width=="number"&&(r|=2),t.level&&(r|=t.level<<8),e.write_shift(2,r),e}var vg=["left","right","top","bottom","header","footer"];function a3(i){var t={};return vg.forEach(function(e){t[e]=co(i,8)}),t}function o3(i,t){return t==null&&(t=ne(6*8)),gg(i),vg.forEach(function(e){da(i[e],t)}),t}function s3(i){var t=i.read_shift(2);return i.l+=28,{RTL:t&32}}function l3(i,t,e){e==null&&(e=ne(30));var n=924;return(((t||{}).Views||[])[0]||{}).RTL&&(n|=32),e.write_shift(2,n),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,100),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(4,0),e}function c3(i){var t=ne(24);return t.write_shift(4,4),t.write_shift(4,1),lo(i,t),t}function d3(i,t){return t==null&&(t=ne(16*4+2)),t.write_shift(2,i.password?Zh(i.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(e){e[1]?t.write_shift(4,i[e[0]]!=null&&!i[e[0]]?1:0):t.write_shift(4,i[e[0]]!=null&&i[e[0]]?0:1)}),t}function u3(){}function m3(){}function f3(i,t,e,n,r,a,o){if(t.v===void 0)return!1;var u="";switch(t.t){case"b":u=t.v?"1":"0";break;case"d":t=tn(t),t.z=t.z||ni[14],t.v=en(Gi(t.v)),t.t="n";break;case"n":case"e":u=""+t.v;break;default:u=t.v;break}var m={r:e,c:n};switch(m.s=Vr(r.cellXfs,t,r),t.l&&a["!links"].push([Mt(m),t.l]),t.c&&a["!comments"].push([Mt(m),t.c]),t.t){case"s":case"str":return r.bookSST?(u=sd(r.Strings,t.v,r.revStrings),m.t="s",m.v=u,o?de(i,18,AE(t,m)):de(i,7,ME(t,m))):(m.t="str",o?de(i,17,zE(t,m)):de(i,6,HE(t,m))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?o?de(i,13,UE(t,m)):de(i,2,LE(t,m)):o?de(i,16,NE(t,m)):de(i,5,DE(t,m)),!0;case"b":return m.t="b",o?de(i,15,wE(t,m)):de(i,4,CE(t,m)),!0;case"e":return m.t="e",o?de(i,14,kE(t,m)):de(i,3,TE(t,m)),!0}return o?de(i,12,bE(t,m)):de(i,1,vE(t,m)),!0}function p3(i,t,e,n){var r=$t(t["!ref"]||"A1"),a,o="",u=[];de(i,145);var m=Array.isArray(t),f=r.e.r;t["!rows"]&&(f=Math.max(r.e.r,t["!rows"].length-1));for(var h=r.s.r;h<=f;++h){o=Oi(h),uE(i,t,r,h);var g=!1;if(h<=r.e.r)for(var x=r.s.c;x<=r.e.c;++x){h===r.s.r&&(u[x]=Li(x)),a=u[x]+o;var b=m?(t[h]||[])[x]:t[a];if(!b){g=!1;continue}g=f3(i,b,h,x,n,t,g)}}de(i,146)}function h3(i,t){!t||!t["!merges"]||(de(i,177,JE(t["!merges"].length)),t["!merges"].forEach(function(e){de(i,176,QE(e))}),de(i,178))}function g3(i,t){!t||!t["!cols"]||(de(i,390),t["!cols"].forEach(function(e,n){e&&de(i,60,r3(n,e))}),de(i,391))}function _3(i,t){!t||!t["!ref"]||(de(i,648),de(i,649,c3($t(t["!ref"]))),de(i,650))}function v3(i,t,e){t["!links"].forEach(function(n){if(n[1].Target){var r=kt(e,-1,n[1].Target.replace(/#.*$/,""),vt.HLINK);de(i,494,e3(n,r))}}),delete t["!links"]}function x3(i,t,e,n){if(t["!comments"].length>0){var r=kt(n,-1,"../drawings/vmlDrawing"+(e+1)+".vml",vt.VML);de(i,551,td("rId"+r)),t["!legacy"]=r}}function b3(i,t,e,n){if(t["!autofilter"]){var r=t["!autofilter"],a=typeof r.ref=="string"?r.ref:fi(r.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var o=e.Workbook.Names,u=_n(a);u.s.r==u.e.r&&(u.e.r=_n(t["!ref"]).e.r,a=fi(u));for(var m=0;m<o.length;++m){var f=o[m];if(f.Name=="_xlnm._FilterDatabase"&&f.Sheet==n){f.Ref="'"+e.SheetNames[n]+"'!"+a;break}}m==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+e.SheetNames[n]+"'!"+a}),de(i,161,lo($t(a))),de(i,162)}}function y3(i,t,e){de(i,133),de(i,137,l3(t,e)),de(i,138),de(i,134)}function C3(i,t){t["!protect"]&&de(i,535,d3(t["!protect"]))}function S3(i,t,e,n){var r=Zi(),a=e.SheetNames[i],o=e.Sheets[a]||{},u=a;try{e&&e.Workbook&&(u=e.Workbook.Sheets[i].CodeName||u)}catch{}var m=$t(o["!ref"]||"A1");if(m.e.c>16383||m.e.r>1048575){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");m.e.c=Math.min(m.e.c,16383),m.e.r=Math.min(m.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],de(r,129),(e.vbaraw||o["!outline"])&&de(r,147,gE(u,o["!outline"])),de(r,148,fE(m)),y3(r,o,e.Workbook),g3(r,o,i,t,e),p3(r,o,i,t,e),C3(r,o),b3(r,o,e,i),h3(r,o),v3(r,o,n),o["!margins"]&&de(r,476,o3(o["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&_3(r,o),x3(r,o,i,n),de(r,130),r.end()}function w3(i,t){i.l+=10;var e=Vi(i,t-10);return{name:e}}var E3=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function T3(i){return!i.Workbook||!i.Workbook.WBProps?"false":iy(i.Workbook.WBProps.date1904)?"true":"false"}var P3="][*?/\\".split("");function xg(i,t){if(i.length>31){if(t)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var e=!0;return P3.forEach(function(n){if(i.indexOf(n)!=-1){if(!t)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");e=!1}}),e}function k3(i,t,e){i.forEach(function(n,r){xg(n);for(var a=0;a<r;++a)if(n==i[a])throw new Error("Duplicate Sheet Name: "+n);if(e){var o=t&&t[r]&&t[r].CodeName||n;if(o.charCodeAt(0)==95&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}function I3(i){if(!i||!i.SheetNames||!i.Sheets)throw new Error("Invalid Workbook");if(!i.SheetNames.length)throw new Error("Workbook is empty");var t=i.Workbook&&i.Workbook.Sheets||[];k3(i.SheetNames,t,!!i.vbaraw);for(var e=0;e<i.SheetNames.length;++e)Qw(i.Sheets[i.SheetNames[e]],i.SheetNames[e],e)}function bg(i){var t=[pi];t[t.length]=ge("workbook",null,{xmlns:ao[0],"xmlns:r":Si.r});var e=i.Workbook&&(i.Workbook.Names||[]).length>0,n={codeName:"ThisWorkbook"};i.Workbook&&i.Workbook.WBProps&&(E3.forEach(function(u){i.Workbook.WBProps[u[0]]!=null&&i.Workbook.WBProps[u[0]]!=u[1]&&(n[u[0]]=i.Workbook.WBProps[u[0]])}),i.Workbook.WBProps.CodeName&&(n.codeName=i.Workbook.WBProps.CodeName,delete n.CodeName)),t[t.length]=ge("workbookPr",null,n);var r=i.Workbook&&i.Workbook.Sheets||[],a=0;if(r&&r[0]&&r[0].Hidden){for(t[t.length]="<bookViews>",a=0;a!=i.SheetNames.length&&!(!r[a]||!r[a].Hidden);++a);a==i.SheetNames.length&&(a=0),t[t.length]='<workbookView firstSheet="'+a+'" activeTab="'+a+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",a=0;a!=i.SheetNames.length;++a){var o={name:It(i.SheetNames[a].slice(0,31))};if(o.sheetId=""+(a+1),o["r:id"]="rId"+(a+1),r[a])switch(r[a].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden";break}t[t.length]=ge("sheet",null,o)}return t[t.length]="</sheets>",e&&(t[t.length]="<definedNames>",i.Workbook&&i.Workbook.Names&&i.Workbook.Names.forEach(function(u){var m={name:u.Name};u.Comment&&(m.comment=u.Comment),u.Sheet!=null&&(m.localSheetId=""+u.Sheet),u.Hidden&&(m.hidden="1"),u.Ref&&(t[t.length]=ge("definedName",It(u.Ref),m))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function M3(i,t){var e={};return e.Hidden=i.read_shift(4),e.iTabID=i.read_shift(4),e.strRelID=B0(i,t-8),e.name=Vi(i),e}function F3(i,t){return t||(t=ne(127)),t.write_shift(4,i.Hidden),t.write_shift(4,i.iTabID),td(i.strRelID,t),Ei(i.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function A3(i,t){var e={},n=i.read_shift(4);e.defaultThemeVersion=i.read_shift(4);var r=t>8?Vi(i):"";return r.length>0&&(e.CodeName=r),e.autoCompressPictures=!!(n&65536),e.backupFile=!!(n&64),e.checkCompatibility=!!(n&4096),e.date1904=!!(n&1),e.filterPrivacy=!!(n&8),e.hidePivotFieldList=!!(n&1024),e.promptedSolutions=!!(n&16),e.publishItems=!!(n&2048),e.refreshAllConnections=!!(n&262144),e.saveExternalLinkValues=!!(n&128),e.showBorderUnselectedTables=!!(n&4),e.showInkAnnotation=!!(n&32),e.showObjects=["all","placeholders","none"][n>>13&3],e.showPivotChartFilter=!!(n&32768),e.updateLinks=["userSet","never","always"][n>>8&3],e}function O3(i,t){t||(t=ne(72));var e=0;return i&&i.filterPrivacy&&(e|=8),t.write_shift(4,e),t.write_shift(4,0),Ah(i&&i.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function D3(i,t,e){var n=i.l+t;i.l+=4,i.l+=1;var r=i.read_shift(4),a=Ty(i),o=zw(i,0,e),u=ed(i);i.l=n;var m={Name:a,Ptg:o};return r<268435455&&(m.Sheet=r),u&&(m.Comment=u),m}function R3(i,t){de(i,143);for(var e=0;e!=t.SheetNames.length;++e){var n=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[e]&&t.Workbook.Sheets[e].Hidden||0,r={Hidden:n,iTabID:e+1,strRelID:"rId"+(e+1),name:t.SheetNames[e]};de(i,156,F3(r))}de(i,144)}function N3(i,t){t||(t=ne(127));for(var e=0;e!=4;++e)t.write_shift(4,0);return Ei("SheetJS",t),Ei(Ko.version,t),Ei(Ko.version,t),Ei("7262",t),t.length>t.l?t.slice(0,t.l):t}function B3(i,t){t||(t=ne(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,i),t.write_shift(4,i);var e=120;return t.write_shift(1,e),t.length>t.l?t.slice(0,t.l):t}function L3(i,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var e=t.Workbook.Sheets,n=0,r=-1,a=-1;n<e.length;++n)!e[n]||!e[n].Hidden&&r==-1?r=n:e[n].Hidden==1&&a==-1&&(a=n);a>r||(de(i,135),de(i,158,B3(r)),de(i,136))}}function V3(i,t){var e=Zi();return de(e,131),de(e,128,N3()),de(e,153,O3(i.Workbook&&i.Workbook.WBProps||null)),L3(e,i,t),R3(e,i,t),de(e,132),e.end()}function U3(i,t,e){return(t.slice(-4)===".bin"?V3:bg)(i,e)}function j3(i,t,e,n,r){return(t.slice(-4)===".bin"?S3:_g)(i,e,n,r)}function W3(i,t,e){return(t.slice(-4)===".bin"?oS:ig)(i,e)}function H3(i,t,e){return(t.slice(-4)===".bin"?OC:Jh)(i,e)}function $3(i,t,e){return(t.slice(-4)===".bin"?CS:sg)(i,e)}function z3(i){return(i.slice(-4)===".bin"?pS:ag)()}function G3(i,t){var e=[];return i.Props&&e.push(Wy(i.Props,t)),i.Custprops&&e.push(Hy(i.Props,i.Custprops,t)),e.join("")}function q3(){return""}function X3(i,t){var e=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(n,r){var a=[];a.push(ge("NumberFormat",null,{"ss:Format":It(ni[n.numFmtId])}));var o={"ss:ID":"s"+(21+r)};e.push(ge("Style",a.join(""),o))}),ge("Styles",e.join(""))}function yg(i){return ge("NamedRange",null,{"ss:Name":i.Name,"ss:RefersTo":"="+ad(i.Ref,{r:0,c:0})})}function K3(i){if(!((i||{}).Workbook||{}).Names)return"";for(var t=i.Workbook.Names,e=[],n=0;n<t.length;++n){var r=t[n];r.Sheet==null&&(r.Name.match(/^_xlfn\./)||e.push(yg(r)))}return ge("Names",e.join(""))}function Y3(i,t,e,n){if(!i||!((n||{}).Workbook||{}).Names)return"";for(var r=n.Workbook.Names,a=[],o=0;o<r.length;++o){var u=r[o];u.Sheet==e&&(u.Name.match(/^_xlfn\./)||a.push(yg(u)))}return a.join("")}function Q3(i,t,e,n){if(!i)return"";var r=[];if(i["!margins"]&&(r.push("<PageSetup>"),i["!margins"].header&&r.push(ge("Header",null,{"x:Margin":i["!margins"].header})),i["!margins"].footer&&r.push(ge("Footer",null,{"x:Margin":i["!margins"].footer})),r.push(ge("PageMargins",null,{"x:Bottom":i["!margins"].bottom||"0.75","x:Left":i["!margins"].left||"0.7","x:Right":i["!margins"].right||"0.7","x:Top":i["!margins"].top||"0.75"})),r.push("</PageSetup>")),n&&n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[e])if(n.Workbook.Sheets[e].Hidden)r.push(ge("Visible",n.Workbook.Sheets[e].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var a=0;a<e&&!(n.Workbook.Sheets[a]&&!n.Workbook.Sheets[a].Hidden);++a);a==e&&r.push("<Selected/>")}return((((n||{}).Workbook||{}).Views||[])[0]||{}).RTL&&r.push("<DisplayRightToLeft/>"),i["!protect"]&&(r.push(Ai("ProtectContents","True")),i["!protect"].objects&&r.push(Ai("ProtectObjects","True")),i["!protect"].scenarios&&r.push(Ai("ProtectScenarios","True")),i["!protect"].selectLockedCells!=null&&!i["!protect"].selectLockedCells?r.push(Ai("EnableSelection","NoSelection")):i["!protect"].selectUnlockedCells!=null&&!i["!protect"].selectUnlockedCells&&r.push(Ai("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(o){i["!protect"][o[0]]&&r.push("<"+o[1]+"/>")})),r.length==0?"":ge("WorksheetOptions",r.join(""),{xmlns:gn.x})}function J3(i){return i.map(function(t){var e=ty(t.t||""),n=ge("ss:Data",e,{xmlns:"http://www.w3.org/TR/REC-html40"});return ge("Comment",n,{"ss:Author":t.a})}).join("")}function Z3(i,t,e,n,r,a,o){if(!i||i.v==null&&i.f==null)return"";var u={};if(i.f&&(u["ss:Formula"]="="+It(ad(i.f,o))),i.F&&i.F.slice(0,t.length)==t){var m=wi(i.F.slice(t.length+1));u["ss:ArrayRange"]="RC:R"+(m.r==o.r?"":"["+(m.r-o.r)+"]")+"C"+(m.c==o.c?"":"["+(m.c-o.c)+"]")}if(i.l&&i.l.Target&&(u["ss:HRef"]=It(i.l.Target),i.l.Tooltip&&(u["x:HRefScreenTip"]=It(i.l.Tooltip))),e["!merges"])for(var f=e["!merges"],h=0;h!=f.length;++h)f[h].s.c!=o.c||f[h].s.r!=o.r||(f[h].e.c>f[h].s.c&&(u["ss:MergeAcross"]=f[h].e.c-f[h].s.c),f[h].e.r>f[h].s.r&&(u["ss:MergeDown"]=f[h].e.r-f[h].s.r));var g="",x="";switch(i.t){case"z":if(!n.sheetStubs)return"";break;case"n":g="Number",x=String(i.v);break;case"b":g="Boolean",x=i.v?"1":"0";break;case"e":g="Error",x=rs[i.v];break;case"d":g="DateTime",x=new Date(i.v).toISOString(),i.z==null&&(i.z=i.z||ni[14]);break;case"s":g="String",x=ey(i.v||"");break}var b=Vr(n.cellXfs,i,n);u["ss:StyleID"]="s"+(21+b),u["ss:Index"]=o.c+1;var S=i.v!=null?x:"",v=i.t=="z"?"":'<Data ss:Type="'+g+'">'+S+"</Data>";return(i.c||[]).length>0&&(v+=J3(i.c)),ge("Cell",v,u)}function eT(i,t){var e='<Row ss:Index="'+(i+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=tg(t.hpt)),t.hpx&&(e+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(e+=' ss:Hidden="1"')),e+">"}function tT(i,t,e,n){if(!i["!ref"])return"";var r=$t(i["!ref"]),a=i["!merges"]||[],o=0,u=[];i["!cols"]&&i["!cols"].forEach(function(E,j){nd(E);var U=!!E.width,H=Jl(j,E),Y={"ss:Index":j+1};U&&(Y["ss:Width"]=Vl(H.width)),E.hidden&&(Y["ss:Hidden"]="1"),u.push(ge("Column",null,Y))});for(var m=Array.isArray(i),f=r.s.r;f<=r.e.r;++f){for(var h=[eT(f,(i["!rows"]||[])[f])],g=r.s.c;g<=r.e.c;++g){var x=!1;for(o=0;o!=a.length;++o)if(!(a[o].s.c>g)&&!(a[o].s.r>f)&&!(a[o].e.c<g)&&!(a[o].e.r<f)){(a[o].s.c!=g||a[o].s.r!=f)&&(x=!0);break}if(!x){var b={r:f,c:g},S=Mt(b),v=m?(i[f]||[])[g]:i[S];h.push(Z3(v,S,i,t,e,n,b))}}h.push("</Row>"),h.length>2&&u.push(h.join(""))}return u.join("")}function iT(i,t,e){var n=[],r=e.SheetNames[i],a=e.Sheets[r],o=a?Y3(a,t,i,e):"";return o.length>0&&n.push("<Names>"+o+"</Names>"),o=a?tT(a,t,i,e):"",o.length>0&&n.push("<Table>"+o+"</Table>"),n.push(Q3(a,t,i,e)),n.join("")}function nT(i,t){t||(t={}),i.SSF||(i.SSF=tn(ni)),i.SSF&&(Gl(),zl(i.SSF),t.revssf=ql(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF,t.cellXfs=[],Vr(t.cellXfs,{},{revssf:{General:0}}));var e=[];e.push(G3(i,t)),e.push(q3(i,t)),e.push(""),e.push("");for(var n=0;n<i.SheetNames.length;++n)e.push(ge("Worksheet",iT(n,t,i),{"ss:Name":It(i.SheetNames[n])}));return e[2]=X3(i,t),e[3]=K3(i,t),pi+ge("Workbook",e.join(""),{xmlns:gn.ss,"xmlns:o":gn.o,"xmlns:x":gn.x,"xmlns:ss":gn.ss,"xmlns:dt":gn.dt,"xmlns:html":gn.html})}var A0={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function rT(i,t){var e=[],n=[],r=[],a=0,o,u=Pp(Up,"n"),m=Pp(jp,"n");if(i.Props)for(o=Di(i.Props),a=0;a<o.length;++a)(Object.prototype.hasOwnProperty.call(u,o[a])?e:Object.prototype.hasOwnProperty.call(m,o[a])?n:r).push([o[a],i.Props[o[a]]]);if(i.Custprops)for(o=Di(i.Custprops),a=0;a<o.length;++a)Object.prototype.hasOwnProperty.call(i.Props||{},o[a])||(Object.prototype.hasOwnProperty.call(u,o[a])?e:Object.prototype.hasOwnProperty.call(m,o[a])?n:r).push([o[a],i.Custprops[o[a]]]);var f=[];for(a=0;a<r.length;++a)zh.indexOf(r[a][0])>-1||Wh.indexOf(r[a][0])>-1||r[a][1]!=null&&f.push(r[a]);n.length&&Ot.utils.cfb_add(t,"/SummaryInformation",Gp(n,A0.SI,m,jp)),(e.length||f.length)&&Ot.utils.cfb_add(t,"/DocumentSummaryInformation",Gp(e,A0.DSI,u,Up,f.length?f:null,A0.UDI))}function aT(i,t){var e=t||{},n=Ot.utils.cfb_new({root:"R"}),r="/Workbook";switch(e.bookType||"xls"){case"xls":e.bookType="biff8";case"xla":e.bookType||(e.bookType="xla");case"biff8":r="/Workbook",e.biff=8;break;case"biff5":r="/Book",e.biff=5;break;default:throw new Error("invalid type "+e.bookType+" for XLS CFB")}return Ot.utils.cfb_add(n,r,Cg(i,e)),e.biff==8&&(i.Props||i.Custprops)&&rT(i,n),e.biff==8&&i.vbaraw&&SS(n,Ot.read(i.vbaraw,{type:typeof i.vbaraw=="string"?"binary":"buffer"})),n}var oT={0:{f:cE},1:{f:_E},2:{f:BE},3:{f:EE},4:{f:yE},5:{f:OE},6:{f:WE},7:{f:IE},8:{f:KE},9:{f:XE},10:{f:GE},11:{f:qE},12:{f:xE},13:{f:VE},14:{f:PE},15:{f:SE},16:{f:RE},17:{f:$E},18:{f:FE},19:{f:Z0},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:D3},40:{},42:{},43:{f:WC},44:{f:UC},45:{f:zC},46:{f:qC},47:{f:GC},48:{},49:{f:xy},50:{},51:{f:cS},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:bC},62:{f:jE},63:{f:hS},64:{f:u3},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:sr,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:s3},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:hE},148:{f:mE,p:16},151:{f:t3},152:{},153:{f:A3},154:{},155:{},156:{f:M3},157:{},158:{},159:{T:1,f:MC},160:{T:-1},161:{T:1,f:ga},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:YE},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:sS},336:{T:-1},337:{f:mS,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:B0},357:{},358:{},359:{},360:{T:1},361:{},362:{f:pC},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:i3},427:{f:n3},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:a3},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:pE},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:ZE},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:B0},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:bS},633:{T:1},634:{T:-1},635:{T:1,f:vS},636:{T:-1},637:{f:Sy},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:w3},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:m3},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function ve(i,t,e,n){var r=t;if(!isNaN(r)){var a=n||(e||[]).length||0,o=i.next(4);o.write_shift(2,r),o.write_shift(2,a),a>0&&Y0(e)&&i.push(e)}}function sT(i,t,e,n){var r=n||(e||[]).length||0;if(r<=8224)return ve(i,t,e,r);var a=t;if(!isNaN(a)){for(var o=e.parts||[],u=0,m=0,f=0;f+(o[u]||8224)<=8224;)f+=o[u]||8224,u++;var h=i.next(4);for(h.write_shift(2,a),h.write_shift(2,f),i.push(e.slice(m,m+f)),m+=f;m<r;){for(h=i.next(4),h.write_shift(2,60),f=0;f+(o[u]||8224)<=8224;)f+=o[u]||8224,u++;h.write_shift(2,f),i.push(e.slice(m,m+f)),m+=f}}}function os(i,t,e){return i||(i=ne(7)),i.write_shift(2,t),i.write_shift(2,e),i.write_shift(2,0),i.write_shift(1,0),i}function lT(i,t,e,n){var r=ne(9);return os(r,i,t),qh(e,n||"b",r),r}function cT(i,t,e){var n=ne(8+2*e.length);return os(n,i,t),n.write_shift(1,e.length),n.write_shift(e.length,e,"sbcs"),n.l<n.length?n.slice(0,n.l):n}function dT(i,t,e,n){if(t.v!=null)switch(t.t){case"d":case"n":var r=t.t=="d"?en(Gi(t.v)):t.v;r==(r|0)&&r>=0&&r<65536?ve(i,2,wC(e,n,r)):ve(i,3,SC(e,n,r));return;case"b":case"e":ve(i,5,lT(e,n,t.v,t.t));return;case"s":case"str":ve(i,4,cT(e,n,(t.v||"").slice(0,255)));return}ve(i,1,os(null,e,n))}function uT(i,t,e,n){var r=Array.isArray(t),a=$t(t["!ref"]||"A1"),o,u="",m=[];if(a.e.c>255||a.e.r>16383){if(n.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),o=fi(a)}for(var f=a.s.r;f<=a.e.r;++f){u=Oi(f);for(var h=a.s.c;h<=a.e.c;++h){f===a.s.r&&(m[h]=Li(h)),o=m[h]+u;var g=r?(t[f]||[])[h]:t[o];g&&dT(i,g,f,h,n)}}}function mT(i,t){var e=t||{};or!=null&&e.dense==null&&(e.dense=or);for(var n=Zi(),r=0,a=0;a<i.SheetNames.length;++a)i.SheetNames[a]==e.sheet&&(r=a);if(r==0&&e.sheet&&i.SheetNames[0]!=e.sheet)throw new Error("Sheet not found: "+e.sheet);return ve(n,e.biff==4?1033:e.biff==3?521:9,id(i,16,e)),uT(n,i.Sheets[i.SheetNames[r]],r,e,i),ve(n,10),n.end()}function fT(i,t,e){ve(i,49,oC({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},e))}function pT(i,t,e){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&ve(i,1054,cC(r,t[r],e))})}function hT(i,t){var e=ne(19);e.write_shift(4,2151),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,1),e.write_shift(4,0),ve(i,2151,e),e=ne(39),e.write_shift(4,2152),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(2,1),e.write_shift(4,4),e.write_shift(2,0),Yh($t(t["!ref"]||"A1"),e),e.write_shift(4,4),ve(i,2152,e)}function gT(i,t){for(var e=0;e<16;++e)ve(i,224,Xp({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(n){ve(i,224,Xp(n,0,t))})}function _T(i,t){for(var e=0;e<t["!links"].length;++e){var n=t["!links"][e];ve(i,440,_C(n)),n[1].Tooltip&&ve(i,2048,vC(n))}delete t["!links"]}function vT(i,t){if(t){var e=0;t.forEach(function(n,r){++e<=256&&n&&ve(i,125,yC(Jl(r,n),r))})}}function xT(i,t,e,n,r){var a=16+Vr(r.cellXfs,t,r);if(t.v==null&&!t.bf){ve(i,513,ua(e,n,a));return}if(t.bf)ve(i,6,Hw(t,e,n,r,a));else switch(t.t){case"d":case"n":var o=t.t=="d"?en(Gi(t.v)):t.v;ve(i,515,fC(e,n,o,a,r));break;case"b":case"e":ve(i,517,mC(e,n,t.v,a,r,t.t));break;case"s":case"str":if(r.bookSST){var u=sd(r.Strings,t.v,r.revStrings);ve(i,253,sC(e,n,u,a,r))}else ve(i,516,lC(e,n,(t.v||"").slice(0,255),a,r));break;default:ve(i,513,ua(e,n,a))}}function bT(i,t,e){var n=Zi(),r=e.SheetNames[i],a=e.Sheets[r]||{},o=(e||{}).Workbook||{},u=(o.Sheets||[])[i]||{},m=Array.isArray(a),f=t.biff==8,h,g="",x=[],b=$t(a["!ref"]||"A1"),S=f?65536:16384;if(b.e.c>255||b.e.r>=S){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");b.e.c=Math.min(b.e.c,255),b.e.r=Math.min(b.e.c,S-1)}ve(n,2057,id(e,16,t)),ve(n,13,Pn(1)),ve(n,12,Pn(100)),ve(n,15,zi(!0)),ve(n,17,zi(!1)),ve(n,16,da(.001)),ve(n,95,zi(!0)),ve(n,42,zi(!1)),ve(n,43,zi(!1)),ve(n,130,Pn(1)),ve(n,128,uC([0,0])),ve(n,131,zi(!1)),ve(n,132,zi(!1)),f&&vT(n,a["!cols"]),ve(n,512,dC(b,t)),f&&(a["!links"]=[]);for(var v=b.s.r;v<=b.e.r;++v){g=Oi(v);for(var E=b.s.c;E<=b.e.c;++E){v===b.s.r&&(x[E]=Li(E)),h=x[E]+g;var j=m?(a[v]||[])[E]:a[h];j&&(xT(n,j,v,E,t),f&&j.l&&a["!links"].push([h,j.l]))}}var U=u.CodeName||u.name||r;return f&&ve(n,574,aC((o.Views||[])[0])),f&&(a["!merges"]||[]).length&&ve(n,229,gC(a["!merges"])),f&&_T(n,a),ve(n,442,Kh(U,t)),f&&hT(n,a),ve(n,10),n.end()}function yT(i,t,e){var n=Zi(),r=(i||{}).Workbook||{},a=r.Sheets||[],o=r.WBProps||{},u=e.biff==8,m=e.biff==5;if(ve(n,2057,id(i,5,e)),e.bookType=="xla"&&ve(n,135),ve(n,225,u?Pn(1200):null),ve(n,193,Gy(2)),m&&ve(n,191),m&&ve(n,192),ve(n,226),ve(n,92,tC("SheetJS",e)),ve(n,66,Pn(u?1200:1252)),u&&ve(n,353,Pn(0)),u&&ve(n,448),ve(n,317,CC(i.SheetNames.length)),u&&i.vbaraw&&ve(n,211),u&&i.vbaraw){var f=o.CodeName||"ThisWorkbook";ve(n,442,Kh(f,e))}ve(n,156,Pn(17)),ve(n,25,zi(!1)),ve(n,18,zi(!1)),ve(n,19,Pn(0)),u&&ve(n,431,zi(!1)),u&&ve(n,444,Pn(0)),ve(n,61,rC(e)),ve(n,64,zi(!1)),ve(n,141,Pn(0)),ve(n,34,zi(T3(i)=="true")),ve(n,14,zi(!0)),u&&ve(n,439,zi(!1)),ve(n,218,Pn(0)),fT(n,i,e),pT(n,i.SSF,e),gT(n,e),u&&ve(n,352,zi(!1));var h=n.end(),g=Zi();u&&ve(g,140,xC()),u&&e.Strings&&sT(g,252,nC(e.Strings,e)),ve(g,10);var x=g.end(),b=Zi(),S=0,v=0;for(v=0;v<i.SheetNames.length;++v)S+=(u?12:11)+(u?2:1)*i.SheetNames[v].length;var E=h.length+S+x.length;for(v=0;v<i.SheetNames.length;++v){var j=a[v]||{};ve(b,133,iC({pos:E,hs:j.Hidden||0,dt:0,name:i.SheetNames[v]},e)),E+=t[v].length}var U=b.end();if(S!=U.length)throw new Error("BS8 "+S+" != "+U.length);var H=[];return h.length&&H.push(h),U.length&&H.push(U),x.length&&H.push(x),Fi(H)}function CT(i,t){var e=t||{},n=[];i&&!i.SSF&&(i.SSF=tn(ni)),i&&i.SSF&&(Gl(),zl(i.SSF),e.revssf=ql(i.SSF),e.revssf[i.SSF[65535]]=0,e.ssf=i.SSF),e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,ld(e),e.cellXfs=[],Vr(e.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={});for(var r=0;r<i.SheetNames.length;++r)n[n.length]=bT(r,e,i);return n.unshift(yT(i,n,e)),Fi(n)}function Cg(i,t){for(var e=0;e<=i.SheetNames.length;++e){var n=i.Sheets[i.SheetNames[e]];if(!(!n||!n["!ref"])){var r=_n(n["!ref"]);r.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+i.SheetNames[e]+"' extends beyond column IV (255).  Data may be lost.")}}var a=t||{};switch(a.biff||2){case 8:case 5:return CT(i,t);case 4:case 3:case 2:return mT(i,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function ST(i,t,e,n){for(var r=i["!merges"]||[],a=[],o=t.s.c;o<=t.e.c;++o){for(var u=0,m=0,f=0;f<r.length;++f)if(!(r[f].s.r>e||r[f].s.c>o)&&!(r[f].e.r<e||r[f].e.c<o)){if(r[f].s.r<e||r[f].s.c<o){u=-1;break}u=r[f].e.r-r[f].s.r+1,m=r[f].e.c-r[f].s.c+1;break}if(!(u<0)){var h=Mt({r:e,c:o}),g=n.dense?(i[e]||[])[o]:i[h],x=g&&g.v!=null&&(g.h||Zb(g.w||(xr(g),g.w)||""))||"",b={};u>1&&(b.rowspan=u),m>1&&(b.colspan=m),n.editable?x='<span contenteditable="true">'+x+"</span>":g&&(b["data-t"]=g&&g.t||"z",g.v!=null&&(b["data-v"]=g.v),g.z!=null&&(b["data-z"]=g.z),g.l&&(g.l.Target||"#").charAt(0)!="#"&&(x='<a href="'+g.l.Target+'">'+x+"</a>")),b.id=(n.id||"sjs")+"-"+h,a.push(ge("td",x,b))}}var S="<tr>";return S+a.join("")+"</tr>"}var wT='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',ET="</body></html>";function TT(i,t,e){var n=[];return n.join("")+"<table"+(e&&e.id?' id="'+e.id+'"':"")+">"}function Sg(i,t){var e=t||{},n=e.header!=null?e.header:wT,r=e.footer!=null?e.footer:ET,a=[n],o=_n(i["!ref"]);e.dense=Array.isArray(i),a.push(TT(i,o,e));for(var u=o.s.r;u<=o.e.r;++u)a.push(ST(i,o,u,e));return a.push("</table>"+r),a.join("")}function wg(i,t,e){var n=e||{};or!=null&&(n.dense=or);var r=0,a=0;if(n.origin!=null)if(typeof n.origin=="number")r=n.origin;else{var o=typeof n.origin=="string"?wi(n.origin):n.origin;r=o.r,a=o.c}var u=t.getElementsByTagName("tr"),m=Math.min(n.sheetRows||1e7,u.length),f={s:{r:0,c:0},e:{r,c:a}};if(i["!ref"]){var h=_n(i["!ref"]);f.s.r=Math.min(f.s.r,h.s.r),f.s.c=Math.min(f.s.c,h.s.c),f.e.r=Math.max(f.e.r,h.e.r),f.e.c=Math.max(f.e.c,h.e.c),r==-1&&(f.e.r=r=h.e.r+1)}var g=[],x=0,b=i["!rows"]||(i["!rows"]=[]),S=0,v=0,E=0,j=0,U=0,H=0;for(i["!cols"]||(i["!cols"]=[]);S<u.length&&v<m;++S){var Y=u[S];if(th(Y)){if(n.display)continue;b[v]={hidden:!0}}var z=Y.children;for(E=j=0;E<z.length;++E){var _e=z[E];if(!(n.display&&th(_e))){var W=_e.hasAttribute("data-v")?_e.getAttribute("data-v"):_e.hasAttribute("v")?_e.getAttribute("v"):ny(_e.innerHTML),le=_e.getAttribute("data-z")||_e.getAttribute("z");for(x=0;x<g.length;++x){var te=g[x];te.s.c==j+a&&te.s.r<v+r&&v+r<=te.e.r&&(j=te.e.c+1-a,x=-1)}H=+_e.getAttribute("colspan")||1,((U=+_e.getAttribute("rowspan")||1)>1||H>1)&&g.push({s:{r:v+r,c:j+a},e:{r:v+r+(U||1)-1,c:j+a+(H||1)-1}});var ce={t:"s",v:W},ue=_e.getAttribute("data-t")||_e.getAttribute("t")||"";W!=null&&(W.length==0?ce.t=ue||"z":n.raw||W.trim().length==0||ue=="s"||(W==="TRUE"?ce={t:"b",v:!0}:W==="FALSE"?ce={t:"b",v:!1}:isNaN(gr(W))?isNaN(Jo(W).getDate())||(ce={t:"d",v:Gi(W)},n.cellDates||(ce={t:"n",v:en(ce.v)}),ce.z=n.dateNF||ni[14]):ce={t:"n",v:gr(W)})),ce.z===void 0&&le!=null&&(ce.z=le);var me="",Me=_e.getElementsByTagName("A");if(Me&&Me.length)for(var ut=0;ut<Me.length&&!(Me[ut].hasAttribute("href")&&(me=Me[ut].getAttribute("href"),me.charAt(0)!="#"));++ut);me&&me.charAt(0)!="#"&&(ce.l={Target:me}),n.dense?(i[v+r]||(i[v+r]=[]),i[v+r][j+a]=ce):i[Mt({c:j+a,r:v+r})]=ce,f.e.c<j+a&&(f.e.c=j+a),j+=H}}++v}return g.length&&(i["!merges"]=(i["!merges"]||[]).concat(g)),f.e.r=Math.max(f.e.r,v-1+r),i["!ref"]=fi(f),v>=m&&(i["!fullref"]=fi((f.e.r=u.length-S+v-1+r,f))),i}function Eg(i,t){var e=t||{},n=e.dense?[]:{};return wg(n,i,t)}function PT(i,t){return ma(Eg(i,t),t)}function th(i){var t="",e=kT(i);return e&&(t=e(i).getPropertyValue("display")),t||(t=i.style&&i.style.display),t==="none"}function kT(i){return i.ownerDocument.defaultView&&typeof i.ownerDocument.defaultView.getComputedStyle=="function"?i.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var IT=function(){var i=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+Zo({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+i+"</office:document-styles>";return function(){return pi+t}}(),ih=function(){var i=function(a){return It(a).replace(/  +/g,function(o){return'<text:s text:c="'+o.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,e=`          <table:covered-table-cell/>
`,n=function(a,o,u){var m=[];m.push('      <table:table table:name="'+It(o.SheetNames[u])+`" table:style-name="ta1">
`);var f=0,h=0,g=_n(a["!ref"]||"A1"),x=a["!merges"]||[],b=0,S=Array.isArray(a);if(a["!cols"])for(h=0;h<=g.e.c;++h)m.push("        <table:table-column"+(a["!cols"][h]?' table:style-name="co'+a["!cols"][h].ods+'"':"")+`></table:table-column>
`);var v="",E=a["!rows"]||[];for(f=0;f<g.s.r;++f)v=E[f]?' table:style-name="ro'+E[f].ods+'"':"",m.push("        <table:table-row"+v+`></table:table-row>
`);for(;f<=g.e.r;++f){for(v=E[f]?' table:style-name="ro'+E[f].ods+'"':"",m.push("        <table:table-row"+v+`>
`),h=0;h<g.s.c;++h)m.push(t);for(;h<=g.e.c;++h){var j=!1,U={},H="";for(b=0;b!=x.length;++b)if(!(x[b].s.c>h)&&!(x[b].s.r>f)&&!(x[b].e.c<h)&&!(x[b].e.r<f)){(x[b].s.c!=h||x[b].s.r!=f)&&(j=!0),U["table:number-columns-spanned"]=x[b].e.c-x[b].s.c+1,U["table:number-rows-spanned"]=x[b].e.r-x[b].s.r+1;break}if(j){m.push(e);continue}var Y=Mt({r:f,c:h}),z=S?(a[f]||[])[h]:a[Y];if(z&&z.f&&(U["table:formula"]=It(Kw(z.f)),z.F&&z.F.slice(0,Y.length)==Y)){var _e=_n(z.F);U["table:number-matrix-columns-spanned"]=_e.e.c-_e.s.c+1,U["table:number-matrix-rows-spanned"]=_e.e.r-_e.s.r+1}if(!z){m.push(t);continue}switch(z.t){case"b":H=z.v?"TRUE":"FALSE",U["office:value-type"]="boolean",U["office:boolean-value"]=z.v?"true":"false";break;case"n":H=z.w||String(z.v||0),U["office:value-type"]="float",U["office:value"]=z.v||0;break;case"s":case"str":H=z.v==null?"":z.v,U["office:value-type"]="string";break;case"d":H=z.w||Gi(z.v).toISOString(),U["office:value-type"]="date",U["office:date-value"]=Gi(z.v).toISOString(),U["table:style-name"]="ce1";break;default:m.push(t);continue}var W=i(H);if(z.l&&z.l.Target){var le=z.l.Target;le=le.charAt(0)=="#"?"#"+Yw(le.slice(1)):le,le.charAt(0)!="#"&&!le.match(/^\w+:/)&&(le="../"+le),W=ge("text:a",W,{"xlink:href":le.replace(/&/g,"&amp;")})}m.push("          "+ge("table:table-cell",ge("text:p",W,{}),U)+`
`)}m.push(`        </table:table-row>
`)}return m.push(`      </table:table>
`),m.join("")},r=function(a,o){a.push(` <office:automatic-styles>
`),a.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),a.push(`   <number:month number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:day number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:year/>
`),a.push(`  </number:date-style>
`);var u=0;o.SheetNames.map(function(f){return o.Sheets[f]}).forEach(function(f){if(f&&f["!cols"]){for(var h=0;h<f["!cols"].length;++h)if(f["!cols"][h]){var g=f["!cols"][h];if(g.width==null&&g.wpx==null&&g.wch==null)continue;nd(g),g.ods=u;var x=f["!cols"][h].wpx+"px";a.push('  <style:style style:name="co'+u+`" style:family="table-column">
`),a.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+x+`"/>
`),a.push(`  </style:style>
`),++u}}});var m=0;o.SheetNames.map(function(f){return o.Sheets[f]}).forEach(function(f){if(f&&f["!rows"]){for(var h=0;h<f["!rows"].length;++h)if(f["!rows"][h]){f["!rows"][h].ods=m;var g=f["!rows"][h].hpx+"px";a.push('  <style:style style:name="ro'+m+`" style:family="table-row">
`),a.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+g+`"/>
`),a.push(`  </style:style>
`),++m}}}),a.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),a.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),a.push(`  </style:style>
`),a.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),a.push(` </office:automatic-styles>
`)};return function(o,u){var m=[pi],f=Zo({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),h=Zo({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});u.bookType=="fods"?(m.push("<office:document"+f+h+`>
`),m.push(Uh().replace(/office:document-meta/g,"office:meta"))):m.push("<office:document-content"+f+`>
`),r(m,o),m.push(`  <office:body>
`),m.push(`    <office:spreadsheet>
`);for(var g=0;g!=o.SheetNames.length;++g)m.push(n(o.Sheets[o.SheetNames[g]],o,g,u));return m.push(`    </office:spreadsheet>
`),m.push(`  </office:body>
`),u.bookType=="fods"?m.push("</office:document>"):m.push("</office:document-content>"),m.join("")}}();function Tg(i,t){if(t.bookType=="fods")return ih(i,t);var e=W0(),n="",r=[],a=[];return n="mimetype",Xe(e,n,"application/vnd.oasis.opendocument.spreadsheet"),n="content.xml",Xe(e,n,ih(i,t)),r.push([n,"text/xml"]),a.push([n,"ContentFile"]),n="styles.xml",Xe(e,n,IT(i,t)),r.push([n,"text/xml"]),a.push([n,"StylesFile"]),n="meta.xml",Xe(e,n,pi+Uh()),r.push([n,"text/xml"]),a.push([n,"MetadataFile"]),n="manifest.rdf",Xe(e,n,jy(a)),r.push([n,"application/rdf+xml"]),n="META-INF/manifest.xml",Xe(e,n,Vy(r)),e}function Wl(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function MT(i){return typeof TextEncoder<"u"?new TextEncoder().encode(i):Vn(pr(i))}function FT(i,t){e:for(var e=0;e<=i.length-t.length;++e){for(var n=0;n<t.length;++n)if(i[e+n]!=t[n])continue e;return!0}return!1}function Lr(i){var t=i.reduce(function(r,a){return r+a.length},0),e=new Uint8Array(t),n=0;return i.forEach(function(r){e.set(r,n),n+=r.length}),e}function AT(i,t,e){var n=Math.floor(e==0?0:Math.LOG10E*Math.log(Math.abs(e)))+6176-20,r=e/Math.pow(10,n-6176);i[t+15]|=n>>7,i[t+14]|=(n&127)<<1;for(var a=0;r>=1;++a,r/=256)i[t+a]=r&255;i[t+15]|=e>=0?0:128}function es(i,t){var e=t?t[0]:0,n=i[e]&127;e:if(i[e++]>=128&&(n|=(i[e]&127)<<7,i[e++]<128||(n|=(i[e]&127)<<14,i[e++]<128)||(n|=(i[e]&127)<<21,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,28),++e,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,35),++e,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,42),++e,i[e++]<128)))break e;return t&&(t[0]=e),n}function Pt(i){var t=new Uint8Array(7);t[0]=i&127;var e=1;e:if(i>127){if(t[e-1]|=128,t[e]=i>>7&127,++e,i<=16383||(t[e-1]|=128,t[e]=i>>14&127,++e,i<=2097151)||(t[e-1]|=128,t[e]=i>>21&127,++e,i<=268435455)||(t[e-1]|=128,t[e]=i/256>>>21&127,++e,i<=34359738367)||(t[e-1]|=128,t[e]=i/65536>>>21&127,++e,i<=4398046511103))break e;t[e-1]|=128,t[e]=i/16777216>>>21&127,++e}return t.slice(0,e)}function io(i){var t=0,e=i[t]&127;e:if(i[t++]>=128){if(e|=(i[t]&127)<<7,i[t++]<128||(e|=(i[t]&127)<<14,i[t++]<128)||(e|=(i[t]&127)<<21,i[t++]<128))break e;e|=(i[t]&127)<<28}return e}function bi(i){for(var t=[],e=[0];e[0]<i.length;){var n=e[0],r=es(i,e),a=r&7;r=Math.floor(r/8);var o=0,u;if(r==0)break;switch(a){case 0:{for(var m=e[0];i[e[0]++]>=128;);u=i.slice(m,e[0])}break;case 5:o=4,u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 1:o=8,u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 2:o=es(i,e),u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(a," for Field ").concat(r," at offset ").concat(n))}var f={data:u,type:a};t[r]==null?t[r]=[f]:t[r].push(f)}return t}function Ii(i){var t=[];return i.forEach(function(e,n){e.forEach(function(r){r.data&&(t.push(Pt(n*8+r.type)),r.type==2&&t.push(Pt(r.data.length)),t.push(r.data))})}),Lr(t)}function Bn(i){for(var t,e=[],n=[0];n[0]<i.length;){var r=es(i,n),a=bi(i.slice(n[0],n[0]+r));n[0]+=r;var o={id:io(a[1][0].data),messages:[]};a[2].forEach(function(u){var m=bi(u.data),f=io(m[3][0].data);o.messages.push({meta:m,data:i.slice(n[0],n[0]+f)}),n[0]+=f}),(t=a[3])!=null&&t[0]&&(o.merge=io(a[3][0].data)>>>0>0),e.push(o)}return e}function Xa(i){var t=[];return i.forEach(function(e){var n=[];n[1]=[{data:Pt(e.id),type:0}],n[2]=[],e.merge!=null&&(n[3]=[{data:Pt(+!!e.merge),type:0}]);var r=[];e.messages.forEach(function(o){r.push(o.data),o.meta[3]=[{type:0,data:Pt(o.data.length)}],n[2].push({data:Ii(o.meta),type:2})});var a=Ii(n);t.push(Pt(a.length)),t.push(a),r.forEach(function(o){return t.push(o)})}),Lr(t)}function OT(i,t){if(i!=0)throw new Error("Unexpected Snappy chunk type ".concat(i));for(var e=[0],n=es(t,e),r=[];e[0]<t.length;){var a=t[e[0]]&3;if(a==0){var o=t[e[0]++]>>2;if(o<60)++o;else{var u=o-59;o=t[e[0]],u>1&&(o|=t[e[0]+1]<<8),u>2&&(o|=t[e[0]+2]<<16),u>3&&(o|=t[e[0]+3]<<24),o>>>=0,o++,e[0]+=u}r.push(t.slice(e[0],e[0]+o)),e[0]+=o;continue}else{var m=0,f=0;if(a==1?(f=(t[e[0]]>>2&7)+4,m=(t[e[0]++]&224)<<3,m|=t[e[0]++]):(f=(t[e[0]++]>>2)+1,a==2?(m=t[e[0]]|t[e[0]+1]<<8,e[0]+=2):(m=(t[e[0]]|t[e[0]+1]<<8|t[e[0]+2]<<16|t[e[0]+3]<<24)>>>0,e[0]+=4)),r=[Lr(r)],m==0)throw new Error("Invalid offset 0");if(m>r[0].length)throw new Error("Invalid offset beyond length");if(f>=m)for(r.push(r[0].slice(-m)),f-=m;f>=r[r.length-1].length;)r.push(r[r.length-1]),f-=r[r.length-1].length;r.push(r[0].slice(-m,-m+f))}}var h=Lr(r);if(h.length!=n)throw new Error("Unexpected length: ".concat(h.length," != ").concat(n));return h}function Ln(i){for(var t=[],e=0;e<i.length;){var n=i[e++],r=i[e]|i[e+1]<<8|i[e+2]<<16;e+=3,t.push(OT(n,i.slice(e,e+r))),e+=r}if(e!==i.length)throw new Error("data is not a valid framed stream!");return Lr(t)}function Ka(i){for(var t=[],e=0;e<i.length;){var n=Math.min(i.length-e,268435455),r=new Uint8Array(4);t.push(r);var a=Pt(n),o=a.length;t.push(a),n<=60?(o++,t.push(new Uint8Array([n-1<<2]))):n<=256?(o+=2,t.push(new Uint8Array([240,n-1&255]))):n<=65536?(o+=3,t.push(new Uint8Array([244,n-1&255,n-1>>8&255]))):n<=16777216?(o+=4,t.push(new Uint8Array([248,n-1&255,n-1>>8&255,n-1>>16&255]))):n<=4294967296&&(o+=5,t.push(new Uint8Array([252,n-1&255,n-1>>8&255,n-1>>16&255,n-1>>>24&255]))),t.push(i.slice(e,e+n)),o+=n,r[0]=0,r[1]=o&255,r[2]=o>>8&255,r[3]=o>>16&255,e+=n}return Lr(t)}function O0(i,t){var e=new Uint8Array(32),n=Wl(e),r=12,a=0;switch(e[0]=5,i.t){case"n":e[1]=2,AT(e,r,i.v),a|=1,r+=16;break;case"b":e[1]=6,n.setFloat64(r,i.v?1:0,!0),a|=2,r+=8;break;case"s":if(t.indexOf(i.v)==-1)throw new Error("Value ".concat(i.v," missing from SST!"));e[1]=3,n.setUint32(r,t.indexOf(i.v),!0),a|=8,r+=4;break;default:throw"unsupported cell type "+i.t}return n.setUint32(8,a,!0),e.slice(0,r)}function D0(i,t){var e=new Uint8Array(32),n=Wl(e),r=12,a=0;switch(e[0]=3,i.t){case"n":e[2]=2,n.setFloat64(r,i.v,!0),a|=32,r+=8;break;case"b":e[2]=6,n.setFloat64(r,i.v?1:0,!0),a|=32,r+=8;break;case"s":if(t.indexOf(i.v)==-1)throw new Error("Value ".concat(i.v," missing from SST!"));e[2]=3,n.setUint32(r,t.indexOf(i.v),!0),a|=16,r+=4;break;default:throw"unsupported cell type "+i.t}return n.setUint32(4,a,!0),e.slice(0,r)}function Or(i){var t=bi(i);return es(t[1][0].data)}function DT(i,t,e){var n,r,a,o;if(!((n=i[6])!=null&&n[0])||!((r=i[7])!=null&&r[0]))throw"Mutation only works on post-BNC storages!";var u=((o=(a=i[8])==null?void 0:a[0])==null?void 0:o.data)&&io(i[8][0].data)>0||!1;if(u)throw"Math only works with normal offsets";for(var m=0,f=Wl(i[7][0].data),h=0,g=[],x=Wl(i[4][0].data),b=0,S=[],v=0;v<t.length;++v){if(t[v]==null){f.setUint16(v*2,65535,!0),x.setUint16(v*2,65535);continue}f.setUint16(v*2,h,!0),x.setUint16(v*2,b,!0);var E,j;switch(typeof t[v]){case"string":E=O0({t:"s",v:t[v]},e),j=D0({t:"s",v:t[v]},e);break;case"number":E=O0({t:"n",v:t[v]},e),j=D0({t:"n",v:t[v]},e);break;case"boolean":E=O0({t:"b",v:t[v]},e),j=D0({t:"b",v:t[v]},e);break;default:throw new Error("Unsupported value "+t[v])}g.push(E),h+=E.length,S.push(j),b+=j.length,++m}for(i[2][0].data=Pt(m);v<i[7][0].data.length/2;++v)f.setUint16(v*2,65535,!0),x.setUint16(v*2,65535,!0);return i[6][0].data=Lr(g),i[3][0].data=Lr(S),m}function RT(i,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var e=i.Sheets[i.SheetNames[0]];i.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var n=_n(e["!ref"]);n.s.r=n.s.c=0;var r=!1;n.e.c>9&&(r=!0,n.e.c=9),n.e.r>49&&(r=!0,n.e.r=49),r&&console.error("The Numbers writer is currently limited to ".concat(fi(n)));var a=Hl(e,{range:n,header:1}),o=["~Sh33tJ5~"];a.forEach(function(L){return L.forEach(function(V){typeof V=="string"&&o.push(V)})});var u={},m=[],f=Ot.read(t.numbers,{type:"base64"});f.FileIndex.map(function(L,V){return[L,f.FullPaths[V]]}).forEach(function(L){var V=L[0],fe=L[1];if(V.type==2&&V.name.match(/\.iwa/)){var Ce=V.content,De=Ln(Ce),we=Bn(De);we.forEach(function(he){m.push(he.id),u[he.id]={deps:[],location:fe,type:io(he.messages[0].meta[1][0].data)}})}}),m.sort(function(L,V){return L-V});var h=m.filter(function(L){return L>1}).map(function(L){return[L,Pt(L)]});f.FileIndex.map(function(L,V){return[L,f.FullPaths[V]]}).forEach(function(L){var V=L[0],fe=L[1];if(V.name.match(/\.iwa/)){var Ce=Bn(Ln(V.content));Ce.forEach(function(De){De.messages.forEach(function(we){h.forEach(function(he){De.messages.some(function(pt){return io(pt.meta[1][0].data)!=11006&&FT(pt.data,he[1])})&&u[he[0]].deps.push(De.id)})})})}});function g(){for(var L=927262;L<2e6;++L)if(!u[L])return L;throw new Error("Too many messages")}for(var x=Ot.find(f,u[1].location),b=Bn(Ln(x.content)),S,v=0;v<b.length;++v){var E=b[v];E.id==1&&(S=E)}var j=Or(bi(S.messages[0].data)[1][0].data);for(x=Ot.find(f,u[j].location),b=Bn(Ln(x.content)),v=0;v<b.length;++v)E=b[v],E.id==j&&(S=E);for(j=Or(bi(S.messages[0].data)[2][0].data),x=Ot.find(f,u[j].location),b=Bn(Ln(x.content)),v=0;v<b.length;++v)E=b[v],E.id==j&&(S=E);for(j=Or(bi(S.messages[0].data)[2][0].data),x=Ot.find(f,u[j].location),b=Bn(Ln(x.content)),v=0;v<b.length;++v)E=b[v],E.id==j&&(S=E);var U=bi(S.messages[0].data);{U[6][0].data=Pt(n.e.r+1),U[7][0].data=Pt(n.e.c+1);var H=Or(U[46][0].data),Y=Ot.find(f,u[H].location),z=Bn(Ln(Y.content));{for(var _e=0;_e<z.length&&z[_e].id!=H;++_e);if(z[_e].id!=H)throw"Bad ColumnRowUIDMapArchive";var W=bi(z[_e].messages[0].data);W[1]=[],W[2]=[],W[3]=[];for(var le=0;le<=n.e.c;++le){var te=[];te[1]=te[2]=[{type:0,data:Pt(le+420690)}],W[1].push({type:2,data:Ii(te)}),W[2].push({type:0,data:Pt(le)}),W[3].push({type:0,data:Pt(le)})}W[4]=[],W[5]=[],W[6]=[];for(var ce=0;ce<=n.e.r;++ce)te=[],te[1]=te[2]=[{type:0,data:Pt(ce+726270)}],W[4].push({type:2,data:Ii(te)}),W[5].push({type:0,data:Pt(ce)}),W[6].push({type:0,data:Pt(ce)});z[_e].messages[0].data=Ii(W)}Y.content=Ka(Xa(z)),Y.size=Y.content.length,delete U[46];var ue=bi(U[4][0].data);{ue[7][0].data=Pt(n.e.r+1);var me=bi(ue[1][0].data),Me=Or(me[2][0].data);Y=Ot.find(f,u[Me].location),z=Bn(Ln(Y.content));{if(z[0].id!=Me)throw"Bad HeaderStorageBucket";var ut=bi(z[0].messages[0].data);for(ce=0;ce<a.length;++ce){var Re=bi(ut[2][0].data);Re[1][0].data=Pt(ce),Re[4][0].data=Pt(a[ce].length),ut[2][ce]={type:ut[2][0].type,data:Ii(Re)}}z[0].messages[0].data=Ii(ut)}Y.content=Ka(Xa(z)),Y.size=Y.content.length;var ye=Or(ue[2][0].data);Y=Ot.find(f,u[ye].location),z=Bn(Ln(Y.content));{if(z[0].id!=ye)throw"Bad HeaderStorageBucket";for(ut=bi(z[0].messages[0].data),le=0;le<=n.e.c;++le)Re=bi(ut[2][0].data),Re[1][0].data=Pt(le),Re[4][0].data=Pt(n.e.r+1),ut[2][le]={type:ut[2][0].type,data:Ii(Re)};z[0].messages[0].data=Ii(ut)}Y.content=Ka(Xa(z)),Y.size=Y.content.length;var Ee=Or(ue[4][0].data);(function(){for(var L=Ot.find(f,u[Ee].location),V=Bn(Ln(L.content)),fe,Ce=0;Ce<V.length;++Ce){var De=V[Ce];De.id==Ee&&(fe=De)}var we=bi(fe.messages[0].data);{we[3]=[];var he=[];o.forEach(function(Ti,ht){he[1]=[{type:0,data:Pt(ht)}],he[2]=[{type:0,data:Pt(1)}],he[3]=[{type:2,data:MT(Ti)}],we[3].push({type:2,data:Ii(he)})})}fe.messages[0].data=Ii(we);var pt=Xa(V),st=Ka(pt);L.content=st,L.size=L.content.length})();var ke=bi(ue[3][0].data);{var Ue=ke[1][0];delete ke[2];var it=bi(Ue.data);{var Ut=Or(it[2][0].data);(function(){for(var L=Ot.find(f,u[Ut].location),V=Bn(Ln(L.content)),fe,Ce=0;Ce<V.length;++Ce){var De=V[Ce];De.id==Ut&&(fe=De)}var we=bi(fe.messages[0].data);{delete we[6],delete ke[7];var he=new Uint8Array(we[5][0].data);we[5]=[];for(var pt=0,st=0;st<=n.e.r;++st){var Ti=bi(he);pt+=DT(Ti,a[st],o),Ti[1][0].data=Pt(st),we[5].push({data:Ii(Ti),type:2})}we[1]=[{type:0,data:Pt(n.e.c+1)}],we[2]=[{type:0,data:Pt(n.e.r+1)}],we[3]=[{type:0,data:Pt(pt)}],we[4]=[{type:0,data:Pt(n.e.r+1)}]}fe.messages[0].data=Ii(we);var ht=Xa(V),Dn=Ka(ht);L.content=Dn,L.size=L.content.length})()}Ue.data=Ii(it)}ue[3][0].data=Ii(ke)}U[4][0].data=Ii(ue)}S.messages[0].data=Ii(U);var B=Xa(b),re=Ka(B);return x.content=re,x.size=x.content.length,f}function NT(i){return function(e){for(var n=0;n!=i.length;++n){var r=i[n];e[r[0]]===void 0&&(e[r[0]]=r[1]),r[2]==="n"&&(e[r[0]]=Number(e[r[0]]))}}}function ld(i){NT([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(i)}function BT(i,t){return t.bookType=="ods"?Tg(i,t):t.bookType=="numbers"?RT(i,t):t.bookType=="xlsb"?LT(i,t):VT(i,t)}function LT(i,t){Qa=1024,i&&!i.SSF&&(i.SSF=tn(ni)),i&&i.SSF&&(Gl(),zl(i.SSF),t.revssf=ql(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Xo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var e=t.bookType=="xlsb"?"bin":"xml",n=lg.indexOf(t.bookType)>-1,r=Bh();ld(t=t||{});var a=W0(),o="",u=0;if(t.cellXfs=[],Vr(t.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={}),o="docProps/core.xml",Xe(a,o,jh(i.Props,t)),r.coreprops.push(o),kt(t.rels,2,o,vt.CORE_PROPS),o="docProps/app.xml",!(i.Props&&i.Props.SheetNames))if(!i.Workbook||!i.Workbook.Sheets)i.Props.SheetNames=i.SheetNames;else{for(var m=[],f=0;f<i.SheetNames.length;++f)(i.Workbook.Sheets[f]||{}).Hidden!=2&&m.push(i.SheetNames[f]);i.Props.SheetNames=m}for(i.Props.Worksheets=i.Props.SheetNames.length,Xe(a,o,Hh(i.Props,t)),r.extprops.push(o),kt(t.rels,3,o,vt.EXT_PROPS),i.Custprops!==i.Props&&Di(i.Custprops||{}).length>0&&(o="docProps/custom.xml",Xe(a,o,$h(i.Custprops,t)),r.custprops.push(o),kt(t.rels,4,o,vt.CUST_PROPS)),u=1;u<=i.SheetNames.length;++u){var h={"!id":{}},g=i.Sheets[i.SheetNames[u-1]],x=(g||{})["!type"]||"sheet";switch(x){case"chart":default:o="xl/worksheets/sheet"+u+"."+e,Xe(a,o,j3(u-1,o,t,i,h)),r.sheets.push(o),kt(t.wbrels,-1,"worksheets/sheet"+u+"."+e,vt.WS[0])}if(g){var b=g["!comments"],S=!1,v="";b&&b.length>0&&(v="xl/comments"+u+"."+e,Xe(a,v,$3(b,v,t)),r.comments.push(v),kt(h,-1,"../comments"+u+"."+e,vt.CMNT),S=!0),g["!legacy"]&&S&&Xe(a,"xl/drawings/vmlDrawing"+u+".vml",og(u,g["!comments"])),delete g["!comments"],delete g["!legacy"]}h["!id"].rId1&&Xe(a,Vh(o),eo(h))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+e,Xe(a,o,H3(t.Strings,o,t)),r.strs.push(o),kt(t.wbrels,-1,"sharedStrings."+e,vt.SST)),o="xl/workbook."+e,Xe(a,o,U3(i,o,t)),r.workbooks.push(o),kt(t.rels,1,o,vt.WB),o="xl/theme/theme1.xml",Xe(a,o,rg(i.Themes,t)),r.themes.push(o),kt(t.wbrels,-1,"theme/theme1.xml",vt.THEME),o="xl/styles."+e,Xe(a,o,W3(i,o,t)),r.styles.push(o),kt(t.wbrels,-1,"styles."+e,vt.STY),i.vbaraw&&n&&(o="xl/vbaProject.bin",Xe(a,o,i.vbaraw),r.vba.push(o),kt(t.wbrels,-1,"vbaProject.bin",vt.VBA)),o="xl/metadata."+e,Xe(a,o,z3(o)),r.metadata.push(o),kt(t.wbrels,-1,"metadata."+e,vt.XLMETA),Xe(a,"[Content_Types].xml",Lh(r,t)),Xe(a,"_rels/.rels",eo(t.rels)),Xe(a,"xl/_rels/workbook."+e+".rels",eo(t.wbrels)),delete t.revssf,delete t.ssf,a}function VT(i,t){Qa=1024,i&&!i.SSF&&(i.SSF=tn(ni)),i&&i.SSF&&(Gl(),zl(i.SSF),t.revssf=ql(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Xo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var e="xml",n=lg.indexOf(t.bookType)>-1,r=Bh();ld(t=t||{});var a=W0(),o="",u=0;if(t.cellXfs=[],Vr(t.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={}),o="docProps/core.xml",Xe(a,o,jh(i.Props,t)),r.coreprops.push(o),kt(t.rels,2,o,vt.CORE_PROPS),o="docProps/app.xml",!(i.Props&&i.Props.SheetNames))if(!i.Workbook||!i.Workbook.Sheets)i.Props.SheetNames=i.SheetNames;else{for(var m=[],f=0;f<i.SheetNames.length;++f)(i.Workbook.Sheets[f]||{}).Hidden!=2&&m.push(i.SheetNames[f]);i.Props.SheetNames=m}i.Props.Worksheets=i.Props.SheetNames.length,Xe(a,o,Hh(i.Props,t)),r.extprops.push(o),kt(t.rels,3,o,vt.EXT_PROPS),i.Custprops!==i.Props&&Di(i.Custprops||{}).length>0&&(o="docProps/custom.xml",Xe(a,o,$h(i.Custprops,t)),r.custprops.push(o),kt(t.rels,4,o,vt.CUST_PROPS));var h=["SheetJ5"];for(t.tcid=0,u=1;u<=i.SheetNames.length;++u){var g={"!id":{}},x=i.Sheets[i.SheetNames[u-1]],b=(x||{})["!type"]||"sheet";switch(b){case"chart":default:o="xl/worksheets/sheet"+u+"."+e,Xe(a,o,_g(u-1,t,i,g)),r.sheets.push(o),kt(t.wbrels,-1,"worksheets/sheet"+u+"."+e,vt.WS[0])}if(x){var S=x["!comments"],v=!1,E="";if(S&&S.length>0){var j=!1;S.forEach(function(U){U[1].forEach(function(H){H.T==!0&&(j=!0)})}),j&&(E="xl/threadedComments/threadedComment"+u+"."+e,Xe(a,E,gS(S,h,t)),r.threadedcomments.push(E),kt(g,-1,"../threadedComments/threadedComment"+u+"."+e,vt.TCMNT)),E="xl/comments"+u+"."+e,Xe(a,E,sg(S,t)),r.comments.push(E),kt(g,-1,"../comments"+u+"."+e,vt.CMNT),v=!0}x["!legacy"]&&v&&Xe(a,"xl/drawings/vmlDrawing"+u+".vml",og(u,x["!comments"])),delete x["!comments"],delete x["!legacy"]}g["!id"].rId1&&Xe(a,Vh(o),eo(g))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+e,Xe(a,o,Jh(t.Strings,t)),r.strs.push(o),kt(t.wbrels,-1,"sharedStrings."+e,vt.SST)),o="xl/workbook."+e,Xe(a,o,bg(i,t)),r.workbooks.push(o),kt(t.rels,1,o,vt.WB),o="xl/theme/theme1.xml",Xe(a,o,rg(i.Themes,t)),r.themes.push(o),kt(t.wbrels,-1,"theme/theme1.xml",vt.THEME),o="xl/styles."+e,Xe(a,o,ig(i,t)),r.styles.push(o),kt(t.wbrels,-1,"styles."+e,vt.STY),i.vbaraw&&n&&(o="xl/vbaProject.bin",Xe(a,o,i.vbaraw),r.vba.push(o),kt(t.wbrels,-1,"vbaProject.bin",vt.VBA)),o="xl/metadata."+e,Xe(a,o,ag()),r.metadata.push(o),kt(t.wbrels,-1,"metadata."+e,vt.XLMETA),h.length>1&&(o="xl/persons/person.xml",Xe(a,o,_S(h,t)),r.people.push(o),kt(t.wbrels,-1,"persons/person.xml",vt.PEOPLE)),Xe(a,"[Content_Types].xml",Lh(r,t)),Xe(a,"_rels/.rels",eo(t.rels)),Xe(a,"xl/_rels/workbook."+e+".rels",eo(t.wbrels)),delete t.revssf,delete t.ssf,a}function UT(i,t){var e="";switch((t||{}).type||"base64"){case"buffer":return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]];case"base64":e=vr(i.slice(0,12));break;case"binary":e=i;break;case"array":return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4),e.charCodeAt(5),e.charCodeAt(6),e.charCodeAt(7)]}function Pg(i,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return ns(t.file,Ot.write(i,{type:Ct?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return Ot.write(i,t)}function jT(i,t){var e=tn(t||{}),n=BT(i,e);return WT(n,e)}function WT(i,t){var e={},n=Ct?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(e.compression="DEFLATE"),t.password)e.type=n;else switch(t.type){case"base64":e.type="base64";break;case"binary":e.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":e.type=n;break;default:throw new Error("Unrecognized type "+t.type)}var r=i.FullPaths?Ot.write(i,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[e.type]||e.type,compression:!!t.compression}):i.generate(e);if(typeof Deno<"u"&&typeof r=="string"){if(t.type=="binary"||t.type=="base64")return r;r=new Uint8Array($l(r))}return t.password&&typeof encrypt_agile<"u"?Pg(encrypt_agile(r,t.password),t):t.type==="file"?ns(t.file,r):t.type=="string"?$o(r):r}function HT(i,t){var e=t||{},n=aT(i,e);return Pg(n,e)}function ar(i,t,e){e||(e="");var n=e+i;switch(t.type){case"base64":return Qo(pr(n));case"binary":return pr(n);case"string":return i;case"file":return ns(t.file,n,"utf8");case"buffer":return Ct?br(n,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(n):ar(n,{type:"binary"}).split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function $T(i,t){switch(t.type){case"base64":return Qo(i);case"binary":return i;case"string":return i;case"file":return ns(t.file,i,"binary");case"buffer":return Ct?br(i,"binary"):i.split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Ml(i,t){switch(t.type){case"string":case"base64":case"binary":for(var e="",n=0;n<i.length;++n)e+=String.fromCharCode(i[n]);return t.type=="base64"?Qo(e):t.type=="string"?$o(e):e;case"file":return ns(t.file,i);case"buffer":return i;default:throw new Error("Unrecognized type "+t.type)}}function kg(i,t){gb(),I3(i);var e=tn(t||{});if(e.cellStyles&&(e.cellNF=!0,e.sheetStubs=!0),e.type=="array"){e.type="binary";var n=kg(i,e);return e.type="array",$l(n)}var r=0;if(e.sheet&&(typeof e.sheet=="number"?r=e.sheet:r=i.SheetNames.indexOf(e.sheet),!i.SheetNames[r]))throw new Error("Sheet not found: "+e.sheet+" : "+typeof e.sheet);switch(e.bookType||"xlsb"){case"xml":case"xlml":return ar(nT(i,e),e);case"slk":case"sylk":return ar(TC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"htm":case"html":return ar(Sg(i.Sheets[i.SheetNames[r]],e),e);case"txt":return $T(Ig(i.Sheets[i.SheetNames[r]],e),e);case"csv":return ar(cd(i.Sheets[i.SheetNames[r]],e),e,"\uFEFF");case"dif":return ar(PC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"dbf":return Ml(EC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"prn":return ar(kC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"rtf":return ar(RC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"eth":return ar(Qh.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"fods":return ar(Tg(i,e),e);case"wk1":return Ml(Kp.sheet_to_wk1(i.Sheets[i.SheetNames[r]],e),e);case"wk3":return Ml(Kp.book_to_wk3(i,e),e);case"biff2":e.biff||(e.biff=2);case"biff3":e.biff||(e.biff=3);case"biff4":return e.biff||(e.biff=4),Ml(Cg(i,e),e);case"biff5":e.biff||(e.biff=5);case"biff8":case"xla":case"xls":return e.biff||(e.biff=8),HT(i,e);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return jT(i,e);default:throw new Error("Unrecognized bookType |"+e.bookType+"|")}}function zT(i){if(!i.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},e=i.file.slice(i.file.lastIndexOf(".")).toLowerCase();e.match(/^\.[a-z]+$/)&&(i.bookType=e.slice(1)),i.bookType=t[i.bookType]||i.bookType}}function Zl(i,t,e){var n=e||{};return n.type="file",n.file=t,zT(n),kg(i,n)}function GT(i,t,e,n,r,a,o,u){var m=Oi(e),f=u.defval,h=u.raw||!Object.prototype.hasOwnProperty.call(u,"raw"),g=!0,x=r===1?[]:{};if(r!==1)if(Object.defineProperty)try{Object.defineProperty(x,"__rowNum__",{value:e,enumerable:!1})}catch{x.__rowNum__=e}else x.__rowNum__=e;if(!o||i[e])for(var b=t.s.c;b<=t.e.c;++b){var S=o?i[e][b]:i[n[b]+m];if(S===void 0||S.t===void 0){if(f===void 0)continue;a[b]!=null&&(x[a[b]]=f);continue}var v=S.v;switch(S.t){case"z":if(v==null)break;continue;case"e":v=v==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+S.t)}if(a[b]!=null){if(v==null)if(S.t=="e"&&v===null)x[a[b]]=null;else if(f!==void 0)x[a[b]]=f;else if(h&&v===null)x[a[b]]=null;else continue;else x[a[b]]=h&&(S.t!=="n"||S.t==="n"&&u.rawNumbers!==!1)?v:xr(S,v,u);v!=null&&(g=!1)}}return{row:x,isempty:g}}function Hl(i,t){if(i==null||i["!ref"]==null)return[];var e={t:"n",v:0},n=0,r=1,a=[],o=0,u="",m={s:{r:0,c:0},e:{r:0,c:0}},f=t||{},h=f.range!=null?f.range:i["!ref"];switch(f.header===1?n=1:f.header==="A"?n=2:Array.isArray(f.header)?n=3:f.header==null&&(n=0),typeof h){case"string":m=$t(h);break;case"number":m=$t(i["!ref"]),m.s.r=h;break;default:m=h}n>0&&(r=0);var g=Oi(m.s.r),x=[],b=[],S=0,v=0,E=Array.isArray(i),j=m.s.r,U=0,H={};E&&!i[j]&&(i[j]=[]);var Y=f.skipHidden&&i["!cols"]||[],z=f.skipHidden&&i["!rows"]||[];for(U=m.s.c;U<=m.e.c;++U)if(!(Y[U]||{}).hidden)switch(x[U]=Li(U),e=E?i[j][U]:i[x[U]+g],n){case 1:a[U]=U-m.s.c;break;case 2:a[U]=x[U];break;case 3:a[U]=f.header[U-m.s.c];break;default:if(e==null&&(e={w:"__EMPTY",t:"s"}),u=o=xr(e,null,f),v=H[o]||0,!v)H[o]=1;else{do u=o+"_"+v++;while(H[u]);H[o]=v,H[u]=1}a[U]=u}for(j=m.s.r+r;j<=m.e.r;++j)if(!(z[j]||{}).hidden){var _e=GT(i,m,j,x,n,a,E,f);(_e.isempty===!1||(n===1?f.blankrows!==!1:f.blankrows))&&(b[S++]=_e.row)}return b.length=S,b}var nh=/"/g;function qT(i,t,e,n,r,a,o,u){for(var m=!0,f=[],h="",g=Oi(e),x=t.s.c;x<=t.e.c;++x)if(n[x]){var b=u.dense?(i[e]||[])[x]:i[n[x]+g];if(b==null)h="";else if(b.v!=null){m=!1,h=""+(u.rawNumbers&&b.t=="n"?b.v:xr(b,null,u));for(var S=0,v=0;S!==h.length;++S)if((v=h.charCodeAt(S))===r||v===a||v===34||u.forceQuotes){h='"'+h.replace(nh,'""')+'"';break}h=="ID"&&(h='"ID"')}else b.f!=null&&!b.F?(m=!1,h="="+b.f,h.indexOf(",")>=0&&(h='"'+h.replace(nh,'""')+'"')):h="";f.push(h)}return u.blankrows===!1&&m?null:f.join(o)}function cd(i,t){var e=[],n=t??{};if(i==null||i["!ref"]==null)return"";var r=$t(i["!ref"]),a=n.FS!==void 0?n.FS:",",o=a.charCodeAt(0),u=n.RS!==void 0?n.RS:`
`,m=u.charCodeAt(0),f=new RegExp((a=="|"?"\\|":a)+"+$"),h="",g=[];n.dense=Array.isArray(i);for(var x=n.skipHidden&&i["!cols"]||[],b=n.skipHidden&&i["!rows"]||[],S=r.s.c;S<=r.e.c;++S)(x[S]||{}).hidden||(g[S]=Li(S));for(var v=0,E=r.s.r;E<=r.e.r;++E)(b[E]||{}).hidden||(h=qT(i,r,E,g,o,m,a,n),h!=null&&(n.strip&&(h=h.replace(f,"")),(h||n.blankrows!==!1)&&e.push((v++?u:"")+h)));return delete n.dense,e.join("")}function Ig(i,t){t||(t={}),t.FS="	",t.RS=`
`;var e=cd(i,t);if(typeof Rt>"u"||t.type=="string")return e;var n=Rt.utils.encode(1200,e,"str");return"\xFF\xFE"+n}function XT(i){var t="",e,n="";if(i==null||i["!ref"]==null)return[];var r=$t(i["!ref"]),a="",o=[],u,m=[],f=Array.isArray(i);for(u=r.s.c;u<=r.e.c;++u)o[u]=Li(u);for(var h=r.s.r;h<=r.e.r;++h)for(a=Oi(h),u=r.s.c;u<=r.e.c;++u)if(t=o[u]+a,e=f?(i[h]||[])[u]:i[t],n="",e!==void 0){if(e.F!=null){if(t=e.F,!e.f)continue;n=e.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(e.f!=null)n=e.f;else{if(e.t=="z")continue;if(e.t=="n"&&e.v!=null)n=""+e.v;else if(e.t=="b")n=e.v?"TRUE":"FALSE";else if(e.w!==void 0)n="'"+e.w;else{if(e.v===void 0)continue;e.t=="s"?n="'"+e.v:n=""+e.v}}m[m.length]=t+"="+n}return m}function Mg(i,t,e){var n=e||{},r=+!n.skipHeader,a=i||{},o=0,u=0;if(a&&n.origin!=null)if(typeof n.origin=="number")o=n.origin;else{var m=typeof n.origin=="string"?wi(n.origin):n.origin;o=m.r,u=m.c}var f,h={s:{c:0,r:0},e:{c:u,r:o+t.length-1+r}};if(a["!ref"]){var g=$t(a["!ref"]);h.e.c=Math.max(h.e.c,g.e.c),h.e.r=Math.max(h.e.r,g.e.r),o==-1&&(o=g.e.r+1,h.e.r=o+t.length-1+r)}else o==-1&&(o=0,h.e.r=t.length-1+r);var x=n.header||[],b=0;t.forEach(function(v,E){Di(v).forEach(function(j){(b=x.indexOf(j))==-1&&(x[b=x.length]=j);var U=v[j],H="z",Y="",z=Mt({c:u+b,r:o+E+r});f=ts(a,z),U&&typeof U=="object"&&!(U instanceof Date)?a[z]=U:(typeof U=="number"?H="n":typeof U=="boolean"?H="b":typeof U=="string"?H="s":U instanceof Date?(H="d",n.cellDates||(H="n",U=en(U)),Y=n.dateNF||ni[14]):U===null&&n.nullError&&(H="e",U=0),f?(f.t=H,f.v=U,delete f.w,delete f.R,Y&&(f.z=Y)):a[z]=f={t:H,v:U},Y&&(f.z=Y))})}),h.e.c=Math.max(h.e.c,u+x.length-1);var S=Oi(o);if(r)for(b=0;b<x.length;++b)a[Li(b+u)+S]={t:"s",v:x[b]};return a["!ref"]=fi(h),a}function KT(i,t){return Mg(null,i,t)}function ts(i,t,e){if(typeof t=="string"){if(Array.isArray(i)){var n=wi(t);return i[n.r]||(i[n.r]=[]),i[n.r][n.c]||(i[n.r][n.c]={t:"z"})}return i[t]||(i[t]={t:"z"})}return typeof t!="number"?ts(i,Mt(t)):ts(i,Mt({r:t,c:e||0}))}function YT(i,t){if(typeof t=="number"){if(t>=0&&i.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var e=i.SheetNames.indexOf(t);if(e>-1)return e;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function QT(){return{SheetNames:[],Sheets:{}}}function JT(i,t,e,n){var r=1;if(!e)for(;r<=65535&&i.SheetNames.indexOf(e="Sheet"+r)!=-1;++r,e=void 0);if(!e||i.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&i.SheetNames.indexOf(e)>=0){var a=e.match(/(^.*?)(\d+)$/);r=a&&+a[2]||0;var o=a&&a[1]||e;for(++r;r<=65535&&i.SheetNames.indexOf(e=o+r)!=-1;++r);}if(xg(e),i.SheetNames.indexOf(e)>=0)throw new Error("Worksheet with name |"+e+"| already exists!");return i.SheetNames.push(e),i.Sheets[e]=t,e}function ZT(i,t,e){i.Workbook||(i.Workbook={}),i.Workbook.Sheets||(i.Workbook.Sheets=[]);var n=YT(i,t);switch(i.Workbook.Sheets[n]||(i.Workbook.Sheets[n]={}),e){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+e)}i.Workbook.Sheets[n].Hidden=e}function eP(i,t){return i.z=t,i}function Fg(i,t,e){return t?(i.l={Target:t},e&&(i.l.Tooltip=e)):delete i.l,i}function tP(i,t,e){return Fg(i,"#"+t,e)}function iP(i,t,e){i.c||(i.c=[]),i.c.push({t,a:e||"SheetJS"})}function nP(i,t,e,n){for(var r=typeof t!="string"?t:$t(t),a=typeof t=="string"?t:fi(t),o=r.s.r;o<=r.e.r;++o)for(var u=r.s.c;u<=r.e.c;++u){var m=ts(i,o,u);m.t="n",m.F=a,delete m.v,o==r.s.r&&u==r.s.c&&(m.f=e,n&&(m.D=!0))}return i}var nn={encode_col:Li,encode_row:Oi,encode_cell:Mt,encode_range:fi,decode_col:J0,decode_row:Q0,split_cell:vy,decode_cell:wi,decode_range:_n,format_cell:xr,sheet_add_aoa:Fh,sheet_add_json:Mg,sheet_add_dom:wg,aoa_to_sheet:so,json_to_sheet:KT,table_to_sheet:Eg,table_to_book:PT,sheet_to_csv:cd,sheet_to_txt:Ig,sheet_to_json:Hl,sheet_to_html:Sg,sheet_to_formulae:XT,sheet_to_row_object_array:Hl,sheet_get_cell:ts,book_new:QT,book_append_sheet:JT,book_set_sheet_visibility:ZT,cell_set_number_format:eP,cell_set_hyperlink:Fg,cell_set_internal_link:tP,cell_add_comment:iP,sheet_set_array_formula:nP,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};var Z7=Ko.version;var ec=class i{constructor(t){this.http=t}apiUrl=`${He.apiUrl}/surtirFarmacias`;obtenerPendientes(t){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!1})}surtirFarmacia(t,e){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!0,detalles:e})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};function aP(i,t){if(i&1&&(l(0,"option",6),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function oP(i,t){if(i&1){let e=ae();l(0,"div",13)(1,"button",18),w("click",function(){P(e);let r=_(2);return k(r.imprimirPrevia())}),d(2," Imprimir previa "),s()()}}function sP(i,t){if(i&1){let e=ae();l(0,"div",13)(1,"button",14),w("click",function(){P(e);let r=_();return k(r.omitirTodos())}),d(2,"Omitir todos"),s(),l(3,"button",15),w("click",function(){P(e);let r=_();return k(r.quitarOmisiones())}),d(4,"Quitar omisiones"),s(),l(5,"span",16),d(6," Omitidos: "),l(7,"strong"),d(8),s(),d(9),s(),N(10,oP,3,0,"div",9),l(11,"button",17),w("click",function(){P(e);let r=_();return k(r.exportarExcel())}),d(12," Exportar a Excel "),s()()}if(i&2){let e=_();c(8),T(e.totalOmitidos),c(),R(" / ",e.rows.length," "),c(),p("ngIf",e.pendientes.length),c(),p("disabled",!e.rows.length)}}function lP(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td",21)(2,"input",22),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.omitir,r)||(a.omitir=r),k(r)}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),s(),l(15,"td",23),d(16),s(),l(17,"td"),d(18),s()()}if(i&2){let e=t.$implicit;Be("omitido",e.omitir),c(2),Qr("name","omitir_",e.producto,""),J("ngModel",e.omitir),Ye("aria-label","Omitir "+e.nombre),c(2),T(e.nombre),c(2),T(e.codigoBarras),c(2),T(e.categoria),c(2),T(e.existenciaActual),c(2),T(e.stockMin),c(2),T(e.stockMax),c(2),T(e.falta),c(2),T(e.disponibleEnAlmacen)}}function cP(i,t){if(i&1&&(l(0,"table",19)(1,"thead")(2,"tr")(3,"th"),d(4,"Omit"),s(),l(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3d. Barras"),s(),l(9,"th"),d(10,"Categor\xEDa"),s(),l(11,"th"),d(12,"Existencia"),s(),l(13,"th"),d(14,"Stock M\xEDnimo"),s(),l(15,"th"),d(16,"Stock M\xE1ximo"),s(),l(17,"th"),d(18,"Cantidad a Surtir"),s(),l(19,"th"),d(20,"Disponible Almac\xE9n"),s()()(),l(21,"tbody"),N(22,lP,19,14,"tr",20),s()()),i&2){let e=_();c(22),p("ngForOf",e.pagedRows)("ngForTrackBy",e.trackByProd)}}function dP(i,t){if(i&1){let e=ae();l(0,"div",24)(1,"button",25),w("click",function(){P(e);let r=_();return k(r.goFirst())}),y(2,"i",26),s(),l(3,"button",27),w("click",function(){P(e);let r=_();return k(r.goPrev())}),y(4,"i",28),s(),d(5),l(6,"button",29),w("click",function(){P(e);let r=_();return k(r.goNext())}),y(7,"i",30),s(),l(8,"button",31),w("click",function(){P(e);let r=_();return k(r.goLast())}),y(9,"i",32),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),yn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}function uP(i,t){if(i&1){let e=ae();l(0,"div",33)(1,"button",34),w("click",function(){P(e);let r=_();return k(r.onCancelar())}),d(2,"Cancelar"),s(),l(3,"button",35),w("click",function(){P(e);let r=_();return k(r.onSurtir())}),d(4," Surtir "),s()()}if(i&2){let e=_();c(3),p("disabled",e.rows.length>0&&e.totalOmitidos===e.rows.length)}}var tc=class i{constructor(t,e,n){this.fb=t;this.farmaciaService=e;this.surtidoService=n;this.form=this.fb.group({farmaciaId:[null,Pe.required]})}form;farmacias=[];pendientes=[];cargando=!1;rows=[];page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}trackByProd=(t,e)=>e.producto||e.codigoBarras;ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe(t=>{this.farmacias=t})}toggleFarmacia(t){let e=this.form.get("farmaciaId");t?e.disable():e.enable()}onAceptar(){if(this.form.invalid)return;this.cargando=!0;let t=this.form.value.farmaciaId;this.surtidoService.obtenerPendientes(t).subscribe({next:({pendientes:e})=>{if(this.pendientes=(e||[]).map(n=>Wt(Ke({},n),{omitir:!1})),console.log("Pendientes",e),this.rows=this.pendientes,this.resetPagination(),this.cargando=!1,this.rows.length===0){Wn.default.fire({icon:"info",title:"Sin pendientes",html:"No hay productos con existencia <= stock m\xEDnimo",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1});return}this.toggleFarmacia(!0)},error:e=>{console.error(e),Wn.default.fire("Error","No se pudieron cargar los productos.","error"),this.cargando=!1}})}get totalOmitidos(){return this.rows.filter(t=>t.omitir).length}omitirTodos(){this.rows.forEach(t=>t.omitir=!0)}quitarOmisiones(){this.rows.forEach(t=>t.omitir=!1)}onSurtir(){let t=this.form.value.farmaciaId,e=this.farmacias.find(r=>r._id===t)?.nombre||"",n=this.rows.map(r=>({producto:r.producto,omitir:!!r.omitir}));Wn.default.fire({icon:"question",title:"Confirmar surtido",html:`
      Se surtir\xE1 a la farmacia <strong>${e}</strong> respetando las omisiones marcadas.<br>
      <small>Omitidos: ${this.totalOmitidos} / ${this.rows.length}</small>
    `,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(r=>{if(!r.isConfirmed){this.toggleFarmacia(!1);return}Wn.default.fire({title:"Surtido en progreso...",html:"Generando hoja y actualizando inventarios.",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>Wn.default.showLoading()}),this.surtidoService.surtirFarmacia(t,n).pipe(Em(()=>{})).subscribe({next:a=>{Wn.default.close(),Wn.default.fire({icon:"success",title:"Surtido completado",html:"\xBFDeseas imprimir la hoja de surtido?",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(o=>{o.isConfirmed&&a?.surtido&&this.imprimirReal(a.surtido),this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)})},error:a=>{console.error(a),Wn.default.close();let o=a?.error?.detalle||a?.error?.mensaje||"No se pudo surtir la farmacia.";Wn.default.fire("Aviso",o,"warning"),this.toggleFarmacia(!1)}})})}onCancelar(){this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)}fmtFecha(t=new Date){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())} ${e(t.getHours())}:${e(t.getMinutes())}`}buildHTMLPrevia(){let t=this.form.value.farmaciaId,e=this.farmacias.find(a=>a._id===t)?.nombre||"",n=this.fmtFecha(),r=this.rows.map(a=>{let o=a.omitir?' class="omitida"':"",u=a.omitir?'<span class="chip chip-omit">OMITIDO</span>':"";return`
      <tr${o}>
        <td>${a.codigoBarras||""}</td>
        <td>${a.nombre||""} ${u}</td>
        <td style="text-align:right">${a.existenciaActual??0}</td>
        <td style="text-align:right">${a.stockMin??0}</td>
        <td style="text-align:right">${a.stockMax??0}</td>
        <td style="text-align:right">${a.falta??0}</td>
        <td style="text-align:right">${a.disponibleEnAlmacen??0}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Previa</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  .omitida { color: #777; }
  .chip { display:inline-block; border:1px solid #aaa; padding:1px 5px; border-radius:8px; font-size:10px; margin-left:6px; }
  .chip-omit { border-color:#b55; color:#b55; }
  .leyenda { font-size:10px; color:#555; margin-top:8px; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Previa)</p>
    <p class="sub">${e?`Farmacia: <b>${e}</b>`:""}</p>
  </div>

  <div class="meta">
    Fecha: <b>${n}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:70px; text-align:right">Exist.</th>
        <th style="width:70px; text-align:right">Stock Min</th>
        <th style="width:70px; text-align:right">Stock Max</th>
        <th style="width:90px; text-align:right">Cant. a Surtir</th>
        <th style="width:100px; text-align:right">Disp. Almac\xE9n</th>
      </tr>
    </thead>
    <tbody>
      ${r}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="7">Registros: ${this.rows.length} \u2014 Omitidos: ${this.totalOmitidos}</td>
      </tr>
    </tfoot>
  </table>
  <p class="leyenda">Esta es una previsualizaci\xF3n. La hoja real puede variar seg\xFAn disponibilidad por lotes.</p>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}buildHTMLReal(t){let e=this.form.value.farmaciaId,n=this.farmacias.find(o=>o._id===e)?.nombre||"",r=t?.fechaSurtido?this.fmtFecha(new Date(t.fechaSurtido)):this.fmtFecha(),a=(t?.items||[]).map(o=>{let u=o?.producto?.nombre||"",m=o?.producto?.codigoBarras||"",f=o?.lote||"SIN-LOTE",h=o?.cantidad??0,g=o?.producto?.categoria||"-",x=o?.producto?.ubicacion||"-";return`
      <tr>
        <td>${m}</td>
        <td>${u}</td>
        <td>${f}</td>
        <td style="text-align:right">${h}</td>
        <td>${g}</td>
        <td>${x}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Final</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Real)</p>
    <p class="sub">${n?`Farmacia: <b>${n}</b>`:""}</p>
  </div>

  <div class="meta">
    Surtido ID: <b>${t?._id||"-"}</b><br>
    Fecha surtido: <b>${r}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:90px">Lote</th>
        <th style="width:80px; text-align:right">Cantidad</th>
        <th style="width:100px">Categoria</th>
        <th style="width:100px">Ubicacion</th>
      </tr>
    </thead>
    <tbody>
      ${a||'<tr><td colspan="6">Sin items</td></tr>'}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="6">Productos surtidos: ${(t?.items||[]).length}</td>
      </tr>
    </tfoot>
  </table>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}printHTML(t){let e=window.open("","_blank","width=900,height=700");e&&(e.document.open(),e.document.write(t),e.document.close(),setTimeout(()=>e.focus(),50))}imprimirPrevia(){if(!this.rows.length)return;let t=this.buildHTMLPrevia();this.printHTML(t)}imprimirReal(t){let e=this.buildHTMLReal(t);this.printHTML(e)}exportarExcel(){if(!this.rows?.length){Wn.default.fire("Aviso","No hay datos para exportar","info");return}let t=this.form.value.farmaciaId,e=this.farmacias.find(v=>v._id===t)?.nombre||"",n=new Date().toISOString().slice(0,19).replace("T"," "),r=this.rows.map(v=>({"C\xF3digo de barras":v.codigoBarras||"",Producto:v.nombre||"",Categor\u00EDa:v.categoria||"",Ubicaci\u00F3n:v.ubicacion||"","Existencia actual":v.existenciaActual??0,"Stock M\xEDn":v.stockMin??0,"Stock M\xE1x":v.stockMax??0,Falta:v.falta??0,"Disponible en almac\xE9n":v.disponibleEnAlmacen??0,Omitir:v.omitir?"S\xED":"No"})),a=nn.aoa_to_sheet([]);nn.sheet_add_aoa(a,[["Hoja de Surtido"],[`Farmacia: ${e}`],[`Generado: ${n}`],[""]],{origin:"A1"}),nn.sheet_add_json(a,r,{origin:"A5",skipHeader:!1}),a["!cols"]=[{wch:16},{wch:40},{wch:18},{wch:14},{wch:14},{wch:10},{wch:10},{wch:10},{wch:18},{wch:8}];let o=6,u=o+this.rows.length-1,m=[5,6,7,8,9];for(let v=o;v<=u;v++)for(let E of m){let j=nn.encode_cell({r:v-1,c:E-1}),U=a[j];U&&typeof U.v=="number"&&(U.z="#,##0")}let f=this.rows.reduce((v,E)=>v+(E.falta??0),0),h=this.rows.reduce((v,E)=>v+(E.disponibleEnAlmacen??0),0),g=`A${u+1}`;nn.sheet_add_aoa(a,[["","","","Totales:","","","",f,h,""]],{origin:g});let x=nn.book_new();nn.book_append_sheet(x,a,"Surtido");let S=`surtido_${(e||"sin-farmacia").replace(/[\\/:*?"<>|]/g,"_")}_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.xlsx`;Zl(x,S)}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(Xt),ie(ec))};static \u0275cmp=Te({type:i,selectors:[["app-surtir-farmacia"]],decls:18,vars:9,consts:[[1,"surtir-farmacia"],[1,"titulo-container"],[1,"titulo"],[2,"border-bottom","2px solid #0453b3","padding-bottom","1rem",3,"ngSubmit","formGroup"],[1,"subtitulo"],["formControlName","farmaciaId"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","submit","matTooltip","Buscar productos que requieren surtirse",1,"btn-gris",3,"disabled"],["class","toolbar","style","margin: .5rem 0; display:flex; gap:.5rem; align-items:center;",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","botones-accion",4,"ngIf"],[1,"toolbar",2,"margin",".5rem 0","display","flex","gap",".5rem","align-items","center"],["matTooltip","Marca todos como omitidos",1,"btn-gris",3,"click"],["matTooltip","Quita todas las omisiones",1,"btn-gris",3,"click"],[2,"margin-left","auto","font-size",".9rem"],["matTooltip","Exporta todos los registros de la tabla",1,"btn-amarillo",3,"click","disabled"],["matTooltip","Imprime la hoja de surtido con las omisiones",1,"btn-verde",3,"click"],[1,"tabla"],[3,"omitido",4,"ngFor","ngForOf","ngForTrackBy"],[2,"text-align","center"],["type","checkbox","matTooltip","Si est\xE1 activado, este producto no se surtir\xE1",1,"chk-omit",3,"ngModelChange","ngModel","name"],[1,"falta"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"botones-accion"],["matTooltip","Quitar lista sin surtir",1,"btn-rojo",3,"click"],["matTooltip","Surtir los productos de la lista",1,"btn-verde","a-la-derecha",3,"click","disabled"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"p",2),d(3,"Surtir Farmacias"),s()(),l(4,"form",3),w("ngSubmit",function(){return n.onAceptar()}),l(5,"label")(6,"span",4),d(7,"Farmacia:"),s(),l(8,"select",5)(9,"option",6),d(10,"-- Selecciona --"),s(),N(11,aP,2,2,"option",7),s()(),l(12,"button",8),d(13),s()(),N(14,sP,13,4,"div",9)(15,cP,23,2,"table",10)(16,dP,10,7,"div",11)(17,uP,5,1,"div",12),s()),e&2&&(c(4),p("formGroup",n.form),c(5),p("ngValue",null),c(2),p("ngForOf",n.farmacias),c(),p("disabled",n.form.invalid||n.cargando||n.pendientes.length>0),c(),R(" ",n.cargando?"Cargando\u2026":"Aceptar"," "),c(),p("ngIf",n.pendientes.length),c(),p("ngIf",n.pendientes.length),c(),p("ngIf",n.totalItems>0),c(),p("ngIf",n.pendientes.length))},dependencies:[Oe,We,Ne,ot,At,rt,at,li,nt,ze,Ft,_t,Lt,ci,di,Vt,dt],styles:[".surtir-farmacia[_ngcontent-%COMP%]{max-width:100%;margin:1rem auto;padding:0 1rem}.omitido[_ngcontent-%COMP%]{opacity:.55}.chk-omit[_ngcontent-%COMP%]{appearance:auto;-webkit-appearance:checkbox;-moz-appearance:checkbox;transform:none;zoom:1;width:16px;height:16px;vertical-align:middle;margin:0;padding:0;cursor:pointer}form[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-end;margin-bottom:1rem}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-weight:700;color:#333}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.3rem;font-size:1rem;border-radius:5px;height:41px}input[_ngcontent-%COMP%]{width:150px}select[_ngcontent-%COMP%]{width:320px}select[_ngcontent-%COMP%]:disabled, input[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:1rem;cursor:pointer}button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.botones-accion[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.a-la-derecha[_ngcontent-%COMP%]{margin-left:auto}.falta[_ngcontent-%COMP%]{color:#8b0000;font-weight:500}"]})};var qi=hi(ki());var uo=class i{constructor(t){this.http=t}base=`${He.apiUrl}/compras`;headers(){return new Qe({"x-auth-token":localStorage.getItem("auth_token")||""})}getCompras(){return this.http.get(this.base)}crearCompra(t){return this.http.post(this.base,t)}listar(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{r!=null&&r!==""&&(e=e.set(n,String(r)))}),this.http.get(`${this.base}/consulta`,{params:e})}searchProductos(t){let e=`${He.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(xt(n=>n?.data??n?.rows??n??[]),Pi(()=>gt([])))}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var fP=["backdrop"],pP=["firstInput"],ic=i=>({"selected-radio":i}),hP=i=>({"selected-checkbox":i});function gP(i,t){if(i&1&&(l(0,"option",7),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function _P(i,t){if(i&1){let e=ae();l(0,"button",29),w("click",function(){P(e);let r=_();return k(r.limpiarProducto())}),y(1,"i",30),s()}}function vP(i,t){if(i&1&&(l(0,"span",31),d(1),s()),i&2){let e=_();c(),T(e.nombreProducto)}}function xP(i,t){if(i&1){let e=ae();l(0,"button",38),w("click",function(){let r=P(e).$implicit,a=_(3);return k(a.selectProd(r))}),l(1,"div",39),d(2),s(),l(3,"div",40),d(4),s()()}if(i&2){let e=t.$implicit;c(2),T(e.nombre||"(sin nombre)"),c(2),T(e.codigoBarras||"\u2014")}}function bP(i,t){if(i&1&&(l(0,"div",35)(1,"div",36),N(2,xP,5,2,"button",37),s()()),i&2){let e=_(2);c(2),p("ngForOf",e.prodOpts)}}function yP(i,t){if(i&1){let e=ae();l(0,"div",18)(1,"label"),d(2," Buscar producto (nombre o c\xF3digo): "),l(3,"div",32)(4,"input",33),w("input",function(r){P(e);let a=_();return k(a.onProdInput((r.target.value||"").trim()))}),s(),N(5,bP,3,1,"div",34),s()()()}if(i&2){let e=_();c(4),p("disabled",e.cargandoProducto),c(),p("ngIf",e.prodOpts.length)}}function CP(i,t){if(i&1&&(l(0,"small",55),d(1),s()),i&2){let e=_(2);c(),R(" Se enviar\xE1: ",e.itemForm.value.fechaCaducidad," ")}}function SP(i,t){i&1&&(l(0,"div",56),d(1," Fecha inv\xE1lida. Escribe "),l(2,"strong"),d(3,"mmAA"),s(),d(4," (p. ej. 0925 \u2192 2025-09-30). "),s())}function wP(i,t){if(i&1){let e=ae();l(0,"div",41)(1,"label",42),d(2,"Cantidad: "),y(3,"input",43),s(),l(4,"label",42),d(5,"Lote: "),y(6,"input",44),s(),l(7,"div",45)(8,"label",46),d(9,"Caducidad:"),s(),l(10,"input",47),w("blur",function(){let r;P(e);let a=_();return k((r=a.itemForm.get("caducidadMMAAAA"))==null?null:r.markAsTouched())}),s(),N(11,CP,2,1,"small",48)(12,SP,5,0,"div",49),s(),l(13,"label",42),d(14,"Costo U.: "),y(15,"input",50),s(),l(16,"label",42),d(17,"Precio U.: "),y(18,"input",51),s(),l(19,"label",42),d(20,"Stock m\xEDnimo.: "),y(21,"input",52),s(),l(22,"label",42),d(23,"Stock m\xE1ximo.: "),y(24,"input",53),s(),l(25,"button",54),w("click",function(){P(e);let r=_();return k(r.onAgregarItem())}),d(26,"Agregar al carrito"),s()()}if(i&2){let e,n=_();c(11),p("ngIf",n.itemForm.value.fechaCaducidad),c(),p("ngIf",((e=n.itemForm.get("caducidadMMAAAA"))==null?null:e.invalid)&&((e=n.itemForm.get("caducidadMMAAAA"))==null?null:e.touched)),c(13),p("disabled",n.itemForm.invalid)}}function EP(i,t){if(i&1){let e=ae();l(0,"div",95)(1,"div",96),d(2),s(),l(3,"div",71)(4,"input",68),ee("ngModelChange",function(r){let a=P(e).$implicit,o=_(5);return Z(o.editPromos[a.prop].porcentaje,r)||(o.editPromos[a.prop].porcentaje=r),k(r)}),s()(),l(5,"div",69)(6,"input",72),ee("ngModelChange",function(r){let a=P(e).$implicit,o=_(5);return Z(o.editPromos[a.prop].inicio,r)||(o.editPromos[a.prop].inicio=r),k(r)}),s()(),l(7,"div",69)(8,"input",72),ee("ngModelChange",function(r){let a=P(e).$implicit,o=_(5);return Z(o.editPromos[a.prop].fin,r)||(o.editPromos[a.prop].fin=r),k(r)}),s()(),l(9,"div",71)(10,"div",97)(11,"input",81),ee("ngModelChange",function(r){let a=P(e).$implicit,o=_(5);return Z(o.editPromos[a.prop].monedero,r)||(o.editPromos[a.prop].monedero=r),k(r)}),s()()()()}if(i&2){let e=t.$implicit,n=_(5);c(2),T(e.name),c(2),J("ngModel",n.editPromos[e.prop].porcentaje),c(2),J("ngModel",n.editPromos[e.prop].inicio),c(2),J("ngModel",n.editPromos[e.prop].fin),c(3),J("ngModel",n.editPromos[e.prop].monedero)}}function TP(i,t){if(i&1&&(l(0,"div",88)(1,"div",89)(2,"div",90),d(3,"D\xEDa"),s(),l(4,"div",91),d(5,"% Desc."),s(),l(6,"div",92),d(7,"Inicia"),s(),l(8,"div",92),d(9,"Termina"),s(),l(10,"div",93),d(11,"Monedero"),s()(),N(12,EP,12,5,"div",94),s()),i&2){let e=_(4);c(12),p("ngForOf",e.diasSemana)}}function PP(i,t){if(i&1){let e=ae();l(0,"div",98)(1,"div",89)(2,"div",91),d(3,"Cantidad"),s(),l(4,"div",99),d(5,"Inicia"),s(),l(6,"div",99),d(7,"Termina"),s()(),l(8,"div",100)(9,"div",71)(10,"select",101),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.promoCantidadRequerida,r)||(a.editPromos.promoCantidadRequerida=r),k(r)}),l(11,"option",7),d(12,"--"),s(),l(13,"option",7),d(14,"2x1"),s(),l(15,"option",7),d(16,"3x2"),s(),l(17,"option",7),d(18,"4x3"),s()()(),l(19,"div",102)(20,"input",72),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.inicioPromoCantidad,r)||(a.editPromos.inicioPromoCantidad=r),k(r)}),s()(),l(21,"div",102)(22,"input",72),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.finPromoCantidad,r)||(a.editPromos.finPromoCantidad=r),k(r)}),s()()()()}if(i&2){let e=_(4);c(10),J("ngModel",e.editPromos.promoCantidadRequerida),c(),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(3),J("ngModel",e.editPromos.inicioPromoCantidad),c(2),J("ngModel",e.editPromos.finPromoCantidad)}}function kP(i,t){if(i&1){let e=ae();l(0,"div",103)(1,"div",89)(2,"div",91),d(3,"% Desc."),s(),l(4,"div",104),d(5,"Inicia"),s(),l(6,"div",104),d(7,"Termina"),s(),l(8,"div",93),d(9,"Monedero"),s()(),l(10,"div",71)(11,"input",68),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.promoDeTemporada.porcentaje,r)||(a.editPromos.promoDeTemporada.porcentaje=r),k(r)}),s()(),l(12,"div",105)(13,"input",72),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.promoDeTemporada.inicio,r)||(a.editPromos.promoDeTemporada.inicio=r),k(r)}),s()(),l(14,"div",105)(15,"input",72),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.promoDeTemporada.fin,r)||(a.editPromos.promoDeTemporada.fin=r),k(r)}),s()(),l(16,"div",71)(17,"div",97)(18,"input",81),ee("ngModelChange",function(r){P(e);let a=_(4);return Z(a.editPromos.promoDeTemporada.monedero,r)||(a.editPromos.promoDeTemporada.monedero=r),k(r)}),s()()()()}if(i&2){let e=_(4);c(11),J("ngModel",e.editPromos.promoDeTemporada.porcentaje),c(2),J("ngModel",e.editPromos.promoDeTemporada.inicio),c(2),J("ngModel",e.editPromos.promoDeTemporada.fin),c(3),J("ngModel",e.editPromos.promoDeTemporada.monedero)}}function IP(i,t){if(i&1){let e=ae();l(0,"tr",64)(1,"td",65)(2,"div",66)(3,"div",67)(4,"label")(5,"strong"),d(6,"Cant.:"),s()(),l(7,"input",68),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.cantidad,r)||(a.cantidad=r),k(r)}),s()(),l(8,"div",69)(9,"label")(10,"strong"),d(11,"Lote:"),s()(),l(12,"input",70),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.lote,r)||(a.lote=r),k(r)}),s()(),l(13,"div",71)(14,"label")(15,"strong"),d(16,"Caducidad:"),s()(),l(17,"input",72),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.fechaCaducidad,r)||(a.fechaCaducidad=r),k(r)}),s()(),l(18,"div",71)(19,"label")(20,"strong"),d(21,"Costo:"),s()(),l(22,"input",73),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.costoUnitario,r)||(a.costoUnitario=r),k(r)}),s()(),l(23,"div",71)(24,"label")(25,"strong"),d(26,"Precio:"),s()(),l(27,"input",68),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.precioUnitario,r)||(a.precioUnitario=r),k(r)}),s()(),l(28,"div",67)(29,"label")(30,"strong"),d(31,"M\xEDn:"),s()(),l(32,"input",68),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.stockMinimo,r)||(a.stockMinimo=r),k(r)}),s()(),l(33,"div",67)(34,"label")(35,"strong"),d(36,"M\xE1x:"),s()(),l(37,"input",68),ee("ngModelChange",function(r){P(e);let a=_().$implicit;return Z(a.stockMaximo,r)||(a.stockMaximo=r),k(r)}),s()()(),l(38,"div",74)(39,"div",75)(40,"label"),d(41,"Elige promoci\xF3n:"),s()(),l(42,"div",71)(43,"label",76)(44,"input",77),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),k(r)}),s(),d(45," Ninguna "),s()(),l(46,"div",71)(47,"label",76)(48,"input",78),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),k(r)}),s(),d(49," Por d\xEDa "),s()(),l(50,"div",71)(51,"label",76)(52,"input",79),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),k(r)}),s(),d(53," Cantidad "),s()(),l(54,"div",71)(55,"label",76)(56,"input",80),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),k(r)}),s(),d(57," Temporada "),s()(),l(58,"div",71)(59,"label",76),d(60," INAPAM(+5%) "),l(61,"input",81),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.editPromos.descuentoINAPAM,r)||(a.editPromos.descuentoINAPAM=r),k(r)}),s()()()(),N(62,TP,13,1,"div",82)(63,PP,23,7,"div",83)(64,kP,19,4,"div",84),l(65,"div",85)(66,"button",86),w("click",function(){P(e);let r=_(3);return k(r.cancelPromos())}),d(67,"Cancelar"),s(),l(68,"button",87),w("click",function(){P(e);let r=_().index,a=_(2);return k(a.savePromos(r))}),d(69,"Guardar"),s()()()()}if(i&2){let e=_(),n=e.$implicit,r=e.index,a=_(2);c(7),J("ngModel",n.cantidad),c(5),J("ngModel",n.lote),c(5),J("ngModel",n.fechaCaducidad),c(5),J("ngModel",n.costoUnitario),c(5),J("ngModel",n.precioUnitario),c(5),J("ngModel",n.stockMinimo),c(5),J("ngModel",n.stockMaximo),c(6),p("ngClass",_i(28,ic,a.editPromos.tipoPromocion==="ninguna")),c(),Qr("name","promo-",r,""),J("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",_i(30,ic,a.editPromos.tipoPromocion==="dia")),c(),Qr("name","promo-",r,""),J("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",_i(32,ic,a.editPromos.tipoPromocion==="cantidad")),c(),Qr("name","promo-",r,""),J("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",_i(34,ic,a.editPromos.tipoPromocion==="temporada")),c(),Qr("name","promo-",r,""),J("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",_i(36,hP,a.editPromos.descuentoINAPAM)),c(2),J("ngModel",a.editPromos.descuentoINAPAM),c(),p("ngIf",a.editPromos.tipoPromocion==="dia"),c(),p("ngIf",a.editPromos.tipoPromocion==="cantidad"),c(),p("ngIf",a.editPromos.tipoPromocion==="temporada")}}function MP(i,t){if(i&1){let e=ae();Ze(0),l(1,"tr")(2,"td")(3,"button",61),w("click",function(){let r=P(e).index,a=_(2);return k(a.onEliminarItem(r))}),y(4,"i",30),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),F(15,"date"),s(),l(16,"td"),d(17),F(18,"currency"),s(),l(19,"td"),d(20),F(21,"currency"),s(),l(22,"td"),d(23),s(),l(24,"td"),d(25),s(),l(26,"td"),d(27),F(28,"currency"),s(),l(29,"button",62),w("click",function(){let r=P(e).index,a=_(2);return k(a.toggleEditPromo(r))}),l(30,"mat-icon"),d(31),s()()(),N(32,IP,70,38,"tr",63),et()}if(i&2){let e=t.$implicit,n=t.index,r=_(2);c(6),T(e.nombre),c(2),T(e.codigoBarras),c(2),T(e.cantidad),c(2),T(e.lote),c(2),T(Q(15,15,e.fechaCaducidad,"dd/MM/yyyy")),c(3),T(se(18,18,e.costoUnitario)),c(3),T(se(21,20,e.precioUnitario)),c(3),T(e.stockMinimo),c(2),T(e.stockMaximo),c(2),T(se(28,22,e.costoUnitario*e.cantidad)),c(2),Vs(r.editingPromoIndex===n?"btn-icono btn-rojo":"btn-icono btn-verde"),p("matTooltip",r.editingPromoIndex===n?"Cerrar la edici\xF3n":"Editar promos y cantidades"),c(2),T(r.editingPromoIndex===n?"close":"edit"),c(),p("ngIf",r.editingPromoIndex===n)}}function FP(i,t){if(i&1&&(l(0,"table",57)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Producto"),s(),l(6,"th"),d(7,"Codigo barras"),s(),l(8,"th"),d(9,"Cant."),s(),l(10,"th"),d(11,"Lote"),s(),l(12,"th"),d(13,"Caducidad"),s(),l(14,"th"),d(15,"Costo U."),s(),l(16,"th"),d(17,"Precio U."),s(),l(18,"th"),d(19,"Stock M\xEDn."),s(),l(20,"th"),d(21,"Stock M\xE1x."),s(),l(22,"th"),d(23,"Subtotal"),s(),y(24,"th"),s()(),l(25,"tbody"),N(26,MP,33,24,"ng-container",58),s(),l(27,"tfoot")(28,"tr")(29,"td",59),d(30,"Total:"),s(),l(31,"td",60),d(32),F(33,"currency"),s()()()()),i&2){let e=_();c(26),p("ngForOf",e.carrito),c(6),T(se(33,2,e.total))}}function AP(i,t){if(i&1){let e=ae();l(0,"div",106,0),w("keydown.escape",function(){P(e);let r=_();return k(r.cerrarNuevoProducto())}),l(2,"div",107),w("mousedown",function(r){return P(e),k(r.stopPropagation())})("click",function(r){return P(e),k(r.stopPropagation())}),l(3,"h3",108),d(4,"Nuevo producto"),s(),l(5,"form",109)(6,"div",110)(7,"div",111)(8,"label"),d(9,"Nombre *"),s(),y(10,"input",112,1),s(),l(12,"div",69)(13,"label"),d(14,"C\xF3digo de barras *"),s(),y(15,"input",113),s(),l(16,"div",69)(17,"label"),d(18,"Categor\xEDa *"),s(),y(19,"input",114),s(),l(20,"div",71)(21,"label"),d(22,"Unidad *"),s(),y(23,"input",115),s(),l(24,"div",71)(25,"label"),d(26,"Precio *"),s(),y(27,"input",116),s(),l(28,"div",71)(29,"label"),d(30,"Costo *"),s(),y(31,"input",117),s(),l(32,"div",71)(33,"label"),d(34,"Stock M\xEDn *"),s(),y(35,"input",118),s(),l(36,"div",71)(37,"label"),d(38,"Stock M\xE1x *"),s(),y(39,"input",119),s(),l(40,"div",120)(41,"label",121),d(42,"IVA"),s(),y(43,"input",122),s(),l(44,"div",120)(45,"label",123),d(46,"Gen\xE9rico"),s(),y(47,"input",124),s(),l(48,"div",120)(49,"label",125),d(50,"INAPAM"),s(),y(51,"input",126),s(),l(52,"div",71)(53,"label"),d(54,"Ubicaci\xF3n"),s(),y(55,"input",127),s()()(),l(56,"div",128)(57,"button",129),w("click",function(){P(e);let r=_();return k(r.cerrarNuevoProducto())}),d(58,"Cancelar"),s(),l(59,"button",130),w("click",function(){P(e);let r=_();return k(r.guardarNuevoProducto())}),d(60),s()()()()}if(i&2){let e=_();c(5),p("formGroup",e.nuevoProductoForm),c(54),p("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),c(),R(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var nc=class i{constructor(t,e,n,r,a,o){this.fb=t;this.proveedorService=e;this.productoService=n;this.compraService=r;this.renderer=o;a.addIcons(Cn)}backdrop;firstInput;headerForm;itemForm;carrito=[];total=0;nombreProducto="";codBarras="";cargandoProducto=!1;productoEncontrado=!1;cargando=!1;prodInput$=new St;prodOpts=[];subs=[];prodSel=null;proveedores=[];productos=[];editingPromoIndex=null;editPromos={};diasSemana=[{name:"Lunes",prop:"promoLunes"},{name:"Martes",prop:"promoMartes"},{name:"Mi\xE9rcoles",prop:"promoMiercoles"},{name:"Jueves",prop:"promoJueves"},{name:"Viernes",prop:"promoViernes"},{name:"S\xE1bado",prop:"promoSabado"},{name:"Domingo",prop:"promoDomingo"}];mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;faPlus=Cn;toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}hoyISO=this.toLocalISODate(new Date);ngOnInit(){this.initForms(),this.itemForm.get("lote").valueChanges.subscribe(t=>{let e=(t??"").toUpperCase().replace(/[^A-Z0-9]/g,"");e!==t&&this.itemForm.patchValue({lote:e},{emitEvent:!1})}),this.itemForm.get("caducidadMMAAAA").valueChanges.subscribe(t=>{let e=(t??"").toString().replace(/\D/g,"");if(e!==t&&this.itemForm.patchValue({caducidadMMAAAA:e},{emitEvent:!1}),e.length!==4){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let n=+e.slice(0,2),r=+e.slice(2);if(n<1||n>12){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let a=2e3+r,o=new Date(a,n,0),u=String(o.getFullYear()),m=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0");this.itemForm.patchValue({fechaCaducidad:`${u}-${m}-${f}`},{emitEvent:!1})}),this.loadProveedores(),this.loadProductos(),this.subs.push(this.prodInput$.pipe(xt(t=>(t||"").trim()),cn(180),dn(),Ui(t=>t.length<2?gt([]):this.compraService.searchProductos(t))).subscribe(t=>{this.prodOpts=Array.isArray(t)?t:[]})),this.nuevoProductoForm=this.fb.group({nombre:["",[Pe.required,Pe.minLength(3)]],codigoBarras:["",Pe.required],unidad:["",Pe.required],precio:[null,[Pe.required,Pe.min(0)]],costo:[null,[Pe.required,Pe.min(0)]],iva:[!1],stockMinimo:[50,[Pe.required,Pe.min(0)]],stockMaximo:[100,[Pe.required,Pe.min(0)]],ubicacion:[""],categoria:["",Pe.required],generico:[!1],descuentoINAPAM:[!1]})}mmYyValidator(t){let e=(t.value??"").toString().replace(/\D/g,"");if(e==="")return null;if(!/^\d{4}$/.test(e))return{mmYy:!0};let n=+e.slice(0,2),r=+e.slice(2);return n<1||n>12?{mmYy:!0}:null}initForms(){this.headerForm=this.fb.group({proveedor:[null,Pe.required],fechaCompra:[this.hoyISO],afectarExistencias:[!0]}),this.itemForm=this.fb.group({nombre:["",Pe.required],codigoBarras:["",Pe.required],cantidad:[1,[Pe.required,Pe.min(1)]],lote:["",[Pe.required,Pe.pattern(/^[A-Z0-9]*$/)]],caducidadMMAAAA:["",[this.mmYyValidator]],fechaCaducidad:[null,Pe.required],costoUnitario:[0,[Pe.required,Pe.min(0)]],precioUnitario:[0,[Pe.required,Pe.min(0)]],stockMinimo:[1,[Pe.required,Pe.min(1)]],stockMaximo:[1,[Pe.required,Pe.min(1)]],promociones:this.fb.group(Ke({tipoPromocion:["ninguna"],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporada:this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]}),descuentoINAPAM:[!1]},this.getDiasSemanaForm()))})}getDiasSemanaForm(){let t={};for(let e of this.diasSemana)t[e.prop]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]});return t}loadProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=t.sort((e,n)=>e.nombre.localeCompare(n.nombre,"es",{sensitivity:"base"}))})}loadProductos(){this.productoService.obtenerProductos().subscribe(t=>this.productos=t)}onBuscarProducto(){return Ae(this,null,function*(){let t=this.itemForm.get("codigoBarras")?.value?.trim();if(!t)return;this.cargandoProducto=!0,yield new Promise(n=>setTimeout(n,50));let e=this.productos.find(n=>n.codigoBarras===t);if(!e){yield qi.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(e)})}detectarTipoPromocion(t){return t.promoDeTemporada?"temporada":t.promoCantidadRequerida?"cantidad":this.diasSemana.some(e=>t[e.prop]!=null)?"dia":"ninguna"}mapDiasSemana(t){let e={};for(let n of this.diasSemana)e[n.prop]={porcentaje:t[n.prop]?.porcentaje??null,inicio:this.toDate(t[n.prop]?.inicio),fin:this.toDate(t[n.prop]?.fin),monedero:t[n.prop]?.monedero??!1};return e}limpiarProducto(){this.nombreProducto="",this.productoEncontrado=!1,this.itemForm.reset(),this.itemForm.get("codigoBarras")?.enable()}onAgregarItem(){if(this.itemForm.invalid){qi.default.fire("Formulario incompleto","Por favor llena todos los campos.","warning");return}let t=this.itemForm.value,e={nombre:t.nombre,codigoBarras:this.codBarras,cantidad:t.cantidad,lote:t.lote,fechaCaducidad:t.fechaCaducidad,costoUnitario:t.costoUnitario,precioUnitario:t.precioUnitario,stockMinimo:t.stockMinimo,stockMaximo:t.stockMaximo,promociones:t.promociones};this.carrito.push(e),this.calcularTotal(),this.limpiarProducto()}calcularTotal(){this.total=this.carrito.reduce((t,e)=>t+e.costoUnitario*e.cantidad,0)}onEliminarItem(t){this.carrito.splice(t,1),this.calcularTotal()}estaEditandoPromos=!1;toggleEditPromo(t){if(this.estaEditandoPromos=!0,this.calcularTotal(),this.editingPromoIndex===t){this.editingPromoIndex=null,this.estaEditandoPromos=!1;return}let e=this.carrito[t].promociones;if(this.editingPromoIndex=t,this.editPromos=JSON.parse(JSON.stringify(e)),this.editPromos.tipoPromocion==="dia")for(let n of this.diasSemana)this.editPromos[n.prop]??={porcentaje:null,inicio:null,fin:null,monedero:!1}}savePromos(t){this.carrito[t].promociones=JSON.parse(JSON.stringify(this.editPromos)),this.editingPromoIndex=null,this.estaEditandoPromos=!1}cancelPromos(){this.editingPromoIndex=null,this.estaEditandoPromos=!1}onRegistrarCompra(){if(this.headerForm.invalid||this.carrito.length===0){qi.default.fire("Datos incompletos","Selecciona proveedor y agrega productos.","warning");return}let t=this.headerForm.value.fechaCompra;if(t){let u=new Date(this.hoyISO);if(new Date(t)>u){qi.default.fire("Fecha inv\xE1lida","La fecha de compra no puede ser futura.","warning");return}}let e=this.headerForm.value.proveedor,r=this.proveedores.find(u=>u._id===e)?.nombre||"Desconocido",a=t?new Date(`${t}T12:00:00`).toISOString():null,o=!!this.headerForm.value.afectarExistencias;qi.default.fire({icon:"question",title:"Confirmar compra",html:`
      Proveedor: <strong>${r}</strong><hr>
      <div>Fecha compra: <strong>${t||this.hoyISO}</strong></div>
      <div>Afectar existencias: <strong>${o?"S\xED":"No"}</strong></div>
      <h2 style="color: blue">Total: <strong>$${this.total.toFixed(2)}</strong></h2>`,showCancelButton:!0,confirmButtonText:"Registrar"}).then(u=>{if(!u.isConfirmed)return;qi.default.showLoading();let m={proveedor:this.headerForm.value.proveedor,afectarExistencias:o,productos:this.carrito.map(f=>({codigoBarras:f.codigoBarras,cantidad:f.cantidad,lote:f.lote,fechaCaducidad:f.fechaCaducidad,costoUnitario:f.costoUnitario,precioUnitario:f.precioUnitario,stockMinimo:f.stockMinimo,stockMaximo:f.stockMaximo,promociones:f.promociones}))};a&&(m.fechaCompra=a),this.compraService.crearCompra(m).subscribe({next:()=>{qi.default.hideLoading(),qi.default.fire("Compra registrada","Se guard\xF3 correctamente.","success"),this.resetCompras()},error:f=>{qi.default.hideLoading(),console.error(f),qi.default.fire("Error","No se pudo registrar la compra.","error")}})})}resetCompras(){this.headerForm.reset(),this.carrito=[],this.total=0}toDate(t){return t?new Date(t).toISOString().substring(0,10):null}onProdInput(t){this.prodInput$.next(t)}selectProd(t,e){return Ae(this,null,function*(){this.prodSel=t,this.prodOpts=[],e&&(e.value=""),this.cargandoProducto=!0,yield new Promise(r=>setTimeout(r,50));let n=this.productos.find(r=>r.codigoBarras===t.codigoBarras);if(!n){yield qi.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t.codigoBarras} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(n)})}applyProducto(t){if(!t)return;this.nombreProducto=t.nombre||"",this.codBarras=t.codigoBarras||"",this.productoEncontrado=!!this.nombreProducto,this.cargandoProducto=!1,this.itemForm.get("codigoBarras")?.setValue(this.codBarras),this.itemForm.get("codigoBarras")?.disable();let e=this.detectarTipoPromocion(t);this.itemForm.patchValue({nombre:t.nombre,codBarras:this.codBarras,cantidad:1,lote:"",caducidadMMAAAA:"",fechaCaducidad:null,costoUnitario:t.costo??0,precioUnitario:t.precio??0,stockMinimo:t.stockMinimo??1,stockMaximo:t.stockMaximo??1,promociones:Ke({tipoPromocion:e,promoCantidadRequerida:t.promoCantidadRequerida??null,inicioPromoCantidad:this.toDate(t.inicioPromoCantidad),finPromoCantidad:this.toDate(t.finPromoCantidad),promoDeTemporada:{porcentaje:t.promoDeTemporada?.porcentaje??null,inicio:this.toDate(t.promoDeTemporada?.inicio),fin:this.toDate(t.promoDeTemporada?.fin),monedero:t.promoDeTemporada?.monedero??!1},descuentoINAPAM:t.descuentoINAPAM??!1},this.mapDiasSemana(t))})}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){qi.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,this.loadProductos(),qi.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{this.guardandoNuevo=!1,console.error(e),qi.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let n=e[0],r=e[e.length-1],a=document.activeElement;t.shiftKey&&a===n?(r.focus(),t.preventDefault()):!t.shiftKey&&a===r&&(n.focus(),t.preventDefault())}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(rl),ie(Ji),ie(uo),ie(yi),ie(Pa))};static \u0275cmp=Te({type:i,selectors:[["app-compras"]],viewQuery:function(e,n){if(e&1&&(Tt(fP,5),Tt(pP,5)),e&2){let r;bt(r=yt())&&(n.backdrop=r.first),bt(r=yt())&&(n.firstInput=r.first)}},hostBindings:function(e,n){e&1&&w("keydown",function(a){return n.trapTab(a)},!1,Ta)},decls:39,vars:15,consts:[["backdrop",""],["firstInput",""],[1,"compras-container"],[1,"titulo-container"],[1,"titulo"],[1,"header-form",3,"formGroup"],["formControlName","proveedor",1,"input-text","select",2,"width","max-content"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"margin-left","12px"],["type","date","formControlName","fechaCompra","title","Fecha efectiva de la compra (no futuro)",1,"input-text",2,"width","max-content",3,"max"],["for","chk-afectar-exist",2,"margin","0.5rem 0 0 4rem"],["id","chk-afectar-exist","type","checkbox","formControlName","afectarExistencias","title","Si est\xE1 marcado, se actualizar\xE1n lotes/precios/inventarios; si no, solo se registrar\xE1 la compra."],[2,"margin-top","0.5rem","color","#f6a80c"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"item-form",3,"formGroup"],[1,"buscar"],["type","text","formControlName","codigoBarras","placeholder","Escanea aqu\xED",3,"keydown.enter"],["class","btn-rojo","matTooltip","Borrar c\xF3digo de barras",3,"click",4,"ngIf"],["class","producto-nombre",4,"ngIf"],["class","buscar",4,"ngIf"],["class","detalles-producto",4,"ngIf"],["class","tabla",4,"ngIf"],[1,"acciones"],["matTooltip","Cancelar toda la compra",1,"btn-rojo",3,"click","disabled"],["matTooltip","Registrar la compra completa",1,"btn-gris",3,"click","disabled"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["matTooltip","Borrar c\xF3digo de barras",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"producto-nombre"],[1,"suggest-wrap"],["type","text","placeholder","Escribe al menos 2 caracteres",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],[1,"suggest-panel"],[1,"suggest-grid"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"suggest-title"],[1,"suggest-sub"],[1,"detalles-producto"],[2,"width","10%"],["type","number","formControlName","cantidad","min","1"],["type","text","formControlName","lote","placeholder","Solo A-Z y 0-9"],[1,"field-stack",2,"width","18rem"],["for","caducidadMMYY",2,"width","10%"],["id","caducidadMMYY","type","text","inputmode","numeric","maxlength","4","formControlName","caducidadMMAAAA","placeholder","mmAA","autocomplete","off",3,"blur"],["class","field-help text-muted",4,"ngIf"],["class","field-error",4,"ngIf"],["type","number","formControlName","costoUnitario","step","0.01"],["type","number","formControlName","precioUnitario","step","0.01"],["type","number","formControlName","stockMinimo","step","1"],["type","number","formControlName","stockMaximo","step","1"],["type","button",1,"btn-verde",2,"height","fit-content","margin-top","1rem",3,"click","disabled"],[1,"field-help","text-muted"],[1,"field-error"],[1,"tabla"],[4,"ngFor","ngForOf"],["colspan","10",1,"total-label"],["colspan","2",2,"text-align","start"],["matTooltip","Quitar este producto de la compra",1,"btn-icono","btn-rojo-tache",3,"click"],[2,"margin-top","8px",3,"click","matTooltip"],["class","promo-editor",4,"ngIf"],[1,"promo-editor"],["colspan","12"],[1,"row","mb-3","text-center","align-items-center",2,"background-color","#f5f5f5","padding-bottom","10px"],[1,"col-1"],["type","number",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-3"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-2"],["type","date",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","number","step","0.1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"row","text-center","mb-1"],[1,"col-2","fw-bold"],[3,"ngClass"],["type","radio","value","ninguna",3,"ngModelChange","name","ngModel"],["type","radio","value","dia",3,"ngModelChange","name","ngModel"],["type","radio","value","cantidad",3,"ngModelChange","name","ngModel"],["type","radio","value","temporada",3,"ngModelChange","name","ngModel"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],["class","mb-4",4,"ngIf"],["class","row mb-4 align-items-center",4,"ngIf"],["class","row mb-3",4,"ngIf"],[1,"guardar-cancelar"],["matTooltip","Cancelar edici\xF3n del producto",1,"btn-rojo-chico",2,"margin-left","2rem",3,"click"],["matTooltip","Guardar cambios",1,"btn-verde-chico",2,"margin-right","2rem",3,"click"],[1,"mb-4"],[1,"row","fw-bold","text-center","align-items-center"],[1,"col-2","text-end",2,"padding-top","10px"],[1,"col-2",2,"padding-top","10px"],[1,"col-3",2,"padding-top","10px"],[1,"col-2","text-start",2,"padding-top","10px"],["class","row mb-2 align-items-center",4,"ngFor","ngForOf"],[1,"row","mb-2","align-items-center"],[1,"col-2","text-end","text-primary","fw-bold"],[1,"form-check"],[1,"row","mb-4","align-items-center"],[1,"col-5",2,"padding-top","10px"],[1,"row"],[1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-5"],[1,"row","mb-3"],[1,"col-4",2,"padding-top","10px"],[1,"col-4"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],[1,"modal-actions","mt-3"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,n){e&1&&(l(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"Compras"),s()(),l(4,"form",5)(5,"label"),d(6,"Proveedor:"),s(),l(7,"select",6)(8,"option",7),d(9,"-- Selecciona --"),s(),N(10,gP,2,2,"option",8),s(),l(11,"label",9),d(12,"Fecha de compra:"),s(),y(13,"input",10),l(14,"label",11),d(15,"Afectar existencias:"),s(),y(16,"input",12),l(17,"small",13),d(18),s(),l(19,"button",14),w("click",function(){return n.abrirNuevoProducto()}),y(20,"fa-icon",15),l(21,"span",16),d(22,"Nuevo"),s()()(),l(23,"div",17)(24,"div",18)(25,"label"),d(26," C\xF3digo de barras: "),l(27,"input",19),w("keydown.enter",function(){return n.onBuscarProducto()}),s()(),N(28,_P,2,0,"button",20)(29,vP,2,1,"span",21),s(),N(30,yP,6,2,"div",22)(31,wP,27,3,"div",23),s(),N(32,FP,34,4,"table",24),l(33,"div",25)(34,"button",26),w("click",function(){return n.carrito=[],n.total=0}),d(35,"Cancelar "),s(),l(36,"button",27),w("click",function(){return n.onRegistrarCompra()}),d(37,"Registrar Compra "),s()(),N(38,AP,61,3,"div",28),s()),e&2&&(c(4),p("formGroup",n.headerForm),c(4),p("ngValue",null),c(2),p("ngForOf",n.proveedores),c(3),p("max",n.hoyISO),c(5),R(" ",n.headerForm.value.afectarExistencias?"S\xED (actualiza productos)":"No (solo registra compra)"," "),c(2),p("icon",n.faPlus),c(3),p("formGroup",n.itemForm),c(5),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",!n.productoEncontrado),c(),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",n.carrito.length),c(2),p("disabled",!n.carrito.length||n.estaEditandoPromos),c(2),p("disabled",!n.carrito.length||n.headerForm.invalid||n.estaEditandoPromos),c(2),p("ngIf",n.mostrarNuevoProducto))},dependencies:[Oe,si,We,Ne,Bt,Nt,ot,At,rt,at,qe,qt,li,nt,Pr,ze,Ft,Aa,Bi,_t,Lt,ci,di,Vt,dt,Qn,Mr,ti,ei],styles:[".compras-container[_ngcontent-%COMP%]{width:100%}.header-form[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-bottom:1rem;font-size:large}.header-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:.5rem}.item-form[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:large;border-bottom:2px solid #0453b3}.item-form[_ngcontent-%COMP%]   .buscar[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem}.producto-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:500;padding:8px 12px;border-radius:5px}.detalles-producto[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.detalles-producto[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.total-label[_ngcontent-%COMP%]{text-align:right;font-weight:700}.acciones[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;gap:10px;margin-top:20px}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px;padding:10px 20px;font-size:16px}.field-stack[_ngcontent-%COMP%]{display:inline-block;vertical-align:top}.field-stack[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;margin-bottom:4px}.field-help[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:.85rem}.field-error[_ngcontent-%COMP%]{display:block;margin-top:4px;color:#dc3545;font-size:.85rem}@media (max-width: 600px){.acciones[_ngcontent-%COMP%]{justify-content:center}}.guardar-cancelar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-top:1rem;margin-bottom:1rem}.promo-editor[_ngcontent-%COMP%]{background:#f9f9f9;padding:1rem;border-top:2px solid #ddd}.promo-editor[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:.1rem}.selected-radio[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;padding:5px 10px;border-radius:6px}.selected-checkbox[_ngcontent-%COMP%]{background-color:#b7fe88;color:#000;padding:5px 10px;border-radius:6px}.fw-bold[_ngcontent-%COMP%]{font-weight:700;color:#02047c}.suggest-wrap[_ngcontent-%COMP%]{position:relative;display:block}.suggest-panel[_ngcontent-%COMP%]{position:absolute;inset-inline:0;top:calc(100% + .25rem);z-index:40;background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;padding:.5rem;max-height:24rem;overflow:auto}.suggest-grid[_ngcontent-%COMP%]{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.75rem .9rem;border:1px solid #eef0f3;border-radius:.75rem;background:#f9fafb;cursor:pointer;transition:background-color .15s ease,border-color .15s ease,transform .06s ease}.suggest-item[_ngcontent-%COMP%]:hover{background:#f3f4f6;border-color:#e5e7eb}.suggest-item[_ngcontent-%COMP%]:active{transform:scale(.995)}.suggest-title[_ngcontent-%COMP%]{font-weight:600;color:#111827;line-height:1.2}.suggest-sub[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.875rem;color:#6b7280}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#d1d5db;border-radius:8px;border:3px solid transparent;background-clip:content-box}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#c0c4cb}@media (prefers-color-scheme: dark){.suggest-panel[_ngcontent-%COMP%]{background:#0b0f15;border-color:#1f2937;box-shadow:0 10px 15px -3px #00000080,0 4px 6px -4px #00000080}.suggest-item[_ngcontent-%COMP%]{background:#0f172a;border-color:#1f2937}.suggest-item[_ngcontent-%COMP%]:hover{background:#111827;border-color:#334155}.suggest-title[_ngcontent-%COMP%]{color:#e5e7eb}.suggest-sub[_ngcontent-%COMP%]{color:#94a3b8}}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}"]})};var Yt=hi(ki());var OP=()=>["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];function DP(i,t){if(i&1&&(l(0,"small"),d(1),F(2,"number"),s()),i&2){let e=_();Ri("color",e.utilColor),c(),R(" Util. ",Q(2,3,e.utilPct,"1.0-2"),"% ")}}function RP(i,t){i&1&&d(0,"\u2014")}function NP(i,t){if(i&1&&(l(0,"small"),d(1),F(2,"currency"),s()),i&2){let e=_();Ri("color",e.utilColor),c(),R(" (",se(2,3,e.utilAbs),") ")}}function BP(i,t){if(i&1){let e=ae();l(0,"div",43)(1,"label"),d(2,"Lote:"),s(),y(3,"input",44),l(4,"label"),d(5,"Caducidad:"),s(),y(6,"input",45),l(7,"label"),d(8,"Cantidad:"),s(),y(9,"input",46),l(10,"button",47),w("click",function(){let r=P(e).index,a=_();return k(a.eliminarLote(r))}),d(11,"Eliminar"),s()()}if(i&2){let e=t.index;p("formGroupName",e)}}function LP(i,t){if(i&1&&(l(0,"div")(1,"div",48)(2,"div",49)(3,"label",23),d(4),s()(),l(5,"div",49)(6,"label"),d(7,"% desc.:"),s(),y(8,"input",34),s(),l(9,"div",50)(10,"label"),d(11,"Inicio:"),s(),y(12,"input",35),s(),l(13,"div",50)(14,"label"),d(15,"Fin:"),s(),y(16,"input",36),s(),l(17,"div",49)(18,"label"),d(19,"Monedero:"),s(),y(20,"input",37),s()()()),i&2){let e=t.$implicit;c(),p("formGroupName","promo"+e),c(3),T(e)}}var rc=class i{constructor(t,e){this.fb=t;this.producto=e}formulario;guardar=new zt;cerrar=new zt;get utilAbs(){let t=Number(this.formulario.get("costo")?.value),e=Number(this.formulario.get("precio")?.value);return!isFinite(t)||!isFinite(e)?null:e-t}get utilPct(){let t=Number(this.formulario.get("costo")?.value),e=Number(this.formulario.get("precio")?.value);return!isFinite(t)||t<=0||!isFinite(e)?null:(e-t)/t*100}get miCategoria(){return this.formulario.get("categoria")?.value}get esGenerico(){return this.formulario.get("generico")?.value}get utilColor(){let t=this.utilPct;return t===null?null:this.miCategoria==="Abarrotes"||this.miCategoria==="ABARROTES"||this.miCategoria==="abarrotes"?t>45?"orange":t>=18?"green":"red":this.esGenerico?t>60?"orange":t>=30?"green":"red":t>20?"orange":t>=10?"green":"red"}ngOnInit(){this.formulario=this.fb.group({nombre:[this.producto.nombre,[Pe.required]],renglon1:[this.producto.renglon1],renglon2:[this.producto.renglon2],codigoBarras:[this.producto.codigoBarras,[Pe.required]],ubicacion:[this.producto.ubicacion],categoria:[this.producto.categoria],precio:[this.producto.precio,[Pe.required,Pe.min(0)]],costo:[this.producto.costo,[Pe.required,Pe.min(0)]],iva:[this.producto.iva],generico:[this.producto.generico],descuentoINAPAM:[this.producto.descuentoINAPAM],stockMinimo:[this.producto.stockMinimo,[Pe.required,Pe.min(0)]],stockMaximo:[this.producto.stockMaximo,[Pe.required,Pe.min(0)]],lotes:this.fb.array(this.producto.lotes.map(e=>this.crearLoteForm(e))),promosPorDia:this.fb.group(this.inicializarPromosPorDia()),promoCantidadRequerida:[this.producto.promoCantidadRequerida],inicioPromoCantidad:[this.formatDate(this.producto.inicioPromoCantidad)],finPromoCantidad:[this.formatDate(this.producto.finPromoCantidad)],promoDeTemporada:this.fb.group({porcentaje:[this.producto.promoDeTemporada?.porcentaje,[Pe.min(0),Pe.max(100)]],inicio:[this.formatDate(this.producto.promoDeTemporada?.inicio)],fin:[this.formatDate(this.producto.promoDeTemporada?.fin)],monedero:[this.producto.promoDeTemporada?.monedero]})},{validators:this.validarFechasGlobales()});let t=this.formulario.get("lotes");t.controls.forEach(e=>{let n=e;Object.values(n.controls).forEach(r=>{r.clearValidators(),r.clearAsyncValidators(),r.setErrors(null),r.updateValueAndValidity({onlySelf:!0})}),n.setErrors(null),n.updateValueAndValidity({onlySelf:!0})}),t.clearValidators(),t.clearAsyncValidators(),t.setErrors(null),t.updateValueAndValidity(),t.controls.forEach(e=>{let n=e,r=n.get("fechaCaducidad");(r.value===""||r.value===void 0)&&r.setValue(null,{emitEvent:!1}),r.valueChanges.subscribe(a=>{a===""&&(r.setValue(null,{emitEvent:!1}),r.updateValueAndValidity({onlySelf:!0}),n.updateValueAndValidity({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0}),this.formulario.updateValueAndValidity())})}),this.formulario.updateValueAndValidity()}formOkSinLotes(){if(!this.formulario)return!1;let t=this.formulario.controls;return Object.keys(t).filter(e=>e!=="lotes").every(e=>t[e]?.valid===!0)}dumpFormErrors(t,e="form"){let n=a=>a.controls&&!a.length,r=a=>Array.isArray(a.controls);n(t)?Object.entries(t.controls).forEach(([a,o])=>{this.dumpFormErrors(o,`${e}.${a}`)}):r(t)?t.controls.forEach((a,o)=>{this.dumpFormErrors(a,`${e}[${o}]`)}):t.errors&&console.log(`\u274C ${e}:`,t.errors)}validarFechasGlobales(){return t=>{let e=t.get("inicioPromoCantidad")?.value,n=t.get("finPromoCantidad")?.value;if(!e||!n)return null;let r=new Date(e),a=new Date(n);return isNaN(r.getTime())||isNaN(a.getTime())||a>=r?null:{rangoPromoCantidad:!0}}}optionalFutureDate(){return t=>{let e=t.value;if(e==null||e==="")return null;let n=new Date(e);if(isNaN(n.getTime()))return{invalidDate:!0};let r=new Date;return r.setHours(0,0,0,0),n>=r?null:{pastDate:!0}}}optionalMin(t){return e=>{let n=e.value;if(n==null||n==="")return null;let r=Number(n);return Number.isFinite(r)&&r>=t?null:{min:{min:t,actual:n}}}}crearLoteForm(t){return this.fb.group({_id:[t?._id??null],lote:[t?.lote??null],fechaCaducidad:[this.formatDate(t?.fechaCaducidad)||null,[this.optionalFutureDate()]],cantidad:[t?.cantidad??null,[this.optionalMin(0)]]})}inicializarPromosPorDia(){let t={};return["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"].forEach(n=>{let r=`promo${n}`,a=this.producto[r];t[r]=this.fb.group({porcentaje:[a?.porcentaje??0],inicio:[this.formatDate(a?.inicio)],fin:[this.formatDate(a?.fin)],monedero:[a?.monedero??!1]})}),t}get lotesFormArray(){return this.formulario.get("lotes")}agregarLote(){let t={lote:"",fechaCaducidad:new Date,cantidad:0};this.lotesFormArray.push(this.crearLoteForm(t))}eliminarLote(t){this.lotesFormArray.removeAt(t)}guardarProducto(){if(this.formulario.invalid){console.log("\u274C Formulario inv\xE1lido:",this.formulario.errors),Object.entries(this.formulario.controls).forEach(([r,a])=>{console.log("Campo:",r,"Estado:",a.status,"Errores:",a.errors)});return}let t=this.formulario.value,e=(t.lotes||[]).map(r=>Wt(Ke({},r),{lote:(r?.lote??"").toString().trim()||null,fechaCaducidad:r?.fechaCaducidad?new Date(r.fechaCaducidad):null,cantidad:r?.cantidad===""||r?.cantidad===null||r?.cantidad===void 0?null:Number(r.cantidad)})).filter(r=>r.lote!==null||r.fechaCaducidad!==null||r.cantidad!==null),n=Wt(Ke(Ke({},this.producto),t),{lotes:e});this.guardar.emit(n)}cerrarModal(){this.cerrar.emit()}formatDate(t){return t?new Date(t).toISOString().split("T")[0]:""}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie("PRODUCTO_DATA"))};static \u0275cmp=Te({type:i,selectors:[["app-modal-editar-producto"]],outputs:{guardar:"guardar",cerrar:"cerrar"},decls:103,vars:12,consts:[["sinDato",""],[1,"modal-overlay"],[1,"modal-content"],[1,"titulo"],[3,"formGroup"],[1,"edit-seccion"],["type","text","formControlName","nombre",2,"width","32rem"],["type","text","formControlName","codigoBarras",2,"width","10rem"],["type","text","formControlName","renglon1",2,"width","22rem"],["type","text","formControlName","renglon2",2,"width","22rem"],["type","text","formControlName","categoria",2,"width","11rem"],["type","number","formControlName","stockMinimo",2,"width","4rem"],["type","number","formControlName","stockMaximo",2,"width","4rem"],["type","checkbox","formControlName","iva"],["type","checkbox","formControlName","generico"],["type","checkbox","formControlName","descuentoINAPAM"],["type","number","formControlName","costo","step","0.1",2,"width","5rem"],["type","number","formControlName","precio","step","0.1",2,"width","5rem"],[3,"color",4,"ngIf","ngIfElse"],[3,"color",4,"ngIf"],[2,"margin-left","2rem"],["type","text","formControlName","ubicacion",2,"width","13rem"],["formArrayName","lotes"],[1,"subtitulo-edit"],["class","edit-seccion",3,"formGroupName",4,"ngFor","ngForOf"],[2,"text-align","center"],["type","button",1,"btn-verde-chico",3,"click"],[2,"margin-left","1rem"],["formControlName","promoCantidadRequerida",2,"margin-right","2rem"],[3,"ngValue"],["type","date","formControlName","inicioPromoCantidad"],["type","date","formControlName","finPromoCantidad"],["formGroupName","promoDeTemporada",1,"edit-seccion"],[2,"margin-left","1.5rem"],["type","number","formControlName","porcentaje",2,"width","60px"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["type","checkbox","formControlName","monedero"],["formGroupName","promosPorDia"],[4,"ngFor","ngForOf"],[1,"modal-buttons"],[1,"btn-rojo-chico",3,"click"],[1,"btn-verde-chico","btn-right",3,"click","disabled"],[1,"edit-seccion",3,"formGroupName"],["type","text","formControlName","lote"],["type","date","formControlName","fechaCaducidad"],["type","number","formControlName","cantidad",2,"width","5rem"],["type","button",1,"btn-rojo-chico",3,"click"],[1,"row","promo-dia",3,"formGroupName"],[1,"col-2"],[1,"col-3"]],template:function(e,n){if(e&1){let r=ae();l(0,"div",1)(1,"div",2)(2,"h3",3),d(3,"Almacen editar producto"),s(),l(4,"form",4)(5,"div",5)(6,"label"),d(7,"Nombre:"),s(),y(8,"input",6),l(9,"label"),d(10,"Cod. Barras:"),s(),y(11,"input",7),s(),l(12,"div",5)(13,"label"),d(14,"Rengl\xF3n 1:"),s(),y(15,"input",8),l(16,"label"),d(17,"Rengl\xF3n 2:"),s(),y(18,"input",9),s(),l(19,"div",5)(20,"label"),d(21,"Categor\xEDa:"),s(),y(22,"input",10),l(23,"label"),d(24,"Stock Minimo:"),s(),y(25,"input",11),l(26,"label"),d(27,"Stock Maximo:"),s(),y(28,"input",12),l(29,"label"),d(30,"IVA:"),s(),y(31,"input",13),l(32,"label"),d(33,"Gen\xE9rico:"),s(),y(34,"input",14),s(),l(35,"div",5)(36,"label"),d(37,"INAPAM:"),s(),y(38,"input",15),l(39,"label"),d(40,"Costo:"),s(),y(41,"input",16),l(42,"label"),d(43,"Precio:"),s(),y(44,"input",17),N(45,DP,3,6,"small",18)(46,RP,1,0,"ng-template",null,0,ka)(48,NP,3,5,"small",19),l(49,"label",20),d(50,"Ubicaci\xF3n:"),s(),y(51,"input",21),s(),l(52,"div",22)(53,"label",23),d(54,"Lotes:"),s(),N(55,BP,12,1,"div",24),l(56,"div",25)(57,"button",26),w("click",function(){return P(r),k(n.agregarLote())}),d(58,"Agregar Lote"),s()()(),l(59,"label",23),d(60,"Promociones:"),s(),l(61,"div",5)(62,"label",23),d(63,"Cantidad Requerida:"),s(),l(64,"label",27),d(65,"Tipo:"),s(),l(66,"select",28)(67,"option",29),d(68,"--"),s(),l(69,"option",29),d(70,"2x1"),s(),l(71,"option",29),d(72,"3x2"),s(),l(73,"option",29),d(74,"4x3"),s()(),l(75,"label"),d(76,"Inicio:"),s(),y(77,"input",30),l(78,"label"),d(79,"Fin:"),s(),y(80,"input",31),s(),l(81,"div",32)(82,"label",23),d(83,"Temporada:"),s(),l(84,"label",33),d(85,"% desc.:"),s(),y(86,"input",34),l(87,"label"),d(88,"Inicio:"),s(),y(89,"input",35),l(90,"label"),d(91,"Fin:"),s(),y(92,"input",36),l(93,"label"),d(94,"Monedero:"),s(),y(95,"input",37),s(),l(96,"div",38),N(97,LP,21,2,"div",39),s()(),l(98,"div",40)(99,"button",41),w("click",function(){return P(r),k(n.cerrarModal())}),d(100,"Cancelar"),s(),l(101,"button",42),w("click",function(){return P(r),k(n.guardarProducto())}),d(102,"Guardar"),s()()()()}if(e&2){let r=Gt(47);c(4),p("formGroup",n.formulario),c(41),p("ngIf",n.utilPct!==null)("ngIfElse",r),c(3),p("ngIf",n.utilAbs!==null),c(7),p("ngForOf",n.lotesFormArray.controls),c(12),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(24),p("ngForOf",Jt(11,OP)),c(4),p("disabled",!n.formOkSinLotes())}},dependencies:[Oe,We,Ne,wt,Bt,Lt,At,rt,at,qe,qt,li,nt,ze,Ft,ci,di,qs,Hm,ot],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#8dfaf7;padding:20px;border-radius:8px;width:1000px;max-height:90vh;overflow-y:auto;box-shadow:0 5px 15px #0000004d;font-size:medium;display:flex;justify-content:space-between}.subtitulo-edit[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.edit-seccion[_ngcontent-%COMP%]{margin-bottom:.5rem}.edit-seccion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.edit-seccion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:2rem}.promo-dia[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.modal-buttons[_ngcontent-%COMP%]{display:flex;margin-left:2rem;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}"]})};var ac=class i{constructor(t,e){this.overlay=t;this.injector=e}overlayRef;abrirModal(t,e){if(this.overlayRef)return;this.overlayRef=this.overlay.create({hasBackdrop:!0,backdropClass:"cdk-overlay-dark-backdrop",positionStrategy:this.overlay.position().global().centerHorizontally().centerVertically()});let n=new Rf(rc,null,this.crearInjector(t,e)),r=this.overlayRef.attach(n);this.overlayRef.backdropClick().subscribe(()=>this.cerrarModal()),r.instance.cerrar.subscribe(()=>this.cerrarModal()),r.instance.guardar.subscribe(a=>{e(a),this.cerrarModal()})}crearInjector(t,e){return Ea.create({providers:[{provide:"PRODUCTO_DATA",useValue:t},{provide:"GUARDAR_CALLBACK",useValue:e}],parent:this.injector})}cerrarModal(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=void 0)}static \u0275fac=function(e){return new(e||i)(lt(Na),lt(Ea))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var UP=["backdrop"],jP=["firstInput"],Dg=i=>({"selected-radio":i}),oc=(i,t,e)=>({bi:!0,"bi-caret-up-fill":i,"bi-caret-down-fill":t,"bi-caret-up":e});function WP(i,t){if(i&1){let e=ae();l(0,"button",82),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("nombre"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function HP(i,t){if(i&1){let e=ae();l(0,"button",83),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("codigoBarras"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function $P(i,t){if(i&1){let e=ae();l(0,"button",84),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("categoria"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function zP(i,t){if(i&1){let e=ae();l(0,"button",85),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("descuentoINAPAM"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function GP(i,t){if(i&1){let e=ae();l(0,"button",86),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("generico"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function qP(i,t){if(i&1){let e=ae();l(0,"button",87),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("bajoStock"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function XP(i,t){i&1&&y(0,"i",88)}function KP(i,t){if(i&1){let e=ae();l(0,"button",89),w("click",function(){P(e);let r=_();return k(r.limpiarFiltro("duplicadosCB"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function YP(i,t){if(i&1&&(l(0,"div")(1,"div",90)(2,"div",91)(3,"label",92),d(4),s()(),l(5,"div",91)(6,"label",42),d(7,"% Desc.:"),s(),y(8,"input",93),s(),l(9,"div",94)(10,"label",42),d(11,"Inicia:"),s(),y(12,"input",95),s(),l(13,"div",94)(14,"label",42),d(15,"Termina:"),s(),y(16,"input",96),s(),l(17,"div",91)(18,"label",42),d(19,"Monedero:"),s(),l(20,"select",97)(21,"option",22),d(22,"--"),s(),l(23,"option",22),d(24,"S\xED"),s(),l(25,"option",22),d(26,"No"),s()()()()()),i&2){let e=t.$implicit;c(),p("formGroupName","promo"+e),c(3),R("Promo ",e,":"),c(17),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1)}}function QP(i,t){i&1&&(l(0,"span",115),y(1,"i",116),s())}function JP(i,t){i&1&&(l(0,"span",115),y(1,"i",117),s())}function ZP(i,t){if(i&1&&(l(0,"small",118),d(1),s()),i&2){let e=_().$implicit;c(),T(e.ubicacion)}}function e4(i,t){i&1&&y(0,"i",119)}function t4(i,t){i&1&&y(0,"i",117)}function i4(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td")(2,"input",98),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.seleccionado,r)||(a.seleccionado=r),k(r)}),s()(),l(3,"td")(4,"div",99)(5,"button",100),w("click",function(){P(e);let r=Gt(12);return k(r.click())}),l(6,"img",101),w("error",function(r){let a=P(e).$implicit,o=_();return k(o.onImgError(r,a))}),s(),N(7,QP,2,0,"span",102)(8,JP,2,0,"span",102),s(),l(9,"button",103),w("click",function(r){let a=P(e).$implicit,o=_();return r.stopPropagation(),k(o.openPreview(a))}),y(10,"i",104),s(),l(11,"input",105,0),w("change",function(r){let a=P(e).$implicit,o=_();return k(o.onFileChange(r,a))}),s()()(),l(13,"td",106)(14,"div",107),d(15),s(),N(16,ZP,2,1,"small",108),s(),l(17,"td"),d(18),s(),l(19,"td"),d(20),s(),l(21,"td",109),y(22,"input",110),s(),l(23,"td"),d(24),s(),l(25,"td"),d(26),s(),l(27,"td"),d(28),s(),l(29,"td",109),y(30,"input",110),s(),l(31,"td"),d(32),F(33,"currency"),s(),l(34,"td"),d(35),F(36,"currency"),s(),l(37,"td")(38,"button",111),w("click",function(){let r=P(e).$implicit,a=_();return k(a.editarProducto(r))}),y(39,"fa-icon",7),s(),l(40,"button",112),w("click",function(){let r=P(e).$implicit,a=_();return k(a.confirmarEliminar(r))}),N(41,e4,1,0,"i",113)(42,t4,1,0,"i",114),s()()()}if(i&2){let e=t.$implicit,n=_();Be("fila-modificada",e.modificado),c(2),J("ngModel",e.seleccionado),c(2),Be("loading",n.subiendoId===e._id),c(),p("disabled",n.subiendoId===e._id),Ye("aria-label",e.imagen?"Cambiar imagen":"Agregar imagen"),c(),p("src",e._imgSrc||n.placeholderSrc,mr),c(),p("ngIf",n.subiendoId!==e._id),c(),p("ngIf",n.subiendoId===e._id),c(),p("disabled",n.subiendoId===e._id),c(6),T(e.nombre),c(),p("ngIf",e.ubicacion),c(2),T(e.codigoBarras),c(2),T(e.categoria),c(2),p("checked",e.generico),c(2),T(e.stockMinimo),c(2),T(e.stockMaximo),c(),Be("text-danger",n.getExistencia(e)<(e.stockMinimo||0)),c(),R(" ",n.getExistencia(e)," "),c(2),p("checked",e.descuentoINAPAM),c(2),T(se(33,28,e.costo)),c(3),T(se(36,30,e.precio)),c(4),p("icon","pen"),c(),p("disabled",n.eliminandoId===e._id),c(),p("ngIf",n.eliminandoId!==e._id),c(),p("ngIf",n.eliminandoId===e._id)}}function n4(i,t){if(i&1){let e=ae();l(0,"div",120,1),w("keydown.escape",function(){P(e);let r=_();return k(r.cerrarNuevoProducto())}),l(2,"div",121),w("mousedown",function(r){return P(e),k(r.stopPropagation())})("click",function(r){return P(e),k(r.stopPropagation())}),l(3,"h3",122),d(4,"Nuevo producto"),s(),l(5,"form",123)(6,"div",124)(7,"div",125)(8,"label"),d(9,"Nombre *"),s(),y(10,"input",126,2),s(),l(12,"div",127)(13,"label"),d(14,"Rengl\xF3n 1"),s(),y(15,"input",128),s(),l(16,"div",127)(17,"label"),d(18,"Rengl\xF3n 2"),s(),y(19,"input",129),s(),l(20,"div",94)(21,"label"),d(22,"C\xF3digo de barras *"),s(),y(23,"input",130),s(),l(24,"div",94)(25,"label"),d(26,"Categor\xEDa *"),s(),y(27,"input",131),s(),l(28,"div",91)(29,"label"),d(30,"Unidad *"),s(),y(31,"input",132),s(),l(32,"div",91)(33,"label"),d(34,"Precio *"),s(),y(35,"input",133),s(),l(36,"div",91)(37,"label"),d(38,"Costo *"),s(),y(39,"input",134),s(),l(40,"div",91)(41,"label"),d(42,"Stock M\xEDn *"),s(),y(43,"input",135),s(),l(44,"div",91)(45,"label"),d(46,"Stock M\xE1x *"),s(),y(47,"input",136),s(),l(48,"div",137)(49,"label",138),d(50,"IVA"),s(),y(51,"input",139),s(),l(52,"div",137)(53,"label",140),d(54,"Gen\xE9rico"),s(),y(55,"input",141),s(),l(56,"div",137)(57,"label",142),d(58,"INAPAM"),s(),y(59,"input",143),s(),l(60,"div",91)(61,"label"),d(62,"Ubicaci\xF3n"),s(),y(63,"input",144),s()()(),l(64,"div",63)(65,"button",145),w("click",function(){P(e);let r=_();return k(r.cerrarNuevoProducto())}),d(66,"Cancelar"),s(),l(67,"button",146),w("click",function(){P(e);let r=_();return k(r.guardarNuevoProducto())}),d(68),s()()()()}if(i&2){let e=_();c(5),p("formGroup",e.nuevoProductoForm),c(62),p("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),c(),R(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var sc=class i{constructor(t,e,n,r,a,o){this.fb=t;this.cdr=e;this.modalService=n;this.productoService=r;this.renderer=o;a.addIcons(Ks,vi,Cn)}backdrop;firstInput;columnaOrden="";productos=[];productosFiltrados=[];formularioMasivo;filtrando=!1;iniciando=!1;filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1};paginaActual=1;tamanioPagina=15;direccionOrden="asc";diasSemana=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];faTimes=vi;faPlus=Cn;mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;eliminandoId=null;thumbs={};placeholderSrc="assets/images/farmBienIcon.png";baseUrl=`${He.apiUrl}`;ngOnInit(){this.iniciando=!0,this.inicializarFormulario(),this.cargarProductos(!0),this.iniciando=!1,this.formularioMasivo.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.formularioMasivo.get("promosPorDia")?.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.nuevoProductoForm=this.fb.group({nombre:["",[Pe.required,Pe.minLength(3)]],renglon1:[""],renglon2:[""],codigoBarras:["",Pe.required],unidad:["",Pe.required],precio:[null,[Pe.required,Pe.min(0)]],costo:[null,[Pe.required,Pe.min(0)]],iva:[!1],stockMinimo:[50,[Pe.required,Pe.min(0)]],stockMaximo:[100,[Pe.required,Pe.min(0)]],ubicacion:[""],categoria:["",Pe.required],generico:[!1],descuentoINAPAM:[!1]})}inicializarFormulario(){let t={};this.diasSemana.forEach(e=>{t["promo"+e]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[null]})}),this.formularioMasivo=this.fb.group({categoria:[null],descuentoINAPAM:[null],stockMinimo:[null],stockMaximo:[null],ajustePrecioModo:[null],ajustePrecioPorcentaje:[null],ajustePrecioCantidad:[null],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporadaPorcentaje:[null],promoDeTemporadaInicio:[null],promoDeTemporadaFin:[null],promoDeTemporadaMonedero:[null],promosPorDia:this.fb.group(t)})}normTxt(t){return String(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}splitWords(t){return this.normTxt(t).split(" ").filter(Boolean)}aplicarFiltros(){this.filtrando||this.iniciando||(this.filtrando=!0,this.cdr.detectChanges(),setTimeout(()=>{let t=this.filtros,e=t?.nombre?this.splitWords(t.nombre):[],n=t?.categoria?this.splitWords(t.categoria):[];this.productosFiltrados=(this.productos||[]).filter(r=>{let a=r._normNombre??this.normTxt(r?.nombre),o=e.length?e.every(S=>a.includes(S)):!0,u=t.codigoBarras?(r.codigoBarras||"").toLowerCase().includes(t.codigoBarras.toLowerCase()):!0,m=r._normCategoria??this.normTxt(r?.categoria),f=n.length?n.every(S=>m.includes(S)):!0,h=t.descuentoINAPAM===null?!0:r.descuentoINAPAM===t.descuentoINAPAM,g=t.generico===null?!0:r.generico===t.generico,x=t.bajoStock?this.getExistencia(r)<(r.stockMinimo??0):!0,b=t.duplicadosCB?this.cbDuplicados.has(this.normCB(r?.codigoBarras)):!0;return o&&u&&f&&h&&g&&x&&b}),this.paginaActual=1,this.filtrando=!1},0))}cbDuplicados=new Set;normCB(t){return String(t??"").trim().toLowerCase()}cachearNorms(){for(let t of this.productos||[])t._normNombre=this.normTxt(t?.nombre),t._normCategoria=this.normTxt(t?.categoria)}recomputarCBDuplicados(){let t=new Map;for(let e of this.productos||[]){let n=this.normCB(e?.codigoBarras);n&&t.set(n,(t.get(n)||0)+1)}this.cbDuplicados=new Set([...t.entries()].filter(([,e])=>e>1).map(([e])=>e))}limpiarFiltro(t){t==="descuentoINAPAM"&&(this.filtros[t]=null),t==="generico"&&(this.filtros[t]=null),t==="bajoStock"&&(this.filtros.bajoStock=!1),t==="duplicadosCB"&&(this.filtros.duplicadosCB=!1),(t==="nombre"||t==="categoria"||t==="codigoBarras")&&(this.filtros[t]=""),this.aplicarFiltros()}get totalPaginas(){return Math.ceil(this.productosFiltrados.length/this.tamanioPagina)}get productosPagina(){let t=(this.paginaActual-1)*this.tamanioPagina;return this.productosFiltrados.slice(t,t+this.tamanioPagina)}limpiarCamposCambioMasivo(){this.formularioMasivo.reset()}aplicarCambiosMasivos(){let t=this.formularioMasivo.value,e=this.productosFiltrados.filter(n=>n.seleccionado);if(e.length===0){Yt.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"Debes seleccionar al menos un producto para aplicar los cambios..",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}e.forEach(n=>{if(Object.keys(t).forEach(a=>{t[a]!==null&&!["ajustePrecioModo","ajustePrecioPorcentaje","ajustePrecioCantidad"].includes(a)&&a!=="promosPorDia"&&(n[a]=t[a])}),t.ajustePrecioModo==="porcentaje"&&t.ajustePrecioPorcentaje!=null){let a=t.ajustePrecioPorcentaje,o=n.precio+n.precio*(a/100);n.precio=parseFloat(o.toFixed(2))}if(t.ajustePrecioModo==="cantidad"&&t.ajustePrecioCantidad!=null){let a=t.ajustePrecioCantidad,o=n.precio+a;n.precio=parseFloat(o.toFixed(2))}(t.promoDeTemporadaPorcentaje!=null||t.promoDeTemporadaInicio!=null||t.promoDeTemporadaFin!=null||t.promoDeTemporadaMonedero!=null)&&(n.promoDeTemporada={porcentaje:t.promoDeTemporadaPorcentaje??0,inicio:new Date(t.promoDeTemporadaInicio),fin:new Date(t.promoDeTemporadaFin),monedero:t.promoDeTemporadaMonedero??!1});let r=t.promosPorDia;this.diasSemana.forEach(a=>{let o=r[`promo${a}`];(o?.porcentaje!=null||o?.inicio!=null||o?.fin!=null||o?.monedero!=null)&&(n["promo"+a]={porcentaje:o.porcentaje??0,inicio:o.inicio?new Date(o.inicio):null,fin:o.fin?new Date(o.fin):null,monedero:o.monedero??!1})}),n.modificado=!0}),this.formularioMasivo.reset(),this.grabarCambios()}get promosPorDiaForm(){return this.formularioMasivo.get("promosPorDia")}get cambiosMasivosValidos(){let t=this.formularioMasivo.value,{categoria:e,stockMinimo:n,stockMaximo:r,descuentoINAPAM:a,ajustePrecioModo:o,ajustePrecioPorcentaje:u,ajustePrecioCantidad:m,promoCantidadRequerida:f,inicioPromoCantidad:h,finPromoCantidad:g,promoDeTemporadaPorcentaje:x,promoDeTemporadaInicio:b,promoDeTemporadaFin:S,promoDeTemporadaMonedero:v}=t;return!(!(e!=null||n!=null||r!=null||a!=null||o!=null||f!=null||h!=null||g!=null||x!=null||b!=null||S!=null||v!=null||this.hayCambiosEnPromosPorDia())||o==="porcentaje"&&(u==null||isNaN(u))||o==="cantidad"&&(m==null||isNaN(m))||f!=null&&(!h||!g||new Date(h)>new Date(g))||(x!=null||b!=null||S!=null||v!=null)&&(x==null||isNaN(x)||x<=0||x>100||!b||!S||new Date(b)>new Date(S))||!this.validarPromosPorDia())}hayCambiosEnPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;return t?this.diasSemana.some(e=>{let n=t["promo"+e];return n?.porcentaje!=null||n?.inicio!=null||n?.fin!=null||n?.monedero!=null}):!1}validarPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;if(!t)return!0;for(let e of this.diasSemana){let n=t[`promo${e}`];if(!n)continue;let{porcentaje:r,inicio:a,fin:o}=n;if((r!=null||a!=null||o!=null)&&(!a||!o||new Date(a)>new Date(o)||r==null||isNaN(r)||r<=0||r>100))return!1}return!0}seleccionarTodos(t){let e=t.target.checked;this.productosFiltrados.forEach(n=>n.seleccionado=e)}editarProducto(t){let e=JSON.parse(JSON.stringify(t));this.modalService.abrirModal(e,n=>{this.guardarProductoEditado(n)})}guardarProductoEditado(t){console.log("producto actualizado en ajustes-inventario =====>",t);let e=t._id,n=Ke({},t);delete n._id,delete n.__v,delete n.createdAt,delete n.updatedAt,["precioVenta","costo","existencia","iva","minimo","maximo"].forEach(r=>{n[r]!==void 0&&n[r]!==null&&(n[r]=Number(n[r])||0)}),this.productoService.actualizarProductoIndividual(e,n).subscribe({next:()=>{Yt.default.fire({icon:"success",title:"\xC9xito",text:"Producto actualizado correctamente",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:r=>{let a=r?.error?.mensaje||r?.error?.message||r?.message||"No se pudo actualizar el producto";Yt.default.fire("Error",a,"error"),console.error("[actualizarProducto][ERROR]",r)}})}grabarCambios(){try{let t=this.productos.filter(e=>e.seleccionado);if(!t||t.length===0){Yt.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"No hay productos seleccionados para actualizar.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}Yt.default.fire({title:"\xBFDeseas guardar los cambios?",html:`Se actualizar\xE1n <b>${t.length}</b> productos.`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, guardar",cancelButtonText:"Cancelar",heightAuto:!1}).then(e=>{e.isConfirmed&&(Yt.default.fire({title:"Guardando...",allowOutsideClick:!1,allowEscapeKey:!1,heightAuto:!1,didOpen:()=>Yt.default.showLoading()}),this.productoService.actualizarProductos({productos:t}).subscribe({next:()=>{Yt.default.close(),Yt.default.fire({icon:"success",title:"Actualizaci\xF3n exitosa",text:"Los productos fueron actualizados correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1),this.productos.forEach(n=>n.seleccionado=!1),this.formularioMasivo.reset(),this.aplicarFiltros()},error:n=>{console.error("[grabarCambios] error HTTP:",n),Yt.default.close(),Yt.default.fire({icon:"error",title:"Error",text:n?.error?.mensaje||"Ocurri\xF3 un error inesperado al actualizar los productos."})}}))})}catch(t){console.error("[grabarCambios] excepci\xF3n:",t),Yt.default.fire({icon:"error",title:"Error",text:"Hubo un problema al preparar la actualizaci\xF3n."})}}ordenar(t){this.columnaOrden===t?this.direccionOrden=this.direccionOrden==="asc"?"desc":"asc":(this.columnaOrden=t,this.direccionOrden="asc"),this.productosFiltrados.sort((e,n)=>{let r=t==="existencia"?this.getExistencia(e):e?.[t],a=t==="existencia"?this.getExistencia(n):n?.[t],o=typeof r=="number"&&!isNaN(r),u=typeof a=="number"&&!isNaN(a),m;if(o&&u)m=r-a;else{let f=(r??"").toString().toLowerCase(),h=(a??"").toString().toLowerCase();m=f<h?-1:f>h?1:0}return this.direccionOrden==="asc"?m:-m}),this.paginaActual=1}getExistencia(t){return Array.isArray(t?.lotes)?t.lotes.reduce((e,n)=>e+(Number(n?.cantidad)||0),0):0}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",renglon1:"",renglon2:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){Yt.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,Yt.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:e=>{this.guardandoNuevo=!1,console.error(e),Yt.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let n=e[0],r=e[e.length-1],a=document.activeElement;t.shiftKey&&a===n?(r.focus(),t.preventDefault()):!t.shiftKey&&a===r&&(n.focus(),t.preventDefault())}confirmarEliminar(t){return Ae(this,null,function*(){let{isConfirmed:e}=yield Yt.default.fire({icon:"warning",title:"Eliminar producto",html:`
        <p>Se eliminar\xE1 <strong>${t?.nombre||""}</strong>.</p>
        <p class="text-danger">Tambi\xE9n se eliminar\xE1 de <strong>todas las farmacias</strong>.</p>
        <p>Esta acci\xF3n no se puede deshacer.</p>
      `,showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,focusCancel:!0});if(e)try{this.eliminandoId=t._id;let n=yield gi(this.productoService.eliminarProducto(t._id));this.productos=(this.productos||[]).filter(r=>r._id!==t._id),typeof this.recomputarCBDuplicados=="function"&&this.recomputarCBDuplicados(),this.aplicarFiltros(),Yt.default.fire("Eliminado",n?.mensaje||"Producto eliminado correctamente","success")}catch(n){let r=n?.error?.mensaje||n?.message||"No se pudo eliminar el producto";Yt.default.fire("Error",r,"error")}finally{this.eliminandoId=null}})}subiendoId=null;imgCacheBuster={};imageUrl(t){if(!t?._id)return this.placeholderSrc;if(typeof t.imagen=="string"&&t.imagen.trim()){let r=this.productoService.getPublicImageUrl(t.imagen),a=this.imgCacheBuster[t._id]||t.updatedAt||0;return a?`${r}?t=${encodeURIComponent(String(a))}`:r}let e=this.productoService.obtenerImagenProductoUrl(t._id),n=this.imgCacheBuster[t._id]||t.updatedAt||0;return n?`${e}?t=${encodeURIComponent(String(n))}`:e}onFileChange(t,e){let n=t.target,r=n.files&&n.files[0];n.value="",r&&this.onPickImage(r,e)}onPickImage(t,e){return Ae(this,null,function*(){if(!t||!e?._id)return;let n=yield new Promise((a,o)=>{let u=new FileReader;u.onload=()=>a(String(u.result)),u.onerror=o,u.readAsDataURL(t)}),{isConfirmed:r}=yield Yt.default.fire({title:typeof e.imagen=="string"&&e.imagen.trim()?"\xBFReemplazar imagen?":"\xBFSubir imagen?",html:`<img src="${n}" style="max-width:100%;max-height:240px;border-radius:8px;">`,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"});if(r)try{this.subiendoId=e._id;let a=yield gi(this.productoService.actualizarImagenProducto(e._id,t)),o=a&&typeof a.imagen=="string"&&a.imagen.trim()?a.imagen.trim():a&&a.producto&&typeof a.producto.imagen=="string"&&a.producto.imagen.trim()?a.producto.imagen.trim():"";if(o){e.imagen=o;let u=this.productoService.getPublicImageUrl(o),m=Date.now();e._imgSrc=`${u}?t=${m}`,this.imgCacheBuster[e._id]=m}else{let u=this.productoService.obtenerImagenProductoUrl(e._id),m=Date.now();e._imgSrc=`${u}?t=${m}`,this.imgCacheBuster[e._id]=m}yield Yt.default.fire("Listo","Imagen guardada","success")}catch(a){let o=a?.error?.mensaje||"No se pudo subir la imagen";yield Yt.default.fire("Error",o,"error")}finally{this.subiendoId=null}})}cargarProductos(t){this.productoService.obtenerProductos().subscribe({next:e=>{this.productos=(e||[]).map(n=>Wt(Ke({},n),{_imgSrc:this.placeholderSrc})),As(this.productos).pipe(Os(n=>this.productoService.getImagenObjectUrl(n._id).pipe(Rn(r=>{n._imgSrc=r||this.placeholderSrc}),Pi(()=>gt(null))),6)).subscribe(),this.cachearNorms(),this.recomputarCBDuplicados(),t&&(this.filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1}),this.aplicarFiltros()},error:e=>console.error("Error al cargar productos:",e)})}onImgError(t,e){let n=t.target;n&&n.src!==this.placeholderSrc&&(n.src=this.placeholderSrc)}trackProdBy=(t,e)=>e?._id??e?.codigoBarras??t;openPreview(t){return Ae(this,null,function*(){let e=(t?._imgSrc||"").trim();e||(e=this.placeholderSrc);try{yield this.preload(e)}catch{e=this.placeholderSrc}Yt.default.fire({width:"auto",showConfirmButton:!1,showCloseButton:!0,background:"#000",padding:0,html:`
      <div style="max-width:90vw;max-height:90vh;display:flex;align-items:center;justify-content:center">
        <img src="${e}" alt="" style="max-width:90vw;max-height:90vh;object-fit:contain" />
      </div>`})})}preload(t){return new Promise((e,n)=>{let r=new Image;r.onload=()=>e(),r.onerror=()=>n(),r.src=t})}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(Dt),ie(ac),ie(Ji),ie(yi),ie(Pa))};static \u0275cmp=Te({type:i,selectors:[["app-ajuste-inventario"]],viewQuery:function(e,n){if(e&1&&(Tt(UP,5),Tt(jP,5)),e&2){let r;bt(r=yt())&&(n.backdrop=r.first),bt(r=yt())&&(n.firstInput=r.first)}},hostBindings:function(e,n){e&1&&w("keydown",function(a){return n.trapTab(a)},!1,Ta)},decls:212,vars:83,consts:[["file",""],["backdrop",""],["firstInput",""],[1,"panel"],[1,"titulo-container","d-flex","justify-content-between","align-items-center"],[1,"titulo"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"row","mb-2","filtros-container"],[1,"col-md-3"],[1,"me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","text","name","nombre",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar nombre","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-2"],["type","text","name","codigoBarras",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar c\xF3d. barras","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["type","text","name","categoria",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar categor\xEDa","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-1"],["name","descuentoINAPAM",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","button","matTooltip","Limpiar INAPAM","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["name","generico",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar gen\xE9rico","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"form-check","mt-2"],["type","checkbox","id","filtroBajoStock","name","bajoStock",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroBajoStock",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro bajo stock",3,"click",4,"ngIf"],[1,"col-md-1","text-end","mt-3"],["matTooltip","Filtrar informaci\xF3n solicitada",1,"btn-gris",3,"click","disabled"],["class","fa fa-spinner fa-spin me-1",4,"ngIf"],[1,"me-2","mb-0","mt-2",2,"white-space","nowrap"],["type","checkbox","id","filtroCBDuplicados","name","duplicadosCB",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroCBDuplicados",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro de duplicados",3,"click",4,"ngIf"],[1,"masivos",3,"formGroup"],[1,"center-content"],[1,"subtitulo",2,"margin-right","10px"],[1,"container-masivos","mb-1"],[1,"tit-promo",2,"margin-right","1rem"],[2,"margin-right","10px"],["type","text","formControlName","categoria",2,"width","100px","margin-right","2rem"],["type","number","formControlName","stockMinimo",2,"width","50px","margin-right","2rem"],["type","number","formControlName","stockMaximo",2,"width","50px","margin-right","2rem"],["formControlName","descuentoINAPAM"],[1,"tit-promo",2,"margin-right","2rem"],[2,"margin-right","1rem",3,"ngClass"],["type","radio","formControlName","ajustePrecioModo","value","porcentaje"],["type","number","formControlName","ajustePrecioPorcentaje",2,"width","50px","margin-right","4rem"],["type","radio","formControlName","ajustePrecioModo","value","cantidad"],["type","number","formControlName","ajustePrecioCantidad",2,"width","50px","margin-right","5rem"],[1,"tit-promo",2,"margin-right","10px"],["formControlName","promoCantidadRequerida",2,"margin-right","1rem"],["type","date","formControlName","inicioPromoCantidad",2,"margin-right","1rem"],["type","date","formControlName","finPromoCantidad"],["type","number","formControlName","promoDeTemporadaPorcentaje",2,"width","50px","margin-right","1rem"],["type","date","formControlName","promoDeTemporadaInicio",2,"margin-right","1rem"],["type","date","formControlName","promoDeTemporadaFin",2,"margin-right","1rem"],["formControlName","promoDeTemporadaMonedero",2,"margin-right","2rem"],[2,"margin-top","10px",3,"formGroup"],[4,"ngFor","ngForOf"],[1,"modal-actions","mt-3"],["type","button","matTooltip","Borrar par\xE1metros del cambio masivo",1,"btn-rojo-chico",2,"margin-left","4rem",3,"click"],["type","button","matTooltip","Aplica cambios a los productos seleccionados en la tabla",1,"btn-verde-chico",2,"margin-right","4rem",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change"],[3,"click"],[1,"icono-orden",3,"ngClass"],[3,"fila-modificada",4,"ngFor","ngForOf","ngForTrackBy"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"total-registros"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["type","button","matTooltip","Limpiar nombre",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar categor\xEDa",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar INAPAM",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar gen\xE9rico",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Quitar filtro bajo stock",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fa","fa-spinner","fa-spin","me-1"],["type","button","matTooltip","Quitar filtro de duplicados",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"row",2,"margin-bottom","5px",3,"formGroupName"],[1,"col-2"],[1,"tit-promo",2,"margin-left","3rem"],["type","number","formControlName","porcentaje",2,"width","50px","height","20px"],[1,"col-3"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["formControlName","monedero"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"img-cell"],["type","button","matTooltip","Cambiar \xF3 Subir imagen",1,"img-button",3,"click","disabled"],["loading","lazy","decoding","async",3,"error","src"],["class","overlay",4,"ngIf"],["type","button","matTooltip","Ver imagen",1,"zoom-btn",3,"click","disabled"],[1,"fas","fa-search-plus"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"col-producto"],[1,"prod-nombre"],["class","prod-ubicacion",4,"ngIf"],[2,"text-align","center"],["type","checkbox","disabled","",3,"checked"],["matTooltip","Editar producto",1,"btn-icon-chico","btn-gris-chico",3,"click"],["matTooltip","Eliminar producto en TODAS las farmacias",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],["class","fas fa-trash",4,"ngIf"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"overlay"],[1,"fas","fa-upload"],[1,"fa","fa-spinner","fa-spin"],[1,"prod-ubicacion"],[1,"fas","fa-trash"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],[1,"col-6"],["type","text","formControlName","renglon1",1,"form-control"],["type","text","formControlName","renglon2",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,n){if(e&1&&(l(0,"div",3)(1,"div",4)(2,"h1",5),d(3,"Ajuste de Inventario en Almacen"),s(),l(4,"button",6),w("click",function(){return n.abrirNuevoProducto()}),y(5,"fa-icon",7),l(6,"span",8),d(7,"Nuevo"),s()()(),l(8,"div",9)(9,"div",10)(10,"label",11),d(11,"Nombre"),s(),l(12,"div",12)(13,"input",13),ee("ngModelChange",function(a){return Z(n.filtros.nombre,a)||(n.filtros.nombre=a),a}),s(),N(14,WP,2,1,"button",14),s()(),l(15,"div",15)(16,"label",11),d(17,"C\xF3digo de barras"),s(),l(18,"div",12)(19,"input",16),ee("ngModelChange",function(a){return Z(n.filtros.codigoBarras,a)||(n.filtros.codigoBarras=a),a}),s(),N(20,HP,2,1,"button",17),s()(),l(21,"div",15)(22,"label",11),d(23,"Categor\xEDa"),s(),l(24,"div",12)(25,"input",18),ee("ngModelChange",function(a){return Z(n.filtros.categoria,a)||(n.filtros.categoria=a),a}),s(),N(26,$P,2,1,"button",19),s()(),l(27,"div",20)(28,"label",11),d(29,"INAPAM"),s(),l(30,"div",12)(31,"select",21),ee("ngModelChange",function(a){return Z(n.filtros.descuentoINAPAM,a)||(n.filtros.descuentoINAPAM=a),a}),l(32,"option",22),d(33,"--"),s(),l(34,"option",22),d(35,"S\xED"),s(),l(36,"option",22),d(37,"No"),s()(),N(38,zP,2,1,"button",23),s()(),l(39,"div",20)(40,"label",11),d(41,"Gen\xE9rico?"),s(),l(42,"div",12)(43,"select",24),ee("ngModelChange",function(a){return Z(n.filtros.generico,a)||(n.filtros.generico=a),a}),l(44,"option",22),d(45,"--"),s(),l(46,"option",22),d(47,"S\xED"),s(),l(48,"option",22),d(49,"No"),s()(),N(50,GP,2,1,"button",25),s()(),l(51,"div",15)(52,"label",11),d(53,"Solo bajo stock"),s(),l(54,"div",12)(55,"div",26)(56,"input",27),ee("ngModelChange",function(a){return Z(n.filtros.bajoStock,a)||(n.filtros.bajoStock=a),a}),w("change",function(){return n.aplicarFiltros()}),s(),l(57,"label",28),d(58," Existencia < Stock M\xEDn. "),s()(),N(59,qP,2,1,"button",29),s()(),l(60,"div",30)(61,"button",31),w("click",function(){return n.aplicarFiltros()}),N(62,XP,1,0,"i",32),d(63),s()(),l(64,"div",15)(65,"label",33),d(66,"C\xF3digo Barras"),s(),l(67,"div",12)(68,"div",26)(69,"input",34),ee("ngModelChange",function(a){return Z(n.filtros.duplicadosCB,a)||(n.filtros.duplicadosCB=a),a}),w("change",function(){return n.aplicarFiltros()}),s(),l(70,"label",35),d(71," Mostrar duplicados "),s()(),N(72,KP,2,1,"button",36),s()()(),l(73,"form",37)(74,"div",38)(75,"label",39),d(76,"Cambio masivo"),s(),l(77,"label"),d(78,"(aplica a productos seleccionados en la tabla)"),s()(),l(79,"div",40)(80,"div")(81,"label",41),d(82,"Datos b\xE1sicos:"),s(),l(83,"label",42),d(84,"Categor\xEDa:"),s(),y(85,"input",43),l(86,"label",42),d(87,"Stock M\xEDnimo:"),s(),y(88,"input",44),l(89,"label",42),d(90,"Stock M\xE1ximo:"),s(),y(91,"input",45),l(92,"label",42),d(93,"INAPAM:"),s(),l(94,"select",46)(95,"option",22),d(96,"--"),s(),l(97,"option",22),d(98,"S\xED"),s(),l(99,"option",22),d(100,"No"),s()()(),l(101,"div")(102,"label",47),d(103,"Aumentar o disminuir Precios:"),s(),l(104,"label",48),y(105,"input",49),d(106,"Porcentaje "),s(),l(107,"label",42),d(108,"%:"),s(),y(109,"input",50),l(110,"label",48),y(111,"input",51),d(112,"Cantidad "),s(),l(113,"label",42),d(114,"$:"),s(),y(115,"input",52),s()(),l(116,"div")(117,"div",40)(118,"div")(119,"label",53),d(120,"Promo Cantidad Requerida:"),s(),l(121,"select",54)(122,"option",22),d(123,"--"),s(),l(124,"option",22),d(125,"2x1"),s(),l(126,"option",22),d(127,"3x2"),s(),l(128,"option",22),d(129,"4x3"),s()(),l(130,"label",42),d(131,"Inicia:"),s(),y(132,"input",55),l(133,"label",42),d(134,"Termina:"),s(),y(135,"input",56),s(),l(136,"div")(137,"label",53),d(138,"Promo Temporada:"),s(),l(139,"label",42),d(140,"% Desc.:"),s(),y(141,"input",57),l(142,"label",42),d(143,"Inicia:"),s(),y(144,"input",58),l(145,"label",42),d(146,"Termina:"),s(),y(147,"input",59),l(148,"label",42),d(149,"Monedero:"),s(),l(150,"select",60)(151,"option",22),d(152,"--"),s(),l(153,"option",22),d(154,"S\xED"),s(),l(155,"option",22),d(156,"No"),s()()()(),l(157,"div",61),N(158,YP,27,5,"div",62),s()(),l(159,"div",63)(160,"button",64),w("click",function(){return n.limpiarCamposCambioMasivo()}),d(161,"Cancelar "),s(),l(162,"button",65),w("click",function(){return n.aplicarCambiosMasivos()}),d(163," Aplicar Cambios "),s()()(),l(164,"table",66)(165,"thead")(166,"tr")(167,"th")(168,"input",67),w("change",function(a){return n.seleccionarTodos(a)}),s()(),l(169,"th"),d(170,"Imagen"),s(),l(171,"th",68),w("click",function(){return n.ordenar("nombre")}),d(172," Nombre / Ubic. "),y(173,"i",69),s(),l(174,"th",68),w("click",function(){return n.ordenar("codigoBarras")}),d(175," C\xF3digo Barras "),y(176,"i",69),s(),l(177,"th",68),w("click",function(){return n.ordenar("categoria")}),d(178," Categor\xEDa "),y(179,"i",69),s(),l(180,"th"),d(181,"Gen\xE9rico"),s(),l(182,"th"),d(183,"Stock M\xEDn."),s(),l(184,"th"),d(185,"Stock M\xE1x."),s(),l(186,"th",68),w("click",function(){return n.ordenar("existencia")}),d(187," Existencia "),y(188,"i",69),s(),l(189,"th"),d(190,"INAPAM"),s(),l(191,"th"),d(192,"Costo"),s(),l(193,"th"),d(194,"Precio"),s(),l(195,"th"),d(196,"Acciones"),s()()(),l(197,"tbody"),N(198,i4,43,32,"tr",70),s()(),l(199,"div",71)(200,"button",72),w("click",function(){return n.paginaActual=1}),y(201,"i",73),s(),l(202,"button",74),w("click",function(){return n.paginaActual=n.paginaActual-1}),y(203,"i",75),s(),d(204),l(205,"span",76),d(206),s(),l(207,"button",77),w("click",function(){return n.paginaActual=n.paginaActual+1}),y(208,"i",78),s(),l(209,"button",79),w("click",function(){return n.paginaActual=n.totalPaginas}),y(210,"i",80),s()(),N(211,n4,69,3,"div",81),s()),e&2){let r,a,o,u,m,f;c(5),p("icon",n.faPlus),c(8),J("ngModel",n.filtros.nombre),c(),p("ngIf",n.filtros.nombre),c(5),J("ngModel",n.filtros.codigoBarras),c(),p("ngIf",n.filtros.codigoBarras),c(5),J("ngModel",n.filtros.categoria),c(),p("ngIf",n.filtros.categoria),c(5),J("ngModel",n.filtros.descuentoINAPAM),c(),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("ngIf",n.filtros.descuentoINAPAM!==null),c(5),J("ngModel",n.filtros.generico),c(),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("ngIf",n.filtros.generico!==null),c(6),J("ngModel",n.filtros.bajoStock),c(3),p("ngIf",n.filtros.bajoStock),c(2),p("disabled",n.filtrando||n.iniciando),Ye("aria-busy",n.filtrando||n.iniciando),c(),p("ngIf",n.filtrando||n.iniciando),c(),R(" ",n.filtrando?"Filtrando\u2026":n.iniciando?"Iniciando\u2026":"Buscar"," "),c(6),J("ngModel",n.filtros.duplicadosCB),c(3),p("ngIf",n.filtros.duplicadosCB),c(),p("formGroup",n.formularioMasivo),c(22),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(5),p("ngClass",_i(63,Dg,((r=n.formularioMasivo.get("ajustePrecioModo"))==null?null:r.value)==="porcentaje")),c(3),Be("disabled-label",((a=n.formularioMasivo.get("ajustePrecioModo"))==null?null:a.value)!="porcentaje"),c(2),Be("disabled-label",((o=n.formularioMasivo.get("ajustePrecioModo"))==null?null:o.value)!="porcentaje"),c(),p("ngClass",_i(65,Dg,((u=n.formularioMasivo.get("ajustePrecioModo"))==null?null:u.value)==="cantidad")),c(3),Be("disabled-label",((m=n.formularioMasivo.get("ajustePrecioModo"))==null?null:m.value)!="cantidad"),c(2),Be("disabled-label",((f=n.formularioMasivo.get("ajustePrecioModo"))==null?null:f.value)!="cantidad"),c(7),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(23),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("formGroup",n.promosPorDiaForm),c(),p("ngForOf",n.diasSemana),c(4),p("disabled",!n.cambiosMasivosValidos),c(11),p("ngClass",Wi(67,oc,n.columnaOrden==="nombre"&&n.direccionOrden==="asc",n.columnaOrden==="nombre"&&n.direccionOrden==="desc",n.columnaOrden!=="nombre")),c(3),p("ngClass",Wi(71,oc,n.columnaOrden==="codigoBarras"&&n.direccionOrden==="asc",n.columnaOrden==="codigoBarras"&&n.direccionOrden==="desc",n.columnaOrden!=="codigoBarras")),c(3),p("ngClass",Wi(75,oc,n.columnaOrden==="categoria"&&n.direccionOrden==="asc",n.columnaOrden==="categoria"&&n.direccionOrden==="desc",n.columnaOrden!=="categoria")),c(9),p("ngClass",Wi(79,oc,n.columnaOrden==="existencia"&&n.direccionOrden==="asc",n.columnaOrden==="existencia"&&n.direccionOrden==="desc",n.columnaOrden!=="existencia")),c(10),p("ngForOf",n.productosPagina)("ngForTrackBy",n.trackProdBy),c(2),p("disabled",n.paginaActual===1),c(2),p("disabled",n.paginaActual===1),c(2),un(" P\xE1gina ",n.paginaActual," de ",n.totalPaginas," "),c(2),R("(",n.productosFiltrados.length," productos)"),c(),p("disabled",n.paginaActual===n.totalPaginas),c(2),p("disabled",n.paginaActual===n.totalPaginas),c(2),p("ngIf",n.mostrarNuevoProducto)}},dependencies:[Oe,si,We,Ne,Bt,ot,At,rt,at,qe,qt,li,nt,Pr,ze,Ft,_t,Lt,ci,di,qs,ti,ei,Vt,dt],styles:[".panel[_ngcontent-%COMP%]{padding:5px}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.masivos[_ngcontent-%COMP%]{font-size:small;width:100%;background-color:#b7fbe4}.center-content[_ngcontent-%COMP%]{text-align:center}.container-masivos[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.tit-promo[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.disabled-label[_ngcontent-%COMP%]{color:gray;opacity:.5;pointer-events:none}.selected-radio[_ngcontent-%COMP%]{color:#00f}.selected-checkbox[_ngcontent-%COMP%]{color:#000}.fila-modificada[_ngcontent-%COMP%]{background-color:#e6ffe6!important}.paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#0ff;background-color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .paginacion[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6;color:gray}.btn-grabar[_ngcontent-%COMP%]{text-align:center}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}.img-cell[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:30px;height:30px;padding:0;border:1px solid #e5e7eb;border-radius:6px;background:#fbfcf8;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;overflow:hidden}.img-button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;backface-visibility:hidden;-webkit-font-smoothing:antialiased}.img-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#033996;background:#bcf996}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#00000059;color:#c4fca6;opacity:0;transition:opacity .15s;pointer-events:none}.img-button[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.img-cell[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:48px;height:48px;padding:0;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;backface-visibility:hidden}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{pointer-events:none}.zoom-btn[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-6px;width:22px;height:22px;border-radius:50%;border:0;background:#0009;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;pointer-events:auto}.zoom-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;line-height:1}.zoom-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})};function r4(i,t){if(i&1&&(l(0,"span",10),d(1),s()),i&2){let e=_();c(),T(e.farmaciaNombre)}}function a4(i,t){if(i&1){let e=ae();l(0,"button",11),w("click",function(){P(e);let r=_();return k(r.router.navigate(["/home"]))}),l(1,"mat-icon"),d(2,"home"),s()()}}function o4(i,t){if(i&1){let e=ae();Ze(0),l(1,"button",12),w("click",function(){P(e);let r=_();return k(r.authService.showLogin())}),l(2,"mat-icon"),d(3,"login"),s()(),et()}}function s4(i,t){if(i&1&&(l(0,"span",16),d(1),s()),i&2){let e=_(2);c(),un(" Bienvenido, ",e.userNombre," (",e.userRol,") ")}}function l4(i,t){if(i&1){let e=ae();l(0,"div",13),N(1,s4,2,2,"span",14),l(2,"button",15),w("click",function(){P(e);let r=_();return k(r.authService.logout())}),l(3,"mat-icon"),d(4,"logout"),s()()()}if(i&2){let e=_();c(),p("ngIf",e.userNombre)}}var lc=class i{constructor(t,e,n){this.authService=t;this.router=e;this.ventaService=n;this.authService.userNombre$.subscribe(r=>{this.userNombre=r}),this.authService.userRol$.subscribe(r=>{this.userRol=r}),this.authService.isEditProfileVisible.subscribe(r=>{this.isEditProfileVisible=r,r&&(this.menuOpen=!1)})}isSidebarOpen=!1;toggleSidebar=new zt;usuario=null;userNombre=null;userRol=null;farmaciaId=null;farmaciaNombre="";isEditProfileVisible=!1;menuOpen=!1;searchQuery="";mostrarInicio=!1;userLoggedOut=new zt;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,this.userNombre=t?.nombre||null,this.userRol=t?.rol||null}),this.authService.farmacia$.subscribe(t=>{t?(this.farmaciaId=t._id,this.farmaciaNombre=t.nombre):(this.farmaciaId=null,this.farmaciaNombre="")}),this.actualizarVisibilidadInicio(),this.router.events.subscribe(()=>{this.actualizarVisibilidadInicio()})}actualizarVisibilidadInicio(){if(this.router.url==="/home"){this.mostrarInicio=!1;return}this.mostrarInicio=this.authService.isLoggedIn}irAInicio(){this.router.navigate(["/home"])}toggleMenu(){this.isEditProfileVisible||(this.menuOpen=!this.menuOpen)}logout(){this.authService.logout(),this.userLoggedOut.emit()}openChangePassword(){this.menuOpen=!1,this.authService.showChangePassword()}openUpdateProfile(){this.menuOpen=!1,this.authService.showEditProfile()}clearSearch(){this.searchQuery=""}static \u0275fac=function(e){return new(e||i)(ie(Kt),ie(Yi),ie($a))};static \u0275cmp=Te({type:i,selectors:[["app-header"]],inputs:{isSidebarOpen:"isSidebarOpen"},outputs:{toggleSidebar:"toggleSidebar",userLoggedOut:"userLoggedOut"},decls:14,vars:5,consts:[["loggedInTemplate",""],[1,"header"],[1,"header-left"],[1,"toggle-sidebar-button",3,"click"],["src","assets/images/farmBienIcon.png","alt","Logo",1,"header-logo"],[1,"site-title"],["class","site-sucursal",4,"ngIf"],[1,"header-right"],["mat-icon-button","","matTooltip","Ir al inicio","class","icon-button",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"site-sucursal"],["mat-icon-button","","matTooltip","Ir al inicio",1,"icon-button",3,"click"],["mat-icon-button","","matTooltip","Iniciar sesi\xF3n",1,"icon-button",3,"click"],[1,"user-info-container",2,"display","flex","align-items","center","gap","10px"],["class","user-info",4,"ngIf"],["mat-icon-button","","matTooltip","Cerrar sesi\xF3n",1,"icon-button-exit",3,"click"],[1,"user-info"]],template:function(e,n){if(e&1){let r=ae();l(0,"header",1)(1,"div",2)(2,"button",3),w("click",function(){return P(r),k(n.toggleSidebar.emit())}),l(3,"mat-icon"),d(4),s()(),y(5,"img",4),l(6,"span",5),d(7,"Farmacias del Bienestar para Todos"),s(),N(8,r4,2,1,"span",6),s(),l(9,"div",7),N(10,a4,3,0,"button",8)(11,o4,4,0,"ng-container",9)(12,l4,5,1,"ng-template",null,0,ka),s()()}if(e&2){let r=Gt(13);c(4),T(n.isSidebarOpen?"close":"menu"),c(4),p("ngIf",n.farmaciaNombre),c(2),p("ngIf",n.mostrarInicio),c(),p("ngIf",!n.authService.isLoggedIn)("ngIfElse",r)}},dependencies:[Ne,Ma,Qn,Mr,ot,Vt,dt],styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 .5rem;background-color:#007bff;color:#fff;height:80px;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.toggle-sidebar-button[_ngcontent-%COMP%]{font-size:24px;margin:0;padding:0;color:#fff;background:none;border:none;cursor:pointer}.header-logo[_ngcontent-%COMP%]{height:30px;margin-right:10px}.site-title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.site-sucursal[_ngcontent-%COMP%]{font-size:20px;font-weight:500;color:#b5b5fc}a[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{padding:.5rem;border-radius:6px;border:none;width:300px}.clear-button[_ngcontent-%COMP%], .search-button[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;margin-left:5px;cursor:pointer;color:#fff}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.user-info[_ngcontent-%COMP%]{font-size:14px}.config-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#fff}.config-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;vertical-align:middle}.relative[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;box-shadow:0 4px 6px #0000001a;border-radius:5px;padding:10px 0;min-width:160px;z-index:1200;display:flex;flex-direction:column}.dropdown-item[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 15px;background:none;border:none;text-align:left;cursor:pointer;font-size:14px;transition:background .3s}.dropdown-item[_ngcontent-%COMP%]:hover{background:#f2f2f2}.dropdown-divider[_ngcontent-%COMP%]{border:0;height:1px;background-color:#ddd;margin:5px 0}.search-container[_ngcontent-%COMP%]{flex:1;max-width:600px;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{flex:1;max-width:50%;min-width:200px;padding:6px 12px;border-radius:4px;border:1px solid #ccc}.search-button[_ngcontent-%COMP%], .clear-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:5px;font-size:18px}.clear-button[_ngcontent-%COMP%]{color:#086d86;margin-right:5px}.icon-button[_ngcontent-%COMP%]{color:#9acd32;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,red,#ece6e6);color:#ff0}.icon-button-exit[_ngcontent-%COMP%]{color:#f80404;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button-exit[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#f80404,#fff);color:#ff0}@media (max-width: 768px){.user-info[_ngcontent-%COMP%]{display:none}}"]})};function c4(i,t){if(i&1){let e=ae();l(0,"li",4)(1,"span",5),w("click",function(){P(e);let r=_();return k(r.toggleMenu("catalogs"))}),d(2),s()()}if(i&2){let e=_();c(2),R(" Cat\xE1logos ",e.expandedMenu==="catalogs"?"\u25B2":"\u25B6"," ")}}function d4(i,t){i&1&&(l(0,"ul",6)(1,"li",11),d(2," Compras "),y(3,"fa-icon",9),s(),l(4,"li",11),d(5," Surtir Farmacia "),y(6,"fa-icon",9),s(),l(7,"li",11),d(8," Ajustes inventario "),y(9,"fa-icon",9),s(),l(10,"li",11),d(11," Presupuesto compras "),y(12,"fa-icon",9),s()()),i&2&&(c(),p("routerLink","/compras"),c(2),p("icon","truck"),c(),p("routerLink","/surtir-farmacia"),c(2),p("icon","shopping-cart"),c(),p("routerLink","/ajustes-inventario"),c(2),p("icon","file-signature"),c(),p("routerLink","/reporte-presupuesto"),c(2),p("icon","file-signature"))}function u4(i,t){if(i&1){let e=ae();l(0,"li",10)(1,"span",5),w("click",function(){P(e);let r=_(2);return k(r.toggleSubMenu("almacen"))}),d(2," Almac\xE9n "),y(3,"fa-icon",9),d(4),s(),N(5,d4,13,8,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","warehouse"),c(),R(" ",e.expandedSubMenu==="almacen"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="almacen")}}function m4(i,t){i&1&&(l(0,"ul",6)(1,"li",11),d(2," Mantenimiento "),y(3,"fa-icon",9),s(),l(4,"li",11),d(5," Inventario "),y(6,"fa-icon",9),s()()),i&2&&(c(),p("routerLink","/farmacias"),c(2),p("icon","truck"),c(),p("routerLink","/inventario-farmacias"),c(2),p("icon","file-signature"))}function f4(i,t){if(i&1){let e=ae();l(0,"ul",6),N(1,u4,6,3,"li",7),l(2,"li",8),d(3,"Proveedores "),y(4,"fa-icon",9),s(),l(5,"li",10)(6,"span",5),w("click",function(){P(e);let r=_();return k(r.toggleSubMenu("farmacias"))}),d(7," Farmacias "),y(8,"fa-icon",9),d(9),s(),N(10,m4,7,4,"ul",3),s(),l(11,"li",8),d(12,"Usuarios "),y(13,"fa-icon",9),s(),l(14,"li",8),d(15,"Clientes - reportes"),y(16,"fa-icon",9),s(),l(17,"li",8),d(18,"Cortes de caja "),y(19,"fa-icon",9),s()()}if(i&2){let e=_();c(),p("ngIf",e.userRol==="admin"),c(),p("routerLink","/proveedores"),c(2),p("icon","truck"),c(4),p("icon","warehouse"),c(),R(" ",e.expandedSubMenu==="farmacias"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="farmacias"),c(),p("routerLink","/usuarios"),c(2),p("icon","user"),c(),p("routerLink","/clientes"),c(2),p("icon","users"),c(),p("routerLink","/cortes-de-caja"),c(2),p("icon","file-signature")}}function p4(i,t){i&1&&(l(0,"li",8),d(1," Ventas "),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/ventas"),c(2),p("icon","cash-register"))}function h4(i,t){i&1&&(l(0,"li",8),d(1," Devoluciones "),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/devoluciones"),c(2),p("icon","undo"))}function g4(i,t){i&1&&(l(0,"li",8),d(1," Pedidos especiales"),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/pedidos"),c(2),p("icon","shopping-cart"))}function _4(i,t){i&1&&(l(0,"li",8),d(1," Corte de caja"),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/inicio-turno"),c(2),p("icon","file-signature"))}function v4(i,t){i&1&&(l(0,"li"),d(1," Consultas m\xE9dicas "),y(2,"fa-icon",9),s()),i&2&&(c(2),p("icon","stethoscope"))}function x4(i,t){i&1&&(l(0,"li"),d(1," Recetas "),y(2,"fa-icon",9),s()),i&2&&(c(2),p("icon","prescription"))}function b4(i,t){if(i&1&&(l(0,"ul",6),N(1,p4,3,2,"li",12)(2,h4,3,2,"li",12)(3,g4,3,2,"li",12)(4,_4,3,2,"li",12)(5,v4,3,1,"li",13)(6,x4,3,1,"li",13),s()),i&2){let e=_();c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="medico"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="medico")}}function y4(i,t){if(i&1){let e=ae();l(0,"li",4)(1,"span",5),w("click",function(){P(e);let r=_();return k(r.toggleMenu("reports"))}),d(2),s()()}if(i&2){let e=_();c(2),R(" Reportes ",e.expandedMenu==="reports"?"\u25B2":"\u25B6"," ")}}function C4(i,t){if(i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Ventas"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Productos Ventas - Exist "),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Un s\xF3lo producto"),y(12,"fa-icon",9),s()(),l(13,"li",11)(14,"span"),d(15,"Devoluciones ventas"),y(16,"fa-icon",9),s()(),l(17,"li",11)(18,"span"),d(19,"Pedidos"),y(20,"fa-icon",9),s()(),l(21,"li",11)(22,"span"),d(23,"Cancelaciones pedidos"),y(24,"fa-icon",9),s()()()),i&2){let e=_(3);c(),p("routerLink","reporte/ventas"),c(3),p("icon","cash-register"),c(),p("routerLink","/reporte/ventas-por-farmacia"),c(3),p("icon",e.icons.reporteVentas),c(),p("routerLink","reporte/ventas-producto"),c(3),p("icon",e.icons.faReceipt),c(),p("routerLink","reportes/devoluciones"),c(3),p("icon","undo"),c(),p("routerLink","/reporte/pedidos"),c(3),p("icon","shopping-cart"),c(),p("routerLink","reportes/cancelaciones"),c(3),p("icon","undo")}}function S4(i,t){if(i&1){let e=ae();l(0,"li",10)(1,"span",5),w("click",function(){P(e);let r=_(2);return k(r.toggleSubMenu("ventas"))}),d(2," Ventas - Pedidos "),y(3,"fa-icon",9),d(4),s(),N(5,C4,25,12,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","cash-register"),c(),R(" ",e.expandedSubMenu==="ventas"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="ventas")}}function w4(i,t){i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Compras general"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Compras resumen"),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Compras x Producto"),y(12,"fa-icon",9),s()()()),i&2&&(c(),p("routerLink","reporte/compras"),c(3),p("icon","shopping-cart"),c(),p("routerLink","reportes-compras"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reportes/compras-historial-producto"),c(3),p("icon","sack-dollar"))}function E4(i,t){if(i&1){let e=ae();l(0,"li",10)(1,"span",5),w("click",function(){P(e);let r=_(2);return k(r.toggleSubMenu("compras"))}),d(2," Compras "),y(3,"fa-icon",9),d(4),s(),N(5,w4,13,6,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","truck"),c(),R(" ",e.expandedSubMenu==="compras"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="compras")}}function T4(i,t){i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Resumen utilidades"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"TOP utilidades"),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Compras vs Ventas"),y(12,"fa-icon",9),s()()()),i&2&&(c(),p("routerLink","reporte/resumen-utilidades"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reporte/utilidades"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reportes/compras-ventas"),c(3),p("icon","sack-dollar"))}function P4(i,t){if(i&1){let e=ae();l(0,"li",10)(1,"span",5),w("click",function(){P(e);let r=_(2);return k(r.toggleSubMenu("balance"))}),d(2," Balance "),y(3,"fa-icon",9),d(4),s(),N(5,T4,13,6,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","scale-balanced"),c(),R(" ",e.expandedSubMenu==="balance"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="balance")}}function k4(i,t){if(i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Impresi\xF3n "),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Dise\xF1o "),y(8,"fa-icon",9),s()()()),i&2){let e=_(3);c(),p("routerLink","etiquetas/print"),c(3),p("icon",e.faPrint),c(),p("routerLink","etiquetas/design"),c(3),p("icon",e.faPenRuler)}}function I4(i,t){if(i&1){let e=ae();l(0,"li",10)(1,"span",5),w("click",function(){P(e);let r=_(2);return k(r.toggleSubMenu("etiquetas"))}),d(2," Etiquetas "),y(3,"fa-icon",9),d(4),s(),N(5,k4,9,4,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon",e.faTags),c(),R(" ",e.expandedSubMenu==="etiquetas"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="etiquetas")}}function M4(i,t){if(i&1&&(l(0,"ul",6),N(1,S4,6,3,"li",7)(2,E4,6,3,"li",7)(3,P4,6,3,"li",7)(4,I4,6,3,"li",7),s()),i&2){let e=_();c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin")}}var cc=class i{constructor(t,e,n){this.authService=t;this.library=e;this.router=n;this.library.addIcons(xf,Km,Zm,ff,cf,Jm,Ym,df,mf,nf,uf,tf,zm,of,qm,vf,b0,gf)}open=!1;openChange=new zt;usuario=null;userRol=null;isSidebarOpen=!1;expandedMenu=null;expandedSubMenu=null;icons={reporteVentas:b0,faReceipt:pf};faTags=rf;faPrint=yf;faPenRuler=Xm;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,t&&t.rol&&(this.userRol=t.rol)}),this.router.events.pipe(Kr(t=>t instanceof Hs)).subscribe(()=>this.close())}closeSidebar(){this.isSidebarOpen=!1}toggleSidebar(){this.open=!this.open,this.openChange.emit(this.open)}toggleMenu(t){this.expandedMenu===t?(this.expandedMenu=null,this.expandedSubMenu=null):(this.expandedMenu=t,this.expandedSubMenu=null)}toggleSubMenu(t){this.expandedSubMenu=this.expandedSubMenu===t?null:t}close(){this.open&&(this.open=!1,this.openChange.emit(this.open))}get isLoggedIn(){return!!this.usuario}get currentRol(){return this.usuario?.rol||null}static \u0275fac=function(e){return new(e||i)(ie(Kt),ie(yi),ie(Yi))};static \u0275cmp=Te({type:i,selectors:[["app-sidebar"]],inputs:{open:"open"},outputs:{openChange:"openChange"},decls:11,vars:8,consts:[[1,"sidebar"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"sidebar-image"],["class","menu-title",4,"ngIf"],["class","submenu",4,"ngIf"],[1,"menu-title"],[3,"click"],[1,"submenu"],["class","has-submenu",4,"ngIf"],["routerLinkActive","active",3,"routerLink"],[1,"menu-icon",3,"icon"],[1,"has-submenu"],["routerLinkActive","active",1,"submenu-item",3,"routerLink"],["routerLinkActive","active",3,"routerLink",4,"ngIf"],[4,"ngIf"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"ul"),y(2,"img",1),N(3,c4,3,1,"li",2)(4,f4,20,12,"ul",3),l(5,"li",4)(6,"span",5),w("click",function(){return n.toggleMenu("movements")}),d(7),s()(),N(8,b4,7,6,"ul",3)(9,y4,3,1,"li",2)(10,M4,5,4,"ul",3),s()()),e&2&&(Be("open",n.open),c(3),p("ngIf",n.userRol==="admin"),c(),p("ngIf",n.expandedMenu==="catalogs"),c(3),R(" Movimientos ",n.expandedMenu==="movements"?"\u25B2":"\u25B6"," "),c(),p("ngIf",n.expandedMenu==="movements"),c(),p("ngIf",n.userRol==="admin"),c(),p("ngIf",n.expandedMenu==="reports"))},dependencies:[Oe,Ne,ti,ei,Ma,Vm,Um],styles:[".sidebar[_ngcontent-%COMP%]{width:0;transition:width .3s ease-in-out;background:#007bff;overflow-x:hidden;height:100%;padding:0}.sidebar.open[_ngcontent-%COMP%]{width:280px;padding:0}.sidebar[_ngcontent-%COMP%]:not(.open)   ul[_ngcontent-%COMP%]{display:none}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;color:#fff;margin-left:auto}.sidebar-image[_ngcontent-%COMP%]{width:60%;max-width:150px;border-radius:10px;margin-bottom:15px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}li[_ngcontent-%COMP%]{margin:10px 0;cursor:pointer;font-size:14px;font-weight:400;color:#fff;display:flex;justify-content:space-between;align-items:center;padding:5px 10px}li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#f99f18}.menu-icon[_ngcontent-%COMP%]{color:#010e26;font-size:16px;margin-left:10px}.menu-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#d9ef0a;text-align:left;padding:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.2)}.submenu[_ngcontent-%COMP%]{padding:10px;border-radius:5px}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px;font-size:14px;color:#fff}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#ffebcd}.sidebar[_ngcontent-%COMP%]   ul.submenu[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{position:relative}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{margin-left:1.5rem;margin-top:.3rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.2rem 0;padding-left:.5rem;font-size:.95rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{display:block}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:5px 10px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{list-style-type:disc;list-style-position:inside;margin:.4rem 0 0 1.5rem;padding:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:list-item;padding:4px 10px;margin:0;font-size:14px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:none}.submenu-item[_ngcontent-%COMP%]{color:#fb8a39!important}.submenu-item[_ngcontent-%COMP%]:hover{color:brown!important;background-color:#f0f8ff!important}"]})};function F4(i,t){if(i&1&&y(0,"app-sidebar",6),i&2){let e=_();p("open",e.isSidebarOpen)}}function A4(i,t){i&1&&y(0,"app-login")}var dc=class i{constructor(t,e){this.authService=t;this.router=e}usuario=null;isLoginVisible;isSidebarOpen=!1;ngOnInit(){this.authService.notifyUserChange(),this.authService.usuario$.subscribe(t=>{this.usuario=t}),this.isLoginVisible=this.authService.isLoginVisible.asObservable(),this.router.events.pipe(Kr(t=>t instanceof Hs)).subscribe(()=>{this.isSidebarOpen=!1})}onToggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen}static \u0275fac=function(e){return new(e||i)(ie(Kt),ie(Yi))};static \u0275cmp=Te({type:i,selectors:[["app-main-layout"]],decls:8,vars:5,consts:[[1,"layout-container"],[3,"open",4,"ngIf"],[1,"content-area"],[3,"toggleSidebar","isSidebarOpen"],[4,"ngIf"],[1,"main-content"],[3,"open"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,F4,1,1,"app-sidebar",1),l(2,"div",2)(3,"app-header",3),w("toggleSidebar",function(){return n.onToggleSidebar()}),s(),N(4,A4,1,0,"app-login",4),F(5,"async"),l(6,"main",5),y(7,"router-outlet"),s()()()),e&2&&(c(),p("ngIf",n.usuario),c(2),p("isSidebarOpen",n.isSidebarOpen),c(),p("ngIf",se(5,3,n.isLoginVisible)))},dependencies:[Oe,Ne,Ws,Ma,$s,lc,cc,Ua],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;min-height:100vh}.content-area[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:1rem}"]})};var In=class i{constructor(t){this.http=t}url=`${He.apiUrl}/reportes`;getVentasPorFarmacia(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-por-farmacia`,{params:e})}buildParams(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{if(r==null||r==="")return;let a=r instanceof Date?this.toLocalISODate(r):String(r);e=e.set(n,a)}),e}toLocalISODate(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}getVentasProductoDetalle(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-producto-detalle`,{params:e})}toYmdLocal(t){if(!t)return;if(typeof t=="string"){let o=t.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(o)return`${o[3]}-${o[2]}-${o[1]}`;let u=t.match(/^(\d{4})-(\d{2})-(\d{2})/);return u?`${u[1]}-${u[2]}-${u[3]}`:void 0}let e=t instanceof Date?t:new Date(t);if(isNaN(e.getTime()))return;let n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}getVentas(t){let e=`${this.url}/ventas/consulta`,n=localStorage.getItem("auth_token")||"",r=new Qe({"x-auth-token":n}),a={farmaciaId:t.farmaciaId,clienteId:t.clienteId,usuarioId:t.usuarioId,totalDesde:t.totalDesde!=null?String(t.totalDesde):void 0,totalHasta:t.totalHasta!=null?String(t.totalHasta):void 0,fechaInicial:this.toYmdLocal(t.fechaInicial),fechaFinal:this.toYmdLocal(t.fechaFinal),page:t.page!=null?String(t.page):void 0,limit:t.limit!=null?String(t.limit):void 0},o=new Ht;return Object.keys(a).forEach(u=>{let m=a[u];m!==void 0&&m!==""&&(o=o.set(u,m))}),this.http.get(e,{params:o,headers:r})}getResumenUtilidades(t){let e=`${this.url}/resumen-utilidades`,n=localStorage.getItem("auth_token")||"",r=new Qe({"x-auth-token":n}),a={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),farmaciaId:t.farmaciaId||void 0},o=new Ht;return Object.keys(a).forEach(u=>{let m=a[u];m!==void 0&&m!==""&&(o=o.set(u,m))}),this.http.get(e,{params:o,headers:r})}getUtilidadPorClientes(t){let e=`${this.url}/utilidad-cliente`,n=new Qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),clienteId:t.clienteId||void 0,CantClientes:t.CantClientes||t.cantClientes,orden:t.orden||"utilidad",dir:t.dir||"desc"},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}getUtilidadPorProductos(t){let e=`${this.url}/utilidad-producto`,n=new Qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),productoId:t.productoId||void 0,cantProductos:t.cantProductos,orden:t.orden||"utilidad",dir:t.dir||"desc",farmaciaId:t.farmaciaId||void 0},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}getUtilidadPorUsuarios(t){let e=`${this.url}/utilidad-usuario`,n=new Qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),usuarioId:t.usuarioId||void 0,orden:t.orden||"utilidad",dir:t.dir||"desc"},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var O4=i=>({"text-danger":i});function D4(i,t){if(i&1&&(l(0,"option",30),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function R4(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td",31),d(10),F(11,"number"),s(),l(12,"td",31),d(13),F(14,"currency"),s(),l(15,"td",31),d(16),F(17,"currency"),s(),l(18,"td",32),d(19),F(20,"currency"),s(),l(21,"td",31),d(22),F(23,"number"),s(),l(24,"td",31),d(25),F(26,"number"),s(),l(27,"td",31),d(28),F(29,"number"),s(),l(30,"td",31)(31,"span",33),d(32),F(33,"number"),s()()()),i&2){let e=t.$implicit,n=_();c(2),T(e.farmacia),c(2),T(e.nombre),c(2),T(e.codigoBarras||"\u2014"),c(2),T(e.categoria||"\u2014"),c(2),T(se(11,14,e.cantidadVendida)),c(3),T(se(14,16,e.costoTotal)),c(3),T(se(17,18,e.importeVendido)),c(2),p("ngClass",_i(31,O4,(e.utilidad||0)<0)),c(),R(" ",se(20,20,e.utilidad)," "),c(3),R(" ",e.margenPct==null?"\u2014":Q(23,22,e.margenPct,"1.0-2")+"%"," "),c(3),T(se(26,25,e.stockMin)),c(3),T(se(29,27,e.stockMax)),c(3),p("ngClass",n.semaforoClass(e)),c(),R(" ",se(33,29,e.existencia)," ")}}function N4(i,t){i&1&&(l(0,"tr")(1,"td",34),d(2,"Sin resultados"),s()())}function B4(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",35)(2,"td",36),d(3,"Totales:"),s(),l(4,"td",31),d(5),F(6,"number"),s(),l(7,"td",31),d(8),F(9,"currency"),s(),l(10,"td",31),d(11),F(12,"currency"),s(),l(13,"td",31),d(14),F(15,"currency"),s(),l(16,"td",31),d(17),F(18,"number"),s(),l(19,"td",37),d(20),F(21,"number"),s()()()),i&2){let e=_();c(5),T(se(6,6,e.totalCantidad)),c(3),T(se(9,8,e.totalCosto)),c(3),T(se(12,10,e.totalImporte)),c(3),T(se(15,12,e.totalUtilidad)),c(3),R(" ",e.totalMargenPct==null?"\u2014":Q(18,14,e.totalMargenPct,"1.0-2")+"%"," "),c(3),T(se(21,17,e.totalExistencia))}}function L4(i,t){if(i&1){let e=ae();l(0,"div",38)(1,"button",39),w("click",function(){P(e);let r=_();return k(r.goFirst())}),y(2,"i",40),s(),l(3,"button",41),w("click",function(){P(e);let r=_();return k(r.goPrev())}),y(4,"i",42),s(),d(5),l(6,"button",43),w("click",function(){P(e);let r=_();return k(r.goNext())}),y(7,"i",44),s(),l(8,"button",45),w("click",function(){P(e);let r=_();return k(r.goLast())}),y(9,"i",46),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),yn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}var uc=class i{constructor(t,e,n){this.reportes=t;this.farmaciaService=e;this.productosSrv=n}semaforoClass(t){let e=Number(t?.existencia??0),n=Number(t?.stockMin??0),r=Number(t?.stockMax??0);return r>0&&e>=r?"sem-green":n>0&&e<=n?"sem-red":r>0||n>0?"sem-yellow":"sem-muted"}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQ="";categoriaQ="";cargando=!1;rows=[];totalImporte=0;totalCantidad=0;totalExistencia=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}sort=null;ngOnInit(){this.cargarFarmacias(),this.buscar()}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]})}buscar(){let t=e=>e?new Date(e).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasPorFarmacia({farmaciaId:this.farmaciaId||void 0,fechaIni:t(this.fechaIni),fechaFin:t(this.fechaFin),productoQ:this.productoQ?.trim()||void 0,categoriaQ:this.categoriaQ?.trim()||void 0}).subscribe({next:e=>{let n=e?.data||[],r=a=>Number.isFinite(Number(a))?Number(a):0;this.rows=n,this.totalImporte=n.reduce((a,o)=>a+r(o.importeVendido),0),this.totalCantidad=n.reduce((a,o)=>a+r(o.cantidadVendida),0),this.totalCosto=n.reduce((a,o)=>a+r(o.costoTotal),0),this.totalUtilidad=n.reduce((a,o)=>a+r(o.utilidad),0),this.totalExistencia=n.reduce((a,o)=>a+r(o.existencia),0),this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination?.(),this.cargando=!1,console.log("productos filtrados =====>",e)},error:e=>{console.error("Error reporte ventas:",e),this.rows=[],this.totalImporte=this.totalCantidad=this.totalExistencia=this.totalCosto=this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}clearProducto(){this.productoQ=""}limpiarFiltros(){this.farmaciaId="",this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.clearProducto(),this.rows=[],this.totalCantidad=0,this.totalExistencia=0,this.totalImporte=0,this.totalItems=0,this.page=1,this.sort=null,this.buscar()}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}exportarCSV(){return Ae(this,null,function*(){if(!this.rows.length)return;let t=[{key:"farmacia",label:"C\xF3d. barras"},{key:"nombre",label:"Producto"},{key:"codigoBarras",label:"C\xF3d. barras"},{key:"categoria",label:"Categor\xEDa"},{key:"cantidadVendida",label:"Vendidos"},{key:"costoTotal",label:"Costo total",map:o=>Number(o.costoTotal??0).toFixed(2)},{key:"importeVendido",label:"Importe"},{key:"utilidad",label:"Utilidad",map:o=>Number(o.utilidad??0).toFixed(2)},{key:"margenPct",label:"margenPct",map:o=>Number(o.margenPct??0).toFixed(2)},{key:"stockMin",label:"Stock M\xEDn."},{key:"stockMax",label:"Stock M\xE1x."},{key:"existencia",label:"Existencia"}],{toCSV:e,downloadCSV:n}=yield import("./chunk-SHYHNXMB.js"),r=e(this.rows,t,{separator:",",bom:!0}),a=`ventas_farmacia_${this.fechaIni}_a_${this.fechaFin}.csv`;n(a,r)})}setSort(t){let n={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];!this.sort||this.sort.key!==n?this.sort={key:n,dir:"asc"}:this.sort={key:n,dir:this.sort.dir==="asc"?"desc":"asc"},this.page=1}sortIcon(t){let n={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];return!this.sort||this.sort.key!==n?"swap_vert":this.sort.dir==="asc"?"arrow_upward":"arrow_downward"}get sortedRows(){if(!this.sort)return this.rows;let{key:t,dir:e}=this.sort;return t==="nombre"?[...this.rows].sort((n,r)=>{let a=(n.nombre||"").localeCompare(r.nombre||"","es",{sensitivity:"base"});return e==="asc"?a:-a}):[...this.rows].sort((n,r)=>{let a=Number(n?.[t]??NaN),o=Number(r?.[t]??NaN),u=Number.isNaN(a),m=Number.isNaN(o);return u&&m?0:u?e==="asc"?1:-1:m||a<o?e==="asc"?-1:1:a>o?e==="asc"?1:-1:(n.nombre||"").localeCompare(r.nombre||"","es",{sensitivity:"base"})})}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.sortedRows.slice(t,t+this.pageSize)}static \u0275fac=function(e){return new(e||i)(ie(In),ie(Xt),ie(Ji))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas-por-farmacia"]],decls:89,vars:23,consts:[[1,"p-1"],[1,"titulo-container"],[1,"mb-3","titulo"],[1,"row","filtros","align-items-end",3,"ngSubmit"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],["type","text","name","productoQ","placeholder","7501234, ibuprof...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn-rojo-chico",3,"click","disabled"],[1,"fas","fa-times"],["type","text","name","categoriaQ",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"col-md-2","d-flex","gap-2","justify-content-end","align-items-end"],["type","button","matTooltip","Limpiar filtro",1,"btn-rojo",3,"click","disabled"],["type","submit",1,"btn-gris",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"mt-2"],[1,"align-middle","tabla"],[1,"sortable",3,"click"],["inline","",1,"ms-1"],[2,"white-space","nowrap"],[1,"text-end","sortable",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"value"],[1,"text-end"],[1,"text-end",3,"ngClass"],[1,"sem",3,"ngClass"],["colspan","12",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","4",1,"text-end"],["colspan","3",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h2",2),d(3,"Productos:\xA0 Ventas - Existencia"),s()(),l(4,"form",3),w("ngSubmit",function(){return n.buscar()}),l(5,"div",4)(6,"label",5),d(7,"Farmacia"),s(),l(8,"select",6),ee("ngModelChange",function(a){return Z(n.farmaciaId,a)||(n.farmaciaId=a),a}),l(9,"option",7),d(10,"Todas"),s(),N(11,D4,2,2,"option",8),s()(),l(12,"div",4)(13,"label",5),d(14,"Fecha inicial"),s(),l(15,"input",9),ee("ngModelChange",function(a){return Z(n.fechaIni,a)||(n.fechaIni=a),a}),s()(),l(16,"div",4)(17,"label",5),d(18,"Fecha final"),s(),l(19,"input",10),ee("ngModelChange",function(a){return Z(n.fechaFin,a)||(n.fechaFin=a),a}),s()(),l(20,"div",4)(21,"label",5),d(22,"Producto"),s(),l(23,"div",11)(24,"input",12),ee("ngModelChange",function(a){return Z(n.productoQ,a)||(n.productoQ=a),a}),w("keyup.enter",function(){return n.buscar()}),s(),l(25,"button",13),w("click",function(){return n.clearProducto()}),y(26,"i",14),s()()(),l(27,"div",4)(28,"label",5),d(29,"Categ."),s(),l(30,"div",11)(31,"input",15),ee("ngModelChange",function(a){return Z(n.categoriaQ,a)||(n.categoriaQ=a),a}),w("keyup.enter",function(){return n.buscar()}),s(),l(32,"button",13),w("click",function(){return n.categoriaQ=""}),y(33,"i",14),s()()(),l(34,"div",16)(35,"button",17),w("click",function(){return n.limpiarFiltros()}),y(36,"i",14),s(),l(37,"button",18),d(38),s()()(),l(39,"div",19)(40,"button",20),w("click",function(){return n.exportarCSV()}),d(41," Exportar CSV "),s()(),l(42,"div",21)(43,"table",22)(44,"thead")(45,"tr")(46,"th"),d(47,"Farmacia"),s(),l(48,"th",23),w("click",function(){return n.setSort("producto")}),d(49," Producto "),l(50,"mat-icon",24),d(51),s()(),l(52,"th",25),d(53,"C\xF3d. barras"),s(),l(54,"th",25),d(55,"Categor\xEDa"),s(),l(56,"th",26),w("click",function(){return n.setSort("cantidad")}),d(57," Vendidos "),l(58,"mat-icon",24),d(59),s()(),l(60,"th",26),w("click",function(){return n.setSort("costo")}),d(61," Costo total "),l(62,"mat-icon",24),d(63),s()(),l(64,"th",26),w("click",function(){return n.setSort("importe")}),d(65," Importe "),l(66,"mat-icon",24),d(67),s()(),l(68,"th",26),w("click",function(){return n.setSort("utilidad")}),d(69," Utilidad "),l(70,"mat-icon",24),d(71),s()(),l(72,"th",26),w("click",function(){return n.setSort("margen")}),d(73," % Gan. "),l(74,"mat-icon",24),d(75),s()(),l(76,"th"),d(77,"Stock M\xEDn."),s(),l(78,"th"),d(79,"Stock M\xE1x."),s(),l(80,"th",26),w("click",function(){return n.setSort("existencia")}),d(81," Existencia "),l(82,"mat-icon",24),d(83),s()()()(),l(84,"tbody"),N(85,R4,34,33,"tr",27)(86,N4,3,0,"tr",28),s(),N(87,B4,22,19,"tfoot",28),s(),N(88,L4,10,7,"div",29),s()()),e&2&&(c(8),J("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(4),J("ngModel",n.fechaIni),c(4),J("ngModel",n.fechaFin),c(5),J("ngModel",n.productoQ),c(),p("disabled",!n.productoQ),c(6),J("ngModel",n.categoriaQ),c(),p("disabled",!n.categoriaQ),c(3),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(2),p("disabled",n.cargando||!n.rows.length),c(11),T(n.sortIcon("producto")),c(8),T(n.sortIcon("cantidad")),c(4),T(n.sortIcon("costo")),c(4),T(n.sortIcon("importe")),c(4),T(n.sortIcon("utilidad")),c(4),T(n.sortIcon("margen")),c(8),T(n.sortIcon("existencia")),c(2),p("ngForOf",n.pagedRows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length),c(),p("ngIf",n.totalItems>0))},dependencies:[Oe,si,We,Ne,wt,Bt,ot,At,rt,at,qe,nt,ze,Ft,_t,Tr,Lt,Ba,La,ja,Qn,Mr,dt],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.compact-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%]{padding:0!important}.compact-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{padding-top:.35rem;padding-bottom:.35rem}.wide-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding:8px 0}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-flex{align-items:center}.compact-field.mb-0[_ngcontent-%COMP%]{margin-bottom:0}.suffix-center[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;padding-right:.35rem}.clear-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;line-height:1}.compact-field[_ngcontent-%COMP%]   .mat-form-field-flex[_ngcontent-%COMP%]{align-items:center}.sem[_ngcontent-%COMP%]{font-weight:600}.sem-green[_ngcontent-%COMP%]{color:#0f9d58}.sem-yellow[_ngcontent-%COMP%]{color:#b8860b}.sem-red[_ngcontent-%COMP%]{color:#dc3545}.sem-muted[_ngcontent-%COMP%]{color:#6c757d}"]})};var Rg=hi(ki());var ud=i=>({"text-danger":i});function V4(i,t){if(i&1&&(l(0,"option",31),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function U4(i,t){if(i&1&&(l(0,"mat-option",32)(1,"div",33)(2,"span"),d(3),s(),l(4,"small",34),d(5),s()()()),i&2){let e=t.$implicit;p("value",e),c(3),T(e.nombre),c(2),T(e.codigoBarras||"\u2014")}}function j4(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),F(3,"date"),s(),l(4,"td"),d(5),s(),l(6,"td"),d(7),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),s(),l(12,"td",27),d(13),s(),l(14,"td",27),d(15),F(16,"currency"),s(),l(17,"td",27),d(18),F(19,"currency"),s(),l(20,"td",35),d(21),F(22,"currency"),s(),l(23,"td",35),d(24),F(25,"number"),s(),l(26,"td"),d(27),s()()),i&2){let e=t.$implicit;c(2),T(Q(3,13,e.fecha,"dd-MM-yyyy")),c(3),T(e.farmaciaNombre),c(2),T(e.usuarioNombre),c(2),T(e.codigoBarras||"\u2014"),c(2),T(e.productoNombre),c(2),T(e.cantidadVendida),c(2),T(se(16,16,e.importeTotal)),c(3),T(se(19,18,e.costoTotal)),c(2),p("ngClass",_i(25,ud,(e.utilidad||0)<0)),c(),R(" ",se(22,20,e.utilidad)," "),c(2),p("ngClass",_i(27,ud,(e.utilidad||0)<0)),c(),R(" ",e.margenRenglonPct==null?"\u2014":Q(25,22,e.margenRenglonPct,"1.0-2")+"%"," "),c(3),T(e.folio)}}function W4(i,t){i&1&&(l(0,"tr")(1,"td",36),d(2,"Sin resultados"),s()())}function H4(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",37)(2,"td",38),d(3,"Totales:"),s(),l(4,"td",27),d(5),s(),l(6,"td",27),d(7),F(8,"currency"),s(),l(9,"td",27),d(10),F(11,"currency"),s(),l(12,"td",35),d(13),F(14,"currency"),s(),l(15,"td",27),d(16),F(17,"number"),s(),y(18,"td"),s()()),i&2){let e=_();c(5),T(e.totalCantidad),c(2),T(se(8,6,e.totalImporte)),c(3),T(se(11,8,e.totalCosto)),c(2),p("ngClass",_i(15,ud,e.totalUtilidad<0)),c(),R(" ",se(14,10,e.totalUtilidad)," "),c(3),R(" ",e.totalMargenPct==null?"\u2014":Q(17,12,e.totalMargenPct,"1.0-2")+"%"," ")}}function $4(i,t){if(i&1){let e=ae();l(0,"div",39)(1,"button",40),w("click",function(){P(e);let r=_();return k(r.goFirst())}),y(2,"i",41),s(),l(3,"button",42),w("click",function(){P(e);let r=_();return k(r.goPrev())}),y(4,"i",43),s(),d(5),l(6,"button",44),w("click",function(){P(e);let r=_();return k(r.goNext())}),y(7,"i",45),s(),l(8,"button",46),w("click",function(){P(e);let r=_();return k(r.goLast())}),y(9,"i",47),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),yn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}var mc=class i{constructor(t,e,n){this.farmaciaService=t;this.reportes=e;this.productosSrv=n}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQuery="";productCtrl=new zs("");opcionesProductos=[];productoId=null;codigoBarras="";nombre="";query$=new St;cargando=!1;rows=[];totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]}),this.query$.pipe(cn(250),dn(),Ui(t=>{let e=(t||"").trim();return e.length<2?(this.opcionesProductos=[],gt([])):this.productosSrv.buscar(e)})).subscribe({next:t=>{this.opcionesProductos=Array.isArray(t)?t:[]},error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}}),this.productCtrl.valueChanges.pipe(cn(250),dn(),Ui(t=>{let n=((typeof t=="string"?t:t?.nombre??t?.codigoBarras??"")||"").trim();return n.length<2?(this.opcionesProductos=[],gt([])):this.productosSrv.buscar(n)})).subscribe({next:t=>this.opcionesProductos=t||[],error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}})}onQueryChange(t){this.query$.next(t),this.productoId=null,this.codigoBarras="",this.nombre=""}displayProducto=t=>typeof t=="string"?t:t?`${t.codigoBarras?t.codigoBarras+" \u2014 ":""}${t.nombre}`:"";onProductoChange(t){this.seleccionarDesdeInput(t)}onProductoBlur(t){this.productoId||this.seleccionarDesdeInput(t)}seleccionarDesdeInput(t){let e=(t||"").trim();if(!e)return;let n=this.opcionesProductos.find(u=>u.codigoBarras&&u.codigoBarras===e),r=this.opcionesProductos.find(u=>u.nombre.toLowerCase()===e.toLowerCase()),a=this.opcionesProductos.find(u=>(u.codigoBarras?`${u.codigoBarras} \u2014 `:"")+u.nombre===e),o=n||r||a;o&&(this.productoId=o._id,this.codigoBarras=o.codigoBarras||"",this.nombre=o.nombre,this.productoQuery=(o.codigoBarras?`${o.codigoBarras} \u2014 `:"")+o.nombre)}buscar(){let t=this.productCtrl.value;if(!this.productoId&&typeof t=="string"&&t.trim()){let n=t.trim();/^\d{5,}$/.test(n)?(this.codigoBarras=n,this.nombre=""):(this.nombre=n,this.codigoBarras="")}if(!this.productoId&&!this.codigoBarras&&!this.nombre){Rg.default.fire({icon:"warning",title:"Aviso",text:"Selecciona un producto o escribe c\xF3digo/nombre.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let e=n=>n?new Date(n).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasProductoDetalle({farmaciaId:this.farmaciaId||void 0,productoId:this.productoId||void 0,codigoBarras:this.productoId?void 0:this.codigoBarras||void 0,nombre:this.productoId?void 0:this.nombre||void 0,fechaIni:e(this.fechaIni),fechaFin:e(this.fechaFin)}).subscribe({next:n=>{let r=o=>{let u=Number(o);return Number.isFinite(u)?u:0};this.rows=n?.items||[];let a=this.rows.reduce((o,u)=>(o.cant+=r(u.cantidadVendida),o.imp+=r(u.importeTotal),o.cost+=r(u.costoTotal),o.util+=r(u.utilidad),o),{cant:0,imp:0,cost:0,util:0});this.totalCantidad=a.cant,this.totalImporte=a.imp,this.totalCosto=a.cost,this.totalUtilidad=a.util,this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination(),this.cargando=!1},error:n=>{console.error("Error reporte ventas producto:",n),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}limpiar(){this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.totalItems=0,this.page=1,this.farmaciaId="",this.limpiarProducto(),this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null}exportarCSV(){if(!this.rows.length)return;let t=[{key:"fecha",label:"Fecha",map:r=>r.fecha?r.fecha.substring(0,10):""},{key:"farmaciaNombre",label:"Farmacia"},{key:"usuarioNombre",label:"Usuario"},{key:"codigoBarras",label:"C\xF3digo"},{key:"productoNombre",label:"Producto"},{key:"cantidadVendida",label:"Cantidad"},{key:"importeTotal",label:"Importe",map:r=>Number(r.importeTotal??0).toFixed(2)},{key:"costoTotal",label:"Costo",map:r=>Number(r.costoTotal??0).toFixed(2)},{key:"utilidad",label:"Utilidad",map:r=>Number(r.utilidad??0).toFixed(2)},{key:"margenRenglonPct",label:"Margen % (ren)",map:r=>r.margenRenglonPct==null?"":Number(r.margenRenglonPct).toFixed(2)},{key:"folio",label:"Folio venta"}],e=jf(this.rows,t,{separator:",",bom:!0}),n=`ventas_producto_${this.codigoBarras||this.nombre||"producto"}_${this.fechaIni}_a_${this.fechaFin}.csv`;Wf(n,e)}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}onOptionSelected(t){t&&(this.productoId=t._id,this.codigoBarras=t.codigoBarras||"",this.nombre=t.nombre,this.productCtrl.setValue(t))}limpiarProducto(){this.productCtrl.setValue(""),this.opcionesProductos=[],this.productoId=null,this.codigoBarras="",this.nombre=""}static \u0275fac=function(e){return new(e||i)(ie(Xt),ie(In),ie(Ji))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas-producto"]],decls:69,vars:16,consts:[["auto","matAutocomplete"],[1,"titulo-container","mb-2"],[1,"titulo"],[1,"row","align-items-end",3,"ngSubmit"],[1,"row","filtros"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"form-label","d-block"],["appearance","outline",1,"compact-field","wide-field"],["matInput","","placeholder","Escribe c\xF3digo de barras o nombre",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-1","d-flex",2,"margin-top","-10px"],["type","button","matTooltip","Borrar filtro",1,"btn-rojo","compact-btn",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-md-1","d-flex","text-end",2,"margin-top","-10px"],["type","submit",1,"btn-gris","compact-btn",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"table-responsive","mt-3"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"d-flex","justify-content-between","w-100"],[1,"text-muted","ms-2"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","5",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){if(e&1){let r=ae();l(0,"div")(1,"div",1)(2,"h2",2),d(3,"Ventas por producto"),s()(),l(4,"form",3),w("ngSubmit",function(){return P(r),k(n.buscar())}),l(5,"div",4)(6,"div",5)(7,"label",6),d(8,"Farmacia"),s(),l(9,"select",7),ee("ngModelChange",function(o){return P(r),Z(n.farmaciaId,o)||(n.farmaciaId=o),k(o)}),l(10,"option",8),d(11,"Todas"),s(),N(12,V4,2,2,"option",9),s()(),l(13,"div",10)(14,"label",11),d(15,"Producto"),s(),l(16,"mat-form-field",12),y(17,"input",13),l(18,"mat-autocomplete",14,0),w("optionSelected",function(o){return P(r),k(n.onOptionSelected(o.option.value))}),N(20,U4,6,3,"mat-option",15),s()()(),l(21,"div",5)(22,"label",6),d(23,"Fecha inicial"),s(),l(24,"input",16),ee("ngModelChange",function(o){return P(r),Z(n.fechaIni,o)||(n.fechaIni=o),k(o)}),s()(),l(25,"div",5)(26,"label",6),d(27,"Fecha final"),s(),l(28,"input",17),ee("ngModelChange",function(o){return P(r),Z(n.fechaFin,o)||(n.fechaFin=o),k(o)}),s()(),l(29,"div",18)(30,"button",19),w("click",function(){return P(r),k(n.limpiar())}),y(31,"i",20),s()(),l(32,"div",21)(33,"button",22),d(34),s()()(),l(35,"div",23)(36,"button",24),w("click",function(){return P(r),k(n.exportarCSV())}),d(37," Exportar CSV "),s()()(),l(38,"div",25)(39,"table",26)(40,"thead")(41,"tr")(42,"th"),d(43,"Fecha"),s(),l(44,"th"),d(45,"Farmacia"),s(),l(46,"th"),d(47,"Usuario"),s(),l(48,"th"),d(49,"C\xF3d. barras"),s(),l(50,"th"),d(51,"Producto"),s(),l(52,"th",27),d(53,"Cantidad"),s(),l(54,"th",27),d(55,"Importe"),s(),l(56,"th",27),d(57,"Costo"),s(),l(58,"th",27),d(59,"Utilidad"),s(),l(60,"th",27),d(61,"% Gan."),s(),l(62,"th"),d(63,"Folio venta"),s()()(),l(64,"tbody"),N(65,j4,28,29,"tr",28)(66,W4,3,0,"tr",29),s(),N(67,H4,19,17,"tfoot",29),s(),N(68,$4,10,7,"div",30),s()()}if(e&2){let r=Gt(19);c(9),J("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(5),p("formControl",n.productCtrl)("matAutocomplete",r),c(),p("displayWith",n.displayProducto),c(2),p("ngForOf",n.opcionesProductos),c(4),J("ngModel",n.fechaIni),c(4),J("ngModel",n.fechaFin),c(2),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(2),p("disabled",n.cargando||!n.rows.length),c(29),p("ngForOf",n.pagedRows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length),c(),p("ngIf",n.totalItems>0)}},dependencies:[Oe,si,We,Ne,wt,Bt,Nt,ot,At,rt,at,qe,nt,ze,Ft,_t,Tr,Lt,Gs,Ba,il,La,nl,ja,fl,Ra,ea,Qn,dt],styles:[".wide-field[_ngcontent-%COMP%]{width:360px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.compact-btn[_ngcontent-%COMP%]{height:40px;padding-top:6px;padding-bottom:6px;min-height:40px;line-height:26px;margin-top:2rem}"]})};var mo=hi(ki());var z4=["contenedorTicket"];function G4(i,t){if(i&1&&(l(0,"option",8),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function q4(i,t){if(i&1){let e=ae();l(0,"button",33),w("click",function(){P(e);let r=_();return k(r.limpiarFechaPedido())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function X4(i,t){if(i&1){let e=ae();l(0,"button",33),w("click",function(){P(e);let r=_();return k(r.limpiarFechaFin())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function K4(i,t){if(i&1){let e=ae();l(0,"button",33),w("click",function(){P(e);let r=_();return k(r.limpiarDescripcion())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Y4(i,t){if(i&1&&(l(0,"option",8),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e),c(),R(" ",e," ")}}function Q4(i,t){if(i&1){let e=ae();l(0,"div",35)(1,"button",36),w("click",function(){P(e);let r=_();return k(r.buscarSinFolio())}),d(2,"Buscar"),s()()}}function J4(i,t){if(i&1){let e=ae();l(0,"div",37)(1,"h2",38),d(2,"Pedidos"),s(),l(3,"button",39),w("click",function(){P(e);let r=_();return k(r.limpiarFiltroCompleto())}),y(4,"i",40),s()()}}function Z4(i,t){if(i&1&&(l(0,"small",65),d(1),s()),i&2){let e=_().$implicit;c(),R(" Tel.: ",e.cliente==null?null:e.cliente.telefono," ")}}function ek(i,t){if(i&1){let e=ae();Ze(0),l(1,"input",66),ee("ngModelChange",function(r){P(e);let a=_(3);return Z(a.costoEditado,r)||(a.costoEditado=r),k(r)}),s(),et()}if(i&2){let e=_(3);c(),J("ngModel",e.costoEditado)}}function tk(i,t){if(i&1&&(d(0),F(1,"currency")),i&2){let e=_().$implicit;R(" ",se(1,1,e.costo)," ")}}function ik(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Levant\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T(e.usuarioPidio.nombre||"\u2014"),c(2),R(" ",e.fechaPedido?Ni(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function nk(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Surti\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T((e.usuarioSurtio==null?null:e.usuarioSurtio.nombre)||"\u2014"),c(2),R(" ",e.fechaEntrega?Ni(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function rk(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Cancel\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),T((e.usuarioCancelo==null?null:e.usuarioCancelo.nombre)||"\u2014"),c(2),R(" ",e.fechaCancelacion?Ni(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function ak(i,t){if(i&1&&(l(0,"tr")(1,"td",67)(2,"div",68)(3,"table",69)(4,"thead")(5,"tr")(6,"th",70),d(7),s(),l(8,"th",71),d(9),F(10,"currency"),s(),l(11,"th",71),d(12),F(13,"currency"),s()()(),l(14,"tbody")(15,"tr")(16,"td",72),d(17),F(18,"currency"),s(),l(19,"td",72),d(20),F(21,"currency"),s()(),l(22,"tr")(23,"td"),d(24,"Efectivo:"),s(),l(25,"td"),d(26),F(27,"currency"),s(),l(28,"td"),d(29,"Efectivo:"),s(),l(30,"td"),d(31),F(32,"currency"),s()(),l(33,"tr")(34,"td"),d(35,"Tarjeta:"),s(),l(36,"td"),d(37),F(38,"currency"),s(),l(39,"td"),d(40,"Tarjeta:"),s(),l(41,"td"),d(42),F(43,"currency"),s()(),l(44,"tr")(45,"td"),d(46,"Transferencia:"),s(),l(47,"td"),d(48),F(49,"currency"),s(),l(50,"td"),d(51,"Transferencia:"),s(),l(52,"td"),d(53),F(54,"currency"),s()(),l(55,"tr")(56,"td"),d(57,"Monedero:"),s(),l(58,"td"),d(59),F(60,"currency"),s(),l(61,"td"),d(62,"Monedero"),s(),l(63,"td"),d(64),F(65,"currency"),s()(),N(66,ik,8,6,"tr",64)(67,nk,8,6,"tr",64)(68,rk,8,6,"tr",64),s()()()()()),i&2){let e=_().$implicit,n=_(2);c(7),R("Estado: ",e.estado,""),c(2),R("Costo: ",se(10,16,e.costo||0),""),c(3),R("Precio: ",se(13,18,e.total||0),""),c(5),R("Anticipo: ",se(18,20,e.aCuenta)," "),c(3),R("Resta: ",se(21,22,e.resta),""),c(6),T(se(27,24,e.pagoACuenta.efectivo||0)),c(5),T(se(32,26,e.pagoResta.efectivo||0)),c(6),T(se(38,28,e.pagoACuenta.tarjeta||0)),c(5),T(se(43,30,e.pagoResta.tarjeta||0)),c(6),T(se(49,32,e.pagoACuenta.transferencia||0)),c(5),T(se(54,34,e.pagoResta.transferencia||0)),c(6),T(se(60,36,e.pagoACuenta.vale||0)),c(5),T(se(65,38,e.pagoResta.vale||0)),c(2),p("ngIf",n.esAdmin),c(),p("ngIf",e.estado==="entregado"&&n.esAdmin),c(),p("ngIf",e.estado==="cancelado"&&n.esAdmin)}}function ok(i,t){if(i&1){let e=ae();Ze(0),l(1,"tr")(2,"td")(3,"button",55),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.pedidoDetalleAbiertoId===r._id?a.cerrarDetallePedido(r):a.abrirDetallePedido(r))}),y(4,"fa-icon",56),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"date"),s(),l(10,"td")(11,"div"),d(12),s(),N(13,Z4,2,1,"small",57),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),s(),l(18,"td"),N(19,ek,2,1,"ng-container",58)(20,tk,2,3,"ng-template",null,0,ka),s(),l(22,"td"),d(23),F(24,"currency"),s(),l(25,"td"),d(26),F(27,"currency"),s(),l(28,"td"),d(29),F(30,"currency"),s(),l(31,"td"),d(32),F(33,"currency"),s(),l(34,"td"),d(35),F(36,"currency"),s(),l(37,"td"),d(38),F(39,"number"),s(),l(40,"td",59)(41,"div",60)(42,"button",61),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.habilitarEdicion(r))}),y(43,"fa-icon",34),s(),l(44,"button",62),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.guardarFila(r))}),y(45,"fa-icon",34),s(),l(46,"button",63),w("click",function(){P(e);let r=_(2);return k(r.cancelarEdicion())}),y(47,"fa-icon",34),s()()()(),N(48,ak,69,40,"tr",64),et()}if(i&2){let e=t.$implicit,n=Gt(21),r=_(2);c(3),p("matTooltip",r.pedidoDetalleAbiertoId===e._id?"Cerrar detalle":"Ver detalle"),c(),p("icon",r.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",r.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),T(e.folio),c(2),T(Ni(9,24,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),c(4),T((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),c(),p("ngIf",e.cliente==null?null:e.cliente.telefono),c(2),T(e.descripcion),c(2),T(e.estado),c(2),p("ngIf",r.modoEdicionId===e._id)("ngIfElse",n),c(4),T(se(24,28,e.total)),c(3),T(se(27,30,e.aCuenta)),c(3),T(se(30,32,e.resta)),c(3),T(se(33,34,(e.total||0)-(e.resta||0))),c(3),T(se(36,36,(e.total||0)-(e.resta||0)-(e.costo||0))),c(3),R(" ",Q(39,38,e.costo>0?((e.total||0)-(e.resta||0)-(e.costo||0))/e.costo*100:0,"1.1-2"),"% "),c(4),p("disabled",r.modoEdicionId===e._id),c(),p("icon",r.faEdit),c(),p("disabled",r.modoEdicionId!==e._id),c(),p("icon",r.faSave),c(),p("disabled",r.modoEdicionId!==e._id),c(),p("icon",r.faTimes),c(),p("ngIf",r.pedidoDetalleAbiertoId===e._id)}}function sk(i,t){if(i&1){let e=ae();l(0,"table",41)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th",42),w("click",function(){P(e);let r=_();return k(r.ordenarPor("fechaPedido"))}),d(7," F. pedido "),y(8,"fa-icon",43),s(),l(9,"th",44),w("click",function(){P(e);let r=_();return k(r.ordenarPor("cliente.nombre"))}),d(10," Cliente "),y(11,"fa-icon",43),s(),l(12,"th",45),w("click",function(){P(e);let r=_();return k(r.ordenarPor("descripcion"))}),d(13," Descripci\xF3n "),y(14,"fa-icon",46),s(),l(15,"th",47),w("click",function(){P(e);let r=_();return k(r.ordenarPor("estado"))}),d(16," Estado "),y(17,"fa-icon",46),s(),l(18,"th",48),w("click",function(){P(e);let r=_();return k(r.ordenarPor("costo"))}),d(19," Costo "),y(20,"fa-icon",46),s(),l(21,"th",49),w("click",function(){P(e);let r=_();return k(r.ordenarPor("total"))}),d(22," Precio "),y(23,"fa-icon",46),s(),l(24,"th",50),w("click",function(){P(e);let r=_();return k(r.ordenarPor("aCuenta"))}),d(25," A cuenta "),y(26,"fa-icon",46),s(),l(27,"th",51),w("click",function(){P(e);let r=_();return k(r.ordenarPor("resta"))}),d(28," Resta "),y(29,"fa-icon",46),s(),l(30,"th"),d(31,"Tot. Ingreso"),s(),l(32,"th"),d(33,"Utilidad"),s(),l(34,"th"),d(35,"% Gan"),s(),l(36,"th"),d(37,"Acciones"),s()()(),l(38,"tbody"),N(39,ok,49,41,"ng-container",52),s(),l(40,"tfoot")(41,"tr")(42,"td",53),d(43,"Totales:"),s(),l(44,"td",54),d(45),F(46,"currency"),s(),l(47,"td",54),d(48),F(49,"currency"),s(),l(50,"td",54),d(51),F(52,"currency"),s(),l(53,"td",54),d(54),F(55,"currency"),s(),l(56,"td",54),d(57),F(58,"currency"),s(),l(59,"td",54),d(60),F(61,"currency"),s(),l(62,"td",54),d(63),F(64,"number"),s(),y(65,"td"),s()()()}if(i&2){let e=_();c(6),Ye("aria-sort",e.ariaSortFor("fechaPedido")),c(2),p("icon",e.sortBy==="fechaPedido"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("cliente.nombre")),c(2),p("icon",e.sortBy==="cliente.nombre"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("descripcion")),c(2),p("icon",e.sortBy==="descripcion"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("estado")),c(2),p("icon",e.sortBy==="estado"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("costo")),c(2),p("icon",e.sortBy==="costo"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("total")),c(2),p("icon",e.sortBy==="total"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("aCuenta")),c(2),p("icon",e.sortBy==="aCuenta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Ye("aria-sort",e.ariaSortFor("resta")),c(2),p("icon",e.sortBy==="resta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(10),p("ngForOf",e.pedidos),c(6),T(se(46,24,e.totalCosto)),c(3),T(se(49,26,e.totalPrecio)),c(3),T(se(52,28,e.totalAcuenta)),c(3),T(se(55,30,e.totalResta)),c(3),T(se(58,32,e.totalIngreso)),c(3),T(se(61,34,e.utilidadTotal)),c(3),R("",Q(64,36,e.porcentajeUtilidad,"1.1-2"),"%")}}function lk(i,t){if(i&1){let e=ae();l(0,"div",73)(1,"button",74),w("click",function(){P(e);let r=_();return k(r.cambiarPagina(1))}),y(2,"i",75),s(),l(3,"button",76),w("click",function(){P(e);let r=_();return k(r.cambiarPagina(r.paginacion.page-1))}),y(4,"i",77),s(),l(5,"span"),d(6),s(),l(7,"button",78),w("click",function(){P(e);let r=_();return k(r.cambiarPagina(r.paginacion.page+1))}),y(8,"i",79),s(),l(9,"button",80),w("click",function(){P(e);let r=_();return k(r.cambiarPagina(r.paginacion.pages))}),y(10,"i",81),s(),l(11,"span",82),d(12,"Filas p\xE1g.:"),s(),l(13,"select",83),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.limit,r)||(a.limit=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return r.page=1,k(r.buscarSinFolio())}),l(14,"option",8),d(15,"10"),s(),l(16,"option",8),d(17,"20"),s(),l(18,"option",8),d(19,"50"),s(),l(20,"option",8),d(21,"100"),s()()()}if(i&2){let e=_();c(),p("disabled",e.paginacion.page<=1),c(2),p("disabled",!e.paginacion.hasPrev),c(3),yn(" P\xE1gina ",e.paginacion.page," de ",e.paginacion.pages," (",e.paginacion.total," registros) "),c(),p("disabled",!e.paginacion.hasNext),c(2),p("disabled",e.paginacion.page>=e.paginacion.pages),c(4),J("ngModel",e.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100)}}function ck(i,t){i&1&&(l(0,"p",84),d(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),s())}function Bg(){return{conteo:0,total:0,aCuenta:0,resta:0,saldo:0,efectivo:0,tarjeta:0,transferencia:0,vale:0,efectivoResta:0,tarjetaResta:0,transferenciaResta:0,valeResta:0,costo:0}}function Ng(){return{generales:Bg(),porEstado:[]}}var fc=class i{constructor(t,e,n,r,a,o,u){this.library=t;this.pedidosService=e;this.authService=n;this.clienteService=r;this.farmaciaService=a;this.cdr=o;this.ngZone=u;this.library.addIcons(Cn,Da,Oa,vi)}contenedorTicket;filtroFarmaciaId;filtroFolio="";filtroDescripcion="";filtroFechaPedido="";filtroFechaFin="";filtroEstado;estadosPedido=["inicial","entregado","cancelado"];esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmacias=[];farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";usuarioId="";usuarioRol="";usuarioNombre="";pedidoEditandoId=null;costoTemporal=0;modoEdicionId=null;costoEditado=null;faSpinner=_f;faCheck=bf;faSave=sf;faEdit=Ks;faTimes=vi;filtroClienteNombre="";incluirClienteNull=!1;faSort=ef;faSortUp=lf;faSortDown=Gm;page=1;limit=20;sortBy="fechaPedido";sortDir="desc";ariaSortFor(t){return this.sortBy===t?this.sortDir==="asc"?"ascending":"descending":"none"}paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1};resumen=Ng();pedidos=[];totalIngreso=0;utilidadTotal=0;porcentajeUtilidad=0;totalCosto=0;totalPrecio=0;totalAcuenta=0;totalResta=0;cambiarPagina(t){this.paginacion.pages&&(t<1||t>this.paginacion.pages||(this.page=t,this.buscarSinFolio()))}ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59);this.filtroFechaPedido=this.toYmd(e),this.filtroFechaFin=this.toYmd(n),this.farmaciaService.obtenerFarmacias().subscribe(a=>{this.farmacias=a||[],this.farmacias.length&&(this.filtroFarmaciaId=this.farmacias[0]._id??this.farmacias[0].id??""),this.buscarSinFolio()});let r=this.authService.getUserData();this.usuarioId=r?.id,this.usuarioRol=r?.rol,this.usuarioNombre=r?.nombre}toYmd(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}formatearFecha(t){let e=new Date(t),n=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${n}/${r}/${a}`}get mostrarBotonBuscar(){return!!this.filtroFarmaciaId}ordenarPor(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.page=1,this.buscarSinFolio()}buscarSinFolio(){return Ae(this,null,function*(){if(!this.filtroFarmaciaId){mo.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let t=b=>b?new Date(b).toISOString().slice(0,10):void 0,e=this.filtroFarmaciaId,n=t(this.filtroFechaPedido),r=t(this.filtroFechaFin),a=(this.filtroDescripcion||"").trim()||void 0,o=this.filtroEstado||void 0,u=(this.filtroClienteNombre||"").trim()||void 0,m=!!this.incluirClienteNull,f=this.page||1,h=this.limit||20,g=this.sortBy||"fechaPedido",x=this.sortDir||"desc";this.pedidosService.obtenerPedidos({farmaciaId:e,fechaIni:n,fechaFin:r,folio:void 0,estado:o,descripcion:a,descripcionMinima:!1,page:f,limit:h,sortBy:g,sortDir:x,clienteNombre:u,clienteNull:m}).subscribe({next:b=>{if(console.log("Pedidos",b),!b?.pedidos||b.pedidos.length===0){mo.default.fire({icon:"info",title:"Sin resultados",text:"No existen pedidos con esas caracter\xEDsticas.",timer:1500,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0,this.totalCosto=0,this.totalPrecio=0,this.totalAcuenta=0,this.totalResta=0;return}this.pedidos=b.pedidos,this.paginacion=b.paginacion,this.resumen=b.resumen;let S=b?.resumen?.generales??Bg(),v=E=>Number.isFinite(Number(E))?Number(E):0;console.log("globales",S),this.totalCosto=S?v(S.costo):0,this.totalPrecio=S?v(S.total):0,this.totalAcuenta=S?v(S.aCuenta):0,this.totalResta=S?v(S.resta):0,this.totalIngreso=(Number(S.total)||0)-(Number(S.resta)||0),this.utilidadTotal=(Number(S.total)||0)-(Number(S.resta)||0)-(Number(S.costo)||0),this.porcentajeUtilidad=this.totalCosto>0?this.utilidadTotal/this.totalCosto*100:0},error:b=>{console.error("Error al buscar sin folio:",b),mo.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.filtroFolio="",this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0}})})}limpiarDescripcion(){return Ae(this,null,function*(){this.filtroDescripcion="",this.buscarSinFolio()})}limpiarFechaPedido(){return Ae(this,null,function*(){this.filtroFechaPedido="",this.buscarSinFolio()})}limpiarFechaFin(){return Ae(this,null,function*(){this.filtroFechaFin="",this.buscarSinFolio()})}limpiarFiltroCompleto(){return Ae(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.pedidos=[],this.resumen=Ng()})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}habilitarEdicion(t){this.modoEdicionId=t._id,this.costoEditado=t.costo}cancelarEdicion(){this.modoEdicionId=null,this.costoEditado=null}guardarFila(t){this.costoEditado!==null&&this.pedidosService.actualizarCostoPedido(t._id,this.costoEditado).subscribe({next:e=>{t.costo=e.pedido.costo,this.buscarSinFolio(),mo.default.fire({icon:"success",title:"Actualizado",text:"El costo fue actualizado correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("Error al actualizar costo:",e),mo.default.fire("Error","No se pudo actualizar el costo.","error")},complete:()=>{this.modoEdicionId=null,this.costoEditado=null}})}static \u0275fac=function(e){return new(e||i)(ie(yi),ie(Ga),ie(Kt),ie(Sn),ie(Xt),ie(Dt),ie(bn))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-pedidos"]],viewQuery:function(e,n){if(e&1&&Tt(z4,5),e&2){let r;bt(r=yt())&&(n.contenedorTicket=r.first)}},decls:53,vars:19,consts:[["mostrarCosto",""],[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","g-2","align-items-center","mb-3"],[1,"col-auto"],["for","filtroFarmaciaId",1,"form-label","mb-0","lbl-pedido"],["id","filtroFarmaciaId",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-auto",2,"margin-left","3rem"],["for","filtroClienteNombre",1,"form-label","mb-0","lbl-pedido"],["id","filtroClienteNombre","type","text","placeholder","Nombre del cliente",1,"form-control",2,"width","220px",3,"ngModelChange","ngModel"],[1,"col-auto","form-check",2,"margin-left","3rem"],["type","checkbox","id","incluirClienteNull",1,"form-check-input",3,"ngModelChange","ngModel"],["for","incluirClienteNull",1,"form-check-label"],[1,"row","mb-2","filtros-container"],[1,"col-md-2"],["for","filtroFechaPedido",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","date",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFechaFin",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-3"],["for","filtroDescripcion",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],["type","text","placeholder","Descripci\xF3n...",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["for","filtroEstado",1,"lbl-pedido"],["id","filtroEstado",1,"form-select",2,"width","150px",3,"ngModelChange","ngModel"],["class","col-md-1","style","margin-top: 1rem;",4,"ngIf"],["class","d-flex justify-content-between align-items-center w-100 mb-2",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","no-found-error",4,"ngIf"],["type","button",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"col-md-1",2,"margin-top","1rem"],[1,"btn-gris",3,"click"],[1,"d-flex","justify-content-between","align-items-center","w-100","mb-2"],[1,"subtitulo","mb-0"],["matTooltip","Cierra la tabla",1,"btn-amarillo-chico","btn-icon-chico",3,"click"],[1,"fas","fa-times"],[1,"tabla"],["role","button","matTooltip","Ordenar por fecha de pedido",1,"sortable",3,"click"],["aria-hidden","true",1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por cliente",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por descripci\xF3n",1,"sortable",3,"click"],[1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por estado",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por costo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por precio",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por anticipo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por resto",1,"sortable",3,"click"],[4,"ngFor","ngForOf"],["colspan","6",1,"text-end","fw-bold"],[1,"fw-bold"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],["class","text-muted",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"d-flex","gap-1","align-items-center"],[1,"d-flex","justify-content-center"],["matTooltip","Editar costo",1,"btn-icon-chico","btn-gris-chico",3,"click","disabled"],["matTooltip","Guardar costo",1,"btn-icon-chico","btn-verde-chico",3,"click","disabled"],["matTooltip","Cancelar",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],[4,"ngIf"],[1,"text-muted"],["type","number",1,"form-control","form-control-sm",2,"width","80px",3,"ngModelChange","ngModel"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","1"],["colspan","2",1,"sub-title-tabla"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"ms-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"ngModelChange","ngModel"],[1,"no-found-error"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"div",2)(2,"h1",3),d(3,"Reporte de Pedidos"),s()(),l(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Farmacia:"),s()(),l(8,"div",5)(9,"select",7),ee("ngModelChange",function(a){return Z(n.filtroFarmaciaId,a)||(n.filtroFarmaciaId=a),a}),l(10,"option",8),d(11,"-- Selecciona --"),s(),N(12,G4,2,2,"option",9),s()(),l(13,"div",10)(14,"label",11),d(15,"Cliente:"),s()(),l(16,"div",5)(17,"input",12),ee("ngModelChange",function(a){return Z(n.filtroClienteNombre,a)||(n.filtroClienteNombre=a),a}),s()(),l(18,"div",13)(19,"input",14),ee("ngModelChange",function(a){return Z(n.incluirClienteNull,a)||(n.incluirClienteNull=a),a}),s(),l(20,"label",15),d(21," Incluir \u201Csin cliente\u201D "),s()()(),l(22,"div",16)(23,"div",17)(24,"label",18),d(25,"Fecha Inicial:"),s(),l(26,"div",19)(27,"input",20),ee("ngModelChange",function(a){return Z(n.filtroFechaPedido,a)||(n.filtroFechaPedido=a),a}),s(),N(28,q4,2,1,"button",21),s()(),l(29,"div",17)(30,"label",22),d(31,"Fecha Final:"),s(),l(32,"div",19)(33,"input",20),ee("ngModelChange",function(a){return Z(n.filtroFechaFin,a)||(n.filtroFechaFin=a),a}),s(),N(34,X4,2,1,"button",21),s()(),l(35,"div",23)(36,"label",24),d(37,"Descripci\xF3n:"),s(),l(38,"div",19)(39,"input",25),ee("ngModelChange",function(a){return Z(n.filtroDescripcion,a)||(n.filtroDescripcion=a),a}),s(),N(40,K4,2,1,"button",21),s()(),l(41,"div",17)(42,"label",26),d(43,"Estado:"),s(),l(44,"select",27),ee("ngModelChange",function(a){return Z(n.filtroEstado,a)||(n.filtroEstado=a),a}),l(45,"option",8),d(46,"-- Todos --"),s(),N(47,Y4,2,2,"option",9),s()(),N(48,Q4,3,0,"div",28),s(),N(49,J4,5,0,"div",29)(50,sk,66,39,"table",30)(51,lk,22,12,"div",31)(52,ck,2,0,"p",32),s()),e&2&&(c(9),J("ngModel",n.filtroFarmaciaId),c(),p("ngValue",null),c(2),p("ngForOf",n.farmacias),c(5),J("ngModel",n.filtroClienteNombre),c(2),J("ngModel",n.incluirClienteNull),c(8),J("ngModel",n.filtroFechaPedido),c(),p("ngIf",n.filtroFechaPedido),c(5),J("ngModel",n.filtroFechaFin),c(),p("ngIf",n.filtroFechaFin),c(5),J("ngModel",n.filtroDescripcion),c(),p("ngIf",n.filtroDescripcion),c(4),J("ngModel",n.filtroEstado),c(),p("ngValue",null),c(2),p("ngForOf",n.estadosPedido),c(),p("ngIf",n.mostrarBotonBuscar),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.paginacion==null?null:n.paginacion.pages),c(),p("ngIf",n.filtroFolio.length===6&&n.pedidos.length===0))},dependencies:[ti,ei,ot,rt,at,qe,qt,li,nt,ze,_t,Oe,si,We,Ne,wt,Bt,Nt,Vt,dt],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.pedidos-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-pedido[_ngcontent-%COMP%]{font-size:large}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f9f9f9;border-top:2px solid #ccc;font-weight:700}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.ord[_ngcontent-%COMP%]{font-size:.85em;margin-left:.25rem}"],data:{animation:[na("expandCollapse",[nr("true",mn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",mn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),aa("true <=> false",ra("300ms ease-in-out"))])]}})};var Vg=hi(ki());function dk(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function uk(i,t){if(i&1){let e=ae();l(0,"button",45),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.selectCliente(r))}),l(1,"div",46),d(2),s()()}if(i&2){let e=t.$implicit;c(2),T(e.nombre||"(sin nombre)")}}function mk(i,t){if(i&1&&(l(0,"div",43),N(1,uk,3,1,"button",44),s()),i&2){let e=_();c(),p("ngForOf",e.clienteOpts)}}function fk(i,t){if(i&1){let e=ae();l(0,"div",47)(1,"span",48),d(2),s(),l(3,"button",49),w("click",function(){P(e);let r=_(),a=Gt(14);return k(r.clearCliente(a))}),d(4,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.clienteSel.nombre," ")}}function pk(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function hk(i,t){if(i&1&&(l(0,"small",61),d(1),s()),i&2){let e=_().$implicit;c(),R("CB: ",e.producto.codigoBarras,"")}}function gk(i,t){if(i&1&&(l(0,"tr")(1,"td")(2,"div"),d(3),s(),N(4,hk,2,1,"small",60),s(),l(5,"td",30),d(6),F(7,"number"),s(),l(8,"td",30),d(9),F(10,"number"),s(),l(11,"td",30),d(12),F(13,"number"),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),s(),l(18,"td",30),d(19),F(20,"number"),s(),l(21,"td",30),d(22),F(23,"number"),s(),l(24,"td",30),d(25),F(26,"number"),s(),l(27,"td",30),d(28),F(29,"number"),s(),l(30,"td",30),d(31),F(32,"number"),s(),l(33,"td",30),d(34),F(35,"number"),s()()),i&2){let e=t.$implicit,n=_(2).$implicit;c(3),T((e==null||e.producto==null?null:e.producto.nombre)||"\u2014"),c(),p("ngIf",e==null||e.producto==null?null:e.producto.codigoBarras),c(2),T(se(7,13,e==null?null:e.cantidad)),c(3),R("$",Q(10,15,e==null?null:e.precioOriginal,"1.2-2"),""),c(3),R("$",Q(13,18,(e==null?null:e.precioOriginal)*(e==null?null:e.cantidad),"1.2-2")," "),c(3),T(e==null?null:e.tipoDescuento),c(2),T(e==null?null:e.cadenaDescuento),c(2),R("$",Q(20,21,e==null?null:e.monederoCliente,"1.2-2"),""),c(3),R("$",Q(23,24,e==null?null:e.descuento,"1.2-2"),""),c(3),R("$",Q(26,27,(e==null?null:e.costo)*(e==null?null:e.cantidad),"1.2-2"),""),c(3),R("$",Q(29,30,(e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad)-(n==null||n.formaPago==null?null:n.formaPago.vale),"1.2-2"),""),c(3),R("",Q(32,33,((e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad))/((e==null?null:e.costo)*(e==null?null:e.cantidad))*100,"1.2-2"),"%"),c(3),R("$",Q(35,36,e==null?null:e.totalRen,"1.2-2"),"")}}function _k(i,t){i&1&&(l(0,"tr")(1,"td",62),d(2,"Sin renglones"),s()())}function vk(i,t){if(i&1&&(l(0,"tr")(1,"td",53)(2,"div",54)(3,"table",55)(4,"thead")(5,"tr")(6,"th"),d(7,"Producto"),s(),l(8,"th",30),d(9,"Cant."),s(),l(10,"th",30),d(11,"P. U."),s(),l(12,"th",30),d(13,"Imp. normal"),s(),l(14,"th"),d(15,"Promo"),s(),l(16,"th"),d(17,"% desc"),s(),l(18,"th",30),d(19,"Monedero"),s(),l(20,"th",30),d(21,"Desc."),s(),l(22,"th",30),d(23,"Costo"),s(),l(24,"th",30),d(25,"Utilidad"),s(),l(26,"th",30),d(27,"% Gan."),s(),l(28,"th",30),d(29,"Total"),s()()(),l(30,"tbody"),N(31,gk,36,39,"tr",31)(32,_k,3,0,"tr",32),s()()(),l(33,"div",56)(34,"div",57)(35,"div",58)(36,"strong"),d(37,"Forma de pago:"),s()(),l(38,"div",59),d(39,"Efectivo: "),l(40,"strong"),d(41),F(42,"number"),s()(),l(43,"div",59),d(44,"Tarjeta: "),l(45,"strong"),d(46),F(47,"number"),s()(),l(48,"div",59),d(49,"Transferencia: "),l(50,"strong"),d(51),F(52,"number"),s()(),l(53,"div",59),d(54,"Monedero: "),l(55,"strong"),d(56),F(57,"number"),s()()()()()()),i&2){let e=_().$implicit;c(31),p("ngForOf",e.productos),c(),p("ngIf",!e.productos||e.productos.length===0),c(9),R(" $",Q(42,6,(e==null||e.formaPago==null?null:e.formaPago.efectivo)||0,"1.2-2"),""),c(5),R(" $",Q(47,9,(e==null||e.formaPago==null?null:e.formaPago.tarjeta)||0,"1.2-2"),""),c(5),R(" $",Q(52,12,(e==null||e.formaPago==null?null:e.formaPago.transferencia)||0,"1.2-2"),""),c(5),R(" $",Q(57,15,(e==null||e.formaPago==null?null:e.formaPago.vale)||0,"1.2-2"),"")}}function xk(i,t){if(i&1){let e=ae();Ze(0),l(1,"tr")(2,"td",50)(3,"button",51),w("click",function(){let r=P(e).$implicit,a=_();return k(a.toggleDetalle(r))}),y(4,"fa-icon",52),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),F(11,"date"),s(),l(12,"td"),d(13),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),F(18,"number"),s(),l(19,"td",30),d(20),F(21,"number"),s(),l(22,"td",30),d(23),F(24,"number"),s(),l(25,"td",30),d(26),F(27,"number"),s(),l(28,"td",30),d(29),F(30,"number"),s(),l(31,"td",30),d(32),F(33,"number"),s(),l(34,"td",30),d(35),F(36,"number"),s()(),N(37,vk,58,18,"tr",32),et()}if(i&2){let e=t.$implicit,n=_();c(3),p("disabled",n.cargando)("matTooltip",n.isExpanded(e)?"Cerrar detalle de venta":"Mostrar detalle de venta"),c(),p("icon",n.isExpanded(e)?"chevron-up":"chevron-down"),c(2),T((e.farmacia==null?null:e.farmacia.nombre)||"\u2014"),c(2),T((e.usuario==null?null:e.usuario.nombre)||"\u2014"),c(2),T(Ni(11,16,e.fecha,"dd/MM/yyyy HH:mm","America/Mexico_City")),c(3),T(e.folio),c(2),T((e.cliente==null?null:e.cliente.nombre)||"\u2014"),c(2),T(se(18,20,e.cantidadProductos)),c(3),R("$",Q(21,22,e.totalMonederoCliente,"1.2-2"),""),c(3),R("$",Q(24,25,e.totalDescuento,"1.2-2"),""),c(3),R("$",Q(27,28,e._costo,"1.2-2"),""),c(3),R("$",Q(30,31,e._utilidad-(e==null||e.formaPago==null?null:e.formaPago.vale),"1.2-2"),""),c(3),R("",Q(33,34,e._utilidad/e._costo*100,"1.2-2"),"%"),c(3),R("$",Q(36,37,e.total,"1.2-2"),""),c(2),p("ngIf",n.isExpanded(e))}}function bk(i,t){i&1&&(l(0,"tr")(1,"td",63),d(2,"Sin resultados"),s()())}function yk(i,t){if(i&1&&(l(0,"tfoot")(1,"tr")(2,"td",64)(3,"strong"),d(4,"Totales ===>"),s()(),l(5,"td",65),d(6),s(),l(7,"td",65),d(8),F(9,"number"),s(),l(10,"td",65),d(11),F(12,"number"),s(),l(13,"td",65),d(14),F(15,"number"),s(),l(16,"td",65),d(17),F(18,"number"),s(),l(19,"td",65),d(20),F(21,"number"),s(),l(22,"td",30)(23,"strong"),d(24),F(25,"number"),s()()()()),i&2){let e=_();c(6),T(e.sumaCantidadProductos),c(2),R("$",Q(9,7,e.sumaTotalMonederoCliente,"1.2-2"),""),c(3),R("$",Q(12,10,e.sumaTotalDescuento,"1.2-2"),""),c(3),R("$",Q(15,13,e.sumaCosto,"1.2-2"),""),c(3),R("$",Q(18,16,e.sumaUtilidad,"1.2-2"),""),c(3),R("",Q(21,19,e.sumaUtilidad/e.sumaCosto*100,"1.2-2"),"% "),c(4),R("$",Q(25,22,e.sumaTotalFiltro,"1.2-2"),"")}}var pc=class i{constructor(t,e,n,r,a,o){this.fb=t;this.reportes=e;this.farmaciaSrv=n;this.clienteSrv=r;this.usuarioSrv=a;this.faLib=o;this.faLib.addIcons(hf,Qm)}clienteSel=null;clienteOpts=[];filtroForm;cargando=!1;rows=[];farmacias=[];clientes=[];usuarios=[];farmaciasCargadas=!1;clientesCargados=!1;usuariosCargados=!1;page=1;limit=20;totalPaginas=0;totalRegistros=0;totalPagina=0;sumaTotalFiltro=0;sumaCantidadProductos=0;sumaTotalDescuento=0;sumaTotalMonederoCliente=0;sumaCosto=0;sumaUtilidad=0;expandedId=null;collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});clientesBase=[];clientesIdx=[];sugerenciasClientes=[];mostrandoSugerencias=!1;focoSugerencia=-1;sortByNombre(t){return[...t||[]].sort((e,n)=>(e.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"}))}ngOnInit(){let t=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaInicial:[t],fechaFinal:[t],clienteId:[""],clienteNombre:[""],usuarioId:[""],totalDesde:[""],totalHasta:[""],limit:[this.limit]}),this.filtroForm.get("clienteNombre").valueChanges.pipe(cn(200),dn()).subscribe(e=>this.onClienteNombreChanged(e||"")),this.cargarCatalogos()}onClienteInput(t){let e=(t||"").trim();if(e.length<2){this.clienteOpts=[];return}this.clienteSrv.searchClientes(e).subscribe(n=>this.clienteOpts=n)}selectCliente(t){this.clienteSel=t,this.clienteOpts=[],this.filtroForm.patchValue({clienteId:t._id}),this.buscar(!0)}clearCliente(t){this.clienteSel=null,this.filtroForm.patchValue({clienteId:null}),this.clienteOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0)),this.buscar(!0)}normalizeEs(t){return(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}rankNombre(t,e,n){let r=this.normalizeEs(n).split(" ").filter(Boolean);if(!r.length)return{score:-1,pos:1/0};let a=0,o=1/0;for(let u of r){let m=t.indexOf(u);if(m===-1)return{score:-1,pos:1/0};let f=e.some(h=>h.startsWith(u));a+=f?2:1,m<o&&(o=m)}return{score:a,pos:o}}tokenizeTerm(t){return this.normalizeEs(t).split(/\s+/).filter(Boolean)}scoreMatch(t,e){let n=this.normalizeEs(t),r=this.normalizeEs(e).split(" ").filter(Boolean);if(!r.length)return{score:-1,pos:1/0};let a=0,o=1/0;for(let u of r){let m=n.indexOf(u);if(m===-1)return{score:-1,pos:1/0};let f=m===0||n.charAt(m-1)===" ";a+=f?2:1,o=Math.min(o,m)}return{score:a,pos:o}}onClienteNombreChanged(t){let e=(t||"").trim();if(!e){this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.filtroForm.value.clienteId&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});return}let n=this.filtroForm.value.clienteNombre||"";(this.filtroForm.value.clienteId||"")&&this.normalizeEs(n)!==this.normalizeEs(e)&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});let a=this.clientesIdx.map(o=>({c:{_id:o._id,nombre:o.nombre},r:this.rankNombre(o.norm,o.words,e)})).filter(o=>o.r.score>=0).sort((o,u)=>u.r.score-o.r.score||o.r.pos-u.r.pos||this.collator.compare(o.c.nombre,u.c.nombre)).slice(0,100).map(o=>o.c);this.sugerenciasClientes=a,this.mostrandoSugerencias=!0,this.focoSugerencia=-1}seleccionarCliente(t){this.filtroForm.patchValue({clienteId:t._id,clienteNombre:t.nombre},{emitEvent:!1}),this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}limpiarCliente(){this.filtroForm.patchValue({clienteId:"",clienteNombre:""},{emitEvent:!1}),this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}onClienteKeyDown(t){if(!(!this.mostrandoSugerencias||!this.sugerenciasClientes.length))if(t.key==="ArrowDown")t.preventDefault(),this.focoSugerencia=Math.min(this.focoSugerencia+1,this.sugerenciasClientes.length-1);else if(t.key==="ArrowUp")t.preventDefault(),this.focoSugerencia=Math.max(this.focoSugerencia-1,0);else if(t.key==="Enter"){t.preventDefault();let e=this.sugerenciasClientes[this.focoSugerencia]??this.sugerenciasClientes[0];e&&this.seleccionarCliente(e)}else t.key==="Escape"&&(this.mostrandoSugerencias=!1)}onClienteFocus(){let t=(this.filtroForm.value.clienteNombre||"").trim();t?this.onClienteNombreChanged(t):this.mostrandoSugerencias=!1}onClienteBlur(){setTimeout(()=>{this.mostrandoSugerencias=!1},150)}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{let e=this.sortByNombre(t||[]);this.farmacias=[{_id:"",nombre:"TODAS"},...e],this.farmaciasCargadas=!0,this.dispararInicialSiListos()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.dispararInicialSiListos()}}),this.clienteSrv.getClientes().subscribe({next:t=>{let n=(Array.isArray(t)?t:t?.rows??[]).map(a=>({_id:a._id?.toString()||"",nombre:a.nombre||""})),r=this.sortByNombre(n);this.clientesBase=r,this.clientesIdx=r.map(a=>{let o=this.normalizeEs(a.nombre),u=o.split(" ").filter(Boolean);return{_id:a._id,nombre:a.nombre,norm:o,words:u}}),this.clientes=[{_id:"",nombre:"TODOS"},...r],this.clientesCargados=!0,this.dispararInicialSiListos()},error:()=>{this.clientesBase=[],this.clientesIdx=[],this.clientes=[{_id:"",nombre:"TODOS"}],this.clientesCargados=!0,this.dispararInicialSiListos()}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{let e=this.sortByNombre(t||[]),n={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[n,...e],this.usuariosCargados=!0,this.dispararInicialSiListos()},error:()=>{let t={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[t],this.usuariosCargados=!0,this.dispararInicialSiListos()}})}dispararInicialSiListos(){this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados&&this.buscar(!0)}resetPaginacion(){this.expandedId=null,this.page=1}limpiar(){let t=this.todayYMD();this.filtroForm.reset({farmaciaId:"",fechaInicial:t,fechaFinal:t,clienteId:"",usuarioId:"",totalDesde:"",totalHasta:"",limit:this.limit}),this.resetPaginacion(),this.buscar(!0)}buscar(t=!1){if(!(this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados))return;t&&this.resetPaginacion();let e=this.filtroForm.value;this.limit=Number(e.limit)||20;let n={farmaciaId:e.farmaciaId||void 0,clienteId:e.clienteId||void 0,usuarioId:e.usuarioId||void 0,totalDesde:e.totalDesde!==""&&e.totalDesde!=null?Number(e.totalDesde):void 0,totalHasta:e.totalHasta!==""&&e.totalHasta!=null?Number(e.totalHasta):void 0,fechaInicial:e.fechaInicial,fechaFinal:e.fechaFinal,page:this.page,limit:this.limit};this.cargando=!0,this.reportes.getVentas(n).subscribe({next:r=>{let a=o=>Number.isFinite(Number(o))?Number(o):0;this.rows=(r?.ventas||[]).map(o=>{let m=(Array.isArray(o?.productos)?o.productos:[]).reduce((h,g)=>h+a(g?.costo)*a(g?.cantidad),0),f=a(o?.total)-m;return Wt(Ke({},o),{_costo:o._costo??Number(m.toFixed(2)),_utilidad:o._utilidad??Number(f.toFixed(2))})}),this.totalRegistros=r?.paginacion?.totalRegistros||0,this.totalPaginas=r?.paginacion?.totalPaginas||0,this.sumaTotalFiltro=r?.resumen?.sumaTotalFiltro??0,this.sumaCantidadProductos=r?.resumen?.sumaCantidadProductos??0,this.sumaTotalDescuento=r?.resumen?.sumaTotalDescuento??0,this.sumaTotalMonederoCliente=r?.resumen?.sumaTotalMonederoCliente??0,this.sumaCosto=r?.resumen?.sumaCosto??0,this.sumaUtilidad=r?.resumen?.sumaUtilidad??0,this.totalPagina=this.rows.reduce((o,u)=>o+a(u.total),0),this.cargando=!1},error:r=>{this.cargando=!1,this.rows=[],this.totalRegistros=0,this.totalPaginas=0,this.totalPagina=0,this.sumaTotalFiltro=0,this.sumaCantidadProductos=0,this.sumaTotalDescuento=0,this.sumaTotalMonederoCliente=0,this.sumaCosto=0,this.sumaUtilidad=0;let a=r?.error?.mensaje||"No se pudo consultar el reporte.";Vg.default.fire("Error",a,"error")}})}toggleDetalle(t){let e=String(t?._id||"");e&&(this.expandedId=this.expandedId===e?null:e)}isExpanded(t){let e=String(t?._id||"");return!!e&&this.expandedId===e}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}primera(){this.page!==1&&(this.page=1,this.buscar())}anterior(){this.page>1&&(this.page--,this.buscar())}siguiente(){this.page<this.totalPaginas&&(this.page++,this.buscar())}ultima(){this.page!==this.totalPaginas&&(this.page=this.totalPaginas,this.buscar())}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(In),ie(Xt),ie(Sn),ie(Va),ie(yi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas"]],decls:93,vars:21,consts:[["cliInput",""],[1,"container-ventas"],[1,"titulo","text-center"],[1,"mb-2","filtros"],[1,"row","g-2","align-items-end",3,"formGroup"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-3","position-relative"],["type","text","placeholder","Escribe nombre (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-md-3",2,"align-items","end"],["formControlName","usuarioId",1,"form-select",3,"change","disabled"],["type","number","formControlName","limit","min","1","max","200",1,"form-control"],[1,"mt-3","row"],[1,"col-md-2"],["type","date","formControlName","fechaInicial",1,"form-control"],["type","date","formControlName","fechaFinal",1,"form-control"],["type","number","formControlName","totalDesde","min","0","step","0.01",1,"form-control"],["type","number","formControlName","totalHasta","min","0","step","0.01",1,"form-control"],[1,"col-2",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-2","text-end",2,"margin-top","1.3rem"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"mt-2"],[1,"tabla"],[2,"width","40px"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[3,"ngValue"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[1,"text-center"],[1,"btn-icon-chico","btn-gris-chico",3,"click","disabled","matTooltip"],[3,"icon"],["colspan","13",2,"background","#fafafa"],[1,"table-responsive"],[1,"detalle-tabla"],[1,"mt-1",2,"background-color","aquamarine"],[1,"row","align-items-end"],[1,"col-4","subtitulo"],[1,"col-2"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","10",1,"text-center","text-muted","py-2"],["colspan","13",1,"text-center","text-muted","py-3"],["colspan","6",1,"text-end"],[1,"text-end",2,"font-weight","600"]],template:function(e,n){if(e&1){let r=ae();l(0,"div",1)(1,"h2",2),d(2,"Reporte de Ventas"),s(),l(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),d(7,"Farmacia"),s(),l(8,"select",7),w("change",function(){return P(r),k(n.buscar(!0))}),N(9,dk,2,2,"option",8),s()(),l(10,"div",9)(11,"label",6),d(12,"Cliente"),s(),l(13,"input",10,0),w("input",function(){P(r);let o=Gt(14);return k(n.onClienteInput(o.value))}),s(),N(15,mk,2,1,"div",11)(16,fk,5,1,"div",12),s(),l(17,"div",13)(18,"label",6),d(19,"Vendi\xF3:"),s(),l(20,"select",14),w("change",function(){return P(r),k(n.buscar(!0))}),N(21,pk,2,2,"option",8),s()(),l(22,"div",5)(23,"label",6),d(24,"# de Ventas por p\xE1gina"),s(),y(25,"input",15),s(),l(26,"div",16)(27,"div",17)(28,"label",6),d(29,"Fecha inicial"),s(),y(30,"input",18),s(),l(31,"div",17)(32,"label",6),d(33,"Fecha final"),s(),y(34,"input",19),s(),l(35,"div",17)(36,"label",6),d(37,"Total desde"),s(),y(38,"input",20),s(),l(39,"div",17)(40,"label",6),d(41,"Total hasta"),s(),y(42,"input",21),s(),l(43,"div",22)(44,"button",23),w("click",function(){return P(r),k(n.limpiar())}),y(45,"i",24),s()(),l(46,"div",25)(47,"button",26),w("click",function(){return P(r),k(n.buscar(!0))}),d(48),s()()()()(),l(49,"div",27)(50,"table",28)(51,"thead")(52,"tr")(53,"th",29),d(54,"Det."),s(),l(55,"th"),d(56,"Farmacia"),s(),l(57,"th"),d(58,"Vendi\xF3"),s(),l(59,"th"),d(60,"Fecha"),s(),l(61,"th"),d(62,"Folio"),s(),l(63,"th"),d(64,"Cliente"),s(),l(65,"th",30),d(66,"# Prod."),s(),l(67,"th",30),d(68,"Al moned."),s(),l(69,"th",30),d(70,"Descuento"),s(),l(71,"th",30),d(72,"Costo"),s(),l(73,"th",30),d(74,"Utilidad"),s(),l(75,"th",30),d(76,"% Gan."),s(),l(77,"th",30),d(78,"Total"),s()()(),l(79,"tbody"),N(80,xk,38,40,"ng-container",31)(81,bk,3,0,"tr",32),s(),N(82,yk,26,25,"tfoot",32),s(),l(83,"div",33)(84,"button",34),w("click",function(){return P(r),k(n.primera())}),y(85,"i",35),s(),l(86,"button",36),w("click",function(){return P(r),k(n.anterior())}),y(87,"i",37),s(),d(88),l(89,"button",38),w("click",function(){return P(r),k(n.siguiente())}),y(90,"i",39),s(),l(91,"button",40),w("click",function(){return P(r),k(n.ultima())}),y(92,"i",41),s()()()()}e&2&&(c(4),p("formGroup",n.filtroForm),c(4),p("disabled",!n.farmaciasCargadas||n.cargando),c(),p("ngForOf",n.farmacias),c(4),p("disabled",n.cargando||!!n.clienteSel),c(2),p("ngIf",n.clienteOpts.length&&!n.clienteSel),c(),p("ngIf",n.clienteSel),c(4),p("disabled",n.cargando||!n.usuariosCargados),c(),p("ngForOf",n.usuarios),c(23),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(32),p("ngForOf",n.rows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length>0),c(2),p("disabled",n.cargando||n.page===1),c(2),p("disabled",n.cargando||n.page===1),c(2),yn(" Ventas: ",n.totalRegistros," \xA0 | \xA0 P\xE1gina: ",n.page," / ",n.totalPaginas||1," "),c(),p("disabled",n.cargando||n.page===n.totalPaginas||n.totalPaginas===0),c(2),p("disabled",n.cargando||n.page===n.totalPaginas||n.totalPaginas===0))},dependencies:[Oe,We,Ne,wt,Nt,Lt,At,rt,at,qe,qt,nt,ze,Ft,Bi,Yn,ci,di,ti,ei,Vt,dt],styles:[".container-ventas[_ngcontent-%COMP%]{width:100%}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sugerencias[_ngcontent-%COMP%]   .list-group-item.active[_ngcontent-%COMP%]{background-color:#f0f0f0;color:inherit}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;margin-top:.25rem;max-height:320px;overflow:auto;box-shadow:0 .25rem .75rem #00000014}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.5rem .75rem;border:0;background:transparent}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8fafc}"]})};var Ug=hi(ki());var _a=(i,t)=>({"text-success":i,"text-negativo":t});function Ck(i,t){if(i&1&&(l(0,"option",21),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function Sk(i,t){if(i&1&&(l(0,"tr")(1,"td",22),d(2),s(),l(3,"td",19),d(4),F(5,"number"),s(),l(6,"td",20),d(7),F(8,"number"),s(),l(9,"td",19),d(10),F(11,"number"),s(),l(12,"td",20),d(13),F(14,"number"),s(),l(15,"td",20),d(16),F(17,"number"),s()()),i&2){let e=t.$implicit;c(),p("ngClass",ji(24,_a,e.concepto=="Ventas"||e.concepto=="Pedidos",e.concepto=="Devoluciones"||e.concepto=="Cancelaciones")),c(),R(" ",e.concepto," "),c(2),T(se(5,10,e.cantidad)),c(2),p("ngClass",ji(27,_a,e.importe>=0,e.importe<0)),c(),R(" $",Q(8,12,e.importe,"1.2-2")," "),c(3),R("$",Q(11,15,e.costo,"1.2-2"),""),c(2),p("ngClass",ji(30,_a,e.utilidad>=0,e.utilidad<0)),c(),R(" $",Q(14,18,e.utilidad,"1.2-2")," "),c(2),p("ngClass",ji(33,_a,e.utilidad>=0,e.utilidad<0)),c(),R(" ",e.costo==0?0:Q(17,21,e.utilidad/e.costo*100,"1.2-2"),"% ")}}var hc=class i{constructor(t,e,n){this.fb=t;this.reportes=e;this.farmaciaSrv=n}filtroForm;cargando=!1;rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}];farmacias=[];farmaciasCargadas=!1;totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;ngOnInit(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaIni:[t],fechaFin:[e]}),this.cargarFarmacias(),this.limpiar()}cargarFarmacias(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.farmaciasCargadas=!0,this.buscar()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.buscar()}})}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}-01`}limpiar(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm.patchValue({farmaciaId:"",fechaIni:t,fechaFin:e}),this.filtroForm.markAsPristine(),this.filtroForm.markAsUntouched(),this.buscar()}buscar(){if(!this.farmaciasCargadas)return;let t=this.filtroForm.value,e={farmaciaId:t.farmaciaId||void 0,fechaIni:t.fechaIni,fechaFin:t.fechaFin};this.cargando=!0,this.reportes.getResumenUtilidades(e).subscribe({next:n=>{let r={};(n.rows||[]).forEach(u=>{r[u.concepto]=u});let a=u=>Number.isFinite(+u)?+u:0,o=u=>{let m=r[u]||{concepto:u,cantidad:0,importe:0,costo:0,utilidad:0};return{concepto:u,cantidad:a(m.cantidad),importe:a(m.importe),costo:a(m.costo),utilidad:a(m.utilidad)}};this.rows=[o("Ventas"),o("Pedidos"),o("Devoluciones"),o("Cancelaciones")],this.totalCantidad=this.rows.reduce((u,m)=>u+m.cantidad,0),this.totalImporte=this.rows.reduce((u,m)=>u+m.importe,0),this.totalCosto=this.rows.reduce((u,m)=>u+m.costo,0),this.totalUtilidad=this.rows.reduce((u,m)=>u+m.utilidad,0),this.cargando=!1},error:n=>{this.cargando=!1,this.rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}],this.totalCantidad=this.totalImporte=this.totalCosto=this.totalUtilidad=0;let r=n?.error?.mensaje||n?.message||"No se pudo consultar el resumen de utilidades.";Ug.default.fire("Error",r,"error")}})}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(In),ie(Xt))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-resumen-utilidades"]],decls:60,vars:40,consts:[[1,"container-fluid"],[1,"titulo","text-center"],[1,"row","align-items-end","mb-2",3,"formGroup"],[1,"row","g-2","align-items-end","mb-3","filtros"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-2"],["type","date","formControlName","fechaIni",1,"form-control",3,"change","disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"change","disabled"],[1,"col-auto","ms-auto"],[1,"btn","btn-amarillo",3,"click","disabled"],[1,"btn","btn-gris","ms-4",3,"click","disabled"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"fw-bold"],[1,"text-end","text-success"],[1,"text-end",3,"ngClass"],[3,"ngValue"],[3,"ngClass"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h3",1),d(2,"Resumen utilidades"),s(),l(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Farmacia"),s(),l(8,"select",6),w("change",function(){return n.buscar()}),N(9,Ck,2,2,"option",7),s()(),l(10,"div",8)(11,"label",5),d(12,"Fecha inicial"),s(),l(13,"input",9),w("change",function(){return n.buscar()}),s()(),l(14,"div",8)(15,"label",5),d(16,"Fecha final"),s(),l(17,"input",10),w("change",function(){return n.buscar()}),s()(),l(18,"div",11)(19,"button",12),w("click",function(){return n.limpiar()}),d(20,"Hoy / Mes actual"),s(),l(21,"button",13),w("click",function(){return n.buscar()}),d(22),s()()()(),l(23,"div",14)(24,"table",15)(25,"thead")(26,"tr")(27,"th"),d(28,"Concepto"),s(),l(29,"th",16),d(30,"Cant. Movim."),s(),l(31,"th",16),d(32,"Importe"),s(),l(33,"th",16),d(34,"Costo"),s(),l(35,"th",16),d(36,"Utilidad"),s(),l(37,"th",16),d(38,"% Gan."),s()()(),l(39,"tbody"),N(40,Sk,18,36,"tr",17),s(),l(41,"tfoot")(42,"tr",18)(43,"td",16),d(44,"Totales:"),s(),l(45,"td",19),d(46),F(47,"number"),s(),l(48,"td",20),d(49),F(50,"number"),s(),l(51,"td",19),d(52),F(53,"number"),s(),l(54,"td",20),d(55),F(56,"number"),s(),l(57,"td",20),d(58),F(59,"number"),s()()()()()()),e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",!n.farmaciasCargadas||n.cargando),c(),p("ngForOf",n.farmacias),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(),R(" ",n.cargando?"Consultando\u2026":"Buscar"," "),c(18),p("ngForOf",n.rows),c(6),T(se(47,17,n.totalCantidad)),c(2),p("ngClass",ji(31,_a,n.totalImporte>=0,n.totalImporte<0)),c(),R(" $",Q(50,19,n.totalImporte,"1.2-2"),""),c(3),R("$",Q(53,22,n.totalCosto,"1.2-2"),""),c(2),p("ngClass",ji(34,_a,n.totalUtilidad>=0,n.totalUtilidad<0)),c(),R(" $",Q(56,25,n.totalUtilidad,"1.2-2")," "),c(2),p("ngClass",ji(37,_a,n.totalUtilidad>=0,n.totalUtilidad<0)),c(),R(" ",n.totalCosto==0?0:Q(59,28,n.totalUtilidad/n.totalCosto*100,"1.2-2"),"% "))},dependencies:[Oe,si,We,wt,Lt,At,rt,at,qe,nt,ze,Ft,ci,di],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-negativo[_ngcontent-%COMP%]{color:red}"]})};var va=hi(ki());var md=()=>({campo:"ventas",dir:"desc"}),fd=()=>({campo:"utilidad",dir:"desc"}),pd=()=>({campo:"ventas",dir:"asc"}),hd=()=>({campo:"utilidad",dir:"asc"}),fo=(i,t)=>({"text-success":i,"text-danger":t});function wk(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function Ek(i,t){if(i&1&&(l(0,"div",3)(1,"div",23)(2,"label",5),d(3,"Usuario"),s(),l(4,"select",24)(5,"option",25),d(6,"(Todos)"),s(),N(7,wk,2,2,"option",26),s()(),l(8,"div",23)(9,"label",5),d(10,"Los mejores / peores por:"),s(),l(11,"select",27)(12,"option",28),d(13,"N\xFAm. de ventas las mejores"),s(),l(14,"option",28),d(15,"Utilidad las mejores"),s(),l(16,"option",28),d(17,"N\xFAm. de ventas las peores"),s(),l(18,"option",28),d(19,"Utilidad las peores"),s()()()()),i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.usuarios),c(4),p("disabled",e.cargando),c(),p("ngValue",Jt(7,md)),c(2),p("ngValue",Jt(8,fd)),c(2),p("ngValue",Jt(9,pd)),c(2),p("ngValue",Jt(10,hd))}}function Tk(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function Pk(i,t){if(i&1&&(l(0,"div",3)(1,"div",29)(2,"label",5),d(3,"Cliente"),s(),l(4,"select",30)(5,"option",25),d(6,"(Todos)"),s(),N(7,Tk,2,2,"option",26),s()(),l(8,"div",4)(9,"label",5),d(10,"\xBFCu\xE1ntos clientes?"),s(),y(11,"input",31),s(),l(12,"div",23)(13,"label",5),d(14,"Los mejores / peores por:"),s(),l(15,"select",32)(16,"option",28),d(17,"N\xFAm. de compras las mejores"),s(),l(18,"option",28),d(19,"Utilidad las mejores"),s(),l(20,"option",28),d(21,"N\xFAm. de compras las peores"),s(),l(22,"option",28),d(23,"Utilidad las peores"),s()()()()),i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.clientes),c(4),p("disabled",e.cargando||!!e.filtroForm.value.clienteId),c(4),p("disabled",e.cargando),c(),p("ngValue",Jt(8,md)),c(2),p("ngValue",Jt(9,fd)),c(2),p("ngValue",Jt(10,pd)),c(2),p("ngValue",Jt(11,hd))}}function kk(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),T(e.nombre)}}function Ik(i,t){if(i&1&&(l(0,"div",40),d(1),s()),i&2){let e=_(2);c(),R(" ",e.errorProductoCB," ")}}function Mk(i,t){if(i&1){let e=ae();l(0,"div",3)(1,"div",23)(2,"label",5),d(3,"Farmacia"),s(),l(4,"select",33)(5,"option",25),d(6,"TODAS"),s(),N(7,kk,2,2,"option",26),s()(),l(8,"div",29)(9,"label",5),d(10,"C\xF3digo de barras"),s(),l(11,"input",34),w("keyup.enter",function(){P(e);let r=_();return k(r.resolverProductoPorCB())}),s(),N(12,Ik,2,1,"div",35),s(),l(13,"div",36)(14,"label",5),d(15,"Producto"),s(),y(16,"input",37),s(),l(17,"div",4)(18,"label",5),d(19,"\xBFCu\xE1ntos productos?"),s(),y(20,"input",38),s(),l(21,"div",4)(22,"label",5),d(23,"Los mejores / peores por: "),s(),l(24,"select",39)(25,"option",28),d(26,"N\xFAm. de Ventas las mejores"),s(),l(27,"option",28),d(28,"Utilidad las mejores"),s(),l(29,"option",28),d(30,"N\xFAm. de Ventas las peores"),s(),l(31,"option",28),d(32,"Utilidad las peores"),s()()()()}if(i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.farmacias),c(4),p("disabled",e.cargando),c(),p("ngIf",e.errorProductoCB),c(4),p("value",e.productoResueltoNombre),c(4),p("disabled",e.cargando&&!e.filtroForm.value.productoId),c(4),p("disabled",e.cargando),c(),p("ngValue",Jt(11,md)),c(2),p("ngValue",Jt(12,fd)),c(2),p("ngValue",Jt(13,pd)),c(2),p("ngValue",Jt(14,hd))}}function Fk(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td",43),d(4),F(5,"number"),s(),l(6,"td",45),d(7),F(8,"number"),s(),l(9,"td",46),d(10),F(11,"number"),s(),l(12,"td",43),d(13),F(14,"number"),s(),l(15,"td",45),d(16),F(17,"number"),s(),l(18,"td",46),d(19),F(20,"number"),s(),l(21,"td",45),d(22),F(23,"number"),s(),l(24,"td",46),d(25),F(26,"number"),s(),l(27,"td",47),d(28),F(29,"number"),s(),l(30,"td",43),d(31),F(32,"number"),s()()),i&2){let e=t.$implicit;c(2),T(e.usuario||e.usuarioNombre||e.nombre||"(sin nombre)"),c(2),T(se(5,12,e.numVentas||e.ventasCount)),c(3),R("$",Q(8,14,e.impVentas,"1.2-2"),""),c(3),R("$",Q(11,17,e.costoVentas,"1.2-2"),""),c(3),T(se(14,20,e.numPedidos||e.pedidosCount)),c(3),R("$",Q(17,22,e.impPedidos,"1.2-2"),""),c(3),R("$",Q(20,25,e.costoPedidos,"1.2-2"),""),c(3),R("$",Q(23,28,e.ingresos,"1.2-2"),""),c(3),R("$",Q(26,31,e.egresos,"1.2-2"),""),c(2),p("ngClass",ji(40,fo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Q(29,34,e.utilidad,"1.2-2")," "),c(3),T(e.gananciaPct==null?"\u2014":Q(32,37,e.gananciaPct,"1.0-2")+"%")}}function Ak(i,t){i&1&&(l(0,"tr")(1,"td",48),d(2,"Sin resultados"),s()())}function Ok(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),d(4,"Totales:"),s()(),l(5,"td",43)(6,"strong"),d(7),F(8,"number"),s()(),l(9,"td",45)(10,"strong"),d(11),F(12,"number"),s()(),l(13,"td",46)(14,"strong"),d(15),F(16,"number"),s()(),l(17,"td",43)(18,"strong"),d(19),F(20,"number"),s()(),l(21,"td",45)(22,"strong"),d(23),F(24,"number"),s()(),l(25,"td",46)(26,"strong"),d(27),F(28,"number"),s()(),l(29,"td",45)(30,"strong"),d(31),F(32,"number"),s()(),l(33,"td",46)(34,"strong"),d(35),F(36,"number"),s()(),l(37,"td",47)(38,"strong"),d(39),F(40,"number"),s()(),l(41,"td",43)(42,"strong"),d(43),F(44,"number"),s()()()()),i&2){let e=_(2);c(7),T(se(8,11,e.footerUsuarios.totalVentas)),c(4),R("$",Q(12,13,e.footerUsuarios.totalImpVentas,"1.2-2"),""),c(4),R("$",Q(16,16,e.footerUsuarios.totalCostoVentas,"1.2-2"),""),c(4),T(se(20,19,e.footerUsuarios.totalPedidos)),c(4),R("$",Q(24,21,e.footerUsuarios.totalImpPedidos,"1.2-2"),""),c(4),R("$",Q(28,24,e.footerUsuarios.totalCostoPedidos,"1.2-2"),""),c(4),R("$",Q(32,27,e.footerUsuarios.totalIngresos,"1.2-2"),""),c(4),R("$",Q(36,30,e.footerUsuarios.totalEgresos,"1.2-2"),""),c(2),p("ngClass",ji(39,fo,(e.footerUsuarios.totalUtilidad||0)>=0,(e.footerUsuarios.totalUtilidad||0)<0)),c(2),R("$",Q(40,33,e.footerUsuarios.totalUtilidad,"1.2-2"),""),c(4),T(e.footerUsuarios.gananciaPct==null?"\u2014":Q(44,36,e.footerUsuarios.gananciaPct,"1.0-2")+"%")}}function Dk(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Usuario"),s(),l(7,"th",43),d(8,"#Ventas"),s(),l(9,"th",43),d(10,"Imp. Ventas"),s(),l(11,"th",43),d(12,"Costo Ventas"),s(),l(13,"th",43),d(14,"#Pedidos"),s(),l(15,"th",43),d(16,"Imp. Pedidos"),s(),l(17,"th",43),d(18,"Costo Pedidos"),s(),l(19,"th",43),d(20,"Ingresos"),s(),l(21,"th",43),d(22,"Egresos"),s(),l(23,"th",43),d(24,"Utilidad"),s(),l(25,"th",43),d(26,"%Gan"),s()()(),l(27,"tbody"),N(28,Fk,33,43,"tr",44)(29,Ak,3,0,"tr",22),s(),N(30,Ok,45,42,"tfoot",22),s()()()),i&2){let e=_();c(28),p("ngForOf",e.rowsUsuarios),c(),p("ngIf",e.rowsUsuarios.length===0),c(),p("ngIf",e.footerUsuarios)}}function Rk(i,t){if(i&1&&(l(0,"small",51),d(1),s()),i&2){let e=_().$implicit;c(),R("Tel: ",e.telefono,"")}}function Nk(i,t){if(i&1&&(l(0,"tr")(1,"td")(2,"div"),d(3),s(),N(4,Rk,2,1,"small",50),s(),l(5,"td",43),d(6),F(7,"number"),s(),l(8,"td",43),d(9),F(10,"number"),s(),l(11,"td",45),d(12),F(13,"number"),s(),l(14,"td",46),d(15),F(16,"number"),s(),l(17,"td",43),d(18),F(19,"number"),s(),l(20,"td",45),d(21),F(22,"number"),s(),l(23,"td",46),d(24),F(25,"number"),s(),l(26,"td",45),d(27),F(28,"number"),s(),l(29,"td",46),d(30),F(31,"number"),s(),l(32,"td",47),d(33),F(34,"number"),s(),l(35,"td",43),d(36),F(37,"number"),s()()),i&2){let e=t.$implicit;c(3),T(e.cliente),c(),p("ngIf",e.telefono),c(2),R("$",Q(7,14,e.totalMonedero,"1.2-2"),""),c(3),T(se(10,17,e.numVentas)),c(3),R("$",Q(13,19,e.impVentas,"1.2-2"),""),c(3),R("$",Q(16,22,e.costoVentas,"1.2-2"),""),c(3),T(se(19,25,e.numPedidos)),c(3),R("$",Q(22,27,e.impPedidos,"1.2-2"),""),c(3),R("$",Q(25,30,e.costoPedidos,"1.2-2"),""),c(3),R("$",Q(28,33,e.ingresos,"1.2-2"),""),c(3),R("$",Q(31,36,e.egresos,"1.2-2"),""),c(2),p("ngClass",ji(45,fo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Q(34,39,e.utilidad,"1.2-2")," "),c(3),T(e.gananciaPct==null?"\u2014":Q(37,42,e.gananciaPct,"1.0-2")+"%")}}function Bk(i,t){i&1&&(l(0,"tr")(1,"td",52),d(2,"Sin resultados"),s()())}function Lk(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),d(4,"Totales:"),s()(),l(5,"td",43)(6,"strong"),d(7),F(8,"number"),s()(),l(9,"td",43)(10,"strong"),d(11),F(12,"number"),s()(),l(13,"td",45)(14,"strong"),d(15),F(16,"number"),s()(),l(17,"td",46)(18,"strong"),d(19),F(20,"number"),s()(),l(21,"td",43)(22,"strong"),d(23),F(24,"number"),s()(),l(25,"td",45)(26,"strong"),d(27),F(28,"number"),s()(),l(29,"td",46)(30,"strong"),d(31),F(32,"number"),s()(),l(33,"td",45)(34,"strong"),d(35),F(36,"number"),s()(),l(37,"td",46)(38,"strong"),d(39),F(40,"number"),s()(),l(41,"td",47)(42,"strong"),d(43),F(44,"number"),s()(),l(45,"td",43)(46,"strong"),d(47),F(48,"number"),s()()()()),i&2){let e=_(2);c(7),R("$",Q(8,12,e.footerClientes.totalMonedero,"1.2-2"),""),c(4),T(se(12,15,e.footerClientes.totalVentas)),c(4),R("$",Q(16,17,e.footerClientes.totalImpVentas,"1.2-2"),""),c(4),R("$",Q(20,20,e.footerClientes.totalCostoVentas,"1.2-2"),""),c(4),T(se(24,23,e.footerClientes.totalPedidos)),c(4),R("$",Q(28,25,e.footerClientes.totalImpPedidos,"1.2-2"),""),c(4),R("$",Q(32,28,e.footerClientes.totalCostoPedidos,"1.2-2"),""),c(4),R("$",Q(36,31,e.footerClientes.totalIngresos,"1.2-2"),""),c(4),R("$",Q(40,34,e.footerClientes.totalEgresos,"1.2-2"),""),c(2),p("ngClass",ji(43,fo,(e.footerClientes.totalUtilidad||0)>=0,(e.footerClientes.totalUtilidad||0)<0)),c(2),R("$",Q(44,37,e.footerClientes.totalUtilidad,"1.2-2"),""),c(4),T(e.footerClientes.gananciaPct==null?"\u2014":Q(48,40,e.footerClientes.gananciaPct,"1.0-2")+"%")}}function Vk(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Cliente"),s(),l(7,"th",43),d(8,"Monedero"),s(),l(9,"th",43),d(10,"#Compras"),s(),l(11,"th",43),d(12,"Imp. Compras"),s(),l(13,"th",43),d(14,"Costo Compras"),s(),l(15,"th",43),d(16,"#Pedidos"),s(),l(17,"th",43),d(18,"Imp. Pedidos"),s(),l(19,"th",43),d(20,"Costo Pedidos"),s(),l(21,"th",43),d(22,"Ingresos"),s(),l(23,"th",43),d(24,"Egresos"),s(),l(25,"th",43),d(26,"Utilidad"),s(),l(27,"th",43),d(28,"%Gan"),s()()(),l(29,"tbody"),N(30,Nk,38,48,"tr",44)(31,Bk,3,0,"tr",22),s(),N(32,Lk,49,46,"tfoot",22),s()()()),i&2){let e=_();c(30),p("ngForOf",e.rowsClientes),c(),p("ngIf",e.rowsClientes.length===0),c(),p("ngIf",e.footerClientes)}}function Uk(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td",43),d(6),F(7,"number"),s(),l(8,"td",45),d(9),F(10,"number"),s(),l(11,"td",46),d(12),F(13,"number"),s(),l(14,"td",47),d(15),F(16,"number"),s(),l(17,"td",43),d(18),F(19,"number"),s()()),i&2){let e=t.$implicit;c(2),T(e.producto),c(2),T(e.codigoBarras),c(2),T(se(7,8,e.numVentas)),c(3),R("$",Q(10,10,e.importe,"1.2-2"),""),c(3),R("$",Q(13,13,e.costo,"1.2-2"),""),c(2),p("ngClass",ji(22,fo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Q(16,16,e.utilidad,"1.2-2")," "),c(3),T(e.gananciaPct==null?"\u2014":Q(19,19,e.gananciaPct,"1.0-2")+"%")}}function jk(i,t){i&1&&(l(0,"tr")(1,"td",53),d(2,"Sin resultados"),s()())}function Wk(i,t){if(i&1&&(l(0,"tfoot")(1,"tr")(2,"th",54),d(3,"Totales:"),s(),l(4,"th",43),d(5),F(6,"number"),s(),l(7,"th",45),d(8),F(9,"number"),s(),l(10,"th",46),d(11),F(12,"number"),s(),l(13,"th",47),d(14),F(15,"number"),s(),l(16,"th",43),d(17),F(18,"number"),s()()()),i&2){let e=_(2);c(5),T(se(6,6,e.footerProductos.numVentas)),c(3),R("$",Q(9,8,e.footerProductos.importe,"1.2-2"),""),c(3),R("$",Q(12,11,e.footerProductos.costo,"1.2-2"),""),c(2),p("ngClass",ji(20,fo,(e.footerProductos.utilidad||0)>=0,(e.footerProductos.utilidad||0)<0)),c(),R(" $",Q(15,14,e.footerProductos.utilidad,"1.2-2")," "),c(3),R(" ",e.footerProductos.gananciaPct==null?"\u2014":Q(18,17,e.footerProductos.gananciaPct,"1.0-2")+"%"," ")}}function Hk(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3digo de Barras"),s(),l(9,"th",43),d(10,"#Ventas"),s(),l(11,"th",43),d(12,"Importe"),s(),l(13,"th",43),d(14,"Costo"),s(),l(15,"th",43),d(16,"Utilidad"),s(),l(17,"th",43),d(18,"%Gan"),s()()(),l(19,"tbody"),N(20,Uk,20,25,"tr",44)(21,jk,3,0,"tr",22),s(),N(22,Wk,19,23,"tfoot",22),s()()()),i&2){let e=_();c(20),p("ngForOf",e.rowsProductos),c(),p("ngIf",e.rowsProductos.length===0),c(),p("ngIf",e.rowsProductos.length>0&&e.footerProductos)}}var gc=class i{constructor(t,e,n,r,a,o,u){this.fb=t;this.reportes=e;this.farmaciaSrv=n;this.usuarioSrv=r;this.clienteSrv=a;this.productoSrv=o;this.cdr=u}filtroForm;cargando=!1;reportType="clientes";farmacias=[];usuarios=[];clientes=[];catCargados={farmacias:!1,usuarios:!1,clientes:!1};rowsClientes=[];rowsProductos=[];rowsUsuarios=[];productoResueltoNombre="";errorProductoCB="";footerProductos=null;footerUsuarios=null;footerClientes=null;ngOnInit(){let t=this.todayYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({fechaIni:[e,Pe.required],fechaFin:[t,Pe.required],tipo:[this.reportType,Pe.required],farmaciaId:[""],clienteId:[""],cantClientes:[""],ordenClientes:["ventas"],codigoBarras:[""],productoId:[""],cantProductos:[""],ordenProductos:["ventas"],usuarioId:[""],ordenUsuarios:["ventas"]}),this.cargarCatalogos(),this.filtroForm.get("tipo").valueChanges.subscribe(n=>{this.reportType=n}),this.filtroForm.get("productoId")?.valueChanges.subscribe(()=>this.syncCantProductosState()),this.syncCantProductosState()}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}-01`}collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});sortByNombre(t){return[...t].sort((e,n)=>this.collator.compare(e.nombre||"",n.nombre||""))}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.catCargados.farmacias=!0},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.catCargados.farmacias=!0}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{this.usuarios=t||[],this.catCargados.usuarios=!0},error:()=>{this.usuarios=[],this.catCargados.usuarios=!0}}),this.clienteSrv.getClientes().subscribe({next:t=>{let e=(t||[]).map(r=>({_id:r._id,nombre:r.nombre})),n=this.sortByNombre(e);this.clientes=[{_id:"",nombre:"(Todos)"},...n],this.catCargados.clientes=!0},error:()=>{this.clientes=[],this.catCargados.clientes=!0}})}limpiar(){this.filtroForm.patchValue({fechaIni:this.monthStartYMD(),fechaFin:this.monthStartYMD(),farmaciaId:"",codigoBarras:"",productoId:"",cantProductos:null,ordenProductos:"utilidad",clienteId:"",cantClientes:null,ordenClientes:"utilidad",usuarioId:"",cantUsuarios:null,ordenUsuarios:"utilidad"},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="",this.rowsProductos=[],this.rowsClientes=[],this.rowsUsuarios=[],this.footerProductos=null,this.footerUsuarios=null,this.footerClientes=null,this.footerProductos=null,this.footerClientes=null,this.footerUsuarios=null}buscar(){return Ae(this,null,function*(){if(this.cargando)return;if(this.reportType==="productos"){this.rowsProductos=[],this.footerProductos=null;let r=String(this.filtroForm.get("codigoBarras")?.value||"").trim(),a=String(this.filtroForm.get("productoId")?.value||"").trim();r&&!a&&(yield this.resolverProductoPorCB()),String(this.filtroForm.get("productoId")?.value||"").trim()&&this.filtroForm.patchValue({cantProductos:null},{emitEvent:!1})}else this.reportType==="clientes"?(this.rowsClientes=[],this.footerClientes=null):this.reportType==="usuarios"&&(this.rowsUsuarios=[],this.footerUsuarios=null);let t=this.filtroForm.getRawValue(),{fechaIni:e,fechaFin:n}=t;if(!e||!n){va.default.fire("Faltan datos","Selecciona fecha inicial y final.","warning");return}switch(this.cargando=!0,this.reportType){case"clientes":this.buscarClientes(t);break;case"productos":this.buscarProductos(t);break;case"usuarios":this.buscarUsuarios(t);break}})}buscarClientes(t){let e=t.clienteId||void 0,n=t.ordenClientes||{campo:"utilidad",dir:"desc"};if(!e){let a=parseInt(String(t.cantClientes||"").trim(),10);if(!Number.isFinite(a)||a<=0){this.cargando=!1,va.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos clientes? \xF3 selecciona un cliente.","warning");return}}let r=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,clienteId:e,CantClientes:e?void 0:t.cantClientes,orden:n.campo,dir:n.dir});this.reportes.getUtilidadPorClientes(r).subscribe({next:a=>{this.rowsClientes=a?.rows||[],this.footerClientes=a?.footer??null,this.cargando=!1,console.log("fotter clientes ",this.footerClientes)},error:a=>{console.error("[Utilidad x clientes][ERROR]",a),this.rowsClientes=[],this.cargando=!1;let o=a?.error?.mensaje||a?.message||"No se pudo consultar Utilidad por clientes.";va.default.fire("Error",o,"error")}})}buscarProductos(t){let e=t??this.filtroForm.getRawValue(),n=(e.productoId??"").toString().trim()||void 0,r=(e.farmaciaId??"").toString().trim()||void 0,a=e.ordenProductos||{campo:"utilidad",dir:"desc"};if(!n){let u=parseInt(String(e.cantProductos||"").trim(),10);if(!Number.isFinite(u)||u<=0){this.cargando=!1,va.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos productos? \xF3 selecciona un producto.","warning");return}}let o=this.cleanParams({fechaIni:e.fechaIni,fechaFin:e.fechaFin,productoId:n,cantProductos:n?void 0:e.cantProductos,orden:a.campo,dir:a.dir,farmaciaId:r});this.reportes.getUtilidadPorProductos(o).subscribe({next:u=>{this.rowsProductos=u?.rows||[],this.footerProductos=u?.footer??null,this.cargando=!1},error:u=>{this.rowsProductos=[],this.footerProductos=null,this.cargando=!1;let m=u?.error?.mensaje||u?.message||"No se pudo consultar Utilidad por productos.";va.default.fire("Error",m,"error")}})}buscarUsuarios(t){let e=t.usuarioId||void 0,n=t.ordenUsuarios||{campo:"utilidad",dir:"desc"},r=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,usuarioId:e,orden:n.campo,dir:n.dir});this.reportes.getUtilidadPorUsuarios(r).subscribe({next:a=>{this.rowsUsuarios=a?.rows||[],this.footerUsuarios=a?.footer??null,this.cargando=!1},error:a=>{console.error("[Utilidad x usuarios][ERROR]",a),this.rowsUsuarios=[],this.cargando=!1;let o=a?.error?.mensaje||a?.message||"No se pudo consultar Utilidad por usuarios.";va.default.fire("Error",o,"error")}})}cleanParams(t){let e={};return Object.entries(t).forEach(([n,r])=>{r!=null&&String(r).trim()!==""&&(e[n]=r)}),e}syncCantProductosState(){let t=(this.filtroForm.get("productoId")?.value||"").toString().trim(),e=this.filtroForm.get("cantProductos");e&&(t?(e.disable({emitEvent:!1}),e.setValue("",{emitEvent:!1})):e.enable({emitEvent:!1}))}resolverProductoPorCB(){return Ae(this,null,function*(){this.errorProductoCB="";let t=String(this.filtroForm.value.codigoBarras||"").trim();if(!t){this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.rowsProductos=[],this.footerProductos=null;return}try{let n=(yield gi(this.productoSrv.buscarPorCodigoBarras(t)))?.producto;n&&n._id?(this.filtroForm.patchValue({productoId:n._id,cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre=n.nombre||"",this.rowsProductos=[],this.footerProductos=null):(this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="No se encontr\xF3 un producto con ese c\xF3digo.")}catch{this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="Error consultando el producto."}})}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(In),ie(Xt),ie(Va),ie(Sn),ie(Ji),ie(Dt))};static \u0275cmp=Te({type:i,selectors:[["app-reportes-utilidad"]],decls:39,vars:18,consts:[[1,"container-fluid"],[1,"titulo",2,"text-align","center"],[1,"mb-3",3,"formGroup"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-6"],[1,"form-label","d-block","mb-1"],[1,"d-flex","gap-2","flex-wrap"],[1,"report-chip"],["type","radio","formControlName","tipo","value","clientes"],["type","radio","formControlName","tipo","value","usuarios"],["type","radio","formControlName","tipo","value","productos"],[1,"col-1"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-1","text-end"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"my-3"],["class","row g-2 align-items-end",4,"ngIf"],[4,"ngIf"],[1,"col-md-3"],["formControlName","usuarioId",1,"form-select",3,"disabled"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["formControlName","ordenUsuarios",1,"form-select",3,"disabled"],[3,"ngValue"],[1,"col-md-4"],["formControlName","clienteId",1,"form-select",3,"disabled"],["type","number","min","1","formControlName","cantClientes",1,"form-control",3,"disabled"],["formControlName","ordenClientes",1,"form-select",3,"disabled"],["formControlName","farmaciaId",1,"form-select",3,"disabled"],["type","text","formControlName","codigoBarras","placeholder","Escanea o escribe el c\xF3digo",1,"form-control",3,"keyup.enter","disabled"],["class","text-danger small",4,"ngIf"],[1,"col-md-5"],["type","text","placeholder","Se llenar\xE1 al resolver el c\xF3digo","readonly","",1,"form-control",3,"value"],["type","number","min","1","formControlName","cantProductos",1,"form-control",3,"disabled"],["formControlName","ordenProductos",1,"form-select",3,"disabled"],[1,"text-danger","small"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"text-end","text-success"],[1,"text-end","text-negativo"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"table-light"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","12",1,"text-center","text-muted"],["colspan","7",1,"text-center","text-muted"],["colspan","2",1,"text-end"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h3",1),d(2,"Reportes Tops de utilidades"),s(),l(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Fecha inicial"),s(),y(8,"input",6),s(),l(9,"div",4)(10,"label",5),d(11,"Fecha final"),s(),y(12,"input",7),s(),l(13,"div",8)(14,"label",9),d(15,"Reporte:"),s(),l(16,"div",10)(17,"label",11),y(18,"input",12),d(19," Utilidad por clientes "),s(),l(20,"label",11),y(21,"input",13),d(22," Utilidad por usuarios "),s(),l(23,"label",11),y(24,"input",14),d(25," Utilidad por productos "),s()()(),l(26,"div",15)(27,"button",16),w("click",function(){return n.limpiar()}),y(28,"i",17),s()(),l(29,"div",18)(30,"button",19),w("click",function(){return n.buscar()}),d(31),s()()(),y(32,"hr",20),N(33,Ek,20,11,"div",21)(34,Pk,24,12,"div",21)(35,Mk,33,15,"div",21),s(),N(36,Dk,31,3,"div",22)(37,Vk,33,3,"div",22)(38,Hk,23,3,"div",22),s()),e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(5),Be("active",n.filtroForm.value.tipo==="clientes"),c(3),Be("active",n.filtroForm.value.tipo==="usuarios"),c(3),Be("active",n.filtroForm.value.tipo==="productos"),c(4),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Consultando\u2026":"Buscar"," "),c(2),p("ngIf",n.reportType==="usuarios"),c(),p("ngIf",n.reportType==="clientes"),c(),p("ngIf",n.reportType==="productos"),c(),p("ngIf",n.reportType==="usuarios"),c(),p("ngIf",n.reportType==="clientes"),c(),p("ngIf",n.reportType==="productos"))},dependencies:[Oe,si,We,Ne,wt,Lt,At,rt,at,qe,qt,nt,Pr,ze,Ft,Bi,ci,di,Vt,dt],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-positivo[_ngcontent-%COMP%]{color:#325301}.text-negativo[_ngcontent-%COMP%]{color:red}.report-chip[_ngcontent-%COMP%]{border:1px solid #d0d7de;border-radius:9999px;padding:.375rem .75rem;cursor:pointer;-webkit-user-select:none;user-select:none;display:inline-flex;align-items:center;gap:.5rem;transition:all .15s ease-in-out}.report-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.report-chip[_ngcontent-%COMP%]:hover{background:#a5d1fa}.report-chip.active[_ngcontent-%COMP%]{border-color:#0d6efd;background:#e7f1ff;color:#0d6efd;font-weight:600;box-shadow:0 0 0 2px #0d6efd26 inset}"]})};var $k=["paginator"],zk=()=>["detail"],Gk=()=>[15,30,50,100];function qk(i,t){if(i&1){let e=ae();l(0,"button",42),w("click",function(){P(e);let r=_();return k(r.limpiarProveedor())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Xk(i,t){if(i&1){let e=ae();l(0,"button",44),w("click",function(){P(e);let r=_();return k(r.limpiarProducto())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Kk(i,t){if(i&1){let e=ae();l(0,"button",45),w("click",function(){P(e);let r=_();return k(r.limpiarCodigo())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Yk(i,t){if(i&1){let e=ae();l(0,"button",46),w("click",function(){P(e);let r=_();return k(r.limpiarDesde())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Qk(i,t){if(i&1){let e=ae();l(0,"button",47),w("click",function(){P(e);let r=_();return k(r.limpiarHasta())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Jk(i,t){if(i&1){let e=ae();l(0,"button",48),w("click",function(){P(e);let r=_();return k(r.limpiarIni())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Zk(i,t){if(i&1){let e=ae();l(0,"button",49),w("click",function(){P(e);let r=_();return k(r.limpiarFin())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function eI(i,t){i&1&&(l(0,"th",50),d(1,"Det."),s())}function tI(i,t){if(i&1){let e=ae();l(0,"td",51)(1,"button",52),w("click",function(){let r=P(e).$implicit,a=_();return k(a.toggleDetalle(r))}),l(2,"mat-icon"),d(3),s()()()}if(i&2){let e=t.$implicit,n=_();c(),p("matTooltip",n.expandedId===e.compraId?"Ocultar detalle":"Ver detalle"),c(2),T(n.expandedId===e.compraId?"expand_less":"expand_more")}}function iI(i,t){i&1&&y(0,"td",53)}function nI(i,t){i&1&&(l(0,"th",50),d(1,"Fecha"),s())}function rI(i,t){if(i&1&&(l(0,"td",51),d(1),F(2,"date"),s()),i&2){let e=t.$implicit;c(),T(Q(2,1,e.fecha,"dd/MM/yyyy HH:mm"))}}function aI(i,t){i&1&&y(0,"td",53)}function oI(i,t){i&1&&(l(0,"th",50),d(1,"Proveedor"),s())}function sI(i,t){if(i&1&&(l(0,"td",51),d(1),s()),i&2){let e=t.$implicit;c(),T(e.proveedor)}}function lI(i,t){i&1&&(l(0,"td",54)(1,"strong"),d(2,"Gran Total ==>"),s()())}function cI(i,t){i&1&&(l(0,"th",55),d(1,"Total"),s())}function dI(i,t){if(i&1&&(l(0,"td",56),d(1),F(2,"number"),s()),i&2){let e=t.$implicit;c(),R(" $",Q(2,1,e.total,"1.2-2")," ")}}function uI(i,t){if(i&1&&(l(0,"td",57),d(1),F(2,"currency"),s()),i&2){let e=_();c(),R(" ",Om(2,1,(e.footer==null?null:e.footer.totalCompras)||0,"MXN","symbol-narrow","1.2-2")," ")}}function mI(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td",60),d(6),F(7,"number"),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),F(12,"date"),s(),l(13,"td",60),d(14),F(15,"number"),s(),l(16,"td",60),d(17),F(18,"number"),s()()),i&2){let e=t.$implicit;c(2),T(e.nombre),c(2),T(e.codigoBarras),c(2),T(se(7,7,e.cantidad)),c(3),T(e.lote),c(2),T(Q(12,9,e.fechaCaducidad,"dd/MM/yyyy")),c(3),R("$",Q(15,12,e.costoUnitario,"1.2-2"),""),c(3),R("$",Q(18,15,e.precioUnitario,"1.2-2"),"")}}function fI(i,t){i&1&&(l(0,"tr")(1,"td",62),d(2,"Sin productos en esta compra."),s()())}function pI(i,t){if(i&1&&(l(0,"td",51)(1,"div",58)(2,"table",59)(3,"thead")(4,"tr")(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3digo de Barras"),s(),l(9,"th",60),d(10,"Cantidad"),s(),l(11,"th"),d(12,"Lote"),s(),l(13,"th"),d(14,"Caducidad"),s(),l(15,"th",60),d(16,"Costo U."),s(),l(17,"th",60),d(18,"Precio U."),s()()(),l(19,"tbody"),N(20,mI,19,18,"tr",61)(21,fI,3,0,"tr",40),s()()()()),i&2){let e=t.$implicit,n=_();Ye("colspan",n.displayedColumns.length),c(20),p("ngForOf",e.productos)("ngForTrackBy",n.trackByProd),c(),p("ngIf",!e.productos||e.productos.length===0)}}function hI(i,t){i&1&&y(0,"tr",63)}function gI(i,t){i&1&&y(0,"tr",64)}function _I(i,t){i&1&&y(0,"tr",64)}function vI(i,t){if(i&1&&y(0,"tr",65),i&2){let e=_();Ri("display",e.rows.length?"":"none")}}function xI(i,t){if(i&1&&(l(0,"tr")(1,"td",66),d(2," Sin resultados en el rango/criterios seleccionados. "),s()()),i&2){let e=_();c(),Ye("colspan",e.displayedColumns.length)}}function bI(){let i=new E0;return i.itemsPerPageLabel="Compras por p\xE1gina:",i.nextPageLabel="Siguiente",i.previousPageLabel="Anterior",i.firstPageLabel="Inicio",i.lastPageLabel="Fin",i.getRangeLabel=(t,e,n)=>{if(n===0||e===0)return`0 de ${n}`;let r=t*e+1,a=Math.min(r+e-1,n);return`${r} \u2013 ${a} de ${n}`},i}var _c=class i{constructor(t,e,n){this.comprasSrv=t;this.cdr=e;this.library=n;n.addIcons(vi)}proveedor="";importeDesde=null;importeHasta=null;fechaIni="";fechaFin="";productoNombre="";codigoBarras="";rows=[];displayedColumns=["acciones","fecha","proveedor","total"];table;isDetailRow=(t,e)=>this.expandedId===e.compraId;page=1;limit=15;paginacion={total:0,page:1,limit:15};cargando=!1;expandedId=null;paginator;faTimes=vi;footer=null;ngOnInit(){this.setFechasPorDefecto(),this.buscar(!0)}toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(t)}getFechaFinExclusiveISO(){let t=new Date(this.fechaFin);return t.setDate(t.getDate()+1),this.toLocalISODate(t)}limpiarFiltros(){this.proveedor="",this.importeDesde=null,this.importeHasta=null,this.setFechasPorDefecto(),this.productoNombre="",this.codigoBarras="",this.page=1,this.buscar(!0)}limpiarCodigo(){this.codigoBarras="",this.buscar(!0)}limpiarIni(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e)}limpiarFin(){let t=new Date;this.fechaFin=this.toLocalISODate(t)}limpiarDesde(){this.importeDesde=null,this.buscar(!0)}limpiarHasta(){this.importeHasta=null,this.buscar(!0)}limpiarProveedor(){this.proveedor="",this.buscar(!0)}limpiarProducto(){this.productoNombre="",this.buscar(!0)}buscar(t=!1){t&&(this.page=1);let e={page:this.page,limit:this.limit};this.fechaIni&&(e.fechaIni=this.fechaIni),this.fechaFin&&(e.fechaFin=this.fechaFin),this.proveedor&&(e.proveedor=this.proveedor.trim()),this.importeDesde!==null&&this.importeDesde!==void 0&&this.importeDesde!==""&&(e.importeDesde=this.importeDesde),this.importeHasta!==null&&this.importeHasta!==void 0&&this.importeHasta!==""&&(e.importeHasta=this.importeHasta),this.productoNombre?.trim()&&(e.productoNombre=this.productoNombre.trim()),this.codigoBarras?.trim()&&(e.codigoBarras=this.codigoBarras.trim()),this.cargando=!0,this.expandedId=null,this.comprasSrv.listar(e).subscribe({next:n=>{let r=n?.rows??[],a=n?.paginacion?.total??r.length,o=n?.paginacion?.page??this.page,u=n?.paginacion?.limit??this.limit;this.rows=r,this.paginacion={total:a,page:o,limit:u},this.limit=u,this.page=o,this.footer=n?.footer??null,this.cargando=!1,this.cdr.detectChanges(),this.table?.renderRows()},error:n=>{this.rows=[],this.paginacion={total:0,page:1,limit:this.limit},this.cargando=!1}})}cambioPagina(t){let e=t.pageSize!==this.limit;this.limit=t.pageSize,this.page=e?1:t.pageIndex+1,this.expandedId=null,this.buscar(!1)}toggleDetalle(t){this.expandedId=this.expandedId===t.compraId?null:t.compraId,this.table?.renderRows()}trackByCompra=(t,e)=>e.compraId;trackByProd=(t,e)=>`${e.codigoBarras}-${e.lote}-${e.fechaCaducidad}`;static \u0275fac=function(e){return new(e||i)(ie(uo),ie(Dt),ie(yi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-compras"]],viewQuery:function(e,n){if(e&1&&(Tt(al,5),Tt($k,5)),e&2){let r;bt(r=yt())&&(n.table=r.first),bt(r=yt())&&(n.paginator=r.first)}},features:[Jr([{provide:E0,useFactory:bI}])],decls:83,vars:33,consts:[[1,"filtros"],[1,"titulo","text-center"],[1,"row","mb-3"],[1,"col-3"],[2,"white-space","nowrap"],[1,"position-relative"],["type","text","placeholder","Nombre del proveedor",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar proveedor",3,"click",4,"ngIf"],["type","text","placeholder","Nombre del producto",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar producto",3,"click",4,"ngIf"],[1,"col-2"],["type","text","placeholder","C\xF3digo de barras",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar c\xF3d. barras",3,"click",4,"ngIf"],["type","number",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe desde",3,"click",4,"ngIf"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe hasta",3,"click",4,"ngIf"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha inicial",3,"click",4,"ngIf"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha final",3,"click",4,"ngIf"],[1,"col-4",2,"text-align","start","margin-top","1rem"],[1,"btn-rojo",3,"click","disabled"],[1,"col-4",2,"text-align","end","height","min-content","margin-top","1rem"],[1,"btn-gris",3,"click","disabled"],["mat-table","","multiTemplateDataRows","",1,"tabla",3,"dataSource"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","fecha"],["matColumnDef","proveedor"],["mat-footer-cell","","class","text-end",4,"matFooterCellDef"],["matColumnDef","total"],["mat-header-cell","","class","text-end",4,"matHeaderCellDef"],["mat-cell","","class","text-end fw-600",4,"matCellDef"],["mat-footer-cell","","class","text-end fw-700",4,"matFooterCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefTrackBy"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-footer-row","",3,"display",4,"matFooterRowDef"],[4,"ngIf"],[1,"paginator-custom",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],["type","button","matTooltip","Limpiar proveedor",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],["type","button","matTooltip","Limpiar producto",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar importe desde",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar importe hasta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar fecha inicial",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["type","button","matTooltip","Limpiar fecha final",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click","matTooltip"],["mat-footer-cell",""],["mat-footer-cell","",1,"text-end"],["mat-header-cell","",1,"text-end"],["mat-cell","",1,"text-end","fw-600"],["mat-footer-cell","",1,"text-end","fw-700"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"text-end"],[4,"ngFor","ngForOf","ngForTrackBy"],["colspan","7",1,"text-center","text-muted"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],[1,"text-center","text-muted","p-2"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h2",1),d(2,"Reporte General de Compras"),s(),l(3,"div",2)(4,"div",3)(5,"label",4),d(6,"Proveedor"),s(),l(7,"div",5)(8,"input",6),ee("ngModelChange",function(a){return Z(n.proveedor,a)||(n.proveedor=a),a}),w("keyup.enter",function(){return n.buscar(!0)}),s(),N(9,qk,2,1,"button",7),s()(),l(10,"div",3)(11,"label",4),d(12,"Producto"),s(),l(13,"div",5)(14,"input",8),ee("ngModelChange",function(a){return Z(n.productoNombre,a)||(n.productoNombre=a),a}),w("keyup.enter",function(){return n.buscar(!0)}),s(),N(15,Xk,2,1,"button",9),s()(),l(16,"div",10)(17,"label",4),d(18,"C\xF3digo de barras"),s(),l(19,"div",5)(20,"input",11),ee("ngModelChange",function(a){return Z(n.codigoBarras,a)||(n.codigoBarras=a),a}),w("keyup.enter",function(){return n.buscar(!0)}),s(),N(21,Kk,2,1,"button",12),s()(),l(22,"div",10)(23,"label",4),d(24,"Importe desde"),s(),l(25,"div",5)(26,"input",13),ee("ngModelChange",function(a){return Z(n.importeDesde,a)||(n.importeDesde=a),a}),w("keyup.enter",function(){return n.buscar(!0)}),s(),N(27,Yk,2,1,"button",14),s()(),l(28,"div",10)(29,"label",4),d(30,"Importe hasta"),s(),l(31,"div",5)(32,"input",13),ee("ngModelChange",function(a){return Z(n.importeHasta,a)||(n.importeHasta=a),a}),w("keyup.enter",function(){return n.buscar(!0)}),s(),N(33,Qk,2,1,"button",15),s()()(),l(34,"div",2)(35,"div",10)(36,"label",4),d(37,"Fecha inicial"),s(),l(38,"div",5)(39,"input",16),ee("ngModelChange",function(a){return Z(n.fechaIni,a)||(n.fechaIni=a),a}),w("change",function(){return n.buscar(!0)}),s(),N(40,Jk,2,1,"button",17),s()(),l(41,"div",10)(42,"label",4),d(43,"Fecha final"),s(),l(44,"div",5)(45,"input",16),ee("ngModelChange",function(a){return Z(n.fechaFin,a)||(n.fechaFin=a),a}),w("change",function(){return n.buscar(!0)}),s(),N(46,Zk,2,1,"button",18),s()(),l(47,"div",19)(48,"button",20),w("click",function(){return n.limpiarFiltros()}),l(49,"mat-icon"),d(50,"clear"),s(),d(51,"\xA0Limpiar "),s()(),l(52,"div",21)(53,"button",22),w("click",function(){return n.buscar(!0)}),l(54,"mat-icon"),d(55,"search"),s(),d(56,"\xA0Buscar "),s()()()(),l(57,"div")(58,"table",23),Ze(59,24),N(60,eI,2,0,"th",25)(61,tI,4,2,"td",26)(62,iI,1,0,"td",27),et(),Ze(63,28),N(64,nI,2,0,"th",25)(65,rI,3,4,"td",26)(66,aI,1,0,"td",27),et(),Ze(67,29),N(68,oI,2,0,"th",25)(69,sI,2,1,"td",26)(70,lI,3,0,"td",30),et(),Ze(71,31),N(72,cI,2,0,"th",32)(73,dI,3,4,"td",33)(74,uI,3,6,"td",34),et(),Ze(75,35),N(76,pI,22,4,"td",26),et(),N(77,hI,1,0,"tr",36)(78,gI,1,0,"tr",37)(79,_I,1,0,"tr",38)(80,vI,1,2,"tr",39)(81,xI,3,1,"tr",40),s()(),l(82,"mat-paginator",41),w("page",function(a){return n.cambioPagina(a)}),s()),e&2&&(c(8),J("ngModel",n.proveedor),c(),p("ngIf",n.proveedor),c(5),J("ngModel",n.productoNombre),c(),p("ngIf",n.productoNombre),c(5),J("ngModel",n.codigoBarras),c(),p("ngIf",n.codigoBarras),c(5),J("ngModel",n.importeDesde),c(),p("ngIf",n.importeDesde),c(5),J("ngModel",n.importeHasta),c(),p("ngIf",n.importeHasta),c(6),J("ngModel",n.fechaIni),c(),p("ngIf",n.fechaIni),c(5),J("ngModel",n.fechaFin),c(),p("ngIf",n.fechaFin),c(2),p("disabled",n.cargando),c(5),p("disabled",n.cargando),c(4),Be("loading",n.cargando),c(),p("dataSource",n.rows),c(19),p("matHeaderRowDef",n.displayedColumns),c(),p("matRowDefColumns",n.displayedColumns)("matRowDefTrackBy",n.trackByCompra),c(),p("matRowDefColumns",Jt(31,zk))("matRowDefWhen",n.isDetailRow),c(),p("matFooterRowDef",n.displayedColumns),c(),p("ngIf",!n.cargando&&n.rows.length===0),c(),p("length",n.paginacion.total||0)("pageSize",n.limit)("pageIndex",n.page-1)("pageSizeOptions",Jt(32,Gk))("showFirstLastButtons",!0))},dependencies:[Oe,We,Ne,wt,Bt,Nt,ot,qe,qt,ze,_t,ip,al,$f,Yf,Gf,Hf,Jf,zf,Qf,qf,Kf,Xf,Zf,tp,ep,op,ap,ti,ei,rp,np,Qn,Mr,Vt,dt],styles:["[_nghost-%COMP%]     .mat-mdc-paginator{background:#f5fbff;box-shadow:0 2px 6px #0000000f}[_nghost-%COMP%]     .mat-mdc-icon-button{width:3.25rem;height:3.25rem;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .15s ease,transform .05s}[_nghost-%COMP%]     .mat-mdc-icon-button:hover{background:#8a2be2}[_nghost-%COMP%]     .mat-mdc-paginator-icon{fill:#0ff;width:3.25rem;height:3.25rem}[_nghost-%COMP%]     .mat-mdc-paginator-range-actions .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:#cbd5e1}[_nghost-%COMP%]     .mat-mdc-paginator-page-size .mat-mdc-select-value-text{font-size:1.3rem;color:#8a2be2;line-height:1.1}.paginator-custom[_ngcontent-%COMP%]{background-color:#fbdddd}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-page-size-label{font-size:1.3rem;color:#8a2be2;letter-spacing:.2px;margin-right:.5rem;line-height:1.1}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-range-label{font-size:1.3rem;color:#8a2be2}[_nghost-%COMP%]     .paginator-custom .mat-mdc-select-trigger, [_nghost-%COMP%]     .paginator-custom .mat-mdc-select-value-text{font-size:1.05rem;color:#8a2be2}"]})};var jg=()=>{let i=je(ct),t=new Qe({"x-auth-token":localStorage.getItem("auth_token")||""}),e=He.apiUrl,n=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];return Cm({farmacias:i.get(`${e}/farmacias`,{headers:t}).pipe(xt(r=>r?.data||r||[])),usuarios:i.get(`${e}/usuarios`,{headers:t}).pipe(xt(r=>r?.data||r||[])),motivos:gt(n)})};var vc=class i{constructor(t){this.http=t}base=`${He.apiUrl}/reportes`;headers(){return new Qe({"x-auth-token":localStorage.getItem("auth_token")||""})}buildParams(t){let e=new Ht;return Object.entries(t).forEach(([n,r])=>{if(r==null)return;let a=String(r).trim();a!==""&&(e=e.set(n,a))}),e}getHistorial(t){return this.http.get(`${this.base}/compras-historial-producto`,{headers:this.headers(),params:this.buildParams(t)})}searchProductos(t){let e=`${He.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(xt(n=>n?.data??n?.rows??n??[]),Pi(()=>gt([])))}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var CI=()=>({standalone:!0});function SI(i,t){if(i&1){let e=ae();l(0,"button",39),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.selectProd(r))}),l(1,"div",40),d(2),s(),l(3,"small",41),d(4),s()()}if(i&2){let e=t.$implicit;c(2),T(e.nombre||"(sin nombre)"),c(2),R("CB: ",e.codigoBarras||"\u2014","")}}function wI(i,t){if(i&1&&(l(0,"div",37),N(1,SI,5,2,"button",38),s()),i&2){let e=_();c(),p("ngForOf",e.prodOpts)}}function EI(i,t){if(i&1&&(l(0,"span"),d(1),s()),i&2){let e=_(2);c(),R("\xB7 ",e.prodSel.codigoBarras,"")}}function TI(i,t){if(i&1){let e=ae();l(0,"div",42)(1,"span",43),d(2),N(3,EI,2,1,"span",35),s(),l(4,"button",44),w("click",function(){P(e);let r=_(),a=Gt(17);return k(r.clearProd(a))}),d(5,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.prodSel.nombre," "),c(),p("ngIf",e.prodSel.codigoBarras)}}function PI(i,t){if(i&1&&(l(0,"option",45),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function kI(i,t){if(i&1&&(l(0,"option",45),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function II(i,t){i&1&&(l(0,"span"),d(1,"\u25B2"),s())}function MI(i,t){i&1&&(l(0,"span"),d(1,"\u25BC"),s())}function FI(i,t){if(i&1&&(Ze(0),N(1,II,2,0,"span",35)(2,MI,2,0,"span",35),et()),i&2){let e=_(3);c(),p("ngIf",e.dir==="asc"),c(),p("ngIf",e.dir==="desc")}}function AI(i,t){i&1&&(Ze(0),l(1,"span",41),d(2,"\u21C5"),s(),et())}function OI(i,t){if(i&1&&(l(0,"span",49),N(1,FI,3,2,"ng-container",35)(2,AI,3,0,"ng-container",35),s()),i&2){let e=_().$implicit,n=_();c(),p("ngIf",n.orden===e.key),c(),p("ngIf",n.orden!==e.key)}}function DI(i,t){if(i&1){let e=ae();l(0,"th",46),w("click",function(){let r=P(e).$implicit,a=_();return k(a.onHeaderClick(r))}),l(1,"div",47)(2,"span"),d(3),s(),N(4,OI,3,2,"span",48),s()()}if(i&2){let e=t.$implicit,n=_();Be("sortable",e.label!=="CB"),Ye("aria-sort",n.orden===e.key?n.dir==="asc"?"ascending":"descending":"none"),c(3),T(e.label),c(),p("ngIf",e.label!=="CB")}}function RI(i,t){if(i&1&&(l(0,"td"),d(1),s()),i&2){let e=t.$implicit,n=_().$implicit,r=_();Be("text-end",e.right),c(),R(" ",r.formatCell(e,n)," ")}}function NI(i,t){if(i&1&&(l(0,"tr"),N(1,RI,2,3,"td",50),s()),i&2){let e=_();c(),p("ngForOf",e.headers)}}function BI(i,t){if(i&1&&(l(0,"tr")(1,"td",51),d(2,"Sin datos"),s()()),i&2){let e=_();c(),Ye("colspan",e.headers.length)}}function LI(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",40)(2,"td",52),d(3),F(4,"number"),s(),l(5,"td",53),d(6),F(7,"currency"),s(),l(8,"td",53),d(9),F(10,"number"),s(),l(11,"td",53),d(12),F(13,"currency"),s(),l(14,"td",53),d(15),F(16,"currency"),s()()()),i&2){let e,n,r,a,o,u=t.ngIf;c(3),R("Num. de Compras: ",Q(4,5,(e=u.compras)!==null&&e!==void 0?e:0,"1.0-0")," "),c(3),R(" Prom. ",se(7,8,(n=u.costoUnitProm)!==null&&n!==void 0?n:0)," "),c(3),R(" ",Q(10,10,(r=u.piezas)!==null&&r!==void 0?r:0,"1.0-0")," "),c(3),R(" ",se(13,13,(a=u.costoTotal)!==null&&a!==void 0?a:0)," "),c(3),R(" Prom. ",se(16,15,(o=u.precioUnitProm)!==null&&o!==void 0?o:0)," ")}}function VI(i,t){if(i&1){let e=ae();l(0,"nav",54)(1,"ul",55)(2,"li")(3,"button",56),w("click",function(){P(e);let r=_();return k(r.goFirst())}),y(4,"i",57),s()(),l(5,"li")(6,"button",58),w("click",function(){P(e);let r=_();return k(r.goPrev())}),y(7,"i",59),s()(),l(8,"li",60)(9,"span"),d(10),s()(),l(11,"li")(12,"button",61),w("click",function(){P(e);let r=_();return k(r.goNext())}),y(13,"i",62),s()(),l(14,"li")(15,"button",63),w("click",function(){P(e);let r=_();return k(r.goLast())}),y(16,"i",64),s()()()()}if(i&2){let e=_();c(2),Be("disabled",!e.canPrev()),c(),p("disabled",!e.canPrev()),c(2),Be("disabled",!e.canPrev()),c(),p("disabled",!e.canPrev()),c(4),un(" P\xE1gina: ",e.page," de ",e.totalPages,""),c(),Be("disabled",!e.canNext()),c(),p("disabled",!e.canNext()),c(2),Be("disabled",!e.canNext()),c(),p("disabled",!e.canNext())}}var xc=class i{constructor(t,e,n,r){this.fb=t;this.svc=e;this.proveedorService=n;this.usuarioService=r}filtroForm;cargando=!1;resp=null;rows=[];columns=[];footer=null;prodSel=null;prodOpts=[];prodInput$=new St;subs=[];orden="fecha";dir="desc";page=1;limit=20;proveedores=[];usuarios=[];headers=[{label:"Fecha",key:"fecha",date:!0},{label:"Proveedor",key:"proveedor"},{label:"Producto",key:"producto"},{label:"CB",key:"precioUnitario"},{label:"Lote",key:"lote"},{label:"Caducidad",key:"fechaCaducidad",date:!0},{label:"Costo Unit.",key:"costoUnitario",right:!0,money:!0},{label:"Cantidad",key:"cantidad",right:!0},{label:"Costo Total",key:"costoTotal",right:!0,money:!0},{label:"Precio Unit.",key:"precioUnitario",right:!0,money:!0}];toYmdLocal(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}money=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",maximumFractionDigits:2});num=new Intl.NumberFormat("es-MX",{maximumFractionDigits:2});ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.filtroForm=this.fb.group({fechaIni:[this.toYmdLocal(e)],fechaFin:[this.toYmdLocal(t)],productoId:[""],q:[""],cb:[""],proveedorId:[""],usuarioId:[""],lote:[""],cadIni:[""],cadFin:[""]}),this.subs.push(this.prodInput$.pipe(xt(n=>(n||"").trim()),cn(180),dn(),Ui(n=>n.length<2?gt([]):this.svc.searchProductos(n))).subscribe(n=>this.prodOpts=Array.isArray(n)?n:[])),this.cargarProveedores(),this.cargarUsuarios(),this.buscar()}ngOnDestroy(){this.subs.forEach(t=>t.unsubscribe())}cargarProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||"(sin nombre)"})).sort((e,n)=>e.nombre.localeCompare(n.nombre,"es",{sensitivity:"base"}))})}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe(t=>{this.usuarios=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||e.usuario||"(sin nombre)"})).sort((e,n)=>(e.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"}))})}formatCell(t,e){let n=t.label==="CB"?e.codigoBarras??"":e[t.key];if(n==null)return"\u2014";if(t.date)try{return new Date(n).toLocaleDateString("es-MX")}catch{return"\u2014"}return t.money?this.money.format(+n||0):typeof n=="number"?this.num.format(n):String(n)}onHeaderClick(t){t.label!=="CB"&&(this.orden===t.key?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t.key,this.dir="desc"),this.buscar(!0))}exportCsv(){let t=this.headers.map(h=>h.label),e=(this.rows||[]).map(h=>this.headers.map(g=>this.formatCell(g,h))),n=[t,...e].map(h=>h.map(f).join(",")).join(`\r
`),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(r);a.href=o;let u=this.filtroForm.value.fechaIni??"",m=this.filtroForm.value.fechaFin??"";a.download=`historial_producto_${u}_${m}.csv`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o);function f(h){let g=(h??"").toString();return/[",\r\n]/.test(g)?`"${g.replace(/"/g,'""')}"`:g}}onProdInput(t){this.prodInput$.next((t||"").trim())}selectProd(t){this.prodSel=t,this.prodOpts=[],this.filtroForm.patchValue({productoId:t?._id||"",q:"",cb:t?.codigoBarras||""})}clearProd(t){this.prodSel=null,this.filtroForm.patchValue({productoId:"",q:"",cb:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}buscar(t=!0){if(this.cargando)return;t&&(this.page=1),this.cargando=!0;let e=this.filtroForm.getRawValue(),n=Wt(Ke({},e),{orden:this.orden,dir:this.dir,page:this.page,limit:this.limit});this.svc.getHistorial(n).subscribe({next:r=>{this.resp=r,this.rows=r?.rows||[],this.columns=r?.columns||[],this.page=r?.page??this.page,this.limit=r?.limit??this.limit,console.log("Respuesta: ",this.resp),this.cargando=!1},error:()=>{this.cargando=!1}})}sortBy(t){this.orden===t?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t,this.dir="desc"),this.buscar(!1)}get totalPages(){let t=this.resp?.pages??0;return t>0?t:0}get totalRows(){return this.resp?.total??this.rows?.length??0}canPrev(){return this.page>1}canNext(){return this.page<this.totalPages}changePage(t){this.cargando||t<1||t>this.totalPages||t===this.page||(this.page=t,this.buscar(!1))}goFirst(){this.canPrev()&&this.changePage(1)}goPrev(){this.canPrev()&&this.changePage(this.page-1)}goNext(){this.canNext()&&this.changePage(this.page+1)}goLast(){this.canNext()&&this.changePage(this.totalPages)}limpiar(t){let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1);this.filtroForm.patchValue({fechaIni:this.toYmdLocal(n),fechaFin:this.toYmdLocal(e),productoId:"",q:"",cb:"",proveedorId:"",usuarioId:"",lote:"",cadIni:"",cadFin:""}),this.columns=[],this.rows=[],this.resp=null,this.footer=null,this.prodSel=null,this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0}))),this.page=1,this.orden="fecha",this.dir="desc",this.buscar()}isMoney(t){return["costoUnitario","costoTotal","precioUnitario"].includes(t)}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(vc),ie(rl),ie(Va))};static \u0275cmp=Te({type:i,selectors:[["app-historial-producto-page"]],decls:78,vars:27,consts:[["prodInput",""],[1,"container-fluid"],[1,"titulo","text-center"],[3,"formGroup"],[1,"row","g-2","align-items-end","filtros"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo de barras",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1 d-flex align-items-center gap-2 flex-wrap",4,"ngIf"],["type","hidden","formControlName","productoId"],[1,"col-md-3"],["formControlName","proveedorId",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuarioId",1,"form-select",3,"disabled"],[1,"row","mt-3"],["formControlName","lote","placeholder","Contiene...",1,"form-control",3,"disabled"],["type","date","formControlName","cadIni",1,"form-control",3,"disabled"],["type","date","formControlName","cadFin",1,"form-control",3,"disabled"],[1,"form-select",3,"ngModelChange","change","ngModel","ngModelOptions","disabled"],[3,"ngValue"],[1,"col-auto","ms-auto",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],["type","button",1,"btn-gris",2,"margin-left","8rem",3,"click"],[1,"d-flex","justify-content-end","mb-2","mt-2"],[1,"btn-amarillo",3,"click","disabled"],[1,"table-responsive"],[1,"tabla","w-100"],[3,"sortable","click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-2 paginacion",4,"ngIf"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1","d-flex","align-items-center","gap-2","flex-wrap"],[1,"badge","bg-success-subtle","text-success","border","mb-0"],["type","button",1,"btn","btn-link","btn-sm","p-0",3,"click"],[3,"value"],[3,"click"],[1,"d-flex","align-items-center","gap-1"],["class","sort-icon",4,"ngIf"],[1,"sort-icon"],[3,"text-end",4,"ngFor","ngForOf"],[1,"text-center","text-muted"],["colspan","6",1,"text-end"],[1,"text-end"],[1,"mt-2","paginacion"],[1,"pagination","pagination-sm","mb-0","justify-content-center"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[2,"margin-top","0.5rem","margin-left","10px","margin-right","10px"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){if(e&1){let r=ae();l(0,"div",1)(1,"h4",2),d(2,"Historial de compras por producto"),s(),l(3,"form",3)(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Fecha inicio"),s(),y(8,"input",7),s(),l(9,"div",5)(10,"label",6),d(11,"Fecha fin"),s(),y(12,"input",8),s(),l(13,"div",9)(14,"label",6),d(15,"Producto"),s(),l(16,"input",10,0),w("input",function(o){return P(r),k(n.onProdInput(o.target.value))}),s(),N(18,wI,2,1,"div",11)(19,TI,6,2,"div",12),y(20,"input",13),s(),l(21,"div",14)(22,"label",6),d(23,"Proveedor"),s(),l(24,"select",15)(25,"option",16),d(26,"(Todos)"),s(),N(27,PI,2,2,"option",17),s()(),l(28,"div",5)(29,"label",6),d(30,"Usuario"),s(),l(31,"select",18)(32,"option",16),d(33,"(Todos)"),s(),N(34,kI,2,2,"option",17),s()(),l(35,"div",19)(36,"div",5)(37,"label",6),d(38,"Lote"),s(),y(39,"input",20),s(),l(40,"div",5)(41,"label",6),d(42,"Caducidad desde"),s(),y(43,"input",21),s(),l(44,"div",5)(45,"label",6),d(46,"Caducidad hasta"),s(),y(47,"input",22),s(),l(48,"div",5)(49,"label",6),d(50,"Renglones x P\xE1gina"),s(),l(51,"select",23),ee("ngModelChange",function(o){return P(r),Z(n.limit,o)||(n.limit=o),k(o)}),w("change",function(){return P(r),k(n.buscar())}),l(52,"option",24),d(53,"25"),s(),l(54,"option",24),d(55,"50"),s(),l(56,"option",24),d(57,"100"),s(),l(58,"option",24),d(59,"200"),s()()(),l(60,"div",25)(61,"button",26),w("click",function(){P(r);let o=Gt(17);return k(n.limpiar(o))}),y(62,"i",27),s(),l(63,"button",28),w("click",function(){return P(r),k(n.buscar())}),d(64,"Buscar"),s()()()()(),l(65,"div",29)(66,"button",30),w("click",function(){return P(r),k(n.exportCsv())}),d(67,"Exportar CSV"),s()(),l(68,"div",31)(69,"table",32)(70,"thead")(71,"tr"),N(72,DI,5,5,"th",33),s()(),l(73,"tbody"),N(74,NI,2,1,"tr",34)(75,BI,3,1,"tr",35),s(),N(76,LI,17,17,"tfoot",35),s()(),N(77,VI,17,14,"nav",36),s()}e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando||!!n.prodSel),c(2),p("ngIf",n.prodOpts.length&&!n.prodSel),c(),p("ngIf",n.prodSel),c(5),p("disabled",n.cargando),c(3),p("ngForOf",n.proveedores),c(4),p("disabled",n.cargando),c(3),p("ngForOf",n.usuarios),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),J("ngModel",n.limit),p("ngModelOptions",Jt(26,CI))("disabled",n.cargando),c(),p("ngValue",25),c(2),p("ngValue",50),c(2),p("ngValue",100),c(2),p("ngValue",200),c(8),p("disabled",!n.rows.length),c(6),p("ngForOf",n.headers),c(2),p("ngForOf",n.rows),c(),p("ngIf",!n.rows.length),c(),p("ngIf",n.resp==null?null:n.resp.footer),c(),p("ngIf",n.totalPages>1))},dependencies:[Oe,We,Ne,wt,Bt,Lt,At,rt,at,qe,nt,ze,Ft,ci,di,ot,_t,Vt,dt],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;top:calc(100% + 4px);left:0;right:0;max-height:240px;overflow:auto;background:#fff;border:1px solid #dee2e6;border-radius:.375rem;box-shadow:0 6px 24px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;border:0;background:#fff;border-bottom:1px dashed #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap}th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}th[_ngcontent-%COMP%]   .sort-icon[_ngcontent-%COMP%]{font-size:.8rem;line-height:1}.text-end[_ngcontent-%COMP%]{text-align:end}.info-paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}"]})};var bc=class i{constructor(t){this.http=t}api=He.apiUrl;headers(){return new Qe({"Content-Type":"application/json"})}getReporte(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{r!=null&&r!==""&&(e=e.set(n,String(r)))}),this.http.get(`${this.api}/reportes/compras-con-ventas`,{headers:this.headers(),params:e}).pipe(Pi(()=>gt({nota:"",filtros:void 0,paginacion:{page:1,limit:20,total:0},rows:[],resumen:{sumCantidad:0,sumExistencia:0,avgVendidosFarmacia:0}})))}searchProductos(t){let e=`${He.apiUrl}/productos/buscar`,n=new Ht().set("q",t).set("limit","50");return this.http.get(e,{headers:this.headers(),params:n}).pipe(xt(r=>{if(Array.isArray(r))return r;let a=["rows","data","productos","products","items","docs","result","results","list"];for(let o of a)if(Array.isArray(r?.[o]))return r[o];return[]}),xt(r=>r.map(a=>({_id:String(a?._id??""),nombre:String(a?.nombre??""),codigoBarras:a?.codigoBarras?String(a.codigoBarras):void 0}))),xt(r=>[...r].sort((a,o)=>a.nombre.localeCompare(o.nombre,"es",{sensitivity:"base"}))),Pi(()=>gt([])))}getProveedores(){let t=`${He.apiUrl}/proveedores`;return this.http.get(t,{headers:this.headers()}).pipe(xt(e=>Array.isArray(e)?e:e?.rows??e?.data??[]),xt(e=>e.map(n=>({_id:String(n?._id??""),nombre:String(n?.nombre??"")}))),xt(e=>[...e].sort((n,r)=>n.nombre.localeCompare(r.nombre,"es",{sensitivity:"base"}))),Pi(()=>gt([])))}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var yr=(i,t,e)=>({"bi-caret-up-fill":i,"bi-caret-down-fill":t,"bi-caret-up":e});function jI(i,t){if(i&1){let e=ae();l(0,"button",49),w("click",function(){let r=P(e).$implicit,a=_(2);return k(a.selectProducto(r))}),l(1,"div",50),d(2),s(),l(3,"small",51),d(4),s()()}if(i&2){let e=t.$implicit;c(2),T(e.nombre||"(sin nombre)"),c(2),T(e.codigoBarras||"\u2014")}}function WI(i,t){if(i&1&&(l(0,"div",47),N(1,jI,5,2,"button",48),s()),i&2){let e=_();c(),p("ngForOf",e.prodOpts)}}function HI(i,t){if(i&1&&(l(0,"span"),d(1),s()),i&2){let e=_(2);c(),R(" \xB7 ",e.productoSel.codigoBarras,"")}}function $I(i,t){if(i&1){let e=ae();l(0,"div",52)(1,"span",53),d(2),N(3,HI,2,1,"span",33),s(),l(4,"button",54),w("click",function(){P(e);let r=_();return k(r.clearProducto())}),d(5,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.productoSel.nombre," "),c(),p("ngIf",e.productoSel.codigoBarras)}}function zI(i,t){if(i&1&&(l(0,"option",55),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function GI(i,t){if(i&1&&(l(0,"div",56)(1,"small"),d(2),s()()),i&2){let e=_();c(2),T(e.nota)}}function qI(i,t){i&1&&(l(0,"div"),d(1,"\u2014"),s())}function XI(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=t.$implicit;c(),T(e.farmacia||"\u2014")}}function KI(i,t){i&1&&(l(0,"div"),d(1,"\u2014"),s())}function YI(i,t){if(i&1&&(l(0,"div"),d(1),F(2,"number"),s()),i&2){let e=t.$implicit;c(),T(se(2,1,e.vendidos))}}function QI(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),F(3,"date"),s(),l(4,"td"),d(5),s(),l(6,"td"),d(7),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),s(),l(12,"td",31),d(13),F(14,"currency"),s(),l(15,"td",35),d(16),F(17,"number"),s(),l(18,"td"),d(19),F(20,"date"),s(),l(21,"td",31),d(22),F(23,"number"),s(),l(24,"td",57),N(25,qI,2,0,"div",33)(26,XI,2,1,"div",32),s(),l(27,"td",58),N(28,KI,2,0,"div",33)(29,YI,3,3,"div",32),s()()),i&2){let e=t.$implicit;c(2),T(Q(3,13,e.fecCompra,"dd/MM/yyyy")),c(3),T(e.proveedor||"\u2014"),c(2),T(e.producto),c(2),T(e.cb),c(2),T(e.lote),c(2),T(se(14,16,e.costo)),c(3),T(se(17,18,e.cantidad)),c(3),T(e.caducidad?Q(20,20,e.caducidad,"dd/MM/yyyy"):"\u2014"),c(3),T(se(23,23,e.existencia)),c(3),p("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),c(),p("ngForOf",e.ventasPorFarmacia),c(2),p("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),c(),p("ngForOf",e.ventasPorFarmacia)}}function JI(i,t){i&1&&(l(0,"tr")(1,"td",59),d(2,"Sin resultados"),s()())}var yc=class i{constructor(t,e){this.fb=t;this.reportesSvc=e}form;proveedores=[];prodOpts=[];productoSel=null;rows=[];cargando=!1;nota="";total=0;page=1;limit=20;get totalPaginas(){return Math.max(1,Math.ceil((this.total||0)/(this.limit||1)))}get totalPagina(){return this.rows.reduce((t,e)=>t+(e.costoTotal||0),0)}sumCantidad=0;sumExistencia=0;avgVendidosFarmacia=0;ngOnInit(){let t=new Date,e=t.getFullYear(),n=t.getMonth(),r=new Date(e,n,1).toISOString().slice(0,10),a=t.toISOString().slice(0,10);this.form=this.fb.group({fechaIni:[r],fechaFin:[a],productoId:[""],proveedorId:[""],lote:[""],codigoBarras:[""],sortBy:["caducidad"],sortDir:["asc"],limit:[this.limit]}),this.reportesSvc.getProveedores().subscribe(o=>this.proveedores=o),this.buscar(!0)}isSorted(t){return this.form?.value?.sortBy===t}isAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}isSort(t){return this.form?.value?.sortBy===t}dirIsAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}clickSort(t){let e=this.form.value.sortBy,n=this.form.value.sortDir||"asc";e===t?n=n==="asc"?"desc":"asc":n="asc",this.form.patchValue({sortBy:t,sortDir:n}),this.page=1,this.runQuery()}runQuery(){let t=this.form.value,e=Wt(Ke({},t),{page:this.page,limit:this.limit});this.cargando=!0,this.reportesSvc.getReporte(e).subscribe({next:n=>{this.rows=n?.rows??[],this.total=n?.paginacion?.total??0,this.page=n?.paginacion?.page??this.page,this.limit=n?.paginacion?.limit??this.limit,this.nota=n?.nota??"",this.sumCantidad=n?.resumen?.sumCantidad??0,this.sumExistencia=n?.resumen?.sumExistencia??0,this.avgVendidosFarmacia=n?.resumen?.avgVendidosFarmacia??0,this.cargando=!1,console.log("respuesta",n)},error:n=>{this.rows=[],this.total=0,this.nota="",this.sumCantidad=0,this.sumExistencia=0,this.avgVendidosFarmacia=0,this.cargando=!1}})}goToFirstPage(){this.page>1&&(this.page=1,this.runQuery())}goToPrevPage(){this.page>1&&(this.page--,this.runQuery())}goToNextPage(){this.page<this.totalPaginas&&(this.page++,this.runQuery())}goToLastPage(){let t=this.totalPaginas;this.page!==t&&(this.page=t,this.runQuery())}onChangeLimit(){this.page=1,this.runQuery()}onProductoInput(t){let e=(t||"").trim();if(e.length<2){this.prodOpts=[];return}this.reportesSvc.searchProductos(e).subscribe(n=>this.prodOpts=n.slice(0,10))}selectProducto(t){this.productoSel=t,this.prodOpts=[],this.form.patchValue({productoId:t._id})}clearProducto(t){this.productoSel=null,this.form.patchValue({productoId:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}limpiar(){let t=new Date,e=t.getFullYear(),n=t.getMonth(),r=new Date(e,n,1).toISOString().slice(0,10),a=t.toISOString().slice(0,10);this.productoSel=null,this.prodOpts=[],this.form.reset({fechaIni:r,fechaFin:a,productoId:"",proveedorId:"",lote:"",codigoBarras:"",sortBy:"caducidad",sortDir:"asc",limit:this.limit}),this.buscar(!0)}goPage(t){t<1||t>this.totalPaginas||(this.page=t,this.buscar(!1))}buscar(t=!1){t&&(this.page=1),this.runQuery()}static \u0275fac=function(e){return new(e||i)(ie(Zt),ie(bc))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-compras-ventas"]],decls:112,vars:99,consts:[["prodInput",""],[1,"filtros"],[1,"titulo","text-center"],[1,"row","align-items-end",3,"formGroup"],[1,"col-sm-3"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control"],["type","date","formControlName","fechaFin",1,"form-control"],[1,"col-sm-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled","value"],["class","suggest",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-sm-2"],["formControlName","proveedorId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","align-items-end","mt-3","mb-2"],["type","text","formControlName","lote","placeholder","contiene\u2026",1,"form-control"],["type","text","formControlName","codigoBarras","placeholder","contiene\u2026",1,"form-control"],["type","number","formControlName","limit","min","1","max","200",1,"form-control",3,"change"],[1,"col-sm-2","mt-4"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"col-sm-3","mt-4"],["type","button",1,"btn-gris",3,"click","disabled"],["class","nota",4,"ngIf"],[1,"tabla-wrapper"],[1,"tabla"],[1,"th-sort",3,"click"],[1,"bi",3,"ngClass"],[1,"th-sort","text-end",3,"click"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","6",1,"text-end"],[1,"text-end","colortxt-c"],[1,"text-end","colortxt-v"],[1,"d-flex","align-items-center","justify-content-center","my-2","paginacion"],["aria-label","Primera p\xE1gina","matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["aria-label","P\xE1gina anterior","matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"px-2"],["aria-label","P\xE1gina siguiente","matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["aria-label","\xDAltima p\xE1gina","matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"suggest"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[3,"value"],[1,"nota"],[1,"multiline"],[1,"multiline","text-end","colortxt-v"],["colspan","12",1,"text-center","text-muted","p-2"]],template:function(e,n){if(e&1){let r=ae();l(0,"div",1)(1,"h4",2),d(2,"Compras contra Ventas por producto"),s(),l(3,"form",3)(4,"div",4)(5,"label",5),d(6,"Fecha inicial"),s(),y(7,"input",6),s(),l(8,"div",4)(9,"label",5),d(10,"Fecha final"),s(),y(11,"input",7),s(),l(12,"div",8)(13,"label",5),d(14,"Producto"),s(),l(15,"input",9,0),w("input",function(){P(r);let o=Gt(16);return k(n.onProductoInput(o.value))}),s(),N(17,WI,2,1,"div",10)(18,$I,6,2,"div",11),s(),l(19,"div",12)(20,"label",5),d(21,"Proveedor"),s(),l(22,"select",13)(23,"option",14),d(24,"TODOS"),s(),N(25,zI,2,2,"option",15),s()(),l(26,"div",16)(27,"div",12)(28,"label",5),d(29,"Lote"),s(),y(30,"input",17),s(),l(31,"div",12)(32,"label",5),d(33,"CB"),s(),y(34,"input",18),s(),l(35,"div",12)(36,"label",5),d(37,"# por p\xE1gina"),s(),l(38,"input",19),w("change",function(){return P(r),n.limit=n.form.value.limit||20,k(n.onChangeLimit())}),s()(),l(39,"div",20)(40,"button",21),w("click",function(){return P(r),k(n.limpiar())}),y(41,"i",22),s()(),l(42,"div",23)(43,"button",24),w("click",function(){return P(r),k(n.buscar(!0))}),d(44),s()()()(),N(45,GI,3,1,"div",25),s(),l(46,"div",26)(47,"table",27)(48,"thead")(49,"tr")(50,"th",28),w("click",function(){return P(r),k(n.clickSort("fecCompra"))}),d(51," Fec. compra "),y(52,"i",29),s(),l(53,"th",28),w("click",function(){return P(r),k(n.clickSort("proveedor"))}),d(54," Proveedor "),y(55,"i",29),s(),l(56,"th",28),w("click",function(){return P(r),k(n.clickSort("producto"))}),d(57," Producto "),y(58,"i",29),s(),l(59,"th",28),w("click",function(){return P(r),k(n.clickSort("cb"))}),d(60," CB "),y(61,"i",29),s(),l(62,"th",28),w("click",function(){return P(r),k(n.clickSort("lote"))}),d(63," Lote "),y(64,"i",29),s(),l(65,"th",30),w("click",function(){return P(r),k(n.clickSort("costo"))}),d(66," Costo "),y(67,"i",29),s(),l(68,"th",30),w("click",function(){return P(r),k(n.clickSort("cantidad"))}),d(69," Comprados "),y(70,"i",29),s(),l(71,"th",28),w("click",function(){return P(r),k(n.clickSort("caducidad"))}),d(72," Caducidad "),y(73,"i",29),s(),l(74,"th",30),w("click",function(){return P(r),k(n.clickSort("existencia"))}),d(75," Almac\xE9n "),y(76,"i",29),s(),l(77,"th"),d(78,"Farmacia"),s(),l(79,"th",31),d(80,"Vendidos"),s()()(),l(81,"tbody"),N(82,QI,30,25,"tr",32)(83,JI,3,0,"tr",33),s(),l(84,"tfoot")(85,"tr")(86,"th",34),d(87,"\u2211 Comprados:"),s(),l(88,"th",35),d(89),F(90,"number"),s(),l(91,"th",31),d(92,"\u2211 Almac\xE9n:"),s(),l(93,"th",31),d(94),F(95,"number"),s(),l(96,"th",31),d(97,"Prom. Vend.:"),s(),l(98,"th",36),d(99),F(100,"number"),s()()()()(),l(101,"div",37)(102,"button",38),w("click",function(){return P(r),k(n.goToFirstPage())}),y(103,"i",39),s(),l(104,"button",40),w("click",function(){return P(r),k(n.goToPrevPage())}),y(105,"i",41),s(),l(106,"span",42),d(107),s(),l(108,"button",43),w("click",function(){return P(r),k(n.goToNextPage())}),y(109,"i",44),s(),l(110,"button",45),w("click",function(){return P(r),k(n.goToLastPage())}),y(111,"i",46),s()()}e&2&&(c(3),p("formGroup",n.form),c(12),p("disabled",!!n.productoSel)("value",(n.productoSel==null?null:n.productoSel.nombre)||""),c(2),p("ngIf",n.prodOpts.length&&!n.productoSel),c(),p("ngIf",n.productoSel),c(7),p("ngForOf",n.proveedores),c(18),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando\u2026":"Buscar"," "),c(),p("ngIf",n.nota),c(5),Be("sorted",n.isSorted("fecCompra")),Ye("aria-sort",n.isSorted("fecCompra")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(63,yr,n.isSorted("fecCompra")&&n.isAsc(),n.isSorted("fecCompra")&&!n.isAsc(),!n.isSorted("fecCompra"))),c(),Be("sorted",n.isSorted("proveedor")),Ye("aria-sort",n.isSorted("proveedor")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(67,yr,n.isSorted("proveedor")&&n.isAsc(),n.isSorted("proveedor")&&!n.isAsc(),!n.isSorted("proveedor"))),c(),Be("sorted",n.isSorted("producto")),Ye("aria-sort",n.isSorted("producto")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(71,yr,n.isSorted("producto")&&n.isAsc(),n.isSorted("producto")&&!n.isAsc(),!n.isSorted("producto"))),c(),Be("sorted",n.isSorted("cb")),Ye("aria-sort",n.isSorted("cb")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(75,yr,n.isSorted("cb")&&n.isAsc(),n.isSorted("cb")&&!n.isAsc(),!n.isSorted("cb"))),c(),Be("sorted",n.isSorted("lote")),Ye("aria-sort",n.isSorted("lote")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(79,yr,n.isSorted("lote")&&n.isAsc(),n.isSorted("lote")&&!n.isAsc(),!n.isSorted("lote"))),c(),Be("sorted",n.isSorted("costo")),Ye("aria-sort",n.isSorted("costo")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(83,yr,n.isSorted("costo")&&n.isAsc(),n.isSorted("costo")&&!n.isAsc(),!n.isSorted("costo"))),c(),Be("sorted",n.isSorted("cantidad")),Ye("aria-sort",n.isSorted("cantidad")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(87,yr,n.isSorted("cantidad")&&n.isAsc(),n.isSorted("cantidad")&&!n.isAsc(),!n.isSorted("cantidad"))),c(),Be("sorted",n.isSorted("caducidad")),Ye("aria-sort",n.isSorted("caducidad")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(91,yr,n.isSorted("caducidad")&&n.isAsc(),n.isSorted("caducidad")&&!n.isAsc(),!n.isSorted("caducidad"))),c(),Be("sorted",n.isSorted("existencia")),Ye("aria-sort",n.isSorted("existencia")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(95,yr,n.isSorted("existencia")&&n.isAsc(),n.isSorted("existencia")&&!n.isAsc(),!n.isSorted("existencia"))),c(6),p("ngForOf",n.rows),c(),p("ngIf",!n.cargando&&n.rows.length===0),c(6),T(se(90,56,n.sumCantidad)),c(5),T(se(95,58,n.sumExistencia)),c(5),T(Q(100,60,n.avgVendidosFarmacia,"1.0-2")),c(3),p("disabled",n.page<=1),c(2),p("disabled",n.page<=1),c(3),un("P\xE1gina ",n.page," de ",n.totalPaginas,""),c(),p("disabled",n.page>=n.totalPaginas),c(2),p("disabled",n.page>=n.totalPaginas))},dependencies:[Oe,si,We,Ne,wt,Bt,Nt,Lt,At,rt,at,qe,qt,nt,ze,Ft,Bi,Yn,ci,di,Vt,dt],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.nota[_ngcontent-%COMP%]{margin-top:.5rem;color:#000091;text-align:center}.colortxt-c[_ngcontent-%COMP%]{color:#0453b3;font-weight:600}.colortxt-v[_ngcontent-%COMP%]{color:#b30404;font-weight:600}.suggest[_ngcontent-%COMP%]{position:absolute;z-index:10;background:#fff;border:1px solid #ddd;width:100%;max-height:260px;overflow:auto;border-radius:.5rem;box-shadow:0 8px 18px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;background:#fff;border:0;border-bottom:1px solid #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f6f8ff}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eaeaea;padding:.5rem;vertical-align:top}.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f3f8ff;cursor:pointer;white-space:nowrap}.text-end[_ngcontent-%COMP%]{text-align:right}.multiline[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1.35}.pager[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.sorted[_ngcontent-%COMP%]{text-decoration:underline}.sort-caret[_ngcontent-%COMP%]{margin-left:.25rem;font-size:.8em}.th-sort[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap;-webkit-user-select:none;user-select:none}.th-sort[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.35rem;opacity:.6;font-size:.9em}.th-sort.sorted[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}"]})};function i1(i){let t=i.cloneNode(!0),e=t.querySelectorAll("[id]"),n=i.nodeName.toLowerCase();t.removeAttribute("id");for(let r=0;r<e.length;r++)e[r].removeAttribute("id");return n==="canvas"?$g(i,t):(n==="input"||n==="select"||n==="textarea")&&Hg(i,t),Wg("canvas",i,t,$g),Wg("input, textarea, select",i,t,Hg),t}function Wg(i,t,e,n){let r=t.querySelectorAll(i);if(r.length){let a=e.querySelectorAll(i);for(let o=0;o<r.length;o++)n(r[o],a[o])}}var ZI=0;function Hg(i,t){t.type!=="file"&&(t.value=i.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${ZI++}`)}function $g(i,t){let e=t.getContext("2d");if(e)try{e.drawImage(i,0,0)}catch{}}function Sd(i){let t=i.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function vd(i,t,e){let{top:n,bottom:r,left:a,right:o}=i;return e>=n&&e<=r&&t>=a&&t<=o}function ds(i,t,e){i.top+=t,i.bottom=i.top+i.height,i.left+=e,i.right=i.left+i.width}function zg(i,t,e,n){let{top:r,right:a,bottom:o,left:u,width:m,height:f}=i,h=m*t,g=f*t;return n>r-g&&n<o+g&&e>u-h&&e<a+h}var Cc=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Sd(e)})})}handleScroll(t){let e=Zr(t),n=this.positions.get(e);if(!n)return null;let r=n.scrollPosition,a,o;if(e===this._document){let f=this.getViewportScrollPosition();a=f.top,o=f.left}else a=e.scrollTop,o=e.scrollLeft;let u=r.top-a,m=r.left-o;return this.positions.forEach((f,h)=>{f.clientRect&&e!==h&&e.contains(h)&&ds(f.clientRect,u,m)}),r.top=a,r.left=o,{top:u,left:m}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function n1(i,t){let e=i.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let n=t.createElement("div");return e.forEach(r=>n.appendChild(r)),n}function wd(i,t,e){for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];r?i.setProperty(n,r,e?.has(n)?"important":""):i.removeProperty(n)}return i}function po(i,t){let e=t?"":"none";wd(i.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Gg(i,t,e){wd(i.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Sc(i,t){return t&&t!="none"?i+" "+t:i}function qg(i,t){i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.transform=wc(t.left,t.top)}function wc(i,t){return`translate3d(${Math.round(i)}px, ${Math.round(t)}px, 0)`}function Xg(i){let t=i.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(i)*t}function eM(i){let t=getComputedStyle(i),e=gd(t,"transition-property"),n=e.find(u=>u==="transform"||u==="all");if(!n)return 0;let r=e.indexOf(n),a=gd(t,"transition-duration"),o=gd(t,"transition-delay");return Xg(a[r])+Xg(o[r])}function gd(i,t){return i.getPropertyValue(t).split(",").map(n=>n.trim())}var tM=new Set(["position"]),xd=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,n,r,a,o,u,m,f,h){this._document=t,this._rootElement=e,this._direction=n,this._initialDomRect=r,this._previewTemplate=a,this._previewClass=o,this._pickupPositionOnPage=u,this._initialTransform=m,this._zIndex=f,this._renderer=h}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),Kg(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return eM(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,n=t?t.template:null,r;if(n&&t){let a=t.matchSize?this._initialDomRect:null,o=t.viewContainer.createEmbeddedView(n,t.context);o.detectChanges(),r=n1(o,this._document),this._previewEmbeddedView=o,t.matchSize?qg(r,a):r.style.transform=wc(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else r=i1(this._rootElement),qg(r,this._initialDomRect),this._initialTransform&&(r.style.transform=this._initialTransform);return wd(r.style,{"pointer-events":"none",margin:Kg(r)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},tM),po(r,!1),r.classList.add("cdk-drag-preview"),r.setAttribute("popover","manual"),r.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(a=>r.classList.add(a)):r.classList.add(e)),r}};function Kg(i){return"showPopover"in i}var iM={passive:!0},Yg={passive:!1},nM={passive:!1,capture:!0},rM=800,Qg=new Set(["position"]),bd=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=g0(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new St;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=qn.EMPTY;_pointerUpSubscription=qn.EMPTY;_scrollSubscription=qn.EMPTY;_resizeSubscription=qn.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>po(e,t)))}_disabled=!1;beforeStarted=new St;started=new St;released=new St;ended=new St;entered=new St;exited=new St;dropped=new St;moved=this._moveEvents;data;constrainPosition;constructor(t,e,n,r,a,o,u){this._config=e,this._document=n,this._ngZone=r,this._viewportRuler=a,this._dragDropRegistry=o,this._renderer=u,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Cc(n),o.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(n=>Ir(n)),this._handles.forEach(n=>po(n,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&e.add(n)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Ir(t);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[kr(this._renderer,e,"mousedown",this._pointerDown,Yg),kr(this._renderer,e,"touchstart",this._pointerDown,iM),kr(this._renderer,e,"dragstart",this._nativeDragStart,Yg)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Ir(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),po(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),po(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let r=Math.abs(e.x-this._pickupPositionOnPage.x),a=Math.abs(e.y-this._pickupPositionOnPage.y);if(r+a>=this._config.dragStartThreshold){let u=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),m=this._dropContainer;if(!u){this._endDragSequence(t);return}(!m||!m.isDragging()&&!m.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let n=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(n),this._dropContainer)this._updateActiveDropContainer(n,e);else{let r=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,a=this._activeTransform;a.x=n.x-r.x+this._passiveTransform.x,a.y=n.y-r.y+this._passiveTransform.y,this._applyRootElementTransform(a.x,a.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:n,event:t,distance:this._getDragDistance(n),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){ls(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),n=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=kr(this._renderer,e,"selectstart",aM,nM)}),n){let r=this._rootElement,a=r.parentNode,o=this._placeholder=this._createPlaceholderElement(),u=this._anchor=this._anchor||this._document.createComment("");a.insertBefore(u,r),this._initialTransform=r.style.transform||"",this._preview=new xd(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(a,e)),Gg(r,!1,Qg),this._document.body.appendChild(a.replaceChild(o,r)),this.started.next({source:this,event:t}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let n=this.isDragging(),r=ls(e),a=!r&&e.button!==0,o=this._rootElement,u=Zr(e),m=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+rM>Date.now(),f=r?Sf(e):Cf(e);if(u&&u.draggable&&e.type==="mousedown"&&e.preventDefault(),n||a||m||f)return;if(this._handles.length){let x=o.style;this._rootElementTapHighlight=x.webkitTapHighlightColor||"",x.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(x=>this._updateOnScroll(x)),this._boundaryElement&&(this._boundaryRect=Sd(this._boundaryElement));let h=this._previewTemplate;this._pickupPositionInElement=h&&h.template&&!h.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let g=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:g.x,y:g.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){Gg(this._rootElement,!0,Qg),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,n=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),a=this._getDragDistance(r),o=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:a,dropPoint:r,event:t}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:o,distance:a,dropPoint:r,event:t}),e.drop(this,n,this._initialIndex,this._initialContainer,o,a,r,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:n,y:r}){let a=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!a&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(a=this._initialContainer),a&&a!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=a,this._dropContainer.enter(this,t,e,a===this._initialContainer&&a.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:a,currentIndex:a.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,r),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let r=u=>{(!u||this._preview&&Zr(u)===this._preview.element&&u.propertyName==="transform")&&(o(),n(),clearTimeout(a))},a=setTimeout(r,e*1.5),o=this._preview.addEventListener("transitionend",r)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,n;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),n=n1(this._placeholderRef,this._document)):n=i1(this._rootElement),n.style.pointerEvents="none",n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(t,e,n){let r=e===this._rootElement?null:e,a=r?r.getBoundingClientRect():t,o=ls(n)?n.targetTouches[0]:n,u=this._getViewportScrollPosition(),m=o.pageX-a.left-u.left,f=o.pageY-a.top-u.top;return{x:a.left-t.left+m,y:a.top-t.top+f}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),n=ls(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,r=n.pageX-e.left,a=n.pageY-e.top;if(this._ownerSVGElement){let o=this._ownerSVGElement.getScreenCTM();if(o){let u=this._ownerSVGElement.createSVGPoint();return u.x=r,u.y=a,u.matrixTransform(o.inverse())}}return{x:r,y:a}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:r}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?r=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:a,y:o}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,u=this._boundaryRect,{width:m,height:f}=this._getPreviewRect(),h=u.top+o,g=u.bottom-(f-o),x=u.left+a,b=u.right-(m-a);n=Jg(n,x,b),r=Jg(r,h,g)}return{x:n,y:r}}_updatePointerDirectionDelta(t){let{x:e,y:n}=t,r=this._pointerDirectionDelta,a=this._pointerPositionAtLastDirectionChange,o=Math.abs(e-a.x),u=Math.abs(n-a.y);return o>this._config.pointerDirectionChangeThreshold&&(r.x=e>a.x?1:-1,a.x=e),u>this._config.pointerDirectionChangeThreshold&&(r.y=n>a.y?1:-1,a.y=n),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,po(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let n=1/this.scale,r=wc(t*n,e*n),a=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=a.transform&&a.transform!="none"?a.transform:""),a.transform=Sc(r,this._initialTransform)}_applyPreviewTransform(t,e){let n=this._previewTemplate?.template?void 0:this._initialTransform,r=wc(t,e);this._preview.setTransform(Sc(r,n))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),r=this._boundaryElement.getBoundingClientRect();if(r.width===0&&r.height===0||n.width===0&&n.height===0)return;let a=r.left-n.left,o=n.right-r.right,u=r.top-n.top,m=n.bottom-r.bottom;r.width>n.width?(a>0&&(t+=a),o>0&&(t-=o)):t=0,r.height>n.height?(u>0&&(e+=u),m>0&&(e-=m)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:ls(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let n=Zr(t);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&ds(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Ys(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let n=this._previewContainer||"global";if(n==="parent")return t;if(n==="global"){let r=this._document;return e||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement||r.msFullscreenElement||r.body}return Ir(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function Jg(i,t,e){return Math.max(t,Math.min(e,i))}function ls(i){return i.type[0]==="t"}function aM(i){i.preventDefault()}function r1(i,t,e){let n=Zg(t,i.length-1),r=Zg(e,i.length-1);if(n===r)return;let a=i[n],o=r<n?-1:1;for(let u=n;u!==r;u+=o)i[u]=i[u+o];i[r]=a}function Zg(i,t){return Math.max(0,Math.min(t,i))}var Ec=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,n,r){let a=this._itemPositions,o=this._getItemIndexFromPointerPosition(t,e,n,r);if(o===-1&&a.length>0)return null;let u=this.orientation==="horizontal",m=a.findIndex(E=>E.drag===t),f=a[o],h=a[m].clientRect,g=f.clientRect,x=m>o?1:-1,b=this._getItemOffsetPx(h,g,x),S=this._getSiblingOffsetPx(m,a,x),v=a.slice();return r1(a,m,o),a.forEach((E,j)=>{if(v[j]===E)return;let U=E.drag===t,H=U?b:S,Y=U?t.getPlaceholderElement():E.drag.getRootElement();E.offset+=H;let z=Math.round(E.offset*(1/E.drag.scale));u?(Y.style.transform=Sc(`translate3d(${z}px, 0, 0)`,E.initialTransform),ds(E.clientRect,0,H)):(Y.style.transform=Sc(`translate3d(0, ${z}px, 0)`,E.initialTransform),ds(E.clientRect,H,0))}),this._previousSwap.overlaps=vd(g,e,n),this._previousSwap.drag=f.drag,this._previousSwap.delta=u?r.x:r.y,{previousIndex:m,currentIndex:o}}enter(t,e,n,r){let a=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,n):r,o=this._activeDraggables,u=o.indexOf(t),m=t.getPlaceholderElement(),f=o[a];if(f===t&&(f=o[a+1]),!f&&(a==null||a===-1||a<o.length-1)&&this._shouldEnterAsFirstChild(e,n)&&(f=o[0]),u>-1&&o.splice(u,1),f&&!this._dragDropRegistry.isDragging(f)){let h=f.getRootElement();h.parentElement.insertBefore(m,h),o.splice(a,0,t)}else this._element.appendChild(m),o.push(t);m.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let n=this._itemPositions.find(r=>r.drag===t)?.initialTransform;e.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(n=>n.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:n})=>{ds(n,t,e)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let n=e.getVisibleElement();return{drag:e,offset:0,initialTransform:n.style.transform||"",clientRect:Sd(n)}}).sort((e,n)=>t?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_getItemOffsetPx(t,e,n){let r=this.orientation==="horizontal",a=r?e.left-t.left:e.top-t.top;return n===-1&&(a+=r?e.width-t.width:e.height-t.height),a}_getSiblingOffsetPx(t,e,n){let r=this.orientation==="horizontal",a=e[t].clientRect,o=e[t+n*-1],u=a[r?"width":"height"]*n;if(o){let m=r?"left":"top",f=r?"right":"bottom";n===-1?u-=o.clientRect[m]-a[f]:u+=a[m]-o.clientRect[f]}return u}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,r=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let o=n[n.length-1].clientRect;return r?t>=o.right:e>=o.bottom}else{let o=n[0].clientRect;return r?t<=o.left:e<=o.top}}_getItemIndexFromPointerPosition(t,e,n,r){let a=this.orientation==="horizontal",o=this._itemPositions.findIndex(({drag:u,clientRect:m})=>{if(u===t)return!1;if(r){let f=a?r.x:r.y;if(u===this._previousSwap.drag&&this._previousSwap.overlaps&&f===this._previousSwap.delta)return!1}return a?e>=Math.floor(m.left)&&e<Math.floor(m.right):n>=Math.floor(m.top)&&n<Math.floor(m.bottom)});return o===-1||!this._sortPredicate(o,t)?-1:o}},yd=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<e.length;n++){let r=e[n];this._relatedNodes.push([r,r.nextSibling])}this.withItems(t)}sort(t,e,n,r){let a=this._getItemIndexFromPointerPosition(t,e,n),o=this._previousSwap;if(a===-1||this._activeItems[a]===t)return null;let u=this._activeItems[a];if(o.drag===u&&o.overlaps&&o.deltaX===r.x&&o.deltaY===r.y)return null;let m=this.getItemIndex(t),f=t.getPlaceholderElement(),h=u.getRootElement();a>m?h.after(f):h.before(f),r1(this._activeItems,m,a);let g=this._getRootNode().elementFromPoint(e,n);return o.deltaX=r.x,o.deltaY=r.y,o.drag=u,o.overlaps=h===g||h.contains(g),{previousIndex:m,currentIndex:a}}enter(t,e,n,r){let a=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,n):r;a===-1&&(a=this._getClosestItemIndexToPointer(t,e,n));let o=this._activeItems[a],u=this._activeItems.indexOf(t);u>-1&&this._activeItems.splice(u,1),o&&!this._dragDropRegistry.isDragging(o)?(this._activeItems.splice(a,0,t),o.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[r,a]=this._relatedNodes[n];r.parentNode===t&&r.nextSibling!==a&&(a===null?t.appendChild(r):a.parentNode===t&&t.insertBefore(r,a))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,n){let r=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(n)),a=r?this._activeItems.findIndex(o=>{let u=o.getRootElement();return r===u||u.contains(r)}):-1;return a===-1||!this._sortPredicate(a,t)?-1:a}_getRootNode(){return this._rootNode||(this._rootNode=Ys(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let r=1/0,a=-1;for(let o=0;o<this._activeItems.length;o++){let u=this._activeItems[o];if(u!==t){let{x:m,y:f}=u.getRootElement().getBoundingClientRect(),h=Math.hypot(e-m,n-f);h<r&&(r=h,a=o)}}return a}},e1=.05,a1=.05,Mn=function(i){return i[i.NONE=0]="NONE",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i}(Mn||{}),Xi=function(i){return i[i.NONE=0]="NONE",i[i.LEFT=1]="LEFT",i[i.RIGHT=2]="RIGHT",i}(Xi||{}),Cd=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new St;entered=new St;exited=new St;dropped=new St;sorted=new St;receivingStarted=new St;receivingStopped=new St;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=qn.EMPTY;_verticalScrollDirection=Mn.NONE;_horizontalScrollDirection=Xi.NONE;_scrollNode;_stopScrollTimers=new St;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,n,r,a){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=a;let o=this.element=Ir(t);this._document=n,this.withOrientation("vertical").withElementContainer(o),e.registerDropContainer(this),this._parentPositions=new Cc(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,n,r){this._draggingStarted(),r==null&&this.sortingDisabled&&(r=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,n,r),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,n,r,a,o,u,m={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:n,container:this,previousContainer:r,isPointerOverContainer:a,distance:o,dropPoint:u,event:m})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(e.filter(r=>r.isDragging()).every(r=>t.indexOf(r)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof Ec&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new yd(this._document,this._dragDropRegistry);else{let e=new Ec(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,n)=>this.sortPredicate(e,n,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Ir(this.element),n=this._scrollableElements.indexOf(this._container),r=this._scrollableElements.indexOf(t);return n>-1&&this._scrollableElements.splice(n,1),r>-1&&this._scrollableElements.splice(r,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,n,r){if(this.sortingDisabled||!this._domRect||!zg(this._domRect,e1,e,n))return;let a=this._sortStrategy.sort(t,e,n,r);a&&this.sorted.next({previousIndex:a.previousIndex,currentIndex:a.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let n,r=Mn.NONE,a=Xi.NONE;if(this._parentPositions.positions.forEach((o,u)=>{u===this._document||!o.clientRect||n||zg(o.clientRect,e1,t,e)&&([r,a]=oM(u,o.clientRect,this._direction,t,e),(r||a)&&(n=u))}),!r&&!a){let{width:o,height:u}=this._viewportRuler.getViewportSize(),m={width:o,height:u,top:0,right:o,bottom:u,left:0};r=o1(m,e),a=s1(m,t),n=window}n&&(r!==this._verticalScrollDirection||a!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=r,this._horizontalScrollDirection=a,this._scrollNode=n,(r||a)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Sm(0,xm).pipe(Rs(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Mn.UP?t.scrollBy(0,-e):this._verticalScrollDirection===Mn.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===Xi.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===Xi.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&vd(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,n){return this._siblings.find(r=>r._canReceive(t,e,n))}_canReceive(t,e,n){if(!this._domRect||!vd(this._domRect,e,n)||!this.enterPredicate(t,this))return!1;let r=this._getShadowRoot().elementFromPoint(e,n);return r?r===this._container||this._container.contains(r):!1}_startReceiving(t,e){let n=this._activeSiblings;!n.has(t)&&e.every(r=>this.enterPredicate(r,this)||this._draggables.indexOf(r)>-1)&&(n.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=Ys(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function o1(i,t){let{top:e,bottom:n,height:r}=i,a=r*a1;return t>=e-a&&t<=e+a?Mn.UP:t>=n-a&&t<=n+a?Mn.DOWN:Mn.NONE}function s1(i,t){let{left:e,right:n,width:r}=i,a=r*a1;return t>=e-a&&t<=e+a?Xi.LEFT:t>=n-a&&t<=n+a?Xi.RIGHT:Xi.NONE}function oM(i,t,e,n,r){let a=o1(t,r),o=s1(t,n),u=Mn.NONE,m=Xi.NONE;if(a){let f=i.scrollTop;a===Mn.UP?f>0&&(u=Mn.UP):i.scrollHeight-f>i.clientHeight&&(u=Mn.DOWN)}if(o){let f=i.scrollLeft;e==="rtl"?o===Xi.RIGHT?f<0&&(m=Xi.RIGHT):i.scrollWidth+f>i.clientWidth&&(m=Xi.LEFT):o===Xi.LEFT?f>0&&(m=Xi.LEFT):i.scrollWidth-f>i.clientWidth&&(m=Xi.RIGHT)}return[u,m]}var cs={capture:!0},_d={passive:!1,capture:!0},sM=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Te({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(n,r){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return i})(),l1=(()=>{class i{_ngZone=je(bn);_document=je(Bo);_styleLoader=je(Pf);_renderer=je(Ro).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=g0([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new St;pointerUp=new St;scroll=new St;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=kr(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,_d)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,n){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(sM),this._activeDragInstances.update(r=>[...r,e]),this._activeDragInstances().length===1)){let r=n.type.startsWith("touch"),a=u=>this.pointerUp.next(u),o=[["scroll",u=>this.scroll.next(u),cs],["selectstart",this._preventDefaultWhileDragging,_d]];r?o.push(["touchend",a,cs],["touchcancel",a,cs]):o.push(["mouseup",a,cs]),r||o.push(["mousemove",u=>this.pointerMove.next(u),_d]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=o.map(([u,m,f])=>kr(this._renderer,this._document,u,m,f))})}}stopDragging(e){this._activeDragInstances.update(n=>{let r=n.indexOf(e);return r>-1?(n.splice(r,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let n=[this.scroll];return e&&e!==this._document&&n.push(new Xn(r=>this._ngZone.runOutsideAngular(()=>{let a=kr(this._renderer,e,"scroll",o=>{this._activeDragInstances().length&&r.next(o)},cs);return()=>{a()}}))),Xr(...n)}registerDirectiveNode(e,n){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,n)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(n){return new(n||i)};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),lM={dragStartThreshold:5,pointerDirectionChangeThreshold:5},c1=(()=>{class i{_document=je(Bo);_ngZone=je(bn);_viewportRuler=je(el);_dragDropRegistry=je(l1);_renderer=je(Ro).createRenderer(null,null);constructor(){}createDrag(e,n=lM){return new bd(e,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Cd(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),t1=new wr("CDK_DRAG_PARENT");var cM=new wr("CdkDragHandle");var dM=new wr("CDK_DRAG_CONFIG"),uM=new wr("CdkDropList"),d1=(()=>{class i{element=je(Oo);dropContainer=je(uM,{optional:!0,skipSelf:!0});_ngZone=je(bn);_viewContainerRef=je(Bs);_dir=je(Zs,{optional:!0});_changeDetectorRef=je(Dt);_selfHandle=je(cM,{optional:!0,self:!0});_parentDrag=je(t1,{optional:!0,skipSelf:!0});_dragDropRegistry=je(l1);_destroyed=new St;_handles=new Kn([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new zt;released=new zt;ended=new zt;entered=new zt;exited=new zt;dropped=new zt;moved=new Xn(e=>{let n=this._dragRef.moved.pipe(xt(r=>({source:this,pointerPosition:r.pointerPosition,event:r.event,delta:r.delta,distance:r.distance}))).subscribe(e);return()=>{n.unsubscribe()}});_injector=je(Ea);constructor(){let e=this.dropContainer,n=je(dM,{optional:!0}),r=je(c1);this._dragRef=r.createDrag(this.element,{dragStartThreshold:n&&n.dragStartThreshold!=null?n.dragStartThreshold:5,pointerDirectionChangeThreshold:n&&n.pointerDirectionChangeThreshold!=null?n.pointerDirectionChangeThreshold:5,zIndex:n?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),n&&this._assignDefaults(n),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(Rs(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Ns(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let n=e.rootElementSelector,r=e.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let n=this._handles.getValue();n.push(e),this._handles.next(n)}_removeHandle(e){let n=this._handles.getValue(),r=n.indexOf(e);r>-1&&(n.splice(r,1),this._handles.next(n))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,n=e;this.rootElementSelector&&(n=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Ir(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let n=this._dir,r=this.dragStartDelay,a=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,o=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof r=="object"&&r?r:Tf(r),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(a).withPreviewTemplate(o).withPreviewContainer(this.previewContainer||"global"),n&&e.withDirection(n.value)}}),e.beforeStarted.pipe(Ds(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){let r=this._dragDropRegistry.getDragDirectiveForNode(n);if(r){e.withParent(r._dragRef);break}n=n.parentElement}})}_handleEvents(e){e.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),e.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(e){let{lockAxis:n,dragStartDelay:r,constrainPosition:a,previewClass:o,boundaryElement:u,draggingDisabled:m,rootElementSelector:f,previewContainer:h}=e;this.disabled=m??!1,this.dragStartDelay=r||0,n&&(this.lockAxis=n),a&&(this.constrainPosition=a),o&&(this.previewClass=o),u&&(this.boundaryElement=u),f&&(this.rootElementSelector=f),h&&(this.previewContainer=h)}_setupHandlesListener(){this._handles.pipe(Rn(e=>{let n=e.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),Ui(e=>Xr(...e.map(n=>n._stateChanges.pipe(Yr(n))))),Rs(this._destroyed)).subscribe(e=>{let n=this._dragRef,r=e.element.nativeElement;e.disabled?n.disableHandle(r):n.enableHandle(r)})}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ls({type:i,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,r){n&2&&Be("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",fr],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Dm]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Jr([{provide:t1,useExisting:i}]),Er]})}return i})();var Tc=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=No({type:i});static \u0275inj=Ao({providers:[c1],imports:[tl]})}return i})();var N_=hi(Fu()),Hr=hi(ki());var Eo=class i{constructor(t){this.http=t}base=`${He.apiUrl}/label-designs`;headers(){let t=localStorage.getItem("token")||"";return new Qe({"x-auth-token":t})}list(){return this.http.get(this.base,{headers:this.headers()})}get(t){return this.http.get(`${this.base}/${t}`,{headers:this.headers()})}create(t){return this.http.post(this.base,t,{headers:this.headers()})}update(t,e){return this.http.put(`${this.base}/${t}`,e,{headers:this.headers()})}remove(t){return this.http.delete(`${this.base}/${t}`,{headers:this.headers()})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var m6=["barcodeSvg"];function f6(i,t){if(i&1){let e=ae();l(0,"div")(1,"h4",6),d(2,"Hoja (mm)"),s(),l(3,"div",7)(4,"label"),d(5,"Ancho p\xE1g."),s(),l(6,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.pageWidthMm,r)||(a.design.pageWidthMm=r),k(r)}),s(),l(7,"label"),d(8,"Alto p\xE1g."),s(),l(9,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.pageHeightMm,r)||(a.design.pageHeightMm=r),k(r)}),s(),l(10,"label"),d(11,"Cols"),s(),l(12,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.cols,r)||(a.design.cols=r),k(r)}),s(),l(13,"label"),d(14,"Rens"),s(),l(15,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.rows,r)||(a.design.rows=r),k(r)}),s(),l(16,"label"),d(17,"Gap X"),s(),l(18,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.gapXmm,r)||(a.design.gapXmm=r),k(r)}),s(),l(19,"label"),d(20,"Gap Y"),s(),l(21,"input",8),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.gapYmm,r)||(a.design.gapYmm=r),k(r)}),s()()()}if(i&2){let e=_();c(6),J("ngModel",e.design.pageWidthMm),c(3),J("ngModel",e.design.pageHeightMm),c(3),J("ngModel",e.design.cols),c(3),J("ngModel",e.design.rows),c(3),J("ngModel",e.design.gapXmm),c(3),J("ngModel",e.design.gapYmm)}}function p6(i,t){if(i&1){let e=ae();l(0,"div")(1,"h4",6),d(2,"Rollo"),s(),l(3,"div",7)(4,"label"),d(5,"Gap entre etiquetas (mm)"),s(),l(6,"input",37),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.design.rollGapMm,r)||(a.design.rollGapMm=r),k(r)}),s()(),l(7,"small"),d(8,"El ancho de la etiqueta debe coincidir con el ancho del rollo instalado en la QL-800."),s()()}if(i&2){let e=_();c(6),J("ngModel",e.design.rollGapMm)}}function h6(i,t){if(i&1&&y(0,"div",38),i&2){let e=_();Ri("left",e.design.splitPct,"%")}}function g6(i,t){if(i&1&&(l(0,"div",43),d(1),s()),i&2){let e=_().$implicit,n=_();p("ngStyle",n.textStyle(e)),c(),R(" ",n.sampleValue(e)," ")}}function _6(i,t){if(i&1&&(l(0,"div",43),d(1),s()),i&2){let e=_().$implicit,n=_();p("ngStyle",n.textStyle(e)),c(),R(" ",n.formatPrice(123.45,e)," ")}}function v6(i,t){i&1&&(l(0,"div"),km(),y(1,"svg",null,0),s())}function x6(i,t){if(i&1){let e=ae();l(0,"div",39),w("click",function(r){let a=P(e).$implicit,o=_();return r.stopPropagation(),k(o.selected=a)})("cdkDragEnded",function(r){let a=P(e).$implicit,o=_();return k(o.onDragEnd(r,a))}),Ze(1,40),N(2,g6,2,2,"div",41)(3,_6,2,2,"div",41)(4,v6,3,0,"div",42),et(),s()}if(i&2){let e=t.$implicit,n=_();Ri("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),Be("selected",e===n.selected),c(),p("ngSwitch",e.type),c(),p("ngSwitchCase","text"),c(),p("ngSwitchCase","price"),c(),p("ngSwitchCase","barcode")}}function b6(i,t){if(i&1&&(l(0,"option",73),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e.stack),c(),T(e.name)}}function y6(i,t){if(i&1){let e=ae();l(0,"div")(1,"div",62)(2,"label"),d(3,"Tipograf\xEDa:"),s(),l(4,"select",5),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.fontFamily,r)||(a.selected.fontFamily=r),k(r)}),N(5,b6,2,2,"option",63),s(),l(6,"label",64),d(7,"Fuente (pt):"),s(),l(8,"input",65),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.fontSize,r)||(a.selected.fontSize=r),k(r)}),s(),l(9,"label")(10,"input",13),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.bold,r)||(a.selected.bold=r),k(r)}),s(),d(11," Negritas"),s(),l(12,"label"),d(13,"Tracking (px):"),s(),l(14,"input",66),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.letterSpacing,r)||(a.selected.letterSpacing=r),k(r)}),s()(),l(15,"div",67)(16,"div",68)(17,"label")(18,"input",13),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.uppercase,r)||(a.selected.uppercase=r),k(r)}),s(),d(19," MAY\xDASCULAS"),s()(),l(20,"div",68)(21,"label"),d(22,"Alineaci\xF3n:\xA0"),s(),l(23,"select",5),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.align,r)||(a.selected.align=r),k(r)}),l(24,"option"),d(25,"left"),s(),l(26,"option"),d(27,"center"),s(),l(28,"option"),d(29,"right"),s()()(),l(30,"div",69)(31,"label"),d(32,"Pref.:\xA0"),l(33,"input",70),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.prefix,r)||(a.selected.prefix=r),k(r)}),s()()(),l(34,"div",71)(35,"label"),d(36,"Sufi.:\xA0"),l(37,"input",72),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.suffix,r)||(a.selected.suffix=r),k(r)}),s()()()()()}if(i&2){let e=_(2);c(4),J("ngModel",e.selected.fontFamily),c(),p("ngForOf",e.fontOptions),c(3),J("ngModel",e.selected.fontSize),c(2),J("ngModel",e.selected.bold),c(4),J("ngModel",e.selected.letterSpacing),c(4),J("ngModel",e.selected.uppercase),c(5),J("ngModel",e.selected.align),c(10),J("ngModel",e.selected.prefix),c(4),J("ngModel",e.selected.suffix)}}function C6(i,t){if(i&1){let e=ae();l(0,"div",74)(1,"div",22)(2,"label"),d(3,"CB ancho(px)\xA0"),s(),l(4,"input",75),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.barcode.width,r)||(a.selected.barcode.width=r),k(r)}),w("ngModelChange",function(){P(e);let r=_(2);return k(r.renderBarcodes())}),s()(),l(5,"div",22)(6,"label"),d(7,"CB alto(px)\xA0"),s(),l(8,"input",75),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.barcode.height,r)||(a.selected.barcode.height=r),k(r)}),w("ngModelChange",function(){P(e);let r=_(2);return k(r.renderBarcodes())}),s()(),l(9,"div",76)(10,"label")(11,"input",13),ee("ngModelChange",function(r){P(e);let a=_(2);return Z(a.selected.barcode.displayValue,r)||(a.selected.barcode.displayValue=r),k(r)}),w("ngModelChange",function(){P(e);let r=_(2);return k(r.renderBarcodes())}),s(),d(12," Mostrar texto "),s()()()}if(i&2){let e=_(2);c(4),J("ngModel",e.selected.barcode.width),c(4),J("ngModel",e.selected.barcode.height),c(3),J("ngModel",e.selected.barcode.displayValue)}}function S6(i,t){if(i&1){let e=ae();l(0,"div",44)(1,"h4",45),d(2,"Propiedades del elemento seleccionado"),s(),l(3,"div",46),d(4,"Tipo: "),l(5,"b"),d(6),s()(),l(7,"div",47)(8,"span",48),d(9,"Posici\xF3n:"),s(),l(10,"label"),d(11),F(12,"number"),s(),l(13,"button",49),w("click",function(){P(e);let r=_();return k(r.nudge(-r.stepX,0))}),y(14,"i",50),s(),l(15,"button",51),w("click",function(){P(e);let r=_();return k(r.nudge(r.stepX,0))}),y(16,"i",52),s(),l(17,"label"),d(18),F(19,"number"),s(),l(20,"button",53),w("click",function(){P(e);let r=_();return k(r.nudge(0,-r.stepY))}),y(21,"i",54),s(),l(22,"button",55),w("click",function(){P(e);let r=_();return k(r.nudge(0,r.stepY))}),y(23,"i",56),s()(),l(24,"div",57)(25,"span",48),d(26,"Tama\xF1o:"),s(),l(27,"label"),d(28,"Ancho (%)"),s(),l(29,"input",58),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.selected.w,r)||(a.selected.w=r),k(r)}),s(),l(30,"label"),d(31,"Alto (%)"),s(),l(32,"input",58),ee("ngModelChange",function(r){P(e);let a=_();return Z(a.selected.h,r)||(a.selected.h=r),k(r)}),s()(),N(33,y6,38,9,"div",12)(34,C6,13,3,"div",59),l(35,"div",60)(36,"button",61),w("click",function(){P(e);let r=_();return k(r.deleteSelected())}),d(37,"Eliminar elemento"),s()()()}if(i&2){let e=_();c(6),T(e.selected.type),c(5),R("X=",Q(12,7,e.selected.x,"1.0-1"),"%"),c(7),R("Y=",Q(19,10,e.selected.y,"1.0-1"),"%"),c(11),J("ngModel",e.selected.w),c(3),J("ngModel",e.selected.h),c(),p("ngIf",e.selected.type!=="barcode"),c(),p("ngIf",e.selected.type==="barcode")}}function w6(i,t){if(i&1){let e=ae();l(0,"li",77),w("click",function(){let r=P(e).$implicit,a=_();return k(a.load(r))}),l(1,"span",78),d(2),s(),l(3,"button",79),w("click",function(r){let a=P(e).$implicit,o=_();return k(o.remove(a,r))}),d(4,"Borrar"),s()()}if(i&2){let e=t.$implicit,n=_();Be("active",e._id===n.design._id),c(2),T(e.nombre)}}var Uc=class i{constructor(t){this.svc=t}design=this.blankDesign();disenos=[];selected=null;zoom=2;gridStep=1;barcodeSvgs;fontOptions=[{name:"Inter",stack:"Inter, system-ui, Arial, sans-serif"},{name:"Roboto",stack:"Roboto, system-ui, Arial, sans-serif"},{name:"System UI",stack:"system-ui, Arial, sans-serif"},{name:"Arial",stack:"Arial, Helvetica, sans-serif"},{name:"Georgia",stack:'Georgia, "Times New Roman", serif'},{name:"Times New Roman",stack:'"Times New Roman", Times, serif'},{name:"Courier New",stack:'"Courier New", Courier, monospace'}];SAFE_TOP_MM=.8;stepX=1;stepY=1;keyboardNudgeActive=!0;ngOnInit(){this.refreshList()}nudge(t,e){if(!this.selected)return;let n=m=>Math.round(m*10)/10,r=Math.max(0,100-(this.selected.w??0)),a=Math.max(0,100-(this.selected.h??0)),o=Math.min(r,Math.max(0,(this.selected.x??0)+Number(t||0))),u=Math.min(a,Math.max(0,(this.selected.y??0)+Number(e||0)));this.selected.x=n(o),this.selected.y=n(u)}fromApi(t){return{_id:t._id,nombre:t.nombre??"",widthMm:t.size?.widthMm??t.widthMm??50,heightMm:t.size?.heightMm??t.heightMm??30,marginMm:t.size?.marginMm??t.marginMm??2,pageWidthMm:t.layout?.pageWidthMm??t.pageWidthMm??210,pageHeightMm:t.layout?.pageHeightMm??t.pageHeightMm??297,cols:t.layout?.columns??t.cols??4,rows:t.layout?.rows??t.rows??8,gapXmm:t.layout?.gapXmm??t.gapXmm??2,gapYmm:t.layout?.gapYmm??t.gapYmm??2,twoCols:t.twoCols??!1,splitPct:t.splitPct??50,elements:(t.elements||[]).map(e=>({type:e.type,field:e.field??"nombre",text:e.text??"",x:e.x??5,y:e.y??5,w:e.w??50,h:e.h??10,fontSize:e.fontSize??10,bold:!!e.bold,align:e.align??"left",uppercase:!!e.uppercase,prefix:e.prefix??"",suffix:e.suffix??"",barcode:e.barcode?{symbology:e.barcode.symbology??"CODE128",width:e.barcode.width??1,height:e.barcode.height??30,displayValue:e.barcode.displayValue??!0}:{symbology:"CODE128",width:1,height:30,displayValue:!0},fontFamily:e.fontFamily??"Inter, system-ui, Arial, sans-serif",letterSpacing:typeof e.letterSpacing=="number"?e.letterSpacing:0}))}}blankDesign(){return{nombre:"",widthMm:62,heightMm:30,marginMm:2,pageWidthMm:210,pageHeightMm:297,cols:4,rows:8,gapXmm:2,gapYmm:2,twoCols:!1,splitPct:50,mode:"roll",rollGapMm:0,elements:[]}}refreshList(){this.svc.list().subscribe(t=>{let e=t||[];this.disenos=e.map(n=>this.fromApi(n))})}normalizeDesign(t){return{_id:t?._id,nombre:t?.nombre??"",widthMm:t?.widthMm??t?.size?.widthMm??50,heightMm:t?.heightMm??t?.size?.heightMm??30,marginMm:t?.marginMm??t?.size?.marginMm??2,pageWidthMm:t?.pageWidthMm??t?.layout?.pageWidthMm??210,pageHeightMm:t?.pageHeightMm??t?.layout?.pageHeightMm??297,cols:t?.cols??t?.layout?.columns??3,rows:t?.rows??t?.layout?.rows??8,gapXmm:t?.gapXmm??t?.layout?.gapXmm??2,gapYmm:t?.gapYmm??t?.layout?.gapYmm??2,mode:t?.mode??"roll",rollGapMm:t?.rollGapMm??0,elements:t?.elements??[]}}ngAfterViewInit(){setTimeout(()=>this.renderBarcodes(),0),this.barcodeSvgs.changes.subscribe(()=>{this.renderBarcodes()})}load(t){t?._id?this.svc.get(t._id).subscribe(e=>{this.design=this.normalizeDesign(e),setTimeout(()=>this.renderBarcodes(),0)}):(this.design=this.normalizeDesign(t),setTimeout(()=>this.renderBarcodes(),0)),this.selected=null}nuevo(){this.design=this.blankDesign(),this.selected=null}addText(t){this.design.elements.push({type:"text",field:t,x:5,y:5,w:60,h:10,fontSize:11,align:"left",bold:!1,uppercase:!1,prefix:"",suffix:"",fontFamily:"Inter, system-ui, Arial, sans-serif",letterSpacing:0})}addPrice(){this.design.elements.push({type:"price",field:"precioVenta",x:5,y:20,w:60,h:15,fontSize:16,align:"left",bold:!0,prefix:"$",uppercase:!1,suffix:"",fontFamily:"Inter, system-ui, Arial, sans-serif",letterSpacing:0})}addBarcode(){this.design.elements.push({type:"barcode",field:"codigoBarras",x:5,y:40,w:80,h:25,barcode:{symbology:"CODE128",width:1,height:30,displayValue:!0}}),setTimeout(()=>this.renderBarcodes(),0)}deleteSelected(){this.selected&&(this.design.elements=this.design.elements.filter(t=>t!==this.selected),this.selected=null)}onDragEnd(t,e){let n=t.source.element.nativeElement,r=n.closest(".label-inner"),a=r.getBoundingClientRect(),o=n.getBoundingClientRect(),u=o.left-a.left,m=o.top-a.top,f=u/r.clientWidth*100,h=m/r.clientHeight*100,g=x=>Math.round(x/this.gridStep)*this.gridStep;e.x=Math.max(0,Math.min(100-(e.w??0),g(f))),e.y=Math.max(0,Math.min(100-(e.h??0),g(h))),t.source.reset()}textStyle(t){return{"font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"font-family":t.fontFamily||"system-ui, Arial, sans-serif","text-align":t.align||"left",width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start",overflow:"hidden","white-space":"nowrap","line-height":1,"letter-spacing.px":t.letterSpacing??0}}sampleValue(t){let e={nombre:"Ciprofloxacino 3.5 mg / Dexametasona 1 mg / 1 mL SONS C/5 mL Sol Oftalmica",renglon1:"Ciprofloxacino / Dexametasona",renglon2:"3.5 mg /1 mg / 1 mL C/5 mL",codigoBarras:"7501234567890",precioVenta:"123.45",custom:t.text||"Texto fijo"},n=t.field||"nombre",r=e[n]||"";return t.uppercase&&(r=String(r).toUpperCase()),`${t.prefix||""}${r}${t.suffix||""}`}formatPrice(t,e){let n=new Intl.NumberFormat("es-MX",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(Number(t)||0)),r=`${e.prefix||"$"}${n}${e.suffix||""}`;return e.uppercase?r.toUpperCase():r}renderBarcodes(){let t=this.barcodeSvgs?.toArray()||[],e=0;this.design.elements.forEach(n=>{if(n.type!=="barcode")return;let r=t[e++]?.nativeElement;if(!r)return;if(n.barcode?.symbology==="QR"){r.innerHTML="";return}let a=this.sampleValue(Wt(Ke({},n),{field:"codigoBarras"}));(0,N_.default)(r,a,{format:n.barcode?.symbology||"CODE128",width:n.barcode?.width||1,height:n.barcode?.height||30,displayValue:n.barcode?.displayValue??!0,margin:0})})}save(){let t=this.design;if(!t||!t.nombre?.trim()){Hr.default.fire("Falta nombre","Ponle un nombre al dise\xF1o.","info");return}if(!t.widthMm||!t.heightMm){Hr.default.fire("Tama\xF1o incompleto","Define ancho/alto de la etiqueta (mm).","info");return}Array.isArray(t.elements)||(t.elements=[]);let e=Wt(Ke({},t),{elements:(t.elements||[]).map(r=>({type:r.type,field:r.field,x:r.x,y:r.y,w:r.w,h:r.h,fontSize:r.fontSize,bold:r.bold,align:r.align,uppercase:r.uppercase,prefix:r.prefix,suffix:r.suffix,text:r.text,barcode:r.barcode?Ke({},r.barcode):void 0,fontFamily:r.fontFamily,letterSpacing:r.letterSpacing})),size:{widthMm:t.widthMm,heightMm:t.heightMm,marginMm:t.marginMm??0},layout:{pageWidthMm:t.pageWidthMm??210,pageHeightMm:t.pageHeightMm??297,columns:t.cols??1,rows:t.rows??1,gapXmm:t.gapXmm??0,gapYmm:t.gapYmm??0}});(t._id?this.svc.update(t._id,e):this.svc.create(e)).subscribe({next:r=>{this.design=this.fromApi(r),this.refreshList(),Hr.default.fire({icon:"success",title:"Guardado",timer:1200,showConfirmButton:!1})},error:r=>{console.error("Error al guardar dise\xF1o",r);let a=r?.error?.error||r?.error?.mensaje||r?.message||"No se pudo guardar el dise\xF1o";Hr.default.fire("Error",a,"error")}})}remove(t,e){e?.stopPropagation(),t?._id&&Hr.default.fire({title:"\xBFEliminar dise\xF1o?",html:`<b>${t.nombre}</b> se eliminar\xE1 de forma permanente.`,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,focusCancel:!0}).then(n=>{n.isConfirmed&&this.svc.remove(t._id).subscribe({next:()=>{this.design?._id===t._id&&this.nuevo(),this.refreshList(),Hr.default.fire({icon:"success",title:"Eliminado",timer:1200,showConfirmButton:!1})},error:r=>{console.error("Error eliminando dise\xF1o",r),Hr.default.fire("Error","No se pudo eliminar el dise\xF1o.","error")}})})}isTypingTarget(t){return!!t&&(t.isContentEditable||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)}keyStep(t,e){let n=t;return e.shiftKey&&(n*=10),e.altKey&&(n*=.1),n}onKeydown(t){if(!this.selected||!this.keyboardNudgeActive||this.isTypingTarget(t.target))return;let e=t.key.toLowerCase();if(!(e==="arrowleft"||e==="arrowright"||e==="arrowup"||e==="arrowdown")&&!(e==="a"||e==="d"||e==="w"||e==="s"))return;let a=e==="arrowleft"||e==="a"?-this.keyStep(this.stepX,t):e==="arrowright"||e==="d"?this.keyStep(this.stepX,t):0,o=e==="arrowup"||e==="w"?-this.keyStep(this.stepY,t):e==="arrowdown"||e==="s"?this.keyStep(this.stepY,t):0;(a!==0||o!==0)&&(t.preventDefault(),this.nudge(a,o))}static \u0275fac=function(e){return new(e||i)(ie(Eo))};static \u0275cmp=Te({type:i,selectors:[["app-label-designer"]],viewQuery:function(e,n){if(e&1&&Tt(m6,5),e&2){let r;bt(r=yt())&&(n.barcodeSvgs=r)}},hostBindings:function(e,n){e&1&&w("keydown",function(a){return n.onKeydown(a)},!1,Mm)},decls:77,vars:22,consts:[["barcodeSvg",""],[1,"designer"],[1,"sidebar"],[1,"titulo","text-center"],[2,"margin-right","1rem"],[3,"ngModelChange","ngModel"],[1,"subtitulo","text-center","mt-1"],[1,"grid"],["type","number",3,"ngModelChange","ngModel"],["type","radio","value","sheet",3,"ngModelChange","ngModel"],[2,"margin-left","1rem"],["type","radio","value","roll",3,"ngModelChange","ngModel"],[4,"ngIf"],["type","checkbox",3,"ngModelChange","ngModel"],["type","number","min","10","max","90",3,"ngModelChange","ngModel"],[1,"mb-2"],[1,"row","mb-1"],[1,"col-4"],[1,"btn-gris-chico",3,"click"],[1,"col-4",2,"text-align","center"],[1,"col-4",2,"text-align","end"],[1,"row"],[1,"col-5"],[1,"col-7",2,"text-align","end"],[1,"col-7"],[1,"btn-verde-chico",3,"click"],[1,"col-5",2,"text-align","end"],["tabindex","0",1,"center-col"],[1,"canvas-wrap"],[1,"label-canvas",3,"click"],[1,"label-inner"],["class","two-cols-guide",3,"left",4,"ngIf"],["class","el","cdkDrag","","cdkDragBoundary",".label-inner",3,"selected","left","top","width","height","click","cdkDragEnded",4,"ngFor","ngForOf"],["class","props-card",4,"ngIf"],[1,"design-list"],[1,"titulo"],["class","name-label",3,"active","click",4,"ngFor","ngForOf"],["type","number","min","0",3,"ngModelChange","ngModel"],[1,"two-cols-guide"],["cdkDrag","","cdkDragBoundary",".label-inner",1,"el",3,"click","cdkDragEnded"],[3,"ngSwitch"],[3,"ngStyle",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"ngStyle"],[1,"props-card"],[1,"subtitulo",2,"text-align","center"],[2,"text-align","center"],[1,"row-pos"],[1,"lead"],["type","button","matTooltip","Izquierda",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-left"],["type","button","matTooltip","Derecha",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-right"],["type","button","matTooltip","Arriba",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-up"],["type","button","matTooltip","Abajo",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-down"],[1,"rowline"],["type","number","min","1","max","100",3,"ngModelChange","ngModel"],["class","row my-1",4,"ngIf"],[2,"display","flex","justify-content","center","margin-top",".5rem"],[1,"btn-rojo-chico",3,"click"],[1,"rowTexto"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"margin-right",".75rem"],["type","number",2,"width","3.5rem",3,"ngModelChange","ngModel"],["type","number","step","0.1",3,"ngModelChange","ngModel"],[1,"row","mt-2"],[1,"col-3"],[1,"col-3",2,"text-align","center"],[2,"width","7rem",3,"ngModelChange","ngModel"],[1,"col-3",2,"text-align","end"],[2,"width","6rem",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"row","my-1"],["type","number",2,"width","3rem",3,"ngModelChange","ngModel"],[1,"col-2",2,"text-align","end"],[1,"name-label",3,"click"],[1,"name"],[1,"mini","btn-rojo",3,"click"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"div",2)(2,"h3",3),d(3,"Dise\xF1o"),s(),l(4,"label",4),d(5,"Nombre"),s(),l(6,"input",5),ee("ngModelChange",function(a){return Z(n.design.nombre,a)||(n.design.nombre=a),a}),s(),l(7,"h4",6),d(8,"Tama\xF1o etiqueta (mm)"),s(),l(9,"div",7)(10,"label"),d(11,"Ancho"),s(),l(12,"input",8),ee("ngModelChange",function(a){return Z(n.design.widthMm,a)||(n.design.widthMm=a),a}),s(),l(13,"label"),d(14,"Alto"),s(),l(15,"input",8),ee("ngModelChange",function(a){return Z(n.design.heightMm,a)||(n.design.heightMm=a),a}),s(),l(16,"label"),d(17,"Margen"),s(),l(18,"input",8),ee("ngModelChange",function(a){return Z(n.design.marginMm,a)||(n.design.marginMm=a),a}),s()(),l(19,"h4",6),d(20,"Modo"),s(),l(21,"label")(22,"input",9),ee("ngModelChange",function(a){return Z(n.design.mode,a)||(n.design.mode=a),a}),s(),d(23," Hoja (A4 / columnas)"),s(),l(24,"label",10)(25,"input",11),ee("ngModelChange",function(a){return Z(n.design.mode,a)||(n.design.mode=a),a}),s(),d(26," Rollo (Brother QL-800)"),s(),N(27,f6,22,6,"div",12)(28,p6,9,1,"div",12),l(29,"h4",6),d(30,"Gu\xEDa: 2 columnas"),s(),l(31,"div",7)(32,"label"),d(33,"Activar"),s(),l(34,"input",13),ee("ngModelChange",function(a){return Z(n.design.twoCols,a)||(n.design.twoCols=a),a}),s(),l(35,"label"),d(36,"Split (%)"),s(),l(37,"input",14),ee("ngModelChange",function(a){return Z(n.design.splitPct,a)||(n.design.splitPct=a),a}),s()(),l(38,"div",15)(39,"h4",6),d(40,"Agregar elemento"),s(),l(41,"div",16)(42,"div",17)(43,"button",18),w("click",function(){return n.addText("nombre")}),d(44,"Nombre"),s()(),l(45,"div",19)(46,"button",18),w("click",function(){return n.addText("renglon1")}),d(47,"Rengl\xF3n 1"),s()(),l(48,"div",20)(49,"button",18),w("click",function(){return n.addText("renglon2")}),d(50,"Rengl\xF3n 2"),s()()(),l(51,"div",21)(52,"div",22)(53,"button",18),w("click",function(){return n.addPrice()}),d(54,"Precio"),s()(),l(55,"div",23)(56,"button",18),w("click",function(){return n.addBarcode()}),d(57,"C\xF3digo de barras"),s()()()(),l(58,"div",21)(59,"div",24)(60,"button",25),w("click",function(){return n.save()}),d(61,"Guardar dise\xF1o"),s()(),l(62,"div",26)(63,"button",25),w("click",function(){return n.nuevo()}),d(64,"Nuevo"),s()()()(),l(65,"div",27)(66,"div",28)(67,"div",29),w("click",function(){return n.selected=null}),l(68,"div",30),N(69,h6,1,2,"div",31)(70,x6,5,14,"div",32),s()()(),N(71,S6,38,13,"div",33),s(),l(72,"div",34)(73,"h4",35),d(74,"Mis dise\xF1os guardados"),s(),l(75,"ul"),N(76,w6,5,3,"li",36),s()()()),e&2&&(c(6),J("ngModel",n.design.nombre),c(6),J("ngModel",n.design.widthMm),c(3),J("ngModel",n.design.heightMm),c(3),J("ngModel",n.design.marginMm),c(4),J("ngModel",n.design.mode),c(3),J("ngModel",n.design.mode),c(2),p("ngIf",n.design.mode!=="roll"),c(),p("ngIf",n.design.mode==="roll"),c(6),J("ngModel",n.design.twoCols),c(3),J("ngModel",n.design.splitPct),c(30),Ri("width",n.design.widthMm+"mm")("height",n.design.heightMm+"mm")("transform","scale("+n.zoom+")"),c(),Ri("padding","calc("+(n.design.marginMm||0)+"mm + "+n.SAFE_TOP_MM+"mm) "+(n.design.marginMm||0)+"mm "+(n.design.marginMm||0)+"mm "+(n.design.marginMm||0)+"mm"),c(),p("ngIf",n.design.twoCols),c(),p("ngForOf",n.design.elements),c(),p("ngIf",n.selected),c(5),p("ngForOf",n.disenos))},dependencies:[ot,rt,at,qe,qt,li,nt,Pr,ze,Bi,Yn,_t,Oe,We,Ne,Ia,Us,js,wt,Tc,d1],styles:[".name-label[_ngcontent-%COMP%]{font-size:large;color:#0257ac}.name-label[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.designer[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr 280px;gap:12px;align-items:start}.sidebar[_ngcontent-%COMP%]{padding:8px;border:1px solid #eee;border-radius:8px;background:#fde1e1}.center-col[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto auto;gap:12px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:6px 8px;align-items:center}.canvas-wrap[_ngcontent-%COMP%]{overflow:auto;border:1px dashed #ddd;padding:12px;background:repeating-conic-gradient(#fafafa 0% 25%,transparent 0% 50%) 50% / 16px 16px;min-height:320px}.label-canvas[_ngcontent-%COMP%]{transform-origin:top left;position:relative;background:#fff;box-shadow:0 0 0 1px #e8e8e8}.label-inner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%;display:block}.el[_ngcontent-%COMP%]{position:absolute;cursor:move}.el.selected[_ngcontent-%COMP%]{outline:1px dashed #3c7cff}.el[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1}.two-cols-guide[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:0;border-left:1px dashed rgba(0,0,0,.25);pointer-events:none}.props-card[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:8px;padding:10px;background:#c7f9e8}.design-list[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:8px;padding:10px;background:#c0f0fa}.design-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.design-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;padding:6px 8px;border-bottom:1px solid #f0f0f0;cursor:pointer}.design-list[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#f5f9ff}.design-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:0}.mini[_ngcontent-%COMP%]{font-size:12px;padding:2px 6px}.row-pos[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 4rem 4rem 4rem 4rem 4rem 4rem;column-gap:8px;align-items:center;margin:6px 0}.rowTexto[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 12rem 6rem 6rem 6rem 7rem 3rem;column-gap:8px;align-items:center;margin:6px 0}.rowline[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 80px 80px 80px 80px;column-gap:8px;align-items:center;margin:6px 0}.rowline[_ngcontent-%COMP%]   .lead[_ngcontent-%COMP%]{margin-right:4px;white-space:nowrap}@media (max-width: 520px){.rowline[_ngcontent-%COMP%]{grid-template-columns:auto 80px 80px 80px 80px}}"]})};var B_=hi(Fu()),Au=hi(ki());var jc=class i{constructor(t){this.http=t}api=`${He.apiUrl}/labels/products`;search(t){let e=new Ht().set("farmaciaId",t.farmaciaId);return t.nombre&&(e=e.set("nombre",t.nombre)),t.categoria&&(e=e.set("categoria",t.categoria)),t.page&&(e=e.set("page",String(t.page))),t.limit&&(e=e.set("limit",String(t.limit))),t.sortBy&&(e=e.set("sortBy",t.sortBy)),t.sortDir&&(e=e.set("sortDir",t.sortDir)),this.http.get(this.api,{params:e,headers:new Qe({"x-auth-token":localStorage.getItem("token")||""})})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var T6=["printHost"];function P6(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function k6(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),T(e.nombre)}}function I6(i,t){i&1&&(l(0,"span"),y(1,"i",43),s())}function M6(i,t){i&1&&(l(0,"span"),d(1,"Imprimiendo\u2026"),s())}function F6(i,t){if(i&1&&(l(0,"span",44),d(1),s()),i&2){let e=_();c(),T(e.sortDir==="asc"?"\u25B2":"\u25BC")}}function A6(i,t){if(i&1&&(l(0,"span",44),d(1),s()),i&2){let e=_();c(),T(e.sortDir==="asc"?"\u25B2":"\u25BC")}}function O6(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td")(2,"input",45),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a._checked,r)||(a._checked=r),k(r)}),w("ngModelChange",function(){let r=P(e).$implicit,a=_();return k(a.onToggleRow(r))}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),F(15,"currency"),s(),l(16,"td"),d(17),s()()}if(i&2){let e=t.$implicit;c(2),J("ngModel",e._checked),c(2),T(e.nombre),c(2),T(e.codigoBarras),c(2),T(e.renglon1),c(2),T(e.renglon2),c(2),T(e.categoria),c(2),T(se(15,8,e.precioVenta)),c(3),T(e.existencia)}}function D6(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=_().$implicit,n=_().$implicit,r=_(2);c(),T(r.valorCampo(n,e))}}function R6(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=_().$implicit,n=_().$implicit,r=_(2);c(),T(r.valorPrecio(n,e))}}function N6(i,t){i&1&&y(0,"img",56)}function B6(i,t){if(i&1&&(Ze(0),l(1,"div",52),Ze(2,53),N(3,D6,2,1,"div",54)(4,R6,2,1,"div",54)(5,N6,1,0,"img",55),et(),s(),et()),i&2){let e=t.$implicit,n=_(3);c(),Ri("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),p("ngStyle",n.styleTexto(e)),c(),p("ngSwitch",e.type),c(),p("ngSwitchCase","text"),c(),p("ngSwitchCase","price"),c(),p("ngSwitchCase","barcode")}}function L6(i,t){if(i&1&&(l(0,"section",49)(1,"div",50),N(2,B6,6,13,"ng-container",51),s()()),i&2){let e=_(2);Ri("width",e.lblWmm,"mm")("height",e.lblHmm,"mm"),c(),Ri("padding",e.padMm,"mm"),c(),p("ngForOf",e.design.elements)}}function V6(i,t){if(i&1&&(l(0,"div",46)(1,"div",47,0),N(3,L6,3,7,"section",48),s()()),i&2){let e=_();c(3),p("ngForOf",e.itemsParaImprimir)}}var Wc=class i{constructor(t,e,n,r){this.designsSvc=t;this.prodSvc=e;this.farmacia=n;this.cdr=r}mostrarPrint=!1;itemsParaImprimir=[];get seleccionados(){return this.productos.filter(t=>t._checked)}trackById=(t,e)=>e?._id;get lblW(){return this.lblWmm}get lblH(){return this.lblHmm}get pad(){return this.padMm}styleTexto(t){return{position:"absolute","font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"text-align":t.align||"left",overflow:"hidden",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start","white-space":"nowrap","min-height.px":1}}isPrinting=!1;disenos=[];designId=null;design=null;fNombre="";fCategoria="";productos=[];allChecked=!1;farmacias=[];farmaciaId="";printHost;selectedIds=new Set;selectedItems=new Map;get totalSeleccionados(){return this.selectedIds.size}page=1;limit=20;totalFiltrado=0;totalPages=1;sortBy="nombre";sortDir="asc";lastQuerySig="";get lblWmm(){return 62}get lblHmm(){return this.design?.heightMm??30}get padMm(){return this.design?.marginMm??0}formatMoneyNoCents(t){return new Intl.NumberFormat("es-MX",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(Number(t)||0))}ngOnInit(){this.designsSvc.list().subscribe(e=>{this.disenos=e,e.length&&(this.designId=e[0]._id,this.loadDesign())});let t=localStorage.getItem("farmaciaId_print")||"";this.farmaciaId=t,this.cargarFarmacias()}normalizeDesign(t){let e=t?.size||{},n=t?.layout||{};return Wt(Ke({},t),{widthMm:e.widthMm??t.widthMm??0,heightMm:e.heightMm??t.heightMm??0,marginMm:e.marginMm??t.marginMm??0,pageWidthMm:n.pageWidthMm??t.pageWidthMm??210,pageHeightMm:n.pageHeightMm??t.pageHeightMm??297,cols:n.columns??t.cols??1,rows:n.rows??t.rows??1,gapXmm:n.gapXmm??t.gapXmm??0,gapYmm:n.gapYmm??t.gapYmm??0,elements:t.elements??[]})}loadDesign(){this.designId&&this.designsSvc.get(this.designId).subscribe(t=>this.design=this.normalizeDesign(t))}cargarFarmacias(){this.farmacia.obtenerFarmacias().subscribe({next:t=>{if(this.farmacias=t||[],this.farmacias.length){let e=this.farmacias.some(n=>n._id===this.farmaciaId);(!this.farmaciaId||!e)&&(this.farmaciaId=this.farmacias[0]._id,localStorage.setItem("farmaciaId_print",this.farmaciaId)),this.buscar()}},error:()=>{this.farmacias=[]}})}makeQuerySig(t,e,n){let r=a=>(a||"").trim().toLowerCase().split(/\s+/).filter(Boolean).sort().join(" ");return`${t}|${r(e)}|${r(n)}`}buscar(){let t=this.farmaciaId?.trim();if(!t){Au.default.fire({icon:"info",title:"Aviso",text:"Debes seleccionar una farmacia.",timer:1500,showConfirmButton:!1});return}let e=this.makeQuerySig(t,this.fNombre,this.fCategoria);e!==this.lastQuerySig&&(this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.lastQuerySig=e),this.prodSvc.search({farmaciaId:t,nombre:(this.fNombre||"").trim(),categoria:(this.fCategoria||"").trim(),page:this.page,limit:this.limit,sortBy:this.sortBy,sortDir:this.sortDir}).subscribe(n=>{this.productos=(n.rows||[]).map(r=>{let a=String(r._id);return Wt(Ke({},r),{_id:a,_checked:this.selectedIds.has(a)})}),this.allChecked=this.productos.length>0&&this.productos.every(r=>r._checked),this.totalFiltrado=n?.paginacion?.total??this.productos.length,this.totalPages=n?.paginacion?.totalPages??1,this.page=n?.paginacion?.page??1,this.limit=n?.paginacion?.limit??this.limit})}onToggleRow(t){let e=String(t._id);t._checked?(this.selectedIds.add(e),this.selectedItems.set(e,t)):(this.selectedIds.delete(e),this.selectedItems.delete(e)),this.allChecked=this.productos.length>0&&this.productos.every(n=>this.selectedIds.has(String(n._id)))}toggleAll(t){this.allChecked=t.target.checked;for(let e of this.productos){let n=String(e._id);e._checked=this.allChecked,this.allChecked?(this.selectedIds.add(n),this.selectedItems.set(n,e)):(this.selectedIds.delete(n),this.selectedItems.delete(n))}}onFarmaciaChange(){localStorage.setItem("farmaciaId_print",this.farmaciaId),this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.buscar()}limpiar(){this.fCategoria="",this.fNombre="",this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.lastQuerySig=this.makeQuerySig(this.farmaciaId?.trim()||"","",""),this.buscar()}irPrimera(){this.page!==1&&(this.page=1,this.buscar())}irAnterior(){this.page>1&&(this.page--,this.buscar())}irSiguiente(){this.page<this.totalPages&&(this.page++,this.buscar())}irUltima(){this.page!==this.totalPages&&(this.page=this.totalPages,this.buscar())}cambiarLimit(t){this.limit=Number(t)||20,this.page=1,this.buscar()}nb="\xA0";safe(t){return t==null?"":String(t)}valorCampo(t,e){let n={nombre:this.safe(t?.nombre),renglon1:this.safe(t?.renglon1),renglon2:this.safe(t?.renglon2),codigoBarras:this.safe(t?.codigoBarras),precioVenta:this.safe(t?.precioVenta)},r=e.field?n[e.field]??"":e.text??"";e.uppercase&&typeof r=="string"&&(r=r.toUpperCase());let a=`${e.prefix||""}${r}${e.suffix||""}`;return a.trim()===""?this.nb:a}valorPrecio(t,e){let n=t?.precioVenta;if(n==null||n==="")return"";let r=Number(n);if(!Number.isFinite(r))return"";let a=this.formatMoneyNoCents(r),o=`${e.prefix||"$"}${a}${e.suffix||""}`;return e.uppercase?o.toUpperCase():o}makeBarcodeSVG(t,e={}){let n=(t||"").trim();if(!n)return'<svg width="1" height="1"></svg>';let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("preserveAspectRatio","xMidYMid meet");try{(0,B_.default)(r,n,{format:e.format||"CODE128",width:e.width||1,height:e.height||5,displayValue:!!e.displayValue,margin:0})}catch{}return r.outerHTML}cssFont(t){let e=(t.fontFamily||"system-ui, Arial, sans-serif").trim(),n=t.letterSpacing??0;return`font-family:${e};line-height:1;letter-spacing:${n}px;`}elToHtml(t,e){let n=`position:absolute;left:${e.x}%;top:${e.y}%;width:${e.w}%;height:${e.h}%;`,r=(e.fontFamily||"system-ui, Arial, sans-serif").replace(/"/g,"'"),a=`font-weight:${e.bold?700:400};font-size:${e.fontSize||10}px;font-family:${r};letter-spacing:${e.letterSpacing??0}px;display:flex;align-items:center;justify-content:${e.align==="center"?"center":e.align==="right"?"flex-end":"flex-start"};white-space:nowrap;overflow:hidden;line-height:1;`;if(e.type==="text"){let o=this.valorCampo(t,e);return`<div class="el text" style="${n}${a}">${o}</div>`}if(e.type==="price"){let o=this.valorPrecio(t,e);return`<div class="el price" style="${n}${a}">${o}</div>`}if(e.type==="barcode"){let o=this.valorCampo(t,Wt(Ke({},e),{field:"codigoBarras"})).trim(),u=this.makeBarcodeSVG(o,{format:e.barcode?.symbology,width:e.barcode?.width,height:e.barcode?.height,displayValue:e.barcode?.displayValue});return`<div class="el barcode" style="${n}">${u}</div>`}return""}labelToHtml(t){let e=this.padMm,n=(this.design?.elements||[]).map(r=>this.elToHtml(t,r)).join("");return`
<section class="sheet">
  <div class="label-inner" style="position:relative;width:100%;height:100%;padding:${e}mm">
    ${n}
  </div>
</section>`}toggleSort(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.page=1,this.buscar()}sanitizeItemsForDesign(t){let e="\xA0",n=r=>{let a=r==null?"":String(r);return a.trim()===""?e:a};return(t||[]).map(r=>Wt(Ke({},r),{nombre:n(r?.nombre),renglon1:n(r?.renglon1),renglon2:n(r?.renglon2),codigoBarras:(r?.codigoBarras??"").toString().trim(),precioVenta:r?.precioVenta===""||r?.precioVenta===null||r?.precioVenta===void 0?null:Number.isFinite(Number(r?.precioVenta))?Number(r?.precioVenta):null}))}printViaIframeStrict(t){return Ae(this,null,function*(){if(navigator.userAgent.toLowerCase().includes("edg/")){let u=this.wrapForAutoPrint(t),m=new Blob([u],{type:"text/html"}),f=URL.createObjectURL(m),h=window.open(f,"_blank");if(!h){alert("Edge bloque\xF3 la ventana emergente. Permite popups para este sitio.");return}let g=()=>{try{URL.revokeObjectURL(f)}catch{}};try{h.addEventListener("unload",g,{once:!0})}catch{}return}let n="label-print-frame";document.getElementById(n)?.remove();let r=document.createElement("iframe");r.id=n,r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="0",r.setAttribute("sandbox","allow-modals allow-same-origin allow-scripts"),r.srcdoc=t,document.body.appendChild(r),yield new Promise(u=>{let m=()=>u();r.addEventListener("load",m,{once:!0}),setTimeout(m,500)});let a=r.contentWindow;if(!a){r.remove();return}let o=()=>{try{r.remove()}catch{}};try{a.addEventListener("afterprint",()=>setTimeout(o,50),{once:!0})}catch{}try{(a.matchMedia&&a.matchMedia("print"))?.addEventListener?.("change",m=>{m.matches||setTimeout(o,50)})}catch{}yield new Promise(u=>requestAnimationFrame(()=>requestAnimationFrame(u)));try{a.focus()}catch{}})}buildPrintHTML(t,e,n,r){let a=Number(e)||62,o=Number(n)||30,u=Number(r)||0,m=2,f=2,h=this.collectFontImports(),g=`
      <style>
        @page { size: ${a}mm ${o}mm; margin: 0; }

        html, body {
          margin: 0 !important;
          padding: 0 !important;
          width: ${a}mm !important;
          height: auto !important;            /* que el body no imponga alto */
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
          background: #fff;
        }

        /* Cada etiqueta = 1 p\xE1gina */
        .sheet {
          width: ${a}mm;
          height: 100vh;                       /* === exactamente el alto de p\xE1gina */
          min-height: 100vh;
          max-height: 100vh;
          page-break-after: always;
          break-after: page;
          page-break-inside: avoid;
          break-inside: avoid-page;            /* evita que se parta */
          -webkit-region-break-inside: avoid;  /* WebKit legacy */
          margin: 0; padding: 0; overflow: hidden; position: relative;
          background: #fff;
        }
        .sheet:last-child { page-break-after: auto; break-after: auto; }

        .label-inner {
          position: relative;
          width: 100%;
          height: 100%;
          box-sizing: border-box;
          padding: calc(${u}mm + ${m}mm) ${u}mm calc(${u}mm + ${f}mm) ${u}mm;

        .el { position:absolute; overflow:hidden; }
        .el.barcode svg { display:block; width:100%; height:100%; }
        .el.text, .el.price { line-height:1; white-space:nowrap; }
      </style>`;return`<!doctype html><html><head><meta charset="utf-8">${h}${g}</head><body>${t}
      <script>
      (async function(){
        try{ if (document.fonts && document.fonts.ready) { await document.fonts.ready; } }catch(e){}
        requestAnimationFrame(()=>requestAnimationFrame(()=>{
          try{ window.focus(); }catch(e){}
          try{ window.print(); }catch(e){}
        }));
        try{
          window.addEventListener('afterprint', ()=>{ setTimeout(()=>{ try{ window.close(); }catch(e){} }, 100); }, {once:true});
        }catch(e){}
      })();
      <\/script></body></html>`}testQL(){return Ae(this,null,function*(){let a=`
  <!doctype html><html><head><meta charset="utf-8">
    <style>
      @page { size: 62mm 20mm; margin:0; }
      html,body { margin:0; padding:0; -webkit-print-color-adjust:exact; print-color-adjust:exact; }
      .sheet { width:62mm; height:20mm; margin:0; padding:0; overflow:hidden;
               position:relative; page-break-after:always; break-after:page; }
      .label-inner { width:100%; height:100%; position:relative; }
      .el { position:absolute; }
    </style>
  </head><body>
    <section class="sheet">
      <div class="label-inner" style="position:relative;width:100%;height:100%;padding:2mm">
        <div class="el" style="position:absolute;left:5%;top:20%;font-size:12px;">TEST 62\xD720</div>
      </div>
    </section></body></html>`;yield new Promise(o=>{let u=document.createElement("iframe");u.style.position="fixed",u.style.right="0",u.style.bottom="0",u.style.width="0",u.style.height="0",u.style.border="0",document.body.appendChild(u);let m=()=>setTimeout(()=>{try{u.remove()}catch{}o()},300);u.onload=()=>Ae(null,null,function*(){let f=u.contentWindow,h=!1,g=()=>{h||(h=!0,m())};f.addEventListener("afterprint",g,{once:!0}),setTimeout(g,6e3),yield new Promise(x=>requestAnimationFrame(()=>requestAnimationFrame(x)));try{f.focus()}catch{}f.print()}),u.srcdoc=a})})}wrapForAutoPrint(t){return`<!doctype html>
<html>
<head><meta charset="utf-8"></head>
<body>
${t}
<script>
(function () {
  function go(){ try{ window.focus(); }catch(e){}
    requestAnimationFrame(()=>requestAnimationFrame(()=>{ try{ window.print(); }catch(e){} }));
  }
  function bye(){ setTimeout(()=>{ try{ window.close(); }catch(e){} }, 120); }
  try{ window.addEventListener('afterprint', bye, {once:true}); }catch(e){}
  try{
    var mm = window.matchMedia && window.matchMedia('print');
    if (mm && mm.addEventListener) mm.addEventListener('change', e=>{ if(!e.matches) bye(); });
  }catch(e){}
  if (document.readyState === 'complete' || document.readyState === 'interactive') go();
  else window.addEventListener('DOMContentLoaded', go, {once:true});
})();
<\/script>
</body></html>`}previsualizar(){return Ae(this,null,function*(){if(!(!this.design||this.selectedIds.size===0||this.isPrinting)){this.isPrinting=!0;try{let t=new Map;for(let o of this.selectedItems.values())t.set(String(o._id),o);let e=this.sanitizeItemsForDesign(Array.from(t.values()));if(navigator.userAgent.toLowerCase().includes("edg/")){yield Au.default.fire({icon:"warning",title:"Usa Chrome para imprimir etiquetas",html:`
      La impresi\xF3n de etiquetas no es estable en Microsoft Edge en este equipo.<br>
      Por favor abre este m\xF3dulo en <b>Google Chrome</b> y vuelve a intentarlo.
    `,confirmButtonText:"Entendido"});return}let r=e.map(o=>this.labelToHtml(o)).join(""),a=this.buildPrintHTML(r,this.lblWmm,this.lblHmm,this.padMm);yield this.printViaIframeStrict(a)}finally{this.isPrinting=!1,this.cdr.detectChanges()}}})}collectFontImports(){let t=new Set;return(this.design?.elements||[]).forEach(n=>{let r=(n.fontFamily||"").toLowerCase();r.includes("inter")&&t.add("Inter:wght@400;700"),r.includes("roboto")&&t.add("Roboto:wght@400;700"),r.includes("lato")&&t.add("Lato:wght@400;700"),r.includes("montserrat")&&t.add("Montserrat:wght@400;700"),r.includes("open sans")&&t.add("Open+Sans:wght@400;700"),r.includes("poppins")&&t.add("Poppins:wght@400;700"),r.includes("merriweather")&&t.add("Merriweather:wght@400;700"),r.includes("playfair")&&t.add("Playfair+Display:wght@400;700"),r.includes("noto sans")&&t.add("Noto+Sans:wght@400;700"),r.includes("noto serif")&&t.add("Noto+Serif:wght@400;700")}),t.size?['<link rel="preconnect" href="https://fonts.googleapis.com">','<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>',`<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=${Array.from(t).join("&family=")}&display=swap">`].join(""):""}static \u0275fac=function(e){return new(e||i)(ie(Eo),ie(jc),ie(Xt),ie(Dt))};static \u0275cmp=Te({type:i,selectors:[["app-etiquetas-print"]],viewQuery:function(e,n){if(e&1&&Tt(T6,5),e&2){let r;bt(r=yt())&&(n.printHost=r.first)}},decls:93,vars:32,consts:[["printHost",""],[1,"etiquetas"],[1,"titulo","text-center"],[1,"filtros"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"col-md-3"],["placeholder","Nombre",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],["placeholder","Categor\xEDa",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],[1,"col-md-1"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"col-md-1",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"row","g-2","align-items-end","mb-2"],[1,"col-md-6",2,"margin-top","1.3rem"],["matTooltip","Imprimir","aria-label","Imprimir",1,"btn-amarillo","btn-icon-only",3,"click","disabled"],[4,"ngIf"],[1,"col-md-6",2,"margin-top","1.3rem","text-align","end"],[1,"btn-gris",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change","checked"],["title","Ordenar por nombre",1,"sortable",3,"click"],["class","sort",4,"ngIf"],["title","Ordenar por categor\xEDa",1,"sortable",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-2","paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","etiquetas-impresion",4,"ngIf"],[3,"value"],[1,"bi","bi-printer"],[1,"sort"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"etiquetas-impresion"],[1,"print-root"],["class","sheet",3,"width","height",4,"ngFor","ngForOf"],[1,"sheet"],[1,"label-inner"],[4,"ngFor","ngForOf"],[1,"el",3,"ngStyle"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","barcode",4,"ngSwitchCase"],[1,"barcode"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"h2",2),d(2,"Impresi\xF3n de etiquetas"),s(),l(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Farmacia"),s(),l(8,"div")(9,"select",7),ee("ngModelChange",function(a){return Z(n.farmaciaId,a)||(n.farmaciaId=a),a}),w("change",function(){return n.onFarmaciaChange()}),l(10,"option",8),d(11,"\u2014 Selecciona \u2014"),s(),N(12,P6,2,2,"option",9),s()()(),l(13,"div",5)(14,"label",6),d(15,"Dise\xF1o"),s(),l(16,"div")(17,"select",10),ee("ngModelChange",function(a){return Z(n.designId,a)||(n.designId=a),a}),w("change",function(){return n.loadDesign()}),N(18,k6,2,2,"option",9),s()()(),l(19,"div",11)(20,"label",6),d(21,"Nombre"),s(),l(22,"div")(23,"input",12),ee("ngModelChange",function(a){return Z(n.fNombre,a)||(n.fNombre=a),a}),w("keyup.enter",function(){return n.buscar()}),s()()(),l(24,"div",11)(25,"label",6),d(26,"Categor\xEDa"),s(),l(27,"div")(28,"input",13),ee("ngModelChange",function(a){return Z(n.fCategoria,a)||(n.fCategoria=a),a}),w("keyup.enter",function(){return n.buscar()}),s()()(),l(29,"div",14)(30,"label",6),d(31,"x p\xE1g.:"),s(),l(32,"div")(33,"select",15),w("ngModelChange",function(a){return n.cambiarLimit(a)}),l(34,"option",16),d(35,"10"),s(),l(36,"option",16),d(37,"20"),s(),l(38,"option",16),d(39,"50"),s(),l(40,"option",16),d(41,"100"),s()()()(),l(42,"div",17)(43,"button",18),w("click",function(){return n.limpiar()}),y(44,"i",19),s()()(),l(45,"div",20)(46,"div",21)(47,"button",22),w("click",function(){return n.previsualizar()}),N(48,I6,2,0,"span",23)(49,M6,2,0,"span",23),s()(),l(50,"div",24)(51,"button",25),w("click",function(){return n.buscar()}),d(52,"Buscar"),s()()()(),l(53,"table",26)(54,"thead")(55,"tr")(56,"th")(57,"input",27),w("change",function(a){return n.toggleAll(a)}),s()(),l(58,"th",28),w("click",function(){return n.toggleSort("nombre")}),d(59," Nombre "),N(60,F6,2,1,"span",29),s(),l(61,"th"),d(62,"C\xF3digo barras"),s(),l(63,"th"),d(64,"Rengl\xF3n 1"),s(),l(65,"th"),d(66,"Rengl\xF3n 2"),s(),l(67,"th",30),w("click",function(){return n.toggleSort("categoria")}),d(68," Categor\xEDa "),N(69,A6,2,1,"span",29),s(),l(70,"th"),d(71,"Precio"),s(),l(72,"th"),d(73,"Exist."),s()()(),l(74,"tbody"),N(75,O6,18,10,"tr",31),s()()(),l(76,"div",32)(77,"span")(78,"b"),d(79,"Etiquetas a imprimir:"),s(),d(80),s()(),l(81,"div",32)(82,"button",33),w("click",function(){return n.irPrimera()}),y(83,"i",34),s(),l(84,"button",35),w("click",function(){return n.irAnterior()}),y(85,"i",36),s(),l(86,"span"),d(87),s(),l(88,"button",37),w("click",function(){return n.irSiguiente()}),y(89,"i",38),s(),l(90,"button",39),w("click",function(){return n.irUltima()}),y(91,"i",40),s()(),N(92,V6,4,1,"div",41)),e&2&&(c(9),J("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(5),J("ngModel",n.designId),p("disabled",!n.farmaciaId||!(n.disenos&&n.disenos.length)),c(),p("ngForOf",n.disenos),c(5),J("ngModel",n.fNombre),p("disabled",!n.farmaciaId),c(5),J("ngModel",n.fCategoria),p("disabled",!n.farmaciaId),c(5),p("ngModel",n.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100),c(7),p("disabled",!n.farmaciaId||n.seleccionados.length===0||!n.design||n.isPrinting),c(),p("ngIf",!n.isPrinting),c(),p("ngIf",n.isPrinting),c(2),p("disabled",!n.farmaciaId),c(6),p("checked",n.allChecked),c(3),p("ngIf",n.sortBy==="nombre"),c(9),p("ngIf",n.sortBy==="categoria"),c(6),p("ngForOf",n.productos)("ngForTrackBy",n.trackById),c(5),R(" ",n.totalSeleccionados,""),c(2),p("disabled",n.page<=1),c(2),p("disabled",n.page<=1),c(3),yn("\xA0 ",n.totalFiltrado," productos. P\xE1gina ",n.page," / ",n.totalPages," \xA0"),c(),p("disabled",n.page>=n.totalPages),c(2),p("disabled",n.page>=n.totalPages),c(2),p("ngIf",n.mostrarPrint))},dependencies:[ot,rt,at,qe,li,nt,ze,_t,Oe,We,Ne,Ia,Us,js,Bt,Tc,Vt,dt],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.btn-icon-only[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;padding:0;display:inline-flex;align-items:center;justify-content:center;border-radius:.5rem}.btn-icon-only[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.sortable[_ngcontent-%COMP%]:hover{text-decoration:underline}.sort[_ngcontent-%COMP%]{margin-left:6px;font-size:.85em;opacity:.7}.barra[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:6px}.etiquetas-impresion[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;z-index:9999}.page[_ngcontent-%COMP%]{margin:0 auto;position:relative}.labels-grid[_ngcontent-%COMP%]{display:grid}.label-box[_ngcontent-%COMP%]{background:#fff;border:1px dashed transparent;position:relative}.print-root[_ngcontent-%COMP%]{width:62mm}.sheet[_ngcontent-%COMP%]{position:relative;margin:0;padding:0}.label-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}.el[_ngcontent-%COMP%]{position:absolute}img.barcode[_ngcontent-%COMP%]{display:block}@media print{body[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden!important}.etiquetas-impresion[_ngcontent-%COMP%], .etiquetas-impresion[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:visible!important}.etiquetas-impresion[_ngcontent-%COMP%]{position:static!important;margin:0!important;padding:0!important;inset:auto!important;z-index:auto!important;background:#fff!important;display:block!important}.sheet[_ngcontent-%COMP%]{margin:0!important;padding:0!important;page-break-after:always;break-after:page;page-break-inside:avoid;break-inside:avoid;overflow:hidden!important;position:relative}.sheet[_ngcontent-%COMP%]:last-child{page-break-after:auto;break-after:auto}svg[_ngcontent-%COMP%], img.barcode[_ngcontent-%COMP%]{display:block!important;max-width:100%!important;max-height:100%!important}}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}.page[_ngcontent-%COMP%]{width:100%;height:100%}img[_ngcontent-%COMP%]{image-rendering:auto}"]})};var Hn=hi(ki());var Hc=class i{constructor(t){this.http=t}api=He.apiUrl;getPresupuesto(t){let e=new Ht().set("fechaIni",t.fechaIni).set("fechaFin",t.fechaFin);t.categoria&&(e=e.set("categoria",t.categoria)),t.nombre&&(e=e.set("nombre",t.nombre)),t.soloExistMenorQueVentas!==void 0&&(e=e.set("soloExistMenorQueVentas",String(t.soloExistMenorQueVentas))),t.sortBy&&(e=e.set("sortBy",t.sortBy)),t.sortDir&&(e=e.set("sortDir",t.sortDir)),t.page&&(e=e.set("page",String(t.page))),t.limit&&(e=e.set("limit",String(t.limit)));let n=new Qe({});return this.http.get(`${this.api}/reportes/presupuesto`,{params:e,headers:n})}grabar(t){let e=new Qe({});return this.http.post(`${this.api}/reportes/presupuesto/grabar`,{items:t},{headers:e})}static \u0275fac=function(e){return new(e||i)(lt(ct))};static \u0275prov=tt({token:i,factory:i.\u0275fac,providedIn:"root"})};var j6=()=>({standalone:!0});function W6(i,t){if(i&1){let e=ae();l(0,"button",61),w("click",function(){P(e);let r=_();return k(r.limpiarNombre())}),y(1,"fa-icon",62),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function H6(i,t){if(i&1){let e=ae();l(0,"button",63),w("click",function(){P(e);let r=_();return k(r.limpiarCategoria())}),y(1,"fa-icon",62),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function $6(i,t){if(i&1){let e=ae();l(0,"tr")(1,"td")(2,"input",64),ee("ngModelChange",function(r){let a=P(e).$implicit;return Z(a.grabar,r)||(a.grabar=r),k(r)}),w("ngModelChange",function(){P(e);let r=_();return k(r.onRowCheckChange())}),s()(),l(3,"td",65),d(4),s(),l(5,"td",66),d(6),s(),l(7,"td",65),d(8),s(),l(9,"td",67),d(10),s(),l(11,"td",67),d(12),s(),l(13,"td",67),d(14),s(),l(15,"td",68),d(16),s(),l(17,"td",67),d(18),s(),l(19,"td",67),d(20),s(),l(21,"td",67),d(22),s()()}if(i&2){let e=t.$implicit,n=_();c(2),J("ngModel",e.grabar),p("ngModelOptions",Jt(18,j6)),c(),v0("title",e.producto),c(),T(e.producto),c(2),T(e.codigoBarras),c(),v0("title",e.categoria),c(),T(e.categoria),c(2),T(n.fmtNumber(e.existencia)),c(2),T(n.fmtNumber(e.stockMax)),c(2),T(n.fmtNumber(e.stockMin)),c(2),T(n.fmtNumber(e.vendidosSMaxE)),c(2),T(n.fmtNumber(e.sMinE)),c(),Be("text-danger",e.comprar>0)("fw-semibold",e.comprar>0),c(),R(" ",n.fmtNumber(e.comprar)," "),c(2),T(n.fmtMoney(e.costoEst))}}function z6(i,t){i&1&&(l(0,"tr")(1,"td",69),d(2,"Sin resultados"),s()())}var $c=class i{constructor(t){this.svc=t}faTimes=vi;get totalPages(){return Math.max(Math.ceil(this.totalRows/this.limit),1)}isFirstPage(){return this.page===1}isLastPage(){return this.page>=this.totalPages}allRows=[];filteredAll=[];get filteredCount(){return this.filteredAll.length}fechaIni="";fechaFin="";categoria="";nombre="";soloExistMenorQueVentas=!1;rows=[];totalRows=0;totalCostoEst=0;page=1;limit=20;sortBy="nombre";sortDir="asc";cargando=!1;seleccionarTodos=!1;get selectedCount(){return this.allRows.reduce((t,e)=>t+(e.grabar?1:0),0)}ngOnInit(){this.setFechasPorDefecto()}limpiarCategoria(){this.categoria="",this.onFiltroChange()}limpiarNombre(){this.nombre="",this.onFiltroChange()}toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(t)}ordenarPor(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.applyClientView()}cambiarPagina(t){let e=this.totalPages,n=this.page+t;n<1&&(n=1),n>e&&(n=e),n!==this.page&&(this.page=n,this.applyClientView())}irAPagina(t){let e=this.totalPages;t>=1&&t<=e&&(this.page=t,this.applyClientView())}cambiarLimit(t){this.limit=t,this.applyClientView(!0)}onFiltroChange(){this.applyClientView(!0)}toggleSeleccionTodos(){for(let t of this.filteredAll)t.grabar=this.seleccionarTodos;this.rows=[...this.rows]}onRowCheckChange(){this.recalcSeleccionTodos()}showLoader(t="Buscando..."){Hn.default.fire({title:t,text:"Contando ventas de los productos, calculando stocks",allowOutsideClick:!1,didOpen:()=>Hn.default.showLoading()})}closeLoader(){Hn.default.isVisible()&&Hn.default.close()}buscar(t=!1){return Ae(this,null,function*(){if(!this.cargando){if(!this.fechaIni||!this.fechaFin){yield Hn.default.fire("Fechas requeridas","Debes elegir fecha inicial y final","info");return}t&&(this.page=1),this.cargando=!0,this.showLoader("Buscando...");try{let e=yield gi(this.svc.getPresupuesto({fechaIni:this.fechaIni,fechaFin:this.fechaFin,page:1,limit:1e5}));this.allRows=(e?.rows||[]).map(n=>Wt(Ke({},n),{grabar:n.grabar??!1})),this.applyClientView(!0),this.seleccionarTodos=!1}catch(e){console.error(e),yield Hn.default.fire("Error",e?.error?.mensaje||"No se pudo cargar el reporte","error")}finally{this.closeLoader(),this.cargando=!1}}})}recalcSeleccionTodos(){this.seleccionarTodos=this.filteredAll.length>0&&this.filteredAll.every(t=>!!t.grabar)}applyClientView(t=!1){t&&(this.page=1);let e=x=>(x||"").toLowerCase().trim(),n=x=>e(x).split(/\s+/).filter(Boolean),r=n(this.nombre),a=n(this.categoria),o=this.allRows.filter(x=>{let b=r.every(E=>x.producto?.toLowerCase().includes(E)),S=a.every(E=>x.categoria?.toLowerCase().includes(E)),v=!this.soloExistMenorQueVentas||(x.existencia??0)<(x.vendidosSMaxE??0);return b&&S&&v});this.filteredAll=o;let u=this.sortDir==="asc"?1:-1,m=x=>String(x??"").toLowerCase(),f=x=>Number.isFinite(x)?Number(x):0;o=[...o].sort((x,b)=>{switch(this.sortBy){case"nombre":return u*(m(x.producto)>m(b.producto)?1:-1);case"categoria":return u*(m(x.categoria)>m(b.categoria)?1:-1);case"existencia":return u*(f(x.existencia)-f(b.existencia));case"vendidos":return u*(f(x.vendidosSMaxE)-f(b.vendidosSMaxE));default:return 0}}),this.totalCostoEst=o.reduce((x,b)=>x+(b.costoEst??0),0),this.totalRows=o.length;let h=(this.page-1)*this.limit,g=h+this.limit;this.rows=o.slice(h,g),this.recalcSeleccionTodos()}grabarSeleccionados(){return Ae(this,null,function*(){let t=this.allRows.filter(n=>n.grabar).map(n=>({productoId:n._id,vendidosSMaxE:n.vendidosSMaxE}));if(t.length===0){yield Hn.default.fire("Aviso","No hay renglones marcados para grabar","info");return}if((yield Hn.default.fire({icon:"question",title:"Confirmar actualizaci\xF3n",html:`
      Se actualizar\xE1 <b>stockM\xE1ximo = Vendidos SMaxE</b> y 
      <b>stockM\xEDnimo = ceil(30% de stockM\xE1ximo)</b> en ${t.length} productos.
      <br><br>\xBFDeseas continuar?
    `,showCancelButton:!0,confirmButtonText:"S\xED, actualizar",cancelButtonText:"Cancelar"})).isConfirmed){this.showLoader("Aplicando cambios...");try{let n=yield gi(this.svc.grabar(t));yield Hn.default.fire("Listo",`Productos modificados: ${n?.modified??0}`,"success"),this.buscar(!1)}catch(n){console.error(n),yield Hn.default.fire("Error",n?.error?.mensaje||"No se pudo grabar","error")}finally{this.closeLoader()}}})}fmtNumber(t){return(t??0).toLocaleString("es-MX")}fmtMoney(t){return(t??0).toLocaleString("es-MX",{style:"currency",currency:"MXN",maximumFractionDigits:2})}exportarExcel(){let t=this.filteredAll.map(h=>({Producto:h.producto,"Cod. Barras":h.codigoBarras,Categor\u00EDa:h.categoria,Existencia:h.existencia??0,"Stock M\xE1x":h.stockMax??0,"Stock M\xEDn":h.stockMin??0,"Vendidos StockMax":h.vendidosSMaxE??0,"StockMin (30%)":h.sMinE??0,Comprar:h.comprar??0,"Costo Estimado":Number((h.costoEst??0).toFixed(2))})),e=nn.json_to_sheet(t,{header:["Producto","Cod. Barras","Categor\xEDa","Existencia","Stock M\xE1x","Stock M\xEDn","Vendidos StockMax","StockMin (30%)","Comprar","Costo Estimado"],skipHeader:!1});e["!cols"]=[{wch:40},{wch:14},{wch:18},{wch:12},{wch:12},{wch:12},{wch:16},{wch:14},{wch:12},{wch:16}];let n=t.length,r=this.filteredAll.reduce((h,g)=>h+(g.costoEst??0),0);nn.sheet_add_aoa(e,[["","","","","","","","","TOTAL Costo Est.:",Number(r.toFixed(2))]],{origin:-1});let a=2,o=a+n-1;for(let h=a;h<=o+1;h++){let g=nn.encode_cell({c:9,r:h-1}),x=e[g];x&&typeof x.v=="number"&&(x.z="#,##0.00")}let u=nn.book_new();nn.book_append_sheet(u,e,"Presupuesto");let m=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),f=`presupuesto_${this.fechaIni}_a_${this.fechaFin}_${m}.xlsx`;Zl(u,f)}static \u0275fac=function(e){return new(e||i)(ie(Hc))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-presupuesto"]],decls:128,vars:35,consts:[[1,"titulo",2,"text-align","center"],[1,"card-body"],[1,"row","mb-1",3,"ngSubmit"],[1,"col-sm-2"],[1,"form-label"],["type","date","name","fechaIni","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-sm-3"],[1,"form-label",2,"white-space","nowrap"],[1,"position-relative"],["type","text","name","nombre",1,"form-control",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar nombre","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["type","text","name","categoria",1,"form-control",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar categor\xEDa","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-sm-2","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","name","soloExistMenorQueVentas",1,"form-check-input",3,"ngModelChange","ngModel"],["for","chkExist",1,"form-check-label"],[1,"col-sm-2","mt-2"],["name","limit",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"col-sm-10","d-flex","align-items-end","justify-content-end","mt-2"],["type","submit","matTooltip","Calcular y contar las ventas del periodo Fecha Inicial y Fecha Final",1,"btn-gris",3,"disabled"],[1,"d-flex","justify-content-between","align-items-center","mb-2","acciones-container"],["type","checkbox","id","chkTodos",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","chkTodos",1,"form-check-label"],[1,"d-flex","gap-2"],[1,"btn-amarillo",3,"click","disabled"],["matTooltip","Grabar nuevos stocks m\xEDn y m\xE1x, de los productos seleccionados",1,"btn-verde",3,"click","disabled"],[1,"table-responsive"],[1,"tabla"],[1,"col-grab"],[1,"col-prod"],[1,"col-cb"],[1,"col-cat"],[1,"col-n1"],[1,"col-num"],["matTooltip","Grabar stocks M\xE1x y M\xEDn estimados"],[1,"sortable",3,"click"],["matTooltip","Existencia en almac\xE9n",1,"sortable","text-end",3,"click"],["matTooltip","stock M\xE1x actual en almac\xE9n",1,"text-end"],["matTooltip","stock M\xEDn actual en almac\xE9n",1,"text-end"],["matTooltip","Productos vendidos, stock M\xE1x estimado.",1,"sortable","text-end",3,"click"],["matTooltip","Stock M\xEDn estimado",1,"text-end"],["matTooltip","# productos requeridos p/alcanzar stock M\xE1x estimado",1,"text-end"],["matTooltip","Costo estimado",1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","10",1,"text-end"],[1,"text-end"],[1,"d-flex","justify-content-between","align-items-center","mt-2","paginacion"],[1,"btn-group"],["matTooltip","Inicio",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"btn","btn-outline-secondary","btn-sm"],["matTooltip","Siguiente",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["type","button","matTooltip","Limpiar nombre",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],["type","button","matTooltip","Limpiar categor\xEDa",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"truncate",3,"title"],[1,"mono"],[1,"text-end","nowrap"],[1,"text-end","nowrap","fw-semibold"],["colspan","11",1,"text-center","text-muted","py-3"]],template:function(e,n){e&1&&(l(0,"h3",0),d(1,"Reporte de Presupuesto"),s(),l(2,"div",1)(3,"form",2),w("ngSubmit",function(){return n.buscar(!0)}),l(4,"div",3)(5,"label",4),d(6,"Fecha inicial *"),s(),l(7,"input",5),ee("ngModelChange",function(a){return Z(n.fechaIni,a)||(n.fechaIni=a),a}),s()(),l(8,"div",3)(9,"label",4),d(10,"Fecha final *"),s(),l(11,"input",6),ee("ngModelChange",function(a){return Z(n.fechaFin,a)||(n.fechaFin=a),a}),s()(),l(12,"div",7)(13,"label",8),d(14,"Nombre"),s(),l(15,"div",9)(16,"input",10),ee("ngModelChange",function(a){return Z(n.nombre,a)||(n.nombre=a),a}),w("ngModelChange",function(){return n.onFiltroChange()}),s(),N(17,W6,2,1,"button",11),s()(),l(18,"div",7)(19,"label",8),d(20,"Categor\xEDa"),s(),l(21,"div",9)(22,"input",12),ee("ngModelChange",function(a){return Z(n.categoria,a)||(n.categoria=a),a}),w("ngModelChange",function(){return n.onFiltroChange()}),s(),N(23,H6,2,1,"button",13),s()(),l(24,"div",14)(25,"div",15)(26,"input",16),ee("ngModelChange",function(a){return Z(n.soloExistMenorQueVentas,a)||(n.soloExistMenorQueVentas=a),a}),w("ngModelChange",function(){return n.onFiltroChange()}),s(),l(27,"label",17),d(28," Existencia < Vendidos "),s()()(),l(29,"div",18)(30,"label",4),d(31,"Registros por p\xE1gina"),s(),l(32,"select",19),w("ngModelChange",function(a){return n.cambiarLimit(a)}),l(33,"option",20),d(34,"10"),s(),l(35,"option",20),d(36,"20"),s(),l(37,"option",20),d(38,"50"),s(),l(39,"option",20),d(40,"100"),s()()(),l(41,"div",21)(42,"button",22),d(43),s()()(),l(44,"div",23)(45,"div",15)(46,"input",24),ee("ngModelChange",function(a){return Z(n.seleccionarTodos,a)||(n.seleccionarTodos=a),a}),w("change",function(){return n.toggleSeleccionTodos()}),s(),l(47,"label",25),d(48," Seleccionar todos (Grabar stocks) "),s()(),l(49,"div",26)(50,"button",27),w("click",function(){return n.exportarExcel()}),d(51," Exportar a Excel "),s(),l(52,"button",28),w("click",function(){return n.grabarSeleccionados()}),d(53," Grabar seleccionados "),s()()(),l(54,"div",29)(55,"table",30)(56,"colgroup"),y(57,"col",31)(58,"col",32)(59,"col",33)(60,"col",34)(61,"col",35)(62,"col",35)(63,"col",35)(64,"col",36)(65,"col",36)(66,"col",35)(67,"col",36),s(),l(68,"thead")(69,"tr")(70,"th",37),d(71,"Gr"),s(),l(72,"th",38),w("click",function(){return n.ordenarPor("nombre")}),d(73,"Producto "),l(74,"span"),d(75,"\u25B2\u25BC"),s()(),l(76,"th"),d(77,"Cod. Barras"),s(),l(78,"th",38),w("click",function(){return n.ordenarPor("categoria")}),d(79,"Categor\xEDa "),l(80,"span"),d(81,"\u25B2\u25BC"),s()(),l(82,"th",39),w("click",function(){return n.ordenarPor("existencia")}),d(83,"Ex. "),l(84,"span"),d(85,"\u25B2\u25BC"),s()(),l(86,"th",40),d(87,"S M\xE1x"),s(),l(88,"th",41),d(89,"S M\xEDn"),s(),l(90,"th",42),w("click",function(){return n.ordenarPor("vendidos")}),d(91,"Vend. "),l(92,"span"),d(93,"\u25B2\u25BC"),s()(),l(94,"th",43),d(95,"Stk M\xEDn Es"),s(),l(96,"th",44),d(97,"Comp."),s(),l(98,"th",45),d(99,"Costo Est"),s()()(),l(100,"tbody"),N(101,$6,23,19,"tr",46)(102,z6,3,0,"tr",47),s(),l(103,"tfoot")(104,"tr")(105,"td",48)(106,"b"),d(107,"Total Costo Est. (todas las filas filtradas):"),s()(),l(108,"td",49)(109,"b"),d(110),s()()()()()(),l(111,"div",50)(112,"div"),d(113," Total: "),l(114,"b"),d(115),s(),d(116," productos "),s(),l(117,"div",51)(118,"button",52),w("click",function(){return n.irAPagina(1)}),y(119,"i",53),s(),l(120,"button",54),w("click",function(){return n.cambiarPagina(-1)}),y(121,"i",55),s(),l(122,"button",56),d(123),s(),l(124,"button",57),w("click",function(){return n.cambiarPagina(1)}),y(125,"i",58),s(),l(126,"button",59),w("click",function(){return n.irAPagina(n.totalPages)}),y(127,"i",60),s()()()()),e&2&&(c(7),J("ngModel",n.fechaIni),c(4),J("ngModel",n.fechaFin),c(5),J("ngModel",n.nombre),c(),p("ngIf",n.nombre),c(5),J("ngModel",n.categoria),c(),p("ngIf",n.categoria),c(3),J("ngModel",n.soloExistMenorQueVentas),c(6),p("ngModel",n.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Contando y Calculando...":"Calcular ventas"," "),c(3),J("ngModel",n.seleccionarTodos),c(4),p("disabled",n.filteredCount===0),c(2),p("disabled",n.cargando||n.selectedCount===0),c(22),Be("active",n.sortBy==="nombre"),c(6),Be("active",n.sortBy==="categoria"),c(4),Be("active",n.sortBy==="existencia"),c(8),Be("active",n.sortBy==="vendidos"),c(9),p("ngForOf",n.rows),c(),p("ngIf",n.rows.length===0&&!n.cargando),c(8),T(n.fmtMoney(n.totalCostoEst)),c(5),T(n.totalRows),c(3),p("disabled",n.isFirstPage()),c(2),p("disabled",n.isFirstPage()),c(3),un(" P\xE1gina ",n.page," de ",n.totalPages," "),c(),p("disabled",n.isLastPage()),c(2),p("disabled",n.isLastPage()))},dependencies:[Oe,We,Ne,ot,At,rt,at,qe,li,nt,ze,Ft,Fa,_t,Tr,Vt,dt,ti,ei],styles:[".card[_ngcontent-%COMP%]{border-radius:14px;box-shadow:0 4px 16px #0000000d}.card-header[_ngcontent-%COMP%]{background:#f8f9fa;border-bottom:1px solid #eee}.sortable[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3;margin-left:6px;font-size:11px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.acciones-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;table-layout:fixed}.col-grab[_ngcontent-%COMP%]{width:4%}.col-prod[_ngcontent-%COMP%]{width:auto}.col-cb[_ngcontent-%COMP%], .col-cat[_ngcontent-%COMP%]{width:10%}.col-n1[_ngcontent-%COMP%]{width:5%}.col-num[_ngcontent-%COMP%]{width:7%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.5rem .6rem}.nowrap[_ngcontent-%COMP%]{white-space:nowrap}.mono[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.sortable[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.45;margin-left:6px;font-size:11px}.sortable[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}@media (max-width: 1200px){.col-prod[_ngcontent-%COMP%]{width:26rem}.col-cat[_ngcontent-%COMP%]{width:12rem}}@media (max-width: 992px){.col-prod[_ngcontent-%COMP%]{width:20rem}.col-cat[_ngcontent-%COMP%], .col-cb[_ngcontent-%COMP%]{width:10rem}}@media (max-width: 768px){.col-prod[_ngcontent-%COMP%]{width:16rem}.col-cat[_ngcontent-%COMP%], .col-cb[_ngcontent-%COMP%]{width:9rem}.col-num[_ngcontent-%COMP%]{width:7rem}}"]})};var L_=[{path:"",component:dc,children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:ll},{path:"ventas",component:hl,canActivate:[Qi],data:{rolesPermitidos:["admin","empleado"]}},{path:"pedidos",component:gl,canActivate:[Qi],data:{rolesPermitidos:["admin","empleado"]}},{path:"devoluciones",component:xl,canActivate:[Qi],data:{rolesPermitidos:["admin","empleado"]}},{path:"inicio-turno",component:yl,canActivate:[Qi],data:{rolesPermitidos:["admin","empleado"]}},{path:"surtir-farmacia",component:tc,canActivate:[Qi],data:{rolesPermitidos:["admin"]}},{path:"compras",component:nc,canActivate:[Qi],data:{rolesPermitidos:["admin"]}},{path:"ajustes-inventario",component:sc,canActivate:[Qi],data:{rolesPermitidos:["admin"]}},{path:"farmacias",loadComponent:()=>import("./chunk-NTJMYBTZ.js").then(i=>i.FarmaciasComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"inventario-farmacias",loadComponent:()=>import("./chunk-OPU2PTGS.js").then(i=>i.AjustesInventarioFarmaciaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"usuarios",loadComponent:()=>import("./chunk-JAAHTJKQ.js").then(i=>i.UsuariosComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"clientes",loadComponent:()=>import("./chunk-6FHD7VFF.js").then(i=>i.ClientesComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"proveedores",loadComponent:()=>import("./chunk-LU5OROQS.js").then(i=>i.ProveedoresComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"cortes-de-caja",loadComponent:()=>import("./chunk-YTDIZESO.js").then(i=>i.CortesDeCajaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Qi]},{path:"reporte/ventas-por-farmacia",component:uc},{path:"reporte/ventas-producto",component:mc},{path:"reporte/ventas",component:pc},{path:"reporte/pedidos",component:fc},{path:"reporte/resumen-utilidades",component:hc},{path:"reporte/utilidades",component:gc},{path:"reporte/compras",component:_c},{path:"reporte-presupuesto",component:$c},{path:"reportes/devoluciones",loadComponent:()=>import("./chunk-FE2NLWU3.js").then(i=>i.DevolucionesPageComponent),resolve:{cat:jg}},{path:"reportes-compras",loadComponent:()=>import("./chunk-D37U4PI5.js").then(i=>i.ComprasPageComponent)},{path:"reportes/compras-historial-producto",component:xc},{path:"reportes/cancelaciones",loadComponent:()=>import("./chunk-AJDNTCBA.js").then(i=>i.CancelacionesPageComponent)},{path:"reportes/compras-ventas",component:yc},{path:"etiquetas/print",component:Wc},{path:"etiquetas/design",component:Uc}]},{path:"login",component:Ua}];function V_(i){return new mt(3e3,!1)}function G6(){return new mt(3100,!1)}function q6(){return new mt(3101,!1)}function X6(i){return new mt(3001,!1)}function K6(i){return new mt(3003,!1)}function Y6(i){return new mt(3004,!1)}function j_(i,t){return new mt(3005,!1)}function W_(){return new mt(3006,!1)}function H_(){return new mt(3007,!1)}function $_(i,t){return new mt(3008,!1)}function z_(i){return new mt(3002,!1)}function G_(i,t,e,n,r){return new mt(3010,!1)}function q_(){return new mt(3011,!1)}function X_(){return new mt(3012,!1)}function K_(){return new mt(3200,!1)}function Y_(){return new mt(3202,!1)}function Q_(){return new mt(3013,!1)}function J_(i){return new mt(3014,!1)}function Z_(i){return new mt(3015,!1)}function ev(i){return new mt(3016,!1)}function tv(i,t){return new mt(3404,!1)}function Q6(i){return new mt(3502,!1)}function iv(i){return new mt(3503,!1)}function nv(){return new mt(3300,!1)}function rv(i){return new mt(3504,!1)}function av(i){return new mt(3301,!1)}function ov(i,t){return new mt(3302,!1)}function sv(i){return new mt(3303,!1)}function lv(i,t){return new mt(3400,!1)}function cv(i){return new mt(3401,!1)}function dv(i){return new mt(3402,!1)}function uv(i,t){return new mt(3505,!1)}function Sr(i){switch(i.length){case 0:return new ir;case 1:return i[0];default:return new ia(i)}}function Nu(i,t,e=new Map,n=new Map){let r=[],a=[],o=-1,u=null;if(t.forEach(m=>{let f=m.get("offset"),h=f==o,g=h&&u||new Map;m.forEach((x,b)=>{let S=b,v=x;if(b!=="offset")switch(S=i.normalizePropertyName(S,r),v){case za:v=e.get(b);break;case wn:v=n.get(b);break;default:v=i.normalizeStyleValue(b,S,v,r);break}g.set(S,v)}),h||a.push(g),u=g,o=f}),r.length)throw Q6(r);return a}function zc(i,t,e,n){switch(t){case"start":i.onStart(()=>n(e&&Ou(e,"start",i)));break;case"done":i.onDone(()=>n(e&&Ou(e,"done",i)));break;case"destroy":i.onDestroy(()=>n(e&&Ou(e,"destroy",i)));break}}function Ou(i,t,e){let n=e.totalTime,r=!!e.disabled,a=Gc(i.element,i.triggerName,i.fromState,i.toState,t||i.phaseName,n??i.totalTime,r),o=i._data;return o!=null&&(a._data=o),a}function Gc(i,t,e,n,r="",a=0,o){return{element:i,triggerName:t,fromState:e,toState:n,phaseName:r,totalTime:a,disabled:!!o}}function on(i,t,e){let n=i.get(t);return n||i.set(t,n=e),n}function Bu(i){let t=i.indexOf(":"),e=i.substring(1,t),n=i.slice(t+1);return[e,n]}var J6=typeof document>"u"?null:document.documentElement;function qc(i){let t=i.parentNode||i.host||null;return t===J6?null:t}function Z6(i){return i.substring(1,6)=="ebkit"}var ba=null,U_=!1;function mv(i){ba||(ba=e8()||{},U_=ba.style?"WebkitAppearance"in ba.style:!1);let t=!0;return ba.style&&!Z6(i)&&(t=i in ba.style,!t&&U_&&(t="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in ba.style)),t}function e8(){return typeof document<"u"?document.body:null}function Lu(i,t){for(;t;){if(t===i)return!0;t=qc(t)}return!1}function Vu(i,t,e){if(e)return Array.from(i.querySelectorAll(t));let n=i.querySelector(t);return n?[n]:[]}var t8=1e3,Uu="{{",i8="}}",ju="ng-enter",Xc="ng-leave",Ss="ng-trigger",ws=".ng-trigger",Wu="ng-animating",Kc=".ng-animating";function cr(i){if(typeof i=="number")return i;let t=i.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:Du(parseFloat(t[1]),t[2])}function Du(i,t){switch(t){case"s":return i*t8;default:return i}}function Es(i,t,e){return i.hasOwnProperty("duration")?i:n8(i,t,e)}function n8(i,t,e){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,r,a=0,o="";if(typeof i=="string"){let u=i.match(n);if(u===null)return t.push(V_(i)),{duration:0,delay:0,easing:""};r=Du(parseFloat(u[1]),u[2]);let m=u[3];m!=null&&(a=Du(parseFloat(m),u[4]));let f=u[5];f&&(o=f)}else r=i;if(!e){let u=!1,m=t.length;r<0&&(t.push(G6()),u=!0),a<0&&(t.push(q6()),u=!0),u&&t.splice(m,0,V_(i))}return{duration:r,delay:a,easing:o}}function fv(i){return i.length?i[0]instanceof Map?i:i.map(t=>new Map(Object.entries(t))):[]}function $n(i,t,e){t.forEach((n,r)=>{let a=Yc(r);e&&!e.has(r)&&e.set(r,i.style[a]),i.style[a]=n})}function $r(i,t){t.forEach((e,n)=>{let r=Yc(n);i.style[r]=""})}function To(i){return Array.isArray(i)?i.length==1?i[0]:gp(i):i}function pv(i,t,e){let n=t.params||{},r=Hu(i);r.length&&r.forEach(a=>{n.hasOwnProperty(a)||e.push(X6(a))})}var Ru=new RegExp(`${Uu}\\s*(.+?)\\s*${i8}`,"g");function Hu(i){let t=[];if(typeof i=="string"){let e;for(;e=Ru.exec(i);)t.push(e[1]);Ru.lastIndex=0}return t}function Po(i,t,e){let n=`${i}`,r=n.replace(Ru,(a,o)=>{let u=t[o];return u==null&&(e.push(K6(o)),u=""),u.toString()});return r==n?i:r}var r8=/-+([a-z0-9])/g;function Yc(i){return i.replace(r8,(...t)=>t[1].toUpperCase())}function hv(i,t){return i===0||t===0}function gv(i,t,e){if(e.size&&t.length){let n=t[0],r=[];if(e.forEach((a,o)=>{n.has(o)||r.push(o),n.set(o,a)}),r.length)for(let a=1;a<t.length;a++){let o=t[a];r.forEach(u=>o.set(u,Qc(i,u)))}}return t}function sn(i,t,e){switch(t.type){case Ge.Trigger:return i.visitTrigger(t,e);case Ge.State:return i.visitState(t,e);case Ge.Transition:return i.visitTransition(t,e);case Ge.Sequence:return i.visitSequence(t,e);case Ge.Group:return i.visitGroup(t,e);case Ge.Animate:return i.visitAnimate(t,e);case Ge.Keyframes:return i.visitKeyframes(t,e);case Ge.Style:return i.visitStyle(t,e);case Ge.Reference:return i.visitReference(t,e);case Ge.AnimateChild:return i.visitAnimateChild(t,e);case Ge.AnimateRef:return i.visitAnimateRef(t,e);case Ge.Query:return i.visitQuery(t,e);case Ge.Stagger:return i.visitStagger(t,e);default:throw Y6(t.type)}}function Qc(i,t){return window.getComputedStyle(i)[t]}var om=(()=>{class i{validateStyleProperty(e){return mv(e)}containsElement(e,n){return Lu(e,n)}getParentElement(e){return qc(e)}query(e,n,r){return Vu(e,n,r)}computeStyle(e,n,r){return r||""}animate(e,n,r,a,o,u=[],m){return new ir(r,a)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=tt({token:i,factory:i.\u0275fac})}return i})(),Ca=class{static NOOP=new om},Sa=class{};var a8=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),i0=class extends Sa{normalizePropertyName(t,e){return Yc(t)}normalizeStyleValue(t,e,n,r){let a="",o=n.toString().trim();if(a8.has(e)&&n!==0&&n!=="0")if(typeof n=="number")a="px";else{let u=n.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&u[1].length==0&&r.push(j_(t,n))}return o+a}};var n0="*";function o8(i,t){let e=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>s8(n,e,t)):e.push(i),e}function s8(i,t,e){if(i[0]==":"){let m=l8(i,e);if(typeof m=="function"){t.push(m);return}i=m}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return e.push(Z_(i)),t;let r=n[1],a=n[2],o=n[3];t.push(_v(r,o));let u=r==n0&&o==n0;a[0]=="<"&&!u&&t.push(_v(o,r))}function l8(i,t){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,n)=>parseFloat(n)>parseFloat(e);case":decrement":return(e,n)=>parseFloat(n)<parseFloat(e);default:return t.push(ev(i)),"* => *"}}var Jc=new Set(["true","1"]),Zc=new Set(["false","0"]);function _v(i,t){let e=Jc.has(i)||Zc.has(i),n=Jc.has(t)||Zc.has(t);return(r,a)=>{let o=i==n0||i==r,u=t==n0||t==a;return!o&&e&&typeof r=="boolean"&&(o=r?Jc.has(i):Zc.has(i)),!u&&n&&typeof a=="boolean"&&(u=a?Jc.has(t):Zc.has(t)),o&&u}}var Pv=":self",c8=new RegExp(`s*${Pv}s*,?`,"g");function kv(i,t,e,n){return new Ku(i).build(t,e,n)}var vv="",Ku=class{_driver;constructor(t){this._driver=t}build(t,e,n){let r=new Yu(e);return this._resetContextStyleTimingState(r),sn(this,To(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector=vv,t.collectedStyles=new Map,t.collectedStyles.set(vv,new Map),t.currentTime=0}visitTrigger(t,e){let n=e.queryCount=0,r=e.depCount=0,a=[],o=[];return t.name.charAt(0)=="@"&&e.errors.push(W_()),t.definitions.forEach(u=>{if(this._resetContextStyleTimingState(e),u.type==Ge.State){let m=u,f=m.name;f.toString().split(/\s*,\s*/).forEach(h=>{m.name=h,a.push(this.visitState(m,e))}),m.name=f}else if(u.type==Ge.Transition){let m=this.visitTransition(u,e);n+=m.queryCount,r+=m.depCount,o.push(m)}else e.errors.push(H_())}),{type:Ge.Trigger,name:t.name,states:a,transitions:o,queryCount:n,depCount:r,options:null}}visitState(t,e){let n=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(n.containsDynamicStyles){let a=new Set,o=r||{};n.styles.forEach(u=>{u instanceof Map&&u.forEach(m=>{Hu(m).forEach(f=>{o.hasOwnProperty(f)||a.add(f)})})}),a.size&&e.errors.push($_(t.name,[...a.values()]))}return{type:Ge.State,name:t.name,style:n,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;let n=sn(this,To(t.animation),e),r=o8(t.expr,e.errors);return{type:Ge.Transition,matchers:r,animation:n,queryCount:e.queryCount,depCount:e.depCount,options:ya(t.options)}}visitSequence(t,e){return{type:Ge.Sequence,steps:t.steps.map(n=>sn(this,n,e)),options:ya(t.options)}}visitGroup(t,e){let n=e.currentTime,r=0,a=t.steps.map(o=>{e.currentTime=n;let u=sn(this,o,e);return r=Math.max(r,e.currentTime),u});return e.currentTime=r,{type:Ge.Group,steps:a,options:ya(t.options)}}visitAnimate(t,e){let n=f8(t.timings,e.errors);e.currentAnimateTimings=n;let r,a=t.styles?t.styles:mn({});if(a.type==Ge.Keyframes)r=this.visitKeyframes(a,e);else{let o=t.styles,u=!1;if(!o){u=!0;let f={};n.easing&&(f.easing=n.easing),o=mn(f)}e.currentTime+=n.duration+n.delay;let m=this.visitStyle(o,e);m.isEmptyStep=u,r=m}return e.currentAnimateTimings=null,{type:Ge.Animate,timings:n,style:r,options:null}}visitStyle(t,e){let n=this._makeStyleAst(t,e);return this._validateStyleAst(n,e),n}_makeStyleAst(t,e){let n=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let u of r)typeof u=="string"?u===wn?n.push(u):e.errors.push(z_(u)):n.push(new Map(Object.entries(u)));let a=!1,o=null;return n.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(o=u.get("easing"),u.delete("easing")),!a)){for(let m of u.values())if(m.toString().indexOf(Uu)>=0){a=!0;break}}}),{type:Ge.Style,styles:n,easing:o,offset:t.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(t,e){let n=e.currentAnimateTimings,r=e.currentTime,a=e.currentTime;n&&a>0&&(a-=n.duration+n.delay),t.styles.forEach(o=>{typeof o!="string"&&o.forEach((u,m)=>{let f=e.collectedStyles.get(e.currentQuerySelector),h=f.get(m),g=!0;h&&(a!=r&&a>=h.startTime&&r<=h.endTime&&(e.errors.push(G_(m,h.startTime,h.endTime,a,r)),g=!1),a=h.startTime),g&&f.set(m,{startTime:a,endTime:r}),e.options&&pv(u,e.options,e.errors)})})}visitKeyframes(t,e){let n={type:Ge.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(q_()),n;let r=1,a=0,o=[],u=!1,m=!1,f=0,h=t.steps.map(j=>{let U=this._makeStyleAst(j,e),H=U.offset!=null?U.offset:m8(U.styles),Y=0;return H!=null&&(a++,Y=U.offset=H),m=m||Y<0||Y>1,u=u||Y<f,f=Y,o.push(Y),U});m&&e.errors.push(X_()),u&&e.errors.push(K_());let g=t.steps.length,x=0;a>0&&a<g?e.errors.push(Y_()):a==0&&(x=r/(g-1));let b=g-1,S=e.currentTime,v=e.currentAnimateTimings,E=v.duration;return h.forEach((j,U)=>{let H=x>0?U==b?1:x*U:o[U],Y=H*E;e.currentTime=S+v.delay+Y,v.duration=Y,this._validateStyleAst(j,e),j.offset=H,n.styles.push(j)}),n}visitReference(t,e){return{type:Ge.Reference,animation:sn(this,To(t.animation),e),options:ya(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:Ge.AnimateChild,options:ya(t.options)}}visitAnimateRef(t,e){return{type:Ge.AnimateRef,animation:this.visitReference(t.animation,e),options:ya(t.options)}}visitQuery(t,e){let n=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;let[a,o]=d8(t.selector);e.currentQuerySelector=n.length?n+" "+a:a,on(e.collectedStyles,e.currentQuerySelector,new Map);let u=sn(this,To(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=n,{type:Ge.Query,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:u,originalSelector:t.selector,options:ya(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(Q_());let n=t.timings==="full"?{duration:0,delay:0,easing:"full"}:Es(t.timings,e.errors,!0);return{type:Ge.Stagger,animation:sn(this,To(t.animation),e),timings:n,options:null}}};function d8(i){let t=!!i.split(/\s*,\s*/).find(e=>e==Pv);return t&&(i=i.replace(c8,"")),i=i.replace(/@\*/g,ws).replace(/@\w+/g,e=>ws+"-"+e.slice(1)).replace(/:animating/g,Kc),[i,t]}function u8(i){return i?Ke({},i):null}var Yu=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(t){this.errors=t}};function m8(i){if(typeof i=="string")return null;let t=null;if(Array.isArray(i))i.forEach(e=>{if(e instanceof Map&&e.has("offset")){let n=e;t=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let e=i;t=parseFloat(e.get("offset")),e.delete("offset")}return t}function f8(i,t){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let a=Es(i,t).duration;return $u(a,0,"")}let e=i;if(e.split(/\s+/).some(a=>a.charAt(0)=="{"&&a.charAt(1)=="{")){let a=$u(0,0,"");return a.dynamic=!0,a.strValue=e,a}let r=Es(e,t);return $u(r.duration,r.delay,r.easing)}function ya(i){return i?(i=Ke({},i),i.params&&(i.params=u8(i.params))):i={},i}function $u(i,t,e){return{duration:i,delay:t,easing:e}}function sm(i,t,e,n,r,a,o=null,u=!1){return{type:1,element:i,keyframes:t,preStyleProps:e,postStyleProps:n,duration:r,delay:a,totalTime:r+a,easing:o,subTimeline:u}}var Ps=class{_map=new Map;get(t){return this._map.get(t)||[]}append(t,e){let n=this._map.get(t);n||this._map.set(t,n=[]),n.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}},p8=1,h8=":enter",g8=new RegExp(h8,"g"),_8=":leave",v8=new RegExp(_8,"g");function Iv(i,t,e,n,r,a=new Map,o=new Map,u,m,f=[]){return new Qu().buildKeyframes(i,t,e,n,r,a,o,u,m,f)}var Qu=class{buildKeyframes(t,e,n,r,a,o,u,m,f,h=[]){f=f||new Ps;let g=new Ju(t,e,f,r,a,h,[]);g.options=m;let x=m.delay?cr(m.delay):0;g.currentTimeline.delayNextStep(x),g.currentTimeline.setStyles([o],null,g.errors,m),sn(this,n,g);let b=g.timelines.filter(S=>S.containsAnimation());if(b.length&&u.size){let S;for(let v=b.length-1;v>=0;v--){let E=b[v];if(E.element===e){S=E;break}}S&&!S.allowOnlyTimelineStyles()&&S.setStyles([u],null,g.errors,m)}return b.length?b.map(S=>S.buildKeyframes()):[sm(e,[],[],[],0,x,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){let n=e.subInstructions.get(e.element);if(n){let r=e.createSubContext(t.options),a=e.currentTimeline.currentTime,o=this._visitSubInstructions(n,r,r.options);a!=o&&e.transformIntoNewTimeline(o)}e.previousNode=t}visitAnimateRef(t,e){let n=e.createSubContext(t.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,n),this.visitReference(t.animation,n),e.transformIntoNewTimeline(n.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,n){for(let r of t){let a=r?.delay;if(a){let o=typeof a=="number"?a:cr(Po(a,r?.params??{},e.errors));n.delayNextStep(o)}}}_visitSubInstructions(t,e,n){let a=e.currentTimeline.currentTime,o=n.duration!=null?cr(n.duration):null,u=n.delay!=null?cr(n.delay):null;return o!==0&&t.forEach(m=>{let f=e.appendInstructionToTimeline(m,o,u);a=Math.max(a,f.duration+f.delay)}),a}visitReference(t,e){e.updateOptions(t.options,!0),sn(this,t.animation,e),e.previousNode=t}visitSequence(t,e){let n=e.subContextCount,r=e,a=t.options;if(a&&(a.params||a.delay)&&(r=e.createSubContext(a),r.transformIntoNewTimeline(),a.delay!=null)){r.previousNode.type==Ge.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=r0);let o=cr(a.delay);r.delayNextStep(o)}t.steps.length&&(t.steps.forEach(o=>sn(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){let n=[],r=e.currentTimeline.currentTime,a=t.options&&t.options.delay?cr(t.options.delay):0;t.steps.forEach(o=>{let u=e.createSubContext(t.options);a&&u.delayNextStep(a),sn(this,o,u),r=Math.max(r,u.currentTimeline.currentTime),n.push(u.currentTimeline)}),n.forEach(o=>e.currentTimeline.mergeTimelineCollectedStyles(o)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){let n=t.strValue,r=e.params?Po(n,e.params,e.errors):n;return Es(r,e.errors)}else return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){let n=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;n.delay&&(e.incrementTime(n.delay),r.snapshotCurrentStyles());let a=t.style;a.type==Ge.Keyframes?this.visitKeyframes(a,e):(e.incrementTime(n.duration),this.visitStyle(a,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){let n=e.currentTimeline,r=e.currentAnimateTimings;!r&&n.hasCurrentStyleProperties()&&n.forwardFrame();let a=r&&r.easing||t.easing;t.isEmptyStep?n.applyEmptyStep(a):n.setStyles(t.styles,a,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){let n=e.currentAnimateTimings,r=e.currentTimeline.duration,a=n.duration,u=e.createSubContext().currentTimeline;u.easing=n.easing,t.styles.forEach(m=>{let f=m.offset||0;u.forwardTime(f*a),u.setStyles(m.styles,m.easing,e.errors,e.options),u.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(u),e.transformIntoNewTimeline(r+a),e.previousNode=t}visitQuery(t,e){let n=e.currentTimeline.currentTime,r=t.options||{},a=r.delay?cr(r.delay):0;a&&(e.previousNode.type===Ge.Style||n==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=r0);let o=n,u=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=u.length;let m=null;u.forEach((f,h)=>{e.currentQueryIndex=h;let g=e.createSubContext(t.options,f);a&&g.delayNextStep(a),f===e.element&&(m=g.currentTimeline),sn(this,t.animation,g),g.currentTimeline.applyStylesToKeyframe();let x=g.currentTimeline.currentTime;o=Math.max(o,x)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(o),m&&(e.currentTimeline.mergeTimelineCollectedStyles(m),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){let n=e.parentContext,r=e.currentTimeline,a=t.timings,o=Math.abs(a.duration),u=o*(e.currentQueryTotal-1),m=o*e.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":m=u-m;break;case"full":m=n.currentStaggerTime;break}let h=e.currentTimeline;m&&h.delayNextStep(m);let g=h.currentTime;sn(this,t.animation,e),e.previousNode=t,n.currentStaggerTime=r.currentTime-g+(r.startTime-n.currentTimeline.startTime)}},r0={},Ju=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=r0;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(t,e,n,r,a,o,u,m){this._driver=t,this.element=e,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=a,this.errors=o,this.timelines=u,this.currentTimeline=m||new a0(this._driver,e,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;let n=t,r=this.options;n.duration!=null&&(r.duration=cr(n.duration)),n.delay!=null&&(r.delay=cr(n.delay));let a=n.params;if(a){let o=r.params;o||(o=this.options.params={}),Object.keys(a).forEach(u=>{(!e||!o.hasOwnProperty(u))&&(o[u]=Po(a[u],o,this.errors))})}}_copyOptions(){let t={};if(this.options){let e=this.options.params;if(e){let n=t.params={};Object.keys(e).forEach(r=>{n[r]=e[r]})}}return t}createSubContext(t=null,e,n){let r=e||this.element,a=new i(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(t){return this.previousNode=r0,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,n){let r={duration:e??t.duration,delay:this.currentTimeline.currentTime+(n??0)+t.delay,easing:""},a=new Zu(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(a),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,n,r,a,o){let u=[];if(r&&u.push(this.element),t.length>0){t=t.replace(g8,"."+this._enterClassName),t=t.replace(v8,"."+this._leaveClassName);let m=n!=1,f=this._driver.query(this.element,t,m);n!==0&&(f=n<0?f.slice(f.length+n,f.length):f.slice(0,n)),u.push(...f)}return!a&&u.length==0&&o.push(J_(e)),u}},a0=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(t,e,n,r){this._driver=t,this.element=e,this.startTime=n,this._elementTimelineStylesLookup=r,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new i(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=p8,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,n]of this._globalTimelineStyles)this._backFill.set(e,n||wn),this._currentKeyframe.set(e,wn);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,n,r){e&&this._previousKeyframe.set("easing",e);let a=r&&r.params||{},o=x8(t,this._globalTimelineStyles);for(let[u,m]of o){let f=Po(m,a,n);this._pendingStyles.set(u,f),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??wn),this._updateStyle(u,f)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,n)=>{let r=this._styleSummary.get(n);(!r||e.time>r.time)&&this._updateStyle(n,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let t=new Set,e=new Set,n=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((u,m)=>{let f=new Map([...this._backFill,...u]);f.forEach((h,g)=>{h===za?t.add(g):h===wn&&e.add(g)}),n||f.set("offset",m/this.duration),r.push(f)});let a=[...t.values()],o=[...e.values()];if(n){let u=r[0],m=new Map(u);u.set("offset",0),m.set("offset",1),r=[u,m]}return sm(this.element,r,a,o,this.duration,this.startTime,this.easing,!1)}},Zu=class extends a0{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(t,e,n,r,a,o,u=!1){super(t,e,o.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=a,this._stretchStartingKeyframe=u,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){let a=[],o=n+e,u=e/o,m=new Map(t[0]);m.set("offset",0),a.push(m);let f=new Map(t[0]);f.set("offset",xv(u)),a.push(f);let h=t.length-1;for(let g=1;g<=h;g++){let x=new Map(t[g]),b=x.get("offset"),S=e+b*n;x.set("offset",xv(S/o)),a.push(x)}n=o,e=0,r="",t=a}return sm(this.element,t,this.preStyleProps,this.postStyleProps,n,e,r,!0)}};function xv(i,t=3){let e=Math.pow(10,t-1);return Math.round(i*e)/e}function x8(i,t){let e=new Map,n;return i.forEach(r=>{if(r==="*"){n??=t.keys();for(let a of n)e.set(a,wn)}else for(let[a,o]of r)e.set(a,o)}),e}function bv(i,t,e,n,r,a,o,u,m,f,h,g,x){return{type:0,element:i,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:a,toState:n,toStyles:o,timelines:u,queriedElements:m,preStyleProps:f,postStyleProps:h,totalTime:g,errors:x}}var zu={},o0=class{_triggerName;ast;_stateStyles;constructor(t,e,n){this._triggerName=t,this.ast=e,this._stateStyles=n}match(t,e,n,r){return b8(this.ast.matchers,t,e,n,r)}buildStyles(t,e,n){let r=this._stateStyles.get("*");return t!==void 0&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(e,n):new Map}build(t,e,n,r,a,o,u,m,f,h){let g=[],x=this.ast.options&&this.ast.options.params||zu,b=u&&u.params||zu,S=this.buildStyles(n,b,g),v=m&&m.params||zu,E=this.buildStyles(r,v,g),j=new Set,U=new Map,H=new Map,Y=r==="void",z={params:Mv(v,x),delay:this.ast.options?.delay},_e=h?[]:Iv(t,e,this.ast.animation,a,o,S,E,z,f,g),W=0;return _e.forEach(le=>{W=Math.max(le.duration+le.delay,W)}),g.length?bv(e,this._triggerName,n,r,Y,S,E,[],[],U,H,W,g):(_e.forEach(le=>{let te=le.element,ce=on(U,te,new Set);le.preStyleProps.forEach(me=>ce.add(me));let ue=on(H,te,new Set);le.postStyleProps.forEach(me=>ue.add(me)),te!==e&&j.add(te)}),bv(e,this._triggerName,n,r,Y,S,E,_e,[...j.values()],U,H,W))}};function b8(i,t,e,n,r){return i.some(a=>a(t,e,n,r))}function Mv(i,t){let e=Ke({},t);return Object.entries(i).forEach(([n,r])=>{r!=null&&(e[n]=r)}),e}var em=class{styles;defaultParams;normalizer;constructor(t,e,n){this.styles=t,this.defaultParams=e,this.normalizer=n}buildStyles(t,e){let n=new Map,r=Mv(t,this.defaultParams);return this.styles.styles.forEach(a=>{typeof a!="string"&&a.forEach((o,u)=>{o&&(o=Po(o,r,e));let m=this.normalizer.normalizePropertyName(u,e);o=this.normalizer.normalizeStyleValue(u,m,o,e),n.set(u,o)})}),n}};function y8(i,t,e){return new tm(i,t,e)}var tm=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(t,e,n){this.name=t,this.ast=e,this._normalizer=n,e.states.forEach(r=>{let a=r.options&&r.options.params||{};this.states.set(r.name,new em(r.style,a,n))}),yv(this.states,"true","1"),yv(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new o0(t,r,this.states))}),this.fallbackTransition=C8(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,n,r){return this.transitionFactories.find(o=>o.match(t,e,n,r))||null}matchStyles(t,e,n){return this.fallbackTransition.buildStyles(t,e,n)}};function C8(i,t,e){let n=[(o,u)=>!0],r={type:Ge.Sequence,steps:[],options:null},a={type:Ge.Transition,animation:r,matchers:n,options:null,queryCount:0,depCount:0};return new o0(i,a,t)}function yv(i,t,e){i.has(t)?i.has(e)||i.set(e,i.get(t)):i.has(e)&&i.set(t,i.get(e))}var S8=new Ps,im=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(t,e,n){this.bodyNode=t,this._driver=e,this._normalizer=n}register(t,e){let n=[],r=[],a=kv(this._driver,e,n,r);if(n.length)throw iv(n);this._animations.set(t,a)}_buildPlayer(t,e,n){let r=t.element,a=Nu(this._normalizer,t.keyframes,e,n);return this._driver.animate(r,a,t.duration,t.delay,t.easing,[],!0)}create(t,e,n={}){let r=[],a=this._animations.get(t),o,u=new Map;if(a?(o=Iv(this._driver,e,a,ju,Xc,new Map,new Map,n,S8,r),o.forEach(h=>{let g=on(u,h.element,new Map);h.postStyleProps.forEach(x=>g.set(x,null))})):(r.push(nv()),o=[]),r.length)throw rv(r);u.forEach((h,g)=>{h.forEach((x,b)=>{h.set(b,this._driver.computeStyle(g,b,wn))})});let m=o.map(h=>{let g=u.get(h.element);return this._buildPlayer(h,new Map,g)}),f=Sr(m);return this._playersById.set(t,f),f.onDestroy(()=>this.destroy(t)),this.players.push(f),f}destroy(t){let e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);let n=this.players.indexOf(e);n>=0&&this.players.splice(n,1)}_getPlayer(t){let e=this._playersById.get(t);if(!e)throw av(t);return e}listen(t,e,n,r){let a=Gc(e,"","","");return zc(this._getPlayer(t),n,a,r),()=>{}}command(t,e,n,r){if(n=="register"){this.register(t,r[0]);return}if(n=="create"){let o=r[0]||{};this.create(t,e,o);return}let a=this._getPlayer(t);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t);break}}},Cv="ng-animate-queued",w8=".ng-animate-queued",Gu="ng-animate-disabled",E8=".ng-animate-disabled",T8="ng-star-inserted",P8=".ng-star-inserted",k8=[],Fv={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},I8={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},zn="__ng_removed",ks=class{namespaceId;value;options;get params(){return this.options.params}constructor(t,e=""){this.namespaceId=e;let n=t&&t.hasOwnProperty("value"),r=n?t.value:t;if(this.value=F8(r),n){let a=t,{value:o}=a,u=vm(a,["value"]);this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){let e=t.params;if(e){let n=this.options.params;Object.keys(e).forEach(r=>{n[r]==null&&(n[r]=e[r])})}}},Ts="void",qu=new ks(Ts),nm=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(t,e,n){this.id=t,this.hostElement=e,this._engine=n,this._hostClassName="ng-tns-"+t,On(e,this._hostClassName)}listen(t,e,n,r){if(!this._triggers.has(e))throw ov(n,e);if(n==null||n.length==0)throw sv(e);if(!A8(n))throw lv(n,e);let a=on(this._elementListeners,t,[]),o={name:e,phase:n,callback:r};a.push(o);let u=on(this._engine.statesByElement,t,new Map);return u.has(e)||(On(t,Ss),On(t,Ss+"-"+e),u.set(e,qu)),()=>{this._engine.afterFlush(()=>{let m=a.indexOf(o);m>=0&&a.splice(m,1),this._triggers.has(e)||u.delete(e)})}}register(t,e){return this._triggers.has(t)?!1:(this._triggers.set(t,e),!0)}_getTrigger(t){let e=this._triggers.get(t);if(!e)throw cv(t);return e}trigger(t,e,n,r=!0){let a=this._getTrigger(e),o=new Is(this.id,e,t),u=this._engine.statesByElement.get(t);u||(On(t,Ss),On(t,Ss+"-"+e),this._engine.statesByElement.set(t,u=new Map));let m=u.get(e),f=new ks(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&m&&f.absorbOptions(m.options),u.set(e,f),m||(m=qu),!(f.value===Ts)&&m.value===f.value){if(!R8(m.params,f.params)){let v=[],E=a.matchStyles(m.value,m.params,v),j=a.matchStyles(f.value,f.params,v);v.length?this._engine.reportError(v):this._engine.afterFlush(()=>{$r(t,E),$n(t,j)})}return}let x=on(this._engine.playersByElement,t,[]);x.forEach(v=>{v.namespaceId==this.id&&v.triggerName==e&&v.queued&&v.destroy()});let b=a.matchTransition(m.value,f.value,t,f.params),S=!1;if(!b){if(!r)return;b=a.fallbackTransition,S=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:b,fromState:m,toState:f,player:o,isFallbackTransition:S}),S||(On(t,Cv),o.onStart(()=>{ko(t,Cv)})),o.onDone(()=>{let v=this.players.indexOf(o);v>=0&&this.players.splice(v,1);let E=this._engine.playersByElement.get(t);if(E){let j=E.indexOf(o);j>=0&&E.splice(j,1)}}),this.players.push(o),x.push(o),o}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,n)=>{this._elementListeners.set(n,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);let e=this._engine.playersByElement.get(t);e&&(e.forEach(n=>n.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){let n=this._engine.driver.query(t,ws,!0);n.forEach(r=>{if(r[zn])return;let a=this._engine.fetchNamespacesByElement(r);a.size?a.forEach(o=>o.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,n,r){let a=this._engine.statesByElement.get(t),o=new Map;if(a){let u=[];if(a.forEach((m,f)=>{if(o.set(f,m.value),this._triggers.has(f)){let h=this.trigger(t,f,Ts,r);h&&u.push(h)}}),u.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,o),n&&Sr(u).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){let e=this._elementListeners.get(t),n=this._engine.statesByElement.get(t);if(e&&n){let r=new Set;e.forEach(a=>{let o=a.name;if(r.has(o))return;r.add(o);let m=this._triggers.get(o).fallbackTransition,f=n.get(o)||qu,h=new ks(Ts),g=new Is(this.id,o,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:o,transition:m,fromState:f,toState:h,player:g,isFallbackTransition:!0})})}}removeNode(t,e){let n=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(n.totalAnimations){let a=n.players.length?n.playersByQueriedElement.get(t):[];if(a&&a.length)r=!0;else{let o=t;for(;o=o.parentNode;)if(n.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)n.markElementAsRemoved(this.id,t,!1,e);else{let a=t[zn];(!a||a===Fv)&&(n.afterFlush(()=>this.clearElementCache(t)),n.destroyInnerAnimations(t),n._onRemovalComplete(t,e))}}insertNode(t,e){On(t,this._hostClassName)}drainQueuedTransitions(t){let e=[];return this._queue.forEach(n=>{let r=n.player;if(r.destroyed)return;let a=n.element,o=this._elementListeners.get(a);o&&o.forEach(u=>{if(u.name==n.triggerName){let m=Gc(a,n.triggerName,n.fromState.value,n.toState.value);m._data=t,zc(n.player,u.phase,m,u.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(n)}),this._queue=[],e.sort((n,r)=>{let a=n.transition.ast.depCount,o=r.transition.ast.depCount;return a==0||o==0?a-o:this._engine.driver.containsElement(n.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}},rm=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(t,e)=>{};_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}constructor(t,e,n){this.bodyNode=t,this.driver=e,this._normalizer=n}get queuedPlayers(){let t=[];return this._namespaceList.forEach(e=>{e.players.forEach(n=>{n.queued&&t.push(n)})}),t}createNamespace(t,e){let n=new nm(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(n,e):(this.newHostElements.set(e,n),this.collectEnterElement(e)),this._namespaceLookup[t]=n}_balanceNamespaceList(t,e){let n=this._namespaceList,r=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,u=this.driver.getParentElement(e);for(;u;){let m=r.get(u);if(m){let f=n.indexOf(m);n.splice(f+1,0,t),o=!0;break}u=this.driver.getParentElement(u)}o||n.unshift(t)}else n.push(t);return r.set(e,t),t}register(t,e){let n=this._namespaceLookup[t];return n||(n=this.createNamespace(t,e)),n}registerTrigger(t,e,n){let r=this._namespaceLookup[t];r&&r.register(e,n)&&this.totalAnimations++}destroy(t,e){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(t);this.namespacesByHostElement.delete(n.hostElement);let r=this._namespaceList.indexOf(n);r>=0&&this._namespaceList.splice(r,1),n.destroy(e),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){let e=new Set,n=this.statesByElement.get(t);if(n){for(let r of n.values())if(r.namespaceId){let a=this._fetchNamespace(r.namespaceId);a&&e.add(a)}}return e}trigger(t,e,n,r){if(e0(e)){let a=this._fetchNamespace(t);if(a)return a.trigger(e,n,r),!0}return!1}insertNode(t,e,n,r){if(!e0(e))return;let a=e[zn];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;let o=this.collectedLeaveElements.indexOf(e);o>=0&&this.collectedLeaveElements.splice(o,1)}if(t){let o=this._fetchNamespace(t);o&&o.insertNode(e,n)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),On(t,Gu)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),ko(t,Gu))}removeNode(t,e,n){if(e0(e)){let r=t?this._fetchNamespace(t):null;r?r.removeNode(e,n):this.markElementAsRemoved(t,e,!1,n);let a=this.namespacesByHostElement.get(e);a&&a.id!==t&&a.removeNode(e,n)}else this._onRemovalComplete(e,n)}markElementAsRemoved(t,e,n,r,a){this.collectedLeaveElements.push(e),e[zn]={namespaceId:t,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:a}}listen(t,e,n,r,a){return e0(e)?this._fetchNamespace(t).listen(e,n,r,a):()=>{}}_buildInstruction(t,e,n,r,a){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,n,r,t.fromState.options,t.toState.options,e,a)}destroyInnerAnimations(t){let e=this.driver.query(t,ws,!0);e.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(t,Kc,!0),e.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(t){let e=this.playersByElement.get(t);e&&e.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(t){let e=this.playersByQueriedElement.get(t);e&&e.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Sr(this.players).onDone(()=>t());t()})}processLeaveNode(t){let e=t[zn];if(e&&e.setForRemoval){if(t[zn]=Fv,e.namespaceId){this.destroyInnerAnimations(t);let n=this._fetchNamespace(e.namespaceId);n&&n.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}t.classList?.contains(Gu)&&this.markElementAsDisabled(t,!1),this.driver.query(t,E8,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,r)=>this._balanceNamespaceList(n,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let r=this.collectedEnterElements[n];On(r,T8)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{e=this._flushAnimations(n,t)}finally{for(let r=0;r<n.length;r++)n[r]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let r=this.collectedLeaveElements[n];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],e.length?Sr(e).onDone(()=>{n.forEach(r=>r())}):n.forEach(r=>r())}}reportError(t){throw dv(t)}_flushAnimations(t,e){let n=new Ps,r=[],a=new Map,o=[],u=new Map,m=new Map,f=new Map,h=new Set;this.disabledNodes.forEach(ye=>{h.add(ye);let Ee=this.driver.query(ye,w8,!0);for(let ke=0;ke<Ee.length;ke++)h.add(Ee[ke])});let g=this.bodyNode,x=Array.from(this.statesByElement.keys()),b=Ev(x,this.collectedEnterElements),S=new Map,v=0;b.forEach((ye,Ee)=>{let ke=ju+v++;S.set(Ee,ke),ye.forEach(Ue=>On(Ue,ke))});let E=[],j=new Set,U=new Set;for(let ye=0;ye<this.collectedLeaveElements.length;ye++){let Ee=this.collectedLeaveElements[ye],ke=Ee[zn];ke&&ke.setForRemoval&&(E.push(Ee),j.add(Ee),ke.hasAnimation?this.driver.query(Ee,P8,!0).forEach(Ue=>j.add(Ue)):U.add(Ee))}let H=new Map,Y=Ev(x,Array.from(j));Y.forEach((ye,Ee)=>{let ke=Xc+v++;H.set(Ee,ke),ye.forEach(Ue=>On(Ue,ke))}),t.push(()=>{b.forEach((ye,Ee)=>{let ke=S.get(Ee);ye.forEach(Ue=>ko(Ue,ke))}),Y.forEach((ye,Ee)=>{let ke=H.get(Ee);ye.forEach(Ue=>ko(Ue,ke))}),E.forEach(ye=>{this.processLeaveNode(ye)})});let z=[],_e=[];for(let ye=this._namespaceList.length-1;ye>=0;ye--)this._namespaceList[ye].drainQueuedTransitions(e).forEach(ke=>{let Ue=ke.player,it=ke.element;if(z.push(Ue),this.collectedEnterElements.length){let Ce=it[zn];if(Ce&&Ce.setForMove){if(Ce.previousTriggersValues&&Ce.previousTriggersValues.has(ke.triggerName)){let De=Ce.previousTriggersValues.get(ke.triggerName),we=this.statesByElement.get(ke.element);if(we&&we.has(ke.triggerName)){let he=we.get(ke.triggerName);he.value=De,we.set(ke.triggerName,he)}}Ue.destroy();return}}let Ut=!g||!this.driver.containsElement(g,it),B=H.get(it),re=S.get(it),L=this._buildInstruction(ke,n,re,B,Ut);if(L.errors&&L.errors.length){_e.push(L);return}if(Ut){Ue.onStart(()=>$r(it,L.fromStyles)),Ue.onDestroy(()=>$n(it,L.toStyles)),r.push(Ue);return}if(ke.isFallbackTransition){Ue.onStart(()=>$r(it,L.fromStyles)),Ue.onDestroy(()=>$n(it,L.toStyles)),r.push(Ue);return}let V=[];L.timelines.forEach(Ce=>{Ce.stretchStartingKeyframe=!0,this.disabledNodes.has(Ce.element)||V.push(Ce)}),L.timelines=V,n.append(it,L.timelines);let fe={instruction:L,player:Ue,element:it};o.push(fe),L.queriedElements.forEach(Ce=>on(u,Ce,[]).push(Ue)),L.preStyleProps.forEach((Ce,De)=>{if(Ce.size){let we=m.get(De);we||m.set(De,we=new Set),Ce.forEach((he,pt)=>we.add(pt))}}),L.postStyleProps.forEach((Ce,De)=>{let we=f.get(De);we||f.set(De,we=new Set),Ce.forEach((he,pt)=>we.add(pt))})});if(_e.length){let ye=[];_e.forEach(Ee=>{ye.push(uv(Ee.triggerName,Ee.errors))}),z.forEach(Ee=>Ee.destroy()),this.reportError(ye)}let W=new Map,le=new Map;o.forEach(ye=>{let Ee=ye.element;n.has(Ee)&&(le.set(Ee,Ee),this._beforeAnimationBuild(ye.player.namespaceId,ye.instruction,W))}),r.forEach(ye=>{let Ee=ye.element;this._getPreviousPlayers(Ee,!1,ye.namespaceId,ye.triggerName,null).forEach(Ue=>{on(W,Ee,[]).push(Ue),Ue.destroy()})});let te=E.filter(ye=>Tv(ye,m,f)),ce=new Map;wv(ce,this.driver,U,f,wn).forEach(ye=>{Tv(ye,m,f)&&te.push(ye)});let me=new Map;b.forEach((ye,Ee)=>{wv(me,this.driver,new Set(ye),m,za)}),te.forEach(ye=>{let Ee=ce.get(ye),ke=me.get(ye);ce.set(ye,new Map([...Ee?.entries()??[],...ke?.entries()??[]]))});let Me=[],ut=[],Re={};o.forEach(ye=>{let{element:Ee,player:ke,instruction:Ue}=ye;if(n.has(Ee)){if(h.has(Ee)){ke.onDestroy(()=>$n(Ee,Ue.toStyles)),ke.disabled=!0,ke.overrideTotalTime(Ue.totalTime),r.push(ke);return}let it=Re;if(le.size>1){let B=Ee,re=[];for(;B=B.parentNode;){let L=le.get(B);if(L){it=L;break}re.push(B)}re.forEach(L=>le.set(L,it))}let Ut=this._buildAnimation(ke.namespaceId,Ue,W,a,me,ce);if(ke.setRealPlayer(Ut),it===Re)Me.push(ke);else{let B=this.playersByElement.get(it);B&&B.length&&(ke.parentPlayer=Sr(B)),r.push(ke)}}else $r(Ee,Ue.fromStyles),ke.onDestroy(()=>$n(Ee,Ue.toStyles)),ut.push(ke),h.has(Ee)&&r.push(ke)}),ut.forEach(ye=>{let Ee=a.get(ye.element);if(Ee&&Ee.length){let ke=Sr(Ee);ye.setRealPlayer(ke)}}),r.forEach(ye=>{ye.parentPlayer?ye.syncPlayerEvents(ye.parentPlayer):ye.destroy()});for(let ye=0;ye<E.length;ye++){let Ee=E[ye],ke=Ee[zn];if(ko(Ee,Xc),ke&&ke.hasAnimation)continue;let Ue=[];if(u.size){let Ut=u.get(Ee);Ut&&Ut.length&&Ue.push(...Ut);let B=this.driver.query(Ee,Kc,!0);for(let re=0;re<B.length;re++){let L=u.get(B[re]);L&&L.length&&Ue.push(...L)}}let it=Ue.filter(Ut=>!Ut.destroyed);it.length?O8(this,Ee,it):this.processLeaveNode(Ee)}return E.length=0,Me.forEach(ye=>{this.players.push(ye),ye.onDone(()=>{ye.destroy();let Ee=this.players.indexOf(ye);this.players.splice(Ee,1)}),ye.play()}),Me}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,n,r,a){let o=[];if(e){let u=this.playersByQueriedElement.get(t);u&&(o=u)}else{let u=this.playersByElement.get(t);if(u){let m=!a||a==Ts;u.forEach(f=>{f.queued||!m&&f.triggerName!=r||o.push(f)})}}return(n||r)&&(o=o.filter(u=>!(n&&n!=u.namespaceId||r&&r!=u.triggerName))),o}_beforeAnimationBuild(t,e,n){let r=e.triggerName,a=e.element,o=e.isRemovalTransition?void 0:t,u=e.isRemovalTransition?void 0:r;for(let m of e.timelines){let f=m.element,h=f!==a,g=on(n,f,[]);this._getPreviousPlayers(f,h,o,u,e.toState).forEach(b=>{let S=b.getRealPlayer();S.beforeDestroy&&S.beforeDestroy(),b.destroy(),g.push(b)})}$r(a,e.fromStyles)}_buildAnimation(t,e,n,r,a,o){let u=e.triggerName,m=e.element,f=[],h=new Set,g=new Set,x=e.timelines.map(S=>{let v=S.element;h.add(v);let E=v[zn];if(E&&E.removedBeforeQueried)return new ir(S.duration,S.delay);let j=v!==m,U=D8((n.get(v)||k8).map(W=>W.getRealPlayer())).filter(W=>{let le=W;return le.element?le.element===v:!1}),H=a.get(v),Y=o.get(v),z=Nu(this._normalizer,S.keyframes,H,Y),_e=this._buildPlayer(S,z,U);if(S.subTimeline&&r&&g.add(v),j){let W=new Is(t,u,v);W.setRealPlayer(_e),f.push(W)}return _e});f.forEach(S=>{on(this.playersByQueriedElement,S.element,[]).push(S),S.onDone(()=>M8(this.playersByQueriedElement,S.element,S))}),h.forEach(S=>On(S,Wu));let b=Sr(x);return b.onDestroy(()=>{h.forEach(S=>ko(S,Wu)),$n(m,e.toStyles)}),g.forEach(S=>{on(r,S,[]).push(b)}),b}_buildPlayer(t,e,n){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,n):new ir(t.duration,t.delay)}},Is=class{namespaceId;triggerName;element;_player=new ir;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(t,e,n){this.namespaceId=t,this.triggerName=e,this.element=n}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,n)=>{e.forEach(r=>zc(t,n,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){let e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){on(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){let e=this._player;e.triggerCallback&&e.triggerCallback(t)}};function M8(i,t,e){let n=i.get(t);if(n){if(n.length){let r=n.indexOf(e);n.splice(r,1)}n.length==0&&i.delete(t)}return n}function F8(i){return i??null}function e0(i){return i&&i.nodeType===1}function A8(i){return i=="start"||i=="done"}function Sv(i,t){let e=i.style.display;return i.style.display=t??"none",e}function wv(i,t,e,n,r){let a=[];e.forEach(m=>a.push(Sv(m)));let o=[];n.forEach((m,f)=>{let h=new Map;m.forEach(g=>{let x=t.computeStyle(f,g,r);h.set(g,x),(!x||x.length==0)&&(f[zn]=I8,o.push(f))}),i.set(f,h)});let u=0;return e.forEach(m=>Sv(m,a[u++])),o}function Ev(i,t){let e=new Map;if(i.forEach(u=>e.set(u,[])),t.length==0)return e;let n=1,r=new Set(t),a=new Map;function o(u){if(!u)return n;let m=a.get(u);if(m)return m;let f=u.parentNode;return e.has(f)?m=f:r.has(f)?m=n:m=o(f),a.set(u,m),m}return t.forEach(u=>{let m=o(u);m!==n&&e.get(m).push(u)}),e}function On(i,t){i.classList?.add(t)}function ko(i,t){i.classList?.remove(t)}function O8(i,t,e){Sr(e).onDone(()=>i.processLeaveNode(t))}function D8(i){let t=[];return Av(i,t),t}function Av(i,t){for(let e=0;e<i.length;e++){let n=i[e];n instanceof ia?Av(n.players,t):t.push(n)}}function R8(i,t){let e=Object.keys(i),n=Object.keys(t);if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++){let a=e[r];if(!t.hasOwnProperty(a)||i[a]!==t[a])return!1}return!0}function Tv(i,t,e){let n=e.get(i);if(!n)return!1;let r=t.get(i);return r?n.forEach(a=>r.add(a)):t.set(i,n),e.delete(i),!0}var Io=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(t,e)=>{};constructor(t,e,n){this._driver=e,this._normalizer=n,this._transitionEngine=new rm(t.body,e,n),this._timelineEngine=new im(t.body,e,n),this._transitionEngine.onRemovalComplete=(r,a)=>this.onRemovalComplete(r,a)}registerTrigger(t,e,n,r,a){let o=t+"-"+r,u=this._triggerCache[o];if(!u){let m=[],f=[],h=kv(this._driver,a,m,f);if(m.length)throw tv(r,m);u=y8(r,h,this._normalizer),this._triggerCache[o]=u}this._transitionEngine.registerTrigger(e,r,u)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,n,r){this._transitionEngine.insertNode(t,e,n,r)}onRemove(t,e,n){this._transitionEngine.removeNode(t,e,n)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,n,r){if(n.charAt(0)=="@"){let[a,o]=Bu(n),u=r;this._timelineEngine.command(a,e,o,u)}else this._transitionEngine.trigger(t,e,n,r)}listen(t,e,n,r,a){if(n.charAt(0)=="@"){let[o,u]=Bu(n);return this._timelineEngine.listen(o,e,u,a)}return this._transitionEngine.listen(t,e,n,r,a)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}};function N8(i,t){let e=null,n=null;return Array.isArray(t)&&t.length?(e=Xu(t[0]),t.length>1&&(n=Xu(t[t.length-1]))):t instanceof Map&&(e=Xu(t)),e||n?new B8(i,e,n):null}var B8=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,n,r){this._element=e,this._startStyles=n,this._endStyles=r;let a=i.initialStylesByElement.get(e);a||i.initialStylesByElement.set(e,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&$n(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&($n(this._element,this._initialStyles),this._endStyles&&($n(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&($r(this._element,this._startStyles),this._endStyles=null),this._endStyles&&($r(this._element,this._endStyles),this._endStyles=null),$n(this._element,this._initialStyles),this._state=3)}}return i})();function Xu(i){let t=null;return i.forEach((e,n)=>{L8(n)&&(t=t||new Map,t.set(n,e))}),t}function L8(i){return i==="display"||i==="position"}var s0=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(t,e,n,r){this.element=t,this.keyframes=e,this.options=n,this._specialStyles=r,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;let e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){let e=[];return t.forEach(n=>{e.push(Object.fromEntries(n))}),e}_triggerWebAnimation(t,e,n){return t.animate(this._convertKeyframesToObject(e),n)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,r)=>{r!=="offset"&&t.set(r,this._finished?n:Qc(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){let e=t==="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},l0=class{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}containsElement(t,e){return Lu(t,e)}getParentElement(t){return qc(t)}query(t,e,n){return Vu(t,e,n)}computeStyle(t,e,n){return Qc(t,e)}animate(t,e,n,r,a,o=[]){let u=r==0?"both":"forwards",m={duration:n,delay:r,fill:u};a&&(m.easing=a);let f=new Map,h=o.filter(b=>b instanceof s0);hv(n,r)&&h.forEach(b=>{b.currentSnapshot.forEach((S,v)=>f.set(v,S))});let g=fv(e).map(b=>new Map(b));g=gv(t,g,f);let x=N8(t,g);return new s0(t,g,m,x)}};var t0="@",Ov="@.disabled",c0=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(t,e,n,r){this.namespaceId=t,this.delegate=e,this.engine=n,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,n,r=!0){this.delegate.insertBefore(t,e,n),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,n){this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,n,r){this.delegate.setAttribute(t,e,n,r)}removeAttribute(t,e,n){this.delegate.removeAttribute(t,e,n)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,n,r){this.delegate.setStyle(t,e,n,r)}removeStyle(t,e,n){this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){e.charAt(0)==t0&&e==Ov?this.disableAnimations(t,!!n):this.delegate.setProperty(t,e,n)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,n,r){return this.delegate.listen(t,e,n,r)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}},am=class extends c0{factory;constructor(t,e,n,r,a){super(e,n,r,a),this.factory=t,this.namespaceId=e}setProperty(t,e,n){e.charAt(0)==t0?e.charAt(1)=="."&&e==Ov?(n=n===void 0?!0:!!n,this.disableAnimations(t,n)):this.engine.process(this.namespaceId,t,e.slice(1),n):this.delegate.setProperty(t,e,n)}listen(t,e,n,r){if(e.charAt(0)==t0){let a=V8(t),o=e.slice(1),u="";return o.charAt(0)!=t0&&([o,u]=U8(o)),this.engine.listen(this.namespaceId,a,o,u,m=>{let f=m._data||-1;this.factory.scheduleListenerCallback(f,n,m)})}return this.delegate.listen(t,e,n,r)}};function V8(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function U8(i){let t=i.indexOf("."),e=i.substring(0,t),n=i.slice(t+1);return[e,n]}var d0=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(t,e,n){this.delegate=t,this.engine=e,this._zone=n,e.onRemovalComplete=(r,a)=>{a?.removeChild(null,r)}}createRenderer(t,e){let n="",r=this.delegate.createRenderer(t,e);if(!t||!e?.data?.animation){let f=this._rendererCache,h=f.get(r);if(!h){let g=()=>f.delete(r);h=new c0(n,r,this.engine,g),f.set(r,h)}return h}let a=e.id,o=e.id+"-"+this._currentId;this._currentId++,this.engine.register(o,t);let u=f=>{Array.isArray(f)?f.forEach(u):this.engine.registerTrigger(a,o,t,f.name,f)};return e.data.animation.forEach(u),new am(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,n){if(t>=0&&t<this._microtaskId){this._zone.run(()=>e(n));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(a=>{let[o,u]=a;o(u)}),this._animationCallbacksBuffer=[]})}),r.push([e,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(t){this.engine.flush(),this.delegate.componentReplaced?.(t)}};var W8=(()=>{class i extends Io{constructor(e,n,r){super(e,n,r)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(lt(Bo),lt(Ca),lt(Sa))};static \u0275prov=tt({token:i,factory:i.\u0275fac})}return i})();function H8(){return new i0}function $8(i,t,e){return new d0(i,t,e)}var Dv=[{provide:Sa,useFactory:H8},{provide:Io,useClass:W8},{provide:Ro,useFactory:$8,deps:[Rm,Io,bn]}],YW=[{provide:Ca,useClass:om},{provide:Do,useValue:"NoopAnimations"},...Dv],z8=[{provide:Ca,useFactory:()=>new l0},{provide:Do,useFactory:()=>"BrowserAnimations"},...Dv];function Rv(){return Im("NgEagerAnimations"),[...z8]}Nm(ol,{providers:[jm(L_),Rv(),Bm(Lm([(i,t)=>{let e=localStorage.getItem("token");if(e){let n=i.clone({setHeaders:{"x-auth-token":e}});return t(n)}return t(i)}]))]}).catch(i=>console.error(i));
