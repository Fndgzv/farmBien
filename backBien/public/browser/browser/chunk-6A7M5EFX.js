import{a as X}from"./chunk-2NP7YVVR.js";import{a as L}from"./chunk-7CIQHWV4.js";import{a as ee}from"./chunk-JKGFMHHD.js";import{N as K,a as q,b as $,c as H,y as J}from"./chunk-H6EUTKON.js";import"./chunk-PFEDVX7Q.js";import{Ab as t,Bb as i,Be as Q,Cb as d,Ce as W,Gb as F,Gd as G,Hd as B,Ib as E,Ic as I,Id as R,Jb as g,Jc as N,Uc as w,Vb as o,Wb as c,Xa as n,Xb as h,ab as p,gb as y,gd as M,ha as U,hd as u,ia as _,jd as k,kb as v,kd as A,ld as T,pd as P,qb as C,rb as s,td as j,wd as V,xd as D,yd as O,zd as z}from"./chunk-JCSDOWBG.js";import{a as S,b as x,e as Z}from"./chunk-EQDQRRRY.js";var f=Z(ee());function ie(l,e){if(l&1){let a=F();t(0,"tr")(1,"td"),o(2),i(),t(3,"td"),o(4),i(),t(5,"td"),o(6),i(),t(7,"td"),o(8),i(),t(9,"td"),o(10),i(),t(11,"td"),o(12),i(),t(13,"td")(14,"button",31),E("click",function(){let m=U(a).$implicit,b=g();return _(b.editar(m))}),d(15,"fa-icon",3),i()()()}if(l&2){let a=e.$implicit,r=g();n(2),c(a.nombre),n(2),c(a.usuario),n(2),c(a.rol),n(2),c(a.telefono),n(2),c(a.email||"-"),n(2),c(r.obtenerNombreFarmacia(a.farmacia)),n(3),s("icon","pen")}}function te(l,e){if(l&1&&(t(0,"option",34),o(1),i()),l&2){let a=e.$implicit;s("value",a._id),n(),c(a.nombre)}}function oe(l,e){if(l&1&&(t(0,"div",15)(1,"label"),o(2,"Farmacia asignada:"),i(),t(3,"select",32)(4,"option",23),o(5,"-- Selecciona una farmacia --"),i(),v(6,te,2,2,"option",33),i()()),l&2){let a=g();n(6),s("ngForOf",a.farmacias)}}function re(l,e){l&1&&(t(0,"div",15)(1,"label"),o(2,"C\xE9dula profesional:"),i(),d(3,"input",35),i())}var Y=class l{constructor(e,a,r,m){this.fb=e;this.usuarioService=a;this.farmaciaService=r;this.library=m;m.addIcons(J,K)}usuarios=[];farmacias=[];formUsuario=new T({});guardando=!1;modoEdicion=!1;usuarioEditandoId=null;ngOnInit(){this.inicializarFormulario(),this.cargarUsuarios(),this.cargarFarmacias()}inicializarFormulario(){this.formUsuario=this.fb.group({nombre:["",u.required],usuario:["",u.required],telefono:["",[u.pattern(/^\d{10}$/)]],email:[""],password:["",[u.minLength(6)]],domicilio:[""],rol:["",u.required],farmacia:[""],cedulaProfesional:[""]})}obtenerNombreFarmacia(e){return typeof e=="object"&&e?.nombre?e.nombre:"-"}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe({next:e=>this.usuarios=e,error:()=>f.default.fire("Error","No se pudieron cargar los usuarios","error")})}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:e=>this.farmacias=e,error:()=>f.default.fire("Error","No se pudieron cargar las farmacias","error")})}abrirModalAgregar(){this.modoEdicion=!1,this.usuarioEditandoId=null,this.formUsuario.reset(),this.mostrarModal()}editar(e){this.modoEdicion=!0,this.usuarioEditandoId=e._id||null;let a=x(S({},e),{farmacia:typeof e.farmacia=="object"&&e.farmacia!==null?e.farmacia._id:"",cedulaProfesional:e.rol==="medico"&&e.cedulaProfesional||""});this.formUsuario.patchValue(a);let r=document.getElementById("modalUsuario");r&&new bootstrap.Modal(r,{backdrop:"static",keyboard:!1}).show()}mostrarModal(){let e=document.getElementById("modalUsuario");e&&new bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show()}guardar(){if(this.formUsuario.invalid||this.guardando)return;this.guardando=!0;let e=this.limpiarDatosUsuarioPorRol(this.formUsuario.value),a=()=>{let r=document.getElementById("modalUsuario");r&&bootstrap.Modal.getInstance(r)?.hide(),this.cargarUsuarios(),this.guardando=!1,this.usuarioEditandoId=null,this.modoEdicion=!1,this.formUsuario.reset()};if(!this.modoEdicion){let r=this.formUsuario.get("password");if(r?.setValidators([u.required,u.minLength(6)]),r?.updateValueAndValidity(),r?.invalid){this.formUsuario.markAllAsTouched(),this.guardando=!1;return}}this.modoEdicion&&this.usuarioEditandoId?this.usuarioService.actualizarUsuario(this.usuarioEditandoId,e).subscribe({next:()=>f.default.fire("Actualizado","Usuario actualizado","success").then(a),error:()=>{f.default.fire("Error","No se pudo actualizar","error"),this.guardando=!1}}):this.usuarioService.crearUsuario(e).subscribe({next:()=>f.default.fire("Registrado","Usuario creado","success").then(a),error:r=>{let m=r?.error?.mensaje||"No se pudo crear";f.default.fire("Error",m,"error"),this.guardando=!1}})}limpiarDatosUsuarioPorRol(e){switch(e.rol){case"admin":e.farmacia=null,e.cedulaProfesional=void 0;break;case"empleado":e.farmacia||(e.farmacia=null),e.cedulaProfesional=void 0;break;case"medico":e.farmacia||(e.farmacia=null),e.cedulaProfesional||(e.cedulaProfesional=void 0);break}return e.email||(e.email=void 0),e.domicilio||(e.domicilio=void 0),e.telefono||(e.telefono=void 0),e}static \u0275fac=function(a){return new(a||l)(p(G),p(X),p(L),p(q))};static \u0275cmp=y({type:l,selectors:[["app-usuarios"]],decls:78,vars:9,consts:[[1,"container"],[1,"titulo",2,"text-align","center"],[1,"btn-verde","mb-3",3,"click"],[3,"icon"],[1,"tabla"],[4,"ngFor","ngForOf"],["id","modalUsuario","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content","p-3",2,"background-color","azure"],[1,"modal-header"],[1,"modal-title","titulo"],["type","button","data-bs-dismiss","modal","aria-label","Cerrar",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"row"],[1,"col-md-6","mb-2"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","usuario",1,"form-control"],["type","text","formControlName","telefono",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","password","formControlName","password",1,"form-control"],["type","text","formControlName","domicilio",1,"form-control"],["formControlName","rol",1,"form-control"],["value",""],["value","admin"],["value","empleado"],["value","medico"],["class","col-md-6 mb-2",4,"ngIf"],[1,"modal-footer","d-flex","justify-content-between"],["data-bs-dismiss","modal",1,"btn-rojo"],[1,"btn-gris",3,"click","disabled"],["matTooltip","Editar",1,"btn-icon-chico","btn-gris-chico",3,"click"],["formControlName","farmacia",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","text","formControlName","cedulaProfesional",1,"form-control"]],template:function(a,r){if(a&1&&(t(0,"div",0)(1,"h2",1),o(2,"Mantenimiento de Usuarios"),i(),t(3,"button",2),E("click",function(){return r.abrirModalAgregar()}),d(4,"fa-icon",3),o(5," Agregar Usuario "),i(),t(6,"table",4)(7,"thead")(8,"tr")(9,"th"),o(10,"Nombre"),i(),t(11,"th"),o(12,"Usuario"),i(),t(13,"th"),o(14,"Rol"),i(),t(15,"th"),o(16,"Tel\xE9fono"),i(),t(17,"th"),o(18,"Email"),i(),t(19,"th"),o(20,"Farmacia"),i(),t(21,"th"),o(22,"Acciones"),i()()(),t(23,"tbody"),v(24,ie,16,7,"tr",5),i()()(),t(25,"div",6)(26,"div",7)(27,"div",8)(28,"div",9)(29,"h5",10),o(30),i(),d(31,"button",11),i(),t(32,"div",12)(33,"form",13)(34,"div",14)(35,"div",15)(36,"label"),o(37,"Nombre:"),i(),d(38,"input",16),i(),t(39,"div",15)(40,"label"),o(41,"Usuario:"),i(),d(42,"input",17),i(),t(43,"div",15)(44,"label"),o(45,"Tel\xE9fono:"),i(),d(46,"input",18),i(),t(47,"div",15)(48,"label"),o(49,"Email:"),i(),d(50,"input",19),i(),t(51,"div",15)(52,"label"),o(53,"Contrase\xF1a:"),i(),d(54,"input",20),i(),t(55,"div",15)(56,"label"),o(57,"Domicilio:"),i(),d(58,"input",21),i(),t(59,"div",15)(60,"label"),o(61,"Rol:"),i(),t(62,"select",22)(63,"option",23),o(64,"-- Selecciona un rol --"),i(),t(65,"option",24),o(66,"Admin"),i(),t(67,"option",25),o(68,"Empleado"),i(),t(69,"option",26),o(70,"M\xE9dico"),i()()(),v(71,oe,7,1,"div",27)(72,re,4,0,"div",27),i()()(),t(73,"div",28)(74,"button",29),o(75,"Cancelar"),i(),t(76,"button",30),E("click",function(){return r.guardar()}),o(77),i()()()()()),a&2){let m,b;n(4),s("icon","plus"),n(20),s("ngForOf",r.usuarios),n(6),h(" ",r.modoEdicion?"Editar Usuario":"Agregar Usuario"," "),n(3),s("formGroup",r.formUsuario),n(21),C("placeholder",r.modoEdicion?"Dejar vac\xEDo para no cambiar":""),n(17),s("ngIf",r.formUsuario&&(((m=r.formUsuario.get("rol"))==null?null:m.value)==="empleado"||((m=r.formUsuario.get("rol"))==null?null:m.value)==="medico")),n(),s("ngIf",r.formUsuario&&((b=r.formUsuario.get("rol"))==null?null:b.value)==="medico"),n(4),s("disabled",r.formUsuario.invalid||r.guardando),n(),h(" ",r.guardando?"Guardando...":r.modoEdicion?"Actualizar":"Guardar"," ")}},dependencies:[w,I,N,R,P,O,z,M,D,k,A,j,V,B,H,$,W,Q],encapsulation:2})};export{Y as UsuariosComponent};
