import{a as td,b as id}from"./chunk-BL6NNVQW.js";import{a as gn}from"./chunk-ELMSP7TU.js";import{A as dd,B as md,C as pd,D as ud,E as fd,F as hd,G as gd,H as ka,I as vd,J as yd,a as zc,b as qc,c as Wc,d as pn,e as Gc,f as Kc,g as Jc,j as ed,k as Wo,l as Oa,m as fn,n as Go,o as hn,p as $t,q as wi,r as oi,s as Qo,t as nd,u as od,v as rd,w as ad,x as sd,y as ld,z as cd}from"./chunk-YKD6NKEQ.js";import{a as Ko}from"./chunk-ENAHLAZL.js";import{a as Do,c as Fo,d as St,e as ec,f as tc,g as ic,h as an}from"./chunk-OLYH2LXY.js";import{a as ze}from"./chunk-A4LHU2X3.js";import{d as _d,e as bd}from"./chunk-5MJ2K2SW.js";import{a as _t}from"./chunk-JKGFMHHD.js";import{A as Cc,B as xc,D as Sc,E as Ec,G as wc,H as mn,I as Pc,J as Ic,K as Mc,L as Tc,M as Oc,N as Ut,O as ct,P as kc,Q as Dc,R as Fc,S as Rc,U as Ac,a as st,b as Ze,c as Je,d as ac,e as sc,f as lc,h as cc,i as dc,k as mc,l as dn,m as pc,n as uc,o as fc,r as hc,s as gc,t as Pa,u as _c,w as bc,x as vc,y as Lo,z as yc}from"./chunk-TXFMT57U.js";import{a as Yl,b as Xl}from"./chunk-3BAARAH2.js";import{$ as K,$a as on,$b as k,$c as ge,$d as $c,A as Lt,Ab as a,Ad as Et,Ae as _e,Bb as r,Bd as No,Be as Ve,C as Ft,Ca as zn,Cb as f,Cd as rc,Db as oe,Dd as cn,E as xo,Eb as re,Ed as Bo,F as Ul,Fa as ql,Fd as He,G as Rt,Gb as I,Gc as Qe,Gd as me,Ha as Eo,Hc as Y,Hd as De,Ib as g,Ic as z,Id as Vc,Jb as u,Jc as To,Jd as Nc,Kb as Wl,Kc as Oo,Kd as jo,Lb as Gl,Ld as Bc,Mb as Bi,Mc as rn,Md as ji,Nb as wa,Nd as Si,Ob as Ee,Oc as ko,Od as Lc,P as Ai,Pb as ye,Q as ft,Qb as Ce,Qc as Me,Qd as jc,R as So,Rc as Te,Rd as Ei,S as Vi,Sc as Re,T as ue,Tb as $e,Tc as j,Td as Uc,U as $l,Ua as Ni,Ub as c,V as se,Vb as _,Vd as Ia,W as $n,Wa as nn,Wb as x,Xa as l,Xb as Qt,Y as Ci,Yb as jt,Za as Ea,Zb as T,Zc as ne,_ as he,_a as qn,_b as O,_c as Le,a as ti,ab as P,ad as Zl,ae as Uo,bc as Li,bd as Jl,be as Hc,c as ii,cb as wo,cc as Ke,cd as J,ce as Ma,dc as nt,dd as nc,de as $o,ea as Hl,ec as ht,ed as at,f as ve,fc as gt,fd as ie,g as ni,ga as en,gb as V,gd as B,ge as Ho,ha as b,hb as Wn,i as Vl,ia as v,ib as Po,ic as y,id as Z,ja as zl,jc as M,jd as Oe,kb as S,kc as w,ke as zo,l as Ie,lc as pt,ld as sn,le as qo,m as Nl,mc as Kl,md as Ro,na as tn,nc as Mo,nd as xe,ne as Qc,od as ke,oe as Yc,p as Ct,pc as Fe,pd as Ae,q as Se,qb as te,qd as ln,ra as Ue,rb as m,rd as Ao,sa as mt,sb as xt,sc as fi,sd as Ye,se as Xc,tb as G,tc as Ql,td as Vo,ub as Io,ud as oc,v as Bl,va as Hn,vd as Xe,ve as un,w as Ll,wd as le,x as jl,xa as Sa,xc as Gn,xd as ce,y as Fi,yd as de,ye as Zc,z as Ri,zd as xi,ze as Ta}from"./chunk-EXDECSW5.js";import{a as ae,b as qe,c as Al,d as $,e as lt,f as Q}from"./chunk-EQDQRRRY.js";var Mt=$(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});function J1(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var eb=function o(t,e){J1(this,o),this.data=t,this.text=e.text||t,this.options=e};Ka.default=eb});var mm=$(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.CODE39=void 0;var tb=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),ib=Mt(),nb=ob(ib);function ob(o){return o&&o.__esModule?o:{default:o}}function rb(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function ab(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function sb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var lb=function(o){sb(t,o);function t(e,i){return rb(this,t),e=e.toUpperCase(),i.mod43&&(e+=mb(pb(e))),ab(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return tb(t,[{key:"encode",value:function(){for(var i=Qa("*"),n=0;n<this.data.length;n++)i+=Qa(this.data[n])+"0";return i+=Qa("*"),{data:i,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),t}(nb.default),cm=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],cb=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function Qa(o){return db(dm(o))}function db(o){return cb[o].toString(2)}function mb(o){return cm[o]}function dm(o){return cm.indexOf(o)}function pb(o){for(var t=0,e=0;e<o.length;e++)t+=dm(o[e]);return t=t%43,t}Lr.CODE39=lb});var In=$(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});var to;function Ya(o,t,e){return t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}var pm=We.SET_A=0,um=We.SET_B=1,fm=We.SET_C=2,_4=We.SHIFT=98,ub=We.START_A=103,fb=We.START_B=104,hb=We.START_C=105,b4=We.MODULO=103,v4=We.STOP=106,y4=We.FNC1=207,C4=We.SET_BY_CODE=(to={},Ya(to,ub,pm),Ya(to,fb,um),Ya(to,hb,fm),to),x4=We.SWAP={101:pm,100:um,99:fm},S4=We.A_START_CHAR="\xD0",E4=We.B_START_CHAR="\xD1",w4=We.C_START_CHAR="\xD2",P4=We.A_CHARS="[\0-_\xC8-\xCF]",I4=We.B_CHARS="[ -\x7F\xC8-\xCF]",M4=We.C_CHARS="(\xCF*[0-9]{2}\xCF*)",T4=We.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011]});var io=$(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});var gb=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),_b=Mt(),bb=vb(_b),Nt=In();function vb(o){return o&&o.__esModule?o:{default:o}}function yb(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Cb(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function xb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Sb=function(o){xb(t,o);function t(e,i){yb(this,t);var n=Cb(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.substring(1),i));return n.bytes=e.split("").map(function(s){return s.charCodeAt(0)}),n}return gb(t,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var i=this.bytes,n=i.shift()-105,s=Nt.SET_BY_CODE[n];if(s===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&i.unshift(Nt.FNC1);var d=t.next(i,1,s);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:t.getBar(n)+d.result+t.getBar((d.checksum+n)%Nt.MODULO)+t.getBar(Nt.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var i=this.options.ean128||!1;return typeof i=="string"&&(i=i.toLowerCase()==="true"),i}}],[{key:"getBar",value:function(i){return Nt.BARS[i]?Nt.BARS[i].toString():""}},{key:"correctIndex",value:function(i,n){if(n===Nt.SET_A){var s=i.shift();return s<32?s+64:s-32}else return n===Nt.SET_B?i.shift()-32:(i.shift()-48)*10+i.shift()-48}},{key:"next",value:function(i,n,s){if(!i.length)return{result:"",checksum:0};var d=void 0,p=void 0;if(i[0]>=200){p=i.shift()-105;var h=Nt.SWAP[p];h!==void 0?d=t.next(i,n+1,h):((s===Nt.SET_A||s===Nt.SET_B)&&p===Nt.SHIFT&&(i[0]=s===Nt.SET_A?i[0]>95?i[0]-96:i[0]:i[0]<32?i[0]+96:i[0]),d=t.next(i,n+1,s))}else p=t.correctIndex(i,s),d=t.next(i,n+1,s);var C=t.getBar(p),E=p*n;return{result:C+d.result,checksum:E+d.checksum}}}]),t}(bb.default);Xa.default=Sb});var vm=$(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});var Pi=In(),hm=function(t){return t.match(new RegExp("^"+Pi.A_CHARS+"*"))[0].length},gm=function(t){return t.match(new RegExp("^"+Pi.B_CHARS+"*"))[0].length},_m=function(t){return t.match(new RegExp("^"+Pi.C_CHARS+"*"))[0]};function Za(o,t){var e=t?Pi.A_CHARS:Pi.B_CHARS,i=o.match(new RegExp("^("+e+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(i)return i[1]+"\xCC"+bm(o.substring(i[1].length));var n=o.match(new RegExp("^"+e+"+"))[0];return n.length===o.length?o:n+String.fromCharCode(t?205:206)+Za(o.substring(n.length),!t)}function bm(o){var t=_m(o),e=t.length;if(e===o.length)return o;o=o.substring(e);var i=hm(o)>=gm(o);return t+String.fromCharCode(i?206:205)+Za(o,i)}Ja.default=function(o){var t=void 0,e=_m(o).length;if(e>=2)t=Pi.C_START_CHAR+bm(o);else{var i=hm(o)>gm(o);t=(i?Pi.A_START_CHAR:Pi.B_START_CHAR)+Za(o,i)}return t.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(n,s){return"\xCB"+s})}});var Cm=$(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});var Eb=io(),wb=ym(Eb),Pb=vm(),Ib=ym(Pb);function ym(o){return o&&o.__esModule?o:{default:o}}function Mb(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function es(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Tb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Ob=function(o){Tb(t,o);function t(e,i){if(Mb(this,t),/^[\x00-\x7F\xC8-\xD3]+$/.test(e))var n=es(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,Ib.default)(e),i));else var n=es(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return es(n)}return t}(wb.default);ts.default=Ob});var Sm=$(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});var kb=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Db=io(),Fb=Rb(Db),xm=In();function Rb(o){return o&&o.__esModule?o:{default:o}}function Ab(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Vb(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Nb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Bb=function(o){Nb(t,o);function t(e,i){return Ab(this,t),Vb(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,xm.A_START_CHAR+e,i))}return kb(t,[{key:"valid",value:function(){return new RegExp("^"+xm.A_CHARS+"+$").test(this.data)}}]),t}(Fb.default);is.default=Bb});var wm=$(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});var Lb=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),jb=io(),Ub=$b(jb),Em=In();function $b(o){return o&&o.__esModule?o:{default:o}}function Hb(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function zb(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function qb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Wb=function(o){qb(t,o);function t(e,i){return Hb(this,t),zb(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Em.B_START_CHAR+e,i))}return Lb(t,[{key:"valid",value:function(){return new RegExp("^"+Em.B_CHARS+"+$").test(this.data)}}]),t}(Ub.default);ns.default=Wb});var Im=$(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});var Gb=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Kb=io(),Qb=Yb(Kb),Pm=In();function Yb(o){return o&&o.__esModule?o:{default:o}}function Xb(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Zb(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Jb(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var ev=function(o){Jb(t,o);function t(e,i){return Xb(this,t),Zb(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Pm.C_START_CHAR+e,i))}return Gb(t,[{key:"valid",value:function(){return new RegExp("^"+Pm.C_CHARS+"+$").test(this.data)}}]),t}(Qb.default);os.default=ev});var Mm=$(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.CODE128C=mi.CODE128B=mi.CODE128A=mi.CODE128=void 0;var tv=Cm(),iv=jr(tv),nv=Sm(),ov=jr(nv),rv=wm(),av=jr(rv),sv=Im(),lv=jr(sv);function jr(o){return o&&o.__esModule?o:{default:o}}mi.CODE128=iv.default;mi.CODE128A=ov.default;mi.CODE128B=av.default;mi.CODE128C=lv.default});var Mn=$(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});var B4=Ii.SIDE_BIN="101",L4=Ii.MIDDLE_BIN="01010",j4=Ii.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},U4=Ii.EAN2_STRUCTURE=["LL","LG","GL","GG"],$4=Ii.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],H4=Ii.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]});var Tn=$(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});var cv=Mn(),dv=function(t,e,i){var n=t.split("").map(function(d,p){return cv.BINARIES[e[p]]}).map(function(d,p){return d?d[t[p]]:""});if(i){var s=t.length-1;n=n.map(function(d,p){return p<s?d+i:d})}return n.join("")};rs.default=dv});var ss=$(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});var mv=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),On=Mn(),pv=Tn(),Tm=Om(pv),uv=Mt(),fv=Om(uv);function Om(o){return o&&o.__esModule?o:{default:o}}function hv(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function gv(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function _v(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var bv=function(o){_v(t,o);function t(e,i){hv(this,t);var n=gv(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.fontSize=!i.flat&&i.fontSize>i.width*10?i.width*10:i.fontSize,n.guardHeight=i.height+n.fontSize/2+i.textMargin,n}return mv(t,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(i,n){return this.text.substr(i,n)}},{key:"leftEncode",value:function(i,n){return(0,Tm.default)(i,n)}},{key:"rightText",value:function(i,n){return this.text.substr(i,n)}},{key:"rightEncode",value:function(i,n){return(0,Tm.default)(i,n)}},{key:"encodeGuarded",value:function(){var i={fontSize:this.fontSize},n={height:this.guardHeight};return[{data:On.SIDE_BIN,options:n},{data:this.leftEncode(),text:this.leftText(),options:i},{data:On.MIDDLE_BIN,options:n},{data:this.rightEncode(),text:this.rightText(),options:i},{data:On.SIDE_BIN,options:n}]}},{key:"encodeFlat",value:function(){var i=[On.SIDE_BIN,this.leftEncode(),On.MIDDLE_BIN,this.rightEncode(),On.SIDE_BIN];return{data:i.join(""),text:this.text}}}]),t}(fv.default);as.default=bv});var Dm=$(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});var vv=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),no=function o(t,e,i){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var s=Object.getPrototypeOf(t);return s===null?void 0:o(s,e,i)}else{if("value"in n)return n.value;var d=n.get;return d===void 0?void 0:d.call(i)}},yv=Mn(),Cv=ss(),xv=Sv(Cv);function Sv(o){return o&&o.__esModule?o:{default:o}}function Ev(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function wv(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Pv(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var km=function(t){var e=t.substr(0,12).split("").map(function(i){return+i}).reduce(function(i,n,s){return s%2?i+n*3:i+n},0);return(10-e%10)%10},Iv=function(o){Pv(t,o);function t(e,i){Ev(this,t),e.search(/^[0-9]{12}$/)!==-1&&(e+=km(e));var n=wv(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.lastChar=i.lastChar,n}return vv(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===km(this.data)}},{key:"leftText",value:function(){return no(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var i=this.data.substr(1,6),n=yv.EAN13_STRUCTURE[this.data[0]];return no(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,i,n)}},{key:"rightText",value:function(){return no(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var i=this.data.substr(7,6);return no(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,i,"RRRRRR")}},{key:"encodeGuarded",value:function(){var i=no(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(i.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(i.push({data:"00"}),i.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),i}}]),t}(xv.default);ls.default=Iv});var Rm=$(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});var Mv=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Ur=function o(t,e,i){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var s=Object.getPrototypeOf(t);return s===null?void 0:o(s,e,i)}else{if("value"in n)return n.value;var d=n.get;return d===void 0?void 0:d.call(i)}},Tv=ss(),Ov=kv(Tv);function kv(o){return o&&o.__esModule?o:{default:o}}function Dv(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Fv(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Rv(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Fm=function(t){var e=t.substr(0,7).split("").map(function(i){return+i}).reduce(function(i,n,s){return s%2?i+n:i+n*3},0);return(10-e%10)%10},Av=function(o){Rv(t,o);function t(e,i){return Dv(this,t),e.search(/^[0-9]{7}$/)!==-1&&(e+=Fm(e)),Fv(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return Mv(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===Fm(this.data)}},{key:"leftText",value:function(){return Ur(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var i=this.data.substr(0,4);return Ur(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,i,"LLLL")}},{key:"rightText",value:function(){return Ur(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var i=this.data.substr(4,4);return Ur(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,i,"RRRR")}}]),t}(Ov.default);cs.default=Av});var Vm=$(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});var Vv=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Nv=Mn(),Bv=Tn(),Lv=Am(Bv),jv=Mt(),Uv=Am(jv);function Am(o){return o&&o.__esModule?o:{default:o}}function $v(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Hv(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function zv(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var qv=function(t){var e=t.split("").map(function(i){return+i}).reduce(function(i,n,s){return s%2?i+n*9:i+n*3},0);return e%10},Wv=function(o){zv(t,o);function t(e,i){return $v(this,t),Hv(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return Vv(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var i=Nv.EAN5_STRUCTURE[qv(this.data)];return{data:"1011"+(0,Lv.default)(this.data,i,"01"),text:this.text}}}]),t}(Uv.default);ds.default=Wv});var Bm=$(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});var Gv=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Kv=Mn(),Qv=Tn(),Yv=Nm(Qv),Xv=Mt(),Zv=Nm(Xv);function Nm(o){return o&&o.__esModule?o:{default:o}}function Jv(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function ey(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function ty(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var iy=function(o){ty(t,o);function t(e,i){return Jv(this,t),ey(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return Gv(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var i=Kv.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,Yv.default)(this.data,i,"01"),text:this.text}}}]),t}(Zv.default);ms.default=iy});var us=$($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});var ny=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();$r.checksum=ps;var oy=Tn(),kn=Lm(oy),ry=Mt(),ay=Lm(ry);function Lm(o){return o&&o.__esModule?o:{default:o}}function sy(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function ly(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function cy(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var dy=function(o){cy(t,o);function t(e,i){sy(this,t),e.search(/^[0-9]{11}$/)!==-1&&(e+=ps(e));var n=ly(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.displayValue=i.displayValue,i.fontSize>i.width*10?n.fontSize=i.width*10:n.fontSize=i.fontSize,n.guardHeight=i.height+n.fontSize/2+i.textMargin,n}return ny(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==ps(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var i="";return i+="101",i+=(0,kn.default)(this.data.substr(0,6),"LLLLLL"),i+="01010",i+=(0,kn.default)(this.data.substr(6,6),"RRRRRR"),i+="101",{data:i,text:this.text}}},{key:"guardedEncoding",value:function(){var i=[];return this.displayValue&&i.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),i.push({data:"101"+(0,kn.default)(this.data[0],"L"),options:{height:this.guardHeight}}),i.push({data:(0,kn.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),i.push({data:"01010",options:{height:this.guardHeight}}),i.push({data:(0,kn.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),i.push({data:(0,kn.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&i.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),i}}]),t}(ay.default);function ps(o){var t=0,e;for(e=1;e<11;e+=2)t+=parseInt(o[e]);for(e=0;e<11;e+=2)t+=parseInt(o[e])*3;return(10-t%10)%10}$r.default=dy});var $m=$(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});var my=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),py=Tn(),uy=Um(py),fy=Mt(),hy=Um(fy),gy=us();function Um(o){return o&&o.__esModule?o:{default:o}}function _y(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function fs(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function by(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var vy=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],yy=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],Cy=function(o){by(t,o);function t(e,i){_y(this,t);var n=fs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));if(n.isValid=!1,e.search(/^[0-9]{6}$/)!==-1)n.middleDigits=e,n.upcA=jm(e,"0"),n.text=i.text||""+n.upcA[0]+e+n.upcA[n.upcA.length-1],n.isValid=!0;else if(e.search(/^[01][0-9]{7}$/)!==-1)if(n.middleDigits=e.substring(1,e.length-1),n.upcA=jm(n.middleDigits,e[0]),n.upcA[n.upcA.length-1]===e[e.length-1])n.isValid=!0;else return fs(n);else return fs(n);return n.displayValue=i.displayValue,i.fontSize>i.width*10?n.fontSize=i.width*10:n.fontSize=i.fontSize,n.guardHeight=i.height+n.fontSize/2+i.textMargin,n}return my(t,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var i="";return i+="101",i+=this.encodeMiddleDigits(),i+="010101",{data:i,text:this.text}}},{key:"guardedEncoding",value:function(){var i=[];return this.displayValue&&i.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),i.push({data:"101",options:{height:this.guardHeight}}),i.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),i.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&i.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),i}},{key:"encodeMiddleDigits",value:function(){var i=this.upcA[0],n=this.upcA[this.upcA.length-1],s=yy[parseInt(n)][parseInt(i)];return(0,uy.default)(this.middleDigits,s)}}]),t}(hy.default);function jm(o,t){for(var e=parseInt(o[o.length-1]),i=vy[e],n="",s=0,d=0;d<i.length;d++){var p=i[d];p==="X"?n+=o[s++]:n+=p}return n=""+t+n,""+n+(0,gy.checksum)(n)}hs.default=Cy});var Hm=$(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.UPCE=Tt.UPC=Tt.EAN2=Tt.EAN5=Tt.EAN8=Tt.EAN13=void 0;var xy=Dm(),Sy=Dn(xy),Ey=Rm(),wy=Dn(Ey),Py=Vm(),Iy=Dn(Py),My=Bm(),Ty=Dn(My),Oy=us(),ky=Dn(Oy),Dy=$m(),Fy=Dn(Dy);function Dn(o){return o&&o.__esModule?o:{default:o}}Tt.EAN13=Sy.default;Tt.EAN8=wy.default;Tt.EAN5=Iy.default;Tt.EAN2=Ty.default;Tt.UPC=ky.default;Tt.UPCE=Fy.default});var zm=$(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});var eO=oo.START_BIN="1010",tO=oo.END_BIN="11101",iO=oo.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]});var _s=$(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});var Ry=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Hr=zm(),Ay=Mt(),Vy=Ny(Ay);function Ny(o){return o&&o.__esModule?o:{default:o}}function By(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Ly(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function jy(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Uy=function(o){jy(t,o);function t(){return By(this,t),Ly(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Ry(t,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var i=this,n=this.data.match(/.{2}/g).map(function(s){return i.encodePair(s)}).join("");return{data:Hr.START_BIN+n+Hr.END_BIN,text:this.text}}},{key:"encodePair",value:function(i){var n=Hr.BINARIES[i[1]];return Hr.BINARIES[i[0]].split("").map(function(s,d){return(s==="1"?"111":"1")+(n[d]==="1"?"000":"0")}).join("")}}]),t}(Vy.default);gs.default=Uy});var Wm=$(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});var $y=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Hy=_s(),zy=qy(Hy);function qy(o){return o&&o.__esModule?o:{default:o}}function Wy(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Gy(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Ky(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var qm=function(t){var e=t.substr(0,13).split("").map(function(i){return parseInt(i,10)}).reduce(function(i,n,s){return i+n*(3-s%2*2)},0);return Math.ceil(e/10)*10-e},Qy=function(o){Ky(t,o);function t(e,i){return Wy(this,t),e.search(/^[0-9]{13}$/)!==-1&&(e+=qm(e)),Gy(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return $y(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===qm(this.data)}}]),t}(zy.default);bs.default=Qy});var Km=$(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.ITF14=Fn.ITF=void 0;var Yy=_s(),Xy=Gm(Yy),Zy=Wm(),Jy=Gm(Zy);function Gm(o){return o&&o.__esModule?o:{default:o}}Fn.ITF=Xy.default;Fn.ITF14=Jy.default});var Rn=$(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var eC=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),tC=Mt(),iC=nC(tC);function nC(o){return o&&o.__esModule?o:{default:o}}function oC(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function rC(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function aC(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var sC=function(o){aC(t,o);function t(e,i){return oC(this,t),rC(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return eC(t,[{key:"encode",value:function(){for(var i="110",n=0;n<this.data.length;n++){var s=parseInt(this.data[n]),d=s.toString(2);d=lC(d,4-d.length);for(var p=0;p<d.length;p++)i+=d[p]=="0"?"100":"110"}return i+="1001",{data:i,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),t}(iC.default);function lC(o,t){for(var e=0;e<t;e++)o="0"+o;return o}vs.default=sC});var ro=$(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.mod10=cC;zr.mod11=dC;function cC(o){for(var t=0,e=0;e<o.length;e++){var i=parseInt(o[e]);(e+o.length)%2===0?t+=i:t+=i*2%10+Math.floor(i*2/10)}return(10-t%10)%10}function dC(o){for(var t=0,e=[2,3,4,5,6,7],i=0;i<o.length;i++){var n=parseInt(o[o.length-1-i]);t+=e[i%e.length]*n}return(11-t%11)%11}});var Qm=$(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});var mC=Rn(),pC=fC(mC),uC=ro();function fC(o){return o&&o.__esModule?o:{default:o}}function hC(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function gC(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function _C(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var bC=function(o){_C(t,o);function t(e,i){return hC(this,t),gC(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,uC.mod10)(e),i))}return t}(pC.default);ys.default=bC});var Ym=$(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});var vC=Rn(),yC=xC(vC),CC=ro();function xC(o){return o&&o.__esModule?o:{default:o}}function SC(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function EC(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function wC(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var PC=function(o){wC(t,o);function t(e,i){return SC(this,t),EC(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,CC.mod11)(e),i))}return t}(yC.default);Cs.default=PC});var Zm=$(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});var IC=Rn(),MC=TC(IC),Xm=ro();function TC(o){return o&&o.__esModule?o:{default:o}}function OC(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function kC(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function DC(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var FC=function(o){DC(t,o);function t(e,i){return OC(this,t),e+=(0,Xm.mod10)(e),e+=(0,Xm.mod10)(e),kC(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return t}(MC.default);xs.default=FC});var ep=$(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});var RC=Rn(),AC=VC(RC),Jm=ro();function VC(o){return o&&o.__esModule?o:{default:o}}function NC(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function BC(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function LC(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var jC=function(o){LC(t,o);function t(e,i){return NC(this,t),e+=(0,Jm.mod11)(e),e+=(0,Jm.mod10)(e),BC(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return t}(AC.default);Ss.default=jC});var tp=$(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.MSI1110=Wt.MSI1010=Wt.MSI11=Wt.MSI10=Wt.MSI=void 0;var UC=Rn(),$C=ao(UC),HC=Qm(),zC=ao(HC),qC=Ym(),WC=ao(qC),GC=Zm(),KC=ao(GC),QC=ep(),YC=ao(QC);function ao(o){return o&&o.__esModule?o:{default:o}}Wt.MSI=$C.default;Wt.MSI10=zC.default;Wt.MSI11=WC.default;Wt.MSI1010=KC.default;Wt.MSI1110=YC.default});var ip=$(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.pharmacode=void 0;var XC=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),ZC=Mt(),JC=ex(ZC);function ex(o){return o&&o.__esModule?o:{default:o}}function tx(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function ix(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function nx(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var ox=function(o){nx(t,o);function t(e,i){tx(this,t);var n=ix(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.number=parseInt(e,10),n}return XC(t,[{key:"encode",value:function(){for(var i=this.number,n="";!isNaN(i)&&i!=0;)i%2===0?(n="11100"+n,i=(i-2)/2):(n="100"+n,i=(i-1)/2);return n=n.slice(0,-2),{data:n,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t}(JC.default);qr.pharmacode=ox});var np=$(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.codabar=void 0;var rx=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),ax=Mt(),sx=lx(ax);function lx(o){return o&&o.__esModule?o:{default:o}}function cx(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function dx(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function mx(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var px=function(o){mx(t,o);function t(e,i){cx(this,t),e.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(e="A"+e+"A");var n=dx(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.toUpperCase(),i));return n.text=n.options.text||n.text.replace(/[A-D]/g,""),n}return rx(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var i=[],n=this.getEncodings(),s=0;s<this.data.length;s++)i.push(n[this.data.charAt(s)]),s!==this.data.length-1&&i.push("0");return{text:this.text,data:i.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t}(sx.default);Wr.codabar=px});var op=$(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});var gO=so.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","\xFF"],_O=so.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],bO=so.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"\x7F":["(%)","T"]}});var ws=$(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});var ux=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Gr=op(),fx=Mt(),hx=gx(fx);function gx(o){return o&&o.__esModule?o:{default:o}}function _x(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function bx(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function vx(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var yx=function(o){vx(t,o);function t(e,i){return _x(this,t),bx(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return ux(t,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var i=this.data.split("").flatMap(function(p){return Gr.MULTI_SYMBOLS[p]||p}),n=i.map(function(p){return t.getEncoding(p)}).join(""),s=t.checksum(i,20),d=t.checksum(i.concat(s),15);return{text:this.text,data:t.getEncoding("\xFF")+n+t.getEncoding(s)+t.getEncoding(d)+t.getEncoding("\xFF")+"1"}}}],[{key:"getEncoding",value:function(i){return Gr.BINARIES[t.symbolValue(i)]}},{key:"getSymbol",value:function(i){return Gr.SYMBOLS[i]}},{key:"symbolValue",value:function(i){return Gr.SYMBOLS.indexOf(i)}},{key:"checksum",value:function(i,n){var s=i.slice().reverse().reduce(function(d,p,h){var C=h%n+1;return d+t.symbolValue(p)*C},0);return t.getSymbol(s%47)}}]),t}(hx.default);Es.default=yx});var rp=$(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});var Cx=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),xx=ws(),Sx=Ex(xx);function Ex(o){return o&&o.__esModule?o:{default:o}}function wx(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Px(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Ix(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var Mx=function(o){Ix(t,o);function t(e,i){return wx(this,t),Px(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return Cx(t,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),t}(Sx.default);Ps.default=Mx});var sp=$(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.CODE93FullASCII=An.CODE93=void 0;var Tx=ws(),Ox=ap(Tx),kx=rp(),Dx=ap(kx);function ap(o){return o&&o.__esModule?o:{default:o}}An.CODE93=Ox.default;An.CODE93FullASCII=Dx.default});var lp=$(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.GenericBarcode=void 0;var Fx=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),Rx=Mt(),Ax=Vx(Rx);function Vx(o){return o&&o.__esModule?o:{default:o}}function Nx(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function Bx(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Lx(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var jx=function(o){Lx(t,o);function t(e,i){return Nx(this,t),Bx(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return Fx(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t}(Ax.default);Kr.GenericBarcode=jx});var mp=$(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Ux=mm(),Qr=Mm(),Vn=Hm(),cp=Km(),lo=tp(),$x=ip(),Hx=np(),dp=sp(),zx=lp();Is.default={CODE39:Ux.CODE39,CODE128:Qr.CODE128,CODE128A:Qr.CODE128A,CODE128B:Qr.CODE128B,CODE128C:Qr.CODE128C,EAN13:Vn.EAN13,EAN8:Vn.EAN8,EAN5:Vn.EAN5,EAN2:Vn.EAN2,UPC:Vn.UPC,UPCE:Vn.UPCE,ITF14:cp.ITF14,ITF:cp.ITF,MSI:lo.MSI,MSI10:lo.MSI10,MSI11:lo.MSI11,MSI1010:lo.MSI1010,MSI1110:lo.MSI1110,pharmacode:$x.pharmacode,codabar:Hx.codabar,CODE93:dp.CODE93,CODE93FullASCII:dp.CODE93FullASCII,GenericBarcode:zx.GenericBarcode}});var co=$(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});var qx=Object.assign||function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i])}return o};Ms.default=function(o,t){return qx({},o,t)}});var pp=$(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.default=Wx;function Wx(o){var t=[];function e(i){if(Array.isArray(i))for(var n=0;n<i.length;n++)e(i[n]);else i.text=i.text||"",i.data=i.data||"",t.push(i)}return e(o),t}});var up=$(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.default=Gx;function Gx(o){return o.marginTop=o.marginTop||o.margin,o.marginBottom=o.marginBottom||o.margin,o.marginRight=o.marginRight||o.margin,o.marginLeft=o.marginLeft||o.margin,o}});var Ds=$(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.default=Kx;function Kx(o){var t=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var e in t)t.hasOwnProperty(e)&&(e=t[e],typeof o[e]=="string"&&(o[e]=parseInt(o[e],10)));return typeof o.displayValue=="string"&&(o.displayValue=o.displayValue!="false"),o}});var Rs=$(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});var Qx={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};Fs.default=Qx});var gp=$(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});var Yx=Ds(),Xx=hp(Yx),Zx=Rs(),fp=hp(Zx);function hp(o){return o&&o.__esModule?o:{default:o}}function Jx(o){var t={};for(var e in fp.default)fp.default.hasOwnProperty(e)&&(o.hasAttribute("jsbarcode-"+e.toLowerCase())&&(t[e]=o.getAttribute("jsbarcode-"+e.toLowerCase())),o.hasAttribute("data-"+e.toLowerCase())&&(t[e]=o.getAttribute("data-"+e.toLowerCase())));return t.value=o.getAttribute("jsbarcode-value")||o.getAttribute("data-value"),t=(0,Xx.default)(t),t}As.default=Jx});var Vs=$(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.getTotalWidthOfEncodings=Gt.calculateEncodingAttributes=Gt.getBarcodePadding=Gt.getEncodingHeight=Gt.getMaximumHeightOfEncodings=void 0;var e2=co(),t2=i2(e2);function i2(o){return o&&o.__esModule?o:{default:o}}function _p(o,t){return t.height+(t.displayValue&&o.text.length>0?t.fontSize+t.textMargin:0)+t.marginTop+t.marginBottom}function bp(o,t,e){if(e.displayValue&&t<o){if(e.textAlign=="center")return Math.floor((o-t)/2);if(e.textAlign=="left")return 0;if(e.textAlign=="right")return Math.floor(o-t)}return 0}function n2(o,t,e){for(var i=0;i<o.length;i++){var n=o[i],s=(0,t2.default)(t,n.options),d;s.displayValue?d=a2(n.text,s,e):d=0;var p=n.data.length*s.width;n.width=Math.ceil(Math.max(d,p)),n.height=_p(n,s),n.barcodePadding=bp(d,p,s)}}function o2(o){for(var t=0,e=0;e<o.length;e++)t+=o[e].width;return t}function r2(o){for(var t=0,e=0;e<o.length;e++)o[e].height>t&&(t=o[e].height);return t}function a2(o,t,e){var i;if(e)i=e;else if(typeof document<"u")i=document.createElement("canvas").getContext("2d");else return 0;i.font=t.fontOptions+" "+t.fontSize+"px "+t.font;var n=i.measureText(o);if(!n)return 0;var s=n.width;return s}Gt.getMaximumHeightOfEncodings=r2;Gt.getEncodingHeight=_p;Gt.getBarcodePadding=bp;Gt.calculateEncodingAttributes=n2;Gt.getTotalWidthOfEncodings=o2});var vp=$(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var s2=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),l2=co(),c2=d2(l2),Ns=Vs();function d2(o){return o&&o.__esModule?o:{default:o}}function m2(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var p2=function(){function o(t,e,i){m2(this,o),this.canvas=t,this.encodings=e,this.options=i}return s2(o,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var e=0;e<this.encodings.length;e++){var i=(0,c2.default)(this.options,this.encodings[e].options);this.drawCanvasBarcode(i,this.encodings[e]),this.drawCanvasText(i,this.encodings[e]),this.moveCanvasDrawing(this.encodings[e])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var e=this.canvas.getContext("2d");e.save(),(0,Ns.calculateEncodingAttributes)(this.encodings,this.options,e);var i=(0,Ns.getTotalWidthOfEncodings)(this.encodings),n=(0,Ns.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=i+this.options.marginLeft+this.options.marginRight,this.canvas.height=n,e.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(e.fillStyle=this.options.background,e.fillRect(0,0,this.canvas.width,this.canvas.height)),e.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(e,i){var n=this.canvas.getContext("2d"),s=i.data,d;e.textPosition=="top"?d=e.marginTop+e.fontSize+e.textMargin:d=e.marginTop,n.fillStyle=e.lineColor;for(var p=0;p<s.length;p++){var h=p*e.width+i.barcodePadding;s[p]==="1"?n.fillRect(h,d,e.width,e.height):s[p]&&n.fillRect(h,d,e.width,e.height*s[p])}}},{key:"drawCanvasText",value:function(e,i){var n=this.canvas.getContext("2d"),s=e.fontOptions+" "+e.fontSize+"px "+e.font;if(e.displayValue){var d,p;e.textPosition=="top"?p=e.marginTop+e.fontSize-e.textMargin:p=e.height+e.textMargin+e.marginTop+e.fontSize,n.font=s,e.textAlign=="left"||i.barcodePadding>0?(d=0,n.textAlign="left"):e.textAlign=="right"?(d=i.width-1,n.textAlign="right"):(d=i.width/2,n.textAlign="center"),n.fillText(i.text,d,p)}}},{key:"moveCanvasDrawing",value:function(e){var i=this.canvas.getContext("2d");i.translate(e.width,0)}},{key:"restoreCanvas",value:function(){var e=this.canvas.getContext("2d");e.restore()}}]),o}();Bs.default=p2});var yp=$(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});var u2=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),f2=co(),h2=g2(f2),Ls=Vs();function g2(o){return o&&o.__esModule?o:{default:o}}function _2(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var Yr="http://www.w3.org/2000/svg",b2=function(){function o(t,e,i){_2(this,o),this.svg=t,this.encodings=e,this.options=i,this.document=i.xmlDocument||document}return u2(o,[{key:"render",value:function(){var e=this.options.marginLeft;this.prepareSVG();for(var i=0;i<this.encodings.length;i++){var n=this.encodings[i],s=(0,h2.default)(this.options,n.options),d=this.createGroup(e,s.marginTop,this.svg);this.setGroupOptions(d,s),this.drawSvgBarcode(d,s,n),this.drawSVGText(d,s,n),e+=n.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,Ls.calculateEncodingAttributes)(this.encodings,this.options);var e=(0,Ls.getTotalWidthOfEncodings)(this.encodings),i=(0,Ls.getMaximumHeightOfEncodings)(this.encodings),n=e+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(n,i),this.options.background&&this.drawRect(0,0,n,i,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(e,i,n){var s=n.data,d;i.textPosition=="top"?d=i.fontSize+i.textMargin:d=0;for(var p=0,h=0,C=0;C<s.length;C++)h=C*i.width+n.barcodePadding,s[C]==="1"?p++:p>0&&(this.drawRect(h-i.width*p,d,i.width*p,i.height,e),p=0);p>0&&this.drawRect(h-i.width*(p-1),d,i.width*p,i.height,e)}},{key:"drawSVGText",value:function(e,i,n){var s=this.document.createElementNS(Yr,"text");if(i.displayValue){var d,p;s.setAttribute("style","font:"+i.fontOptions+" "+i.fontSize+"px "+i.font),i.textPosition=="top"?p=i.fontSize-i.textMargin:p=i.height+i.textMargin+i.fontSize,i.textAlign=="left"||n.barcodePadding>0?(d=0,s.setAttribute("text-anchor","start")):i.textAlign=="right"?(d=n.width-1,s.setAttribute("text-anchor","end")):(d=n.width/2,s.setAttribute("text-anchor","middle")),s.setAttribute("x",d),s.setAttribute("y",p),s.appendChild(this.document.createTextNode(n.text)),e.appendChild(s)}}},{key:"setSvgAttributes",value:function(e,i){var n=this.svg;n.setAttribute("width",e+"px"),n.setAttribute("height",i+"px"),n.setAttribute("x","0px"),n.setAttribute("y","0px"),n.setAttribute("viewBox","0 0 "+e+" "+i),n.setAttribute("xmlns",Yr),n.setAttribute("version","1.1"),n.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(e,i,n){var s=this.document.createElementNS(Yr,"g");return s.setAttribute("transform","translate("+e+", "+i+")"),n.appendChild(s),s}},{key:"setGroupOptions",value:function(e,i){e.setAttribute("style","fill:"+i.lineColor+";")}},{key:"drawRect",value:function(e,i,n,s,d){var p=this.document.createElementNS(Yr,"rect");return p.setAttribute("x",e),p.setAttribute("y",i),p.setAttribute("width",n),p.setAttribute("height",s),d.appendChild(p),p}}]),o}();js.default=b2});var Cp=$(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});var v2=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function y2(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var C2=function(){function o(t,e,i){y2(this,o),this.object=t,this.encodings=e,this.options=i}return v2(o,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),o}();Us.default=C2});var xp=$(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});var x2=vp(),S2=$s(x2),E2=yp(),w2=$s(E2),P2=Cp(),I2=$s(P2);function $s(o){return o&&o.__esModule?o:{default:o}}Hs.default={CanvasRenderer:S2.default,SVGRenderer:w2.default,ObjectRenderer:I2.default}});var Gs=$(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});function zs(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function qs(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function Ws(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var M2=function(o){Ws(t,o);function t(e,i){zs(this,t);var n=qs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.name="InvalidInputException",n.symbology=e,n.input=i,n.message='"'+n.input+'" is not a valid input for '+n.symbology,n}return t}(Error),T2=function(o){Ws(t,o);function t(){zs(this,t);var e=qs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="InvalidElementException",e.message="Not supported type to render on",e}return t}(Error),O2=function(o){Ws(t,o);function t(){zs(this,t);var e=qs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="NoElementException",e.message="No element to render on.",e}return t}(Error);mo.InvalidInputException=M2;mo.InvalidElementException=T2;mo.NoElementException=O2});var Ep=$(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});var k2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},D2=gp(),Ks=Sp(D2),F2=xp(),po=Sp(F2),R2=Gs();function Sp(o){return o&&o.__esModule?o:{default:o}}function Qs(o){if(typeof o=="string")return A2(o);if(Array.isArray(o)){for(var t=[],e=0;e<o.length;e++)t.push(Qs(o[e]));return t}else{if(typeof HTMLCanvasElement<"u"&&o instanceof HTMLImageElement)return V2(o);if(o&&o.nodeName&&o.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&o instanceof SVGElement)return{element:o,options:(0,Ks.default)(o),renderer:po.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement)return{element:o,options:(0,Ks.default)(o),renderer:po.default.CanvasRenderer};if(o&&o.getContext)return{element:o,renderer:po.default.CanvasRenderer};if(o&&(typeof o>"u"?"undefined":k2(o))==="object"&&!o.nodeName)return{element:o,renderer:po.default.ObjectRenderer};throw new R2.InvalidElementException}}function A2(o){var t=document.querySelectorAll(o);if(t.length!==0){for(var e=[],i=0;i<t.length;i++)e.push(Qs(t[i]));return e}}function V2(o){var t=document.createElement("canvas");return{element:t,options:(0,Ks.default)(o),renderer:po.default.CanvasRenderer,afterRender:function(){o.setAttribute("src",t.toDataURL())}}}Ys.default=Qs});var wp=$(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});var N2=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function B2(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var L2=function(){function o(t){B2(this,o),this.api=t}return N2(o,[{key:"handleCatch",value:function(e){if(e.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw e.message;else throw e;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(e){try{var i=e.apply(void 0,arguments);return this.api._options.valid(!0),i}catch(n){return this.handleCatch(n),this.api}}}]),o}();Xs.default=L2});var el=$((LO,Dp)=>{"use strict";var j2=mp(),Ki=Mi(j2),U2=co(),uo=Mi(U2),$2=pp(),Ip=Mi($2),H2=up(),Pp=Mi(H2),z2=Ep(),q2=Mi(z2),W2=Ds(),G2=Mi(W2),K2=wp(),Q2=Mi(K2),Mp=Gs(),Y2=Rs(),Tp=Mi(Y2);function Mi(o){return o&&o.__esModule?o:{default:o}}var bi=function(){},Xr=function(t,e,i){var n=new bi;if(typeof t>"u")throw Error("No element to render on was provided.");return n._renderProperties=(0,q2.default)(t),n._encodings=[],n._options=Tp.default,n._errorHandler=new Q2.default(n),typeof e<"u"&&(i=i||{},i.format||(i.format=kp()),n.options(i)[i.format](e,i).render()),n};Xr.getModule=function(o){return Ki.default[o]};for(Zs in Ki.default)Ki.default.hasOwnProperty(Zs)&&X2(Ki.default,Zs);var Zs;function X2(o,t){bi.prototype[t]=bi.prototype[t.toUpperCase()]=bi.prototype[t.toLowerCase()]=function(e,i){var n=this;return n._errorHandler.wrapBarcodeCall(function(){i.text=typeof i.text>"u"?void 0:""+i.text;var s=(0,uo.default)(n._options,i);s=(0,G2.default)(s);var d=o[t],p=Op(e,d,s);return n._encodings.push(p),n})}}function Op(o,t,e){o=""+o;var i=new t(o,e);if(!i.valid())throw new Mp.InvalidInputException(i.constructor.name,o);var n=i.encode();n=(0,Ip.default)(n);for(var s=0;s<n.length;s++)n[s].options=(0,uo.default)(e,n[s].options);return n}function kp(){return Ki.default.CODE128?"CODE128":Object.keys(Ki.default)[0]}bi.prototype.options=function(o){return this._options=(0,uo.default)(this._options,o),this};bi.prototype.blank=function(o){var t=new Array(o+1).join("0");return this._encodings.push({data:t}),this};bi.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var o;for(var t in this._renderProperties){o=this._renderProperties[t];var e=(0,uo.default)(this._options,o.options);e.format=="auto"&&(e.format=kp()),this._errorHandler.wrapBarcodeCall(function(){var i=e.value,n=Ki.default[e.format.toUpperCase()],s=Op(i,n,e);Js(o,s,e)})}}};bi.prototype.render=function(){if(!this._renderProperties)throw new Mp.NoElementException;if(Array.isArray(this._renderProperties))for(var o=0;o<this._renderProperties.length;o++)Js(this._renderProperties[o],this._encodings,this._options);else Js(this._renderProperties,this._encodings,this._options);return this};bi.prototype._defaults=Tp.default;function Js(o,t,e){t=(0,Ip.default)(t);for(var i=0;i<t.length;i++)t[i].options=(0,uo.default)(e,t[i].options),(0,Pp.default)(t[i].options);(0,Pp.default)(e);var n=o.renderer,s=new n(o.element,t,e);s.render(),o.afterRender&&o.afterRender()}typeof window<"u"&&(window.JsBarcode=Xr);typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(o,t){var e=[];return jQuery(this).each(function(){e.push(this)}),Xr(e,o,t)});Dp.exports=Xr});var Cd=J.apiUrl,Ne=class o{constructor(t,e){this.router=t;this.http=e;this.cargarStorage()}apiUrl=`${J.apiUrl}/auth`;isLoginVisible=new ni(!1);isEditProfileVisible=new ni(!1);isChangePasswordVisible=new ni(!1);userNombreSubject=new ni(localStorage.getItem("user_nombre"));userRolSubject=new ni(localStorage.getItem("user_rol"));usuarioSubject=new ni(this.getUserData());usuario$=this.usuarioSubject.asObservable();farmaciaSubject=new ni(this.getFarmaciaData());farmacia$=this.farmaciaSubject.asObservable();token="";usuario=null;userNombre$=this.userNombreSubject.asObservable();userRol$=this.userRolSubject.asObservable();login(t,e,i){let n=`${Cd}/auth/login`,s={usuario:t,password:e};return i&&(s.firma=i),this.http.post(n,s).pipe(Vi(d=>{d?.token&&d?.user&&(this.guardarToken(d.token),localStorage.setItem("usuario",JSON.stringify(d.user)),this.usuario=d.user,this.usuarioSubject.next(d.user))}))}fetchUserDataFromBackend(){let t=localStorage.getItem("auth_token");if(!t)return;let e=new ne({"x-auth-token":t,"Content-Type":"application/json"}),i={};this.http.get(`${this.apiUrl}/me`,{headers:e}).subscribe({next:n=>{n.usuario&&(localStorage.setItem("user_nombre",n.usuario.nombre),localStorage.setItem("user_rol",n.usuario.rol),localStorage.setItem("user_email",n.usuario.email),localStorage.setItem("user_farmacia",n.usuario.farmacia),localStorage.setItem("user_telefono",n.usuario.telefono),localStorage.setItem("user_domicilio",n.usuario.domicilio),this.userNombreSubject.next(n.usuario.nombre),this.userRolSubject.next(n.usuario.rol))},error:n=>{console.error("\u274C Error al obtener datos del usuario:",n)}})}register(t,e,i,n,s){let d=new ne({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/auto-register`,{nombre:t,password:e,email:i,telefono:n,domicilio:s},{headers:d})}setUserData(t,e,i,n="",s=null,d="",p=""){localStorage.setItem("auth_token",t),localStorage.setItem("user_nombre",e),localStorage.setItem("user_rol",i),localStorage.setItem("user_email",n),d&&localStorage.setItem("user_telefono",d),p&&localStorage.setItem("user_domicilio",p),localStorage.setItem("user_farmacia",JSON.stringify(s)),this.userNombreSubject.next(e),this.userRolSubject.next(i),this.setFarmacia(s)}logout(){this.token="",this.usuario=null,localStorage.clear(),this.farmaciaSubject.next(null),this.usuarioSubject.next(null),this.router.navigateByUrl("/")}guardarToken(t){this.token=t,localStorage.setItem("token",t)}cargarStorage(){let t=localStorage.getItem("token"),e=localStorage.getItem("usuario");this.token=t||"";try{this.usuario=e&&e!=="undefined"?JSON.parse(e):null}catch(i){console.error("\u274C Error al parsear usuario en cargarStorage:",i),this.usuario=null,localStorage.removeItem("usuario")}}getUsuario(){return this.usuario}getUserData(){let t=localStorage.getItem("usuario");try{return t&&t!=="undefined"?JSON.parse(t):null}catch(e){return console.error("Error al parsear usuario del localStorage:",e),null}}getFarmaciaData(){let t=localStorage.getItem("user_farmacia");try{return t?JSON.parse(t):null}catch{return null}}showLogin(){this.isLoginVisible.next(!0)}hideLogin(){this.isLoginVisible.next(!1)}changePassword(t,e,i){let n=localStorage.getItem("auth_token");if(!n)return console.error("No hay token en localStorage"),Nl(()=>new Error("No hay token disponible"));let s=new ne({"x-auth-token":n||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/change-password`,{passwordActual:t,nuevaPassword:e,confirmarPassword:i},{headers:s})}showChangePassword(){this.isChangePasswordVisible.next(!0),this.isEditProfileVisible.next(!1)}hideChangePassword(){this.isChangePasswordVisible.next(!1)}showEditProfile(){this.isEditProfileVisible.next(!0)}hideEditProfile(){this.isEditProfileVisible.next(!1)}updateUser(t,e,i,n,s){let d=localStorage.getItem("auth_token");if(!d)return console.error("\u274C No hay token disponible, la solicitud ser\xE1 rechazada."),new ii(h=>{h.error({mensaje:"No hay token de autenticaci\xF3n."})});let p=new ne({"Content-Type":"application/json","x-auth-token":d});return this.http.put(`${this.apiUrl}/update`,{nombre:t,password:e,email:i,telefono:n,domicilio:s},{headers:p})}isAuthenticated(){let t=localStorage.getItem("token");if(!t)return!1;try{let i=JSON.parse(atob(t.split(".")[1])).exp,n=Math.floor(Date.now()/1e3);return i>n}catch{return!1}}get isLoggedIn(){return this.isAuthenticated()}tieneRol(t){let e=this.getUserData();return e&&t.includes(e.rol)}verificaToken(){let t=`${Cd}/auth/renew`;return this.http.get(t).pipe(Vi(e=>{this.guardarToken(e.token),localStorage.setItem("usuario",JSON.stringify(e.usuario)),this.usuario=e.usuario,this.usuarioSubject.next(e.usuario)}),Se(()=>!0),Lt(()=>(this.logout(),Ie(!1))))}notifyUserChange(){let t=this.getUserData(),e=localStorage.getItem("token");t&&e?(this.usuarioSubject.next(t),this.userNombreSubject.next(t.nombre),this.userRolSubject.next(t.rol)):(this.usuarioSubject.next(null),this.userNombreSubject.next(null),this.userRolSubject.next(null))}getPayload(t){try{return JSON.parse(atob(t.split(".")[1]))}catch{return null}}getUserId(){return localStorage.getItem("user_id")}setFarmacia(t){t?localStorage.setItem("user_farmacia",JSON.stringify(t)):localStorage.removeItem("user_farmacia"),this.farmaciaSubject.next(t)}obtenerFirma(t){return this.http.get(`${J.apiUrl}/farmacias/firma/${t}`)}static \u0275fac=function(e){return new(e||o)(he(St),he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var Yo=class o{constructor(t){this.authService=t}ngOnInit(){this.authService.notifyUserChange()}static \u0275fac=function(e){return new(e||o)(P(Ne))};static \u0275cmp=V({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){e&1&&f(0,"router-outlet")},dependencies:[Fo],encapsulation:2})};var Pt=o=>{let t=K(Ne),e=K(St);if(!t.isAuthenticated())return e.navigate(["/login"]),!1;let i=t.getUserData(),n=i?.rol,s=o.data?.rolesPermitidos;if(!n)return console.warn("\u26A0\uFE0F Usuario inv\xE1lido o sin rol:",i),e.navigate(["/login"]),!1;if(!s||s.includes(n)){if(n==="empleado"){let d=["ventas","pedidos","devoluciones"],p=localStorage.getItem("corte_activo");if(d.includes(o.routeConfig?.path||"")&&!p)return e.navigate(["/inicio-turno"]),!1}return!0}return e.navigate(["/home"]),!1};function Au(o,t){if(o&1&&f(0,"button",18),o&2){let e=t.index,i=u(2);G("active",e===i.activeSlideIndex),te("data-bs-slide-to",e)("aria-label","Slide "+(e+1))}}function Vu(o,t){if(o&1&&(a(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"div",11),f(5,"img",12),a(6,"div",13)(7,"h5",14),c(8),r(),a(9,"p",15),c(10),r()()()()()(),a(11,"div",16),S(12,Au,1,4,"button",17),r()()),o&2){let e=t.$implicit,i=t.index,n=u();G("active",i===0),l(5),m("src",e.image,Ni)("alt",e.image),l(3),_(e.title),l(2),_(e.description),l(2),m("ngForOf",n.carouselItems)}}var Xo=class o{carouselItems=[{image:"./assets/images/PromoLunes.jfif",title:"LUNES !! de Bienestar",description:"Aprovecha nuestros descuentos en medicamentos seleccionados."},{image:"./assets/images/ofer4x3.png",title:"Paga 3 y ll\xE9vate 4",description:"Ahorra a\xFAn m\xE1s con nuestras grandes ofertas, consulta productos participantes"},{image:"./assets/images/bebes.jfif",title:"Cuida a tu Beb\xE9",description:"Encuentra productos esenciales para el cuidado de tu beb\xE9."},{image:"./assets/images/prodBelleza.jfif",title:"Productos de Belleza",description:"Descubre nuestra l\xEDnea de productos de belleza y bienestar."},{image:"./assets/images/saludSex.jfif",title:"Salud Sexual y Bienestar",description:"Todo lo que necesitas para tu salud y bienestar \xEDntimo."}];activeSlideIndex=0;ngAfterViewInit(){let t=document.getElementById("carouselExampleIndicators");t&&t.addEventListener("slid.bs.carousel",e=>{this.activeSlideIndex=e.to})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-carousel"]],decls:7,vars:1,consts:[["id","carouselExampleIndicators","data-bs-ride","carousel",1,"carousel","slide","mt-6","mx-auto"],[1,"carousel-inner","text-center"],["class","carousel-item",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"carousel-item"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6"],[1,"card","custom-carousel-card"],[1,"card-img-top","custom-carousel-image",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"carousel-indicators"],["type","button","data-bs-target","#carouselExampleIndicators",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1),S(2,Vu,13,7,"div",2),r(),a(3,"button",3),f(4,"span",4),r(),a(5,"button",5),f(6,"span",6),r()()),e&2&&(l(2),m("ngForOf",i.carouselItems))},dependencies:[j,Y],styles:[".carousel[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto;padding-top:50px}.mt-6[_ngcontent-%COMP%]{margin-top:4rem}.carousel-inner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;overflow:hidden}.carousel-item[_ngcontent-%COMP%]{margin-right:0;backface-visibility:hidden;transition:transform .6s ease-in-out}.custom-carousel-card[_ngcontent-%COMP%]{width:100%;max-width:800px;margin:auto;border-radius:10px;overflow:hidden;box-shadow:0 4px 6px #0003;background-color:#007bff;color:#fff}.custom-carousel-image[_ngcontent-%COMP%]{width:100%;object-fit:cover}.carousel-control-prev[_ngcontent-%COMP%], .carousel-control-next[_ngcontent-%COMP%]{filter:invert(100%);width:6%;opacity:.8;transition:all .3s ease-in-out}.carousel-control-prev[_ngcontent-%COMP%]{left:8rem}.carousel-control-next[_ngcontent-%COMP%]{right:8rem}.carousel-control-prev[_ngcontent-%COMP%]:hover, .carousel-control-next[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.2)}.card-body[_ngcontent-%COMP%]{padding:5px}.card-text[_ngcontent-%COMP%]{margin-bottom:0}.carousel-indicators[_ngcontent-%COMP%]{position:relative;bottom:-10px;margin-top:0;display:flex;justify-content:center;align-items:center}.carousel-indicators[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background-color:#00000080;border:none;margin:10px;transition:background-color .3s ease-in-out}.carousel-indicators[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{background-color:#007bff;width:14px;height:14px}"]})};function Nu(o,t){o&1&&f(0,"img",5)}var Zo=class o{constructor(t,e){this.authService=t;this.cdRef=e}ngOnInit(){this.authService.isEditProfileVisible.subscribe(()=>{this.cdRef.detectChanges()})}isLoginVisible(){return this.authService.isLoginVisible.value}static \u0275fac=function(e){return new(e||o)(P(Ne),P(Fe))};static \u0275cmp=V({type:o,selectors:[["app-home"]],decls:8,vars:1,consts:[[1,"home-container"],["src","assets/images/farmBienLogo.png","alt","Imagen Home","class","home-image",4,"ngIf"],[1,"text-container"],[1,"text-2xl","font-bold"],[1,"mt-1"],["src","assets/images/farmBienLogo.png","alt","Imagen Home",1,"home-image"]],template:function(e,i){e&1&&(a(0,"div",0),S(1,Nu,1,0,"img",1),a(2,"div",2)(3,"h2",3),c(4,"Bienvenido a Farmacias del Bienestar"),r(),a(5,"p",4),c(6,"Encuentra los mejores productos y consultorio m\xE9dico."),r()()(),f(7,"app-carousel")),e&2&&(l(),m("ngIf",!i.authService.isLoginVisible.value&&!i.authService.isEditProfileVisible.value))},dependencies:[j,z,Xo],styles:[".home-container[_ngcontent-%COMP%]{position:relative;z-index:10;text-align:left;padding:0;margin-top:0}.text-container[_ngcontent-%COMP%]{position:absolute;text-align:left;max-width:600px;margin-left:40px}.home-image[_ngcontent-%COMP%]{position:absolute;top:10px;right:20px!important;width:150px;height:auto}"]})};var tr=lt(_t());var Jo=lt(_t());function Bu(o,t){if(o&1&&(a(0,"option",6),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}var er=class o{constructor(t,e){this.farmaciaService=t;this.http=e}farmacias=[];farmaciaSeleccionada="";farmaciaConfirmada=new Ue;ngOnInit(){let t=localStorage.getItem("token");this.farmaciaService.obtenerFarmacias().subscribe({next:e=>this.farmacias=e,error:()=>Jo.default.fire("Error","No se pudieron cargar las farmacias","error")})}confirmar(){if(!this.farmaciaSeleccionada){Jo.default.fire({icon:"error",title:"Selecci\xF3n de Farmacia",text:"\xA1Por favor, selecciona una farmacia para continuar!"});return}let t=this.farmacias.find(i=>i._id===this.farmaciaSeleccionada);if(!t){console.error("Farmacia no encontrada");return}let e={_id:t._id,nombre:t.nombre,direccion:t.direccion,telefono:t.telefono};localStorage.setItem("user_farmacia",JSON.stringify(e)),this.farmaciaConfirmada.emit(e),Jo.default.fire({icon:"success",title:"Inicio de sesi\xF3n exitoso",text:"Bienvenido, administrador",timer:1e3,showConfirmButton:!1})}static \u0275fac=function(e){return new(e||o)(P(ze),P(ge))};static \u0275cmp=V({type:o,selectors:[["app-farmacia-selector"]],outputs:{farmaciaConfirmada:"farmaciaConfirmada"},decls:10,vars:2,consts:[[1,"modal-overlay"],[1,"modal-content"],[1,"selectPharma",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"mt-3","login-logout-button",3,"click"],[3,"value"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h4"),c(3,"Selecciona una farmacia"),r(),a(4,"select",2),k("ngModelChange",function(s){return O(i.farmaciaSeleccionada,s)||(i.farmaciaSeleccionada=s),s}),a(5,"option",3),c(6,"-- Elige una farmacia --"),r(),S(7,Bu,2,2,"option",4),r(),a(8,"button",5),g("click",function(){return i.confirmar()}),c(9,"Confirmar"),r()()()),e&2&&(l(4),T("ngModel",i.farmaciaSeleccionada),l(3),m("ngForOf",i.farmacias))},dependencies:[j,Y,me,ce,de,le,Z,xe],styles:[".modal-overlay[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding-top:20px;padding-bottom:20px}.modal-content[_ngcontent-%COMP%]{padding:8px;background:#f1fbfb;border-radius:5px;box-shadow:-6px 0 6px #1303fa33;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.selectPharma[_ngcontent-%COMP%]{border-radius:5px;width:90%;height:32px;color:#00f}"]})};var Lu=o=>({"-webkit-text-security":o});function ju(o,t){if(o&1){let e=I();a(0,"form",6),g("ngSubmit",function(){b(e);let n=u();return v(n.onSubmit())}),a(1,"div",7),f(2,"input",8),r(),a(3,"div",7),f(4,"input",9),a(5,"button",10),g("click",function(){b(e);let n=u();return v(n.toggleMostrarPassword())}),f(6,"fa-icon",11),r()(),a(7,"button",12),c(8,"Iniciar"),r()()}if(o&2){let e=u();m("formGroup",e.loginForm),l(4),m("type","text")("ngStyle",nt(5,Lu,e.mostrarPassword?"none":"disc")),l(2),m("icon",e.mostrarPassword?"eye-slash":"eye"),l(),m("disabled",e.loginForm.invalid)}}function Uu(o,t){if(o&1){let e=I();a(0,"app-farmacia-selector",13),g("farmaciaConfirmada",function(n){b(e);let s=u();return v(s.onFarmaciaConfirmada(n))}),r()}}var _n=class o{constructor(t,e,i,n,s,d){this.fb=t;this.http=e;this.authService=i;this.router=n;this.cdr=s;this.library=d;d.addIcons(vc,dn),this.loginForm=this.fb.group({usuario:["",B.required],password:["",B.required]})}loginForm;errorMessage="";showFarmaciaSelector=!1;farmaciaSubject;mostrarPassword=!1;farmaciaId="";closeLogin(){this.authService.hideLogin(),this.cdr.detectChanges()}onSubmit(){if(!this.loginForm.valid){this.showErrorAlert("Por favor, completa todos los campos correctamente.");return}let{usuario:t,password:e}=this.loginForm.value,i=n=>{this.authService.login(t,e,n).subscribe({next:s=>{s&&s.token&&s.user?(this.authService.setUserData(s.token,s.user.nombre,s.user.rol,s.user.email,s.user.farmacia,s.user.telefono,s.user.domicilio),s.user.rol==="admin"?this.showFarmaciaSelector=!0:(this.farmaciaId=s.user.farmacia?._id||"",this.verificarCorteActivoYRedirigir())):this.showErrorAlert("Respuesta del servidor no v\xE1lida")},error:s=>Q(this,null,function*(){if(s?.status===401&&s?.error?.requiereFirma){let{value:p}=yield tr.default.fire({title:"Autorizaci\xF3n requerida",input:"password",inputLabel:"Firma de la farmacia",inputPlaceholder:"Ingresa la firma",inputAttributes:{autocapitalize:"off",autocorrect:"off"},showCancelButton:!0,confirmButtonText:"Autorizar",cancelButtonText:"Cancelar"});if(!p)return;i(p);return}console.error("\u274C Error en login:",s),this.showErrorAlert(s?.error?.mensaje||"Error en autenticaci\xF3n")})})};i()}onFarmaciaConfirmada(t){this.authService.setFarmacia(t),this.showFarmaciaSelector=!1,this.farmaciaId=t._id,this.verificarCorteActivoYRedirigir()}toggleMostrarPassword(){this.mostrarPassword=!this.mostrarPassword}showErrorAlert(t){tr.default.fire({icon:"error",title:"Error en el inicio de sesi\xF3n",text:t,confirmButtonText:"Intentar de nuevo"})}verificarCorteActivoYRedirigir(){let t=JSON.parse(localStorage.getItem("usuario")||"null"),e=localStorage.getItem("auth_token");if(!t||!t.id||!t.rol){console.error("Usuario no v\xE1lido en localStorage"),this.router.navigate(["/home"]);return}let i=new ne({"x-auth-token":e||""});this.http.get(`${J.apiUrl}/cortes/activo/${t.id}/${this.farmaciaId}`,{headers:i}).subscribe({next:n=>{if(n?.corte){localStorage.setItem("corte_activo",n.corte._id);let s=new Date(n.corte.fechaInicio).toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),d=Number(n.corte.efectivoInicial||0).toFixed(2),p=n.corte.saldoInicialRecargas!==void 0?`<p><strong>Saldo inicial recargas:</strong> $${Number(n.corte.saldoInicialRecargas).toFixed(2)}</p>`:"";tr.default.fire({title:"Turno ya activo",html:`
              <p>Ya tienes un turno abierto.</p>
              <p><strong>Inicio:</strong> ${s}</p>
              <p><strong>Efectivo inicial:</strong> $${d}</p>
              ${p}
            `,icon:"info",timer:2e3,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.authService.hideLogin(),this.router.navigate(["/home"])})}else localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])},error:n=>{console.error("Error al verificar corte activo:",n),localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])}})}static \u0275fac=function(e){return new(e||o)(P(He),P(ge),P(Ne),P(St),P(Fe),P(st))};static \u0275cmp=V({type:o,selectors:[["app-login"]],decls:9,vars:2,consts:[[1,"login-overlay"],[1,"login-container"],[1,"close-button",3,"click"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"login-image"],["class","login-form",3,"formGroup","ngSubmit",4,"ngIf"],[3,"farmaciaConfirmada",4,"ngIf"],[1,"login-form",3,"ngSubmit","formGroup"],[1,"input-group"],["formControlName","usuario","placeholder","Usuario","required","","autocomplete","off","spellcheck","false","autocapitalize","off",1,"form-control"],["formControlName","password","placeholder","Contrase\xF1a","autocomplete","new-password","spellcheck","false","autocapitalize","off","required","",1,"form-control",3,"type","ngStyle"],["type","button","tabindex","-1","title","Mostrar/Ocultar contrase\xF1a",1,"btn-gris",3,"click"],[3,"icon"],["type","submit",1,"login-logout-button","mb-3","mt-3",3,"disabled"],[3,"farmaciaConfirmada"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return i.closeLogin()}),c(3,"\u2716"),r(),f(4,"img",3),a(5,"h2"),c(6,"Iniciar sesi\xF3n"),r(),S(7,ju,9,7,"form",4)(8,Uu,1,0,"app-farmacia-selector",5),r()()),e&2&&(l(7),m("ngIf",!i.showFarmaciaSelector),l(),m("ngIf",i.showFarmaciaSelector))},dependencies:[De,ke,ie,Z,Oe,No,Ye,Xe,j,z,rn,er,Je,Ze],styles:[".login-overlay[_ngcontent-%COMP%]{position:absolute;top:80px;right:0;width:100%;height:calc(100vh - 80px);background:#00000080;display:flex;justify-content:flex-end;align-items:center;z-index:1050}.login-container[_ngcontent-%COMP%]{width:350px;background:#fff;padding:0;border-radius:10px;box-shadow:-4px 0 6px #0003;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.login-image[_ngcontent-%COMP%]{width:80%;max-height:120px;object-fit:contain;margin-bottom:10px;margin-top:20px}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;font-weight:700;cursor:pointer;color:#333}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;margin-top:2rem}.input-group[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:center;margin-bottom:2rem}"]})};var si=class o{nombreFarmacia;direccion;telefono;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-ticket-header"]],inputs:{nombreFarmacia:"nombreFarmacia",direccion:"direccion",telefono:"telefono"},decls:15,vars:3,consts:[[1,"lineBottom"],[1,"encabezado-flex"],["src","assets/images/farmBienIcon.png","alt","Logo",1,"logo","logo-ticket"],[2,"font-size","large"],[2,"font-size","large","margin-left","70px"],[1,"datos-farmacia",2,"font-size","16px"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1),f(2,"img",2),a(3,"div")(4,"span",3),c(5,"FARMACIAS DEL BIENESTAR"),r(),f(6,"br"),a(7,"span",4),c(8,"PARA TODOS"),r()()(),a(9,"div",5),c(10),f(11,"br"),c(12),f(13,"br"),c(14),r()()),e&2&&(l(10),x(" Sucursal: ",i.nombreFarmacia,""),l(2),x(" ",i.direccion,""),l(2),x(" Tel\xE9fono: ",i.telefono," "))},dependencies:[j],styles:[".encabezado-flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}.logo[_ngcontent-%COMP%]{width:40px;height:auto;margin-right:30px}.datos-farmacia[_ngcontent-%COMP%]{font-size:16px;line-height:1.3;margin-top:4px;text-align:center}"]})};var li=class o{static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-ticket-footer"]],decls:5,vars:0,consts:[[1,"mensaje-final",2,"font-style","oblique","font-size","18px"]],template:function(e,i){e&1&&(a(0,"div",0),c(1," \xA1Gracias por su preferencia!"),f(2,"br"),c(3," Bienestar para todos"),f(4,"br"),r())},styles:[".mensaje-final[_ngcontent-%COMP%]{text-align:center;margin-top:10px;font-weight:700}"]})};function $u(o,t){if(o&1&&(a(0,"td",24),c(1),r()),o&2){let e=u().$implicit;l(),x("Desc. ",e.cadenaDescuento,"")}}function Hu(o,t){if(o&1&&(a(0,"td",25)(1,"strong"),c(2),y(3,"number"),r()()),o&2){let e=u().$implicit;l(2),x("$",w(3,1,e.descuento,"1.2-2"),"")}}function zu(o,t){if(o&1&&(oe(0,17),a(1,"tr")(2,"td",7)(3,"span",18),c(4),r()()(),a(5,"tr")(6,"td"),c(7),y(8,"number"),r(),a(9,"td"),c(10),r(),a(11,"td",19)(12,"span",20),c(13),r()(),a(14,"td",21),c(15),y(16,"number"),r()(),a(17,"tr"),S(18,$u,2,1,"td",22)(19,Hu,4,4,"td",23),r(),re()),o&2){let e=t.$implicit;l(4),x(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),l(3),x("$",w(8,7,e.precioOriginal,"1.2-2"),""),l(3),_(e.cantidad),l(3),x(" ",e.descuento>0?e.tipoDescuento:""," "),l(2),x("$",w(16,10,e.precioOriginal*e.cantidad,"1.2-2"),""),l(3),m("ngIf",e.cadenaDescuento!=""),l(),m("ngIf",e.descuento>0)}}function qu(o,t){if(o&1&&(a(0,"div",26),c(1,"Felicidades!!! usted us\xF3 su monedero: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.venta.formaPago.vale,"1.2-2"),"")}}function Wu(o,t){if(o&1&&(a(0,"div"),c(1,"Usted ahorr\xF3: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.venta.totalDescuento,"1.2-2"),"")}}function Gu(o,t){if(o&1&&(a(0,"div"),c(1,"Abon\xF3 a su monedero: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.venta.totalMonederoCliente,"1.2-2"),"")}}function Ku(o,t){if(o&1&&(a(0,"div"),c(1,"Su monedero ahora cuenta con: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.venta.AsiQuedaMonedero,"1.2-2"),"")}}var ir=class o{venta;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-venta-ticket"]],inputs:{venta:"venta"},decls:53,vars:24,consts:[[1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono"],[1,"productos","lineBottom"],[1,"col-unit"],[1,"col-cant"],[1,"col-promo"],[1,"col-importe"],["colspan","4"],[1,"lineBottom"],[1,"th-promo"],["style","font-size: 16px;",4,"ngFor","ngForOf"],[1,"totales-line","lineBottom"],[1,"totales"],["class","text-right",4,"ngIf"],[4,"ngIf"],[1,"info-general","lineBottom"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"producto-nombre"],[1,"promo-cell"],[1,"promo-value"],[1,"importe-cell"],["colspan","3",4,"ngIf"],["colspan","1","class","text-right",4,"ngIf"],["colspan","3"],["colspan","1",1,"text-right"],[1,"text-right"]],template:function(e,i){e&1&&(a(0,"div",0),f(1,"app-ticket-header",1),a(2,"table",2)(3,"colgroup"),f(4,"col",3)(5,"col",4)(6,"col",5)(7,"col",6),r(),a(8,"thead")(9,"tr")(10,"th",7),c(11,"PRODUCTO"),r()(),a(12,"tr",8)(13,"th"),c(14,"P.U."),r(),a(15,"th"),c(16,"CAN"),r(),a(17,"th",9),c(18,"PROMO"),r(),a(19,"th"),c(20,"IMPORTE"),r()()(),a(21,"tbody"),S(22,zu,20,13,"ng-container",10),r()(),a(23,"div",11)(24,"div"),c(25,"Cantidad de productos: "),a(26,"strong"),c(27),r()(),a(28,"div"),c(29,"Total: "),a(30,"strong"),c(31),y(32,"number"),r()()(),a(33,"div",12)(34,"div"),c(35,"Cambio: "),a(36,"strong"),c(37),y(38,"number"),r()(),S(39,qu,5,4,"div",13)(40,Wu,5,4,"div",14)(41,Gu,5,4,"div",14)(42,Ku,5,4,"div",14),r(),a(43,"div",15)(44,"div",16),c(45),r(),c(46),y(47,"date"),f(48,"br"),c(49),f(50,"br"),c(51),r(),f(52,"app-ticket-footer"),r()),e&2&&(l(),m("nombreFarmacia",i.venta.farmacia.nombre)("direccion",i.venta.farmacia.direccion)("telefono",i.venta.farmacia.telefono),l(21),m("ngForOf",i.venta.productos),l(5),_(i.venta.cantidadProductos),l(4),x("$",w(32,15,i.venta.total,"1.2-2"),""),l(6),x("$",w(38,18,i.venta.elcambio,"1.2-2"),""),l(2),m("ngIf",i.venta.formaPago.vale),l(),m("ngIf",i.venta.totalDescuento>0),l(),m("ngIf",i.venta.totalMonederoCliente>0&&i.venta.cliente),l(),m("ngIf",i.venta.AsiQuedaMonedero>0&&i.venta.cliente),l(3),x("Folio: ",i.venta.folio,""),l(),x(" Fecha: ",w(47,21,i.venta.fecha,"dd/MM/yyyy HH:mm")," hrs."),l(3),x(" Atendi\xF3: ",i.venta.usuario,""),l(2),x(" Cliente: ",i.venta.cliente||"P\xFAblico general"," "))},dependencies:[j,Y,z,Te,Me,si,li],styles:[".totales[_ngcontent-%COMP%]{font-size:17px!important;line-height:1.5}.totales[_ngcontent-%COMP%]{text-align:end}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}.productos[_ngcontent-%COMP%]{width:100%;table-layout:fixed;border-collapse:collapse}.productos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1px 0;font-size:17px}.col-unit[_ngcontent-%COMP%]{width:24%}.col-cant[_ngcontent-%COMP%]{width:12%}.col-promo[_ngcontent-%COMP%]{width:36%}.col-importe[_ngcontent-%COMP%]{width:28%}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){text-align:left}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){text-align:left}.promo-cell[_ngcontent-%COMP%]{text-align:right;padding-right:0}.importe-cell[_ngcontent-%COMP%]{text-align:right;padding-left:0}.th-promo[_ngcontent-%COMP%]{text-align:right}.promo-value[_ngcontent-%COMP%]{display:inline-block;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:clip;font-size:16px;letter-spacing:-.2px}.totales-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;font-size:17px;margin-top:2px}.text-right[_ngcontent-%COMP%]{text-align:right!important}"]})};var xd={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var Zu=["panel"],Ju=["*"];function e0(o,t){if(o&1&&(a(0,"div",1,0),Gl(2),r()),o&2){let e=t.id,i=u();Io(i._classList),G("mat-mdc-autocomplete-visible",i.showPanel)("mat-mdc-autocomplete-hidden",!i.showPanel)("mat-autocomplete-panel-animations-enabled",!i._animationsDisabled)("mat-primary",i._color==="primary")("mat-accent",i._color==="accent")("mat-warn",i._color==="warn"),m("id",i.id),te("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}var Da=class{source;option;constructor(t,e){this.source=t,this.option=e}},wd=new Ci("mat-autocomplete-default-options",{providedIn:"root",factory:t0});function t0(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1}}var nr=(()=>{class o{_changeDetectorRef=K(Fe);_elementRef=K(Hn);_defaults=K(wd);_animationsDisabled=K(zn,{optional:!0})==="NoopAnimations";_activeOptionChanges=ti.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new Ue;opened=new Ue;closed=new Ue;optionActivated=new Ue;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=K($c).getId("mat-autocomplete-");inertGroups;constructor(){let e=K(Lc);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new Hc(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let i=new Da(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let i=e?e+" ":"";return this.ariaLabelledby?i+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=V({type:o,selectors:[["mat-autocomplete"]],contentQueries:function(i,n,s){if(i&1&&(wa(s,pn,5),wa(s,qc,5)),i&2){let d;ye(d=Ce())&&(n.options=d),ye(d=Ce())&&(n.optionGroups=d)}},viewQuery:function(i,n){if(i&1&&(Ee(Ea,7),Ee(Zu,5)),i&2){let s;ye(s=Ce())&&(n.template=s.first),ye(s=Ce())&&(n.panel=s.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",fi],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",fi],requireSelection:[2,"requireSelection","requireSelection",fi],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",fi],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",fi]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[Li([{provide:zc,useExisting:o}])],ngContentSelectors:Ju,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(i,n){i&1&&(Wl(),S(0,e0,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return o})();var i0={provide:nc,useExisting:$l(()=>Ui),multi:!0};var Pd=new Ci("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let o=K(un);return()=>o.scrollStrategies.reposition()}});function n0(o){return()=>o.scrollStrategies.reposition()}var o0={provide:Pd,deps:[un],useFactory:n0},Ui=(()=>{class o{_environmentInjector=K(Hl);_element=K(Hn);_overlay=K(un);_viewContainerRef=K(wo);_zone=K(mt);_changeDetectorRef=K(Fe);_dir=K(Ho,{optional:!0});_formField=K(ed,{optional:!0,host:!0});_viewportRuler=K(zo);_scrollStrategy=K(Pd);_renderer=K(on);_defaults=K(wd,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new ve;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=ti.EMPTY;_breakpointObserver=K(Ia);_handsetLandscapeSubscription=ti.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new ve;_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&$o(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Fi(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Ri(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Ri(()=>this._overlayAttached)):Ie()).pipe(Se(e=>e instanceof Wc?e:null))}optionSelections=Bl(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(Ai(e),ft(()=>Fi(...e.map(i=>i.onSelectionChange)))):this._initialized.pipe(ft(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new ii(e=>{let i=s=>{let d=ji(s),p=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,h=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&d!==this._element.nativeElement&&!this._hasFocus()&&(!p||!p.contains(d))&&(!h||!h.contains(d))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(d)&&e.next(s)},n=[this._renderer.listen("document","click",i),this._renderer.listen("document","auxclick",i),this._renderer.listen("document","touchend",i)];return()=>{n.forEach(s=>s())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let i=e.keyCode,n=Uo(e);if(i===27&&!n&&e.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&i===13&&this.panelOpen&&!n)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){let s=this.autocomplete._keyManager.activeItem,d=i===38||i===40;i===9||d&&!n&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let i=e.target,n=i.value;if(i.type==="number"&&(n=n==""?null:parseFloat(n)),this._previousValue!==n){if(this._previousValue=n,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(n),!n)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let s=this.autocomplete.options?.find(d=>d.selected);if(s){let d=this._getDisplayValue(s.value);n!==d&&s.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let s=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(s)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return Bc()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new ii(n=>{Eo(()=>{n.next()},{injector:this._environmentInjector})}),i=this.autocomplete.options?.changes.pipe(Vi(()=>this._positionStrategy.reapplyLastPosition()),Ul(0))??Ie();return Fi(e,i).pipe(ft(()=>this._zone.run(()=>{let n=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),n!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),xo(1)).subscribe(n=>this._setValueAndClose(n))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let i=this.autocomplete;return i&&i.displayWith?i.displayWith(e):e}_assignOptionValue(e){let i=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(i??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let i=this.autocomplete,n=e?e.source:this._pendingAutoselectedOption;n?(this._clearPreviousSelectedOption(n),this._assignOptionValue(n.value),this._onChange(n.value),i._emitSelectEvent(n),this._element.nativeElement.focus()):i.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,i){this.autocomplete?.options?.forEach(n=>{n!==e&&n.selected&&n.deselect(i)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let i=this.autocomplete.id;Ma(this._trackedModal,"aria-owns",i)}}_attachOverlay(e){this.autocomplete;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Yc(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(xd.HandsetLandscape).subscribe(s=>{s.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),i&&!i.hasAttached()&&(i.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let n=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&n!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!Uo(e)||e.keyCode===38&&Uo(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new Xc({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){let e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],n=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:n},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:n}],d;this.position==="above"?d=s:this.position==="below"?d=i:d=[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let i=-1;for(let n=0;n<e.options.length;n++)if(!e.options.get(n).disabled){i=n;break}e._keyManager.setActiveItem(i)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let i=this.autocomplete,n=Gc(e,i.options,i.optionGroups);if(e===0&&n===1)i._setScrollTop(0);else if(i.panel){let s=i.options.toArray()[e];if(s){let d=s._getHostElement(),p=Kc(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(p)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let i=this.autocomplete.id;this._trackedModal&&$o(this._trackedModal,"aria-owns",i),Ma(e,"aria-owns",i),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;$o(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Po({type:o,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(i,n){i&1&&g("focusin",function(){return n._handleFocus()})("blur",function(){return n._onTouched()})("input",function(d){return n._handleInput(d)})("keydown",function(d){return n._handleKeydown(d)})("click",function(){return n._handleClick()}),i&2&&te("autocomplete",n.autocompleteAttribute)("role",n.autocompleteDisabled?null:"combobox")("aria-autocomplete",n.autocompleteDisabled?null:"list")("aria-activedescendant",n.panelOpen&&n.activeOption?n.activeOption.id:null)("aria-expanded",n.autocompleteDisabled?null:n.panelOpen.toString())("aria-controls",n.autocompleteDisabled||!n.panelOpen||n.autocomplete==null?null:n.autocomplete.id)("aria-haspopup",n.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",fi]},exportAs:["matAutocompleteTrigger"],features:[Li([i0]),en]})}return o})(),bn=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Wn({type:o});static \u0275inj=$n({providers:[o0],imports:[Zc,Oa,Ta,qo,Oa,Ta]})}return o})();var ot=lt(_t());var or=class o{constructor(t){this.http=t}apiUrl=`${J.apiUrl}/ventas`;crearVenta(t){let e=localStorage.getItem("auth_token"),i=new ne({"Content-Type":"application/json","x-auth-token":e||""});return this.http.post(`${this.apiUrl}`,t,{headers:i})}obtenerHistorialCompras(t,e){let i=localStorage.getItem("auth_token");if(!i)return console.error("\u274C No hay token disponible."),new ii(s=>s.next([]));let n=new ne({"x-auth-token":i});return this.http.get(`${this.apiUrl}/historial/${t}/${e}`,{headers:n})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var It=class o{constructor(t){this.http=t}apiUrl=`${J.apiUrl}/productos`;crearProducto(t){return this.http.post(`${J.apiUrl}/productos`,t)}buscarPorCodigoBarras(t){let e=localStorage.getItem("auth_token")||"",i=new ne({"x-auth-token":e}),n=new Le().set("codigoBarras",t);return this.http.get(`${this.apiUrl}/buscar-por-cb`,{params:n,headers:i})}obtenerProductos(){return this.http.get(`${this.apiUrl}`)}consultarPrecioPorCodigo(t,e){return this.http.get(`${this.apiUrl}/precio/${t}/${e}`)}existenciaPorId(t){return this.http.get(`${this.apiUrl}/ver-existencia/${t}`)}existenciaPorFarmaciaYProducto(t,e){return this.http.get(`${this.apiUrl}/inventario/${t}/${e}`)}actualizarProductos(t){return this.http.put(`${this.apiUrl}/actualizar-masivo`,t)}actualizarProductoIndividual(t,e){return this.http.put(`${this.apiUrl}/actualizar-producto/${t}`,e)}obtenerProductoPorId(t){return this.http.get(`${this.apiUrl}/${t}`)}buscar(t,e=12){let i=new Le().set("q",t).set("limit",e);return this.http.get(`${this.apiUrl}/search`,{params:i})}eliminarProducto(t){return this.http.delete(`${this.apiUrl}/${t}`)}actualizarImagenProducto(t,e){let i=new FormData;return i.append("imagen",e),this.http.put(`${this.apiUrl}/${t}/imagen`,i)}obtenerImagenProductoUrl(t){return`${this.apiUrl}/${t}/imagen`}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var yn=class o{clavePausadas="ventas_pausadas";setVentasPausadas(t){localStorage.setItem(this.clavePausadas,JSON.stringify(t))}getVentasPausadas(){let t=localStorage.getItem(this.clavePausadas);return t?JSON.parse(t):[]}limpiarVentasPausadas(){localStorage.removeItem(this.clavePausadas)}existenVentasPausadas(){return this.getVentasPausadas().length>0}static \u0275fac=function(e){return new(e||o)};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var s0=["codigoBarrasRef"],l0=["efectivoRecibidoRef"],c0=["cliTrigger"];function d0(o,t){if(o&1&&(a(0,"option",64),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e),l(),x("",e,"\xD7")}}function m0(o,t){if(o&1&&(a(0,"small"),c(1),r()),o&2){let e=u().$implicit;l(),x(" \u2014 ",e.telefono,"")}}function p0(o,t){if(o&1&&(a(0,"mat-option",65),c(1),S(2,m0,2,1,"small",21),r()),o&2){let e=t.$implicit;m("value",e),l(),x(" ",e.nombre," "),l(),m("ngIf",e.telefono)}}function u0(o,t){o&1&&(a(0,"mat-option"),c(1," Sin coincidencias "),r())}function f0(o,t){if(o&1&&f(0,"option",65),o&2){let e=t.$implicit;m("value",e.nombre+(e.telefono?" \u2014 "+e.telefono:""))}}function h0(o,t){if(o&1){let e=I();a(0,"button",66),g("click",function(){b(e);let n=u();return v(n.limpiarCliente())}),f(1,"fa-icon",67),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function g0(o,t){if(o&1&&(a(0,"span",68),c(1),r()),o&2){let e=u();l(),_(e.nombreCliente)}}function _0(o,t){if(o&1){let e=I();a(0,"div",16)(1,"input",69),k("ngModelChange",function(n){b(e);let s=u();return O(s.aplicaInapam,n)||(s.aplicaInapam=n),v(n)}),g("ngModelChange",function(){b(e);let n=u();return n.yaPreguntoInapam=!0,v(n.VerSiPreguntaINAPAM())}),r(),a(2,"label",70),c(3,"Presenta cred. INAPAM"),r()()}if(o&2){let e=u();l(),T("ngModel",e.aplicaInapam)}}function b0(o,t){if(o&1&&(a(0,"mat-option",65),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),Qt(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function v0(o,t){if(o&1&&(a(0,"mat-option",65),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),x(" ",e.nombre," ")}}function y0(o,t){if(o&1&&(a(0,"div",82)(1,"strong"),c(2,"Ubicaci\xF3n:"),r(),a(3,"div"),c(4),r()()),o&2){let e=u(3);l(4),x(" ",e.productoConsultado.ubicacionEnFarmacia," ")}}function C0(o,t){if(o&1){let e=I();a(0,"div",78)(1,"div",79)(2,"img",80),g("error",function(){b(e);let n=u(2);return v(n.consultaImgUrl=n.placeholderSrc)}),r()(),S(3,y0,5,1,"div",81),r()}if(o&2){let e=u(2);l(2),m("src",e.consultaImgUrl,Ni),l(),m("ngIf",e.productoConsultado)}}function x0(o,t){if(o&1&&(a(0,"mat-option",65),c(1),r()),o&2){let e=t.$implicit;m("value",e.codigoBarras),l(),Qt(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function S0(o,t){if(o&1&&(a(0,"mat-option",65),c(1),r()),o&2){let e=t.$implicit;m("value",e.codigoBarras),l(),x(" ",e.nombre," ")}}function E0(o,t){if(o&1){let e=I();a(0,"div")(1,"mat-form-field",83)(2,"input",84),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.busquedaConsultaCodigo,n)||(s.busquedaConsultaCodigo=n),v(n)}),g("input",function(){b(e);let n=u(2);return v(n.filtrarConsultaPorCodigo())}),r(),a(3,"mat-autocomplete",85,5),g("optionSelected",function(n){b(e);let s=u(2);return v(s.onSelectConsultaCodigo(n))}),S(5,x0,2,3,"mat-option",20),r()(),a(6,"mat-form-field",83)(7,"input",86),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.busquedaConsultaNombre,n)||(s.busquedaConsultaNombre=n),v(n)}),g("input",function(){b(e);let n=u(2);return v(n.filtrarConsultaPorNombre())}),r(),a(8,"mat-autocomplete",85,6),g("optionSelected",function(n){b(e);let s=u(2);return v(s.onSelectConsultaNombre(n))}),S(10,S0,2,2,"mat-option",20),r()()()}if(o&2){let e=$e(4),i=$e(9),n=u(2);l(2),T("ngModel",n.busquedaConsultaCodigo),m("matAutocomplete",e),l(3),m("ngForOf",n.productosConsultaFiltradosPorCodigo),l(2),T("ngModel",n.busquedaConsultaNombre),m("matAutocomplete",i),l(3),m("ngForOf",n.productosConsultaFiltradosPorNombre)}}function w0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo1),l(),_(e.productoConsultado.precioLunes)}}function P0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.lunesMasInapam)}}function I0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo2),l(),_(e.productoConsultado.precioMartes)}}function M0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.martesMasInapam)}}function T0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo3),l(),_(e.productoConsultado.precioMiercoles)}}function O0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.miercolesMasInapam)}}function k0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo4),l(),_(e.productoConsultado.precioJueves)}}function D0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.juevesMasInapam)}}function F0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo5),l(),_(e.productoConsultado.precioViernes)}}function R0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.viernesMasInapam)}}function A0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo6),l(),_(e.productoConsultado.precioSabado)}}function V0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.sabadoMasInapam)}}function N0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2),r(),c(3),r()),o&2){let e=u(3);l(2),_(e.productoConsultado.promo0),l(),_(e.productoConsultado.precioDomingo)}}function B0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.domingoMasInapam)}}function L0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2,"Promo: "),r(),c(3),r()),o&2){let e=u(3);l(3),_(e.productoConsultado.promo)}}function j0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2,"Precio c/promo: "),r(),c(3),r()),o&2){let e=u(3);l(3),_(e.productoConsultado.precioConDescuento)}}function U0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2,"Precio promo + inapam: "),r(),c(3),r()),o&2){let e=u(3);l(3),_(e.productoConsultado.precioDescuentoMasInapam)}}function $0(o,t){if(o&1&&(a(0,"p")(1,"strong"),c(2,"Precio Inapam: "),r(),c(3),r()),o&2){let e=u(3);l(3),x("",e.productoConsultado.precioInapam," ")}}function H0(o,t){if(o&1&&(a(0,"p"),c(1),r()),o&2){let e=u(3);l(),_(e.productoConsultado.promoCliente)}}function z0(o,t){if(o&1&&(a(0,"div")(1,"p")(2,"strong"),c(3,"Nombre: "),r(),c(4),r(),a(5,"p")(6,"strong"),c(7,"Precio Normal:"),r(),c(8),y(9,"currency"),r(),S(10,w0,4,2,"p",21)(11,P0,2,1,"p",21)(12,I0,4,2,"p",21)(13,M0,2,1,"p",21)(14,T0,4,2,"p",21)(15,O0,2,1,"p",21)(16,k0,4,2,"p",21)(17,D0,2,1,"p",21)(18,F0,4,2,"p",21)(19,R0,2,1,"p",21)(20,A0,4,2,"p",21)(21,V0,2,1,"p",21)(22,N0,4,2,"p",21)(23,B0,2,1,"p",21)(24,L0,4,1,"p",21)(25,j0,4,1,"p",21)(26,U0,4,1,"p",21)(27,$0,4,1,"p",21)(28,H0,2,1,"p",21),r()),o&2){let e=u(2);l(4),_(e.productoConsultado.nombre),l(4),x(" ",M(9,21,e.productoConsultado.precioNormal),""),l(2),m("ngIf",e.productoConsultado.promo1),l(),m("ngIf",e.productoConsultado.lunesMasInapam),l(),m("ngIf",e.productoConsultado.promo2),l(),m("ngIf",e.productoConsultado.martesMasInapam),l(),m("ngIf",e.productoConsultado.promo3),l(),m("ngIf",e.productoConsultado.miercolesMasInapam),l(),m("ngIf",e.productoConsultado.promo4),l(),m("ngIf",e.productoConsultado.juevesMasInapam),l(),m("ngIf",e.productoConsultado.promo5),l(),m("ngIf",e.productoConsultado.viernesMasInapam),l(),m("ngIf",e.productoConsultado.promo6),l(),m("ngIf",e.productoConsultado.sabadoMasInapam),l(),m("ngIf",e.productoConsultado.promo0),l(),m("ngIf",e.productoConsultado.domingoMasInapam),l(),m("ngIf",e.productoConsultado.promo),l(),m("ngIf",e.productoConsultado.precioConDescuento),l(),m("ngIf",e.productoConsultado.precioDescuentoMasInapam),l(),m("ngIf",e.productoConsultado.precioInapam),l(),m("ngIf",e.productoConsultado.promoCliente)}}function q0(o,t){if(o&1){let e=I();a(0,"div",71)(1,"div",72)(2,"h2"),c(3,"Consultar Precio"),r(),a(4,"div",73)(5,"input",74),k("ngModelChange",function(n){b(e);let s=u();return O(s.codigoConsulta,n)||(s.codigoConsulta=n),v(n)}),g("keyup.enter",function(){b(e);let n=u();return v(n.consultarPrecio())}),r(),a(6,"button",75),g("click",function(){b(e);let n=u();return v(n.limpiarBarras())}),f(7,"fa-icon",67),r()(),S(8,C0,4,2,"div",76)(9,E0,11,6,"div",21)(10,z0,29,23,"div",21),a(11,"button",77),g("click",function(){b(e);let n=u();return v(n.cerrarModalConsultaPrecio())}),c(12,"Cerrar"),r()()()}if(o&2){let e=u();l(5),T("ngModel",e.codigoConsulta),l(2),m("icon",e.faTimes),l(),m("ngIf",e.consultaEncontrado),l(),m("ngIf",!e.consultaEncontrado),l(),m("ngIf",e.productoConsultado)}}function W0(o,t){if(o&1){let e=I();a(0,"tr")(1,"td",44)(2,"div",87)(3,"button",88),g("click",function(){let n=b(e).index,s=u();return v(s.eliminarProducto(n))}),f(4,"i",40),r(),a(5,"button",89),g("click",function(){let n=b(e).index,s=u();return v(s.incrementarCantidad(n))}),f(6,"i",90),r(),a(7,"button",91),g("click",function(){let n=b(e).index,s=u();return v(s.decrementarCantidad(n))}),f(8,"i",92),r()()(),a(9,"td",45)(10,"div",93)(11,"button",94),g("click",function(){let n=b(e).$implicit,s=u();return v(s.openPreviewVenta(n))}),a(12,"img",95),g("error",function(n){let s=b(e).$implicit,d=u();return v(d.onThumbError(n,s))}),r()()()(),a(13,"td",46)(14,"div",96),c(15),r(),a(16,"small",97),c(17),r()(),a(18,"td"),c(19),r(),a(20,"td"),c(21),y(22,"currency"),r(),a(23,"td"),c(24),y(25,"currency"),r(),a(26,"td"),c(27),r(),a(28,"td"),c(29),r(),a(30,"td"),c(31),y(32,"currency"),r(),a(33,"td"),c(34),y(35,"currency"),r(),a(36,"td"),c(37),y(38,"currency"),r()()}if(o&2){let e=t.$implicit,i=u();l(3),G("deshabilitado",e.esGratis),m("disabled",e.esGratis),l(2),G("deshabilitado",e.esGratis),m("disabled",e.esGratis),l(2),G("deshabilitado",e.esGratis),m("disabled",e.esGratis),l(5),m("src",i.thumbs[e.producto]||i.placeholderSrc,Ni),l(3),_(e.nombre),l(2),_(e.ubicacionEnFarmacia),l(2),_(e.cantidad),l(2),_(M(22,20,e.precioOriginal)),l(3),_(M(25,22,e.precioOriginal*e.cantidad)),l(3),_(e.tipoDescuento!=="Ninguno"?e.tipoDescuento:"-"),l(2),_(e.cadDesc),l(2),_(M(32,24,e.alMonedero*e.cantidad)),l(3),_(M(35,26,e.descuentoUnitario*e.cantidad)),l(3),_(M(38,28,e.precioFinal*e.cantidad))}}function G0(o,t){if(o&1){let e=I();a(0,"div",98)(1,"button",99),g("click",function(){b(e);let n=u();return v(n.pausarVenta())}),c(2,"Pausar Venta"),r(),a(3,"button",100),g("click",function(){b(e);let n=u();return v(n.cancelarVenta())}),c(4,"Cancelar Venta"),r(),a(5,"button",101),g("click",function(){b(e);let n=u();return v(n.abrirModalPago())}),c(6,"Finalizar Venta"),r()()}}function K0(o,t){if(o&1){let e=I();a(0,"button",104),g("click",function(){let n=b(e).index,s=u(2);return v(s.reanudarVenta(n))}),c(1),r()}if(o&2){let e=t.$implicit;l(),x(" ",e.captionButtomReanudar," ")}}function Q0(o,t){if(o&1&&(a(0,"div",102)(1,"h2",34),c(2,"Ventas Pausadas"),r(),S(3,K0,2,1,"button",103),r()),o&2){let e=u();l(3),m("ngForOf",e.ventasPausadas)}}function Y0(o,t){if(o&1&&(a(0,"div",110)(1,"label",135),c(2,"Monto monedero usado:"),r(),a(3,"div",136)(4,"span",137),c(5),y(6,"currency"),r()()()),o&2){let e=u(3);l(5),x(" ",M(6,1,e.montoVale)," ")}}function X0(o,t){if(o&1){let e=I();a(0,"div",127)(1,"div",110)(2,"label",128),c(3),y(4,"currency"),r()(),a(5,"div",110)(6,"div",129)(7,"label",130),c(8,"Usar monedero:"),r()(),a(9,"div",131)(10,"input",132),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.usarMonedero,n)||(s.usarMonedero=n),v(n)}),g("ngModelChange",function(){b(e);let n=u(2);return v(n.onToggleMonedero())}),r(),a(11,"label",133),c(12,"S\xED"),r()()(),S(13,Y0,7,3,"div",134),r()}if(o&2){let e=u(2);l(3),x(" Tiene en monedero: ",M(4,3,e.montoMonederoCliente)," "),l(7),T("ngModel",e.usarMonedero),l(3),m("ngIf",e.usarMonedero)}}function Z0(o,t){o&1&&(a(0,"p",138),c(1," A\xFAn falta cubrir el total de la venta. "),r())}function J0(o,t){o&1&&(a(0,"p",139),c(1," El total de la venta ha sido cubierto. "),r())}function ef(o,t){if(o&1){let e=I();a(0,"button",140),g("click",function(){b(e);let n=u(2);return v(n.habilitarInputs())}),f(1,"i",141),c(2," Habilitar pagos "),r()}}function tf(o,t){if(o&1){let e=I();a(0,"div",71)(1,"div",105)(2,"div",106)(3,"h5",107),c(4,"M\xE9todo de Pago"),r()(),a(5,"div",108)(6,"p",109),c(7,"Total a pagar: "),a(8,"strong"),c(9),y(10,"currency"),r()(),a(11,"div",110)(12,"label",111),c(13,"Efectivo:"),r(),a(14,"div",112)(15,"input",113,7),k("ngModelChange",function(n){b(e);let s=u();return O(s.efectivoRecibido,n)||(s.efectivoRecibido=n),v(n)}),g("ngModelChange",function(){b(e);let n=u();return v(n.calculaCambio())}),r()()(),a(17,"div",110)(18,"label",114),c(19,"Tarjeta:"),r(),a(20,"div",112)(21,"input",115),k("ngModelChange",function(n){b(e);let s=u();return O(s.montoTarjeta,n)||(s.montoTarjeta=n),v(n)}),g("ngModelChange",function(){b(e);let n=u();return v(n.pagoTarjeta())}),r()()(),a(22,"div",110)(23,"label",116),c(24,"Transferencia:"),r(),a(25,"div",112)(26,"input",117),k("ngModelChange",function(n){b(e);let s=u();return O(s.montoTransferencia,n)||(s.montoTransferencia=n),v(n)}),g("ngModelChange",function(){b(e);let n=u();return v(n.pagoTransferencia())}),r()()(),S(27,X0,14,5,"div",118),a(28,"p",119),c(29,"Cambio: "),a(30,"strong"),c(31),y(32,"currency"),r()(),S(33,Z0,2,0,"p",120)(34,J0,2,0,"p",121),r(),a(35,"div",122)(36,"button",123),g("click",function(){b(e);let n=u();return v(n.cancelarPago())}),c(37,"Cancelar"),r(),a(38,"button",124),c(39," Imprimir "),r()(),a(40,"div",125),S(41,ef,3,0,"button",126),r()()()}if(o&2){let e=u();l(9),_(M(10,19,e.total)),l(6),T("ngModel",e.efectivoRecibido),m("min",0)("disabled",e.ocultarEfectivo),te("autofocus",!0),l(6),T("ngModel",e.montoTarjeta),m("min",0)("max",e.total-e.pagoTransferencia1-e.pagoVale1)("disabled",e.ocultaTarjeta),l(5),T("ngModel",e.montoTransferencia),m("min",0)("max",e.total-e.pagoTarjeta1-e.pagoVale1)("disabled",e.ocultaTransferencia),l(),m("ngIf",e.montoMonederoCliente>0),l(4),_(M(32,21,e.cambio)),l(2),m("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),l(),m("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1>=e.total),l(4),m("disabled",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),l(3),m("ngIf",e.inputsHabilitados)}}function nf(o,t){if(o&1&&f(0,"app-venta-ticket",142),o&2){let e=u();m("venta",e.ventaParaImpresion)}}var rr=class o{constructor(t,e,i,n,s,d,p){this.fb=t;this.ventasService=e;this.productoService=i;this.clienteService=n;this.ventaService=s;this.cdRef=d;this.ngZone=p;this.ventaForm=this.fb.group({cliente:[""],producto:[""],cantidad:[1]})}codigoBarrasRef;efectivoRecibidoRef;cliTrigger;opcionesClientes=[];pendingFocusEfectivo=!1;barcodeFocusTimer=null;telefonoCliente="";nombreCliente="";cliente="";montoMonederoCliente=0;usarMonedero=!1;hayProducto=!1;ventaForm;carrito=[];precioEnFarmacia=0;ubicacionEnFarmacia="";total=0;totalArticulos=0;totalDescuento=0;totalAlmonedero=0;ventasPausadas=[];captionButtomReanudar="";efectivoRecibido=null;montoTarjeta=null;montoTransferencia=null;montoVale=null;cambio=0;inputsHabilitados=!1;tipoDescuento="";cadDesc="";ptjeDescuento=0;alMonedero=0;productoAplicaMonedero=!1;hayCliente=!1;aplicaGratis=!1;ocultarEfectivo=!1;ocultaTarjeta=!1;ocultaTransferencia=!1;ocultaVale=!1;mostrarModalPago=!1;codigoBarras="";busquedaProducto="";busquedaPorCodigo="";productosFiltrados=[];productosFiltradosPorCodigo=[];productos=[];clientes=[];farmaciaId="";farmaciaNombre="";farmaciaDireccion="";farmaciaTelefono="";nombreUs="";mostrarModalConsultaPrecio=!1;codigoConsulta="";productoConsultado=null;busquedaConsultaCodigo="";busquedaConsultaNombre="";productosConsultaFiltradosPorCodigo=[];productosConsultaFiltradosPorNombre=[];aplicaInapam=!1;yaPreguntoInapam=!1;fechaIni=new Date;fechaFin=new Date;faTimes=ct;ventaParaImpresion=null;mostrarTicket=!1;folioVentaGenerado=null;venta=null;ventaEnProceso=!1;clienteNombreCtrl=new Ro({value:"",disabled:!1});filteredClientes$=Ie([]);placeholderSrc="assets/images/farmBienIcon.png";thumbs={};consultaEncontrado=!1;consultaImgUrl=this.placeholderSrc;thumbScale=2;scales=[1,1.5,2,2.5,3,3.5,4];onScaleChange(t){this.thumbScale=t,localStorage.setItem("thumbScale",String(t))}resetConsulta(){this.codigoConsulta="",this.busquedaConsultaCodigo="",this.busquedaConsultaNombre="",this.productoConsultado=null,this.productosConsultaFiltradosPorCodigo=[],this.productosConsultaFiltradosPorNombre=[],this.consultaEncontrado=!1,this.consultaImgUrl=this.placeholderSrc}toNum(t){let e=Number(t);return Number.isFinite(e)?e:0}round2(t){return Math.round((t+Number.EPSILON)*100)/100}get pagoEfectivo(){return this.toNum(this.efectivoRecibido)}get pagoTarjeta1(){return this.toNum(this.montoTarjeta)}get pagoTransferencia1(){return this.toNum(this.montoTransferencia)}get pagoVale1(){return this.toNum(this.montoVale)}get totalPagado(){return this.round2(this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)}trackByProducto=(t,e)=>e.producto;ngAfterViewInit(){this.focusBarcode(),this.clienteNombreCtrl.valueChanges.pipe(Ai(this.clienteNombreCtrl.value??""),Ft(50),Rt()).subscribe(()=>{this.clienteNombreCtrl.enabled&&this.cliTrigger&&(this.cliTrigger.panelOpen?this.cliTrigger.updatePosition():this.cliTrigger.openPanel())})}ngAfterViewChecked(){this.pendingFocusEfectivo&&this.mostrarModalPago&&(this.pendingFocusEfectivo=!1,setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0))}ngOnInit(){this.obtenerProductos();let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono);let i=localStorage.getItem("user_nombre");this.nombreUs=i||"",this.ventasPausadas=this.ventaService.getVentasPausadas(),this.filteredClientes$=this.clienteNombreCtrl.valueChanges.pipe(Se(n=>typeof n=="string"?n:n?.nombre??""),Se(n=>n.trim()),Ft(200),Rt(),ft(n=>n.length<2?Ie([]):this.clienteService.buscarClientesPorNombre(n,20).pipe(Se(s=>s?.rows??[]),Lt(()=>Ie([]))))),this.clienteNombreCtrl.valueChanges.pipe(Ai(""),Ft(120),Rt(),Se(n=>typeof n=="string"?n:n?.nombre??"")).subscribe(n=>{this.opcionesClientes=this.filtraClientesLocal(n),(n||"").length&&this.opcionesClientes.length&&!this.clienteNombreCtrl.disabled?this.cliTrigger?.openPanel():this.cliTrigger?.closePanel()})}onClienteInput(){let t=this.clienteNombreCtrl.value;typeof t=="string"&&t.trim()&&this.cliTrigger?.openPanel()}displayCliente=t=>t?.nombre||"";onClienteSelected(t){t&&(this.cliente=t._id,this.nombreCliente=t.nombre||"",this.telefonoCliente=t.telefono||"",this.montoMonederoCliente=Number(t.totalMonedero||0),this.recalcularRenglones(),this.hayCliente=!0,this.focusBarcode(60))}ngOnDestroy(){this.carrito.length>0&&this.pausarVenta()}handleEnter(t){this.mostrarModalPago&&(t.preventDefault(),this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total&&this.finalizarVenta())}clearBarcodeFocusTimer(){this.barcodeFocusTimer&&(clearTimeout(this.barcodeFocusTimer),this.barcodeFocusTimer=null)}focusBarcode(t=60){this.clearBarcodeFocusTimer(),this.barcodeFocusTimer=setTimeout(()=>{let e=document.activeElement,i=!!e&&(e.tagName==="INPUT"||e.getAttribute("contenteditable")==="true");!this.mostrarModalPago&&!i&&this.codigoBarrasRef&&this.codigoBarrasRef.nativeElement.focus(),this.barcodeFocusTimer=null},t)}nombreDiaSemana(t){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][t]||""}abrirAutoClientes(){this.clienteNombreCtrl.enabled&&setTimeout(()=>this.cliTrigger?.openPanel(),0)}VerSiPreguntaINAPAM(){return Q(this,null,function*(){if(this.aplicaInapam){let t=yield ot.default.fire({icon:"question",title:"Credencial INAPAM vigente",html:`<h4>Me puede mostrar su credencial de INAPAM por favor?</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=t.isConfirmed}this.recalcularRenglones()})}recalcularRenglones(){return Q(this,null,function*(){if(this.carrito.length>0){for(let t=0;t<this.carrito.length;t++){let e=this.productos.find(n=>n._id===this.carrito[t].producto);this.descuentoMenorA25(this.carrito[t].producto)&&(yield this.preguntaINAPAM(e)),e.categoria==="Recargas"||e.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(e);let i=this.carrito[t].precioOriginal;i*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=i*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=e.nombre),this.carrito[t].precioFinal=i,this.carrito[t].tipoDescuento=this.tipoDescuento,this.carrito[t].cadDesc=this.cadDesc,this.carrito[t].alMonedero=this.alMonedero,this.carrito[t].descuentoUnitario=this.carrito[t].precioOriginal-i,this.carrito[t].iva=e.iva?i*.16:0,this.aplicaGratis&&this.validarProductoGratis(e._id)}this.calcularTotal()}})}buscarCliente(){this.telefonoCliente.length===10&&this.clienteService.buscarClientePorTelefono(this.telefonoCliente).subscribe({next:t=>{t&&t.nombre?(this.nombreCliente=t.nombre,this.ventaForm.controls.cliente.setValue(t._id),this.cliente=t._id,this.montoMonederoCliente=t.totalMonedero,this.hayCliente=!0,this.recalcularRenglones(),this.focusBarcode()):this.mostrarModalCrearCliente()},error:t=>{console.error("\u274C Error al buscar cliente:",t),this.mostrarModalCrearCliente()}})}mostrarModalCrearCliente(){ot.default.fire({icon:"warning",title:"Cliente no encontrado",text:"\xBFDesea registrar un nuevo cliente?",showCancelButton:!0,confirmButtonText:"Crear Cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{t.isConfirmed?this.abrirFormularioNuevoCliente():(this.limpiarCliente(),this.focusBarcode())})}abrirFormularioNuevoCliente(){ot.default.fire({title:"Registrar Cliente",html:'<input id="nuevoNombreCliente" class="swal2-input" style="width: 80%;" placeholder="Ap. paterno Ap. materno Nombre(s)">',showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let t=document.getElementById("nuevoNombreCliente").value;return t||ot.default.showValidationMessage("El nombre es obligatorio"),{nombre:t,telefono:this.telefonoCliente,totalMonedero:this.montoMonederoCliente}}}).then(t=>{t.isConfirmed?this.registrarNuevoCliente(t.value):t.dismiss===ot.default.DismissReason.cancel&&(this.limpiarCliente(),this.focusBarcode())})}registrarNuevoCliente(t){this.clienteService.crearCliente(t).subscribe({next:e=>{let i=e?.cliente??e?.data??e?.result??e,n=i?._id??e?.insertedId??e?._id??null,s=i?.nombre??t?.nombre??"",d=i?.telefono??t?.telefono??"",p=Number(i?.totalMonedero??0);if(n&&s){this.nombreCliente=s,this.ventaForm.controls.cliente.setValue(n),this.hayCliente=!0,this.cliente=n,this.montoMonederoCliente=p;try{(this.clientes||[]).some(C=>C?._id===n)||(this.clientes=[{_id:n,nombre:s,telefono:d,totalMonedero:p},...this.clientes||[]])}catch{}this.recalcularRenglones(),ot.default.fire({icon:"success",title:"Cliente registrado",text:`El cliente ${s} ha sido registrado correctamente.`,timer:1500,showConfirmButton:!1})}else console.error("\u26A0\uFE0F Respuesta inesperada del backend:",e),ot.default.fire({icon:"warning",title:"Cliente registrado",text:"Se registr\xF3 el cliente, pero no pude leer su ID desde la respuesta.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("\u274C Error al registrar cliente:",e),ot.default.fire({icon:"error",title:"Error",text:"No se pudo registrar el cliente. Int\xE9ntelo de nuevo.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})}})}limpiarCliente(){this.cliente="",this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.hayCliente=!1,this.ventaForm.controls.cliente.setValue(""),this.clienteNombreCtrl.setValue(""),this.recalcularRenglones(),this.focusBarcode(60)}limpiarBarras(){this.resetConsulta()}limpiarProducto(){this.codigoBarras="",this.busquedaProducto="",this.busquedaPorCodigo="",this.productosFiltrados=this.productos,this.productosFiltradosPorCodigo=this.productos,this.filtrarProductos(),this.filtrarPorCodigo(),this.focusBarcode()}filtrarProductos(){this.busquedaProducto?this.productosFiltrados=this.productos.filter(t=>t.nombre.toLowerCase().includes(this.busquedaProducto.toLowerCase())):this.productosFiltrados=this.productos}filtrarPorCodigo(){this.busquedaPorCodigo?this.productosFiltradosPorCodigo=this.productos.filter(t=>t.codigoBarras.includes(this.busquedaPorCodigo)):this.productosFiltradosPorCodigo=this.productos}seleccionarProducto(t){let e=t.option.value,i=this.productos.find(n=>n._id===e);i&&(this.busquedaProducto=i.nombre,this.existenciaProducto(this.farmaciaId,i._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(i)}).catch(n=>{console.error("Error en existenciaProducto: ",n)})),this.focusBarcode(100)}seleccionarPorCodigo(t){let e=t.option.value,i=this.productos.find(n=>n._id===e);i&&(this.busquedaPorCodigo=i.codigoBarras,this.existenciaProducto(this.farmaciaId,i._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(i)}).catch(n=>{console.error("Error en existenciaProducto: ",n)})),this.focusBarcode(100)}displayNombre=t=>{let e=this.productos.find(i=>i._id===t);return e?e.nombre:""};displayCodigo=t=>{let e=this.productos.find(i=>i._id===t);return e?`${e.codigoBarras} \u2014 ${e.nombre}`:""};pausarVenta(){this.ventasPausadas.push({_uid:"p"+Date.now()+Math.random().toString(36).slice(2,8),cliente:this.ventaForm.value.cliente,productos:[...this.carrito],clienteId:this.cliente||null,telefonoCliente:this.telefonoCliente||null,nombreCliente:this.nombreCliente||null,montoMonederoCliente:this.montoMonederoCliente||null,total:this.total,totalArticulos:this.totalArticulos,totalDescuento:this.totalDescuento,totalAlmonedero:this.totalAlmonedero,aplicaInapam:this.aplicaInapam,captionButtomReanudar:this.captionButtomReanudar||"(venta pausada)"}),this.ventaService.setVentasPausadas(this.ventasPausadas),this.ventasPausadas=this.ventaService.getVentasPausadas()||[],this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.aplicaInapam=!1,this.cliente="",this.captionButtomReanudar="",this.ventaForm.controls.cliente.setValue(""),this.hayCliente=!1,this.focusBarcode()}reanudarVenta(t){this.carrito.length&&this.pausarVenta();let e=this.ventasPausadas[t];this.ventaForm.patchValue({cliente:e.cliente}),this.carrito=[...e.productos],this.telefonoCliente=e.telefonoCliente,this.nombreCliente=e.nombreCliente,this.montoMonederoCliente=e.montoMonederoCliente,this.cliente=e.clienteId,this.total=e.total,this.totalArticulos=e.totalArticulos,this.totalDescuento=e.totalDescuento,this.totalAlmonedero=e.totalAlmonedero,this.aplicaInapam=e.aplicaInapam,this.captionButtomReanudar=e.captionButtomReanudar,this.ventasPausadas.splice(t,1),this.ventaService.setVentasPausadas(this.ventasPausadas),this.focusBarcode(0)}obtenerProductos(){this.productoService.obtenerProductos().subscribe({next:t=>{this.productos=t||[];let e={};for(let i of this.productos)e[i._id]=i?.imagen?this.productoService.obtenerImagenProductoUrl(i._id):this.placeholderSrc;this.thumbs=e},error:t=>console.error("Error al obtener productos",t)})}agregarProductoPorCodigo(){if(this.codigoBarras.length===0&&this.carrito.length>0)this.abrirModalPago();else{let t=this.productos.find(e=>e.codigoBarras===this.codigoBarras);t?this.existenciaProducto(this.farmaciaId,t._id,1).then(()=>{if(!this.hayProducto){this.codigoBarras="";return}this.agregarProductoAlCarrito(t)}).catch(e=>{console.error("Error en existenciaProducto: ",e)}):ot.default.fire({icon:"warning",title:"Producto no encontrado",text:"Verifica el c\xF3digo de barras",timer:1300,showConfirmButton:!1,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>this.focusBarcode(60)),this.codigoBarras="",this.focusBarcode()}}agregarProductoAlCarrito(t){return Q(this,null,function*(){let e=this.carrito.find(i=>i.producto===t._id&&!i.esGratis);if(e)this.existenciaProducto(this.farmaciaId,t._id,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(i=>{console.error("Error en existenciaProducto: ",i)});else{let i=this.precioEnFarmacia;this.descuentoMenorA25(t)&&(yield this.preguntaINAPAM(t)),t.categoria==="Recargas"||t.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(t),i*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=i*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=t.nombre);let n={producto:t._id,codBarras:t.codigoBarras,nombre:t.nombre,cantidad:1,precioFinal:i,precioOriginal:this.precioEnFarmacia,ubicacionEnFarmacia:this.ubicacionEnFarmacia,tipoDescuento:this.tipoDescuento,cadDesc:this.cadDesc,alMonedero:this.alMonedero,descuentoUnitario:this.precioEnFarmacia-i,iva:t.iva?i*.16:0,cantidadPagada:1,farmacia:this.farmaciaId,promoCantidadRequerida:t.promoCantidadRequerida};this.carrito=[n,...this.carrito]}this.aplicaGratis&&this.validarProductoGratis(t._id),this.calcularTotal()})}limpiarPromocion(t){let e=(t||"").toString();return e.startsWith("-")?e.slice(1):e}preguntaINAPAM(t){return Q(this,null,function*(){if(t.descuentoINAPAM&&!this.yaPreguntoInapam){this.yaPreguntoInapam=!0;let e=yield ot.default.fire({icon:"question",title:"\xBFTiene credencial INAPAM vigente?",html:`<h4>Me la puede mostrar por favor</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=e.isConfirmed}})}descuentoMenorA25(t){let i=new Date().getDay(),n=0;switch(i){case 0:n=t?.descuentoDomingo??null;break;case 1:n=t?.descuentoLunes??null;break;case 2:n=t?.descuentoMartes??null;break;case 3:n=t?.descuentoMiercoles??null;break;case 4:n=t?.descuentoJueves??null;break;case 5:n=t?.descuentoViernes??null;break;case 6:n=t?.descuentoSabado??null;break;default:n=0}return n?n<25:!0}descuentoYpromo(t){let e=this.soloFecha(new Date),i=e.getDay();if(this.tipoDescuento="",this.cadDesc="",this.ptjeDescuento=0,this.productoAplicaMonedero=this.hayCliente,this.alMonedero=0,this.fechaIni=this.soloFecha(new Date(e)),this.fechaFin=this.soloFecha(new Date(e)),this.aplicaGratis=!0,t.promoCantidadRequerida&&this.soloFecha(new Date(t.inicioPromoCantidad))<=this.soloFecha(e)&&this.soloFecha(new Date(t.finPromoCantidad))>=this.soloFecha(e))this.aplicaGratis=!1,this.cadDesc="",this.tipoDescuento=`${t.promoCantidadRequerida}x${t.promoCantidadRequerida-1}`,this.productoAplicaMonedero=!1,t.promoCantidadRequerida===2&&(this.aplicaGratis=!0),this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento+="-INAPAM",this.cadDesc="5%");else{let n=0,s=!1;switch(i){case 1:this.fechaIni=t?.promoLunes?.inicio??null,this.fechaFin=t?.promoLunes?.fin??null,n=t?.promoLunes?.porcentaje??null,this.productoAplicaMonedero=t?.promoLunes?.monedero??null;break;case 2:this.fechaIni=t?.promoMartes?.inicio??null,this.fechaFin=t?.promoMartes?.fin??null,n=t?.promoMartes?.porcentaje??null,this.productoAplicaMonedero=t?.promoMartes?.monedero??null;break;case 3:this.fechaIni=t?.promoMiercoles?.inicio??null,this.fechaFin=t?.promoMiercoles?.fin??null,n=t?.promoMiercoles?.porcentaje??null,this.productoAplicaMonedero=t?.promoMiercoles?.monedero??null;break;case 4:this.fechaIni=t?.promoJueves?.inicio??null,this.fechaFin=t?.promoJueves?.fin??null,n=t?.promoJueves?.porcentaje??null,this.productoAplicaMonedero=t?.promoJueves?.monedero??null;break;case 5:this.fechaIni=t?.promoViernes?.inicio??null,this.fechaFin=t?.promoViernes?.fin??null,n=t?.promoViernes?.porcentaje??null,this.productoAplicaMonedero=t?.promoViernes?.monedero??null;break;case 6:this.fechaIni=t?.promoSabado?.inicio??null,this.fechaFin=t?.promoSabado?.fin??null,n=t?.promoSabado?.porcentaje??null,this.productoAplicaMonedero=t?.promoSadado?.monedero??null;break;case 0:this.fechaIni=t?.promoDomingo?.inicio??null,this.fechaFin=t?.promoDomingo?.fin??null,n=t?.promoDomingo?.porcentaje??null,this.productoAplicaMonedero=t?.promoDomingo?.monedero??null;break}if(!n||n<=0?(this.fechaIni=this.soloFecha(new Date(e)),this.fechaIni.setDate(this.fechaIni.getDate()+5),this.fechaIni=this.soloFecha(this.fechaIni)):s=!0,s&&this.soloFecha(new Date(this.fechaIni))<=e&&this.soloFecha(new Date(this.fechaFin))>=e&&(this.tipoDescuento=this.nombreDiaSemana(i),this.ptjeDescuento=n,this.cadDesc=`${n}%`,this.productoAplicaMonedero=this.productoAplicaMonedero&&this.hayCliente),t.promoDeTemporada&&this.soloFecha(new Date(t.promoDeTemporada.inicio))<=e&&this.soloFecha(new Date(t.promoDeTemporada.fin))>=e){let d=t.promoDeTemporada.porcentaje;d>this.ptjeDescuento&&(this.ptjeDescuento=d,this.tipoDescuento="Temporada",this.cadDesc=`${d}%`,this.productoAplicaMonedero=t.promoDeTemporada.monedero&&this.hayCliente)}if(this.ptjeDescuento>0){if(this.ptjeDescuento<25&&this.aplicaInapam&&t.descuentoINAPAM){let d=this.precioEnFarmacia*(1-this.ptjeDescuento/100)*.95;this.ptjeDescuento=(1-d/this.precioEnFarmacia)*100,this.tipoDescuento+="-INAPAM",this.cadDesc+="+ 5%",this.productoAplicaMonedero=this.hayCliente}}else this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento="INAPAM",this.cadDesc="5%",this.productoAplicaMonedero=this.hayCliente);this.ptjeDescuento<=0&&(this.productoAplicaMonedero=this.hayCliente)}}soloFecha(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}eliminarProducto(t){let e=this.carrito[t];if(e.esGratis)this.carrito.splice(t,1);else{let i=e.producto;this.carrito.splice(t,1);let n=this.carrito.findIndex(s=>s.producto===i&&s.esGratis);n!==-1&&this.carrito.splice(n,1)}this.calcularTotal()}incrementarCantidad(t){let e=this.carrito[t];e.esGratis||this.existenciaProducto(this.farmaciaId,e.producto,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(i=>{console.error("Error en existenciaProducto: ",i)}),this.calcularTotal()}decrementarCantidad(t){let e=this.carrito[t];e.cantidad>1&&!e.esGratis?(e.cantidad--,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal()):e.cantidad===1&&!e.esGratis&&(e.cantidad--,this.eliminarProducto(t))}esPromocionPorCantidad(t){return["2x1","3x2","4x3"].some(i=>t?.startsWith(i))}validarProductoGratis(t){let e=this.carrito.find(d=>d.producto===t&&!d.esGratis);if(!e||!e.promoCantidadRequerida)return;let i=e.cantidad,n=e.promoCantidadRequerida,s=this.carrito.some(d=>d.producto===t&&d.esGratis);if(i>=n-1){let d=Math.floor(i/(n-1));if(this.existenciaProducto(this.farmaciaId,t,i+d),!this.hayProducto)return;if(!s)this.carrito.push({producto:e.producto,nombre:e.nombre,cantidad:1,precioFinal:0,precioOriginal:e.precioOriginal,tipoDescuento:`${n}x${n-1}-Gratis`,cadDesc:"100%",alMonedero:0,descuentoUnitario:e.precioOriginal,iva:0,lote:e.lote,fechaCaducidad:e.fechaCaducidad,cantidadPagada:0,esGratis:!0,controlesDeshabilitados:!0,lotes:e.lotes,farmacia:this.farmaciaId});else{let p=this.carrito.find(h=>h.producto===t&&h.esGratis);p&&(p.cantidad=d,p.cadDesc="100%",p.tipoDescuento=`${n}x${n-1}-Gratis`)}}else{let d=this.carrito.findIndex(p=>p.producto===t&&p.esGratis);d!==-1&&this.carrito.splice(d,1)}}calcularTotal(){this.total=this.round2(this.carrito.reduce((t,e)=>t+e.precioFinal*e.cantidad,0)),this.totalDescuento=this.round2(this.carrito.reduce((t,e)=>t+e.descuentoUnitario*e.cantidad,0)),this.totalArticulos=this.carrito.reduce((t,e)=>t+e.cantidad,0),this.totalAlmonedero=this.round2(this.carrito.reduce((t,e)=>t+e.alMonedero*e.cantidad,0))}cancelarVenta(){this.captionButtomReanudar="",this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1,this.folioVentaGenerado=null,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.hayCliente=!1}abrirModalPago(){ot.default.fire({icon:"question",title:"\xBFDESEA AGREGAR ALGO M\xC1S?",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,focusConfirm:!0,confirmButtonText:"NO, ir a cobrar",cancelButtonText:"SI, agregar m\xE1s productos"}).then(t=>{t.isConfirmed&&(this.usarMonedero=!1,this.mostrarModalPago=!0,this.montoTarjeta=null,this.montoTransferencia=null,this.montoVale=null,this.efectivoRecibido=null,this.cambio=0,this.clearBarcodeFocusTimer(),this.codigoBarrasRef?.nativeElement?.blur(),this.cdRef.detectChanges(),setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0),this.calcularTotal())})}calculaCambio(){this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.efectivoRecibido=0,this.cambio=0):this.total-this.pagoEfectivo-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1<0?this.cambio=this.pagoEfectivo-(this.total-(this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)):this.cambio=0}pagoTarjeta(){this.pagoTarjeta1>=this.total?(this.montoTarjeta=this.total,this.efectivoRecibido=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTarjeta=this.total-this.pagoTransferencia1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.ocultaTarjeta=!1,this.calculaCambio())}pagoTransferencia(){this.pagoTransferencia1>=this.total?(this.montoTransferencia=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTransferencia=this.total-this.pagoTarjeta1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}pagoVale(){this.pagoVale1>=this.total?(this.montoVale=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoVale=this.total-this.pagoTarjeta1-this.pagoTransferencia1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}onToggleMonedero(){this.usarMonedero?this.montoMonederoCliente>=this.total?this.montoVale=this.total:this.montoVale=this.montoMonederoCliente:this.habilitarInputs(),this.pagoVale()}habilitarInputs(){this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.inputsHabilitados=!1,this.montoVale=0,this.usarMonedero=!1,this.calculaCambio()}inhabilitarInputs(){this.ocultarEfectivo=!0,this.ocultaTarjeta=!0,this.ocultaTransferencia=!0,this.ocultaVale=!0,this.inputsHabilitados=!0}cancelarPago(){this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.mostrarModalPago=!1,this.focusBarcode(50)}finalizarVenta(){this.efectivoRecibido=Math.max(0,this.pagoEfectivo),this.montoTarjeta=Math.max(0,this.pagoTarjeta1),this.montoTransferencia=Math.max(0,this.pagoTransferencia1),this.montoVale=Math.max(0,this.pagoVale1),this.cambio=Math.max(0,this.cambio);let t=this.efectivoRecibido+this.montoTarjeta+this.montoTransferencia+this.montoVale;if(this.montoTarjeta+this.montoTransferencia+this.montoVale>this.total){ot.default.fire("Error","El monto con tarjeta, transferencia y/o monedero no puede exceder el total.","error");return}if(t<this.total){ot.default.fire("Pago incompleto","La suma de pagos no cubre el total de la venta.","warning");return}let i=this.folioVentaGenerado||this.generarFolioLocal();this.folioVentaGenerado=i;let n=this.carrito.map(R=>({producto:R.producto,nombre:R.nombre,barrasYNombre:`${R.codBarras.slice(-3)} ${R.nombre}`,cantidad:R.cantidad,precio:R.precioFinal,totalRen:R.precioFinal*R.cantidad,precioOriginal:R.precioOriginal,iva:R.iva,tipoDescuento:R.tipoDescuento,descuento:(R.descuentoUnitario??0)*R.cantidad,cadenaDescuento:R.cadDesc??"",monederoCliente:(R.almonedero??0)*R.cantidad}));this.ventaParaImpresion={folio:this.folioVentaGenerado,cliente:this.nombreCliente,farmacia:{nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono},productos:n,cantidadProductos:this.totalArticulos,total:this.total,totalDescuento:this.totalDescuento,totalMonederoCliente:this.totalAlmonedero,formaPago:{efectivo:this.total-this.montoTarjeta-this.montoTransferencia-this.montoVale,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,vale:this.montoVale},AsiQuedaMonedero:this.montoMonederoCliente-this.montoVale+this.totalAlmonedero,elcambio:this.cambio,fecha:new Date().toISOString(),usuario:this.nombreUs},console.log("Datos enviados al ticket: ",this.ventaParaImpresion),this.mostrarTicket=!0,this.mostrarModalPago=!1,this.cdRef.detectChanges();let s=!1,d=()=>{s||(s=!0,p(),this.ngZone.run(()=>{this.mostrarTicket=!1,this.hayCliente=!1,this.guardarVentaDespuesDeImpresion(i)}))},p=()=>{window.removeEventListener("afterprint",h),C?.removeEventListener?.("change",E),D&&clearTimeout(D)},h=()=>d(),C=window.matchMedia?window.matchMedia("print"):null,E=R=>{R?.matches||d()};window.addEventListener("afterprint",h),C?.addEventListener?.("change",E);let D=setTimeout(d,6e3);setTimeout(()=>{try{window.print()}catch{d()}},0)}limpiarVenta(){this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1}yyyymmddLocal(t=new Date){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}${i}${n}`}generarFolioLocal(){let t="FB",e=this.yyyymmddLocal(),i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n="";for(let s=0;s<6;s++){let d=Math.floor(Math.random()*i.length);n+=i[d]}return`${t}${e}-${n}`}guardarVentaDespuesDeImpresion(t){let e=this.carrito.map(n=>({producto:n.producto,cantidad:n.cantidad,precio:n.precioFinal,totalRen:n.precioFinal*n.cantidad,precioOriginal:n.precioOriginal,iva:n.iva,tipoDescuento:n.tipoDescuento,descuento:(n.descuentoUnitario??0)*n.cantidad})),i={folio:t,clienteId:this.cliente,productos:e,aplicaInapam:this.aplicaInapam,efectivo:this.total-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,importeVale:this.pagoVale1,farmacia:this.farmaciaId,totaMonederoCliente:this.totalAlmonedero};this.ventasService.crearVenta(i).subscribe({next:()=>{this.folioVentaGenerado=null,this.limpiarVenta(),this.mostrarModalPago=!1,this.ventaService.setVentasPausadas(this.ventasPausadas),ot.default.fire({icon:"success",title:"Venta Registrada",text:"Venta finalizada correctamente",timer:1300,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1,didClose:()=>{this.focusBarcode(50)}})},error:n=>{let s=n?.error?.mensaje||"Error al finalizar la venta";ot.default.fire("Error",s,"error"),s.includes("**")||(this.mostrarModalPago=!1,this.limpiarVenta(),setTimeout(()=>this.focusBarcode(50),0))}})}abrirModalConsultaPrecio(){this.mostrarModalConsultaPrecio=!0,this.codigoConsulta="",this.productoConsultado=null,this.limpiarProducto()}cerrarModalConsultaPrecio(){this.resetConsulta(),this.mostrarModalConsultaPrecio=!1,this.focusBarcode(50)}consultarPrecio(){this.codigoConsulta.trim()&&this.productoService.consultarPrecioPorCodigo(this.farmaciaId,this.codigoConsulta).subscribe({next:t=>{let e=!!t&&t.nombre!==void 0;if(this.consultaEncontrado=e,!e){this.productoConsultado=null,this.consultaImgUrl=this.placeholderSrc;return}!t||t.nombre===void 0?this.productoConsultado={nombre:"Producto no encontrado",precioNormal:null,promo1:null,precioLunes:null,lunesMasInapam:null,promo2:null,precioMartes:null,martesMasInapam:null,promo3:null,precioMiercoles:null,miercolesMasInapam:null,promo4:null,precioJueves:null,juevesMasInapam:null,promo5:null,precioViernes:null,viernesMasInapam:null,promo6:null,precioSabado:null,sabadoMasInapam:null,promo0:null,precioDomingo:null,domingoMasInapam:null,promo:null,precioConDescuento:null,precioInapam:null,precioDescuentoMasInapam:null,promoCliente:null,ubicacionEnFarmacia:null}:this.productoConsultado={nombre:t.nombre,precioNormal:t.precioNormal,promo1:t.promo1,precioLunes:t.precioLunes,lunesMasInapam:t.lunesMasInapam,promo2:t.promo2,precioMartes:t.precioMartes,martesMasInapam:t.martesMasInapam,promo3:t.promo3,precioMiercoles:t.precioMiercoles,miercolesMasInapam:t.miercolesMasInapam,promo4:t.promo4,precioJueves:t.precioJueves,juevesMasInapam:t.juevesMasInapam,promo5:t.promo5,precioViernes:t.precioViernes,viernesMasInapam:t.viernesMasInapam,promo6:t.promo6,precioSabado:t.precioSabado,sabadoMasInapam:t.sabadoMasInapam,promo0:t.promo0,precioDomingo:t.precioDomingo,domingoMasInapam:t.domingoMasInapam,promo:t.promo,precioConDescuento:t.precioConDescuento,precioInapam:t.precioInapam,precioDescuentoMasInapam:t.precioDescuentoMasInapam,promoCliente:t.promoCliente,ubicacionEnFarmacia:t.ubicacionEnFarmacia};let i=t._id??(this.productos||[]).find(n=>n.codigoBarras===this.codigoConsulta)?._id;this.consultaImgUrl=i?this.productoService.obtenerImagenProductoUrl(i):this.placeholderSrc},error:t=>{console.error("\u274C Error al consultar precio:",t),this.productoConsultado={nombre:"Error en la consulta",precioNormal:null,promo:null,precioFinal:null}}})}filtrarConsultaPorCodigo(){let t=(this.busquedaConsultaCodigo||"").trim();if(!t){this.productosConsultaFiltradosPorCodigo=[];return}this.productosConsultaFiltradosPorCodigo=this.productos.filter(e=>(e.codigoBarras||"").includes(t))}filtrarConsultaPorNombre(){let t=(this.busquedaConsultaNombre||"").trim().toLowerCase();if(!t){this.productosConsultaFiltradosPorNombre=[];return}this.productosConsultaFiltradosPorNombre=this.productos.filter(e=>(e.nombre||"").toLowerCase().includes(t))}onSelectConsultaCodigo(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaCodigo=t.option.viewValue,this.consultarPrecio()}onSelectConsultaNombre(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaNombre=t.option.viewValue,this.consultarPrecio()}existenciaProducto(t,e,i){return new Promise((n,s)=>{this.productoService.existenciaPorFarmaciaYProducto(t,e).subscribe({next:d=>{this.precioEnFarmacia=d.precioVenta,this.ubicacionEnFarmacia=d.ubicacionEnFarmacia,d.existencia>=i?(this.hayProducto=!0,n()):(ot.default.fire({icon:"error",title:"No hay suficiente existencia",html:`Producto: ${d.nombre}<br>Cantidad disponible: ${d.existencia}<br>Cantidad requerida: ${i}`,confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1}),this.hayProducto=!1,n())},error:d=>{console.error("Error al obtener la existencia del producto:",d),this.hayProducto=!1,s(d)}})})}clienteBoxVisible=!1;clienteIndex=-1;onClienteBlur(){setTimeout(()=>{this.clienteBoxVisible=!1},120)}onClienteKeyDown(t){!this.clienteBoxVisible||this.opcionesClientes.length===0||(t.key==="ArrowDown"?(t.preventDefault(),this.clienteIndex=Math.min(this.clienteIndex+1,this.opcionesClientes.length-1)):t.key==="ArrowUp"?(t.preventDefault(),this.clienteIndex=Math.max(this.clienteIndex-1,0)):t.key==="Enter"?(t.preventDefault(),this.clienteIndex>=0&&this.selectCliente(this.opcionesClientes[this.clienteIndex])):t.key==="Escape"&&(this.clienteBoxVisible=!1))}selectCliente(t){t&&(this.clienteNombreCtrl.setValue(t.nombre,{emitEvent:!1}),this.clienteBoxVisible=!1,this.onClienteSelected(t))}trackByCliente=(t,e)=>e?._id||e?.nombre||t;ensureClientesArray(t){return Array.isArray(t)?t:Array.isArray(t?.rows)?t.rows:Array.isArray(t?.data)?t.data:Array.isArray(t?.clientes)?t.clientes:[]}filtraClientesLocal(t){let e=Array.isArray(this.clientes)?this.clientes:Array.isArray(this.clientes?.rows)?this.clientes.rows:[],i=(t||"").trim().toLowerCase();if(!i)return e.slice(0,50);let n=t.replace(/\D/g,"");return e.filter(s=>{let d=(s?.nombre||"").toLowerCase(),p=String(s?.telefono||"");return d.includes(i)||n&&p.includes(n)}).slice(0,50)}filtraClientesDatalist(t){this.opcionesClientes=this.filtraClientesLocal(t)}onClienteElegidoDesdeTexto(t){let e=String(t||"").split(" \u2014 ")[0].trim().toLowerCase();if(!e)return;let n=this.ensureClientesArray(this.clientes).find(s=>String(s?.nombre||"").toLowerCase()===e);n&&this.onClienteSelected(n)}onThumbError(t,e){t.target.src=this.placeholderSrc,e?.producto&&(this.thumbs[e.producto]=this.placeholderSrc)}openPreviewVenta(t){let i=(this.productos||[]).find(s=>s._id===t.producto)?.imagen?this.productoService.obtenerImagenProductoUrl(t.producto):this.placeholderSrc,n=new Image;n.src=i,n.onload=()=>{let s=n.naturalWidth||0,d=n.naturalHeight||0,p=s*3,h=d*3,C=Math.floor(window.innerWidth*.9),E=Math.floor(window.innerHeight*.9),D=Math.min(C/p,E/h,1),R=Math.max(1,Math.round(p*D)),N=Math.max(1,Math.round(h*D));ot.default.fire({width:"auto",background:"#000",showConfirmButton:!1,showCloseButton:!0,padding:0,html:`
        <div style="max-width:${C}px;max-height:${E}px;display:flex;align-items:center;justify-content:center;">
          <img src="${i}" alt=""
               style="width:${R}px;height:${N}px;object-fit:contain;display:block;"/>
        </div>`})},n.onerror=()=>{ot.default.fire({icon:"error",title:"No se pudo cargar la imagen",text:"Int\xE9ntalo de nuevo."})}}static \u0275fac=function(e){return new(e||o)(P(He),P(or),P(It),P($t),P(yn),P(Fe),P(mt))};static \u0275cmp=V({type:o,selectors:[["app-ventas"]],viewQuery:function(e,i){if(e&1&&(Ee(s0,5),Ee(l0,5),Ee(c0,5,Ui)),e&2){let n;ye(n=Ce())&&(i.codigoBarrasRef=n.first),ye(n=Ce())&&(i.efectivoRecibidoRef=n.first),ye(n=Ce())&&(i.cliTrigger=n.first)}},hostBindings:function(e,i){e&1&&g("keydown.enter",function(s){return i.handleEnter(s)},!1,nn)},decls:116,vars:46,consts:[["autoClientes","matAutocomplete"],["codigoBarrasRef",""],["autoCodigo","matAutocomplete"],["autoNombre","matAutocomplete"],["payForm","ngForm"],["autoConsCodigo","matAutocomplete"],["autoConsNombre","matAutocomplete"],["efectivoRecibidoRef",""],[1,"row","align-items-center","titulo-row"],[1,"col-6","text-end"],[1,"titulo","mb-0"],[1,"col-6","d-flex","justify-content-center"],[1,"me-2","mb-0"],[1,"form-select","form-select-sm","scale-select",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"row","align-items-center","mb-1"],[1,"col-md-2"],["appearance","outline",1,"compact-field"],["type","text","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["id","clientesList"],[1,"col-md-1","text-end"],[1,"cliente-tel"],[1,"col-md-2","position-relative"],["type","text",1,"form-control","pe-5",3,"ngModelChange","input","ngModel"],["type","button","matTooltip","Limpiar cliente","class","btn btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-3"],["class","cliente-nombre",4,"ngIf"],["class","col-md-2",4,"ngIf"],[1,"col-md-2","text-end"],[1,"btn-gris","consultar-precio",3,"click"],[1,"productos-container"],[1,"subtitulo"],["type","text","id","codigoBarras","placeholder","Escanear C\xF3d. barras",1,"input-text","input-cb",3,"ngModelChange","keyup.enter","ngModel","disabled"],["appearance","outline",1,"compact-field","wide-field","mr-field"],["matInput","",3,"ngModelChange","input","ngModel","matAutocomplete"],["appearance","outline",1,"compact-field","wider-field"],["matTooltip","Limpiar producto",1,"btn-rojo-tache",3,"click"],[1,"fas","fa-times"],["class","modal-overlay",4,"ngIf"],[1,"ventas-container"],[1,"tabla"],[1,"col-acciones"],[1,"col-img"],[1,"col-producto"],[1,"col-cant"],[1,"col-precio"],[1,"col-imp-normal"],[1,"col-promo"],[1,"col-desc-porc"],[1,"col-monedero"],[1,"col-desc"],[1,"col-precio-final"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"total-container"],[1,"left"],[1,"center"],[1,"right"],["class","botones-container",4,"ngIf"],["class","mt-4",4,"ngIf"],[3,"ngSubmit"],["class","ticket-impresion",3,"venta",4,"ngIf"],[3,"ngValue"],[3,"value"],["type","button","matTooltip","Limpiar cliente",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"cliente-nombre"],["type","checkbox","id","aplicaInapam","name","aplicaInapam",3,"ngModelChange","ngModel"],["for","aplicaInapam"],[1,"modal-overlay"],[1,"modal-content",2,"width","600px"],[1,"input-container","position-relative"],["type","text","placeholder","C\xF3digo de barras",1,"input-field",3,"ngModelChange","keyup.enter","ngModel"],["matTooltip","Limpiar c\xF3d. barras",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["class","row",4,"ngIf"],["matTooltip","Salir de consultar",1,"btn-rojo-tache",3,"click"],[1,"row"],[1,"consulta-img-wrap","col-sm-7","text-center"],["alt","Imagen de producto",3,"error","src"],["class","col-sm-5 text-center mt-4",4,"ngIf"],[1,"col-sm-5","text-center","mt-4"],["appearance","outline",1,"w-100","mb-1","compact-field"],["matInput","","placeholder","Buscar C\xF3d. barras",3,"ngModelChange","input","ngModel","matAutocomplete"],[3,"optionSelected"],["matInput","","placeholder","Buscar producto por nombre",3,"ngModelChange","input","ngModel","matAutocomplete"],["role","group","aria-label","Acciones",1,"acciones-group"],["matTooltip","Eliminar rengl\xF3n",1,"btn-icono","btn-rojo-tache",3,"click","disabled"],["matTooltip","Aumentar uno",1,"btn-icono","btn-verde",3,"click","disabled"],[1,"fas","fa-plus"],["matTooltip","Quitar uno",1,"btn-icono","btn-gris",3,"click","disabled"],[1,"fas","fa-minus"],[1,"img-cell"],["type","button",1,"img-button",3,"click"],["alt","","loading","lazy","decoding","async","matTooltip","Ver imagen","matTooltipPosition","right","matTooltipClass","tip-tight",3,"error","src"],[1,"prod-nombre"],[1,"prod-ubicacion"],[1,"botones-container"],[1,"btn-amarillo",3,"click"],[1,"btn-rojo",3,"click"],[1,"btn-verde","btn-right",3,"click"],[1,"mt-4"],["class","btn-gris d-block w-100 mb-2",3,"click",4,"ngFor","ngForOf"],[1,"btn-gris","d-block","w-100","mb-2",3,"click"],[1,"modal-content"],[1,"modal-header","bg-info-subtle","text-blue"],[1,"modal-title"],[1,"modal-body"],[1,"total-pago"],[1,"form-group","row","mb-2"],["for","efectivoRecibido",1,"col-sm-4","col-form-label","text-left"],[1,"col-sm-7","offset-sm-1","d-flex","justify-content-end"],["id","efectivoRecibido","name","efectivoRecibido","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","disabled"],["for","montoTarjeta",1,"col-sm-4","col-form-label","text-left"],["id","montoTarjeta","name","montoTarjeta","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["for","montoTransferencia",1,"col-sm-4","col-form-label"],["id","montoTransferencia","name","montoTransferencia","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["class","monedero-container",4,"ngIf"],[1,"mt-3","cambio"],["class","text-danger mt-3",4,"ngIf"],["class","text-success mt-3",4,"ngIf"],[1,"btns-container"],["type","button",1,"btn-rojo-tache",3,"click"],["type","submit",1,"btn-gris",3,"disabled"],[1,"button-container"],["type","button","class","btn-amarillo",3,"click",4,"ngIf"],[1,"monedero-container"],[1,"col-12","text-center",2,"color","rgb(3, 7, 83)","font-weight","bold","font-size","large"],[1,"col-sm-8"],["for","usarMonedero",1,"col-form-label"],[1,"col-sm-4","d-flex","align-items-center"],["id","usarMonedero","type","checkbox","name","usarMonedero",1,"form-check-input",3,"ngModelChange","ngModel"],["for","usarMonedero",1,"ms-2"],["class","form-group row mb-2",4,"ngIf"],[1,"col-sm-8","col-form-label","text-left"],[1,"col-sm-4","d-flex","justify-content-end"],[1,"form-control-plaintext","text-end"],[1,"text-danger","mt-3"],[1,"text-success","mt-3"],["type","button",1,"btn-amarillo",3,"click"],[1,"fas","fa-sync-alt"],[1,"ticket-impresion",3,"venta"]],template:function(e,i){if(e&1){let n=I();a(0,"div")(1,"div",8)(2,"div",9)(3,"h1",10),c(4,"Ventas"),r()(),a(5,"div",11)(6,"label",12),c(7,"Tama\xF1o imagen:"),r(),a(8,"select",13),k("ngModelChange",function(d){return b(n),O(i.thumbScale,d)||(i.thumbScale=d),v(d)}),g("ngModelChange",function(d){return b(n),v(i.onScaleChange(d))}),S(9,d0,2,2,"option",14),r()()(),a(10,"div",15)(11,"div",16)(12,"mat-form-field",17)(13,"mat-label"),c(14,"Busca cliente, nombre"),r(),f(15,"input",18),a(16,"mat-autocomplete",19,0),g("optionSelected",function(d){return b(n),v(i.onClienteSelected(d.option.value))}),S(18,p0,3,3,"mat-option",20),y(19,"async"),S(20,u0,2,0,"mat-option",21),y(21,"async"),r()(),a(22,"datalist",22),S(23,f0,1,1,"option",20),r()(),a(24,"div",23)(25,"label",24),c(26,"Tel.:"),r()(),a(27,"div",25)(28,"input",26),k("ngModelChange",function(d){return b(n),O(i.telefonoCliente,d)||(i.telefonoCliente=d),v(d)}),g("input",function(){return b(n),v(i.buscarCliente())}),r(),S(29,h0,2,1,"button",27),r(),a(30,"div",28),S(31,g0,2,1,"span",29),r(),S(32,_0,4,1,"div",30),a(33,"div",31)(34,"button",32),g("click",function(){return b(n),v(i.abrirModalConsultaPrecio())}),c(35,"Consultar Precio"),r()()(),a(36,"div",33)(37,"h2",34),c(38,"Producto:"),r(),a(39,"input",35,1),k("ngModelChange",function(d){return b(n),O(i.codigoBarras,d)||(i.codigoBarras=d),v(d)}),g("keyup.enter",function(){return b(n),v(i.agregarProductoPorCodigo())}),r(),a(41,"mat-form-field",36)(42,"mat-label"),c(43,"Buscar C\xF3d. barras"),r(),a(44,"input",37),k("ngModelChange",function(d){return b(n),O(i.busquedaPorCodigo,d)||(i.busquedaPorCodigo=d),v(d)}),g("input",function(){return b(n),v(i.filtrarPorCodigo())}),r(),a(45,"mat-autocomplete",19,2),g("optionSelected",function(d){return b(n),v(i.seleccionarPorCodigo(d))}),S(47,b0,2,3,"mat-option",20),r()(),a(48,"mat-form-field",38)(49,"mat-label"),c(50,"Buscar producto"),r(),a(51,"input",37),k("ngModelChange",function(d){return b(n),O(i.busquedaProducto,d)||(i.busquedaProducto=d),v(d)}),g("input",function(){return b(n),v(i.filtrarProductos())}),r(),a(52,"mat-autocomplete",19,3),g("optionSelected",function(d){return b(n),v(i.seleccionarProducto(d))}),S(54,v0,2,2,"mat-option",20),r()(),a(55,"button",39),g("click",function(){return b(n),v(i.limpiarProducto())}),f(56,"i",40),r()(),S(57,q0,13,5,"div",41),a(58,"div",42)(59,"table",43)(60,"colgroup"),f(61,"col",44)(62,"col",45)(63,"col",46)(64,"col",47)(65,"col",48)(66,"col",49)(67,"col",50)(68,"col",51)(69,"col",52)(70,"col",53)(71,"col",54),r(),a(72,"thead")(73,"tr")(74,"th",44),c(75,"Acc."),r(),a(76,"th",45),c(77,"Imagen"),r(),a(78,"th"),c(79,"Producto / ubic."),r(),a(80,"th"),c(81,"Cant."),r(),a(82,"th"),c(83,"P. U."),r(),a(84,"th"),c(85,"Imp. normal"),r(),a(86,"th"),c(87,"Promo"),r(),a(88,"th"),c(89,"% desc."),r(),a(90,"th"),c(91,"Moned."),r(),a(92,"th"),c(93,"Desc."),r(),a(94,"th"),c(95,"Precio Final"),r()()(),a(96,"tbody"),S(97,W0,39,30,"tr",55),r()()(),a(98,"div",56)(99,"div",57),c(100),r(),a(101,"div",58),c(102),y(103,"currency"),r(),a(104,"div",58),c(105),y(106,"currency"),r(),a(107,"div",59),c(108),y(109,"currency"),r()(),S(110,G0,7,0,"div",60)(111,Q0,4,1,"div",61),r(),a(112,"form",62,4),g("ngSubmit",function(){return b(n),v(i.finalizarVenta())}),S(114,tf,42,23,"div",41),r(),S(115,nf,1,1,"app-venta-ticket",63)}if(e&2){let n,s=$e(17),d=$e(46),p=$e(53);l(8),T("ngModel",i.thumbScale),l(),m("ngForOf",i.scales),l(6),m("formControl",i.clienteNombreCtrl)("matAutocomplete",s),l(),m("displayWith",i.displayCliente),l(2),m("ngForOf",M(19,36,i.filteredClientes$)),l(2),m("ngIf",((n=M(21,38,i.filteredClientes$))==null?null:n.length)===0),l(3),m("ngForOf",i.opcionesClientes),l(5),T("ngModel",i.telefonoCliente),l(),m("ngIf",i.telefonoCliente),l(2),m("ngIf",i.nombreCliente),l(),m("ngIf",i.carrito.length>0),l(7),T("ngModel",i.codigoBarras),m("disabled",i.mostrarModalPago),te("tabindex",i.mostrarModalPago?-1:0),l(5),T("ngModel",i.busquedaPorCodigo),m("matAutocomplete",d),l(),m("displayWith",i.displayCodigo),l(2),m("ngForOf",i.productosFiltradosPorCodigo),l(4),T("ngModel",i.busquedaProducto),m("matAutocomplete",p),l(),m("displayWith",i.displayNombre),l(2),m("ngForOf",i.productosFiltrados),l(3),m("ngIf",i.mostrarModalConsultaPrecio),l(),xt("--thumb-scale",i.thumbScale),l(39),m("ngForOf",i.carrito)("ngForTrackBy",i.trackByProducto),l(3),x("Total de art\xEDculos: ",i.totalArticulos,""),l(2),x("Abono al Monedero: ",M(103,40,i.totalAlmonedero),""),l(3),x("Usted ahorr\xF3: ",M(106,42,i.totalDescuento),""),l(3),x("Total: ",M(109,44,i.total),""),l(2),m("ngIf",i.carrito.length),l(),m("ngIf",i.ventasPausadas.length),l(3),m("ngIf",i.mostrarModalPago),l(),m("ngIf",i.ventaParaImpresion&&i.mostrarTicket)}},dependencies:[j,Y,z,ko,Re,me,ke,ce,de,ie,Ae,at,le,Z,Oe,Et,xi,xe,sn,De,Ao,Je,Ze,ir,bn,nr,pn,Ui,hn,Go,Wo,Jc,fn,_e],styles:[".ventas-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.cliente[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.cliente-tel[_ngcontent-%COMP%]{font-size:large}.cliente-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:700;padding:10px 15px;border-radius:5px;margin-left:15px}.consultar-precio[_ngcontent-%COMP%]{margin-left:auto}.productos-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;flex-wrap:wrap;border-bottom:2px solid #0453b3}.productos-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.productos-container[_ngcontent-%COMP%]   .subtitulo[_ngcontent-%COMP%]{margin:0 6px 0 0}.input-text.input-cb[_ngcontent-%COMP%]{height:40px;padding:8px 10px;width:180px;margin-right:5rem}.wide-field[_ngcontent-%COMP%]{width:400px}.wider-field[_ngcontent-%COMP%]{width:340px}.wide-client[_ngcontent-%COMP%]{width:360px}.mr-field[_ngcontent-%COMP%]{margin-right:5rem}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}[_nghost-%COMP%]     .compact-field{transform:translateY(10px)}.total-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;margin-top:10px;padding:10px;border-top:2px solid #ccc;font-size:16px;line-height:1.5}.left[_ngcontent-%COMP%]{text-align:left;font-size:xx-large;color:#8a2be2}.center[_ngcontent-%COMP%]{text-align:center}.right[_ngcontent-%COMP%]{text-align:right;font-size:xx-large;color:#8a2be2}.botones-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px}.botones-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:45px;min-width:130px;font-size:16px;padding:6px 12px;border-radius:8px;vertical-align:middle;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 5px 15px #0000004d;text-align:center;width:400px;align-items:center;background-color:var(--fondo-modal);padding:5px}.select[_ngcontent-%COMP%]{width:300px;height:41px}.input-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1000;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.modal-dialog[_ngcontent-%COMP%]{width:400px;margin:auto}.show-modal[_ngcontent-%COMP%]{display:block!important}.input-field[_ngcontent-%COMP%]{flex-grow:1;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}.deshabilitado[_ngcontent-%COMP%]{opacity:.5!important;cursor:not-allowed!important;pointer-events:none!important}.cambio[_ngcontent-%COMP%]{font-size:30px;color:#030753;font-weight:700}.total-pago[_ngcontent-%COMP%]{font-size:20px;color:#030753;font-weight:700}.modal-body[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{text-align:left!important}.monedero-container[_ngcontent-%COMP%]{padding-top:1rem;border-top:1px solid rgb(3,7,83);border-bottom:1px solid rgb(3,7,83);color:#030753}.btns-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between!important;width:90%;border-top:1px solid rgb(3,7,83);padding:1rem}.button-container[_ngcontent-%COMP%]{flex-grow:1;text-align:center}.mr-2[_ngcontent-%COMP%]{margin-right:8px!important}.btn[_ngcontent-%COMP%]{width:1.7rem;margin-right:15px}.ventas-container[_ngcontent-%COMP%]{--thumb-w-base: 56px;--thumb-h-base: 56px;--thumb-w: calc(var(--thumb-w-base) * var(--thumb-scale));--thumb-h: calc(var(--thumb-h-base) * var(--thumb-scale))}.tabla[_ngcontent-%COMP%]{table-layout:fixed;width:100%}col.col-acciones[_ngcontent-%COMP%]{width:48px}col.col-img[_ngcontent-%COMP%]{width:var(--thumb-w)}col.col-cant[_ngcontent-%COMP%]{width:65px}col.col-precio[_ngcontent-%COMP%]{width:80px}col.col-imp-normal[_ngcontent-%COMP%]{width:110px}col.col-promo[_ngcontent-%COMP%]{width:160px}col.col-desc-porc[_ngcontent-%COMP%]{width:165px}col.col-monedero[_ngcontent-%COMP%]{width:75px}col.col-desc[_ngcontent-%COMP%]{width:80px}col.col-precio-final[_ngcontent-%COMP%]{width:115px}col.col-producto[_ngcontent-%COMP%]{width:auto}.col-img[_ngcontent-%COMP%]{text-align:center;padding:0}.img-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.img-button[_ngcontent-%COMP%]{background:transparent;border:0;padding:4px;position:relative;line-height:0;display:inline-block;width:var(--thumb-w)!important;height:var(--thumb-h)!important;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%!important;height:100%!important;object-fit:contain!important;max-width:100%}.col-acciones[_ngcontent-%COMP%]{text-align:center}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;align-items:center;justify-content:center}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row}}.img-button[_ngcontent-%COMP%]   .zoom-corner[_ngcontent-%COMP%]{position:absolute;right:6px;bottom:6px;background:#0000008c;color:#fff;border-radius:4px;padding:2px 4px;font-size:12px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:auto}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{vertical-align:middle}.consulta-img-wrap[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:8px 0 6px}.consulta-img-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:70%;max-height:220px;object-fit:contain;border-radius:6px;box-shadow:0 2px 10px #00000040}.col-acciones[_ngcontent-%COMP%]{width:48px;min-width:48px;text-align:center;vertical-align:middle}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row;gap:8px}}.col-img[_ngcontent-%COMP%]{width:calc(var(--thumb-col-base) * var(--thumb-scale));min-width:calc(var(--thumb-col-base) * var(--thumb-scale))}.col-cant[_ngcontent-%COMP%]{width:70px}.col-precio[_ngcontent-%COMP%]{width:100px}.col-imp-normal[_ngcontent-%COMP%]{width:120px}.col-promo[_ngcontent-%COMP%]{width:150px}.col-desc-porc[_ngcontent-%COMP%], .col-monedero[_ngcontent-%COMP%]{width:80px}.col-desc[_ngcontent-%COMP%]{width:100px}.col-precio-final[_ngcontent-%COMP%]{width:120px}.col-producto[_ngcontent-%COMP%]{width:auto}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){white-space:normal;overflow-wrap:anywhere;line-height:1.3}.tabla[_ngcontent-%COMP%]   td.col-precio[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-imp-normal[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-monedero[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-desc[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-precio-final[_ngcontent-%COMP%]{text-align:right}.titulo-row[_ngcontent-%COMP%]{margin-bottom:6px}.scale-select[_ngcontent-%COMP%]{width:120px}@media (max-width: 576px){.scale-select[_ngcontent-%COMP%]{width:100px}}"]})};function of(o,t){if(o&1&&(a(0,"div",3),c(1," Resta: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function rf(o,t){if(o&1&&(a(0,"div",3),c(1," Pago final: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function af(o,t){if(o&1&&(a(0,"div",3),c(1," Dinero devuelto: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u();l(3),x("$",w(4,1,e.pedido.pedido.aCuenta,"1.2-2"),"")}}function sf(o,t){o&1&&(a(0,"div",8)(1,"strong"),c(2,"Su pedido pronto se entregar\xE1"),r()())}function lf(o,t){o&1&&(a(0,"div",8)(1,"strong"),c(2,"Su pedido le ha sido entregado"),r()())}function cf(o,t){o&1&&(a(0,"div",8)(1,"strong"),c(2,"Su pedido fue CANCELADO"),r()())}var Yn=class o{pedido;fechaActual=new Date;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-pedido-ticket"]],inputs:{pedido:"pedido"},decls:36,vars:25,consts:[["id","ticketPedido",1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono"],[1,"info-pedido"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["style","text-align: center;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[2,"text-align","center"]],template:function(e,i){e&1&&(a(0,"div",0),f(1,"app-ticket-header",1),a(2,"div",2)(3,"div"),c(4,"Pedido: "),a(5,"strong"),c(6),r()(),a(7,"div",3),c(8,"Total: "),a(9,"strong"),c(10),y(11,"number"),r()(),a(12,"div",3),c(13,"Anticipo: "),a(14,"strong"),c(15),y(16,"number"),r()(),S(17,of,5,4,"div",4)(18,rf,5,4,"div",4)(19,af,5,4,"div",4),f(20,"hr"),S(21,sf,3,0,"div",5)(22,lf,3,0,"div",5)(23,cf,3,0,"div",5),f(24,"hr"),a(25,"div",6)(26,"div",7),c(27),r(),c(28),y(29,"date"),f(30,"br"),c(31),f(32,"br"),c(33),r(),f(34,"hr")(35,"app-ticket-footer"),r()()),e&2&&(l(),m("nombreFarmacia",i.pedido.farmaNombre)("direccion",i.pedido.farmaDireccion)("telefono",i.pedido.farmaTelefono),l(5),_(i.pedido.pedido.descripcion),l(4),x("$",w(11,16,i.pedido.pedido.total,"1.2-2"),""),l(5),x("$",w(16,19,i.pedido.pedido.aCuenta,"1.2-2"),""),l(2),m("ngIf",i.pedido.movimiento==="agregar"),l(),m("ngIf",i.pedido.movimiento==="surtir"),l(),m("ngIf",i.pedido.movimiento==="cancelar"),l(2),m("ngIf",i.pedido.movimiento==="agregar"),l(),m("ngIf",i.pedido.movimiento==="surtir"),l(),m("ngIf",i.pedido.movimiento==="cancelar"),l(4),x("Folio pedido: ",i.pedido.pedido.folio,""),l(),x(" Fecha: ",w(29,22,i.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),l(3),x(" Atendi\xF3: ",i.pedido.userName,""),l(2),x(" Cliente: ",i.pedido.client||"P\xFAblico general"," "))},dependencies:[j,z,Te,Me,li,si],styles:[".info-general[_ngcontent-%COMP%]{font-size:14px!important}.info-pedido[_ngcontent-%COMP%]{font-size:16px!important}"]})};var ee=lt(_t());var X=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(X||{}),Ht="*";function Hi(o,t){return{type:X.Trigger,name:o,definitions:t,options:{}}}function zi(o,t=null){return{type:X.Animate,styles:t,timings:o}}function Td(o,t=null){return{type:X.Sequence,steps:o,options:t}}function At(o){return{type:X.Style,styles:o,offset:null}}function di(o,t,e){return{type:X.State,name:o,styles:t,options:e}}function qi(o,t,e=null){return{type:X.Transition,expr:o,animation:t,options:e}}var ci=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(t=0,e=0){this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},$i=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(t){this.players=t;let e=0,i=0,n=0,s=this.players.length;s==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++n==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,p)=>Math.max(d,p.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){let e=t*this.totalTime;this.players.forEach(i=>{let n=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(n)})}getPosition(){let t=this.players.reduce((e,i)=>e===null||i.totalTime>e.totalTime?i:e,null);return t!=null?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},Cn="!";var xn=class o{constructor(t){this.http=t}apiUrl=`${J.apiUrl}/pedidos/`;obtenerPedidos(t,...e){let i;if(typeof t=="string"){let[d,p,h,C,E,D]=e;i={farmaciaId:t,fechaIni:d,fechaFin:p,folio:h,estado:C,descripcion:E,descripcionMinima:D}}else i=t;let n=new Le().set("farmacia",i.farmaciaId),s=(d,p)=>{if(!d||!p)return;let h=new Date(d);n=n.set(p,h.toISOString().slice(0,10))};return s(i.fechaIni,"fechaInicio"),s(i.fechaFin,"fechaFin"),i.folio&&/^[A-Za-z0-9]{6}$/.test(i.folio)&&(n=n.set("folio",i.folio)),i.estado&&(n=n.set("estado",i.estado)),i.descripcion&&(n=n.set("descripcion",i.descripcion)),i.descripcionMinima!==void 0&&(n=n.set("descripcionMinima",String(!!i.descripcionMinima))),i.page&&(n=n.set("page",String(i.page))),i.limit&&(n=n.set("limit",String(i.limit))),i.sortBy&&(n=n.set("sortBy",i.sortBy)),i.sortDir&&(n=n.set("sortDir",(i.sortDir||"desc").toLowerCase())),i.clienteNombre&&(n=n.set("clienteNombre",i.clienteNombre)),i.clienteNull!==void 0&&(n=n.set("clienteNull",String(!!i.clienteNull))),this.http.get(this.apiUrl,{params:n})}agregarPedido(t){return this.http.post(this.apiUrl,t)}surtirPedido(t){let e=localStorage.getItem("auth_token"),i=new ne({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}surtir`,t,{headers:i})}cancelarPedido(t){let e=localStorage.getItem("auth_token"),i=new ne({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}cancelar`,t,{headers:i})}actualizarCostoPedido(t,e){return this.http.patch(`${this.apiUrl}actualizar-costo/${t}`,{costo:e})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var df=["contenedorTicket"];function mf(o,t){if(o&1){let e=I();a(0,"button",22),g("click",function(){b(e);let n=u();return v(n.limpiarFiltroCompleto())}),f(1,"i",23),r()}}function pf(o,t){if(o&1){let e=I();a(0,"button",24),g("click",function(){b(e);let n=u();return v(n.buscarSinFolio())}),c(1,"Buscar"),r()}if(o&2){let e=u();m("disabled",e.pedidos.length>0)}}function uf(o,t){o&1&&(a(0,"h2",25),c(1,"Pedidos pendientes de entrega"),r())}function ff(o,t){if(o&1&&(a(0,"tr")(1,"td",40),c(2,"Levant\xF3:"),r(),a(3,"td",38),c(4),r(),a(5,"td",40),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_(e.usuarioPidio.nombre),l(2),x("",pt(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")," ")}}function hf(o,t){if(o&1&&(a(0,"tr")(1,"td",40),c(2,"Surti\xF3:"),r(),a(3,"td",38),c(4),r(),a(5,"td",40),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_(e.usuarioSurtio.nombre),l(2),x("",pt(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City")," ")}}function gf(o,t){if(o&1&&(a(0,"tr")(1,"td",40),c(2,"Cancel\xF3:"),r(),a(3,"td",38),c(4),r(),a(5,"td",40),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_(e.usuarioCancelo.nombre),l(2),x("",pt(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City")," ")}}function _f(o,t){if(o&1){let e=I();a(0,"tr")(1,"td",38)(2,"button",31),g("click",function(){b(e);let n=u(2).$implicit,s=u(2);return v(s.surtirPedido(n))}),f(3,"fa-icon",17),r()(),a(4,"td",38)(5,"button",32),g("click",function(){b(e);let n=u(2).$implicit,s=u(2);return v(s.CancelarPedido(n))}),f(6,"i",23),r()()()}o&2&&(l(3),m("icon","shopping-cart"))}function bf(o,t){if(o&1&&(a(0,"tr")(1,"td",35)(2,"div",36)(3,"table",37)(4,"thead")(5,"tr")(6,"th",38),c(7),r(),a(8,"th",38),c(9),y(10,"currency"),r()()(),a(11,"tbody")(12,"tr")(13,"td",39),c(14),y(15,"currency"),r(),a(16,"td",39),c(17),y(18,"currency"),r()(),a(19,"tr")(20,"td"),c(21,"Efectivo:"),r(),a(22,"td"),c(23),y(24,"currency"),r(),a(25,"td"),c(26,"Efectivo:"),r(),a(27,"td"),c(28),y(29,"currency"),r()(),a(30,"tr")(31,"td"),c(32,"Tarjeta:"),r(),a(33,"td"),c(34),y(35,"currency"),r(),a(36,"td"),c(37,"Tarjeta:"),r(),a(38,"td"),c(39),y(40,"currency"),r()(),a(41,"tr")(42,"td"),c(43,"Transferencia:"),r(),a(44,"td"),c(45),y(46,"currency"),r(),a(47,"td"),c(48,"Transferencia:"),r(),a(49,"td"),c(50),y(51,"currency"),r()(),a(52,"tr")(53,"td"),c(54,"Monedero:"),r(),a(55,"td"),c(56),y(57,"currency"),r(),a(58,"td"),c(59,"Monedero"),r(),a(60,"td"),c(61),y(62,"currency"),r()(),S(63,ff,8,6,"tr",34)(64,hf,8,6,"tr",34)(65,gf,8,6,"tr",34)(66,_f,7,1,"tr",34),r()()()()()),o&2){let e=u().$implicit,i=u(2);l(7),x("Estado: ",e.estado,""),l(2),x("Precio: ",M(10,16,e.total),""),l(5),x("Anticipo: ",M(15,18,e.aCuenta),""),l(3),x("Resta: ",M(18,20,e.resta),""),l(6),_(M(24,22,e.pagoACuenta.efectivo)),l(5),_(M(29,24,e.pagoResta.efectivo)),l(6),_(M(35,26,e.pagoACuenta.tarjeta)),l(5),_(M(40,28,e.pagoResta.tarjeta)),l(6),_(M(46,30,e.pagoACuenta.transferencia)),l(5),_(M(51,32,e.pagoResta.transferencia)),l(6),_(M(57,34,e.pagoACuenta.vale)),l(5),_(M(62,36,e.pagoResta.vale)),l(2),m("ngIf",i.esAdmin),l(),m("ngIf",e.estado==="entregado"&&i.esAdmin),l(),m("ngIf",e.estado==="cancelado"&&i.esAdmin),l(),m("ngIf",e.estado==="inicial")}}function vf(o,t){if(o&1){let e=I();oe(0),a(1,"tr")(2,"td")(3,"button",28),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.pedidoDetalleAbiertoId===n._id?s.cerrarDetallePedido(n):s.abrirDetallePedido(n))}),f(4,"fa-icon",29),r()(),a(5,"td"),c(6),r(),a(7,"td"),c(8),y(9,"date"),r(),a(10,"td"),c(11),r(),a(12,"td"),c(13),r(),a(14,"td"),c(15),y(16,"currency"),r(),a(17,"td"),c(18),y(19,"currency"),r(),a(20,"td"),c(21),y(22,"currency"),r(),a(23,"td",30)(24,"button",31),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.surtirPedido(n))}),f(25,"fa-icon",17),r(),a(26,"button",32),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.CancelarPedido(n))}),f(27,"i",23),r(),a(28,"button",33),g("click",function(){b(e);let n=u(2);return v(n.limpiarFiltroCompleto())}),f(29,"fa-icon",17),r()()(),S(30,bf,67,38,"tr",34),re()}if(o&2){let e=t.$implicit,i=u(2);l(3),m("matTooltip",i.pedidoDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),l(),m("icon",i.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",i.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),l(2),_(e.folio),l(2),_(pt(9,13,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),l(3),_((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),l(2),_(e.descripcion),l(2),_(M(16,17,e.total)),l(3),_(M(19,19,e.aCuenta)),l(3),_(M(22,21,e.resta)),l(4),m("icon","shopping-cart"),l(4),m("icon","eye-slash"),l(),m("ngIf",i.pedidoDetalleAbiertoId===e._id)}}function yf(o,t){if(o&1&&(a(0,"table",26)(1,"thead")(2,"tr"),f(3,"th"),a(4,"th"),c(5,"Folio"),r(),a(6,"th"),c(7,"F. pedido"),r(),a(8,"th"),c(9,"Cliente"),r(),a(10,"th"),c(11,"Descripci\xF3n"),r(),a(12,"th"),c(13,"Precio"),r(),a(14,"th"),c(15,"A cuenta"),r(),a(16,"th"),c(17,"Resta"),r(),a(18,"th"),c(19,"Acciones"),r()()(),a(20,"tbody"),S(21,vf,31,23,"ng-container",27),r()()),o&2){let e=u();l(21),m("ngForOf",e.pedidos)}}function Cf(o,t){o&1&&(a(0,"p",41),c(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),r())}function xf(o,t){if(o&1&&f(0,"app-pedido-ticket",42),o&2){let e=u();m("pedido",e.paraImpresion)}}var ar=class o{constructor(t,e,i,n,s,d,p){this.library=t;this.pedidosService=e;this.authService=i;this.clienteService=n;this.FarmaciaService=s;this.cdr=d;this.ngZone=p;this.library.addIcons(Ut,mn,dn,ct)}contenedorTicket;pedidoTicketComp;pedidos=[];filtroFolio="";filtroDescripcion="";filtroFechaPedido="";esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmaciaId=null;farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";usuarioId="";usuarioRol="";usuarioNombre="";firmaAutorizada="";yaImprimio=!1;paraGuardar=null;folioGenerado=null;faTimes=ct;mostrarTicket=!1;paraImpresion=null;imprimirY(t){this.mostrarTicket=!0,this.cdr.detectChanges(),setTimeout(()=>{window.print(),this.mostrarTicket=!1,t()},300)}ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){ee.default.fire("Error","No se encontr\xF3 la farmacia en localStorage","error");return}e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaTelefono=e.telefono,this.farmaciaDireccion=e.direccion);let i=this.authService.getUserData(),n=i?.rol,s=i?.nombre,d=i?.id;this.usuarioId=d,this.usuarioRol=n,this.usuarioNombre=s,this.authService.obtenerFirma(e._id).subscribe({next:p=>{this.firmaAutorizada=p.firma,console.log("La firma es: ",this.firmaAutorizada)},error:p=>{console.error("\u274C Error al obtener firma de farmacia:",p),ee.default.fire("Error","No se pudo obtener la firma de la farmacia","error")}})}formatearFecha(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${i}/${n}/${s}`}obtenerPedido(t){if(!this.farmaciaId){ee.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio=t.trim(),/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.pedidosService.obtenerPedidos(this.farmaciaId,void 0,void 0,this.filtroFolio,"inicial").subscribe({next:e=>{this.pedidos=e.pedidos},error:e=>{console.error("Error al buscar por folio:",e),this.pedidos=[]}}):this.pedidos=[]}buscarSinFolio(){return Q(this,null,function*(){if(!this.farmaciaId){ee.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio="";let t=this.filtroFechaPedido,e=this.filtroDescripcion?.trim();if(!t||!e){yield ee.default.fire("Campos incompletos","Debes proporcionar fecha y descripci\xF3n para buscar sin folio.","warning");return}if(e.length<5){yield ee.default.fire({icon:"info",title:"Descripci\xF3n muy corta",text:"Ingresa al menos 5 caracteres.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.pedidosService.obtenerPedidos(this.farmaciaId,t,void 0,void 0,"inicial",e,!0).subscribe({next:i=>{this.filtroFechaPedido="",this.filtroDescripcion="",!i.pedidos||i.pedidos.length===0?(ee.default.fire({icon:"info",title:"No encontrado",text:`El d\xEDa ${t} no existe un pedido pendiente de entrega de ${e}`,timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[]):this.pedidos=i.pedidos},error:i=>{console.error("Error al buscar sin folio:",i),ee.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.filtroFechaPedido="",this.filtroDescripcion=""}})})}limpiarFiltro(){this.filtroFolio=""}limpiarFiltroCompleto(){return Q(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroDescripcion="",this.pedidos=[]})}CancelarPedido(t){return Q(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){ee.default.fire({icon:"success",title:"En pedidos entregados, NO se aceptan cancelaciones",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(t.estado==="cancelado"){ee.default.fire({icon:"success",title:"El pedido ya fue cancelado con anterioridad.",html:`Fecha: ${this.formatearFecha(t.fechaCancelacion)}<br><br>Cancelado por: ${t.usuarioCancelo.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(t.cliente?this.nombreCliente=t.cliente.nombre:this.nombreCliente="P\xFAblico general",(yield ee.default.fire({icon:"question",title:`Cancelar: ${t.folio}`,html:`<p><strong>Cliente:</strong></p><p><strong>${this.nombreCliente}</strong></p><p><strong>\xBFRealmente deseas CANCELAR el pedido de:</strong></p><p><strong>${t.descripcion}?</strong></p>`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed&&(yield ee.default.fire({title:"Autorizaci\xF3n requerida",html:`
        <p style="color: rgb(3, 7, 83)";>Debes devolver en efectivo: <strong>$${(t.aCuenta-t.pagoACuenta.vale).toFixed(2)}</strong></p>
        <p style="color: rgb(3, 7, 83)";>Debes devolver en monedero: <strong>$${t.pagoACuenta.vale.toFixed(2)}</strong></p>
        <div id="firma-container"></div>
      `,didOpen:()=>{let n=document.createElement("input");n.setAttribute("type","text"),n.setAttribute("id","firma-autorizada"),n.setAttribute("placeholder","Ingrese la firma"),n.setAttribute("autocomplete","off"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck","false"),n.setAttribute("class","swal2-input"),n.setAttribute("style","font-family: text-security-disc, sans-serif; -webkit-text-security: disc;"),n.setAttribute("name","firma_"+Date.now()),n.focus(),document.getElementById("firma-container")?.appendChild(n)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Q(this,null,function*(){let n=ee.default.getConfirmButton(),s=document.getElementById("firma-autorizada")?.value?.trim();if(!s)return ee.default.showValidationMessage("Debes ingresar la firma para continuar."),!1;try{return(yield Ct(this.FarmaciaService.verificarFirma(this.farmaciaId,s))).autenticado?!0:(ee.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),!1)}catch(d){return ee.default.showValidationMessage("Error al verificar la firma."),console.error(d),!1}finally{n&&(n.disabled=!1)}})})).isConfirmed){let n={folio:t.folio},s=ae({},t);this.paraImpresion={pedido:s,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"cancelar"},this.imprimirY(()=>{this.pedidosService.cancelarPedido(n).subscribe({next:()=>{ee.default.fire({icon:"success",title:"Pedido cancelado correctamente",confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto()},error:d=>{console.error("Error al cancelar pedido:",d),ee.default.fire({icon:"error",title:"Error",text:d.error?.mensaje||"No se pudo cancelar el pedido"})}})})}})}surtirPedido(t){return Q(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){ee.default.fire({icon:"success",title:"El pedido ya fue entregado",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}t.cliente?(this.nombreCliente=t.cliente.nombre,this.idCliente=t.cliente._id,this.totalMonedero=t.cliente.totalMonedero):(this.nombreCliente="P\xFAblico general",this.idCliente="",this.totalMonedero=0);let e=yield this.mostrarModalPago(t.resta,"Captura del resto","Faltante","Guardar");if(!e)return;let i={folio:t.folio,pagoResta:{efectivo:t.resta-(e.tarjeta+e.transferencia+e.vale),tarjeta:e.tarjeta,transferencia:e.transferencia,vale:e.vale}},n=qe(ae({},t),{pagoResta:ae({},i.pagoResta)});this.paraImpresion={pedido:n,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"surtir"},this.imprimirY(()=>{this.pedidosService.surtirPedido(i).subscribe({next:s=>Q(this,null,function*(){yield ee.default.fire({icon:"success",title:"\xC9xito",html:"<h3>Pedido surtido y registrado correctamente</h3>",confirmButtonText:"Continuar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto()}),error:s=>{console.error("Error al surtir pedido:",s),ee.default.fire({icon:"error",title:"Error",text:s.error?.mensaje||"No se pudo surtir el pedido"})}})})})}agregarPedido(){return Q(this,null,function*(){this.pedidoDetalleAbiertoId=null;let t=yield this.capturarCliente();if(t===null)return;let e=t==="sin-cliente"?null:t._id;t==="sin-cliente"?(this.nombreCliente="P\xFAblico general",this.totalMonedero=0):(this.nombreCliente=t.nombre,this.totalMonedero=t.totalMonedero);let i=yield this.solicitarDatosPedido();if(!i)return;let{descripcion:n,total:s,anticipo:d}=i,p=yield this.mostrarModalPago(d,"Captura del pago a cuenta","Anticipo","Imprimir");if(!p)return;let h=p.efectivo+p.tarjeta+p.transferencia+p.vale,C=this.folioGenerado||this.generarFolioLocal();this.folioGenerado=C,this.paraGuardar={folio:this.folioGenerado,farmacia:this.farmaciaId,clienteId:e,usuarioPidio:this.usuarioId,descripcion:n,total:s,aCuenta:h,pagoACuenta:p},this.paraImpresion={pedido:this.paraGuardar,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"agregar"},this.mostrarTicket=!0,this.cdr.detectChanges(),setTimeout(()=>{document.getElementById("ticketPedido")?(window.print(),this.mostrarTicket=!1,this.guardarPedido()):console.warn("\u274C Ticket a\xFAn no est\xE1 renderizado")},300)})}guardarPedido(){this.pedidosService.agregarPedido(this.paraGuardar).subscribe({next:t=>Q(this,null,function*(){yield ee.default.fire({icon:"success",title:"\xC9xito",html:"<h3><strong>Pedido agregado correctamente</strong></h3>",confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto(),this.folioGenerado=""}),error:t=>{let e=t.error?.mensaje||t.error?.message||"Falla en el sistema";ee.default.fire({icon:"error",title:"Error al registrar pedido",html:`<p>${e}</p>
                  <p><strong>No se registr\xF3 el pedido</strong></p>`,confirmButtonText:"Continuar",allowOutsideClick:!1,allowEscapeKey:!1})}})}yyyymmddLocal(t=new Date){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");return`${e}${i}`}generarFolioLocal(){let t="FBPed",e=this.yyyymmddLocal(),i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n="";for(let s=0;s<6;s++){let d=Math.floor(Math.random()*i.length);n+=i[d]}return`${t}${e}-${n}`}solicitarDatosPedido(){return Q(this,null,function*(){let{value:t}=yield ee.default.fire({title:"Nuevo pedido",html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><input id="swal-input-descripcion" class="swal2-input" placeholder="Descripci\xF3n del pedido"><input id="swal-input-total" class="swal2-input" type="number" min="0" placeholder="Total $"><input id="swal-input-anticipo" class="swal2-input" type="number" min="0" placeholder="Anticipo $">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let e=document.getElementById("swal-input-descripcion").value.trim(),i=document.getElementById("swal-input-total").value.trim(),n=parseFloat(i),s=document.getElementById("swal-input-anticipo").value.trim(),d=parseFloat(s);if(!e||isNaN(n)||n<=0||isNaN(d)||d<=0){ee.default.showValidationMessage("Completa todos los campos correctamente");return}if(d>n){ee.default.showValidationMessage("El anticipo no puede ser mayor que el total a pagar");return}return{descripcion:e,total:n,anticipo:d}}});return t||null})}mostrarModalPago(t,e,i,n){return Q(this,null,function*(){let{value:s}=yield ee.default.fire({title:e,html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><h2><strong>${i} a pagar:</strong> $${t}</h2><input id="swal-efectivo" type="number" class="swal2-input" placeholder="Efectivo" min="0"><input id="swal-tarjeta" type="number" class="swal2-input" placeholder="Tarjeta" min="0"><input id="swal-transferencia" type="number" class="swal2-input" placeholder="Transferencia" min="0">`+(this.totalMonedero>0?`<label style="color: rgb(3, 7, 83); font-weight: bold; font-size: large; display: block; margin-top: 14px;">
                    Tiene en monedero: $${this.totalMonedero.toFixed(2)}
            </label>
            <input id="swal-vale" type="number" class="swal2-input" style="margin-top: 2px; width: 50%"
              placeholder="monedero"
              min="0"
              max="${this.totalMonedero}">`:""),focusConfirm:!1,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let d=parseFloat(document.getElementById("swal-efectivo").value)||0,p=parseFloat(document.getElementById("swal-tarjeta").value)||0,h=parseFloat(document.getElementById("swal-transferencia").value)||0,C=document.getElementById("swal-vale"),E=C&&parseFloat(C.value)||0,D=p+h+E;if(E>this.totalMonedero)return ee.default.showValidationMessage(`El monto del monedero no puede ser mayor a $${this.totalMonedero.toFixed(2)}`),!1;if(D>t){ee.default.showValidationMessage(`El pago con tarjeta + transferencia + monedero = $${D} no puede exceder de ($${t})`);return}if(D===t&&d>0){ee.default.showValidationMessage("Revisa bien los montos, el pago es excesivo");return}if(D+d<t){ee.default.showValidationMessage("El pago a\xFAn no es suficiente");return}return{efectivo:d,tarjeta:p,transferencia:h,vale:E}}});if(s){let p=s.efectivo+s.tarjeta+s.transferencia+s.vale-t;s.efectivo=s.efectivo-p,p>0&&(yield ee.default.fire({icon:"info",html:`<h1><strong>$${p.toFixed(2)}</strong></h1>`,title:"favor de entregar el cambio",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}))}return s||null})}capturarCliente(){return Q(this,null,function*(){for(;;){let t=yield ee.default.fire({title:"Buscar cliente",input:"text",inputLabel:"Tel\xE9fono del cliente (opcional)",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Buscar cliente",denyButtonText:"Continuar sin cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:n=>{let s=n?.trim();return s?/^\d{10}$/.test(s)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":null}});if(t.isDismissed)return null;if(t.isDenied)return"sin-cliente";let e=t.value?.trim();if(!e)continue;let i=yield this.buscarClientePorTelefono(e);if(i){if((yield ee.default.fire({title:"Cliente encontrado",html:`<p style = "color: blue"><strong>${i.nombre}</strong></p><p>\xBFDeseas continuar con este cliente?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return i}else if(yield this.preguntarCrearCliente(e)){let s=yield this.mostrarModalAltaCliente(e);if(s)return s}}})}buscarClientePorTelefono(t){return Q(this,null,function*(){try{return yield Ct(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}preguntarCrearCliente(t){return Q(this,null,function*(){return(yield ee.default.fire({title:"Cliente no encontrado",text:`\xBFDeseas dar de alta un nuevo cliente con el tel\xE9fono ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, crear",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed})}mostrarModalAltaCliente(t){return Q(this,null,function*(){let{value:e}=yield ee.default.fire({title:"Nuevo cliente",html:'<input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let n=document.getElementById("swal-input-nombre").value.trim(),s=document.getElementById("swal-input-domicilio").value.trim();if(!n){ee.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:n,domicilio:s}}});if(!e)return null;let i={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let n=yield Ct(this.clienteService.crearCliente(i));return ee.default.fire("\xC9xito","Cliente registrado correctamente","success"),n}catch{return ee.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}static \u0275fac=function(e){return new(e||o)(P(st),P(xn),P(Ne),P($t),P(ze),P(Fe),P(mt))};static \u0275cmp=V({type:o,selectors:[["app-pedidos"]],viewQuery:function(e,i){if(e&1&&(Ee(df,5),Ee(Yn,5)),e&2){let n;ye(n=Ce())&&(i.contenedorTicket=n.first),ye(n=Ce())&&(i.pedidoTicketComp=n.first)}},decls:31,vars:12,consts:[[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","align-items-center","filter-container"],[1,"col-md-1","text-end"],["for","filtroFolio",1,"lbl-folio-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-2","position-relative"],["type","text","id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio del pedido","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFolio",1,"lbl-folio-pedido"],[1,"col-md-2"],["type","date",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Descripci\xF3n...","minlength","5","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-md-1"],["class","btn-gris",3,"disabled","click",4,"ngIf"],[1,"col-2","text-end"],["matTooltip","Levantar un pedido",1,"btn-verde",3,"click"],[3,"icon"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["class","ticket-impresion",3,"pedido",4,"ngIf"],["matTooltip","Limpiar folio del pedido",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fas","fa-times"],[1,"btn-gris",3,"click","disabled"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[1,"d-flex","gap-1","align-items-center"],["matTooltip","Surtir pedido",1,"btn-verde","btn-icono",3,"click"],["matTooltip","Cancelar pedido",1,"btn-rojo-tache","btn-icono",3,"click"],["matTooltip","Cierra la tabla",1,"btn-gris","btn-icono",3,"click"],[4,"ngIf"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","2",1,"sub-title-tabla"],["colspan","1"],[1,"no-found-error"],[1,"ticket-impresion",3,"pedido"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),c(3,"Pedidos"),r()(),a(4,"div",3)(5,"div",4)(6,"label",5),c(7,"Folio:"),r()(),a(8,"div",6)(9,"input",7),k("ngModelChange",function(s){return O(i.filtroFolio,s)||(i.filtroFolio=s),s}),g("ngModelChange",function(s){return i.obtenerPedido(s)}),r(),S(10,mf,2,0,"button",8),r(),a(11,"div",4)(12,"label",9),c(13,"Fecha:"),r()(),a(14,"div",10)(15,"input",11),k("ngModelChange",function(s){return O(i.filtroFechaPedido,s)||(i.filtroFechaPedido=s),s}),r()(),a(16,"div",4)(17,"label",9),c(18,"Descripci\xF3n:"),r()(),a(19,"div",10)(20,"input",12),k("ngModelChange",function(s){return O(i.filtroDescripcion,s)||(i.filtroDescripcion=s),s}),r()(),a(21,"div",13),S(22,pf,2,1,"button",14),r(),a(23,"div",15)(24,"button",16),g("click",function(){return i.agregarPedido()}),c(25," Agregar Pedido "),f(26,"fa-icon",17),r()()(),S(27,uf,2,0,"h2",18)(28,yf,22,1,"table",19)(29,Cf,2,0,"p",20),r(),S(30,xf,1,1,"app-pedido-ticket",21)),e&2&&(l(9),T("ngModel",i.filtroFolio),l(),m("ngIf",i.filtroFolio),l(5),T("ngModel",i.filtroFechaPedido),m("disabled",i.pedidos.length>0),l(5),T("ngModel",i.filtroDescripcion),m("disabled",i.pedidos.length>0),l(2),m("ngIf",i.filtroFechaPedido&&i.filtroDescripcion),l(4),m("icon","plus"),l(),m("ngIf",i.pedidos.length>0),l(),m("ngIf",i.pedidos.length>0),l(),m("ngIf",i.filtroFolio.length===6&&i.pedidos.length===0),l(),m("ngIf",i.paraImpresion&&i.mostrarTicket))},dependencies:[Je,Ze,me,ie,Z,No,rc,cn,Bo,xe,j,Qe,Y,z,Re,Me,Yn,Ve,_e],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-folio-pedido[_ngcontent-%COMP%]{font-size:large}"],data:{animation:[Hi("expandCollapse",[di("true",At({height:"*",opacity:1,padding:"*",overflow:"hidden"})),di("false",At({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),qi("true <=> false",zi("300ms ease-in-out"))])]}})};var tt=lt(_t());function Sf(o,t){if(o&1&&(oe(0),a(1,"tr")(2,"td",4)(3,"span",13),c(4),r()()(),a(5,"tr")(6,"td"),c(7),y(8,"number"),r(),a(9,"td"),c(10),r(),a(11,"td",6),c(12),y(13,"number"),r()(),a(14,"tr")(15,"td",4),c(16),r()(),re()),o&2){let e=t.$implicit;l(4),x(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),l(3),x("$",w(8,5,e.precio,"1.2-2"),""),l(3),_(e.cantidad),l(2),x("$",w(13,8,e.precio*e.cantidad,"1.2-2")," "),l(4),x("Motivo: ",e.motivo,"")}}function Ef(o,t){if(o&1&&(a(0,"strong"),c(1),y(2,"number"),r()),o&2){let e=u(3);l(),x("+$",w(2,1,e.venta.monederoIngreso,"1.2-2"),"")}}function wf(o,t){if(o&1&&(a(0,"span"),c(1," \u2014 "),a(2,"strong"),c(3),y(4,"number"),r(),c(5," (reverso) "),r()),o&2){let e=u(3);l(3),x("-$",w(4,1,e.venta.monederoReverso,"1.2-2"),"")}}function Pf(o,t){if(o&1&&(a(0,"div",6),c(1," Saldo antes: "),a(2,"strong"),c(3),y(4,"number"),r(),c(5," \xA0|\xA0 Saldo final: "),a(6,"strong"),c(7),y(8,"number"),r()()),o&2){let e=u(3);l(3),x("$",w(4,2,e.venta.monederoSaldoAntes,"1.2-2"),""),l(4),x("$",w(8,5,e.venta.monederoSaldoDespues,"1.2-2"),"")}}function If(o,t){if(o&1&&(oe(0),a(1,"div",6),c(2," Monedero: "),S(3,Ef,3,4,"strong",9)(4,wf,6,4,"span",9),r(),S(5,Pf,9,8,"div",14),re()),o&2){let e=u(2);l(3),m("ngIf",e.venta.monederoIngreso),l(),m("ngIf",e.venta.monederoReverso&&e.venta.monederoReverso>0),l(),m("ngIf",e.venta.monederoSaldoAntes!==void 0)}}function Mf(o,t){if(o&1&&(a(0,"div",15),c(1," Devoluci\xF3n de efectivo: "),a(2,"strong"),c(3),y(4,"number"),r()()),o&2){let e=u(2);l(3),x("$",w(4,1,e.venta.totalDevolverEfectivo,"1.2-2"),"")}}function Tf(o,t){if(o&1&&(a(0,"div",1),f(1,"app-ticket-header",2)(2,"hr"),a(3,"table",3)(4,"thead")(5,"tr")(6,"th",4),c(7,"PRODUCTO DEVUELTO"),r()(),a(8,"tr",5)(9,"th"),c(10,"P.UNIT"),r(),a(11,"th"),c(12,"CANT"),r(),a(13,"th",6),c(14,"IMPORTE"),r()()(),a(15,"tbody"),S(16,Sf,17,11,"ng-container",7),r()(),f(17,"hr"),a(18,"div",8)(19,"div",6),c(20," Total: "),a(21,"strong"),c(22),y(23,"number"),r()(),S(24,If,6,3,"ng-container",9)(25,Mf,5,4,"div",10),r(),f(26,"hr"),a(27,"div",11)(28,"div",12),c(29),r(),c(30),y(31,"date"),f(32,"br"),c(33),f(34,"br"),c(35),r(),f(36,"hr")(37,"app-ticket-footer"),r()),o&2){let e=u();l(),m("nombreFarmacia",e.venta.farmacia.nombre)("direccion",e.venta.farmacia.direccion)("telefono",e.venta.farmacia.telefono),l(15),m("ngForOf",e.venta.devolucion.productosDevueltos),l(6),x("$",w(23,11,e.venta.totalADevolver,"1.2-2"),""),l(2),m("ngIf",e.venta.monederoIngreso||e.venta.monederoReverso),l(),m("ngIf",e.venta.totalDevolverEfectivo>0),l(4),x("Folio venta: ",e.venta.devolucion.folioVenta,""),l(),x(" Fecha devoluci\xF3n: ",w(31,14,e.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),l(3),x(" Atendi\xF3: ",e.venta.usuario,""),l(2),x(" Cliente: ",e.venta.cliente||"P\xFAblico general"," ")}}var sr=class o{venta;fechaActual=new Date;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-devolucion-ticket"]],inputs:{venta:"venta"},decls:1,vars:1,consts:[["class","ticket-impresion",4,"ngIf"],[1,"ticket-impresion"],[3,"nombreFarmacia","direccion","telefono"],[1,"productos"],["colspan","3"],[1,"productos-header-bottom"],[2,"text-align","right"],[4,"ngFor","ngForOf"],[1,"totales"],[4,"ngIf"],["style","text-align: right; font-size: larger;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[1,"producto-nombre"],["style","text-align: right;",4,"ngIf"],[2,"text-align","right","font-size","larger"]],template:function(e,i){e&1&&S(0,Tf,38,17,"div",0),e&2&&m("ngIf",i.venta)},dependencies:[j,Y,z,Te,Me,li,si],styles:[".info-general[_ngcontent-%COMP%], .totales[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}.productos-header-bottom[_ngcontent-%COMP%]{border-bottom:1px solid black}hr[_ngcontent-%COMP%]{border:none;border-top:1px dashed #000;margin:8px 0}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}"]})};var lr=class o{constructor(t){this.http=t}apiUrl=`${J.apiUrl}`;buscarVentaPorCodigo(t){return this.http.get(`${this.apiUrl}/devoluciones/buscarVenta/${t}`)}registrarDevolucion(t){return this.http.post(`${this.apiUrl}/devoluciones/registrar`,t)}obtenerVentasRecientes(t,e){let i=new Le;return e&&/^[A-Za-z0-9]{6}$/.test(e)&&(i=i.set("folio",e)),this.http.get(`${this.apiUrl}/ventasRecientes/${t}`,{params:i})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var kf=["contenedorTicket"],Df=o=>({"checkbox-disabled":o});function Ff(o,t){if(o&1){let e=I();a(0,"button",15),g("click",function(){b(e);let n=u();return v(n.limpiarFolio())}),f(1,"fa-icon",16),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Rf(o,t){o&1&&(a(0,"h2",17),c(1,"Datos de la venta"),r())}function Af(o,t){if(o&1&&(a(0,"option",32),c(1),r()),o&2){let e=t.$implicit,i=t.index;m("ngValue",i),l(),_(e)}}function Vf(o,t){if(o&1){let e=I();a(0,"tr")(1,"td")(2,"input",27),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s.seleccionado,n)||(s.seleccionado=n),v(n)}),r()(),a(3,"td"),c(4),r(),a(5,"td"),c(6),r(),a(7,"td"),c(8),y(9,"currency"),r(),a(10,"td"),c(11),r(),a(12,"td")(13,"input",28),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s.cantidadDevuelta,n)||(s.cantidadDevuelta=n),v(n)}),r()(),a(14,"td")(15,"select",29),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s.motivoIndex,n)||(s.motivoIndex=n),v(n)}),a(16,"option",30),c(17,"Seleccione motivo"),r(),S(18,Af,2,2,"option",31),r()()()}if(o&2){let e=t.$implicit,i=u(4);l(2),T("ngModel",e.seleccionado),m("disabled",i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("ngClass",nt(19,Df,i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)))("title",i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Editar cant. a devolver y motivo"),l(2),_(e.producto.nombre),l(2),_(e.cantidad),l(2),_(M(9,17,e.precio)),l(3),_(e.tipoDescuento),l(2),m("max",e.cantidad),T("ngModel",e.cantidadDevuelta),m("disabled",!e.seleccionado||i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Modificar cantidad"),l(2),T("ngModel",e.motivoIndex),m("disabled",!e.seleccionado||i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",i.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Elegir motivo"),l(),m("ngValue",null),l(2),m("ngForOf",i.motivosDevolucion)}}function Nf(o,t){if(o&1){let e=I();a(0,"tr")(1,"td",23)(2,"div",24)(3,"h5"),c(4,"Selecciona productos a devolver"),r(),a(5,"table",25)(6,"thead")(7,"tr"),f(8,"th"),a(9,"th"),c(10,"Producto"),r(),a(11,"th"),c(12,"Cant."),r(),a(13,"th"),c(14,"P. U. c/dcto"),r(),a(15,"th"),c(16,"Promo"),r(),a(17,"th"),c(18,"Devolver"),r(),a(19,"th"),c(20,"Motivo de devoluci\xF3n"),r()()(),a(21,"tbody"),S(22,Vf,19,21,"tr",19),r()(),a(23,"button",26),g("click",function(){b(e);let n=u().$implicit,s=u(2);return v(s.confirmarDevolucion(n))}),c(24," Confirmar devoluci\xF3n "),r()()()()}if(o&2){let e=u().$implicit;l(22),m("ngForOf",e.productos)}}function Bf(o,t){if(o&1){let e=I();oe(0),a(1,"tr")(2,"td")(3,"button",20),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.ventaDetalleAbiertoId===n._id?s.cerrarDetalleVenta(n):s.abrirDetalleVenta(n))}),f(4,"fa-icon",21),r()(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td"),c(10),y(11,"currency"),r(),a(12,"td"),c(13),y(14,"currency"),r(),a(15,"td"),c(16),r(),a(17,"td"),c(18),y(19,"date"),r()(),S(20,Nf,25,1,"tr",22),re()}if(o&2){let e=t.$implicit,i=u(2);l(3),m("matTooltip",i.ventaDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),l(),m("icon",i.ventaDetalleAbiertoId===e._id?"minus":"plus")("ngClass",i.ventaDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),l(2),_(e.folio),l(2),_((e.cliente==null?null:e.cliente.nombre)||"Mostrador"),l(2),_(M(11,10,e.total)),l(3),_(M(14,12,e.totalDescuento)),l(3),_(e.cantidadProductos),l(2),_(pt(19,14,e.fecha,"dd/MM/yyyy","America/Mexico_City")),l(2),m("ngIf",i.ventaDetalleAbiertoId===e._id)}}function Lf(o,t){if(o&1&&(a(0,"table",18)(1,"thead")(2,"tr"),f(3,"th"),a(4,"th"),c(5,"Folio"),r(),a(6,"th"),c(7,"Cliente"),r(),a(8,"th"),c(9,"Total"),r(),a(10,"th"),c(11,"Total Descuento"),r(),a(12,"th"),c(13,"# Art."),r(),a(14,"th"),c(15,"Fecha"),r()()(),a(16,"tbody"),S(17,Bf,21,18,"ng-container",19),r()()),o&2){let e=u();l(17),m("ngForOf",e.ventas)}}function jf(o,t){o&1&&(a(0,"p",33),c(1," No se encontr\xF3 ninguna venta con ese folio en los \xFAltimos 7 d\xEDas. "),r())}function Uf(o,t){if(o&1&&f(0,"app-devolucion-ticket",34),o&2){let e=u();m("venta",e.paraImpresion)}}var cr=class o{constructor(t,e,i,n,s){this.devolucionService=t;this.clienteService=e;this.FarmaciaService=i;this.library=n;this.authService=s;this.library.addIcons(Ut,mn,ct)}contenedorTicket;ventas=[];esCliente=!1;pagoVentaEnEfectivo=0;pagoVentaEnElectronico=0;filtroFolio="";farmaciaId="";farmaciaNombre="";farmaciaDireccion="";farmaciaTelefono="";usuarioId="";usuarioRol="";usuarioNombre="";ventaDetalleAbiertoId=null;idCliente=null;nombreCliente=null;motivosDevolucion=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];firmaAutorizada="";mostrarTicket=!1;paraImpresion=null;paraGuardar=null;faTimes=ct;ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){tt.default.fire("Error","No se ha seleccionado una farmacia activa","error");return}this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono;let i=this.authService.getUserData(),n=i?.rol,s=i?.nombre,d=i?.id;this.usuarioId=d,this.usuarioRol=n,this.usuarioNombre=s,this.authService.obtenerFirma(e._id).subscribe({next:p=>{this.firmaAutorizada=p.firma},error:p=>{console.error("\u274C Error al obtener firma de farmacia:",p),tt.default.fire("Error","No se pudo obtener la firma de la farmacia","error")}})}onFolioChange(t){this.filtroFolio=t.trim(),this.idCliente=null,/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.devolucionService.obtenerVentasRecientes(this.farmaciaId,this.filtroFolio).subscribe({next:e=>{if(e.length===0){this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1;return}let i=e[0];this.ventas=[i],this.pagoVentaEnEfectivo=i.formaPago.efectivo||0,this.pagoVentaEnElectronico=(i.formaPago.tarjeta||0)+(i.formaPago.transferencia||0)+(i.formaPago.vale||0),this.esCliente=!!i.cliente,this.esCliente&&(this.idCliente=i.cliente._id)},error:e=>{console.error("Error al buscar por folio:",e),this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1}}):(this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1)}toNum=t=>Number(t??0)||0;round2=t=>Math.round((t+Number.EPSILON)*100)/100;calcularProporcionVale(t){let e=this.toNum(t?.formaPago.vale),i=this.toNum(t?.formaPago.efectivo),n=this.toNum(t?.formaPago.tarjeta),s=this.toNum(t?.formaPago.transferencia),d=this.round2(e+i+n+s),p=0;return d>0&&e>0&&(p=Math.max(0,Math.min(1,e/d))),{pagoMonedero:e,pagoEfectivo:i,pagoTarjeta:n,pagoTransferencia:s,totalPagado:d,proporcionVale:p}}calcReversoMonedero(t,e){let i=0;for(let n of e){let s=n.producto?._id??n.producto,d=(t.productos||[]).find(E=>String(E.producto?._id??E.producto)===String(s));if(!d)continue;let p=this.toNum(d.monederoCliente),h=this.toNum(d.cantidad),C=this.toNum(n.cantidadDevuelta);p>0&&h>0&&C>0&&(i+=p*(C/h))}return this.round2(i)}confirmarDevolucion(t){return Q(this,null,function*(){let e=(t.productos||[]).filter(F=>F.seleccionado&&this.toNum(F.cantidadDevuelta)>0);if(e.length===0){yield tt.default.fire("Aviso","Selecciona al menos un producto con cantidad v\xE1lida","info");return}let i=e.filter(F=>F.motivoIndex==null||typeof F.motivoIndex!="number"||F.motivoIndex<0||!this.motivosDevolucion?.[F.motivoIndex]);if(i.length>0){let F=i.map(fe=>fe.producto.nombre).join(", ");yield tt.default.fire("Aviso",`Debes indicar un motivo de devoluci\xF3n para: ${F}`,"warning");return}let n=this.round2(e.reduce((F,fe)=>F+this.toNum(fe.cantidadDevuelta)*this.toNum(fe.precio),0)),{proporcionVale:s}=this.calcularProporcionVale(t),d=this.round2(n*s),p=this.round2(n-d);if(this.esCliente=!!t?.cliente,this.esCliente?(this.idCliente=t.cliente._id,this.nombreCliente=t.cliente.nombre):(this.idCliente=null,this.nombreCliente=""),!this.esCliente&&d>0){let F=yield this.capturarTelefono();if(!F)return;this.esCliente=!0,this.idCliente=F._id,this.nombreCliente=F.nombre}let h=0;if(this.esCliente&&this.idCliente)try{let F=yield Ct(this.clienteService.getClienteById(this.idCliente));h=this.toNum(F?.totalMonedero)}catch{h=0}let C=this.calcReversoMonedero(t,e),E=this.round2(Math.min(C,h+d)),D=d,R=E,N=this.round2(D-R),A=this.round2(h+N);(yield tt.default.fire({title:"Autorizaci\xF3n requerida",html:`
      <p style="color: blue"><strong>Cliente: </strong>${this.nombreCliente||"\u2014"}</p>
      <h4>Debes devolver en total: <strong>$${n.toFixed(2)}</strong></h4>
      <h2>Monedero: <strong>$${d.toFixed(2)}</strong></h2>
      <h2 style="color: red">Efectivo: <strong>$${p.toFixed(2)}</strong></h2>
      <div id="firma-container"></div>
    `,didOpen:()=>{let F=document.createElement("input");F.type="text",F.id="firma-autorizada",F.placeholder="Ingrese la firma",F.autocomplete="off",F.autocapitalize="off",F.spellcheck=!1,F.className="swal2-input",F.style.fontFamily="text-security-disc, sans-serif",F.style.webkitTextSecurity="disc",F.name="firma_"+Date.now(),F.focus(),document.getElementById("firma-container")?.appendChild(F)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Q(this,null,function*(){let F=tt.default.getConfirmButton();F&&(F.disabled=!0);let fe=document.getElementById("firma-autorizada")?.value?.trim();if(yield new Promise(Pe=>setTimeout(Pe,200)),!fe)return tt.default.showValidationMessage("Debes ingresar la firma para continuar."),F&&(F.disabled=!1),!1;try{return(yield Ct(this.FarmaciaService.verificarFirma(this.farmaciaId,fe))).autenticado?!0:(tt.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),F&&(F.disabled=!1),!1)}catch(Pe){return console.error("\u274C Error al verificar firma:",Pe),tt.default.showValidationMessage("Error al verificar la firma. Intenta m\xE1s tarde."),F&&(F.disabled=!1),!1}})})).isConfirmed&&(this.paraGuardar={folioVenta:t.folio,farmaciaQueDevuelve:this.farmaciaId,idCliente:this.idCliente,productosDevueltos:e.map(F=>{let fe=this.motivosDevolucion[F.motivoIndex];return{producto:F.producto._id??F.producto,cantidad:this.toNum(F.cantidadDevuelta),motivoIndex:F.motivoIndex,motivo:fe,precioXCantidad:this.round2(this.toNum(F.cantidadDevuelta)*this.toNum(F.precio))}})},this.paraImpresion={devolucion:{folioVenta:t.folio,fecha:new Date,productos:e.map(F=>({productoNombre:F.producto?.nombre,barrasYNombre:`${(F.producto?.codigoBarras||"").slice(-3)} ${F.producto?.nombre||""}`,cantidad:this.toNum(F.cantidadDevuelta),precio:this.toNum(F.precio),importe:this.round2(this.toNum(F.cantidadDevuelta)*this.toNum(F.precio)),motivo:this.motivosDevolucion[F.motivoIndex]}))},cliente:this.nombreCliente||"\u2014",totalADevolver:n,totalDevolverEfectivo:p,totalDevolverVales:d,monederoIngreso:D,monederoReverso:R,monederoSaldoAntes:h,monederoSaldoDespues:A,monederoCambioNeto:N,usuario:this.usuarioNombre,farmacia:{nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono}},this.mostrarTicket=!0,setTimeout(()=>{this.contenedorTicket&&this.imprimirTicketReal()},200))})}imprimirTicketReal(){window.print(),this.mostrarTicket=!1,tt.default.fire({icon:"question",title:"\xBFSe imprimi\xF3 correctamente el ticket?",showCancelButton:!0,confirmButtonText:"S\xED, guardar devoluci\xF3n",cancelButtonText:"No, reintentar"}).then(t=>{t.isConfirmed?this.guardarDespuesDeImpresion():tt.default.fire("Atenci\xF3n","La devoluci\xF3n no ha sido registrada. Puedes reintentar la impresi\xF3n.","info")})}guardarDespuesDeImpresion(){this.devolucionService.registrarDevolucion(this.paraGuardar).subscribe({next:t=>{tt.default.fire("\xC9xito",t.mensaje||"Devoluci\xF3n registrada correctamente","success"),this.ventaDetalleAbiertoId=null,this.limpiarFolio()},error:t=>{tt.default.fire("Error",t.error?.mensaje||"No se pudo registrar la devoluci\xF3n","error")}})}capturarTelefono(){return Q(this,null,function*(){for(;;){let t=yield tt.default.fire({title:"Buscar al cliente que nos compr\xF3",input:"text",inputLabel:"Tel\xE9fono del cliente",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,confirmButtonText:"Buscar cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:n=>{let s=n?.trim();return s?/^\d{10}$/.test(s)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":"El tel\xE9fono es obligatorio"}});if(t.isDismissed)return null;let e=t.value?.trim();if(!e)continue;let i=yield this.buscarClientePorTelefono(e);if(i){if((yield tt.default.fire({title:"Cliente encontrado",html:`<p><strong>${i.nombre}</strong></p>
          <p>\xBFEs el cliente que esta haciendo la devoluci\xF3n?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return i}else{let n=yield this.altaCliente(e);if(n)return n}}})}buscarClientePorTelefono(t){return Q(this,null,function*(){try{return yield Ct(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}altaCliente(t){return Q(this,null,function*(){let{value:e}=yield tt.default.fire({title:"Nuevo cliente",html:`<label><strong>Tel\xE9fono: </strong>${t}</label><input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let n=document.getElementById("swal-input-nombre").value.trim(),s=document.getElementById("swal-input-domicilio").value.trim();if(!n){tt.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:n,domicilio:s}}});if(!e)return null;let i={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let n=yield Ct(this.clienteService.crearCliente(i));return tt.default.fire("\xC9xito","Cliente registrado correctamente","success"),n}catch{return tt.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetalleVenta(t){this.ventaDetalleAbiertoId=t._id,t.productos.forEach(e=>{e.seleccionado=!1,e.cantidadDevuelta=1,e.motivo=null})}cerrarDetalleVenta(t){this.ventaDetalleAbiertoId=null}esPromocionNoReembolsable(t,e){return t?.includes("2x1")||t?.includes("3x2")||t?.includes("4x3")||e==="Recargas"||e==="Servicio M\xE9dico"}limpiarFolio(){this.filtroFolio="",this.ventas=[],this.mostrarTicket=!1}static \u0275fac=function(e){return new(e||o)(P(lr),P($t),P(ze),P(st),P(Ne))};static \u0275cmp=V({type:o,selectors:[["app-devoluciones"]],viewQuery:function(e,i){if(e&1&&Ee(kf,5),e&2){let n;ye(n=Ce())&&(i.contenedorTicket=n.first)}},decls:18,vars:6,consts:[["contenedorTicket",""],[1,"container","mt-4"],[1,"titulo-container"],[1,"titulo"],[1,"row","filter-container"],[1,"col-1"],[1,"col-2"],["for","filtroFolio",1,"lbl-folio-venta"],[1,"position-relative"],["id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pr-4",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio de la venta","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["class","ticket-impresion",3,"venta",4,"ngIf"],["matTooltip","Limpiar folio de la venta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-gris","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[4,"ngIf"],["colspan","9"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"btn-rojo","mt-2",3,"click"],["type","checkbox",3,"ngModelChange","ngModel","disabled","ngClass","title"],["type","number","min","1",1,"form-control",3,"ngModelChange","max","ngModel","disabled","title"],[1,"form-select",3,"ngModelChange","ngModel","disabled","title"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"no-found-error"],[1,"ticket-impresion",3,"venta"]],template:function(e,i){if(e&1){let n=I();a(0,"div",1)(1,"div",2)(2,"h1",3),c(3,"Devoluciones"),r()(),a(4,"div",4),f(5,"div",5),a(6,"div",6)(7,"label",7),c(8,"Folio de la venta:"),r(),a(9,"div",8)(10,"input",9),k("ngModelChange",function(d){return b(n),O(i.filtroFolio,d)||(i.filtroFolio=d),v(d)}),g("ngModelChange",function(d){return b(n),v(i.onFolioChange(d))}),r(),S(11,Ff,2,1,"button",10),r()()(),S(12,Rf,2,0,"h2",11)(13,Lf,18,1,"table",12)(14,jf,2,0,"p",13),r(),a(15,"div",null,0),S(17,Uf,1,1,"app-devolucion-ticket",14),r()}e&2&&(l(10),T("ngModel",i.filtroFolio),l(),m("ngIf",i.filtroFolio.length>0),l(),m("ngIf",i.ventas.length>0),l(),m("ngIf",i.ventas.length>0),l(),m("ngIf",i.filtroFolio.length===6&&i.ventas.length===0),l(3),m("ngIf",i.paraImpresion&&i.mostrarTicket))},dependencies:[j,Qe,Y,z,Re,Me,me,ce,de,ie,Ae,at,le,Z,cn,Bo,Et,xi,xe,Je,Ze,sr,_e],styles:[".icono-normal[_ngcontent-%COMP%], .icono-rotado[_ngcontent-%COMP%]{display:inline-block;transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0)}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg)}.checkbox-disabled[_ngcontent-%COMP%], input[disabled][_ngcontent-%COMP%], select[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.folio-venta[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.lbl-folio-venta[_ngcontent-%COMP%]{font-size:large;margin-right:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}"],data:{animation:[Hi("expandCollapse",[di("true",At({height:"*",opacity:1,padding:"*",overflow:"hidden"})),di("false",At({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),qi("true <=> false",zi("300ms ease-in-out"))])]}})};var Vt=lt(_t());var dr=class o{datosCorte;fechaActual=new Date;ngOnChanges(t){t.datosCorte&&console.log("\u{1F7E2} datosCorte recibidos en ticket:",this.datosCorte)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-corte-caja-ticket"]],inputs:{datosCorte:"datosCorte"},features:[en],decls:54,vars:19,consts:[[1,"ticket-corteCaja"],[3,"nombreFarmacia","direccion","telefono"],[1,"corte-caja-encabezado"],[2,"text-align","center","font-size","large"],[1,"corte-caja-datos"],[2,"font-style","italic"]],template:function(e,i){e&1&&(a(0,"div",0),f(1,"app-ticket-header",1),a(2,"div",2)(3,"div",3),c(4,"Corte de Caja"),r(),a(5,"strong"),c(6),r(),f(7,"br"),c(8," Inicio: "),a(9,"strong"),c(10),y(11,"date"),r(),f(12,"br"),c(13," Fin: "),a(14,"strong"),c(15),y(16,"date"),r(),f(17,"br"),r(),f(18,"hr"),a(19,"div",4)(20,"p",5),c(21,"Movimientos"),r(),c(22," Ventas: "),a(23,"strong"),c(24),r(),f(25,"br"),c(26," Devoluciones: "),a(27,"strong"),c(28),r(),f(29,"br"),c(30," Pedidos levantados: "),a(31,"strong"),c(32),r(),f(33,"br"),c(34," Pedidos entregados: "),a(35,"strong"),c(36),r(),f(37,"br"),c(38," Pedidos cancelados: "),a(39,"strong"),c(40),r(),f(41,"br")(42,"br"),a(43,"p",5),c(44,"Recargas telef\xF3nicas"),r(),c(45," Saldo inicial: "),a(46,"strong"),c(47),r(),f(48,"br"),c(49," Saldo final: "),a(50,"strong"),c(51),r()(),f(52,"hr")(53,"app-ticket-footer"),r()),e&2&&(l(),m("nombreFarmacia",i.datosCorte.nomFarm)("direccion",i.datosCorte.dirFarm)("telefono",i.datosCorte.telFarm),l(5),_(i.datosCorte.responsable),l(4),_(w(11,13,i.datosCorte.fechaInicio,"dd/MM/yyyy HH:mm")),l(5),_(w(16,16,i.datosCorte.fechaFin,"dd/MM/yyyy HH:mm")),l(9),_(i.datosCorte.ventasRealizadas),l(4),_(i.datosCorte.devolucionesRealizadas),l(4),_(i.datosCorte.pedidosLevantados),l(4),_(i.datosCorte.pedidosEntregados),l(4),_(i.datosCorte.pedidosCancelados),l(7),x("$",i.datosCorte.saldoInicialRecargas," "),l(4),x("$",i.datosCorte.saldoInicialRecargas-i.datosCorte.totalRecargas," "))},dependencies:[j,Me,li,si],styles:[`.corte-caja-encabezado,.corte-caja-datos{font-size:16px!important;line-height:1.4!important;box-sizing:border-box}.corte-caja-datos{text-align:center}@media print{@page{margin-left:10pt!important;size:95mm auto}html,body{margin:0!important;padding:0!important}body *{visibility:hidden!important}.ticket-corteCaja,.ticket-corteCaja *{visibility:visible!important}.ticket-corteCaja{width:95mm!important;margin-left:10pt!important;padding:0!important;box-sizing:border-box!important;font-size:12px!important;line-height:1.4!important;position:absolute!important;left:0!important;top:0!important}}
`],encapsulation:2})};function $f(o,t){o&1&&(oe(0),c(1,"Iniciar turno de caja"),re())}function Hf(o,t){o&1&&(oe(0),f(1,"span",13),c(2," Iniciando... "),re())}function zf(o,t){if(o&1){let e=I();a(0,"div",3)(1,"h2",4),c(2,"Inicio de Turno"),r(),a(3,"div",5)(4,"label",6),c(5,"Efectivo inicial recibido:"),r(),a(6,"input",7),k("ngModelChange",function(n){b(e);let s=u();return O(s.efectivoInicial,n)||(s.efectivoInicial=n),v(n)}),r()(),a(7,"div",5)(8,"label",8),c(9,"Saldo inicial de recargas:"),r(),a(10,"input",9),k("ngModelChange",function(n){b(e);let s=u();return O(s.saldoInicialRecargas,n)||(s.saldoInicialRecargas=n),v(n)}),r(),a(11,"small",10),c(12,"Coloca 0.00 si no tienes recargas al inicio."),r()(),a(13,"button",11),g("click",function(){b(e);let n=u();return v(n.iniciarTurno())}),S(14,$f,2,0,"ng-container",12)(15,Hf,3,0,"ng-container",12),r()()}if(o&2){let e=u();l(6),T("ngModel",e.efectivoInicial),l(4),T("ngModel",e.saldoInicialRecargas),l(3),m("disabled",e.procesando),l(),m("ngIf",!e.procesando),l(),m("ngIf",e.procesando)}}function qf(o,t){if(o&1){let e=I();a(0,"div",3)(1,"h2",14),c(2,"Turno activo"),r(),a(3,"p",15)(4,"strong"),c(5,"Fecha de inicio:"),r(),c(6),y(7,"date"),r(),a(8,"p",15)(9,"strong"),c(10,"Efectivo inicial:"),r(),c(11),y(12,"number"),r(),a(13,"p",15)(14,"strong"),c(15,"Recargas inicial:"),r(),c(16),y(17,"number"),r(),a(18,"button",16),g("click",function(){b(e);let n=u();return v(n.finalizarTurno())}),c(19," Finalizar turno de caja "),r()()}if(o&2){let e=u();l(6),x(" ",pt(7,3,e.corteActivo.fechaInicio,"dd/MM/yyyy HH:mm","America/Mexico_City")," hrs."),l(5),x(" $",w(12,7,e.corteActivo.efectivoInicial,"1.2-2"),""),l(5),x(" $",w(17,10,e.corteActivo.saldoInicialRecargas,"1.2-2"),"")}}function Wf(o,t){if(o&1&&f(0,"app-corte-caja-ticket",17),o&2){let e=u();m("datosCorte",e.datosCorteParaImpresion)}}var mr=class o{constructor(t,e,i,n){this.authService=t;this.http=e;this.router=i;this.cdr=n}efectivoInicial=0;saldoInicialRecargas=0;corteActivo=null;usuarioId=null;usuarioNombre=null;farmaciaId=null;farmaciaNombre=null;farmaciaDireccion=null;farmaciaTelefono=null;mostrarFormulario=!1;procesando=!1;mostrarTicketCorte=!1;datosCorteParaImpresion=null;ngOnInit(){let t=localStorage.getItem("usuario"),e=localStorage.getItem("user_farmacia");if(t&&(this.usuarioId=JSON.parse(t)?.id,this.usuarioNombre=JSON.parse(t)?.nombre),e&&(this.farmaciaId=JSON.parse(e)._id,this.farmaciaNombre=JSON.parse(e).nombre,this.farmaciaDireccion=JSON.parse(e).direccion,this.farmaciaTelefono=JSON.parse(e).telefono),!this.usuarioId||!this.farmaciaId){Vt.default.fire("Error","Faltan datos de sesi\xF3n o farmacia activa.","error");return}this.verificarCorteActivo()}verificarCorteActivo(){let t=localStorage.getItem("auth_token"),e=new ne({"x-auth-token":t||""});this.http.get(`${J.apiUrl}/cortes/activo/${this.usuarioId}/${this.farmaciaId}`,{headers:e}).subscribe({next:i=>{i.corte?this.corteActivo=i.corte:(this.mostrarFormulario=!0,this.cdr.detectChanges())},error:i=>{i.status===409?Vt.default.fire({icon:"error",title:"Corte duplicado detectado",text:i.error?.mensaje||"Conflicto en cortes activos"}):Vt.default.fire("Error","No se pudo verificar el corte activo.","error")}})}iniciarTurno(){if(this.efectivoInicial<=0){Vt.default.fire({icon:"warning",title:"Error",text:"El efectivo inicial debe ser mayor a cero.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(this.saldoInicialRecargas===null||this.saldoInicialRecargas===void 0||this.saldoInicialRecargas<0){Vt.default.fire({icon:"warning",title:"Error",text:"El saldo inicial de recargas debe ser 0 o mayor.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.procesando=!0;let t=localStorage.getItem("auth_token"),e=new ne({"x-auth-token":t||"","Content-Type":"application/json"}),i={efectivoInicial:this.efectivoInicial,saldoInicialRecargas:this.saldoInicialRecargas,farmaciaId:this.farmaciaId};this.http.post(`${J.apiUrl}/cortes`,i,{headers:e}).subscribe({next:n=>{let s=n.corte;localStorage.setItem("corte_activo",s._id),Vt.default.fire({icon:"success",title:"Turno iniciado",html:`
          <div style="text-align:left">
            <p><strong>Efectivo inicial:</strong> $${this.efectivoInicial.toFixed(2)}</p>
            <p><strong>Saldo inicial de recargas:</strong> $${this.saldoInicialRecargas.toFixed(2)}</p>
          </div>`,timer:2200,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.router.navigate(["/home"])})},error:n=>{console.error("Error al iniciar turno:",n),Vt.default.fire("Error",n.error?.mensaje||"No se pudo iniciar el turno.","error")}}).add(()=>{this.procesando=!1})}finalizarTurno(){Vt.default.fire({title:"\xBFFinalizar turno de caja?",text:"Se generar\xE1 el corte con los balances actuales.",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, finalizar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{if(!t.isConfirmed)return;let e=localStorage.getItem("auth_token"),i=new ne({"x-auth-token":e||""});this.http.put(`${J.apiUrl}/cortes/${this.corteActivo._id}/finalizar/false`,{},{headers:i}).subscribe({next:n=>{this.datosCorteParaImpresion=ae({responsable:this.usuarioNombre,fechaInicio:this.corteActivo.fechaInicio,fechaFin:new Date().toISOString(),nomFarm:this.farmaciaNombre,dirFarm:this.farmaciaDireccion,telFarm:this.farmaciaTelefono},n.corte),this.mostrarTicketCorte=!0,setTimeout(()=>{requestAnimationFrame(()=>{window.print(),setTimeout(()=>{this.mostrarTicketCorte=!1,Vt.default.fire({title:"\xBFLa impresi\xF3n fue exitosa?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(s=>{s.isConfirmed?this.http.put(`${J.apiUrl}/cortes/${this.corteActivo._id}/finalizar/true`,{},{headers:i}).subscribe({next:()=>{localStorage.removeItem("corte_activo"),this.authService.logout(),this.router.navigate(["/home"])},error:d=>{console.error("Error al guardar corte:",d),Vt.default.fire("Error","No se pudo guardar el corte.","error")}}):Vt.default.fire("Aviso","La impresi\xF3n no fue confirmada. El corte sigue activo.","info")})},300)})},300)},error:n=>{console.error("Error al cerrar turno:",n),Vt.default.fire("Error","No se pudo generar el corte.","error")}})})}static \u0275fac=function(e){return new(e||o)(P(Ne),P(ge),P(St),P(Fe))};static \u0275cmp=V({type:o,selectors:[["app-inicio-turno"]],decls:4,vars:3,consts:[[1,"container","mt-5"],["class","card p-4 shadow",4,"ngIf"],[3,"datosCorte",4,"ngIf"],[1,"card","p-4","shadow"],[1,"mb-4"],[1,"form-group","mb-3"],["for","efectivoInicial",1,"form-label"],["type","number","id","efectivoInicial","placeholder","Ej. 500.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],["for","saldoInicialRecargas",1,"form-label"],["type","number","id","saldoInicialRecargas","placeholder","Ej. 0.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-muted"],[1,"btn-verde","w-100","d-flex","align-items-center","justify-content-center",3,"click","disabled"],[4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"titulo","mb-4"],[1,"subtitulo"],[1,"btn-gris",3,"click"],[3,"datosCorte"]],template:function(e,i){e&1&&(a(0,"div",0),S(1,zf,16,5,"div",1)(2,qf,20,13,"div",1),r(),S(3,Wf,1,1,"app-corte-caja-ticket",2)),e&2&&(l(),m("ngIf",i.mostrarFormulario),l(),m("ngIf",i.corteActivo&&!i.mostrarFormulario),l(),m("ngIf",i.mostrarTicketCorte))},dependencies:[j,z,Te,Me,me,ie,Ae,Z,Et,xe,dr],encapsulation:2})};var gi=lt(_t());var pr=class o{constructor(t){this.http=t}apiUrl=`${J.apiUrl}/surtirFarmacias`;obtenerPendientes(t){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!1})}surtirFarmacia(t,e){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!0,detalles:e})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};function Kf(o,t){if(o&1&&(a(0,"option",6),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),x(" ",e.nombre," ")}}function Qf(o,t){if(o&1){let e=I();a(0,"div",13)(1,"button",17),g("click",function(){b(e);let n=u(2);return v(n.imprimirPrevia())}),c(2," Imprimir previa "),r()()}}function Yf(o,t){if(o&1){let e=I();a(0,"div",13)(1,"button",14),g("click",function(){b(e);let n=u();return v(n.omitirTodos())}),c(2,"Omitir todos"),r(),a(3,"button",15),g("click",function(){b(e);let n=u();return v(n.quitarOmisiones())}),c(4,"Quitar omisiones"),r(),a(5,"span",16),c(6," Omitidos: "),a(7,"strong"),c(8),r(),c(9),r(),S(10,Qf,3,0,"div",9),r()}if(o&2){let e=u();l(8),_(e.totalOmitidos),l(),x(" / ",e.rows.length," "),l(),m("ngIf",e.pendientes.length)}}function Xf(o,t){if(o&1){let e=I();a(0,"tr")(1,"td",20)(2,"input",21),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s.omitir,n)||(s.omitir=n),v(n)}),r()(),a(3,"td"),c(4),r(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td"),c(10),r(),a(11,"td"),c(12),r(),a(13,"td",22),c(14),r(),a(15,"td"),c(16),r()()}if(o&2){let e=t.$implicit;G("omitido",e.omitir),l(2),Bi("name","omitir_",e.producto,""),T("ngModel",e.omitir),te("aria-label","Omitir "+e.nombre),l(2),_(e.nombre),l(2),_(e.codigoBarras),l(2),_(e.existenciaActual),l(2),_(e.stockMin),l(2),_(e.stockMax),l(2),_(e.falta),l(2),_(e.disponibleEnAlmacen)}}function Zf(o,t){if(o&1&&(a(0,"table",18)(1,"thead")(2,"tr")(3,"th"),c(4,"Omit"),r(),a(5,"th"),c(6,"Producto"),r(),a(7,"th"),c(8,"C\xF3d. Barras"),r(),a(9,"th"),c(10,"Existencia"),r(),a(11,"th"),c(12,"Stock M\xEDnimo"),r(),a(13,"th"),c(14,"Stock M\xE1ximo"),r(),a(15,"th"),c(16,"Cantidad a Surtir"),r(),a(17,"th"),c(18,"Disponible Almac\xE9n"),r()()(),a(19,"tbody"),S(20,Xf,17,13,"tr",19),r()()),o&2){let e=u();l(20),m("ngForOf",e.pagedRows)("ngForTrackBy",e.trackByProd)}}function Jf(o,t){if(o&1){let e=I();a(0,"div",23)(1,"button",24),g("click",function(){b(e);let n=u();return v(n.goFirst())}),f(2,"i",25),r(),a(3,"button",26),g("click",function(){b(e);let n=u();return v(n.goPrev())}),f(4,"i",27),r(),c(5),a(6,"button",28),g("click",function(){b(e);let n=u();return v(n.goNext())}),f(7,"i",29),r(),a(8,"button",30),g("click",function(){b(e);let n=u();return v(n.goLast())}),f(9,"i",31),r()()}if(o&2){let e=u();l(),m("disabled",e.page===1),l(2),m("disabled",e.page===1),l(2),jt(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),l(),m("disabled",e.page===e.totalPages),l(2),m("disabled",e.page===e.totalPages)}}function eh(o,t){if(o&1){let e=I();a(0,"div",32)(1,"button",33),g("click",function(){b(e);let n=u();return v(n.onCancelar())}),c(2,"Cancelar"),r(),a(3,"button",34),g("click",function(){b(e);let n=u();return v(n.onSurtir())}),c(4," Surtir "),r()()}if(o&2){let e=u();l(3),m("disabled",e.rows.length>0&&e.totalOmitidos===e.rows.length)}}var ur=class o{constructor(t,e,i){this.fb=t;this.farmaciaService=e;this.surtidoService=i;this.form=this.fb.group({farmaciaId:[null,B.required]})}form;farmacias=[];pendientes=[];cargando=!1;rows=[];page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}trackByProd=(t,e)=>e.producto||e.codigoBarras;ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe(t=>{this.farmacias=t})}toggleFarmacia(t){let e=this.form.get("farmaciaId");t?e.disable():e.enable()}onAceptar(){if(this.form.invalid)return;this.cargando=!0;let t=this.form.value.farmaciaId;this.surtidoService.obtenerPendientes(t).subscribe({next:({pendientes:e})=>{if(this.pendientes=(e||[]).map(i=>qe(ae({},i),{omitir:!1})),this.rows=this.pendientes,this.resetPagination(),this.cargando=!1,this.rows.length===0){gi.default.fire({icon:"info",title:"Sin pendientes",html:"No hay productos con existencia <= stock m\xEDnimo",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1});return}this.toggleFarmacia(!0)},error:e=>{console.error(e),gi.default.fire("Error","No se pudieron cargar los productos.","error"),this.cargando=!1}})}get totalOmitidos(){return this.rows.filter(t=>t.omitir).length}omitirTodos(){this.rows.forEach(t=>t.omitir=!0)}quitarOmisiones(){this.rows.forEach(t=>t.omitir=!1)}onSurtir(){let t=this.form.value.farmaciaId,e=this.farmacias.find(n=>n._id===t)?.nombre||"",i=this.rows.map(n=>({producto:n.producto,omitir:!!n.omitir}));gi.default.fire({icon:"question",title:"Confirmar surtido",html:`
        Se surtir\xE1 a la farmacia <strong>${e}</strong> respetando las omisiones marcadas.<br>
        <small>Omitidos: ${this.totalOmitidos} / ${this.rows.length}</small>
      `,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(n=>{if(!n.isConfirmed){this.toggleFarmacia(!1);return}gi.default.showLoading(),this.surtidoService.surtirFarmacia(t,i).subscribe(s=>{gi.default.hideLoading(),gi.default.fire({icon:"success",title:"Surtido completado",html:"\xBFDeseas imprimir la hoja de surtido?",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(d=>{d.isConfirmed&&s?.surtido&&this.imprimirReal(s.surtido),this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)})},s=>{gi.default.hideLoading(),console.error(s);let d=s?.error?.detalle||s?.error?.mensaje||"No se pudo surtir la farmacia.";gi.default.fire("Aviso",d,"warning"),this.toggleFarmacia(!1)})})}onCancelar(){this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)}fmtFecha(t=new Date){let e=i=>String(i).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())} ${e(t.getHours())}:${e(t.getMinutes())}`}buildHTMLPrevia(){let t=this.form.value.farmaciaId,e=this.farmacias.find(s=>s._id===t)?.nombre||"",i=this.fmtFecha(),n=this.rows.map(s=>{let d=s.omitir?' class="omitida"':"",p=s.omitir?'<span class="chip chip-omit">OMITIDO</span>':"";return`
      <tr${d}>
        <td>${s.codigoBarras||""}</td>
        <td>${s.nombre||""} ${p}</td>
        <td style="text-align:right">${s.existenciaActual??0}</td>
        <td style="text-align:right">${s.stockMin??0}</td>
        <td style="text-align:right">${s.stockMax??0}</td>
        <td style="text-align:right">${s.falta??0}</td>
        <td style="text-align:right">${s.disponibleEnAlmacen??0}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Previa</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  .omitida { color: #777; }
  .chip { display:inline-block; border:1px solid #aaa; padding:1px 5px; border-radius:8px; font-size:10px; margin-left:6px; }
  .chip-omit { border-color:#b55; color:#b55; }
  .leyenda { font-size:10px; color:#555; margin-top:8px; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Previa)</p>
    <p class="sub">${e?`Farmacia: <b>${e}</b>`:""}</p>
  </div>

  <div class="meta">
    Fecha: <b>${i}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:70px; text-align:right">Exist.</th>
        <th style="width:70px; text-align:right">Stock Min</th>
        <th style="width:70px; text-align:right">Stock Max</th>
        <th style="width:90px; text-align:right">Cant. a Surtir</th>
        <th style="width:100px; text-align:right">Disp. Almac\xE9n</th>
      </tr>
    </thead>
    <tbody>
      ${n}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="7">Registros: ${this.rows.length} \u2014 Omitidos: ${this.totalOmitidos}</td>
      </tr>
    </tfoot>
  </table>
  <p class="leyenda">Esta es una previsualizaci\xF3n. La hoja real puede variar seg\xFAn disponibilidad por lotes.</p>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}buildHTMLReal(t){let e=this.form.value.farmaciaId,i=this.farmacias.find(d=>d._id===e)?.nombre||"",n=t?.fechaSurtido?this.fmtFecha(new Date(t.fechaSurtido)):this.fmtFecha(),s=(t?.items||[]).map(d=>{let p=d?.producto?.nombre||"",h=d?.producto?.codigoBarras||"",C=d?.lote||"SIN-LOTE",E=d?.cantidad??0,D=d?.precioUnitario??0;return`
      <tr>
        <td>${h}</td>
        <td>${p}</td>
        <td>${C}</td>
        <td style="text-align:right">${E}</td>
        <td style="text-align:right">${D.toFixed(2)}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Real</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Real)</p>
    <p class="sub">${i?`Farmacia: <b>${i}</b>`:""}</p>
  </div>

  <div class="meta">
    Surtido ID: <b>${t?._id||"-"}</b><br>
    Fecha surtido: <b>${n}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:90px">Lote</th>
        <th style="width:80px; text-align:right">Cantidad</th>
        <th style="width:100px; text-align:right">Precio Unit.</th>
      </tr>
    </thead>
    <tbody>
      ${s||'<tr><td colspan="5">Sin items</td></tr>'}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="5">Productos surtidos: ${(t?.items||[]).length}</td>
      </tr>
    </tfoot>
  </table>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}printHTML(t){let e=window.open("","_blank","width=900,height=700");e&&(e.document.open(),e.document.write(t),e.document.close(),setTimeout(()=>e.focus(),50))}imprimirPrevia(){if(!this.rows.length)return;let t=this.buildHTMLPrevia();this.printHTML(t)}imprimirReal(t){let e=this.buildHTMLReal(t);this.printHTML(e)}static \u0275fac=function(e){return new(e||o)(P(He),P(ze),P(pr))};static \u0275cmp=V({type:o,selectors:[["app-surtir-farmacia"]],decls:18,vars:9,consts:[[1,"surtir-farmacia"],[1,"titulo-container"],[1,"titulo"],[2,"border-bottom","2px solid #0453b3","padding-bottom","1rem",3,"ngSubmit","formGroup"],[1,"subtitulo"],["formControlName","farmaciaId"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","submit","matTooltip","Buscar productos que requieren surtirse",1,"btn-gris",3,"disabled"],["class","toolbar","style","margin: .5rem 0; display:flex; gap:.5rem; align-items:center;",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","botones-accion",4,"ngIf"],[1,"toolbar",2,"margin",".5rem 0","display","flex","gap",".5rem","align-items","center"],["matTooltip","Marca todos como omitidos",1,"btn-gris",3,"click"],["matTooltip","Quita todas las omisiones",1,"btn-gris",3,"click"],[2,"margin-left","auto","font-size",".9rem"],["matTooltip","Imprime la hoja de surtido con las omisiones",1,"btn-amarillo",3,"click"],[1,"tabla"],[3,"omitido",4,"ngFor","ngForOf","ngForTrackBy"],[2,"text-align","center"],["type","checkbox","matTooltip","Si est\xE1 activado, este producto no se surtir\xE1",1,"chk-omit",3,"ngModelChange","ngModel","name"],[1,"falta"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"botones-accion"],["matTooltip","Quitar lista sin surtir",1,"btn-rojo",3,"click"],["matTooltip","Surtir los productos de la lista",1,"btn-verde","a-la-derecha",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"p",2),c(3,"Surtir Farmacias"),r()(),a(4,"form",3),g("ngSubmit",function(){return i.onAceptar()}),a(5,"label")(6,"span",4),c(7,"Farmacia:"),r(),a(8,"select",5)(9,"option",6),c(10,"-- Selecciona --"),r(),S(11,Kf,2,2,"option",7),r()(),a(12,"button",8),c(13),r()(),S(14,Yf,11,3,"div",9)(15,Zf,21,2,"table",10)(16,Jf,10,7,"div",11)(17,eh,5,1,"div",12),r()),e&2&&(l(4),m("formGroup",i.form),l(5),m("ngValue",null),l(2),m("ngForOf",i.farmacias),l(),m("disabled",i.form.invalid||i.cargando||i.pendientes.length>0),l(),x(" ",i.cargando?"Cargando\u2026":"Aceptar"," "),l(),m("ngIf",i.pendientes.length),l(),m("ngIf",i.pendientes.length),l(),m("ngIf",i.totalItems>0),l(),m("ngIf",i.pendientes.length))},dependencies:[j,Y,z,me,ke,ce,de,at,le,Z,Oe,xe,De,Ye,Xe,Ve,_e],styles:[".surtir-farmacia[_ngcontent-%COMP%]{max-width:100%;margin:1rem auto;padding:0 1rem}.omitido[_ngcontent-%COMP%]{opacity:.55}.chk-omit[_ngcontent-%COMP%]{appearance:auto;-webkit-appearance:checkbox;-moz-appearance:checkbox;transform:none;zoom:1;width:16px;height:16px;vertical-align:middle;margin:0;padding:0;cursor:pointer}form[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-end;margin-bottom:1rem}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-weight:700;color:#333}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.3rem;font-size:1rem;border-radius:5px;height:41px}input[_ngcontent-%COMP%]{width:150px}select[_ngcontent-%COMP%]{width:320px}select[_ngcontent-%COMP%]:disabled, input[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:1rem;cursor:pointer}button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.botones-accion[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.a-la-derecha[_ngcontent-%COMP%]{margin-left:auto}.falta[_ngcontent-%COMP%]{color:#8b0000;font-weight:500}"]})};var bt=lt(_t());var Sn=class o{constructor(t){this.http=t}base=`${J.apiUrl}/compras`;headers(){return new ne({"x-auth-token":localStorage.getItem("auth_token")||""})}getCompras(){return this.http.get(this.base)}crearCompra(t){return this.http.post(this.base,t)}listar(t){let e=new Le;return Object.entries(t||{}).forEach(([i,n])=>{n!=null&&n!==""&&(e=e.set(i,String(n)))}),this.http.get(`${this.base}/consulta`,{params:e})}searchProductos(t){let e=`${J.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(Se(i=>i?.data??i?.rows??i??[]),Lt(()=>Ie([])))}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var ih=["backdrop"],nh=["firstInput"],fr=o=>({"selected-radio":o}),oh=o=>({"selected-checkbox":o});function rh(o,t){if(o&1&&(a(0,"option",7),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function ah(o,t){if(o&1){let e=I();a(0,"button",29),g("click",function(){b(e);let n=u();return v(n.limpiarProducto())}),f(1,"i",30),r()}}function sh(o,t){if(o&1&&(a(0,"span",31),c(1),r()),o&2){let e=u();l(),_(e.nombreProducto)}}function lh(o,t){if(o&1){let e=I();a(0,"button",38),g("click",function(){let n=b(e).$implicit,s=u(3);return v(s.selectProd(n))}),a(1,"div",39),c(2),r(),a(3,"div",40),c(4),r()()}if(o&2){let e=t.$implicit;l(2),_(e.nombre||"(sin nombre)"),l(2),_(e.codigoBarras||"\u2014")}}function ch(o,t){if(o&1&&(a(0,"div",35)(1,"div",36),S(2,lh,5,2,"button",37),r()()),o&2){let e=u(2);l(2),m("ngForOf",e.prodOpts)}}function dh(o,t){if(o&1){let e=I();a(0,"div",18)(1,"label"),c(2," Buscar producto (nombre o c\xF3digo): "),a(3,"div",32)(4,"input",33),g("input",function(n){b(e);let s=u();return v(s.onProdInput((n.target.value||"").trim()))}),r(),S(5,ch,3,1,"div",34),r()()()}if(o&2){let e=u();l(4),m("disabled",e.cargandoProducto),l(),m("ngIf",e.prodOpts.length)}}function mh(o,t){if(o&1&&(a(0,"small",55),c(1),r()),o&2){let e=u(2);l(),x(" Se enviar\xE1: ",e.itemForm.value.fechaCaducidad," ")}}function ph(o,t){o&1&&(a(0,"div",56),c(1," Fecha inv\xE1lida. Escribe "),a(2,"strong"),c(3,"mmAA"),r(),c(4," (p. ej. 0925 \u2192 2025-09-30). "),r())}function uh(o,t){if(o&1){let e=I();a(0,"div",41)(1,"label",42),c(2,"Cantidad: "),f(3,"input",43),r(),a(4,"label",42),c(5,"Lote: "),f(6,"input",44),r(),a(7,"div",45)(8,"label",46),c(9,"Caducidad:"),r(),a(10,"input",47),g("blur",function(){let n;b(e);let s=u();return v((n=s.itemForm.get("caducidadMMAAAA"))==null?null:n.markAsTouched())}),r(),S(11,mh,2,1,"small",48)(12,ph,5,0,"div",49),r(),a(13,"label",42),c(14,"Costo U.: "),f(15,"input",50),r(),a(16,"label",42),c(17,"Precio U.: "),f(18,"input",51),r(),a(19,"label",42),c(20,"Stock m\xEDnimo.: "),f(21,"input",52),r(),a(22,"label",42),c(23,"Stock m\xE1ximo.: "),f(24,"input",53),r(),a(25,"button",54),g("click",function(){b(e);let n=u();return v(n.onAgregarItem())}),c(26,"Agregar al carrito"),r()()}if(o&2){let e,i=u();l(11),m("ngIf",i.itemForm.value.fechaCaducidad),l(),m("ngIf",((e=i.itemForm.get("caducidadMMAAAA"))==null?null:e.invalid)&&((e=i.itemForm.get("caducidadMMAAAA"))==null?null:e.touched)),l(13),m("disabled",i.itemForm.invalid)}}function fh(o,t){if(o&1){let e=I();a(0,"div",95)(1,"div",96),c(2),r(),a(3,"div",71)(4,"input",68),k("ngModelChange",function(n){let s=b(e).$implicit,d=u(5);return O(d.editPromos[s.prop].porcentaje,n)||(d.editPromos[s.prop].porcentaje=n),v(n)}),r()(),a(5,"div",69)(6,"input",72),k("ngModelChange",function(n){let s=b(e).$implicit,d=u(5);return O(d.editPromos[s.prop].inicio,n)||(d.editPromos[s.prop].inicio=n),v(n)}),r()(),a(7,"div",69)(8,"input",72),k("ngModelChange",function(n){let s=b(e).$implicit,d=u(5);return O(d.editPromos[s.prop].fin,n)||(d.editPromos[s.prop].fin=n),v(n)}),r()(),a(9,"div",71)(10,"div",97)(11,"input",81),k("ngModelChange",function(n){let s=b(e).$implicit,d=u(5);return O(d.editPromos[s.prop].monedero,n)||(d.editPromos[s.prop].monedero=n),v(n)}),r()()()()}if(o&2){let e=t.$implicit,i=u(5);l(2),_(e.name),l(2),T("ngModel",i.editPromos[e.prop].porcentaje),l(2),T("ngModel",i.editPromos[e.prop].inicio),l(2),T("ngModel",i.editPromos[e.prop].fin),l(3),T("ngModel",i.editPromos[e.prop].monedero)}}function hh(o,t){if(o&1&&(a(0,"div",88)(1,"div",89)(2,"div",90),c(3,"D\xEDa"),r(),a(4,"div",91),c(5,"% Desc."),r(),a(6,"div",92),c(7,"Inicia"),r(),a(8,"div",92),c(9,"Termina"),r(),a(10,"div",93),c(11,"Monedero"),r()(),S(12,fh,12,5,"div",94),r()),o&2){let e=u(4);l(12),m("ngForOf",e.diasSemana)}}function gh(o,t){if(o&1){let e=I();a(0,"div",98)(1,"div",89)(2,"div",91),c(3,"Cantidad"),r(),a(4,"div",99),c(5,"Inicia"),r(),a(6,"div",99),c(7,"Termina"),r()(),a(8,"div",100)(9,"div",71)(10,"select",101),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.promoCantidadRequerida,n)||(s.editPromos.promoCantidadRequerida=n),v(n)}),a(11,"option",7),c(12,"--"),r(),a(13,"option",7),c(14,"2x1"),r(),a(15,"option",7),c(16,"3x2"),r(),a(17,"option",7),c(18,"4x3"),r()()(),a(19,"div",102)(20,"input",72),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.inicioPromoCantidad,n)||(s.editPromos.inicioPromoCantidad=n),v(n)}),r()(),a(21,"div",102)(22,"input",72),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.finPromoCantidad,n)||(s.editPromos.finPromoCantidad=n),v(n)}),r()()()()}if(o&2){let e=u(4);l(10),T("ngModel",e.editPromos.promoCantidadRequerida),l(),m("ngValue",null),l(2),m("ngValue",2),l(2),m("ngValue",3),l(2),m("ngValue",4),l(3),T("ngModel",e.editPromos.inicioPromoCantidad),l(2),T("ngModel",e.editPromos.finPromoCantidad)}}function _h(o,t){if(o&1){let e=I();a(0,"div",103)(1,"div",89)(2,"div",91),c(3,"% Desc."),r(),a(4,"div",104),c(5,"Inicia"),r(),a(6,"div",104),c(7,"Termina"),r(),a(8,"div",93),c(9,"Monedero"),r()(),a(10,"div",71)(11,"input",68),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.promoDeTemporada.porcentaje,n)||(s.editPromos.promoDeTemporada.porcentaje=n),v(n)}),r()(),a(12,"div",105)(13,"input",72),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.promoDeTemporada.inicio,n)||(s.editPromos.promoDeTemporada.inicio=n),v(n)}),r()(),a(14,"div",105)(15,"input",72),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.promoDeTemporada.fin,n)||(s.editPromos.promoDeTemporada.fin=n),v(n)}),r()(),a(16,"div",71)(17,"div",97)(18,"input",81),k("ngModelChange",function(n){b(e);let s=u(4);return O(s.editPromos.promoDeTemporada.monedero,n)||(s.editPromos.promoDeTemporada.monedero=n),v(n)}),r()()()()}if(o&2){let e=u(4);l(11),T("ngModel",e.editPromos.promoDeTemporada.porcentaje),l(2),T("ngModel",e.editPromos.promoDeTemporada.inicio),l(2),T("ngModel",e.editPromos.promoDeTemporada.fin),l(3),T("ngModel",e.editPromos.promoDeTemporada.monedero)}}function bh(o,t){if(o&1){let e=I();a(0,"tr",64)(1,"td",65)(2,"div",66)(3,"div",67)(4,"label")(5,"strong"),c(6,"Cant.:"),r()(),a(7,"input",68),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.cantidad,n)||(s.cantidad=n),v(n)}),r()(),a(8,"div",69)(9,"label")(10,"strong"),c(11,"Lote:"),r()(),a(12,"input",70),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.lote,n)||(s.lote=n),v(n)}),r()(),a(13,"div",71)(14,"label")(15,"strong"),c(16,"Caducidad:"),r()(),a(17,"input",72),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.fechaCaducidad,n)||(s.fechaCaducidad=n),v(n)}),r()(),a(18,"div",71)(19,"label")(20,"strong"),c(21,"Costo:"),r()(),a(22,"input",73),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.costoUnitario,n)||(s.costoUnitario=n),v(n)}),r()(),a(23,"div",71)(24,"label")(25,"strong"),c(26,"Precio:"),r()(),a(27,"input",68),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.precioUnitario,n)||(s.precioUnitario=n),v(n)}),r()(),a(28,"div",67)(29,"label")(30,"strong"),c(31,"M\xEDn:"),r()(),a(32,"input",68),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.stockMinimo,n)||(s.stockMinimo=n),v(n)}),r()(),a(33,"div",67)(34,"label")(35,"strong"),c(36,"M\xE1x:"),r()(),a(37,"input",68),k("ngModelChange",function(n){b(e);let s=u().$implicit;return O(s.stockMaximo,n)||(s.stockMaximo=n),v(n)}),r()()(),a(38,"div",74)(39,"div",75)(40,"label"),c(41,"Elige promoci\xF3n:"),r()(),a(42,"div",71)(43,"label",76)(44,"input",77),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.editPromos.tipoPromocion,n)||(s.editPromos.tipoPromocion=n),v(n)}),r(),c(45," Ninguna "),r()(),a(46,"div",71)(47,"label",76)(48,"input",78),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.editPromos.tipoPromocion,n)||(s.editPromos.tipoPromocion=n),v(n)}),r(),c(49," Por d\xEDa "),r()(),a(50,"div",71)(51,"label",76)(52,"input",79),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.editPromos.tipoPromocion,n)||(s.editPromos.tipoPromocion=n),v(n)}),r(),c(53," Cantidad "),r()(),a(54,"div",71)(55,"label",76)(56,"input",80),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.editPromos.tipoPromocion,n)||(s.editPromos.tipoPromocion=n),v(n)}),r(),c(57," Temporada "),r()(),a(58,"div",71)(59,"label",76),c(60," INAPAM(+5%) "),a(61,"input",81),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.editPromos.descuentoINAPAM,n)||(s.editPromos.descuentoINAPAM=n),v(n)}),r()()()(),S(62,hh,13,1,"div",82)(63,gh,23,7,"div",83)(64,_h,19,4,"div",84),a(65,"div",85)(66,"button",86),g("click",function(){b(e);let n=u(3);return v(n.cancelPromos())}),c(67,"Cancelar"),r(),a(68,"button",87),g("click",function(){b(e);let n=u().index,s=u(2);return v(s.savePromos(n))}),c(69,"Guardar"),r()()()()}if(o&2){let e=u(),i=e.$implicit,n=e.index,s=u(2);l(7),T("ngModel",i.cantidad),l(5),T("ngModel",i.lote),l(5),T("ngModel",i.fechaCaducidad),l(5),T("ngModel",i.costoUnitario),l(5),T("ngModel",i.precioUnitario),l(5),T("ngModel",i.stockMinimo),l(5),T("ngModel",i.stockMaximo),l(6),m("ngClass",nt(28,fr,s.editPromos.tipoPromocion==="ninguna")),l(),Bi("name","promo-",n,""),T("ngModel",s.editPromos.tipoPromocion),l(3),m("ngClass",nt(30,fr,s.editPromos.tipoPromocion==="dia")),l(),Bi("name","promo-",n,""),T("ngModel",s.editPromos.tipoPromocion),l(3),m("ngClass",nt(32,fr,s.editPromos.tipoPromocion==="cantidad")),l(),Bi("name","promo-",n,""),T("ngModel",s.editPromos.tipoPromocion),l(3),m("ngClass",nt(34,fr,s.editPromos.tipoPromocion==="temporada")),l(),Bi("name","promo-",n,""),T("ngModel",s.editPromos.tipoPromocion),l(3),m("ngClass",nt(36,oh,s.editPromos.descuentoINAPAM)),l(2),T("ngModel",s.editPromos.descuentoINAPAM),l(),m("ngIf",s.editPromos.tipoPromocion==="dia"),l(),m("ngIf",s.editPromos.tipoPromocion==="cantidad"),l(),m("ngIf",s.editPromos.tipoPromocion==="temporada")}}function vh(o,t){if(o&1){let e=I();oe(0),a(1,"tr")(2,"td")(3,"button",61),g("click",function(){let n=b(e).index,s=u(2);return v(s.onEliminarItem(n))}),f(4,"i",30),r()(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td"),c(10),r(),a(11,"td"),c(12),r(),a(13,"td"),c(14),y(15,"date"),r(),a(16,"td"),c(17),y(18,"currency"),r(),a(19,"td"),c(20),y(21,"currency"),r(),a(22,"td"),c(23),r(),a(24,"td"),c(25),r(),a(26,"td"),c(27),y(28,"currency"),r(),a(29,"button",62),g("click",function(){let n=b(e).index,s=u(2);return v(s.toggleEditPromo(n))}),a(30,"mat-icon"),c(31),r()()(),S(32,bh,70,38,"tr",63),re()}if(o&2){let e=t.$implicit,i=t.index,n=u(2);l(6),_(e.nombre),l(2),_(e.codigoBarras),l(2),_(e.cantidad),l(2),_(e.lote),l(2),_(w(15,15,e.fechaCaducidad,"dd/MM/yyyy")),l(3),_(M(18,18,e.costoUnitario)),l(3),_(M(21,20,e.precioUnitario)),l(3),_(e.stockMinimo),l(2),_(e.stockMaximo),l(2),_(M(28,22,e.costoUnitario*e.cantidad)),l(2),Io(n.editingPromoIndex===i?"btn-icono btn-rojo":"btn-icono btn-verde"),m("matTooltip",n.editingPromoIndex===i?"Cerrar la edici\xF3n":"Editar promos y cantidades"),l(2),_(n.editingPromoIndex===i?"close":"edit"),l(),m("ngIf",n.editingPromoIndex===i)}}function yh(o,t){if(o&1&&(a(0,"table",57)(1,"thead")(2,"tr"),f(3,"th"),a(4,"th"),c(5,"Producto"),r(),a(6,"th"),c(7,"Codigo barras"),r(),a(8,"th"),c(9,"Cant."),r(),a(10,"th"),c(11,"Lote"),r(),a(12,"th"),c(13,"Caducidad"),r(),a(14,"th"),c(15,"Costo U."),r(),a(16,"th"),c(17,"Precio U."),r(),a(18,"th"),c(19,"Stock M\xEDn."),r(),a(20,"th"),c(21,"Stock M\xE1x."),r(),a(22,"th"),c(23,"Subtotal"),r(),f(24,"th"),r()(),a(25,"tbody"),S(26,vh,33,24,"ng-container",58),r(),a(27,"tfoot")(28,"tr")(29,"td",59),c(30,"Total:"),r(),a(31,"td",60),c(32),y(33,"currency"),r()()()()),o&2){let e=u();l(26),m("ngForOf",e.carrito),l(6),_(M(33,2,e.total))}}function Ch(o,t){if(o&1){let e=I();a(0,"div",106,0),g("keydown.escape",function(){b(e);let n=u();return v(n.cerrarNuevoProducto())}),a(2,"div",107),g("mousedown",function(n){return b(e),v(n.stopPropagation())})("click",function(n){return b(e),v(n.stopPropagation())}),a(3,"h3",108),c(4,"Nuevo producto"),r(),a(5,"form",109)(6,"div",110)(7,"div",111)(8,"label"),c(9,"Nombre *"),r(),f(10,"input",112,1),r(),a(12,"div",69)(13,"label"),c(14,"C\xF3digo de barras *"),r(),f(15,"input",113),r(),a(16,"div",69)(17,"label"),c(18,"Categor\xEDa *"),r(),f(19,"input",114),r(),a(20,"div",71)(21,"label"),c(22,"Unidad *"),r(),f(23,"input",115),r(),a(24,"div",71)(25,"label"),c(26,"Precio *"),r(),f(27,"input",116),r(),a(28,"div",71)(29,"label"),c(30,"Costo *"),r(),f(31,"input",117),r(),a(32,"div",71)(33,"label"),c(34,"Stock M\xEDn *"),r(),f(35,"input",118),r(),a(36,"div",71)(37,"label"),c(38,"Stock M\xE1x *"),r(),f(39,"input",119),r(),a(40,"div",120)(41,"label",121),c(42,"IVA"),r(),f(43,"input",122),r(),a(44,"div",120)(45,"label",123),c(46,"Gen\xE9rico"),r(),f(47,"input",124),r(),a(48,"div",120)(49,"label",125),c(50,"INAPAM"),r(),f(51,"input",126),r(),a(52,"div",71)(53,"label"),c(54,"Ubicaci\xF3n"),r(),f(55,"input",127),r()()(),a(56,"div",128)(57,"button",129),g("click",function(){b(e);let n=u();return v(n.cerrarNuevoProducto())}),c(58,"Cancelar"),r(),a(59,"button",130),g("click",function(){b(e);let n=u();return v(n.guardarNuevoProducto())}),c(60),r()()()()}if(o&2){let e=u();l(5),m("formGroup",e.nuevoProductoForm),l(54),m("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),l(),x(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var hr=class o{constructor(t,e,i,n,s,d){this.fb=t;this.proveedorService=e;this.productoService=i;this.compraService=n;this.renderer=d;s.addIcons(Ut)}backdrop;firstInput;headerForm;itemForm;carrito=[];total=0;nombreProducto="";codBarras="";cargandoProducto=!1;productoEncontrado=!1;cargando=!1;prodInput$=new ve;prodOpts=[];subs=[];prodSel=null;proveedores=[];productos=[];editingPromoIndex=null;editPromos={};diasSemana=[{name:"Lunes",prop:"promoLunes"},{name:"Martes",prop:"promoMartes"},{name:"Mi\xE9rcoles",prop:"promoMiercoles"},{name:"Jueves",prop:"promoJueves"},{name:"Viernes",prop:"promoViernes"},{name:"S\xE1bado",prop:"promoSabado"},{name:"Domingo",prop:"promoDomingo"}];mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;faPlus=Ut;toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}hoyISO=this.toLocalISODate(new Date);ngOnInit(){this.initForms(),this.itemForm.get("lote").valueChanges.subscribe(t=>{let e=(t??"").toUpperCase().replace(/[^A-Z0-9]/g,"");e!==t&&this.itemForm.patchValue({lote:e},{emitEvent:!1})}),this.itemForm.get("caducidadMMAAAA").valueChanges.subscribe(t=>{let e=(t??"").toString().replace(/\D/g,"");if(e!==t&&this.itemForm.patchValue({caducidadMMAAAA:e},{emitEvent:!1}),e.length!==4){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let i=+e.slice(0,2),n=+e.slice(2);if(i<1||i>12){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let s=2e3+n,d=new Date(s,i,0),p=String(d.getFullYear()),h=String(d.getMonth()+1).padStart(2,"0"),C=String(d.getDate()).padStart(2,"0");this.itemForm.patchValue({fechaCaducidad:`${p}-${h}-${C}`},{emitEvent:!1})}),this.loadProveedores(),this.loadProductos(),this.subs.push(this.prodInput$.pipe(Se(t=>(t||"").trim()),Ft(180),Rt(),ft(t=>t.length<2?Ie([]):this.compraService.searchProductos(t))).subscribe(t=>{this.prodOpts=Array.isArray(t)?t:[]})),this.nuevoProductoForm=this.fb.group({nombre:["",[B.required,B.minLength(3)]],codigoBarras:["",B.required],unidad:["",B.required],precio:[null,[B.required,B.min(0)]],costo:[null,[B.required,B.min(0)]],iva:[!1],stockMinimo:[50,[B.required,B.min(0)]],stockMaximo:[100,[B.required,B.min(0)]],ubicacion:[""],categoria:["",B.required],generico:[!1],descuentoINAPAM:[!1]})}mmYyValidator(t){let e=(t.value??"").toString().replace(/\D/g,"");if(e==="")return null;if(!/^\d{4}$/.test(e))return{mmYy:!0};let i=+e.slice(0,2),n=+e.slice(2);return i<1||i>12?{mmYy:!0}:null}initForms(){this.headerForm=this.fb.group({proveedor:[null,B.required],fechaCompra:[this.hoyISO],afectarExistencias:[!0]}),this.itemForm=this.fb.group({nombre:["",B.required],codigoBarras:["",B.required],cantidad:[1,[B.required,B.min(1)]],lote:["",[B.required,B.pattern(/^[A-Z0-9]*$/)]],caducidadMMAAAA:["",[this.mmYyValidator]],fechaCaducidad:[null,B.required],costoUnitario:[0,[B.required,B.min(0)]],precioUnitario:[0,[B.required,B.min(0)]],stockMinimo:[1,[B.required,B.min(1)]],stockMaximo:[1,[B.required,B.min(1)]],promociones:this.fb.group(ae({tipoPromocion:["ninguna"],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporada:this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]}),descuentoINAPAM:[!1]},this.getDiasSemanaForm()))})}getDiasSemanaForm(){let t={};for(let e of this.diasSemana)t[e.prop]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]});return t}loadProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=t.sort((e,i)=>e.nombre.localeCompare(i.nombre,"es",{sensitivity:"base"}))})}loadProductos(){this.productoService.obtenerProductos().subscribe(t=>this.productos=t)}onBuscarProducto(){return Q(this,null,function*(){let t=this.itemForm.get("codigoBarras")?.value?.trim();if(!t)return;this.cargandoProducto=!0,yield new Promise(i=>setTimeout(i,50));let e=this.productos.find(i=>i.codigoBarras===t);if(!e){yield bt.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(e)})}detectarTipoPromocion(t){return t.promoDeTemporada?"temporada":t.promoCantidadRequerida?"cantidad":this.diasSemana.some(e=>t[e.prop]!=null)?"dia":"ninguna"}mapDiasSemana(t){let e={};for(let i of this.diasSemana)e[i.prop]={porcentaje:t[i.prop]?.porcentaje??null,inicio:this.toDate(t[i.prop]?.inicio),fin:this.toDate(t[i.prop]?.fin),monedero:t[i.prop]?.monedero??!1};return e}limpiarProducto(){this.nombreProducto="",this.productoEncontrado=!1,this.itemForm.reset(),this.itemForm.get("codigoBarras")?.enable()}onAgregarItem(){if(this.itemForm.invalid){bt.default.fire("Formulario incompleto","Por favor llena todos los campos.","warning");return}let t=this.itemForm.value,e={nombre:t.nombre,codigoBarras:this.codBarras,cantidad:t.cantidad,lote:t.lote,fechaCaducidad:t.fechaCaducidad,costoUnitario:t.costoUnitario,precioUnitario:t.precioUnitario,stockMinimo:t.stockMinimo,stockMaximo:t.stockMaximo,promociones:t.promociones};this.carrito.push(e),this.calcularTotal(),this.limpiarProducto()}calcularTotal(){this.total=this.carrito.reduce((t,e)=>t+e.costoUnitario*e.cantidad,0)}onEliminarItem(t){this.carrito.splice(t,1),this.calcularTotal()}estaEditandoPromos=!1;toggleEditPromo(t){if(this.estaEditandoPromos=!0,this.calcularTotal(),this.editingPromoIndex===t){this.editingPromoIndex=null,this.estaEditandoPromos=!1;return}let e=this.carrito[t].promociones;if(this.editingPromoIndex=t,this.editPromos=JSON.parse(JSON.stringify(e)),this.editPromos.tipoPromocion==="dia")for(let i of this.diasSemana)this.editPromos[i.prop]??={porcentaje:null,inicio:null,fin:null,monedero:!1}}savePromos(t){this.carrito[t].promociones=JSON.parse(JSON.stringify(this.editPromos)),this.editingPromoIndex=null,this.estaEditandoPromos=!1}cancelPromos(){this.editingPromoIndex=null,this.estaEditandoPromos=!1}onRegistrarCompra(){if(this.headerForm.invalid||this.carrito.length===0){bt.default.fire("Datos incompletos","Selecciona proveedor y agrega productos.","warning");return}let t=this.headerForm.value.fechaCompra;if(t){let p=new Date(this.hoyISO);if(new Date(t)>p){bt.default.fire("Fecha inv\xE1lida","La fecha de compra no puede ser futura.","warning");return}}let e=this.headerForm.value.proveedor,n=this.proveedores.find(p=>p._id===e)?.nombre||"Desconocido",s=t?new Date(`${t}T12:00:00`).toISOString():null,d=!!this.headerForm.value.afectarExistencias;bt.default.fire({icon:"question",title:"Confirmar compra",html:`
      Proveedor: <strong>${n}</strong><hr>
      <div>Fecha compra: <strong>${t||this.hoyISO}</strong></div>
      <div>Afectar existencias: <strong>${d?"S\xED":"No"}</strong></div>
      <h2 style="color: blue">Total: <strong>$${this.total.toFixed(2)}</strong></h2>`,showCancelButton:!0,confirmButtonText:"Registrar"}).then(p=>{if(!p.isConfirmed)return;bt.default.showLoading();let h={proveedor:this.headerForm.value.proveedor,afectarExistencias:d,productos:this.carrito.map(C=>({codigoBarras:C.codigoBarras,cantidad:C.cantidad,lote:C.lote,fechaCaducidad:C.fechaCaducidad,costoUnitario:C.costoUnitario,precioUnitario:C.precioUnitario,stockMinimo:C.stockMinimo,stockMaximo:C.stockMaximo,promociones:C.promociones}))};s&&(h.fechaCompra=s),this.compraService.crearCompra(h).subscribe({next:()=>{bt.default.hideLoading(),bt.default.fire("Compra registrada","Se guard\xF3 correctamente.","success"),this.resetCompras()},error:C=>{bt.default.hideLoading(),console.error(C),bt.default.fire("Error","No se pudo registrar la compra.","error")}})})}resetCompras(){this.headerForm.reset(),this.carrito=[],this.total=0}toDate(t){return t?new Date(t).toISOString().substring(0,10):null}onProdInput(t){this.prodInput$.next(t)}selectProd(t,e){return Q(this,null,function*(){this.prodSel=t,this.prodOpts=[],e&&(e.value=""),this.cargandoProducto=!0,yield new Promise(n=>setTimeout(n,50));let i=this.productos.find(n=>n.codigoBarras===t.codigoBarras);if(!i){yield bt.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t.codigoBarras} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(i)})}applyProducto(t){if(!t)return;this.nombreProducto=t.nombre||"",this.codBarras=t.codigoBarras||"",this.productoEncontrado=!!this.nombreProducto,this.cargandoProducto=!1,this.itemForm.get("codigoBarras")?.setValue(this.codBarras),this.itemForm.get("codigoBarras")?.disable();let e=this.detectarTipoPromocion(t);this.itemForm.patchValue({nombre:t.nombre,codBarras:this.codBarras,cantidad:1,lote:"",caducidadMMAAAA:"",fechaCaducidad:null,costoUnitario:t.costo??0,precioUnitario:t.precio??0,stockMinimo:t.stockMinimo??1,stockMaximo:t.stockMaximo??1,promociones:ae({tipoPromocion:e,promoCantidadRequerida:t.promoCantidadRequerida??null,inicioPromoCantidad:this.toDate(t.inicioPromoCantidad),finPromoCantidad:this.toDate(t.finPromoCantidad),promoDeTemporada:{porcentaje:t.promoDeTemporada?.porcentaje??null,inicio:this.toDate(t.promoDeTemporada?.inicio),fin:this.toDate(t.promoDeTemporada?.fin),monedero:t.promoDeTemporada?.monedero??!1},descuentoINAPAM:t.descuentoINAPAM??!1},this.mapDiasSemana(t))})}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){bt.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,this.loadProductos(),bt.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{this.guardandoNuevo=!1,console.error(e),bt.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let i=e[0],n=e[e.length-1],s=document.activeElement;t.shiftKey&&s===i?(n.focus(),t.preventDefault()):!t.shiftKey&&s===n&&(i.focus(),t.preventDefault())}static \u0275fac=function(e){return new(e||o)(P(He),P(Ko),P(It),P(Sn),P(st),P(on))};static \u0275cmp=V({type:o,selectors:[["app-compras"]],viewQuery:function(e,i){if(e&1&&(Ee(ih,5),Ee(nh,5)),e&2){let n;ye(n=Ce())&&(i.backdrop=n.first),ye(n=Ce())&&(i.firstInput=n.first)}},hostBindings:function(e,i){e&1&&g("keydown",function(s){return i.trapTab(s)},!1,nn)},decls:39,vars:15,consts:[["backdrop",""],["firstInput",""],[1,"compras-container"],[1,"titulo-container"],[1,"titulo"],[1,"header-form",3,"formGroup"],["formControlName","proveedor",1,"input-text","select",2,"width","max-content"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"margin-left","12px"],["type","date","formControlName","fechaCompra","title","Fecha efectiva de la compra (no futuro)",1,"input-text",2,"width","max-content",3,"max"],["for","chk-afectar-exist",2,"margin","0.5rem 0 0 4rem"],["id","chk-afectar-exist","type","checkbox","formControlName","afectarExistencias","title","Si est\xE1 marcado, se actualizar\xE1n lotes/precios/inventarios; si no, solo se registrar\xE1 la compra."],[2,"margin-top","0.5rem","color","#f6a80c"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"item-form",3,"formGroup"],[1,"buscar"],["type","text","formControlName","codigoBarras","placeholder","Escanea aqu\xED",3,"keydown.enter"],["class","btn-rojo","matTooltip","Borrar c\xF3digo de barras",3,"click",4,"ngIf"],["class","producto-nombre",4,"ngIf"],["class","buscar",4,"ngIf"],["class","detalles-producto",4,"ngIf"],["class","tabla",4,"ngIf"],[1,"acciones"],["matTooltip","Cancelar toda la compra",1,"btn-rojo",3,"click","disabled"],["matTooltip","Registrar la compra completa",1,"btn-gris",3,"click","disabled"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["matTooltip","Borrar c\xF3digo de barras",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"producto-nombre"],[1,"suggest-wrap"],["type","text","placeholder","Escribe al menos 2 caracteres",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],[1,"suggest-panel"],[1,"suggest-grid"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"suggest-title"],[1,"suggest-sub"],[1,"detalles-producto"],[2,"width","10%"],["type","number","formControlName","cantidad","min","1"],["type","text","formControlName","lote","placeholder","Solo A-Z y 0-9"],[1,"field-stack",2,"width","18rem"],["for","caducidadMMYY",2,"width","10%"],["id","caducidadMMYY","type","text","inputmode","numeric","maxlength","4","formControlName","caducidadMMAAAA","placeholder","mmAA","autocomplete","off",3,"blur"],["class","field-help text-muted",4,"ngIf"],["class","field-error",4,"ngIf"],["type","number","formControlName","costoUnitario","step","0.01"],["type","number","formControlName","precioUnitario","step","0.01"],["type","number","formControlName","stockMinimo","step","1"],["type","number","formControlName","stockMaximo","step","1"],["type","button",1,"btn-verde",2,"height","fit-content","margin-top","1rem",3,"click","disabled"],[1,"field-help","text-muted"],[1,"field-error"],[1,"tabla"],[4,"ngFor","ngForOf"],["colspan","10",1,"total-label"],["colspan","2",2,"text-align","start"],["matTooltip","Quitar este producto de la compra",1,"btn-icono","btn-rojo-tache",3,"click"],[2,"margin-top","8px",3,"click","matTooltip"],["class","promo-editor",4,"ngIf"],[1,"promo-editor"],["colspan","12"],[1,"row","mb-3","text-center","align-items-center",2,"background-color","#f5f5f5","padding-bottom","10px"],[1,"col-1"],["type","number",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-3"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-2"],["type","date",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","number","step","0.1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"row","text-center","mb-1"],[1,"col-2","fw-bold"],[3,"ngClass"],["type","radio","value","ninguna",3,"ngModelChange","name","ngModel"],["type","radio","value","dia",3,"ngModelChange","name","ngModel"],["type","radio","value","cantidad",3,"ngModelChange","name","ngModel"],["type","radio","value","temporada",3,"ngModelChange","name","ngModel"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],["class","mb-4",4,"ngIf"],["class","row mb-4 align-items-center",4,"ngIf"],["class","row mb-3",4,"ngIf"],[1,"guardar-cancelar"],["matTooltip","Cancelar edici\xF3n del producto",1,"btn-rojo-chico",2,"margin-left","2rem",3,"click"],["matTooltip","Guardar cambios",1,"btn-verde-chico",2,"margin-right","2rem",3,"click"],[1,"mb-4"],[1,"row","fw-bold","text-center","align-items-center"],[1,"col-2","text-end",2,"padding-top","10px"],[1,"col-2",2,"padding-top","10px"],[1,"col-3",2,"padding-top","10px"],[1,"col-2","text-start",2,"padding-top","10px"],["class","row mb-2 align-items-center",4,"ngFor","ngForOf"],[1,"row","mb-2","align-items-center"],[1,"col-2","text-end","text-primary","fw-bold"],[1,"form-check"],[1,"row","mb-4","align-items-center"],[1,"col-5",2,"padding-top","10px"],[1,"row"],[1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-5"],[1,"row","mb-3"],[1,"col-4",2,"padding-top","10px"],[1,"col-4"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],[1,"modal-actions","mt-3"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",2)(1,"div",3)(2,"h1",4),c(3,"Compras"),r()(),a(4,"form",5)(5,"label"),c(6,"Proveedor:"),r(),a(7,"select",6)(8,"option",7),c(9,"-- Selecciona --"),r(),S(10,rh,2,2,"option",8),r(),a(11,"label",9),c(12,"Fecha de compra:"),r(),f(13,"input",10),a(14,"label",11),c(15,"Afectar existencias:"),r(),f(16,"input",12),a(17,"small",13),c(18),r(),a(19,"button",14),g("click",function(){return i.abrirNuevoProducto()}),f(20,"fa-icon",15),a(21,"span",16),c(22,"Nuevo"),r()()(),a(23,"div",17)(24,"div",18)(25,"label"),c(26," C\xF3digo de barras: "),a(27,"input",19),g("keydown.enter",function(){return i.onBuscarProducto()}),r()(),S(28,ah,2,0,"button",20)(29,sh,2,1,"span",21),r(),S(30,dh,6,2,"div",22)(31,uh,27,3,"div",23),r(),S(32,yh,34,4,"table",24),a(33,"div",25)(34,"button",26),g("click",function(){return i.carrito=[],i.total=0}),c(35,"Cancelar "),r(),a(36,"button",27),g("click",function(){return i.onRegistrarCompra()}),c(37,"Registrar Compra "),r()(),S(38,Ch,61,3,"div",28),r()),e&2&&(l(4),m("formGroup",i.headerForm),l(4),m("ngValue",null),l(2),m("ngForOf",i.proveedores),l(3),m("max",i.hoyISO),l(5),x(" ",i.headerForm.value.afectarExistencias?"S\xED (actualiza productos)":"No (solo registra compra)"," "),l(2),m("icon",i.faPlus),l(3),m("formGroup",i.itemForm),l(5),m("ngIf",i.nombreProducto.length>0),l(),m("ngIf",i.nombreProducto.length>0),l(),m("ngIf",!i.productoEncontrado),l(),m("ngIf",i.nombreProducto.length>0),l(),m("ngIf",i.carrito.length),l(2),m("disabled",!i.carrito.length||i.estaEditandoPromos),l(2),m("disabled",!i.carrito.length||i.headerForm.invalid||i.estaEditandoPromos),l(2),m("ngIf",i.mostrarNuevoProducto))},dependencies:[j,Qe,Y,z,Re,Me,me,ke,ce,de,ie,Ae,at,le,ln,Z,Oe,cn,Et,xe,De,Ye,Xe,Ve,_e,oi,wi,Je,Ze],styles:[".compras-container[_ngcontent-%COMP%]{width:100%}.header-form[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-bottom:1rem;font-size:large}.header-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:.5rem}.item-form[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:large;border-bottom:2px solid #0453b3}.item-form[_ngcontent-%COMP%]   .buscar[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem}.producto-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:500;padding:8px 12px;border-radius:5px}.detalles-producto[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.detalles-producto[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.total-label[_ngcontent-%COMP%]{text-align:right;font-weight:700}.acciones[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;gap:10px;margin-top:20px}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px;padding:10px 20px;font-size:16px}.field-stack[_ngcontent-%COMP%]{display:inline-block;vertical-align:top}.field-stack[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;margin-bottom:4px}.field-help[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:.85rem}.field-error[_ngcontent-%COMP%]{display:block;margin-top:4px;color:#dc3545;font-size:.85rem}@media (max-width: 600px){.acciones[_ngcontent-%COMP%]{justify-content:center}}.guardar-cancelar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-top:1rem;margin-bottom:1rem}.promo-editor[_ngcontent-%COMP%]{background:#f9f9f9;padding:1rem;border-top:2px solid #ddd}.promo-editor[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:.1rem}.selected-radio[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;padding:5px 10px;border-radius:6px}.selected-checkbox[_ngcontent-%COMP%]{background-color:#b7fe88;color:#000;padding:5px 10px;border-radius:6px}.fw-bold[_ngcontent-%COMP%]{font-weight:700;color:#02047c}.suggest-wrap[_ngcontent-%COMP%]{position:relative;display:block}.suggest-panel[_ngcontent-%COMP%]{position:absolute;inset-inline:0;top:calc(100% + .25rem);z-index:40;background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;padding:.5rem;max-height:24rem;overflow:auto}.suggest-grid[_ngcontent-%COMP%]{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.75rem .9rem;border:1px solid #eef0f3;border-radius:.75rem;background:#f9fafb;cursor:pointer;transition:background-color .15s ease,border-color .15s ease,transform .06s ease}.suggest-item[_ngcontent-%COMP%]:hover{background:#f3f4f6;border-color:#e5e7eb}.suggest-item[_ngcontent-%COMP%]:active{transform:scale(.995)}.suggest-title[_ngcontent-%COMP%]{font-weight:600;color:#111827;line-height:1.2}.suggest-sub[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.875rem;color:#6b7280}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#d1d5db;border-radius:8px;border:3px solid transparent;background-clip:content-box}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#c0c4cb}@media (prefers-color-scheme: dark){.suggest-panel[_ngcontent-%COMP%]{background:#0b0f15;border-color:#1f2937;box-shadow:0 10px 15px -3px #00000080,0 4px 6px -4px #00000080}.suggest-item[_ngcontent-%COMP%]{background:#0f172a;border-color:#1f2937}.suggest-item[_ngcontent-%COMP%]:hover{background:#111827;border-color:#334155}.suggest-title[_ngcontent-%COMP%]{color:#e5e7eb}.suggest-sub[_ngcontent-%COMP%]{color:#94a3b8}}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}"]})};var je=lt(_t());var xh=()=>["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];function Sh(o,t){if(o&1){let e=I();a(0,"div",36)(1,"label"),c(2,"Lote:"),r(),f(3,"input",37),a(4,"label"),c(5,"Caducidad:"),r(),f(6,"input",38),a(7,"label"),c(8,"Cantidad:"),r(),f(9,"input",39),a(10,"button",40),g("click",function(){let n=b(e).index,s=u();return v(s.eliminarLote(n))}),c(11,"Eliminar"),r()()}if(o&2){let e=t.index;m("formGroupName",e)}}function Eh(o,t){if(o&1&&(a(0,"div")(1,"div",41)(2,"div",42)(3,"label",16),c(4),r()(),a(5,"div",42)(6,"label"),c(7,"% desc.:"),r(),f(8,"input",27),r(),a(9,"div",43)(10,"label"),c(11,"Inicio:"),r(),f(12,"input",28),r(),a(13,"div",43)(14,"label"),c(15,"Fin:"),r(),f(16,"input",29),r(),a(17,"div",42)(18,"label"),c(19,"Monedero:"),r(),f(20,"input",30),r()()()),o&2){let e=t.$implicit;l(),m("formGroupName","promo"+e),l(3),_(e)}}var gr=class o{constructor(t,e){this.fb=t;this.producto=e}formulario;guardar=new Ue;cerrar=new Ue;ngOnInit(){this.formulario=this.fb.group({nombre:[this.producto.nombre,[B.required]],codigoBarras:[this.producto.codigoBarras,[B.required]],ubicacion:[this.producto.ubicacion],categoria:[this.producto.categoria],precio:[this.producto.precio,[B.required,B.min(0)]],costo:[this.producto.costo,[B.required,B.min(0)]],iva:[this.producto.iva],descuentoINAPAM:[this.producto.descuentoINAPAM],stockMinimo:[this.producto.stockMinimo,[B.required,B.min(0)]],stockMaximo:[this.producto.stockMaximo,[B.required,B.min(0)]],lotes:this.fb.array(this.producto.lotes.map(e=>this.crearLoteForm(e))),promosPorDia:this.fb.group(this.inicializarPromosPorDia()),promoCantidadRequerida:[this.producto.promoCantidadRequerida],inicioPromoCantidad:[this.formatDate(this.producto.inicioPromoCantidad)],finPromoCantidad:[this.formatDate(this.producto.finPromoCantidad)],promoDeTemporada:this.fb.group({porcentaje:[this.producto.promoDeTemporada?.porcentaje,[B.min(0),B.max(100)]],inicio:[this.formatDate(this.producto.promoDeTemporada?.inicio)],fin:[this.formatDate(this.producto.promoDeTemporada?.fin)],monedero:[this.producto.promoDeTemporada?.monedero]})},{validators:this.validarFechasGlobales()});let t=this.formulario.get("lotes");t.controls.forEach(e=>{let i=e;Object.values(i.controls).forEach(n=>{n.clearValidators(),n.clearAsyncValidators(),n.setErrors(null),n.updateValueAndValidity({onlySelf:!0})}),i.setErrors(null),i.updateValueAndValidity({onlySelf:!0})}),t.clearValidators(),t.clearAsyncValidators(),t.setErrors(null),t.updateValueAndValidity(),t.controls.forEach(e=>{let i=e,n=i.get("fechaCaducidad");(n.value===""||n.value===void 0)&&n.setValue(null,{emitEvent:!1}),n.valueChanges.subscribe(s=>{s===""&&(n.setValue(null,{emitEvent:!1}),n.updateValueAndValidity({onlySelf:!0}),i.updateValueAndValidity({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0}),this.formulario.updateValueAndValidity())})}),this.formulario.updateValueAndValidity()}formOkSinLotes(){if(!this.formulario)return!1;let t=this.formulario.controls;return Object.keys(t).filter(e=>e!=="lotes").every(e=>t[e]?.valid===!0)}dumpFormErrors(t,e="form"){let i=s=>s.controls&&!s.length,n=s=>Array.isArray(s.controls);i(t)?Object.entries(t.controls).forEach(([s,d])=>{this.dumpFormErrors(d,`${e}.${s}`)}):n(t)?t.controls.forEach((s,d)=>{this.dumpFormErrors(s,`${e}[${d}]`)}):t.errors&&console.log(`\u274C ${e}:`,t.errors)}validarFechasGlobales(){return t=>{let e=t.get("inicioPromoCantidad")?.value,i=t.get("finPromoCantidad")?.value;if(!e||!i)return null;let n=new Date(e),s=new Date(i);return isNaN(n.getTime())||isNaN(s.getTime())||s>=n?null:{rangoPromoCantidad:!0}}}optionalFutureDate(){return t=>{let e=t.value;if(e==null||e==="")return null;let i=new Date(e);if(isNaN(i.getTime()))return{invalidDate:!0};let n=new Date;return n.setHours(0,0,0,0),i>=n?null:{pastDate:!0}}}optionalMin(t){return e=>{let i=e.value;if(i==null||i==="")return null;let n=Number(i);return Number.isFinite(n)&&n>=t?null:{min:{min:t,actual:i}}}}crearLoteForm(t){return this.fb.group({_id:[t?._id??null],lote:[t?.lote??null],fechaCaducidad:[this.formatDate(t?.fechaCaducidad)||null,[this.optionalFutureDate()]],cantidad:[t?.cantidad??null,[this.optionalMin(0)]]})}inicializarPromosPorDia(){let t={};return["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"].forEach(i=>{let n=`promo${i}`,s=this.producto[n];t[n]=this.fb.group({porcentaje:[s?.porcentaje??0],inicio:[this.formatDate(s?.inicio)],fin:[this.formatDate(s?.fin)],monedero:[s?.monedero??!1]})}),t}get lotesFormArray(){return this.formulario.get("lotes")}agregarLote(){let t={lote:"",fechaCaducidad:new Date,cantidad:0};this.lotesFormArray.push(this.crearLoteForm(t))}eliminarLote(t){this.lotesFormArray.removeAt(t)}guardarProducto(){if(this.formulario.invalid){console.log("\u274C Formulario inv\xE1lido:",this.formulario.errors),Object.entries(this.formulario.controls).forEach(([n,s])=>{console.log("Campo:",n,"Estado:",s.status,"Errores:",s.errors)});return}let t=this.formulario.value,e=(t.lotes||[]).map(n=>qe(ae({},n),{lote:(n?.lote??"").toString().trim()||null,fechaCaducidad:n?.fechaCaducidad?new Date(n.fechaCaducidad):null,cantidad:n?.cantidad===""||n?.cantidad===null||n?.cantidad===void 0?null:Number(n.cantidad)})).filter(n=>n.lote!==null||n.fechaCaducidad!==null||n.cantidad!==null),i=qe(ae(ae({},this.producto),t),{lotes:e});this.guardar.emit(i)}cerrarModal(){this.cerrar.emit()}formatDate(t){return t?new Date(t).toISOString().split("T")[0]:""}static \u0275fac=function(e){return new(e||o)(P(He),P("PRODUCTO_DATA"))};static \u0275cmp=V({type:o,selectors:[["app-modal-editar-producto"]],outputs:{guardar:"guardar",cerrar:"cerrar"},decls:89,vars:9,consts:[[1,"modal-overlay"],[1,"modal-content"],[1,"titulo"],[3,"formGroup"],[1,"edit-seccion"],["type","text","formControlName","nombre",2,"width","32rem"],["type","text","formControlName","codigoBarras",2,"width","10rem"],["type","text","formControlName","categoria",2,"width","11rem"],["type","number","formControlName","stockMinimo",2,"width","4rem"],["type","number","formControlName","stockMaximo",2,"width","4rem"],["type","checkbox","formControlName","iva"],["type","checkbox","formControlName","descuentoINAPAM"],["type","number","formControlName","costo","step","0.1",2,"width","4rem"],["type","number","formControlName","precio","step","0.1",2,"width","4rem"],["type","text","formControlName","ubicacion",2,"width","15rem"],["formArrayName","lotes"],[1,"subtitulo-edit"],["class","edit-seccion",3,"formGroupName",4,"ngFor","ngForOf"],[2,"text-align","center"],["type","button",1,"btn-verde-chico",3,"click"],[2,"margin-left","1rem"],["formControlName","promoCantidadRequerida",2,"margin-right","2rem"],[3,"ngValue"],["type","date","formControlName","inicioPromoCantidad"],["type","date","formControlName","finPromoCantidad"],["formGroupName","promoDeTemporada",1,"edit-seccion"],[2,"margin-left","1.5rem"],["type","number","formControlName","porcentaje",2,"width","60px"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["type","checkbox","formControlName","monedero"],["formGroupName","promosPorDia"],[4,"ngFor","ngForOf"],[1,"modal-buttons"],[1,"btn-rojo-chico",3,"click"],[1,"btn-verde-chico","btn-right",3,"click","disabled"],[1,"edit-seccion",3,"formGroupName"],["type","text","formControlName","lote"],["type","date","formControlName","fechaCaducidad"],["type","number","formControlName","cantidad",2,"width","5rem"],["type","button",1,"btn-rojo-chico",3,"click"],[1,"row","promo-dia",3,"formGroupName"],[1,"col-2"],[1,"col-3"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h3",2),c(3,"Almacen editar producto"),r(),a(4,"form",3)(5,"div",4)(6,"label"),c(7,"Nombre:"),r(),f(8,"input",5),a(9,"label"),c(10,"Cod. Barras:"),r(),f(11,"input",6),r(),a(12,"div",4)(13,"label"),c(14,"Categor\xEDa:"),r(),f(15,"input",7),a(16,"label"),c(17,"Stock Minimo:"),r(),f(18,"input",8),a(19,"label"),c(20,"Stock Maximo:"),r(),f(21,"input",9),r(),a(22,"div",4)(23,"label"),c(24,"IVA:"),r(),f(25,"input",10),a(26,"label"),c(27,"INAPAM:"),r(),f(28,"input",11),a(29,"label"),c(30,"Costo:"),r(),f(31,"input",12),a(32,"label"),c(33,"Precio:"),r(),f(34,"input",13),a(35,"label"),c(36,"Ubicaci\xF3n"),r(),f(37,"input",14),r(),a(38,"div",15)(39,"label",16),c(40,"Lotes:"),r(),S(41,Sh,12,1,"div",17),a(42,"div",18)(43,"button",19),g("click",function(){return i.agregarLote()}),c(44,"Agregar Lote"),r()()(),a(45,"label",16),c(46,"Promociones:"),r(),a(47,"div",4)(48,"label",16),c(49,"Cantidad Requerida:"),r(),a(50,"label",20),c(51,"Tipo:"),r(),a(52,"select",21)(53,"option",22),c(54,"--"),r(),a(55,"option",22),c(56,"2x1"),r(),a(57,"option",22),c(58,"3x2"),r(),a(59,"option",22),c(60,"4x3"),r()(),a(61,"label"),c(62,"Inicio:"),r(),f(63,"input",23),a(64,"label"),c(65,"Fin:"),r(),f(66,"input",24),r(),a(67,"div",25)(68,"label",16),c(69,"Temporada:"),r(),a(70,"label",26),c(71,"% desc.:"),r(),f(72,"input",27),a(73,"label"),c(74,"Inicio:"),r(),f(75,"input",28),a(76,"label"),c(77,"Fin:"),r(),f(78,"input",29),a(79,"label"),c(80,"Monedero:"),r(),f(81,"input",30),r(),a(82,"div",31),S(83,Eh,21,2,"div",32),r()(),a(84,"div",33)(85,"button",34),g("click",function(){return i.cerrarModal()}),c(86,"Cancelar"),r(),a(87,"button",35),g("click",function(){return i.guardarProducto()}),c(88,"Guardar"),r()()()()),e&2&&(l(4),m("formGroup",i.formulario),l(37),m("ngForOf",i.lotesFormArray.controls),l(12),m("ngValue",null),l(2),m("ngValue",2),l(2),m("ngValue",3),l(2),m("ngValue",4),l(24),m("ngForOf",Ke(8,xh)),l(4),m("disabled",!i.formOkSinLotes()))},dependencies:[j,Y,De,ke,ce,de,ie,Ae,at,le,Z,Oe,Ye,Xe,Vo,oc,me],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#8dfaf7;padding:20px;border-radius:8px;width:1000px;max-height:90vh;overflow-y:auto;box-shadow:0 5px 15px #0000004d;font-size:medium;display:flex;justify-content:space-between}.subtitulo-edit[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.edit-seccion[_ngcontent-%COMP%]{margin-bottom:.5rem}.edit-seccion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.edit-seccion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:3rem}.promo-dia[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.modal-buttons[_ngcontent-%COMP%]{display:flex;margin-left:2rem;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}"]})};var _r=class o{constructor(t,e){this.overlay=t;this.injector=e}overlayRef;abrirModal(t,e){if(this.overlayRef)return;this.overlayRef=this.overlay.create({hasBackdrop:!0,backdropClass:"cdk-overlay-dark-backdrop",positionStrategy:this.overlay.position().global().centerHorizontally().centerVertically()});let i=new Qc(gr,null,this.crearInjector(t,e)),n=this.overlayRef.attach(i);this.overlayRef.backdropClick().subscribe(()=>this.cerrarModal()),n.instance.cerrar.subscribe(()=>this.cerrarModal()),n.instance.guardar.subscribe(s=>{e(s),this.cerrarModal()})}crearInjector(t,e){return tn.create({providers:[{provide:"PRODUCTO_DATA",useValue:t},{provide:"GUARDAR_CALLBACK",useValue:e}],parent:this.injector})}cerrarModal(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=void 0)}static \u0275fac=function(e){return new(e||o)(he(un),he(tn))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ph=["backdrop"],Ih=["firstInput"],Dd=o=>({"selected-radio":o}),br=(o,t,e)=>({bi:!0,"bi-caret-up-fill":o,"bi-caret-down-fill":t,"bi-caret-up":e});function Mh(o,t){if(o&1){let e=I();a(0,"button",82),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("nombre"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Th(o,t){if(o&1){let e=I();a(0,"button",83),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("codigoBarras"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Oh(o,t){if(o&1){let e=I();a(0,"button",84),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("categoria"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function kh(o,t){if(o&1){let e=I();a(0,"button",85),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("descuentoINAPAM"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Dh(o,t){if(o&1){let e=I();a(0,"button",86),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("generico"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Fh(o,t){if(o&1){let e=I();a(0,"button",87),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("bajoStock"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Rh(o,t){o&1&&f(0,"i",88)}function Ah(o,t){if(o&1){let e=I();a(0,"button",89),g("click",function(){b(e);let n=u();return v(n.limpiarFiltro("duplicadosCB"))}),f(1,"fa-icon",7),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Vh(o,t){if(o&1&&(a(0,"div")(1,"div",90)(2,"div",91)(3,"label",92),c(4),r()(),a(5,"div",91)(6,"label",42),c(7,"% Desc.:"),r(),f(8,"input",93),r(),a(9,"div",94)(10,"label",42),c(11,"Inicia:"),r(),f(12,"input",95),r(),a(13,"div",94)(14,"label",42),c(15,"Termina:"),r(),f(16,"input",96),r(),a(17,"div",91)(18,"label",42),c(19,"Monedero:"),r(),a(20,"select",97)(21,"option",22),c(22,"--"),r(),a(23,"option",22),c(24,"S\xED"),r(),a(25,"option",22),c(26,"No"),r()()()()()),o&2){let e=t.$implicit;l(),m("formGroupName","promo"+e),l(3),x("Promo ",e,":"),l(17),m("ngValue",null),l(2),m("ngValue",!0),l(2),m("ngValue",!1)}}function Nh(o,t){o&1&&(a(0,"span",115),f(1,"i",116),r())}function Bh(o,t){o&1&&(a(0,"span",115),f(1,"i",117),r())}function Lh(o,t){if(o&1&&(a(0,"small",118),c(1),r()),o&2){let e=u().$implicit;l(),_(e.ubicacion)}}function jh(o,t){o&1&&f(0,"i",119)}function Uh(o,t){o&1&&f(0,"i",117)}function $h(o,t){if(o&1){let e=I();a(0,"tr")(1,"td")(2,"input",98),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s.seleccionado,n)||(s.seleccionado=n),v(n)}),r()(),a(3,"td")(4,"div",99)(5,"button",100),g("click",function(){b(e);let n=$e(12);return v(n.click())}),a(6,"img",101),g("error",function(n){let s=b(e).$implicit,d=u();return v(d.onImgError(n,s))}),r(),S(7,Nh,2,0,"span",102)(8,Bh,2,0,"span",102),r(),a(9,"button",103),g("click",function(n){let s=b(e).$implicit,d=u();return n.stopPropagation(),v(d.openPreview(s))}),f(10,"i",104),r(),a(11,"input",105,0),g("change",function(n){let s=b(e).$implicit,d=u();return v(d.onFileChange(n,s))}),r()()(),a(13,"td",106)(14,"div",107),c(15),r(),S(16,Lh,2,1,"small",108),r(),a(17,"td"),c(18),r(),a(19,"td"),c(20),r(),a(21,"td",109),f(22,"input",110),r(),a(23,"td"),c(24),r(),a(25,"td"),c(26),r(),a(27,"td"),c(28),r(),a(29,"td",109),f(30,"input",110),r(),a(31,"td"),c(32),y(33,"currency"),r(),a(34,"td"),c(35),y(36,"currency"),r(),a(37,"td")(38,"button",111),g("click",function(){let n=b(e).$implicit,s=u();return v(s.editarProducto(n))}),f(39,"fa-icon",7),r(),a(40,"button",112),g("click",function(){let n=b(e).$implicit,s=u();return v(s.confirmarEliminar(n))}),S(41,jh,1,0,"i",113)(42,Uh,1,0,"i",114),r()()()}if(o&2){let e=t.$implicit,i=u();G("fila-modificada",e.modificado),l(2),T("ngModel",e.seleccionado),l(2),G("loading",i.subiendoId===e._id),l(),m("disabled",i.subiendoId===e._id),te("aria-label",e.imagen?"Cambiar imagen":"Agregar imagen"),l(),m("src",e._imgSrc,Ni),l(),m("ngIf",i.subiendoId!==e._id),l(),m("ngIf",i.subiendoId===e._id),l(),m("disabled",i.subiendoId===e._id),l(6),_(e.nombre),l(),m("ngIf",e.ubicacion),l(2),_(e.codigoBarras),l(2),_(e.categoria),l(2),m("checked",e.generico),l(2),_(e.stockMinimo),l(2),_(e.stockMaximo),l(),G("text-danger",i.getExistencia(e)<(e.stockMinimo||0)),l(),x(" ",i.getExistencia(e)," "),l(2),m("checked",e.descuentoINAPAM),l(2),_(M(33,28,e.costo)),l(3),_(M(36,30,e.precio)),l(4),m("icon","pen"),l(),m("disabled",i.eliminandoId===e._id),l(),m("ngIf",i.eliminandoId!==e._id),l(),m("ngIf",i.eliminandoId===e._id)}}function Hh(o,t){if(o&1){let e=I();a(0,"div",120,1),g("keydown.escape",function(){b(e);let n=u();return v(n.cerrarNuevoProducto())}),a(2,"div",121),g("mousedown",function(n){return b(e),v(n.stopPropagation())})("click",function(n){return b(e),v(n.stopPropagation())}),a(3,"h3",122),c(4,"Nuevo producto"),r(),a(5,"form",123)(6,"div",124)(7,"div",125)(8,"label"),c(9,"Nombre *"),r(),f(10,"input",126,2),r(),a(12,"div",94)(13,"label"),c(14,"C\xF3digo de barras *"),r(),f(15,"input",127),r(),a(16,"div",94)(17,"label"),c(18,"Categor\xEDa *"),r(),f(19,"input",128),r(),a(20,"div",91)(21,"label"),c(22,"Unidad *"),r(),f(23,"input",129),r(),a(24,"div",91)(25,"label"),c(26,"Precio *"),r(),f(27,"input",130),r(),a(28,"div",91)(29,"label"),c(30,"Costo *"),r(),f(31,"input",131),r(),a(32,"div",91)(33,"label"),c(34,"Stock M\xEDn *"),r(),f(35,"input",132),r(),a(36,"div",91)(37,"label"),c(38,"Stock M\xE1x *"),r(),f(39,"input",133),r(),a(40,"div",134)(41,"label",135),c(42,"IVA"),r(),f(43,"input",136),r(),a(44,"div",134)(45,"label",137),c(46,"Gen\xE9rico"),r(),f(47,"input",138),r(),a(48,"div",134)(49,"label",139),c(50,"INAPAM"),r(),f(51,"input",140),r(),a(52,"div",91)(53,"label"),c(54,"Ubicaci\xF3n"),r(),f(55,"input",141),r()()(),a(56,"div",63)(57,"button",142),g("click",function(){b(e);let n=u();return v(n.cerrarNuevoProducto())}),c(58,"Cancelar"),r(),a(59,"button",143),g("click",function(){b(e);let n=u();return v(n.guardarNuevoProducto())}),c(60),r()()()()}if(o&2){let e=u();l(5),m("formGroup",e.nuevoProductoForm),l(54),m("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),l(),x(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var vr=class o{constructor(t,e,i,n,s,d){this.fb=t;this.cdr=e;this.modalService=i;this.productoService=n;this.renderer=d;s.addIcons(Lo,ct,Ut)}backdrop;firstInput;columnaOrden="";productos=[];productosFiltrados=[];formularioMasivo;filtrando=!1;iniciando=!1;filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1};paginaActual=1;tamanioPagina=15;direccionOrden="asc";diasSemana=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];faTimes=ct;faPlus=Ut;mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;eliminandoId=null;placeholderSrc="assets/images/farmBienIcon.png";ngOnInit(){this.iniciando=!0,this.inicializarFormulario(),this.cargarProductos(!0),this.iniciando=!1,this.formularioMasivo.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.formularioMasivo.get("promosPorDia")?.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.nuevoProductoForm=this.fb.group({nombre:["",[B.required,B.minLength(3)]],codigoBarras:["",B.required],unidad:["",B.required],precio:[null,[B.required,B.min(0)]],costo:[null,[B.required,B.min(0)]],iva:[!1],stockMinimo:[50,[B.required,B.min(0)]],stockMaximo:[100,[B.required,B.min(0)]],ubicacion:[""],categoria:["",B.required],generico:[!1],descuentoINAPAM:[!1]})}inicializarFormulario(){let t={};this.diasSemana.forEach(e=>{t["promo"+e]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[null]})}),this.formularioMasivo=this.fb.group({categoria:[null],descuentoINAPAM:[null],stockMinimo:[null],stockMaximo:[null],ajustePrecioModo:[null],ajustePrecioPorcentaje:[null],ajustePrecioCantidad:[null],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporadaPorcentaje:[null],promoDeTemporadaInicio:[null],promoDeTemporadaFin:[null],promoDeTemporadaMonedero:[null],promosPorDia:this.fb.group(t)})}cargarProductos(t){this.productoService.obtenerProductos().subscribe({next:e=>{this.productos=(e||[]).map(i=>qe(ae({},i),{_imgSrc:i?.imagen?this.productoService.obtenerImagenProductoUrl(i._id):this.placeholderSrc})),this.recomputarCBDuplicados(),t&&(this.filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1}),this.aplicarFiltros()},error:e=>console.error("Error al cargar productos:",e)})}aplicarFiltros(){this.filtrando||this.iniciando||(this.filtrando=!0,this.cdr.detectChanges(),setTimeout(()=>{let t=this.filtros;this.productosFiltrados=(this.productos||[]).filter(e=>{let i=t.nombre?(e.nombre||"").toLowerCase().includes(t.nombre.toLowerCase()):!0,n=t.codigoBarras?(e.codigoBarras||"").toLowerCase().includes(t.codigoBarras.toLowerCase()):!0,s=t.categoria?(e.categoria||"").toLowerCase().includes(t.categoria.toLowerCase()):!0,d=t.descuentoINAPAM===null?!0:e.descuentoINAPAM===t.descuentoINAPAM,p=t.generico===null?!0:e.generico===t.generico,h=t.bajoStock?this.getExistencia(e)<(e.stockMinimo??0):!0,C=t.duplicadosCB?this.cbDuplicados.has(this.normCB(e?.codigoBarras)):!0;return i&&n&&s&&d&&p&&h&&C}),this.paginaActual=1,this.filtrando=!1},0))}cbDuplicados=new Set;normCB(t){return String(t??"").trim().toLowerCase()}recomputarCBDuplicados(){let t=new Map;for(let e of this.productos||[]){let i=this.normCB(e?.codigoBarras);i&&t.set(i,(t.get(i)||0)+1)}this.cbDuplicados=new Set([...t.entries()].filter(([,e])=>e>1).map(([e])=>e))}limpiarFiltro(t){t==="descuentoINAPAM"&&(this.filtros[t]=null),t==="generico"&&(this.filtros[t]=null),t==="bajoStock"&&(this.filtros.bajoStock=!1),t==="duplicadosCB"&&(this.filtros.duplicadosCB=!1),(t==="nombre"||t==="categoria"||t==="codigoBarras")&&(this.filtros[t]=""),this.aplicarFiltros()}get totalPaginas(){return Math.ceil(this.productosFiltrados.length/this.tamanioPagina)}get productosPagina(){let t=(this.paginaActual-1)*this.tamanioPagina;return this.productosFiltrados.slice(t,t+this.tamanioPagina)}limpiarCamposCambioMasivo(){this.formularioMasivo.reset()}aplicarCambiosMasivos(){let t=this.formularioMasivo.value,e=this.productosFiltrados.filter(i=>i.seleccionado);if(e.length===0){je.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"Debes seleccionar al menos un producto para aplicar los cambios..",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}e.forEach(i=>{if(Object.keys(t).forEach(s=>{t[s]!==null&&!["ajustePrecioModo","ajustePrecioPorcentaje","ajustePrecioCantidad"].includes(s)&&s!=="promosPorDia"&&(i[s]=t[s])}),t.ajustePrecioModo==="porcentaje"&&t.ajustePrecioPorcentaje!=null){let s=t.ajustePrecioPorcentaje,d=i.precio+i.precio*(s/100);i.precio=parseFloat(d.toFixed(2))}if(t.ajustePrecioModo==="cantidad"&&t.ajustePrecioCantidad!=null){let s=t.ajustePrecioCantidad,d=i.precio+s;i.precio=parseFloat(d.toFixed(2))}(t.promoDeTemporadaPorcentaje!=null||t.promoDeTemporadaInicio!=null||t.promoDeTemporadaFin!=null||t.promoDeTemporadaMonedero!=null)&&(i.promoDeTemporada={porcentaje:t.promoDeTemporadaPorcentaje??0,inicio:new Date(t.promoDeTemporadaInicio),fin:new Date(t.promoDeTemporadaFin),monedero:t.promoDeTemporadaMonedero??!1});let n=t.promosPorDia;this.diasSemana.forEach(s=>{let d=n[`promo${s}`];(d?.porcentaje!=null||d?.inicio!=null||d?.fin!=null||d?.monedero!=null)&&(i["promo"+s]={porcentaje:d.porcentaje??0,inicio:d.inicio?new Date(d.inicio):null,fin:d.fin?new Date(d.fin):null,monedero:d.monedero??!1})}),i.modificado=!0}),this.formularioMasivo.reset(),this.grabarCambios()}get promosPorDiaForm(){return this.formularioMasivo.get("promosPorDia")}get cambiosMasivosValidos(){let t=this.formularioMasivo.value,{categoria:e,stockMinimo:i,stockMaximo:n,descuentoINAPAM:s,ajustePrecioModo:d,ajustePrecioPorcentaje:p,ajustePrecioCantidad:h,promoCantidadRequerida:C,inicioPromoCantidad:E,finPromoCantidad:D,promoDeTemporadaPorcentaje:R,promoDeTemporadaInicio:N,promoDeTemporadaFin:A,promoDeTemporadaMonedero:U}=t;return!(!(e!=null||i!=null||n!=null||s!=null||d!=null||C!=null||E!=null||D!=null||R!=null||N!=null||A!=null||U!=null||this.hayCambiosEnPromosPorDia())||d==="porcentaje"&&(p==null||isNaN(p))||d==="cantidad"&&(h==null||isNaN(h))||C!=null&&(!E||!D||new Date(E)>new Date(D))||(R!=null||N!=null||A!=null||U!=null)&&(R==null||isNaN(R)||R<=0||R>100||!N||!A||new Date(N)>new Date(A))||!this.validarPromosPorDia())}hayCambiosEnPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;return t?this.diasSemana.some(e=>{let i=t["promo"+e];return i?.porcentaje!=null||i?.inicio!=null||i?.fin!=null||i?.monedero!=null}):!1}validarPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;if(!t)return!0;for(let e of this.diasSemana){let i=t[`promo${e}`];if(!i)continue;let{porcentaje:n,inicio:s,fin:d}=i;if((n!=null||s!=null||d!=null)&&(!s||!d||new Date(s)>new Date(d)||n==null||isNaN(n)||n<=0||n>100))return!1}return!0}seleccionarTodos(t){let e=t.target.checked;this.productosFiltrados.forEach(i=>i.seleccionado=e)}editarProducto(t){let e=JSON.parse(JSON.stringify(t));this.modalService.abrirModal(e,i=>{this.guardarProductoEditado(i)})}guardarProductoEditado(t){console.log("producto actualizado en ajustes-inventario =====>",t);let e=t._id,i=ae({},t);delete i._id,delete i.__v,delete i.createdAt,delete i.updatedAt,["precioVenta","costo","existencia","iva","minimo","maximo"].forEach(n=>{i[n]!==void 0&&i[n]!==null&&(i[n]=Number(i[n])||0)}),this.productoService.actualizarProductoIndividual(e,i).subscribe({next:()=>{je.default.fire({icon:"success",title:"\xC9xito",text:"Producto actualizado correctamente",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:n=>{let s=n?.error?.mensaje||n?.error?.message||n?.message||"No se pudo actualizar el producto";je.default.fire("Error",s,"error"),console.error("[actualizarProducto][ERROR]",n)}})}grabarCambios(){try{let t=this.productos.filter(e=>e.seleccionado);if(!t||t.length===0){je.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"No hay productos seleccionados para actualizar.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}je.default.fire({title:"\xBFDeseas guardar los cambios?",html:`Se actualizar\xE1n <b>${t.length}</b> productos.`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, guardar",cancelButtonText:"Cancelar",heightAuto:!1}).then(e=>{e.isConfirmed&&(je.default.fire({title:"Guardando...",allowOutsideClick:!1,allowEscapeKey:!1,heightAuto:!1,didOpen:()=>je.default.showLoading()}),this.productoService.actualizarProductos({productos:t}).subscribe({next:()=>{je.default.close(),je.default.fire({icon:"success",title:"Actualizaci\xF3n exitosa",text:"Los productos fueron actualizados correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1),this.productos.forEach(i=>i.seleccionado=!1),this.formularioMasivo.reset(),this.aplicarFiltros()},error:i=>{console.error("[grabarCambios] error HTTP:",i),je.default.close(),je.default.fire({icon:"error",title:"Error",text:i?.error?.mensaje||"Ocurri\xF3 un error inesperado al actualizar los productos."})}}))})}catch(t){console.error("[grabarCambios] excepci\xF3n:",t),je.default.fire({icon:"error",title:"Error",text:"Hubo un problema al preparar la actualizaci\xF3n."})}}ordenar(t){this.columnaOrden===t?this.direccionOrden=this.direccionOrden==="asc"?"desc":"asc":(this.columnaOrden=t,this.direccionOrden="asc"),this.productosFiltrados.sort((e,i)=>{let n=t==="existencia"?this.getExistencia(e):e?.[t],s=t==="existencia"?this.getExistencia(i):i?.[t],d=typeof n=="number"&&!isNaN(n),p=typeof s=="number"&&!isNaN(s),h;if(d&&p)h=n-s;else{let C=(n??"").toString().toLowerCase(),E=(s??"").toString().toLowerCase();h=C<E?-1:C>E?1:0}return this.direccionOrden==="asc"?h:-h}),this.paginaActual=1}getExistencia(t){return Array.isArray(t?.lotes)?t.lotes.reduce((e,i)=>e+(Number(i?.cantidad)||0),0):0}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){je.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,je.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:e=>{this.guardandoNuevo=!1,console.error(e),je.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let i=e[0],n=e[e.length-1],s=document.activeElement;t.shiftKey&&s===i?(n.focus(),t.preventDefault()):!t.shiftKey&&s===n&&(i.focus(),t.preventDefault())}confirmarEliminar(t){return Q(this,null,function*(){let{isConfirmed:e}=yield je.default.fire({icon:"warning",title:"Eliminar producto",html:`
        <p>Se eliminar\xE1 <strong>${t?.nombre||""}</strong>.</p>
        <p class="text-danger">Tambi\xE9n se eliminar\xE1 de <strong>todas las farmacias</strong>.</p>
        <p>Esta acci\xF3n no se puede deshacer.</p>
      `,showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,focusCancel:!0});if(e)try{this.eliminandoId=t._id;let i=yield Ct(this.productoService.eliminarProducto(t._id));this.productos=(this.productos||[]).filter(n=>n._id!==t._id),typeof this.recomputarCBDuplicados=="function"&&this.recomputarCBDuplicados(),this.aplicarFiltros(),je.default.fire("Eliminado",i?.mensaje||"Producto eliminado correctamente","success")}catch(i){let n=i?.error?.mensaje||i?.message||"No se pudo eliminar el producto";je.default.fire("Error",n,"error")}finally{this.eliminandoId=null}})}subiendoId=null;imgCacheBuster={};imageUrl(t){if(!t?._id)return"";let e=this.productoService.obtenerImagenProductoUrl(t._id),i=this.imgCacheBuster[t._id]||0;return i?`${e}?t=${i}`:e}onImgError(t,e){t.target.src=this.placeholderSrc,e&&(e.imagen=!1)}onFileChange(t,e){let i=t.target,n=i.files&&i.files[0];i.value="",n&&this.onPickImage(n,e)}onPickImage(t,e){return Q(this,null,function*(){if(!t||!e?._id)return;let i=yield new Promise((s,d)=>{let p=new FileReader;p.onload=()=>s(String(p.result)),p.onerror=d,p.readAsDataURL(t)}),{isConfirmed:n}=yield je.default.fire({title:e.imagen?"\xBFReemplazar imagen?":"\xBFSubir imagen?",html:`<img src="${i}" style="max-width:100%;max-height:240px;border-radius:8px;">`,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"});if(n)try{this.subiendoId=e._id,yield Ct(this.productoService.actualizarImagenProducto(e._id,t));let s=this.productoService.obtenerImagenProductoUrl(e._id);e._imgSrc=`${s}?t=${Date.now()}`,e.imagen=!0,je.default.fire("Listo","Imagen guardada","success")}catch(s){let d=s?.error?.mensaje||"No se pudo subir la imagen";je.default.fire("Error",d,"error")}finally{this.subiendoId=null}})}trackProdBy=(t,e)=>e?._id??e?.codigoBarras??t;openPreview(t){let e=t?.imagen?this.productoService.obtenerImagenProductoUrl(t._id):this.placeholderSrc,i=t?.imagen?`${e}?t=${Date.now()}`:e;je.default.fire({width:"auto",showConfirmButton:!1,showCloseButton:!0,background:"#000",padding:0,html:`
      <div style="max-width:90vw;max-height:90vh;display:flex;align-items:center;justify-content:center">
        <img src="${i}" alt="" style="max-width:90vw;max-height:90vh;object-fit:contain" />
      </div>`})}static \u0275fac=function(e){return new(e||o)(P(He),P(Fe),P(_r),P(It),P(st),P(on))};static \u0275cmp=V({type:o,selectors:[["app-ajuste-inventario"]],viewQuery:function(e,i){if(e&1&&(Ee(Ph,5),Ee(Ih,5)),e&2){let n;ye(n=Ce())&&(i.backdrop=n.first),ye(n=Ce())&&(i.firstInput=n.first)}},hostBindings:function(e,i){e&1&&g("keydown",function(s){return i.trapTab(s)},!1,nn)},decls:212,vars:83,consts:[["file",""],["backdrop",""],["firstInput",""],[1,"panel"],[1,"titulo-container","d-flex","justify-content-between","align-items-center"],[1,"titulo"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"row","mb-2","filtros-container"],[1,"col-md-3"],[1,"me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","text","name","nombre",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar nombre","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-2"],["type","text","name","codigoBarras",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar c\xF3d. barras","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["type","text","name","categoria",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar categor\xEDa","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-1"],["name","descuentoINAPAM",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","button","matTooltip","Limpiar INAPAM","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["name","generico",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar gen\xE9rico","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"form-check","mt-2"],["type","checkbox","id","filtroBajoStock","name","bajoStock",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroBajoStock",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro bajo stock",3,"click",4,"ngIf"],[1,"col-md-1","text-end","mt-3"],["matTooltip","Filtrar informaci\xF3n solicitada",1,"btn-gris",3,"click","disabled"],["class","fa fa-spinner fa-spin me-1",4,"ngIf"],[1,"me-2","mb-0","mt-2",2,"white-space","nowrap"],["type","checkbox","id","filtroCBDuplicados","name","duplicadosCB",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroCBDuplicados",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro de duplicados",3,"click",4,"ngIf"],[1,"masivos",3,"formGroup"],[1,"center-content"],[1,"subtitulo",2,"margin-right","10px"],[1,"container-masivos","mb-1"],[1,"tit-promo",2,"margin-right","1rem"],[2,"margin-right","10px"],["type","text","formControlName","categoria",2,"width","100px","margin-right","2rem"],["type","number","formControlName","stockMinimo",2,"width","50px","margin-right","2rem"],["type","number","formControlName","stockMaximo",2,"width","50px","margin-right","2rem"],["formControlName","descuentoINAPAM"],[1,"tit-promo",2,"margin-right","2rem"],[2,"margin-right","1rem",3,"ngClass"],["type","radio","formControlName","ajustePrecioModo","value","porcentaje"],["type","number","formControlName","ajustePrecioPorcentaje",2,"width","50px","margin-right","4rem"],["type","radio","formControlName","ajustePrecioModo","value","cantidad"],["type","number","formControlName","ajustePrecioCantidad",2,"width","50px","margin-right","5rem"],[1,"tit-promo",2,"margin-right","10px"],["formControlName","promoCantidadRequerida",2,"margin-right","1rem"],["type","date","formControlName","inicioPromoCantidad",2,"margin-right","1rem"],["type","date","formControlName","finPromoCantidad"],["type","number","formControlName","promoDeTemporadaPorcentaje",2,"width","50px","margin-right","1rem"],["type","date","formControlName","promoDeTemporadaInicio",2,"margin-right","1rem"],["type","date","formControlName","promoDeTemporadaFin",2,"margin-right","1rem"],["formControlName","promoDeTemporadaMonedero",2,"margin-right","2rem"],[2,"margin-top","10px",3,"formGroup"],[4,"ngFor","ngForOf"],[1,"modal-actions","mt-3"],["type","button","matTooltip","Borrar par\xE1metros del cambio masivo",1,"btn-rojo-chico",2,"margin-left","4rem",3,"click"],["type","button","matTooltip","Aplica cambios a los productos seleccionados en la tabla",1,"btn-verde-chico",2,"margin-right","4rem",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change"],[3,"click"],[1,"icono-orden",3,"ngClass"],[3,"fila-modificada",4,"ngFor","ngForOf","ngForTrackBy"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"total-registros"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["type","button","matTooltip","Limpiar nombre",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar categor\xEDa",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar INAPAM",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar gen\xE9rico",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Quitar filtro bajo stock",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fa","fa-spinner","fa-spin","me-1"],["type","button","matTooltip","Quitar filtro de duplicados",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"row",2,"margin-bottom","5px",3,"formGroupName"],[1,"col-2"],[1,"tit-promo",2,"margin-left","3rem"],["type","number","formControlName","porcentaje",2,"width","50px","height","20px"],[1,"col-3"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["formControlName","monedero"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"img-cell"],["type","button","matTooltip","Cambiar \xF3 Subir imagen",1,"img-button",3,"click","disabled"],["loading","lazy","decoding","async","alt","",3,"error","src"],["class","overlay",4,"ngIf"],["type","button","matTooltip","Ver imagen",1,"zoom-btn",3,"click","disabled"],[1,"fas","fa-search-plus"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"col-producto"],[1,"prod-nombre"],["class","prod-ubicacion",4,"ngIf"],[2,"text-align","center"],["type","checkbox","disabled","",3,"checked"],["matTooltip","Editar producto",1,"btn-icon-chico","btn-gris-chico",3,"click"],["matTooltip","Eliminar producto en TODAS las farmacias",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],["class","fas fa-trash",4,"ngIf"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"overlay"],[1,"fas","fa-upload"],[1,"fa","fa-spinner","fa-spin"],[1,"prod-ubicacion"],[1,"fas","fa-trash"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,i){if(e&1&&(a(0,"div",3)(1,"div",4)(2,"h1",5),c(3,"Ajuste de Inventario en Almacen"),r(),a(4,"button",6),g("click",function(){return i.abrirNuevoProducto()}),f(5,"fa-icon",7),a(6,"span",8),c(7,"Nuevo"),r()()(),a(8,"div",9)(9,"div",10)(10,"label",11),c(11,"Nombre"),r(),a(12,"div",12)(13,"input",13),k("ngModelChange",function(s){return O(i.filtros.nombre,s)||(i.filtros.nombre=s),s}),r(),S(14,Mh,2,1,"button",14),r()(),a(15,"div",15)(16,"label",11),c(17,"C\xF3digo de barras"),r(),a(18,"div",12)(19,"input",16),k("ngModelChange",function(s){return O(i.filtros.codigoBarras,s)||(i.filtros.codigoBarras=s),s}),r(),S(20,Th,2,1,"button",17),r()(),a(21,"div",15)(22,"label",11),c(23,"Categor\xEDa"),r(),a(24,"div",12)(25,"input",18),k("ngModelChange",function(s){return O(i.filtros.categoria,s)||(i.filtros.categoria=s),s}),r(),S(26,Oh,2,1,"button",19),r()(),a(27,"div",20)(28,"label",11),c(29,"INAPAM"),r(),a(30,"div",12)(31,"select",21),k("ngModelChange",function(s){return O(i.filtros.descuentoINAPAM,s)||(i.filtros.descuentoINAPAM=s),s}),a(32,"option",22),c(33,"--"),r(),a(34,"option",22),c(35,"S\xED"),r(),a(36,"option",22),c(37,"No"),r()(),S(38,kh,2,1,"button",23),r()(),a(39,"div",20)(40,"label",11),c(41,"Gen\xE9rico?"),r(),a(42,"div",12)(43,"select",24),k("ngModelChange",function(s){return O(i.filtros.generico,s)||(i.filtros.generico=s),s}),a(44,"option",22),c(45,"--"),r(),a(46,"option",22),c(47,"S\xED"),r(),a(48,"option",22),c(49,"No"),r()(),S(50,Dh,2,1,"button",25),r()(),a(51,"div",15)(52,"label",11),c(53,"Solo bajo stock"),r(),a(54,"div",12)(55,"div",26)(56,"input",27),k("ngModelChange",function(s){return O(i.filtros.bajoStock,s)||(i.filtros.bajoStock=s),s}),g("change",function(){return i.aplicarFiltros()}),r(),a(57,"label",28),c(58," Existencia < Stock M\xEDn. "),r()(),S(59,Fh,2,1,"button",29),r()(),a(60,"div",30)(61,"button",31),g("click",function(){return i.aplicarFiltros()}),S(62,Rh,1,0,"i",32),c(63),r()(),a(64,"div",15)(65,"label",33),c(66,"C\xF3digo Barras"),r(),a(67,"div",12)(68,"div",26)(69,"input",34),k("ngModelChange",function(s){return O(i.filtros.duplicadosCB,s)||(i.filtros.duplicadosCB=s),s}),g("change",function(){return i.aplicarFiltros()}),r(),a(70,"label",35),c(71," Mostrar duplicados "),r()(),S(72,Ah,2,1,"button",36),r()()(),a(73,"form",37)(74,"div",38)(75,"label",39),c(76,"Cambio masivo"),r(),a(77,"label"),c(78,"(aplica a productos seleccionados en la tabla)"),r()(),a(79,"div",40)(80,"div")(81,"label",41),c(82,"Datos b\xE1sicos:"),r(),a(83,"label",42),c(84,"Categor\xEDa:"),r(),f(85,"input",43),a(86,"label",42),c(87,"Stock M\xEDnimo:"),r(),f(88,"input",44),a(89,"label",42),c(90,"Stock M\xE1ximo:"),r(),f(91,"input",45),a(92,"label",42),c(93,"INAPAM:"),r(),a(94,"select",46)(95,"option",22),c(96,"--"),r(),a(97,"option",22),c(98,"S\xED"),r(),a(99,"option",22),c(100,"No"),r()()(),a(101,"div")(102,"label",47),c(103,"Aumentar o disminuir Precios:"),r(),a(104,"label",48),f(105,"input",49),c(106,"Porcentaje "),r(),a(107,"label",42),c(108,"%:"),r(),f(109,"input",50),a(110,"label",48),f(111,"input",51),c(112,"Cantidad "),r(),a(113,"label",42),c(114,"$:"),r(),f(115,"input",52),r()(),a(116,"div")(117,"div",40)(118,"div")(119,"label",53),c(120,"Promo Cantidad Requerida:"),r(),a(121,"select",54)(122,"option",22),c(123,"--"),r(),a(124,"option",22),c(125,"2x1"),r(),a(126,"option",22),c(127,"3x2"),r(),a(128,"option",22),c(129,"4x3"),r()(),a(130,"label",42),c(131,"Inicia:"),r(),f(132,"input",55),a(133,"label",42),c(134,"Termina:"),r(),f(135,"input",56),r(),a(136,"div")(137,"label",53),c(138,"Promo Temporada:"),r(),a(139,"label",42),c(140,"% Desc.:"),r(),f(141,"input",57),a(142,"label",42),c(143,"Inicia:"),r(),f(144,"input",58),a(145,"label",42),c(146,"Termina:"),r(),f(147,"input",59),a(148,"label",42),c(149,"Monedero:"),r(),a(150,"select",60)(151,"option",22),c(152,"--"),r(),a(153,"option",22),c(154,"S\xED"),r(),a(155,"option",22),c(156,"No"),r()()()(),a(157,"div",61),S(158,Vh,27,5,"div",62),r()(),a(159,"div",63)(160,"button",64),g("click",function(){return i.limpiarCamposCambioMasivo()}),c(161,"Cancelar "),r(),a(162,"button",65),g("click",function(){return i.aplicarCambiosMasivos()}),c(163," Aplicar Cambios "),r()()(),a(164,"table",66)(165,"thead")(166,"tr")(167,"th")(168,"input",67),g("change",function(s){return i.seleccionarTodos(s)}),r()(),a(169,"th"),c(170,"Imagen"),r(),a(171,"th",68),g("click",function(){return i.ordenar("nombre")}),c(172," Nombre / Ubic. "),f(173,"i",69),r(),a(174,"th",68),g("click",function(){return i.ordenar("codigoBarras")}),c(175," C\xF3digo Barras "),f(176,"i",69),r(),a(177,"th",68),g("click",function(){return i.ordenar("categoria")}),c(178," Categor\xEDa "),f(179,"i",69),r(),a(180,"th"),c(181,"Gen\xE9rico"),r(),a(182,"th"),c(183,"Stock M\xEDn."),r(),a(184,"th"),c(185,"Stock M\xE1x."),r(),a(186,"th",68),g("click",function(){return i.ordenar("existencia")}),c(187," Existencia "),f(188,"i",69),r(),a(189,"th"),c(190,"INAPAM"),r(),a(191,"th"),c(192,"Costo"),r(),a(193,"th"),c(194,"Precio"),r(),a(195,"th"),c(196,"Acciones"),r()()(),a(197,"tbody"),S(198,$h,43,32,"tr",70),r()(),a(199,"div",71)(200,"button",72),g("click",function(){return i.paginaActual=1}),f(201,"i",73),r(),a(202,"button",74),g("click",function(){return i.paginaActual=i.paginaActual-1}),f(203,"i",75),r(),c(204),a(205,"span",76),c(206),r(),a(207,"button",77),g("click",function(){return i.paginaActual=i.paginaActual+1}),f(208,"i",78),r(),a(209,"button",79),g("click",function(){return i.paginaActual=i.totalPaginas}),f(210,"i",80),r()(),S(211,Hh,61,3,"div",81),r()),e&2){let n,s,d,p,h,C;l(5),m("icon",i.faPlus),l(8),T("ngModel",i.filtros.nombre),l(),m("ngIf",i.filtros.nombre),l(5),T("ngModel",i.filtros.codigoBarras),l(),m("ngIf",i.filtros.codigoBarras),l(5),T("ngModel",i.filtros.categoria),l(),m("ngIf",i.filtros.categoria),l(5),T("ngModel",i.filtros.descuentoINAPAM),l(),m("ngValue",null),l(2),m("ngValue",!0),l(2),m("ngValue",!1),l(2),m("ngIf",i.filtros.descuentoINAPAM!==null),l(5),T("ngModel",i.filtros.generico),l(),m("ngValue",null),l(2),m("ngValue",!0),l(2),m("ngValue",!1),l(2),m("ngIf",i.filtros.generico!==null),l(6),T("ngModel",i.filtros.bajoStock),l(3),m("ngIf",i.filtros.bajoStock),l(2),m("disabled",i.filtrando||i.iniciando),te("aria-busy",i.filtrando||i.iniciando),l(),m("ngIf",i.filtrando||i.iniciando),l(),x(" ",i.filtrando?"Filtrando\u2026":i.iniciando?"Iniciando\u2026":"Buscar"," "),l(6),T("ngModel",i.filtros.duplicadosCB),l(3),m("ngIf",i.filtros.duplicadosCB),l(),m("formGroup",i.formularioMasivo),l(22),m("ngValue",null),l(2),m("ngValue",!0),l(2),m("ngValue",!1),l(5),m("ngClass",nt(63,Dd,((n=i.formularioMasivo.get("ajustePrecioModo"))==null?null:n.value)==="porcentaje")),l(3),G("disabled-label",((s=i.formularioMasivo.get("ajustePrecioModo"))==null?null:s.value)!="porcentaje"),l(2),G("disabled-label",((d=i.formularioMasivo.get("ajustePrecioModo"))==null?null:d.value)!="porcentaje"),l(),m("ngClass",nt(65,Dd,((p=i.formularioMasivo.get("ajustePrecioModo"))==null?null:p.value)==="cantidad")),l(3),G("disabled-label",((h=i.formularioMasivo.get("ajustePrecioModo"))==null?null:h.value)!="cantidad"),l(2),G("disabled-label",((C=i.formularioMasivo.get("ajustePrecioModo"))==null?null:C.value)!="cantidad"),l(7),m("ngValue",null),l(2),m("ngValue",2),l(2),m("ngValue",3),l(2),m("ngValue",4),l(23),m("ngValue",null),l(2),m("ngValue",!0),l(2),m("ngValue",!1),l(2),m("formGroup",i.promosPorDiaForm),l(),m("ngForOf",i.diasSemana),l(4),m("disabled",!i.cambiosMasivosValidos),l(11),m("ngClass",gt(67,br,i.columnaOrden==="nombre"&&i.direccionOrden==="asc",i.columnaOrden==="nombre"&&i.direccionOrden==="desc",i.columnaOrden!=="nombre")),l(3),m("ngClass",gt(71,br,i.columnaOrden==="codigoBarras"&&i.direccionOrden==="asc",i.columnaOrden==="codigoBarras"&&i.direccionOrden==="desc",i.columnaOrden!=="codigoBarras")),l(3),m("ngClass",gt(75,br,i.columnaOrden==="categoria"&&i.direccionOrden==="asc",i.columnaOrden==="categoria"&&i.direccionOrden==="desc",i.columnaOrden!=="categoria")),l(9),m("ngClass",gt(79,br,i.columnaOrden==="existencia"&&i.direccionOrden==="asc",i.columnaOrden==="existencia"&&i.direccionOrden==="desc",i.columnaOrden!=="existencia")),l(10),m("ngForOf",i.productosPagina)("ngForTrackBy",i.trackProdBy),l(2),m("disabled",i.paginaActual===1),l(2),m("disabled",i.paginaActual===1),l(2),Qt(" P\xE1gina ",i.paginaActual," de ",i.totalPaginas," "),l(2),x("(",i.productosFiltrados.length," productos)"),l(),m("disabled",i.paginaActual===i.totalPaginas),l(2),m("disabled",i.paginaActual===i.totalPaginas),l(2),m("ngIf",i.mostrarNuevoProducto)}},dependencies:[j,Qe,Y,z,Re,me,ke,ce,de,ie,Ae,at,le,ln,Z,Oe,xe,De,Ye,Xe,Vo,Je,Ze,Ve,_e],styles:[".panel[_ngcontent-%COMP%]{padding:5px}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.masivos[_ngcontent-%COMP%]{font-size:small;width:100%;background-color:#b7fbe4}.center-content[_ngcontent-%COMP%]{text-align:center}.container-masivos[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.tit-promo[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.disabled-label[_ngcontent-%COMP%]{color:gray;opacity:.5;pointer-events:none}.selected-radio[_ngcontent-%COMP%]{color:#00f}.selected-checkbox[_ngcontent-%COMP%]{color:#000}.fila-modificada[_ngcontent-%COMP%]{background-color:#e6ffe6!important}.paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#0ff;background-color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .paginacion[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6;color:gray}.btn-grabar[_ngcontent-%COMP%]{text-align:center}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}.img-cell[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:30px;height:30px;padding:0;border:1px solid #e5e7eb;border-radius:6px;background:#fbfcf8;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;overflow:hidden}.img-button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;backface-visibility:hidden;-webkit-font-smoothing:antialiased}.img-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#033996;background:#bcf996}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#00000059;color:#c4fca6;opacity:0;transition:opacity .15s;pointer-events:none}.img-button[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.img-cell[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:48px;height:48px;padding:0;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;backface-visibility:hidden}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{pointer-events:none}.zoom-btn[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-6px;width:22px;height:22px;border-radius:50%;border:0;background:#0009;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;pointer-events:auto}.zoom-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;line-height:1}.zoom-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})};function zh(o,t){if(o&1&&(a(0,"span",10),c(1),r()),o&2){let e=u();l(),_(e.farmaciaNombre)}}function qh(o,t){if(o&1){let e=I();a(0,"button",11),g("click",function(){b(e);let n=u();return v(n.router.navigate(["/home"]))}),a(1,"mat-icon"),c(2,"home"),r()()}}function Wh(o,t){if(o&1){let e=I();oe(0),a(1,"button",12),g("click",function(){b(e);let n=u();return v(n.authService.showLogin())}),a(2,"mat-icon"),c(3,"login"),r()(),re()}}function Gh(o,t){if(o&1&&(a(0,"span",16),c(1),r()),o&2){let e=u(2);l(),Qt(" Bienvenido, ",e.userNombre," (",e.userRol,") ")}}function Kh(o,t){if(o&1){let e=I();a(0,"div",13),S(1,Gh,2,2,"span",14),a(2,"button",15),g("click",function(){b(e);let n=u();return v(n.authService.logout())}),a(3,"mat-icon"),c(4,"logout"),r()()()}if(o&2){let e=u();l(),m("ngIf",e.userNombre)}}var yr=class o{constructor(t,e,i){this.authService=t;this.router=e;this.ventaService=i;this.authService.userNombre$.subscribe(n=>{this.userNombre=n}),this.authService.userRol$.subscribe(n=>{this.userRol=n}),this.authService.isEditProfileVisible.subscribe(n=>{this.isEditProfileVisible=n,n&&(this.menuOpen=!1)})}isSidebarOpen=!1;toggleSidebar=new Ue;usuario=null;userNombre=null;userRol=null;farmaciaId=null;farmaciaNombre="";isEditProfileVisible=!1;menuOpen=!1;searchQuery="";mostrarInicio=!1;userLoggedOut=new Ue;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,this.userNombre=t?.nombre||null,this.userRol=t?.rol||null}),this.authService.farmacia$.subscribe(t=>{t?(this.farmaciaId=t._id,this.farmaciaNombre=t.nombre):(this.farmaciaId=null,this.farmaciaNombre="")}),this.actualizarVisibilidadInicio(),this.router.events.subscribe(()=>{this.actualizarVisibilidadInicio()})}actualizarVisibilidadInicio(){if(this.router.url==="/home"){this.mostrarInicio=!1;return}this.mostrarInicio=this.authService.isLoggedIn}irAInicio(){this.router.navigate(["/home"])}toggleMenu(){this.isEditProfileVisible||(this.menuOpen=!this.menuOpen)}logout(){this.authService.logout(),this.userLoggedOut.emit()}openChangePassword(){this.menuOpen=!1,this.authService.showChangePassword()}openUpdateProfile(){this.menuOpen=!1,this.authService.showEditProfile()}clearSearch(){this.searchQuery=""}static \u0275fac=function(e){return new(e||o)(P(Ne),P(St),P(yn))};static \u0275cmp=V({type:o,selectors:[["app-header"]],inputs:{isSidebarOpen:"isSidebarOpen"},outputs:{toggleSidebar:"toggleSidebar",userLoggedOut:"userLoggedOut"},decls:14,vars:5,consts:[["loggedInTemplate",""],[1,"header"],[1,"header-left"],[1,"toggle-sidebar-button",3,"click"],["src","assets/images/farmBienIcon.png","alt","Logo",1,"header-logo"],[1,"site-title"],["class","site-sucursal",4,"ngIf"],[1,"header-right"],["mat-icon-button","","matTooltip","Ir al inicio","class","icon-button",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"site-sucursal"],["mat-icon-button","","matTooltip","Ir al inicio",1,"icon-button",3,"click"],["mat-icon-button","","matTooltip","Iniciar sesi\xF3n",1,"icon-button",3,"click"],[1,"user-info-container",2,"display","flex","align-items","center","gap","10px"],["class","user-info",4,"ngIf"],["mat-icon-button","","matTooltip","Cerrar sesi\xF3n",1,"icon-button-exit",3,"click"],[1,"user-info"]],template:function(e,i){if(e&1){let n=I();a(0,"header",1)(1,"div",2)(2,"button",3),g("click",function(){return b(n),v(i.toggleSidebar.emit())}),a(3,"mat-icon"),c(4),r()(),f(5,"img",4),a(6,"span",5),c(7,"Farmacias del Bienestar para Todos"),r(),S(8,zh,2,1,"span",6),r(),a(9,"div",7),S(10,qh,3,0,"button",8)(11,Wh,4,0,"ng-container",9)(12,Kh,5,1,"ng-template",null,0,Mo),r()()}if(e&2){let n=$e(13);l(4),_(i.isSidebarOpen?"close":"menu"),l(4),m("ngIf",i.farmaciaNombre),l(2),m("ngIf",i.mostrarInicio),l(),m("ngIf",!i.authService.isLoggedIn)("ngIfElse",n)}},dependencies:[z,an,oi,wi,me,Ve,_e],styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 .5rem;background-color:#007bff;color:#fff;height:80px;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.toggle-sidebar-button[_ngcontent-%COMP%]{font-size:24px;margin:0;padding:0;color:#fff;background:none;border:none;cursor:pointer}.header-logo[_ngcontent-%COMP%]{height:30px;margin-right:10px}.site-title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.site-sucursal[_ngcontent-%COMP%]{font-size:20px;font-weight:500;color:#b5b5fc}a[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{padding:.5rem;border-radius:6px;border:none;width:300px}.clear-button[_ngcontent-%COMP%], .search-button[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;margin-left:5px;cursor:pointer;color:#fff}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.user-info[_ngcontent-%COMP%]{font-size:14px}.config-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#fff}.config-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;vertical-align:middle}.relative[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;box-shadow:0 4px 6px #0000001a;border-radius:5px;padding:10px 0;min-width:160px;z-index:1200;display:flex;flex-direction:column}.dropdown-item[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 15px;background:none;border:none;text-align:left;cursor:pointer;font-size:14px;transition:background .3s}.dropdown-item[_ngcontent-%COMP%]:hover{background:#f2f2f2}.dropdown-divider[_ngcontent-%COMP%]{border:0;height:1px;background-color:#ddd;margin:5px 0}.search-container[_ngcontent-%COMP%]{flex:1;max-width:600px;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{flex:1;max-width:50%;min-width:200px;padding:6px 12px;border-radius:4px;border:1px solid #ccc}.search-button[_ngcontent-%COMP%], .clear-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:5px;font-size:18px}.clear-button[_ngcontent-%COMP%]{color:#086d86;margin-right:5px}.icon-button[_ngcontent-%COMP%]{color:#9acd32;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,red,#ece6e6);color:#ff0}.icon-button-exit[_ngcontent-%COMP%]{color:#f80404;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button-exit[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#f80404,#fff);color:#ff0}@media (max-width: 768px){.user-info[_ngcontent-%COMP%]{display:none}}"]})};function Qh(o,t){if(o&1){let e=I();a(0,"li",4)(1,"span",5),g("click",function(){b(e);let n=u();return v(n.toggleMenu("catalogs"))}),c(2),r()()}if(o&2){let e=u();l(2),x(" Cat\xE1logos ",e.expandedMenu==="catalogs"?"\u25B2":"\u25B6"," ")}}function Yh(o,t){o&1&&(a(0,"ul",6)(1,"li",11),c(2," Compras "),f(3,"fa-icon",9),r(),a(4,"li",11),c(5," Surtir Farmacia "),f(6,"fa-icon",9),r(),a(7,"li",11),c(8," Ajustes inventario "),f(9,"fa-icon",9),r()()),o&2&&(l(),m("routerLink","/compras"),l(2),m("icon","truck"),l(),m("routerLink","/surtir-farmacia"),l(2),m("icon","shopping-cart"),l(),m("routerLink","/ajustes-inventario"),l(2),m("icon","file-signature"))}function Xh(o,t){if(o&1){let e=I();a(0,"li",10)(1,"span",5),g("click",function(){b(e);let n=u(2);return v(n.toggleSubMenu("almacen"))}),c(2," Almac\xE9n "),f(3,"fa-icon",9),c(4),r(),S(5,Yh,10,6,"ul",3),r()}if(o&2){let e=u(2);l(3),m("icon","warehouse"),l(),x(" ",e.expandedSubMenu==="almacen"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="almacen")}}function Zh(o,t){o&1&&(a(0,"ul",6)(1,"li",11),c(2," Mantenimiento "),f(3,"fa-icon",9),r(),a(4,"li",11),c(5," Inventario "),f(6,"fa-icon",9),r()()),o&2&&(l(),m("routerLink","/farmacias"),l(2),m("icon","truck"),l(),m("routerLink","/inventario-farmacias"),l(2),m("icon","file-signature"))}function Jh(o,t){if(o&1){let e=I();a(0,"ul",6),S(1,Xh,6,3,"li",7),a(2,"li",8),c(3,"Proveedores "),f(4,"fa-icon",9),r(),a(5,"li",10)(6,"span",5),g("click",function(){b(e);let n=u();return v(n.toggleSubMenu("farmacias"))}),c(7," Farmacias "),f(8,"fa-icon",9),c(9),r(),S(10,Zh,7,4,"ul",3),r(),a(11,"li",8),c(12,"Usuarios "),f(13,"fa-icon",9),r(),a(14,"li",8),c(15,"Clientes - reportes"),f(16,"fa-icon",9),r(),a(17,"li",8),c(18,"Cortes de caja "),f(19,"fa-icon",9),r()()}if(o&2){let e=u();l(),m("ngIf",e.userRol==="admin"),l(),m("routerLink","/proveedores"),l(2),m("icon","truck"),l(4),m("icon","warehouse"),l(),x(" ",e.expandedSubMenu==="farmacias"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="farmacias"),l(),m("routerLink","/usuarios"),l(2),m("icon","user"),l(),m("routerLink","/clientes"),l(2),m("icon","users"),l(),m("routerLink","/cortes-de-caja"),l(2),m("icon","file-signature")}}function eg(o,t){o&1&&(a(0,"li",8),c(1," Ventas "),f(2,"fa-icon",9),r()),o&2&&(m("routerLink","/ventas"),l(2),m("icon","cash-register"))}function tg(o,t){o&1&&(a(0,"li",8),c(1," Devoluciones "),f(2,"fa-icon",9),r()),o&2&&(m("routerLink","/devoluciones"),l(2),m("icon","undo"))}function ig(o,t){o&1&&(a(0,"li",8),c(1," Pedidos especiales"),f(2,"fa-icon",9),r()),o&2&&(m("routerLink","/pedidos"),l(2),m("icon","shopping-cart"))}function ng(o,t){o&1&&(a(0,"li",8),c(1," Corte de caja"),f(2,"fa-icon",9),r()),o&2&&(m("routerLink","/inicio-turno"),l(2),m("icon","file-signature"))}function og(o,t){o&1&&(a(0,"li"),c(1," Consultas m\xE9dicas "),f(2,"fa-icon",9),r()),o&2&&(l(2),m("icon","stethoscope"))}function rg(o,t){o&1&&(a(0,"li"),c(1," Recetas "),f(2,"fa-icon",9),r()),o&2&&(l(2),m("icon","prescription"))}function ag(o,t){if(o&1&&(a(0,"ul",6),S(1,eg,3,2,"li",12)(2,tg,3,2,"li",12)(3,ig,3,2,"li",12)(4,ng,3,2,"li",12)(5,og,3,1,"li",13)(6,rg,3,1,"li",13),r()),o&2){let e=u();l(),m("ngIf",e.userRol==="admin"||e.userRol==="empleado"),l(),m("ngIf",e.userRol==="admin"||e.userRol==="empleado"),l(),m("ngIf",e.userRol==="admin"||e.userRol==="empleado"),l(),m("ngIf",e.userRol==="admin"||e.userRol==="empleado"),l(),m("ngIf",e.userRol==="admin"||e.userRol==="medico"),l(),m("ngIf",e.userRol==="admin"||e.userRol==="medico")}}function sg(o,t){if(o&1){let e=I();a(0,"li",4)(1,"span",5),g("click",function(){b(e);let n=u();return v(n.toggleMenu("reports"))}),c(2),r()()}if(o&2){let e=u();l(2),x(" Reportes ",e.expandedMenu==="reports"?"\u25B2":"\u25B6"," ")}}function lg(o,t){if(o&1&&(a(0,"ul",6)(1,"li",11)(2,"span"),c(3,"Ventas"),f(4,"fa-icon",9),r()(),a(5,"li",11)(6,"span"),c(7,"Productos Ventas - Exist "),f(8,"fa-icon",9),r()(),a(9,"li",11)(10,"span"),c(11,"Un s\xF3lo producto"),f(12,"fa-icon",9),r()(),a(13,"li",11)(14,"span"),c(15,"Devoluciones ventas"),f(16,"fa-icon",9),r()(),a(17,"li",11)(18,"span"),c(19,"Pedidos"),f(20,"fa-icon",9),r()(),a(21,"li",11)(22,"span"),c(23,"Cancelaciones pedidos"),f(24,"fa-icon",9),r()()()),o&2){let e=u(3);l(),m("routerLink","reporte/ventas"),l(3),m("icon","cash-register"),l(),m("routerLink","/reporte/ventas-por-farmacia"),l(3),m("icon",e.icons.reporteVentas),l(),m("routerLink","reporte/ventas-producto"),l(3),m("icon",e.icons.faReceipt),l(),m("routerLink","reportes/devoluciones"),l(3),m("icon","undo"),l(),m("routerLink","/reporte/pedidos"),l(3),m("icon","shopping-cart"),l(),m("routerLink","reportes/cancelaciones"),l(3),m("icon","undo")}}function cg(o,t){if(o&1){let e=I();a(0,"li",10)(1,"span",5),g("click",function(){b(e);let n=u(2);return v(n.toggleSubMenu("ventas"))}),c(2," Ventas - Pedidos "),f(3,"fa-icon",9),c(4),r(),S(5,lg,25,12,"ul",3),r()}if(o&2){let e=u(2);l(3),m("icon","cash-register"),l(),x(" ",e.expandedSubMenu==="ventas"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="ventas")}}function dg(o,t){o&1&&(a(0,"ul",6)(1,"li",11)(2,"span"),c(3,"Compras general"),f(4,"fa-icon",9),r()(),a(5,"li",11)(6,"span"),c(7,"Compras resumen"),f(8,"fa-icon",9),r()(),a(9,"li",11)(10,"span"),c(11,"Compras x Producto"),f(12,"fa-icon",9),r()()()),o&2&&(l(),m("routerLink","reporte/compras"),l(3),m("icon","shopping-cart"),l(),m("routerLink","reportes-compras"),l(3),m("icon","sack-dollar"),l(),m("routerLink","reportes/compras-historial-producto"),l(3),m("icon","sack-dollar"))}function mg(o,t){if(o&1){let e=I();a(0,"li",10)(1,"span",5),g("click",function(){b(e);let n=u(2);return v(n.toggleSubMenu("compras"))}),c(2," Compras "),f(3,"fa-icon",9),c(4),r(),S(5,dg,13,6,"ul",3),r()}if(o&2){let e=u(2);l(3),m("icon","truck"),l(),x(" ",e.expandedSubMenu==="compras"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="compras")}}function pg(o,t){o&1&&(a(0,"ul",6)(1,"li",11)(2,"span"),c(3,"Resumen utilidades"),f(4,"fa-icon",9),r()(),a(5,"li",11)(6,"span"),c(7,"TOP utilidades"),f(8,"fa-icon",9),r()(),a(9,"li",11)(10,"span"),c(11,"Compras vs Ventas"),f(12,"fa-icon",9),r()()()),o&2&&(l(),m("routerLink","reporte/resumen-utilidades"),l(3),m("icon","sack-dollar"),l(),m("routerLink","reporte/utilidades"),l(3),m("icon","sack-dollar"),l(),m("routerLink","reportes/compras-ventas"),l(3),m("icon","sack-dollar"))}function ug(o,t){if(o&1){let e=I();a(0,"li",10)(1,"span",5),g("click",function(){b(e);let n=u(2);return v(n.toggleSubMenu("balance"))}),c(2," Balance "),f(3,"fa-icon",9),c(4),r(),S(5,pg,13,6,"ul",3),r()}if(o&2){let e=u(2);l(3),m("icon","scale-balanced"),l(),x(" ",e.expandedSubMenu==="balance"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="balance")}}function fg(o,t){if(o&1&&(a(0,"ul",6)(1,"li",11)(2,"span"),c(3,"Impresi\xF3n "),f(4,"fa-icon",9),r()(),a(5,"li",11)(6,"span"),c(7,"Dise\xF1o "),f(8,"fa-icon",9),r()()()),o&2){let e=u(3);l(),m("routerLink","etiquetas/print"),l(3),m("icon",e.faPrint),l(),m("routerLink","etiquetas/design"),l(3),m("icon",e.faPenRuler)}}function hg(o,t){if(o&1){let e=I();a(0,"li",10)(1,"span",5),g("click",function(){b(e);let n=u(2);return v(n.toggleSubMenu("etiquetas"))}),c(2," Etiquetas "),f(3,"fa-icon",9),c(4),r(),S(5,fg,9,4,"ul",3),r()}if(o&2){let e=u(2);l(3),m("icon",e.faTags),l(),x(" ",e.expandedSubMenu==="etiquetas"?"\u25B2":"\u25B6"," "),l(),m("ngIf",e.expandedSubMenu==="etiquetas")}}function gg(o,t){if(o&1&&(a(0,"ul",6),S(1,cg,6,3,"li",7)(2,mg,6,3,"li",7)(3,ug,6,3,"li",7)(4,hg,6,3,"li",7),r()),o&2){let e=u();l(),m("ngIf",e.userRol==="admin"),l(),m("ngIf",e.userRol==="admin"),l(),m("ngIf",e.userRol==="admin"),l(),m("ngIf",e.userRol==="admin")}}var Cr=class o{constructor(t,e,i){this.authService=t;this.library=e;this.router=i;this.library.addIcons(Fc,dc,fc,Ic,Sc,uc,mc,Ec,Pc,_c,wc,gc,ac,yc,lc,Dc,Pa,Oc)}open=!1;openChange=new Ue;usuario=null;userRol=null;isSidebarOpen=!1;expandedMenu=null;expandedSubMenu=null;icons={reporteVentas:Pa,faReceipt:Mc};faTags=bc;faPrint=Ac;faPenRuler=cc;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,t&&t.rol&&(this.userRol=t.rol)}),this.router.events.pipe(Ri(t=>t instanceof Do)).subscribe(()=>this.close())}closeSidebar(){this.isSidebarOpen=!1}toggleSidebar(){this.open=!this.open,this.openChange.emit(this.open)}toggleMenu(t){this.expandedMenu===t?(this.expandedMenu=null,this.expandedSubMenu=null):(this.expandedMenu=t,this.expandedSubMenu=null)}toggleSubMenu(t){this.expandedSubMenu=this.expandedSubMenu===t?null:t}close(){this.open&&(this.open=!1,this.openChange.emit(this.open))}get isLoggedIn(){return!!this.usuario}get currentRol(){return this.usuario?.rol||null}static \u0275fac=function(e){return new(e||o)(P(Ne),P(st),P(St))};static \u0275cmp=V({type:o,selectors:[["app-sidebar"]],inputs:{open:"open"},outputs:{openChange:"openChange"},decls:11,vars:8,consts:[[1,"sidebar"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"sidebar-image"],["class","menu-title",4,"ngIf"],["class","submenu",4,"ngIf"],[1,"menu-title"],[3,"click"],[1,"submenu"],["class","has-submenu",4,"ngIf"],["routerLinkActive","active",3,"routerLink"],[1,"menu-icon",3,"icon"],[1,"has-submenu"],["routerLinkActive","active",1,"submenu-item",3,"routerLink"],["routerLinkActive","active",3,"routerLink",4,"ngIf"],[4,"ngIf"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"ul"),f(2,"img",1),S(3,Qh,3,1,"li",2)(4,Jh,20,12,"ul",3),a(5,"li",4)(6,"span",5),g("click",function(){return i.toggleMenu("movements")}),c(7),r()(),S(8,ag,7,6,"ul",3)(9,sg,3,1,"li",2)(10,gg,5,4,"ul",3),r()()),e&2&&(G("open",i.open),l(3),m("ngIf",i.userRol==="admin"),l(),m("ngIf",i.expandedMenu==="catalogs"),l(3),x(" Movimientos ",i.expandedMenu==="movements"?"\u25B2":"\u25B6"," "),l(),m("ngIf",i.expandedMenu==="movements"),l(),m("ngIf",i.userRol==="admin"),l(),m("ngIf",i.expandedMenu==="reports"))},dependencies:[j,z,Je,Ze,an,ec,tc],styles:[".sidebar[_ngcontent-%COMP%]{width:0;transition:width .3s ease-in-out;background:#007bff;overflow-x:hidden;height:100%;padding:0}.sidebar.open[_ngcontent-%COMP%]{width:280px;padding:0}.sidebar[_ngcontent-%COMP%]:not(.open)   ul[_ngcontent-%COMP%]{display:none}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;color:#fff;margin-left:auto}.sidebar-image[_ngcontent-%COMP%]{width:60%;max-width:150px;border-radius:10px;margin-bottom:15px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}li[_ngcontent-%COMP%]{margin:10px 0;cursor:pointer;font-size:14px;font-weight:400;color:#fff;display:flex;justify-content:space-between;align-items:center;padding:5px 10px}li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#f99f18}.menu-icon[_ngcontent-%COMP%]{color:#010e26;font-size:16px;margin-left:10px}.menu-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#d9ef0a;text-align:left;padding:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.2)}.submenu[_ngcontent-%COMP%]{padding:10px;border-radius:5px}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px;font-size:14px;color:#fff}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#ffebcd}.sidebar[_ngcontent-%COMP%]   ul.submenu[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{position:relative}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{margin-left:1.5rem;margin-top:.3rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.2rem 0;padding-left:.5rem;font-size:.95rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{display:block}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:5px 10px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{list-style-type:disc;list-style-position:inside;margin:.4rem 0 0 1.5rem;padding:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:list-item;padding:4px 10px;margin:0;font-size:14px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:none}.submenu-item[_ngcontent-%COMP%]{color:#fb8a39!important}.submenu-item[_ngcontent-%COMP%]:hover{color:brown!important;background-color:#f0f8ff!important}"]})};function _g(o,t){if(o&1&&f(0,"app-sidebar",6),o&2){let e=u();m("open",e.isSidebarOpen)}}function bg(o,t){o&1&&f(0,"app-login")}var xr=class o{constructor(t,e){this.authService=t;this.router=e}usuario=null;isLoginVisible;isSidebarOpen=!1;ngOnInit(){this.authService.notifyUserChange(),this.authService.usuario$.subscribe(t=>{this.usuario=t}),this.isLoginVisible=this.authService.isLoginVisible.asObservable(),this.router.events.pipe(Ri(t=>t instanceof Do)).subscribe(()=>{this.isSidebarOpen=!1})}onToggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen}static \u0275fac=function(e){return new(e||o)(P(Ne),P(St))};static \u0275cmp=V({type:o,selectors:[["app-main-layout"]],decls:8,vars:5,consts:[[1,"layout-container"],[3,"open",4,"ngIf"],[1,"content-area"],[3,"toggleSidebar","isSidebarOpen"],[4,"ngIf"],[1,"main-content"],[3,"open"]],template:function(e,i){e&1&&(a(0,"div",0),S(1,_g,1,1,"app-sidebar",1),a(2,"div",2)(3,"app-header",3),g("toggleSidebar",function(){return i.onToggleSidebar()}),r(),S(4,bg,1,0,"app-login",4),y(5,"async"),a(6,"main",5),f(7,"router-outlet"),r()()()),e&2&&(l(),m("ngIf",i.usuario),l(2),m("isSidebarOpen",i.isSidebarOpen),l(),m("ngIf",M(5,3,i.isLoginVisible)))},dependencies:[j,z,ko,an,Fo,yr,Cr,_n],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;min-height:100vh}.content-area[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:1rem}"]})};var zt=class o{constructor(t){this.http=t}url=`${J.apiUrl}/reportes`;getVentasPorFarmacia(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-por-farmacia`,{params:e})}buildParams(t){let e=new Le;return Object.entries(t||{}).forEach(([i,n])=>{if(n==null||n==="")return;let s=n instanceof Date?this.toLocalISODate(n):String(n);e=e.set(i,s)}),e}toLocalISODate(t){let e=i=>String(i).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}getVentasProductoDetalle(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-producto-detalle`,{params:e})}toYmdLocal(t){if(!t)return;if(typeof t=="string"){let d=t.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(d)return`${d[3]}-${d[2]}-${d[1]}`;let p=t.match(/^(\d{4})-(\d{2})-(\d{2})/);return p?`${p[1]}-${p[2]}-${p[3]}`:void 0}let e=t instanceof Date?t:new Date(t);if(isNaN(e.getTime()))return;let i=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${i}-${n}-${s}`}getVentas(t){let e=`${this.url}/ventas/consulta`,i=localStorage.getItem("auth_token")||"",n=new ne({"x-auth-token":i}),s={farmaciaId:t.farmaciaId,clienteId:t.clienteId,usuarioId:t.usuarioId,totalDesde:t.totalDesde!=null?String(t.totalDesde):void 0,totalHasta:t.totalHasta!=null?String(t.totalHasta):void 0,fechaInicial:this.toYmdLocal(t.fechaInicial),fechaFinal:this.toYmdLocal(t.fechaFinal),page:t.page!=null?String(t.page):void 0,limit:t.limit!=null?String(t.limit):void 0},d=new Le;return Object.keys(s).forEach(p=>{let h=s[p];h!==void 0&&h!==""&&(d=d.set(p,h))}),this.http.get(e,{params:d,headers:n})}getResumenUtilidades(t){let e=`${this.url}/resumen-utilidades`,i=localStorage.getItem("auth_token")||"",n=new ne({"x-auth-token":i}),s={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),farmaciaId:t.farmaciaId||void 0},d=new Le;return Object.keys(s).forEach(p=>{let h=s[p];h!==void 0&&h!==""&&(d=d.set(p,h))}),this.http.get(e,{params:d,headers:n})}getUtilidadPorClientes(t){let e=`${this.url}/utilidad-cliente`,i=new ne({"x-auth-token":localStorage.getItem("auth_token")||""}),n={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),clienteId:t.clienteId||void 0,CantClientes:t.CantClientes||t.cantClientes,orden:t.orden||"utilidad",dir:t.dir||"desc"},s=new Le;return Object.keys(n).forEach(d=>{let p=n[d];p!==void 0&&p!==""&&(s=s.set(d,p))}),this.http.get(e,{params:s,headers:i})}getUtilidadPorProductos(t){let e=`${this.url}/utilidad-producto`,i=new ne({"x-auth-token":localStorage.getItem("auth_token")||""}),n={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),productoId:t.productoId||void 0,cantProductos:t.cantProductos,orden:t.orden||"utilidad",dir:t.dir||"desc",farmaciaId:t.farmaciaId||void 0},s=new Le;return Object.keys(n).forEach(d=>{let p=n[d];p!==void 0&&p!==""&&(s=s.set(d,p))}),this.http.get(e,{params:s,headers:i})}getUtilidadPorUsuarios(t){let e=`${this.url}/utilidad-usuario`,i=new ne({"x-auth-token":localStorage.getItem("auth_token")||""}),n={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),usuarioId:t.usuarioId||void 0,orden:t.orden||"utilidad",dir:t.dir||"desc"},s=new Le;return Object.keys(n).forEach(d=>{let p=n[d];p!==void 0&&p!==""&&(s=s.set(d,p))}),this.http.get(e,{params:s,headers:i})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var vg=o=>({"text-danger":o});function yg(o,t){if(o&1&&(a(0,"option",30),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function Cg(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),r(),a(3,"td"),c(4),r(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td",31),c(10),y(11,"number"),r(),a(12,"td",31),c(13),y(14,"currency"),r(),a(15,"td",31),c(16),y(17,"currency"),r(),a(18,"td",32),c(19),y(20,"currency"),r(),a(21,"td",31),c(22),y(23,"number"),r(),a(24,"td",31),c(25),y(26,"number"),r(),a(27,"td",31),c(28),y(29,"number"),r(),a(30,"td",31)(31,"span",33),c(32),y(33,"number"),r()()()),o&2){let e=t.$implicit,i=u();l(2),_(e.farmacia),l(2),_(e.nombre),l(2),_(e.codigoBarras||"\u2014"),l(2),_(e.categoria||"\u2014"),l(2),_(M(11,14,e.cantidadVendida)),l(3),_(M(14,16,e.costoTotal)),l(3),_(M(17,18,e.importeVendido)),l(2),m("ngClass",nt(31,vg,(e.utilidad||0)<0)),l(),x(" ",M(20,20,e.utilidad)," "),l(3),x(" ",e.margenPct==null?"\u2014":w(23,22,e.margenPct,"1.0-2")+"%"," "),l(3),_(M(26,25,e.stockMin)),l(3),_(M(29,27,e.stockMax)),l(3),m("ngClass",i.semaforoClass(e)),l(),x(" ",M(33,29,e.existencia)," ")}}function xg(o,t){o&1&&(a(0,"tr")(1,"td",34),c(2,"Sin resultados"),r()())}function Sg(o,t){if(o&1&&(a(0,"tfoot")(1,"tr",35)(2,"td",36),c(3,"Totales:"),r(),a(4,"td",31),c(5),y(6,"number"),r(),a(7,"td",31),c(8),y(9,"currency"),r(),a(10,"td",31),c(11),y(12,"currency"),r(),a(13,"td",31),c(14),y(15,"currency"),r(),a(16,"td",31),c(17),y(18,"number"),r(),a(19,"td",37),c(20),y(21,"number"),r()()()),o&2){let e=u();l(5),_(M(6,6,e.totalCantidad)),l(3),_(M(9,8,e.totalCosto)),l(3),_(M(12,10,e.totalImporte)),l(3),_(M(15,12,e.totalUtilidad)),l(3),x(" ",e.totalMargenPct==null?"\u2014":w(18,14,e.totalMargenPct,"1.0-2")+"%"," "),l(3),_(M(21,17,e.totalExistencia))}}function Eg(o,t){if(o&1){let e=I();a(0,"div",38)(1,"button",39),g("click",function(){b(e);let n=u();return v(n.goFirst())}),f(2,"i",40),r(),a(3,"button",41),g("click",function(){b(e);let n=u();return v(n.goPrev())}),f(4,"i",42),r(),c(5),a(6,"button",43),g("click",function(){b(e);let n=u();return v(n.goNext())}),f(7,"i",44),r(),a(8,"button",45),g("click",function(){b(e);let n=u();return v(n.goLast())}),f(9,"i",46),r()()}if(o&2){let e=u();l(),m("disabled",e.page===1),l(2),m("disabled",e.page===1),l(2),jt(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),l(),m("disabled",e.page===e.totalPages),l(2),m("disabled",e.page===e.totalPages)}}var Sr=class o{constructor(t,e,i){this.reportes=t;this.farmaciaService=e;this.productosSrv=i}semaforoClass(t){let e=Number(t?.existencia??0),i=Number(t?.stockMin??0),n=Number(t?.stockMax??0);return n>0&&e>=n?"sem-green":i>0&&e<=i?"sem-red":n>0||i>0?"sem-yellow":"sem-muted"}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQ="";categoriaQ="";cargando=!1;rows=[];totalImporte=0;totalCantidad=0;totalExistencia=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}sort=null;ngOnInit(){this.cargarFarmacias(),this.buscar()}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]})}buscar(){let t=e=>e?new Date(e).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasPorFarmacia({farmaciaId:this.farmaciaId||void 0,fechaIni:t(this.fechaIni),fechaFin:t(this.fechaFin),productoQ:this.productoQ?.trim()||void 0,categoriaQ:this.categoriaQ?.trim()||void 0}).subscribe({next:e=>{let i=e?.data||[],n=s=>Number.isFinite(Number(s))?Number(s):0;this.rows=i,this.totalImporte=i.reduce((s,d)=>s+n(d.importeVendido),0),this.totalCantidad=i.reduce((s,d)=>s+n(d.cantidadVendida),0),this.totalCosto=i.reduce((s,d)=>s+n(d.costoTotal),0),this.totalUtilidad=i.reduce((s,d)=>s+n(d.utilidad),0),this.totalExistencia=i.reduce((s,d)=>s+n(d.existencia),0),this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination?.(),this.cargando=!1,console.log("productos filtrados =====>",e)},error:e=>{console.error("Error reporte ventas:",e),this.rows=[],this.totalImporte=this.totalCantidad=this.totalExistencia=this.totalCosto=this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}clearProducto(){this.productoQ=""}limpiarFiltros(){this.farmaciaId="",this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.clearProducto(),this.rows=[],this.totalCantidad=0,this.totalExistencia=0,this.totalImporte=0,this.totalItems=0,this.page=1,this.sort=null,this.buscar()}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=i=>String(i).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}exportarCSV(){return Q(this,null,function*(){if(!this.rows.length)return;let t=[{key:"farmacia",label:"C\xF3d. barras"},{key:"nombre",label:"Producto"},{key:"codigoBarras",label:"C\xF3d. barras"},{key:"categoria",label:"Categor\xEDa"},{key:"cantidadVendida",label:"Vendidos"},{key:"costoTotal",label:"Costo total",map:d=>Number(d.costoTotal??0).toFixed(2)},{key:"importeVendido",label:"Importe"},{key:"utilidad",label:"Utilidad",map:d=>Number(d.utilidad??0).toFixed(2)},{key:"margenPct",label:"margenPct",map:d=>Number(d.margenPct??0).toFixed(2)},{key:"stockMin",label:"Stock M\xEDn."},{key:"stockMax",label:"Stock M\xE1x."},{key:"existencia",label:"Existencia"}],{toCSV:e,downloadCSV:i}=yield import("./chunk-SHYHNXMB.js"),n=e(this.rows,t,{separator:",",bom:!0}),s=`ventas_farmacia_${this.fechaIni}_a_${this.fechaFin}.csv`;i(s,n)})}setSort(t){let i={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];!this.sort||this.sort.key!==i?this.sort={key:i,dir:"asc"}:this.sort={key:i,dir:this.sort.dir==="asc"?"desc":"asc"},this.page=1}sortIcon(t){let i={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];return!this.sort||this.sort.key!==i?"swap_vert":this.sort.dir==="asc"?"arrow_upward":"arrow_downward"}get sortedRows(){if(!this.sort)return this.rows;let{key:t,dir:e}=this.sort;return t==="nombre"?[...this.rows].sort((i,n)=>{let s=(i.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"});return e==="asc"?s:-s}):[...this.rows].sort((i,n)=>{let s=Number(i?.[t]??NaN),d=Number(n?.[t]??NaN),p=Number.isNaN(s),h=Number.isNaN(d);return p&&h?0:p?e==="asc"?1:-1:h||s<d?e==="asc"?-1:1:s>d?e==="asc"?1:-1:(i.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"})})}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.sortedRows.slice(t,t+this.pageSize)}static \u0275fac=function(e){return new(e||o)(P(zt),P(ze),P(It))};static \u0275cmp=V({type:o,selectors:[["app-reporte-ventas-por-farmacia"]],decls:89,vars:23,consts:[[1,"p-1"],[1,"titulo-container"],[1,"mb-3","titulo"],[1,"row","filtros","align-items-end",3,"ngSubmit"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],["type","text","name","productoQ","placeholder","7501234, ibuprof...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn-rojo-chico",3,"click","disabled"],[1,"fas","fa-times"],["type","text","name","categoriaQ",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"col-md-2","d-flex","gap-2","justify-content-end","align-items-end"],["type","button","matTooltip","Limpiar filtro",1,"btn-rojo",3,"click","disabled"],["type","submit",1,"btn-gris",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"mt-2"],[1,"align-middle","tabla"],[1,"sortable",3,"click"],["inline","",1,"ms-1"],[2,"white-space","nowrap"],[1,"text-end","sortable",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"value"],[1,"text-end"],[1,"text-end",3,"ngClass"],[1,"sem",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","4",1,"text-end"],["colspan","3",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Productos:\xA0 Ventas - Existencia"),r()(),a(4,"form",3),g("ngSubmit",function(){return i.buscar()}),a(5,"div",4)(6,"label",5),c(7,"Farmacia"),r(),a(8,"select",6),k("ngModelChange",function(s){return O(i.farmaciaId,s)||(i.farmaciaId=s),s}),a(9,"option",7),c(10,"Todas"),r(),S(11,yg,2,2,"option",8),r()(),a(12,"div",4)(13,"label",5),c(14,"Fecha inicial"),r(),a(15,"input",9),k("ngModelChange",function(s){return O(i.fechaIni,s)||(i.fechaIni=s),s}),r()(),a(16,"div",4)(17,"label",5),c(18,"Fecha final"),r(),a(19,"input",10),k("ngModelChange",function(s){return O(i.fechaFin,s)||(i.fechaFin=s),s}),r()(),a(20,"div",4)(21,"label",5),c(22,"Producto"),r(),a(23,"div",11)(24,"input",12),k("ngModelChange",function(s){return O(i.productoQ,s)||(i.productoQ=s),s}),g("keyup.enter",function(){return i.buscar()}),r(),a(25,"button",13),g("click",function(){return i.clearProducto()}),f(26,"i",14),r()()(),a(27,"div",4)(28,"label",5),c(29,"Categ."),r(),a(30,"div",11)(31,"input",15),k("ngModelChange",function(s){return O(i.categoriaQ,s)||(i.categoriaQ=s),s}),g("keyup.enter",function(){return i.buscar()}),r(),a(32,"button",13),g("click",function(){return i.categoriaQ=""}),f(33,"i",14),r()()(),a(34,"div",16)(35,"button",17),g("click",function(){return i.limpiarFiltros()}),f(36,"i",14),r(),a(37,"button",18),c(38),r()()(),a(39,"div",19)(40,"button",20),g("click",function(){return i.exportarCSV()}),c(41," Exportar CSV "),r()(),a(42,"div",21)(43,"table",22)(44,"thead")(45,"tr")(46,"th"),c(47,"Farmacia"),r(),a(48,"th",23),g("click",function(){return i.setSort("producto")}),c(49," Producto "),a(50,"mat-icon",24),c(51),r()(),a(52,"th",25),c(53,"C\xF3d. barras"),r(),a(54,"th",25),c(55,"Categor\xEDa"),r(),a(56,"th",26),g("click",function(){return i.setSort("cantidad")}),c(57," Vendidos "),a(58,"mat-icon",24),c(59),r()(),a(60,"th",26),g("click",function(){return i.setSort("costo")}),c(61," Costo total "),a(62,"mat-icon",24),c(63),r()(),a(64,"th",26),g("click",function(){return i.setSort("importe")}),c(65," Importe "),a(66,"mat-icon",24),c(67),r()(),a(68,"th",26),g("click",function(){return i.setSort("utilidad")}),c(69," Utilidad "),a(70,"mat-icon",24),c(71),r()(),a(72,"th",26),g("click",function(){return i.setSort("margen")}),c(73," % Gan. "),a(74,"mat-icon",24),c(75),r()(),a(76,"th"),c(77,"Stock M\xEDn."),r(),a(78,"th"),c(79,"Stock M\xE1x."),r(),a(80,"th",26),g("click",function(){return i.setSort("existencia")}),c(81," Existencia "),a(82,"mat-icon",24),c(83),r()()()(),a(84,"tbody"),S(85,Cg,34,33,"tr",27)(86,xg,3,0,"tr",28),r(),S(87,Sg,22,19,"tfoot",28),r(),S(88,Eg,10,7,"div",29),r()()),e&2&&(l(8),T("ngModel",i.farmaciaId),l(3),m("ngForOf",i.farmacias),l(4),T("ngModel",i.fechaIni),l(4),T("ngModel",i.fechaFin),l(5),T("ngModel",i.productoQ),l(),m("disabled",!i.productoQ),l(6),T("ngModel",i.categoriaQ),l(),m("disabled",!i.categoriaQ),l(3),m("disabled",i.cargando),l(2),m("disabled",i.cargando),l(),x(" ",i.cargando?"Buscando...":"Buscar"," "),l(2),m("disabled",i.cargando||!i.rows.length),l(11),_(i.sortIcon("producto")),l(8),_(i.sortIcon("cantidad")),l(4),_(i.sortIcon("costo")),l(4),_(i.sortIcon("importe")),l(4),_(i.sortIcon("utilidad")),l(4),_(i.sortIcon("margen")),l(8),_(i.sortIcon("existencia")),l(2),m("ngForOf",i.pagedRows),l(),m("ngIf",i.rows.length===0),l(),m("ngIf",i.rows.length),l(),m("ngIf",i.totalItems>0))},dependencies:[j,Qe,Y,z,Te,Re,me,ke,ce,de,ie,le,Z,Oe,xe,sn,De,fn,hn,bn,oi,wi,_e],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.compact-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%]{padding:0!important}.compact-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{padding-top:.35rem;padding-bottom:.35rem}.wide-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding:8px 0}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-flex{align-items:center}.compact-field.mb-0[_ngcontent-%COMP%]{margin-bottom:0}.suffix-center[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;padding-right:.35rem}.clear-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;line-height:1}.compact-field[_ngcontent-%COMP%]   .mat-form-field-flex[_ngcontent-%COMP%]{align-items:center}.sem[_ngcontent-%COMP%]{font-weight:600}.sem-green[_ngcontent-%COMP%]{color:#0f9d58}.sem-yellow[_ngcontent-%COMP%]{color:#b8860b}.sem-red[_ngcontent-%COMP%]{color:#dc3545}.sem-muted[_ngcontent-%COMP%]{color:#6c757d}"]})};var Fd=lt(_t());var Ra=o=>({"text-danger":o});function wg(o,t){if(o&1&&(a(0,"option",31),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),x(" ",e.nombre," ")}}function Pg(o,t){if(o&1&&(a(0,"mat-option",32)(1,"div",33)(2,"span"),c(3),r(),a(4,"small",34),c(5),r()()()),o&2){let e=t.$implicit;m("value",e),l(3),_(e.nombre),l(2),_(e.codigoBarras||"\u2014")}}function Ig(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),y(3,"date"),r(),a(4,"td"),c(5),r(),a(6,"td"),c(7),r(),a(8,"td"),c(9),r(),a(10,"td"),c(11),r(),a(12,"td",27),c(13),r(),a(14,"td",27),c(15),y(16,"currency"),r(),a(17,"td",27),c(18),y(19,"currency"),r(),a(20,"td",35),c(21),y(22,"currency"),r(),a(23,"td",35),c(24),y(25,"number"),r(),a(26,"td"),c(27),r()()),o&2){let e=t.$implicit;l(2),_(w(3,13,e.fecha,"dd-MM-yyyy")),l(3),_(e.farmaciaNombre),l(2),_(e.usuarioNombre),l(2),_(e.codigoBarras||"\u2014"),l(2),_(e.productoNombre),l(2),_(e.cantidadVendida),l(2),_(M(16,16,e.importeTotal)),l(3),_(M(19,18,e.costoTotal)),l(2),m("ngClass",nt(25,Ra,(e.utilidad||0)<0)),l(),x(" ",M(22,20,e.utilidad)," "),l(2),m("ngClass",nt(27,Ra,(e.utilidad||0)<0)),l(),x(" ",e.margenRenglonPct==null?"\u2014":w(25,22,e.margenRenglonPct,"1.0-2")+"%"," "),l(3),_(e.folio)}}function Mg(o,t){o&1&&(a(0,"tr")(1,"td",36),c(2,"Sin resultados"),r()())}function Tg(o,t){if(o&1&&(a(0,"tfoot")(1,"tr",37)(2,"td",38),c(3,"Totales:"),r(),a(4,"td",27),c(5),r(),a(6,"td",27),c(7),y(8,"currency"),r(),a(9,"td",27),c(10),y(11,"currency"),r(),a(12,"td",35),c(13),y(14,"currency"),r(),a(15,"td",27),c(16),y(17,"number"),r(),f(18,"td"),r()()),o&2){let e=u();l(5),_(e.totalCantidad),l(2),_(M(8,6,e.totalImporte)),l(3),_(M(11,8,e.totalCosto)),l(2),m("ngClass",nt(15,Ra,e.totalUtilidad<0)),l(),x(" ",M(14,10,e.totalUtilidad)," "),l(3),x(" ",e.totalMargenPct==null?"\u2014":w(17,12,e.totalMargenPct,"1.0-2")+"%"," ")}}function Og(o,t){if(o&1){let e=I();a(0,"div",39)(1,"button",40),g("click",function(){b(e);let n=u();return v(n.goFirst())}),f(2,"i",41),r(),a(3,"button",42),g("click",function(){b(e);let n=u();return v(n.goPrev())}),f(4,"i",43),r(),c(5),a(6,"button",44),g("click",function(){b(e);let n=u();return v(n.goNext())}),f(7,"i",45),r(),a(8,"button",46),g("click",function(){b(e);let n=u();return v(n.goLast())}),f(9,"i",47),r()()}if(o&2){let e=u();l(),m("disabled",e.page===1),l(2),m("disabled",e.page===1),l(2),jt(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),l(),m("disabled",e.page===e.totalPages),l(2),m("disabled",e.page===e.totalPages)}}var Er=class o{constructor(t,e,i){this.farmaciaService=t;this.reportes=e;this.productosSrv=i}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQuery="";productCtrl=new Ro("");opcionesProductos=[];productoId=null;codigoBarras="";nombre="";query$=new ve;cargando=!1;rows=[];totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]}),this.query$.pipe(Ft(250),Rt(),ft(t=>{let e=(t||"").trim();return e.length<2?(this.opcionesProductos=[],Ie([])):this.productosSrv.buscar(e)})).subscribe({next:t=>{this.opcionesProductos=Array.isArray(t)?t:[]},error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}}),this.productCtrl.valueChanges.pipe(Ft(250),Rt(),ft(t=>{let i=((typeof t=="string"?t:t?.nombre??t?.codigoBarras??"")||"").trim();return i.length<2?(this.opcionesProductos=[],Ie([])):this.productosSrv.buscar(i)})).subscribe({next:t=>this.opcionesProductos=t||[],error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}})}onQueryChange(t){this.query$.next(t),this.productoId=null,this.codigoBarras="",this.nombre=""}displayProducto=t=>typeof t=="string"?t:t?`${t.codigoBarras?t.codigoBarras+" \u2014 ":""}${t.nombre}`:"";onProductoChange(t){this.seleccionarDesdeInput(t)}onProductoBlur(t){this.productoId||this.seleccionarDesdeInput(t)}seleccionarDesdeInput(t){let e=(t||"").trim();if(!e)return;let i=this.opcionesProductos.find(p=>p.codigoBarras&&p.codigoBarras===e),n=this.opcionesProductos.find(p=>p.nombre.toLowerCase()===e.toLowerCase()),s=this.opcionesProductos.find(p=>(p.codigoBarras?`${p.codigoBarras} \u2014 `:"")+p.nombre===e),d=i||n||s;d&&(this.productoId=d._id,this.codigoBarras=d.codigoBarras||"",this.nombre=d.nombre,this.productoQuery=(d.codigoBarras?`${d.codigoBarras} \u2014 `:"")+d.nombre)}buscar(){let t=this.productCtrl.value;if(!this.productoId&&typeof t=="string"&&t.trim()){let i=t.trim();/^\d{5,}$/.test(i)?(this.codigoBarras=i,this.nombre=""):(this.nombre=i,this.codigoBarras="")}if(!this.productoId&&!this.codigoBarras&&!this.nombre){Fd.default.fire({icon:"warning",title:"Aviso",text:"Selecciona un producto o escribe c\xF3digo/nombre.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let e=i=>i?new Date(i).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasProductoDetalle({farmaciaId:this.farmaciaId||void 0,productoId:this.productoId||void 0,codigoBarras:this.productoId?void 0:this.codigoBarras||void 0,nombre:this.productoId?void 0:this.nombre||void 0,fechaIni:e(this.fechaIni),fechaFin:e(this.fechaFin)}).subscribe({next:i=>{let n=d=>{let p=Number(d);return Number.isFinite(p)?p:0};this.rows=i?.items||[];let s=this.rows.reduce((d,p)=>(d.cant+=n(p.cantidadVendida),d.imp+=n(p.importeTotal),d.cost+=n(p.costoTotal),d.util+=n(p.utilidad),d),{cant:0,imp:0,cost:0,util:0});this.totalCantidad=s.cant,this.totalImporte=s.imp,this.totalCosto=s.cost,this.totalUtilidad=s.util,this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination(),this.cargando=!1},error:i=>{console.error("Error reporte ventas producto:",i),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}limpiar(){this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.totalItems=0,this.page=1,this.farmaciaId="",this.limpiarProducto(),this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null}exportarCSV(){if(!this.rows.length)return;let t=[{key:"fecha",label:"Fecha",map:n=>n.fecha?n.fecha.substring(0,10):""},{key:"farmaciaNombre",label:"Farmacia"},{key:"usuarioNombre",label:"Usuario"},{key:"codigoBarras",label:"C\xF3digo"},{key:"productoNombre",label:"Producto"},{key:"cantidadVendida",label:"Cantidad"},{key:"importeTotal",label:"Importe",map:n=>Number(n.importeTotal??0).toFixed(2)},{key:"costoTotal",label:"Costo",map:n=>Number(n.costoTotal??0).toFixed(2)},{key:"utilidad",label:"Utilidad",map:n=>Number(n.utilidad??0).toFixed(2)},{key:"margenRenglonPct",label:"Margen % (ren)",map:n=>n.margenRenglonPct==null?"":Number(n.margenRenglonPct).toFixed(2)},{key:"folio",label:"Folio venta"}],e=td(this.rows,t,{separator:",",bom:!0}),i=`ventas_producto_${this.codigoBarras||this.nombre||"producto"}_${this.fechaIni}_a_${this.fechaFin}.csv`;id(i,e)}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=i=>String(i).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}onOptionSelected(t){t&&(this.productoId=t._id,this.codigoBarras=t.codigoBarras||"",this.nombre=t.nombre,this.productCtrl.setValue(t))}limpiarProducto(){this.productCtrl.setValue(""),this.opcionesProductos=[],this.productoId=null,this.codigoBarras="",this.nombre=""}static \u0275fac=function(e){return new(e||o)(P(ze),P(zt),P(It))};static \u0275cmp=V({type:o,selectors:[["app-reporte-ventas-producto"]],decls:69,vars:16,consts:[["auto","matAutocomplete"],[1,"titulo-container","mb-2"],[1,"titulo"],[1,"row","align-items-end",3,"ngSubmit"],[1,"row","filtros"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"form-label","d-block"],["appearance","outline",1,"compact-field","wide-field"],["matInput","","placeholder","Escribe c\xF3digo de barras o nombre",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-1","d-flex",2,"margin-top","-10px"],["type","button","matTooltip","Borrar filtro",1,"btn-rojo","compact-btn",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-md-1","d-flex","text-end",2,"margin-top","-10px"],["type","submit",1,"btn-gris","compact-btn",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"table-responsive","mt-3"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"d-flex","justify-content-between","w-100"],[1,"text-muted","ms-2"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","5",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,i){if(e&1){let n=I();a(0,"div")(1,"div",1)(2,"h2",2),c(3,"Ventas por producto"),r()(),a(4,"form",3),g("ngSubmit",function(){return b(n),v(i.buscar())}),a(5,"div",4)(6,"div",5)(7,"label",6),c(8,"Farmacia"),r(),a(9,"select",7),k("ngModelChange",function(d){return b(n),O(i.farmaciaId,d)||(i.farmaciaId=d),v(d)}),a(10,"option",8),c(11,"Todas"),r(),S(12,wg,2,2,"option",9),r()(),a(13,"div",10)(14,"label",11),c(15,"Producto"),r(),a(16,"mat-form-field",12),f(17,"input",13),a(18,"mat-autocomplete",14,0),g("optionSelected",function(d){return b(n),v(i.onOptionSelected(d.option.value))}),S(20,Pg,6,3,"mat-option",15),r()()(),a(21,"div",5)(22,"label",6),c(23,"Fecha inicial"),r(),a(24,"input",16),k("ngModelChange",function(d){return b(n),O(i.fechaIni,d)||(i.fechaIni=d),v(d)}),r()(),a(25,"div",5)(26,"label",6),c(27,"Fecha final"),r(),a(28,"input",17),k("ngModelChange",function(d){return b(n),O(i.fechaFin,d)||(i.fechaFin=d),v(d)}),r()(),a(29,"div",18)(30,"button",19),g("click",function(){return b(n),v(i.limpiar())}),f(31,"i",20),r()(),a(32,"div",21)(33,"button",22),c(34),r()()(),a(35,"div",23)(36,"button",24),g("click",function(){return b(n),v(i.exportarCSV())}),c(37," Exportar CSV "),r()()(),a(38,"div",25)(39,"table",26)(40,"thead")(41,"tr")(42,"th"),c(43,"Fecha"),r(),a(44,"th"),c(45,"Farmacia"),r(),a(46,"th"),c(47,"Usuario"),r(),a(48,"th"),c(49,"C\xF3d. barras"),r(),a(50,"th"),c(51,"Producto"),r(),a(52,"th",27),c(53,"Cantidad"),r(),a(54,"th",27),c(55,"Importe"),r(),a(56,"th",27),c(57,"Costo"),r(),a(58,"th",27),c(59,"Utilidad"),r(),a(60,"th",27),c(61,"% Gan."),r(),a(62,"th"),c(63,"Folio venta"),r()()(),a(64,"tbody"),S(65,Ig,28,29,"tr",28)(66,Mg,3,0,"tr",29),r(),S(67,Tg,19,17,"tfoot",29),r(),S(68,Og,10,7,"div",30),r()()}if(e&2){let n=$e(19);l(9),T("ngModel",i.farmaciaId),l(3),m("ngForOf",i.farmacias),l(5),m("formControl",i.productCtrl)("matAutocomplete",n),l(),m("displayWith",i.displayProducto),l(2),m("ngForOf",i.opcionesProductos),l(4),T("ngModel",i.fechaIni),l(4),T("ngModel",i.fechaFin),l(2),m("disabled",i.cargando),l(3),m("disabled",i.cargando),l(),x(" ",i.cargando?"Buscando...":"Buscar"," "),l(2),m("disabled",i.cargando||!i.rows.length),l(29),m("ngForOf",i.pagedRows),l(),m("ngIf",i.rows.length===0),l(),m("ngIf",i.rows.length),l(),m("ngIf",i.totalItems>0)}},dependencies:[j,Qe,Y,z,Te,Re,Me,me,ke,ce,de,ie,le,Z,Oe,xe,sn,De,Ao,fn,Wo,hn,Go,bn,nr,pn,Ui,oi,_e],styles:[".wide-field[_ngcontent-%COMP%]{width:360px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.compact-btn[_ngcontent-%COMP%]{height:40px;padding-top:6px;padding-bottom:6px;min-height:40px;line-height:26px;margin-top:2rem}"]})};var En=lt(_t());var kg=["contenedorTicket"];function Dg(o,t){if(o&1&&(a(0,"option",8),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),x(" ",e.nombre," ")}}function Fg(o,t){if(o&1){let e=I();a(0,"button",33),g("click",function(){b(e);let n=u();return v(n.limpiarFechaPedido())}),f(1,"fa-icon",34),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Rg(o,t){if(o&1){let e=I();a(0,"button",33),g("click",function(){b(e);let n=u();return v(n.limpiarFechaFin())}),f(1,"fa-icon",34),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Ag(o,t){if(o&1){let e=I();a(0,"button",33),g("click",function(){b(e);let n=u();return v(n.limpiarDescripcion())}),f(1,"fa-icon",34),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function Vg(o,t){if(o&1&&(a(0,"option",8),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e),l(),x(" ",e," ")}}function Ng(o,t){if(o&1){let e=I();a(0,"div",35)(1,"button",36),g("click",function(){b(e);let n=u();return v(n.buscarSinFolio())}),c(2,"Buscar"),r()()}}function Bg(o,t){if(o&1){let e=I();a(0,"div",37)(1,"h2",38),c(2,"Pedidos"),r(),a(3,"button",39),g("click",function(){b(e);let n=u();return v(n.limpiarFiltroCompleto())}),f(4,"i",40),r()()}}function Lg(o,t){if(o&1&&(a(0,"small",65),c(1),r()),o&2){let e=u().$implicit;l(),x(" Tel.: ",e.cliente==null?null:e.cliente.telefono," ")}}function jg(o,t){if(o&1){let e=I();oe(0),a(1,"input",66),k("ngModelChange",function(n){b(e);let s=u(3);return O(s.costoEditado,n)||(s.costoEditado=n),v(n)}),r(),re()}if(o&2){let e=u(3);l(),T("ngModel",e.costoEditado)}}function Ug(o,t){if(o&1&&(c(0),y(1,"currency")),o&2){let e=u().$implicit;x(" ",M(1,1,e.costo)," ")}}function $g(o,t){if(o&1&&(a(0,"tr")(1,"td",71),c(2,"Levant\xF3:"),r(),a(3,"td",70),c(4),r(),a(5,"td",71),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_(e.usuarioPidio.nombre||"\u2014"),l(2),x(" ",e.fechaPedido?pt(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function Hg(o,t){if(o&1&&(a(0,"tr")(1,"td",71),c(2,"Surti\xF3:"),r(),a(3,"td",70),c(4),r(),a(5,"td",71),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_((e.usuarioSurtio==null?null:e.usuarioSurtio.nombre)||"\u2014"),l(2),x(" ",e.fechaEntrega?pt(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function zg(o,t){if(o&1&&(a(0,"tr")(1,"td",71),c(2,"Cancel\xF3:"),r(),a(3,"td",70),c(4),r(),a(5,"td",71),c(6),y(7,"date"),r()()),o&2){let e=u(2).$implicit;l(4),_((e.usuarioCancelo==null?null:e.usuarioCancelo.nombre)||"\u2014"),l(2),x(" ",e.fechaCancelacion?pt(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function qg(o,t){if(o&1&&(a(0,"tr")(1,"td",67)(2,"div",68)(3,"table",69)(4,"thead")(5,"tr")(6,"th",70),c(7),r(),a(8,"th",71),c(9),y(10,"currency"),r(),a(11,"th",71),c(12),y(13,"currency"),r()()(),a(14,"tbody")(15,"tr")(16,"td",72),c(17),y(18,"currency"),r(),a(19,"td",72),c(20),y(21,"currency"),r()(),a(22,"tr")(23,"td"),c(24,"Efectivo:"),r(),a(25,"td"),c(26),y(27,"currency"),r(),a(28,"td"),c(29,"Efectivo:"),r(),a(30,"td"),c(31),y(32,"currency"),r()(),a(33,"tr")(34,"td"),c(35,"Tarjeta:"),r(),a(36,"td"),c(37),y(38,"currency"),r(),a(39,"td"),c(40,"Tarjeta:"),r(),a(41,"td"),c(42),y(43,"currency"),r()(),a(44,"tr")(45,"td"),c(46,"Transferencia:"),r(),a(47,"td"),c(48),y(49,"currency"),r(),a(50,"td"),c(51,"Transferencia:"),r(),a(52,"td"),c(53),y(54,"currency"),r()(),a(55,"tr")(56,"td"),c(57,"Monedero:"),r(),a(58,"td"),c(59),y(60,"currency"),r(),a(61,"td"),c(62,"Monedero"),r(),a(63,"td"),c(64),y(65,"currency"),r()(),S(66,$g,8,6,"tr",64)(67,Hg,8,6,"tr",64)(68,zg,8,6,"tr",64),r()()()()()),o&2){let e=u().$implicit,i=u(2);l(7),x("Estado: ",e.estado,""),l(2),x("Costo: ",M(10,16,e.costo||0),""),l(3),x("Precio: ",M(13,18,e.total||0),""),l(5),x("Anticipo: ",M(18,20,e.aCuenta)," "),l(3),x("Resta: ",M(21,22,e.resta),""),l(6),_(M(27,24,e.pagoACuenta.efectivo||0)),l(5),_(M(32,26,e.pagoResta.efectivo||0)),l(6),_(M(38,28,e.pagoACuenta.tarjeta||0)),l(5),_(M(43,30,e.pagoResta.tarjeta||0)),l(6),_(M(49,32,e.pagoACuenta.transferencia||0)),l(5),_(M(54,34,e.pagoResta.transferencia||0)),l(6),_(M(60,36,e.pagoACuenta.vale||0)),l(5),_(M(65,38,e.pagoResta.vale||0)),l(2),m("ngIf",i.esAdmin),l(),m("ngIf",e.estado==="entregado"&&i.esAdmin),l(),m("ngIf",e.estado==="cancelado"&&i.esAdmin)}}function Wg(o,t){if(o&1){let e=I();oe(0),a(1,"tr")(2,"td")(3,"button",55),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.pedidoDetalleAbiertoId===n._id?s.cerrarDetallePedido(n):s.abrirDetallePedido(n))}),f(4,"fa-icon",56),r()(),a(5,"td"),c(6),r(),a(7,"td"),c(8),y(9,"date"),r(),a(10,"td")(11,"div"),c(12),r(),S(13,Lg,2,1,"small",57),r(),a(14,"td"),c(15),r(),a(16,"td"),c(17),r(),a(18,"td"),S(19,jg,2,1,"ng-container",58)(20,Ug,2,3,"ng-template",null,0,Mo),r(),a(22,"td"),c(23),y(24,"currency"),r(),a(25,"td"),c(26),y(27,"currency"),r(),a(28,"td"),c(29),y(30,"currency"),r(),a(31,"td"),c(32),y(33,"currency"),r(),a(34,"td"),c(35),y(36,"currency"),r(),a(37,"td"),c(38),y(39,"number"),r(),a(40,"td",59)(41,"div",60)(42,"button",61),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.habilitarEdicion(n))}),f(43,"fa-icon",34),r(),a(44,"button",62),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.guardarFila(n))}),f(45,"fa-icon",34),r(),a(46,"button",63),g("click",function(){b(e);let n=u(2);return v(n.cancelarEdicion())}),f(47,"fa-icon",34),r()()()(),S(48,qg,69,40,"tr",64),re()}if(o&2){let e=t.$implicit,i=$e(21),n=u(2);l(3),m("matTooltip",n.pedidoDetalleAbiertoId===e._id?"Cerrar detalle":"Ver detalle"),l(),m("icon",n.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",n.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),l(2),_(e.folio),l(2),_(pt(9,24,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),l(4),_((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),l(),m("ngIf",e.cliente==null?null:e.cliente.telefono),l(2),_(e.descripcion),l(2),_(e.estado),l(2),m("ngIf",n.modoEdicionId===e._id)("ngIfElse",i),l(4),_(M(24,28,e.total)),l(3),_(M(27,30,e.aCuenta)),l(3),_(M(30,32,e.resta)),l(3),_(M(33,34,(e.total||0)-(e.resta||0))),l(3),_(M(36,36,(e.total||0)-(e.resta||0)-(e.costo||0))),l(3),x(" ",w(39,38,e.costo>0?((e.total||0)-(e.resta||0)-(e.costo||0))/e.costo*100:0,"1.1-2"),"% "),l(4),m("disabled",n.modoEdicionId===e._id),l(),m("icon",n.faEdit),l(),m("disabled",n.modoEdicionId!==e._id),l(),m("icon",n.faSave),l(),m("disabled",n.modoEdicionId!==e._id),l(),m("icon",n.faTimes),l(),m("ngIf",n.pedidoDetalleAbiertoId===e._id)}}function Gg(o,t){if(o&1){let e=I();a(0,"table",41)(1,"thead")(2,"tr"),f(3,"th"),a(4,"th"),c(5,"Folio"),r(),a(6,"th",42),g("click",function(){b(e);let n=u();return v(n.ordenarPor("fechaPedido"))}),c(7," F. pedido "),f(8,"fa-icon",43),r(),a(9,"th",44),g("click",function(){b(e);let n=u();return v(n.ordenarPor("cliente.nombre"))}),c(10," Cliente "),f(11,"fa-icon",43),r(),a(12,"th",45),g("click",function(){b(e);let n=u();return v(n.ordenarPor("descripcion"))}),c(13," Descripci\xF3n "),f(14,"fa-icon",46),r(),a(15,"th",47),g("click",function(){b(e);let n=u();return v(n.ordenarPor("estado"))}),c(16," Estado "),f(17,"fa-icon",46),r(),a(18,"th",48),g("click",function(){b(e);let n=u();return v(n.ordenarPor("costo"))}),c(19," Costo "),f(20,"fa-icon",46),r(),a(21,"th",49),g("click",function(){b(e);let n=u();return v(n.ordenarPor("total"))}),c(22," Precio "),f(23,"fa-icon",46),r(),a(24,"th",50),g("click",function(){b(e);let n=u();return v(n.ordenarPor("aCuenta"))}),c(25," A cuenta "),f(26,"fa-icon",46),r(),a(27,"th",51),g("click",function(){b(e);let n=u();return v(n.ordenarPor("resta"))}),c(28," Resta "),f(29,"fa-icon",46),r(),a(30,"th"),c(31,"Tot. Ingreso"),r(),a(32,"th"),c(33,"Utilidad"),r(),a(34,"th"),c(35,"% Gan"),r(),a(36,"th"),c(37,"Acciones"),r()()(),a(38,"tbody"),S(39,Wg,49,41,"ng-container",52),r(),a(40,"tfoot")(41,"tr")(42,"td",53),c(43,"Totales:"),r(),a(44,"td",54),c(45),y(46,"currency"),r(),a(47,"td",54),c(48),y(49,"currency"),r(),a(50,"td",54),c(51),y(52,"currency"),r(),a(53,"td",54),c(54),y(55,"currency"),r(),a(56,"td",54),c(57),y(58,"currency"),r(),a(59,"td",54),c(60),y(61,"currency"),r(),a(62,"td",54),c(63),y(64,"number"),r(),f(65,"td"),r()()()}if(o&2){let e=u();l(6),te("aria-sort",e.ariaSortFor("fechaPedido")),l(2),m("icon",e.sortBy==="fechaPedido"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("cliente.nombre")),l(2),m("icon",e.sortBy==="cliente.nombre"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("descripcion")),l(2),m("icon",e.sortBy==="descripcion"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("estado")),l(2),m("icon",e.sortBy==="estado"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("costo")),l(2),m("icon",e.sortBy==="costo"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("total")),l(2),m("icon",e.sortBy==="total"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("aCuenta")),l(2),m("icon",e.sortBy==="aCuenta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(),te("aria-sort",e.ariaSortFor("resta")),l(2),m("icon",e.sortBy==="resta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),l(10),m("ngForOf",e.pedidos),l(6),_(M(46,24,e.totalCosto)),l(3),_(M(49,26,e.totalPrecio)),l(3),_(M(52,28,e.totalAcuenta)),l(3),_(M(55,30,e.totalResta)),l(3),_(M(58,32,e.totalIngreso)),l(3),_(M(61,34,e.utilidadTotal)),l(3),x("",w(64,36,e.porcentajeUtilidad,"1.1-2"),"%")}}function Kg(o,t){if(o&1){let e=I();a(0,"div",73)(1,"button",74),g("click",function(){b(e);let n=u();return v(n.cambiarPagina(1))}),f(2,"i",75),r(),a(3,"button",76),g("click",function(){b(e);let n=u();return v(n.cambiarPagina(n.paginacion.page-1))}),f(4,"i",77),r(),a(5,"span"),c(6),r(),a(7,"button",78),g("click",function(){b(e);let n=u();return v(n.cambiarPagina(n.paginacion.page+1))}),f(8,"i",79),r(),a(9,"button",80),g("click",function(){b(e);let n=u();return v(n.cambiarPagina(n.paginacion.pages))}),f(10,"i",81),r(),a(11,"span",82),c(12,"Filas p\xE1g.:"),r(),a(13,"select",83),k("ngModelChange",function(n){b(e);let s=u();return O(s.limit,n)||(s.limit=n),v(n)}),g("ngModelChange",function(){b(e);let n=u();return n.page=1,v(n.buscarSinFolio())}),a(14,"option",8),c(15,"10"),r(),a(16,"option",8),c(17,"20"),r(),a(18,"option",8),c(19,"50"),r(),a(20,"option",8),c(21,"100"),r()()()}if(o&2){let e=u();l(),m("disabled",e.paginacion.page<=1),l(2),m("disabled",!e.paginacion.hasPrev),l(3),jt(" P\xE1gina ",e.paginacion.page," de ",e.paginacion.pages," (",e.paginacion.total," registros) "),l(),m("disabled",!e.paginacion.hasNext),l(2),m("disabled",e.paginacion.page>=e.paginacion.pages),l(4),T("ngModel",e.limit),l(),m("ngValue",10),l(2),m("ngValue",20),l(2),m("ngValue",50),l(2),m("ngValue",100)}}function Qg(o,t){o&1&&(a(0,"p",84),c(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),r())}function Ad(){return{conteo:0,total:0,aCuenta:0,resta:0,saldo:0,efectivo:0,tarjeta:0,transferencia:0,vale:0,efectivoResta:0,tarjetaResta:0,transferenciaResta:0,valeResta:0,costo:0}}function Rd(){return{generales:Ad(),porEstado:[]}}var wr=class o{constructor(t,e,i,n,s,d,p){this.library=t;this.pedidosService=e;this.authService=i;this.clienteService=n;this.farmaciaService=s;this.cdr=d;this.ngZone=p;this.library.addIcons(Ut,mn,dn,ct)}contenedorTicket;filtroFarmaciaId;filtroFolio="";filtroDescripcion="";filtroFechaPedido="";filtroFechaFin="";filtroEstado;estadosPedido=["inicial","entregado","cancelado"];esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmacias=[];farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";usuarioId="";usuarioRol="";usuarioNombre="";pedidoEditandoId=null;costoTemporal=0;modoEdicionId=null;costoEditado=null;faSpinner=kc;faCheck=Rc;faSave=Cc;faEdit=Lo;faTimes=ct;filtroClienteNombre="";incluirClienteNull=!1;faSort=hc;faSortUp=xc;faSortDown=sc;page=1;limit=20;sortBy="fechaPedido";sortDir="desc";ariaSortFor(t){return this.sortBy===t?this.sortDir==="asc"?"ascending":"descending":"none"}paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1};resumen=Rd();pedidos=[];totalIngreso=0;utilidadTotal=0;porcentajeUtilidad=0;totalCosto=0;totalPrecio=0;totalAcuenta=0;totalResta=0;cambiarPagina(t){this.paginacion.pages&&(t<1||t>this.paginacion.pages||(this.page=t,this.buscarSinFolio()))}ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59);this.filtroFechaPedido=this.toYmd(e),this.filtroFechaFin=this.toYmd(i),this.farmaciaService.obtenerFarmacias().subscribe(s=>{this.farmacias=s||[],this.farmacias.length&&(this.filtroFarmaciaId=this.farmacias[0]._id??this.farmacias[0].id??""),this.buscarSinFolio()});let n=this.authService.getUserData();this.usuarioId=n?.id,this.usuarioRol=n?.rol,this.usuarioNombre=n?.nombre}toYmd(t){let e=i=>String(i).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}formatearFecha(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${i}/${n}/${s}`}get mostrarBotonBuscar(){return!!this.filtroFarmaciaId}ordenarPor(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.page=1,this.buscarSinFolio()}buscarSinFolio(){return Q(this,null,function*(){if(!this.filtroFarmaciaId){En.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let t=N=>N?new Date(N).toISOString().slice(0,10):void 0,e=this.filtroFarmaciaId,i=t(this.filtroFechaPedido),n=t(this.filtroFechaFin),s=(this.filtroDescripcion||"").trim()||void 0,d=this.filtroEstado||void 0,p=(this.filtroClienteNombre||"").trim()||void 0,h=!!this.incluirClienteNull,C=this.page||1,E=this.limit||20,D=this.sortBy||"fechaPedido",R=this.sortDir||"desc";this.pedidosService.obtenerPedidos({farmaciaId:e,fechaIni:i,fechaFin:n,folio:void 0,estado:d,descripcion:s,descripcionMinima:!1,page:C,limit:E,sortBy:D,sortDir:R,clienteNombre:p,clienteNull:h}).subscribe({next:N=>{if(console.log("Pedidos",N),!N?.pedidos||N.pedidos.length===0){En.default.fire({icon:"info",title:"Sin resultados",text:"No existen pedidos con esas caracter\xEDsticas.",timer:1500,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0,this.totalCosto=0,this.totalPrecio=0,this.totalAcuenta=0,this.totalResta=0;return}this.pedidos=N.pedidos,this.paginacion=N.paginacion,this.resumen=N.resumen;let A=N?.resumen?.generales??Ad(),U=F=>Number.isFinite(Number(F))?Number(F):0;console.log("globales",A),this.totalCosto=A?U(A.costo):0,this.totalPrecio=A?U(A.total):0,this.totalAcuenta=A?U(A.aCuenta):0,this.totalResta=A?U(A.resta):0,this.totalIngreso=(Number(A.total)||0)-(Number(A.resta)||0),this.utilidadTotal=(Number(A.total)||0)-(Number(A.resta)||0)-(Number(A.costo)||0),this.porcentajeUtilidad=this.totalCosto>0?this.utilidadTotal/this.totalCosto*100:0},error:N=>{console.error("Error al buscar sin folio:",N),En.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.filtroFolio="",this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0}})})}limpiarDescripcion(){return Q(this,null,function*(){this.filtroDescripcion="",this.buscarSinFolio()})}limpiarFechaPedido(){return Q(this,null,function*(){this.filtroFechaPedido="",this.buscarSinFolio()})}limpiarFechaFin(){return Q(this,null,function*(){this.filtroFechaFin="",this.buscarSinFolio()})}limpiarFiltroCompleto(){return Q(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.pedidos=[],this.resumen=Rd()})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}habilitarEdicion(t){this.modoEdicionId=t._id,this.costoEditado=t.costo}cancelarEdicion(){this.modoEdicionId=null,this.costoEditado=null}guardarFila(t){this.costoEditado!==null&&this.pedidosService.actualizarCostoPedido(t._id,this.costoEditado).subscribe({next:e=>{t.costo=e.pedido.costo,this.buscarSinFolio(),En.default.fire({icon:"success",title:"Actualizado",text:"El costo fue actualizado correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("Error al actualizar costo:",e),En.default.fire("Error","No se pudo actualizar el costo.","error")},complete:()=>{this.modoEdicionId=null,this.costoEditado=null}})}static \u0275fac=function(e){return new(e||o)(P(st),P(xn),P(Ne),P($t),P(ze),P(Fe),P(mt))};static \u0275cmp=V({type:o,selectors:[["app-reporte-pedidos"]],viewQuery:function(e,i){if(e&1&&Ee(kg,5),e&2){let n;ye(n=Ce())&&(i.contenedorTicket=n.first)}},decls:53,vars:19,consts:[["mostrarCosto",""],[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","g-2","align-items-center","mb-3"],[1,"col-auto"],["for","filtroFarmaciaId",1,"form-label","mb-0","lbl-pedido"],["id","filtroFarmaciaId",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-auto",2,"margin-left","3rem"],["for","filtroClienteNombre",1,"form-label","mb-0","lbl-pedido"],["id","filtroClienteNombre","type","text","placeholder","Nombre del cliente",1,"form-control",2,"width","220px",3,"ngModelChange","ngModel"],[1,"col-auto","form-check",2,"margin-left","3rem"],["type","checkbox","id","incluirClienteNull",1,"form-check-input",3,"ngModelChange","ngModel"],["for","incluirClienteNull",1,"form-check-label"],[1,"row","mb-2","filtros-container"],[1,"col-md-2"],["for","filtroFechaPedido",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","date",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFechaFin",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-3"],["for","filtroDescripcion",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],["type","text","placeholder","Descripci\xF3n...",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["for","filtroEstado",1,"lbl-pedido"],["id","filtroEstado",1,"form-select",2,"width","150px",3,"ngModelChange","ngModel"],["class","col-md-1","style","margin-top: 1rem;",4,"ngIf"],["class","d-flex justify-content-between align-items-center w-100 mb-2",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","no-found-error",4,"ngIf"],["type","button",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"col-md-1",2,"margin-top","1rem"],[1,"btn-gris",3,"click"],[1,"d-flex","justify-content-between","align-items-center","w-100","mb-2"],[1,"subtitulo","mb-0"],["matTooltip","Cierra la tabla",1,"btn-amarillo-chico","btn-icon-chico",3,"click"],[1,"fas","fa-times"],[1,"tabla"],["role","button","matTooltip","Ordenar por fecha de pedido",1,"sortable",3,"click"],["aria-hidden","true",1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por cliente",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por descripci\xF3n",1,"sortable",3,"click"],[1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por estado",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por costo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por precio",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por anticipo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por resto",1,"sortable",3,"click"],[4,"ngFor","ngForOf"],["colspan","6",1,"text-end","fw-bold"],[1,"fw-bold"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],["class","text-muted",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"d-flex","gap-1","align-items-center"],[1,"d-flex","justify-content-center"],["matTooltip","Editar costo",1,"btn-icon-chico","btn-gris-chico",3,"click","disabled"],["matTooltip","Guardar costo",1,"btn-icon-chico","btn-verde-chico",3,"click","disabled"],["matTooltip","Cancelar",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],[4,"ngIf"],[1,"text-muted"],["type","number",1,"form-control","form-control-sm",2,"width","80px",3,"ngModelChange","ngModel"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","1"],["colspan","2",1,"sub-title-tabla"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"ms-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"ngModelChange","ngModel"],[1,"no-found-error"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"div",2)(2,"h1",3),c(3,"Reporte de Pedidos"),r()(),a(4,"div",4)(5,"div",5)(6,"label",6),c(7,"Farmacia:"),r()(),a(8,"div",5)(9,"select",7),k("ngModelChange",function(s){return O(i.filtroFarmaciaId,s)||(i.filtroFarmaciaId=s),s}),a(10,"option",8),c(11,"-- Selecciona --"),r(),S(12,Dg,2,2,"option",9),r()(),a(13,"div",10)(14,"label",11),c(15,"Cliente:"),r()(),a(16,"div",5)(17,"input",12),k("ngModelChange",function(s){return O(i.filtroClienteNombre,s)||(i.filtroClienteNombre=s),s}),r()(),a(18,"div",13)(19,"input",14),k("ngModelChange",function(s){return O(i.incluirClienteNull,s)||(i.incluirClienteNull=s),s}),r(),a(20,"label",15),c(21," Incluir \u201Csin cliente\u201D "),r()()(),a(22,"div",16)(23,"div",17)(24,"label",18),c(25,"Fecha Inicial:"),r(),a(26,"div",19)(27,"input",20),k("ngModelChange",function(s){return O(i.filtroFechaPedido,s)||(i.filtroFechaPedido=s),s}),r(),S(28,Fg,2,1,"button",21),r()(),a(29,"div",17)(30,"label",22),c(31,"Fecha Final:"),r(),a(32,"div",19)(33,"input",20),k("ngModelChange",function(s){return O(i.filtroFechaFin,s)||(i.filtroFechaFin=s),s}),r(),S(34,Rg,2,1,"button",21),r()(),a(35,"div",23)(36,"label",24),c(37,"Descripci\xF3n:"),r(),a(38,"div",19)(39,"input",25),k("ngModelChange",function(s){return O(i.filtroDescripcion,s)||(i.filtroDescripcion=s),s}),r(),S(40,Ag,2,1,"button",21),r()(),a(41,"div",17)(42,"label",26),c(43,"Estado:"),r(),a(44,"select",27),k("ngModelChange",function(s){return O(i.filtroEstado,s)||(i.filtroEstado=s),s}),a(45,"option",8),c(46,"-- Todos --"),r(),S(47,Vg,2,2,"option",9),r()(),S(48,Ng,3,0,"div",28),r(),S(49,Bg,5,0,"div",29)(50,Gg,66,39,"table",30)(51,Kg,22,12,"div",31)(52,Qg,2,0,"p",32),r()),e&2&&(l(9),T("ngModel",i.filtroFarmaciaId),l(),m("ngValue",null),l(2),m("ngForOf",i.farmacias),l(5),T("ngModel",i.filtroClienteNombre),l(2),T("ngModel",i.incluirClienteNull),l(8),T("ngModel",i.filtroFechaPedido),l(),m("ngIf",i.filtroFechaPedido),l(5),T("ngModel",i.filtroFechaFin),l(),m("ngIf",i.filtroFechaFin),l(5),T("ngModel",i.filtroDescripcion),l(),m("ngIf",i.filtroDescripcion),l(4),T("ngModel",i.filtroEstado),l(),m("ngValue",null),l(2),m("ngForOf",i.estadosPedido),l(),m("ngIf",i.mostrarBotonBuscar),l(),m("ngIf",i.pedidos.length>0),l(),m("ngIf",i.pedidos.length>0),l(),m("ngIf",i.paginacion==null?null:i.paginacion.pages),l(),m("ngIf",i.filtroFolio.length===6&&i.pedidos.length===0))},dependencies:[Je,Ze,me,ce,de,ie,Ae,at,le,Z,xe,j,Qe,Y,z,Te,Re,Me,Ve,_e],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.pedidos-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-pedido[_ngcontent-%COMP%]{font-size:large}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f9f9f9;border-top:2px solid #ccc;font-weight:700}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.ord[_ngcontent-%COMP%]{font-size:.85em;margin-left:.25rem}"],data:{animation:[Hi("expandCollapse",[di("true",At({height:"*",opacity:1,padding:"*",overflow:"hidden"})),di("false",At({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),qi("true <=> false",zi("300ms ease-in-out"))])]}})};var Nd=lt(_t());function Yg(o,t){if(o&1&&(a(0,"option",42),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function Xg(o,t){if(o&1){let e=I();a(0,"button",45),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.selectCliente(n))}),a(1,"div",46),c(2),r()()}if(o&2){let e=t.$implicit;l(2),_(e.nombre||"(sin nombre)")}}function Zg(o,t){if(o&1&&(a(0,"div",43),S(1,Xg,3,1,"button",44),r()),o&2){let e=u();l(),m("ngForOf",e.clienteOpts)}}function Jg(o,t){if(o&1){let e=I();a(0,"div",47)(1,"span",48),c(2),r(),a(3,"button",49),g("click",function(){b(e);let n=u(),s=$e(14);return v(n.clearCliente(s))}),c(4,"Borrar"),r()()}if(o&2){let e=u();l(2),x(" ",e.clienteSel.nombre," ")}}function e_(o,t){if(o&1&&(a(0,"option",42),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function t_(o,t){if(o&1&&(a(0,"small",61),c(1),r()),o&2){let e=u().$implicit;l(),x("CB: ",e.producto.codigoBarras,"")}}function i_(o,t){if(o&1&&(a(0,"tr")(1,"td")(2,"div"),c(3),r(),S(4,t_,2,1,"small",60),r(),a(5,"td",30),c(6),y(7,"number"),r(),a(8,"td",30),c(9),y(10,"number"),r(),a(11,"td",30),c(12),y(13,"number"),r(),a(14,"td"),c(15),r(),a(16,"td"),c(17),r(),a(18,"td",30),c(19),y(20,"number"),r(),a(21,"td",30),c(22),y(23,"number"),r(),a(24,"td",30),c(25),y(26,"number"),r(),a(27,"td",30),c(28),y(29,"number"),r(),a(30,"td",30),c(31),y(32,"number"),r(),a(33,"td",30),c(34),y(35,"number"),r()()),o&2){let e=t.$implicit,i=u(2).$implicit;l(3),_((e==null||e.producto==null?null:e.producto.nombre)||"\u2014"),l(),m("ngIf",e==null||e.producto==null?null:e.producto.codigoBarras),l(2),_(M(7,13,e==null?null:e.cantidad)),l(3),x("$",w(10,15,e==null?null:e.precioOriginal,"1.2-2"),""),l(3),x("$",w(13,18,(e==null?null:e.precioOriginal)*(e==null?null:e.cantidad),"1.2-2")," "),l(3),_(e==null?null:e.tipoDescuento),l(2),_(e==null?null:e.cadenaDescuento),l(2),x("$",w(20,21,e==null?null:e.monederoCliente,"1.2-2"),""),l(3),x("$",w(23,24,e==null?null:e.descuento,"1.2-2"),""),l(3),x("$",w(26,27,(e==null?null:e.costo)*(e==null?null:e.cantidad),"1.2-2"),""),l(3),x("$",w(29,30,(e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad)-(i==null||i.formaPago==null?null:i.formaPago.vale),"1.2-2"),""),l(3),x("",w(32,33,((e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad))/((e==null?null:e.costo)*(e==null?null:e.cantidad))*100,"1.2-2"),"%"),l(3),x("$",w(35,36,e==null?null:e.totalRen,"1.2-2"),"")}}function n_(o,t){o&1&&(a(0,"tr")(1,"td",62),c(2,"Sin renglones"),r()())}function o_(o,t){if(o&1&&(a(0,"tr")(1,"td",53)(2,"div",54)(3,"table",55)(4,"thead")(5,"tr")(6,"th"),c(7,"Producto"),r(),a(8,"th",30),c(9,"Cant."),r(),a(10,"th",30),c(11,"P. U."),r(),a(12,"th",30),c(13,"Imp. normal"),r(),a(14,"th"),c(15,"Promo"),r(),a(16,"th"),c(17,"% desc"),r(),a(18,"th",30),c(19,"Monedero"),r(),a(20,"th",30),c(21,"Desc."),r(),a(22,"th",30),c(23,"Costo"),r(),a(24,"th",30),c(25,"Utilidad"),r(),a(26,"th",30),c(27,"% Gan."),r(),a(28,"th",30),c(29,"Total"),r()()(),a(30,"tbody"),S(31,i_,36,39,"tr",31)(32,n_,3,0,"tr",32),r()()(),a(33,"div",56)(34,"div",57)(35,"div",58)(36,"strong"),c(37,"Forma de pago:"),r()(),a(38,"div",59),c(39,"Efectivo: "),a(40,"strong"),c(41),y(42,"number"),r()(),a(43,"div",59),c(44,"Tarjeta: "),a(45,"strong"),c(46),y(47,"number"),r()(),a(48,"div",59),c(49,"Transferencia: "),a(50,"strong"),c(51),y(52,"number"),r()(),a(53,"div",59),c(54,"Monedero: "),a(55,"strong"),c(56),y(57,"number"),r()()()()()()),o&2){let e=u().$implicit;l(31),m("ngForOf",e.productos),l(),m("ngIf",!e.productos||e.productos.length===0),l(9),x(" $",w(42,6,(e==null||e.formaPago==null?null:e.formaPago.efectivo)||0,"1.2-2"),""),l(5),x(" $",w(47,9,(e==null||e.formaPago==null?null:e.formaPago.tarjeta)||0,"1.2-2"),""),l(5),x(" $",w(52,12,(e==null||e.formaPago==null?null:e.formaPago.transferencia)||0,"1.2-2"),""),l(5),x(" $",w(57,15,(e==null||e.formaPago==null?null:e.formaPago.vale)||0,"1.2-2"),"")}}function r_(o,t){if(o&1){let e=I();oe(0),a(1,"tr")(2,"td",50)(3,"button",51),g("click",function(){let n=b(e).$implicit,s=u();return v(s.toggleDetalle(n))}),f(4,"fa-icon",52),r()(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td"),c(10),y(11,"date"),r(),a(12,"td"),c(13),r(),a(14,"td"),c(15),r(),a(16,"td"),c(17),y(18,"number"),r(),a(19,"td",30),c(20),y(21,"number"),r(),a(22,"td",30),c(23),y(24,"number"),r(),a(25,"td",30),c(26),y(27,"number"),r(),a(28,"td",30),c(29),y(30,"number"),r(),a(31,"td",30),c(32),y(33,"number"),r(),a(34,"td",30),c(35),y(36,"number"),r()(),S(37,o_,58,18,"tr",32),re()}if(o&2){let e=t.$implicit,i=u();l(3),m("disabled",i.cargando)("matTooltip",i.isExpanded(e)?"Cerrar detalle de venta":"Mostrar detalle de venta"),l(),m("icon",i.isExpanded(e)?"chevron-up":"chevron-down"),l(2),_((e.farmacia==null?null:e.farmacia.nombre)||"\u2014"),l(2),_((e.usuario==null?null:e.usuario.nombre)||"\u2014"),l(2),_(pt(11,16,e.fecha,"dd/MM/yyyy HH:mm","America/Mexico_City")),l(3),_(e.folio),l(2),_((e.cliente==null?null:e.cliente.nombre)||"\u2014"),l(2),_(M(18,20,e.cantidadProductos)),l(3),x("$",w(21,22,e.totalMonederoCliente,"1.2-2"),""),l(3),x("$",w(24,25,e.totalDescuento,"1.2-2"),""),l(3),x("$",w(27,28,e._costo,"1.2-2"),""),l(3),x("$",w(30,31,e._utilidad-(e==null||e.formaPago==null?null:e.formaPago.vale),"1.2-2"),""),l(3),x("",w(33,34,e._utilidad/e._costo*100,"1.2-2"),"%"),l(3),x("$",w(36,37,e.total,"1.2-2"),""),l(2),m("ngIf",i.isExpanded(e))}}function a_(o,t){o&1&&(a(0,"tr")(1,"td",63),c(2,"Sin resultados"),r()())}function s_(o,t){if(o&1&&(a(0,"tfoot")(1,"tr")(2,"td",64)(3,"strong"),c(4,"Totales ===>"),r()(),a(5,"td",65),c(6),r(),a(7,"td",65),c(8),y(9,"number"),r(),a(10,"td",65),c(11),y(12,"number"),r(),a(13,"td",65),c(14),y(15,"number"),r(),a(16,"td",65),c(17),y(18,"number"),r(),a(19,"td",65),c(20),y(21,"number"),r(),a(22,"td",30)(23,"strong"),c(24),y(25,"number"),r()()()()),o&2){let e=u();l(6),_(e.sumaCantidadProductos),l(2),x("$",w(9,7,e.sumaTotalMonederoCliente,"1.2-2"),""),l(3),x("$",w(12,10,e.sumaTotalDescuento,"1.2-2"),""),l(3),x("$",w(15,13,e.sumaCosto,"1.2-2"),""),l(3),x("$",w(18,16,e.sumaUtilidad,"1.2-2"),""),l(3),x("",w(21,19,e.sumaUtilidad/e.sumaCosto*100,"1.2-2"),"% "),l(4),x("$",w(25,22,e.sumaTotalFiltro,"1.2-2"),"")}}var Pr=class o{constructor(t,e,i,n,s,d){this.fb=t;this.reportes=e;this.farmaciaSrv=i;this.clienteSrv=n;this.usuarioSrv=s;this.faLib=d;this.faLib.addIcons(Tc,pc)}clienteSel=null;clienteOpts=[];filtroForm;cargando=!1;rows=[];farmacias=[];clientes=[];usuarios=[];farmaciasCargadas=!1;clientesCargados=!1;usuariosCargados=!1;page=1;limit=20;totalPaginas=0;totalRegistros=0;totalPagina=0;sumaTotalFiltro=0;sumaCantidadProductos=0;sumaTotalDescuento=0;sumaTotalMonederoCliente=0;sumaCosto=0;sumaUtilidad=0;expandedId=null;collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});clientesBase=[];clientesIdx=[];sugerenciasClientes=[];mostrandoSugerencias=!1;focoSugerencia=-1;sortByNombre(t){return[...t||[]].sort((e,i)=>(e.nombre||"").localeCompare(i.nombre||"","es",{sensitivity:"base"}))}ngOnInit(){let t=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaInicial:[t],fechaFinal:[t],clienteId:[""],clienteNombre:[""],usuarioId:[""],totalDesde:[""],totalHasta:[""],limit:[this.limit]}),this.filtroForm.get("clienteNombre").valueChanges.pipe(Ft(200),Rt()).subscribe(e=>this.onClienteNombreChanged(e||"")),this.cargarCatalogos()}onClienteInput(t){let e=(t||"").trim();if(e.length<2){this.clienteOpts=[];return}this.clienteSrv.searchClientes(e).subscribe(i=>this.clienteOpts=i)}selectCliente(t){this.clienteSel=t,this.clienteOpts=[],this.filtroForm.patchValue({clienteId:t._id}),this.buscar(!0)}clearCliente(t){this.clienteSel=null,this.filtroForm.patchValue({clienteId:null}),this.clienteOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0)),this.buscar(!0)}normalizeEs(t){return(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}rankNombre(t,e,i){let n=this.normalizeEs(i).split(" ").filter(Boolean);if(!n.length)return{score:-1,pos:1/0};let s=0,d=1/0;for(let p of n){let h=t.indexOf(p);if(h===-1)return{score:-1,pos:1/0};let C=e.some(E=>E.startsWith(p));s+=C?2:1,h<d&&(d=h)}return{score:s,pos:d}}tokenizeTerm(t){return this.normalizeEs(t).split(/\s+/).filter(Boolean)}scoreMatch(t,e){let i=this.normalizeEs(t),n=this.normalizeEs(e).split(" ").filter(Boolean);if(!n.length)return{score:-1,pos:1/0};let s=0,d=1/0;for(let p of n){let h=i.indexOf(p);if(h===-1)return{score:-1,pos:1/0};let C=h===0||i.charAt(h-1)===" ";s+=C?2:1,d=Math.min(d,h)}return{score:s,pos:d}}onClienteNombreChanged(t){let e=(t||"").trim();if(!e){this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.filtroForm.value.clienteId&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});return}let i=this.filtroForm.value.clienteNombre||"";(this.filtroForm.value.clienteId||"")&&this.normalizeEs(i)!==this.normalizeEs(e)&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});let s=this.clientesIdx.map(d=>({c:{_id:d._id,nombre:d.nombre},r:this.rankNombre(d.norm,d.words,e)})).filter(d=>d.r.score>=0).sort((d,p)=>p.r.score-d.r.score||d.r.pos-p.r.pos||this.collator.compare(d.c.nombre,p.c.nombre)).slice(0,100).map(d=>d.c);this.sugerenciasClientes=s,this.mostrandoSugerencias=!0,this.focoSugerencia=-1}seleccionarCliente(t){this.filtroForm.patchValue({clienteId:t._id,clienteNombre:t.nombre},{emitEvent:!1}),this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}limpiarCliente(){this.filtroForm.patchValue({clienteId:"",clienteNombre:""},{emitEvent:!1}),this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}onClienteKeyDown(t){if(!(!this.mostrandoSugerencias||!this.sugerenciasClientes.length))if(t.key==="ArrowDown")t.preventDefault(),this.focoSugerencia=Math.min(this.focoSugerencia+1,this.sugerenciasClientes.length-1);else if(t.key==="ArrowUp")t.preventDefault(),this.focoSugerencia=Math.max(this.focoSugerencia-1,0);else if(t.key==="Enter"){t.preventDefault();let e=this.sugerenciasClientes[this.focoSugerencia]??this.sugerenciasClientes[0];e&&this.seleccionarCliente(e)}else t.key==="Escape"&&(this.mostrandoSugerencias=!1)}onClienteFocus(){let t=(this.filtroForm.value.clienteNombre||"").trim();t?this.onClienteNombreChanged(t):this.mostrandoSugerencias=!1}onClienteBlur(){setTimeout(()=>{this.mostrandoSugerencias=!1},150)}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{let e=this.sortByNombre(t||[]);this.farmacias=[{_id:"",nombre:"TODAS"},...e],this.farmaciasCargadas=!0,this.dispararInicialSiListos()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.dispararInicialSiListos()}}),this.clienteSrv.getClientes().subscribe({next:t=>{let i=(Array.isArray(t)?t:t?.rows??[]).map(s=>({_id:s._id?.toString()||"",nombre:s.nombre||""})),n=this.sortByNombre(i);this.clientesBase=n,this.clientesIdx=n.map(s=>{let d=this.normalizeEs(s.nombre),p=d.split(" ").filter(Boolean);return{_id:s._id,nombre:s.nombre,norm:d,words:p}}),this.clientes=[{_id:"",nombre:"TODOS"},...n],this.clientesCargados=!0,this.dispararInicialSiListos()},error:()=>{this.clientesBase=[],this.clientesIdx=[],this.clientes=[{_id:"",nombre:"TODOS"}],this.clientesCargados=!0,this.dispararInicialSiListos()}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{let e=this.sortByNombre(t||[]),i={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[i,...e],this.usuariosCargados=!0,this.dispararInicialSiListos()},error:()=>{let t={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[t],this.usuariosCargados=!0,this.dispararInicialSiListos()}})}dispararInicialSiListos(){this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados&&this.buscar(!0)}resetPaginacion(){this.expandedId=null,this.page=1}limpiar(){let t=this.todayYMD();this.filtroForm.reset({farmaciaId:"",fechaInicial:t,fechaFinal:t,clienteId:"",usuarioId:"",totalDesde:"",totalHasta:"",limit:this.limit}),this.resetPaginacion(),this.buscar(!0)}buscar(t=!1){if(!(this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados))return;t&&this.resetPaginacion();let e=this.filtroForm.value;this.limit=Number(e.limit)||20;let i={farmaciaId:e.farmaciaId||void 0,clienteId:e.clienteId||void 0,usuarioId:e.usuarioId||void 0,totalDesde:e.totalDesde!==""&&e.totalDesde!=null?Number(e.totalDesde):void 0,totalHasta:e.totalHasta!==""&&e.totalHasta!=null?Number(e.totalHasta):void 0,fechaInicial:e.fechaInicial,fechaFinal:e.fechaFinal,page:this.page,limit:this.limit};this.cargando=!0,this.reportes.getVentas(i).subscribe({next:n=>{let s=d=>Number.isFinite(Number(d))?Number(d):0;this.rows=(n?.ventas||[]).map(d=>{let h=(Array.isArray(d?.productos)?d.productos:[]).reduce((E,D)=>E+s(D?.costo)*s(D?.cantidad),0),C=s(d?.total)-h;return qe(ae({},d),{_costo:d._costo??Number(h.toFixed(2)),_utilidad:d._utilidad??Number(C.toFixed(2))})}),this.totalRegistros=n?.paginacion?.totalRegistros||0,this.totalPaginas=n?.paginacion?.totalPaginas||0,this.sumaTotalFiltro=n?.resumen?.sumaTotalFiltro??0,this.sumaCantidadProductos=n?.resumen?.sumaCantidadProductos??0,this.sumaTotalDescuento=n?.resumen?.sumaTotalDescuento??0,this.sumaTotalMonederoCliente=n?.resumen?.sumaTotalMonederoCliente??0,this.sumaCosto=n?.resumen?.sumaCosto??0,this.sumaUtilidad=n?.resumen?.sumaUtilidad??0,this.totalPagina=this.rows.reduce((d,p)=>d+s(p.total),0),this.cargando=!1},error:n=>{this.cargando=!1,this.rows=[],this.totalRegistros=0,this.totalPaginas=0,this.totalPagina=0,this.sumaTotalFiltro=0,this.sumaCantidadProductos=0,this.sumaTotalDescuento=0,this.sumaTotalMonederoCliente=0,this.sumaCosto=0,this.sumaUtilidad=0;let s=n?.error?.mensaje||"No se pudo consultar el reporte.";Nd.default.fire("Error",s,"error")}})}toggleDetalle(t){let e=String(t?._id||"");e&&(this.expandedId=this.expandedId===e?null:e)}isExpanded(t){let e=String(t?._id||"");return!!e&&this.expandedId===e}todayYMD(){let t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${n}`}primera(){this.page!==1&&(this.page=1,this.buscar())}anterior(){this.page>1&&(this.page--,this.buscar())}siguiente(){this.page<this.totalPaginas&&(this.page++,this.buscar())}ultima(){this.page!==this.totalPaginas&&(this.page=this.totalPaginas,this.buscar())}static \u0275fac=function(e){return new(e||o)(P(He),P(zt),P(ze),P($t),P(gn),P(st))};static \u0275cmp=V({type:o,selectors:[["app-reporte-ventas"]],decls:93,vars:21,consts:[["cliInput",""],[1,"container-ventas"],[1,"titulo","text-center"],[1,"mb-2","filtros"],[1,"row","g-2","align-items-end",3,"formGroup"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-3","position-relative"],["type","text","placeholder","Escribe nombre (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-md-3",2,"align-items","end"],["formControlName","usuarioId",1,"form-select",3,"change","disabled"],["type","number","formControlName","limit","min","1","max","200",1,"form-control"],[1,"mt-3","row"],[1,"col-md-2"],["type","date","formControlName","fechaInicial",1,"form-control"],["type","date","formControlName","fechaFinal",1,"form-control"],["type","number","formControlName","totalDesde","min","0","step","0.01",1,"form-control"],["type","number","formControlName","totalHasta","min","0","step","0.01",1,"form-control"],[1,"col-2",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-2","text-end",2,"margin-top","1.3rem"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"mt-2"],[1,"tabla"],[2,"width","40px"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[3,"ngValue"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[1,"text-center"],[1,"btn-icon-chico","btn-gris-chico",3,"click","disabled","matTooltip"],[3,"icon"],["colspan","13",2,"background","#fafafa"],[1,"table-responsive"],[1,"detalle-tabla"],[1,"mt-1",2,"background-color","aquamarine"],[1,"row","align-items-end"],[1,"col-4","subtitulo"],[1,"col-2"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","10",1,"text-center","text-muted","py-2"],["colspan","13",1,"text-center","text-muted","py-3"],["colspan","6",1,"text-end"],[1,"text-end",2,"font-weight","600"]],template:function(e,i){if(e&1){let n=I();a(0,"div",1)(1,"h2",2),c(2,"Reporte de Ventas"),r(),a(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),c(7,"Farmacia"),r(),a(8,"select",7),g("change",function(){return b(n),v(i.buscar(!0))}),S(9,Yg,2,2,"option",8),r()(),a(10,"div",9)(11,"label",6),c(12,"Cliente"),r(),a(13,"input",10,0),g("input",function(){b(n);let d=$e(14);return v(i.onClienteInput(d.value))}),r(),S(15,Zg,2,1,"div",11)(16,Jg,5,1,"div",12),r(),a(17,"div",13)(18,"label",6),c(19,"Vendi\xF3:"),r(),a(20,"select",14),g("change",function(){return b(n),v(i.buscar(!0))}),S(21,e_,2,2,"option",8),r()(),a(22,"div",5)(23,"label",6),c(24,"# de Ventas por p\xE1gina"),r(),f(25,"input",15),r(),a(26,"div",16)(27,"div",17)(28,"label",6),c(29,"Fecha inicial"),r(),f(30,"input",18),r(),a(31,"div",17)(32,"label",6),c(33,"Fecha final"),r(),f(34,"input",19),r(),a(35,"div",17)(36,"label",6),c(37,"Total desde"),r(),f(38,"input",20),r(),a(39,"div",17)(40,"label",6),c(41,"Total hasta"),r(),f(42,"input",21),r(),a(43,"div",22)(44,"button",23),g("click",function(){return b(n),v(i.limpiar())}),f(45,"i",24),r()(),a(46,"div",25)(47,"button",26),g("click",function(){return b(n),v(i.buscar(!0))}),c(48),r()()()()(),a(49,"div",27)(50,"table",28)(51,"thead")(52,"tr")(53,"th",29),c(54,"Det."),r(),a(55,"th"),c(56,"Farmacia"),r(),a(57,"th"),c(58,"Vendi\xF3"),r(),a(59,"th"),c(60,"Fecha"),r(),a(61,"th"),c(62,"Folio"),r(),a(63,"th"),c(64,"Cliente"),r(),a(65,"th",30),c(66,"# Prod."),r(),a(67,"th",30),c(68,"Al moned."),r(),a(69,"th",30),c(70,"Descuento"),r(),a(71,"th",30),c(72,"Costo"),r(),a(73,"th",30),c(74,"Utilidad"),r(),a(75,"th",30),c(76,"% Gan."),r(),a(77,"th",30),c(78,"Total"),r()()(),a(79,"tbody"),S(80,r_,38,40,"ng-container",31)(81,a_,3,0,"tr",32),r(),S(82,s_,26,25,"tfoot",32),r(),a(83,"div",33)(84,"button",34),g("click",function(){return b(n),v(i.primera())}),f(85,"i",35),r(),a(86,"button",36),g("click",function(){return b(n),v(i.anterior())}),f(87,"i",37),r(),c(88),a(89,"button",38),g("click",function(){return b(n),v(i.siguiente())}),f(90,"i",39),r(),a(91,"button",40),g("click",function(){return b(n),v(i.ultima())}),f(92,"i",41),r()()()()}e&2&&(l(4),m("formGroup",i.filtroForm),l(4),m("disabled",!i.farmaciasCargadas||i.cargando),l(),m("ngForOf",i.farmacias),l(4),m("disabled",i.cargando||!!i.clienteSel),l(2),m("ngIf",i.clienteOpts.length&&!i.clienteSel),l(),m("ngIf",i.clienteSel),l(4),m("disabled",i.cargando||!i.usuariosCargados),l(),m("ngForOf",i.usuarios),l(23),m("disabled",i.cargando),l(3),m("disabled",i.cargando),l(),x(" ",i.cargando?"Buscando...":"Buscar"," "),l(32),m("ngForOf",i.rows),l(),m("ngIf",i.rows.length===0),l(),m("ngIf",i.rows.length>0),l(2),m("disabled",i.cargando||i.page===1),l(2),m("disabled",i.cargando||i.page===1),l(2),jt(" Ventas: ",i.totalRegistros," \xA0 | \xA0 P\xE1gina: ",i.page," / ",i.totalPaginas||1," "),l(),m("disabled",i.cargando||i.page===i.totalPaginas||i.totalPaginas===0),l(2),m("disabled",i.cargando||i.page===i.totalPaginas||i.totalPaginas===0))},dependencies:[j,Y,z,Te,Me,De,ke,ce,de,ie,Ae,le,Z,Oe,Et,xi,Ye,Xe,Je,Ze,Ve,_e],styles:[".container-ventas[_ngcontent-%COMP%]{width:100%}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sugerencias[_ngcontent-%COMP%]   .list-group-item.active[_ngcontent-%COMP%]{background-color:#f0f0f0;color:inherit}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;margin-top:.25rem;max-height:320px;overflow:auto;box-shadow:0 .25rem .75rem #00000014}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.5rem .75rem;border:0;background:transparent}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8fafc}"]})};var Bd=lt(_t());var Wi=(o,t)=>({"text-success":o,"text-negativo":t});function l_(o,t){if(o&1&&(a(0,"option",21),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function c_(o,t){if(o&1&&(a(0,"tr")(1,"td",22),c(2),r(),a(3,"td",19),c(4),y(5,"number"),r(),a(6,"td",20),c(7),y(8,"number"),r(),a(9,"td",19),c(10),y(11,"number"),r(),a(12,"td",20),c(13),y(14,"number"),r(),a(15,"td",20),c(16),y(17,"number"),r()()),o&2){let e=t.$implicit;l(),m("ngClass",ht(24,Wi,e.concepto=="Ventas"||e.concepto=="Pedidos",e.concepto=="Devoluciones"||e.concepto=="Cancelaciones")),l(),x(" ",e.concepto," "),l(2),_(M(5,10,e.cantidad)),l(2),m("ngClass",ht(27,Wi,e.importe>=0,e.importe<0)),l(),x(" $",w(8,12,e.importe,"1.2-2")," "),l(3),x("$",w(11,15,e.costo,"1.2-2"),""),l(2),m("ngClass",ht(30,Wi,e.utilidad>=0,e.utilidad<0)),l(),x(" $",w(14,18,e.utilidad,"1.2-2")," "),l(2),m("ngClass",ht(33,Wi,e.utilidad>=0,e.utilidad<0)),l(),x(" ",e.costo==0?0:w(17,21,e.utilidad/e.costo*100,"1.2-2"),"% ")}}var Ir=class o{constructor(t,e,i){this.fb=t;this.reportes=e;this.farmaciaSrv=i}filtroForm;cargando=!1;rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}];farmacias=[];farmaciasCargadas=!1;totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;ngOnInit(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaIni:[t],fechaFin:[e]}),this.cargarFarmacias(),this.limpiar()}cargarFarmacias(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.farmaciasCargadas=!0,this.buscar()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.buscar()}})}todayYMD(){let t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${n}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");return`${e}-${i}-01`}limpiar(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm.patchValue({farmaciaId:"",fechaIni:t,fechaFin:e}),this.filtroForm.markAsPristine(),this.filtroForm.markAsUntouched(),this.buscar()}buscar(){if(!this.farmaciasCargadas)return;let t=this.filtroForm.value,e={farmaciaId:t.farmaciaId||void 0,fechaIni:t.fechaIni,fechaFin:t.fechaFin};this.cargando=!0,this.reportes.getResumenUtilidades(e).subscribe({next:i=>{let n={};(i.rows||[]).forEach(p=>{n[p.concepto]=p});let s=p=>Number.isFinite(+p)?+p:0,d=p=>{let h=n[p]||{concepto:p,cantidad:0,importe:0,costo:0,utilidad:0};return{concepto:p,cantidad:s(h.cantidad),importe:s(h.importe),costo:s(h.costo),utilidad:s(h.utilidad)}};this.rows=[d("Ventas"),d("Pedidos"),d("Devoluciones"),d("Cancelaciones")],this.totalCantidad=this.rows.reduce((p,h)=>p+h.cantidad,0),this.totalImporte=this.rows.reduce((p,h)=>p+h.importe,0),this.totalCosto=this.rows.reduce((p,h)=>p+h.costo,0),this.totalUtilidad=this.rows.reduce((p,h)=>p+h.utilidad,0),this.cargando=!1},error:i=>{this.cargando=!1,this.rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}],this.totalCantidad=this.totalImporte=this.totalCosto=this.totalUtilidad=0;let n=i?.error?.mensaje||i?.message||"No se pudo consultar el resumen de utilidades.";Bd.default.fire("Error",n,"error")}})}static \u0275fac=function(e){return new(e||o)(P(He),P(zt),P(ze))};static \u0275cmp=V({type:o,selectors:[["app-reporte-resumen-utilidades"]],decls:60,vars:40,consts:[[1,"container-fluid"],[1,"titulo","text-center"],[1,"row","align-items-end","mb-2",3,"formGroup"],[1,"row","g-2","align-items-end","mb-3","filtros"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-2"],["type","date","formControlName","fechaIni",1,"form-control",3,"change","disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"change","disabled"],[1,"col-auto","ms-auto"],[1,"btn","btn-amarillo",3,"click","disabled"],[1,"btn","btn-gris","ms-4",3,"click","disabled"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"fw-bold"],[1,"text-end","text-success"],[1,"text-end",3,"ngClass"],[3,"ngValue"],[3,"ngClass"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h3",1),c(2,"Resumen utilidades"),r(),a(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),c(7,"Farmacia"),r(),a(8,"select",6),g("change",function(){return i.buscar()}),S(9,l_,2,2,"option",7),r()(),a(10,"div",8)(11,"label",5),c(12,"Fecha inicial"),r(),a(13,"input",9),g("change",function(){return i.buscar()}),r()(),a(14,"div",8)(15,"label",5),c(16,"Fecha final"),r(),a(17,"input",10),g("change",function(){return i.buscar()}),r()(),a(18,"div",11)(19,"button",12),g("click",function(){return i.limpiar()}),c(20,"Hoy / Mes actual"),r(),a(21,"button",13),g("click",function(){return i.buscar()}),c(22),r()()()(),a(23,"div",14)(24,"table",15)(25,"thead")(26,"tr")(27,"th"),c(28,"Concepto"),r(),a(29,"th",16),c(30,"Cant. Movim."),r(),a(31,"th",16),c(32,"Importe"),r(),a(33,"th",16),c(34,"Costo"),r(),a(35,"th",16),c(36,"Utilidad"),r(),a(37,"th",16),c(38,"% Gan."),r()()(),a(39,"tbody"),S(40,c_,18,36,"tr",17),r(),a(41,"tfoot")(42,"tr",18)(43,"td",16),c(44,"Totales:"),r(),a(45,"td",19),c(46),y(47,"number"),r(),a(48,"td",20),c(49),y(50,"number"),r(),a(51,"td",19),c(52),y(53,"number"),r(),a(54,"td",20),c(55),y(56,"number"),r(),a(57,"td",20),c(58),y(59,"number"),r()()()()()()),e&2&&(l(3),m("formGroup",i.filtroForm),l(5),m("disabled",!i.farmaciasCargadas||i.cargando),l(),m("ngForOf",i.farmacias),l(4),m("disabled",i.cargando),l(4),m("disabled",i.cargando),l(2),m("disabled",i.cargando),l(2),m("disabled",i.cargando),l(),x(" ",i.cargando?"Consultando\u2026":"Buscar"," "),l(18),m("ngForOf",i.rows),l(6),_(M(47,17,i.totalCantidad)),l(2),m("ngClass",ht(31,Wi,i.totalImporte>=0,i.totalImporte<0)),l(),x(" $",w(50,19,i.totalImporte,"1.2-2"),""),l(3),x("$",w(53,22,i.totalCosto,"1.2-2"),""),l(2),m("ngClass",ht(34,Wi,i.totalUtilidad>=0,i.totalUtilidad<0)),l(),x(" $",w(56,25,i.totalUtilidad,"1.2-2")," "),l(2),m("ngClass",ht(37,Wi,i.totalUtilidad>=0,i.totalUtilidad<0)),l(),x(" ",i.totalCosto==0?0:w(59,28,i.totalUtilidad/i.totalCosto*100,"1.2-2"),"% "))},dependencies:[j,Qe,Y,Te,De,ke,ce,de,ie,le,Z,Oe,Ye,Xe],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-negativo[_ngcontent-%COMP%]{color:red}"]})};var Gi=lt(_t());var Aa=()=>({campo:"ventas",dir:"desc"}),Va=()=>({campo:"utilidad",dir:"desc"}),Na=()=>({campo:"ventas",dir:"asc"}),Ba=()=>({campo:"utilidad",dir:"asc"}),wn=(o,t)=>({"text-success":o,"text-danger":t});function d_(o,t){if(o&1&&(a(0,"option",28),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function m_(o,t){if(o&1&&(a(0,"div",3)(1,"div",23)(2,"label",5),c(3,"Usuario"),r(),a(4,"select",24)(5,"option",25),c(6,"(Todos)"),r(),S(7,d_,2,2,"option",26),r()(),a(8,"div",23)(9,"label",5),c(10,"Los mejores / peores por:"),r(),a(11,"select",27)(12,"option",28),c(13,"N\xFAm. de ventas las mejores"),r(),a(14,"option",28),c(15,"Utilidad las mejores"),r(),a(16,"option",28),c(17,"N\xFAm. de ventas las peores"),r(),a(18,"option",28),c(19,"Utilidad las peores"),r()()()()),o&2){let e=u();l(4),m("disabled",e.cargando),l(3),m("ngForOf",e.usuarios),l(4),m("disabled",e.cargando),l(),m("ngValue",Ke(7,Aa)),l(2),m("ngValue",Ke(8,Va)),l(2),m("ngValue",Ke(9,Na)),l(2),m("ngValue",Ke(10,Ba))}}function p_(o,t){if(o&1&&(a(0,"option",28),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function u_(o,t){if(o&1&&(a(0,"div",3)(1,"div",29)(2,"label",5),c(3,"Cliente"),r(),a(4,"select",30)(5,"option",25),c(6,"(Todos)"),r(),S(7,p_,2,2,"option",26),r()(),a(8,"div",4)(9,"label",5),c(10,"\xBFCu\xE1ntos clientes?"),r(),f(11,"input",31),r(),a(12,"div",23)(13,"label",5),c(14,"Los mejores / peores por:"),r(),a(15,"select",32)(16,"option",28),c(17,"N\xFAm. de compras las mejores"),r(),a(18,"option",28),c(19,"Utilidad las mejores"),r(),a(20,"option",28),c(21,"N\xFAm. de compras las peores"),r(),a(22,"option",28),c(23,"Utilidad las peores"),r()()()()),o&2){let e=u();l(4),m("disabled",e.cargando),l(3),m("ngForOf",e.clientes),l(4),m("disabled",e.cargando||!!e.filtroForm.value.clienteId),l(4),m("disabled",e.cargando),l(),m("ngValue",Ke(8,Aa)),l(2),m("ngValue",Ke(9,Va)),l(2),m("ngValue",Ke(10,Na)),l(2),m("ngValue",Ke(11,Ba))}}function f_(o,t){if(o&1&&(a(0,"option",28),c(1),r()),o&2){let e=t.$implicit;m("ngValue",e._id),l(),_(e.nombre)}}function h_(o,t){if(o&1&&(a(0,"div",40),c(1),r()),o&2){let e=u(2);l(),x(" ",e.errorProductoCB," ")}}function g_(o,t){if(o&1){let e=I();a(0,"div",3)(1,"div",23)(2,"label",5),c(3,"Farmacia"),r(),a(4,"select",33)(5,"option",25),c(6,"TODAS"),r(),S(7,f_,2,2,"option",26),r()(),a(8,"div",29)(9,"label",5),c(10,"C\xF3digo de barras"),r(),a(11,"input",34),g("keyup.enter",function(){b(e);let n=u();return v(n.resolverProductoPorCB())}),r(),S(12,h_,2,1,"div",35),r(),a(13,"div",36)(14,"label",5),c(15,"Producto"),r(),f(16,"input",37),r(),a(17,"div",4)(18,"label",5),c(19,"\xBFCu\xE1ntos productos?"),r(),f(20,"input",38),r(),a(21,"div",4)(22,"label",5),c(23,"Los mejores / peores por: "),r(),a(24,"select",39)(25,"option",28),c(26,"N\xFAm. de Ventas las mejores"),r(),a(27,"option",28),c(28,"Utilidad las mejores"),r(),a(29,"option",28),c(30,"N\xFAm. de Ventas las peores"),r(),a(31,"option",28),c(32,"Utilidad las peores"),r()()()()}if(o&2){let e=u();l(4),m("disabled",e.cargando),l(3),m("ngForOf",e.farmacias),l(4),m("disabled",e.cargando),l(),m("ngIf",e.errorProductoCB),l(4),m("value",e.productoResueltoNombre),l(4),m("disabled",e.cargando&&!e.filtroForm.value.productoId),l(4),m("disabled",e.cargando),l(),m("ngValue",Ke(11,Aa)),l(2),m("ngValue",Ke(12,Va)),l(2),m("ngValue",Ke(13,Na)),l(2),m("ngValue",Ke(14,Ba))}}function __(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),r(),a(3,"td",43),c(4),y(5,"number"),r(),a(6,"td",45),c(7),y(8,"number"),r(),a(9,"td",46),c(10),y(11,"number"),r(),a(12,"td",43),c(13),y(14,"number"),r(),a(15,"td",45),c(16),y(17,"number"),r(),a(18,"td",46),c(19),y(20,"number"),r(),a(21,"td",45),c(22),y(23,"number"),r(),a(24,"td",46),c(25),y(26,"number"),r(),a(27,"td",47),c(28),y(29,"number"),r(),a(30,"td",43),c(31),y(32,"number"),r()()),o&2){let e=t.$implicit;l(2),_(e.usuario||e.usuarioNombre||e.nombre||"(sin nombre)"),l(2),_(M(5,12,e.numVentas||e.ventasCount)),l(3),x("$",w(8,14,e.impVentas,"1.2-2"),""),l(3),x("$",w(11,17,e.costoVentas,"1.2-2"),""),l(3),_(M(14,20,e.numPedidos||e.pedidosCount)),l(3),x("$",w(17,22,e.impPedidos,"1.2-2"),""),l(3),x("$",w(20,25,e.costoPedidos,"1.2-2"),""),l(3),x("$",w(23,28,e.ingresos,"1.2-2"),""),l(3),x("$",w(26,31,e.egresos,"1.2-2"),""),l(2),m("ngClass",ht(40,wn,(e.utilidad||0)>=0,(e.utilidad||0)<0)),l(),x(" $",w(29,34,e.utilidad,"1.2-2")," "),l(3),_(e.gananciaPct==null?"\u2014":w(32,37,e.gananciaPct,"1.0-2")+"%")}}function b_(o,t){o&1&&(a(0,"tr")(1,"td",48),c(2,"Sin resultados"),r()())}function v_(o,t){if(o&1&&(a(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),c(4,"Totales:"),r()(),a(5,"td",43)(6,"strong"),c(7),y(8,"number"),r()(),a(9,"td",45)(10,"strong"),c(11),y(12,"number"),r()(),a(13,"td",46)(14,"strong"),c(15),y(16,"number"),r()(),a(17,"td",43)(18,"strong"),c(19),y(20,"number"),r()(),a(21,"td",45)(22,"strong"),c(23),y(24,"number"),r()(),a(25,"td",46)(26,"strong"),c(27),y(28,"number"),r()(),a(29,"td",45)(30,"strong"),c(31),y(32,"number"),r()(),a(33,"td",46)(34,"strong"),c(35),y(36,"number"),r()(),a(37,"td",47)(38,"strong"),c(39),y(40,"number"),r()(),a(41,"td",43)(42,"strong"),c(43),y(44,"number"),r()()()()),o&2){let e=u(2);l(7),_(M(8,11,e.footerUsuarios.totalVentas)),l(4),x("$",w(12,13,e.footerUsuarios.totalImpVentas,"1.2-2"),""),l(4),x("$",w(16,16,e.footerUsuarios.totalCostoVentas,"1.2-2"),""),l(4),_(M(20,19,e.footerUsuarios.totalPedidos)),l(4),x("$",w(24,21,e.footerUsuarios.totalImpPedidos,"1.2-2"),""),l(4),x("$",w(28,24,e.footerUsuarios.totalCostoPedidos,"1.2-2"),""),l(4),x("$",w(32,27,e.footerUsuarios.totalIngresos,"1.2-2"),""),l(4),x("$",w(36,30,e.footerUsuarios.totalEgresos,"1.2-2"),""),l(2),m("ngClass",ht(39,wn,(e.footerUsuarios.totalUtilidad||0)>=0,(e.footerUsuarios.totalUtilidad||0)<0)),l(2),x("$",w(40,33,e.footerUsuarios.totalUtilidad,"1.2-2"),""),l(4),_(e.footerUsuarios.gananciaPct==null?"\u2014":w(44,36,e.footerUsuarios.gananciaPct,"1.0-2")+"%")}}function y_(o,t){if(o&1&&(a(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),c(6,"Usuario"),r(),a(7,"th",43),c(8,"#Ventas"),r(),a(9,"th",43),c(10,"Imp. Ventas"),r(),a(11,"th",43),c(12,"Costo Ventas"),r(),a(13,"th",43),c(14,"#Pedidos"),r(),a(15,"th",43),c(16,"Imp. Pedidos"),r(),a(17,"th",43),c(18,"Costo Pedidos"),r(),a(19,"th",43),c(20,"Ingresos"),r(),a(21,"th",43),c(22,"Egresos"),r(),a(23,"th",43),c(24,"Utilidad"),r(),a(25,"th",43),c(26,"%Gan"),r()()(),a(27,"tbody"),S(28,__,33,43,"tr",44)(29,b_,3,0,"tr",22),r(),S(30,v_,45,42,"tfoot",22),r()()()),o&2){let e=u();l(28),m("ngForOf",e.rowsUsuarios),l(),m("ngIf",e.rowsUsuarios.length===0),l(),m("ngIf",e.footerUsuarios)}}function C_(o,t){if(o&1&&(a(0,"small",51),c(1),r()),o&2){let e=u().$implicit;l(),x("Tel: ",e.telefono,"")}}function x_(o,t){if(o&1&&(a(0,"tr")(1,"td")(2,"div"),c(3),r(),S(4,C_,2,1,"small",50),r(),a(5,"td",43),c(6),y(7,"number"),r(),a(8,"td",43),c(9),y(10,"number"),r(),a(11,"td",45),c(12),y(13,"number"),r(),a(14,"td",46),c(15),y(16,"number"),r(),a(17,"td",43),c(18),y(19,"number"),r(),a(20,"td",45),c(21),y(22,"number"),r(),a(23,"td",46),c(24),y(25,"number"),r(),a(26,"td",45),c(27),y(28,"number"),r(),a(29,"td",46),c(30),y(31,"number"),r(),a(32,"td",47),c(33),y(34,"number"),r(),a(35,"td",43),c(36),y(37,"number"),r()()),o&2){let e=t.$implicit;l(3),_(e.cliente),l(),m("ngIf",e.telefono),l(2),x("$",w(7,14,e.totalMonedero,"1.2-2"),""),l(3),_(M(10,17,e.numVentas)),l(3),x("$",w(13,19,e.impVentas,"1.2-2"),""),l(3),x("$",w(16,22,e.costoVentas,"1.2-2"),""),l(3),_(M(19,25,e.numPedidos)),l(3),x("$",w(22,27,e.impPedidos,"1.2-2"),""),l(3),x("$",w(25,30,e.costoPedidos,"1.2-2"),""),l(3),x("$",w(28,33,e.ingresos,"1.2-2"),""),l(3),x("$",w(31,36,e.egresos,"1.2-2"),""),l(2),m("ngClass",ht(45,wn,(e.utilidad||0)>=0,(e.utilidad||0)<0)),l(),x(" $",w(34,39,e.utilidad,"1.2-2")," "),l(3),_(e.gananciaPct==null?"\u2014":w(37,42,e.gananciaPct,"1.0-2")+"%")}}function S_(o,t){o&1&&(a(0,"tr")(1,"td",52),c(2,"Sin resultados"),r()())}function E_(o,t){if(o&1&&(a(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),c(4,"Totales:"),r()(),a(5,"td",43)(6,"strong"),c(7),y(8,"number"),r()(),a(9,"td",43)(10,"strong"),c(11),y(12,"number"),r()(),a(13,"td",45)(14,"strong"),c(15),y(16,"number"),r()(),a(17,"td",46)(18,"strong"),c(19),y(20,"number"),r()(),a(21,"td",43)(22,"strong"),c(23),y(24,"number"),r()(),a(25,"td",45)(26,"strong"),c(27),y(28,"number"),r()(),a(29,"td",46)(30,"strong"),c(31),y(32,"number"),r()(),a(33,"td",45)(34,"strong"),c(35),y(36,"number"),r()(),a(37,"td",46)(38,"strong"),c(39),y(40,"number"),r()(),a(41,"td",47)(42,"strong"),c(43),y(44,"number"),r()(),a(45,"td",43)(46,"strong"),c(47),y(48,"number"),r()()()()),o&2){let e=u(2);l(7),x("$",w(8,12,e.footerClientes.totalMonedero,"1.2-2"),""),l(4),_(M(12,15,e.footerClientes.totalVentas)),l(4),x("$",w(16,17,e.footerClientes.totalImpVentas,"1.2-2"),""),l(4),x("$",w(20,20,e.footerClientes.totalCostoVentas,"1.2-2"),""),l(4),_(M(24,23,e.footerClientes.totalPedidos)),l(4),x("$",w(28,25,e.footerClientes.totalImpPedidos,"1.2-2"),""),l(4),x("$",w(32,28,e.footerClientes.totalCostoPedidos,"1.2-2"),""),l(4),x("$",w(36,31,e.footerClientes.totalIngresos,"1.2-2"),""),l(4),x("$",w(40,34,e.footerClientes.totalEgresos,"1.2-2"),""),l(2),m("ngClass",ht(43,wn,(e.footerClientes.totalUtilidad||0)>=0,(e.footerClientes.totalUtilidad||0)<0)),l(2),x("$",w(44,37,e.footerClientes.totalUtilidad,"1.2-2"),""),l(4),_(e.footerClientes.gananciaPct==null?"\u2014":w(48,40,e.footerClientes.gananciaPct,"1.0-2")+"%")}}function w_(o,t){if(o&1&&(a(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),c(6,"Cliente"),r(),a(7,"th",43),c(8,"Monedero"),r(),a(9,"th",43),c(10,"#Compras"),r(),a(11,"th",43),c(12,"Imp. Compras"),r(),a(13,"th",43),c(14,"Costo Compras"),r(),a(15,"th",43),c(16,"#Pedidos"),r(),a(17,"th",43),c(18,"Imp. Pedidos"),r(),a(19,"th",43),c(20,"Costo Pedidos"),r(),a(21,"th",43),c(22,"Ingresos"),r(),a(23,"th",43),c(24,"Egresos"),r(),a(25,"th",43),c(26,"Utilidad"),r(),a(27,"th",43),c(28,"%Gan"),r()()(),a(29,"tbody"),S(30,x_,38,48,"tr",44)(31,S_,3,0,"tr",22),r(),S(32,E_,49,46,"tfoot",22),r()()()),o&2){let e=u();l(30),m("ngForOf",e.rowsClientes),l(),m("ngIf",e.rowsClientes.length===0),l(),m("ngIf",e.footerClientes)}}function P_(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),r(),a(3,"td"),c(4),r(),a(5,"td",43),c(6),y(7,"number"),r(),a(8,"td",45),c(9),y(10,"number"),r(),a(11,"td",46),c(12),y(13,"number"),r(),a(14,"td",47),c(15),y(16,"number"),r(),a(17,"td",43),c(18),y(19,"number"),r()()),o&2){let e=t.$implicit;l(2),_(e.producto),l(2),_(e.codigoBarras),l(2),_(M(7,8,e.numVentas)),l(3),x("$",w(10,10,e.importe,"1.2-2"),""),l(3),x("$",w(13,13,e.costo,"1.2-2"),""),l(2),m("ngClass",ht(22,wn,(e.utilidad||0)>=0,(e.utilidad||0)<0)),l(),x(" $",w(16,16,e.utilidad,"1.2-2")," "),l(3),_(e.gananciaPct==null?"\u2014":w(19,19,e.gananciaPct,"1.0-2")+"%")}}function I_(o,t){o&1&&(a(0,"tr")(1,"td",53),c(2,"Sin resultados"),r()())}function M_(o,t){if(o&1&&(a(0,"tfoot")(1,"tr")(2,"th",54),c(3,"Totales:"),r(),a(4,"th",43),c(5),y(6,"number"),r(),a(7,"th",45),c(8),y(9,"number"),r(),a(10,"th",46),c(11),y(12,"number"),r(),a(13,"th",47),c(14),y(15,"number"),r(),a(16,"th",43),c(17),y(18,"number"),r()()()),o&2){let e=u(2);l(5),_(M(6,6,e.footerProductos.numVentas)),l(3),x("$",w(9,8,e.footerProductos.importe,"1.2-2"),""),l(3),x("$",w(12,11,e.footerProductos.costo,"1.2-2"),""),l(2),m("ngClass",ht(20,wn,(e.footerProductos.utilidad||0)>=0,(e.footerProductos.utilidad||0)<0)),l(),x(" $",w(15,14,e.footerProductos.utilidad,"1.2-2")," "),l(3),x(" ",e.footerProductos.gananciaPct==null?"\u2014":w(18,17,e.footerProductos.gananciaPct,"1.0-2")+"%"," ")}}function T_(o,t){if(o&1&&(a(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),c(6,"Producto"),r(),a(7,"th"),c(8,"C\xF3digo de Barras"),r(),a(9,"th",43),c(10,"#Ventas"),r(),a(11,"th",43),c(12,"Importe"),r(),a(13,"th",43),c(14,"Costo"),r(),a(15,"th",43),c(16,"Utilidad"),r(),a(17,"th",43),c(18,"%Gan"),r()()(),a(19,"tbody"),S(20,P_,20,25,"tr",44)(21,I_,3,0,"tr",22),r(),S(22,M_,19,23,"tfoot",22),r()()()),o&2){let e=u();l(20),m("ngForOf",e.rowsProductos),l(),m("ngIf",e.rowsProductos.length===0),l(),m("ngIf",e.rowsProductos.length>0&&e.footerProductos)}}var Mr=class o{constructor(t,e,i,n,s,d,p){this.fb=t;this.reportes=e;this.farmaciaSrv=i;this.usuarioSrv=n;this.clienteSrv=s;this.productoSrv=d;this.cdr=p}filtroForm;cargando=!1;reportType="clientes";farmacias=[];usuarios=[];clientes=[];catCargados={farmacias:!1,usuarios:!1,clientes:!1};rowsClientes=[];rowsProductos=[];rowsUsuarios=[];productoResueltoNombre="";errorProductoCB="";footerProductos=null;footerUsuarios=null;footerClientes=null;ngOnInit(){let t=this.todayYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({fechaIni:[e,B.required],fechaFin:[t,B.required],tipo:[this.reportType,B.required],farmaciaId:[""],clienteId:[""],cantClientes:[""],ordenClientes:["ventas"],codigoBarras:[""],productoId:[""],cantProductos:[""],ordenProductos:["ventas"],usuarioId:[""],ordenUsuarios:["ventas"]}),this.cargarCatalogos(),this.filtroForm.get("tipo").valueChanges.subscribe(i=>{this.reportType=i}),this.filtroForm.get("productoId")?.valueChanges.subscribe(()=>this.syncCantProductosState()),this.syncCantProductosState()}todayYMD(){let t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${n}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");return`${e}-${i}-01`}collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});sortByNombre(t){return[...t].sort((e,i)=>this.collator.compare(e.nombre||"",i.nombre||""))}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.catCargados.farmacias=!0},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.catCargados.farmacias=!0}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{this.usuarios=t||[],this.catCargados.usuarios=!0},error:()=>{this.usuarios=[],this.catCargados.usuarios=!0}}),this.clienteSrv.getClientes().subscribe({next:t=>{let e=(t||[]).map(n=>({_id:n._id,nombre:n.nombre})),i=this.sortByNombre(e);this.clientes=[{_id:"",nombre:"(Todos)"},...i],this.catCargados.clientes=!0},error:()=>{this.clientes=[],this.catCargados.clientes=!0}})}limpiar(){this.filtroForm.patchValue({fechaIni:this.monthStartYMD(),fechaFin:this.monthStartYMD(),farmaciaId:"",codigoBarras:"",productoId:"",cantProductos:null,ordenProductos:"utilidad",clienteId:"",cantClientes:null,ordenClientes:"utilidad",usuarioId:"",cantUsuarios:null,ordenUsuarios:"utilidad"},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="",this.rowsProductos=[],this.rowsClientes=[],this.rowsUsuarios=[],this.footerProductos=null,this.footerUsuarios=null,this.footerClientes=null,this.footerProductos=null,this.footerClientes=null,this.footerUsuarios=null}buscar(){return Q(this,null,function*(){if(this.cargando)return;if(this.reportType==="productos"){this.rowsProductos=[],this.footerProductos=null;let n=String(this.filtroForm.get("codigoBarras")?.value||"").trim(),s=String(this.filtroForm.get("productoId")?.value||"").trim();n&&!s&&(yield this.resolverProductoPorCB()),String(this.filtroForm.get("productoId")?.value||"").trim()&&this.filtroForm.patchValue({cantProductos:null},{emitEvent:!1})}else this.reportType==="clientes"?(this.rowsClientes=[],this.footerClientes=null):this.reportType==="usuarios"&&(this.rowsUsuarios=[],this.footerUsuarios=null);let t=this.filtroForm.getRawValue(),{fechaIni:e,fechaFin:i}=t;if(!e||!i){Gi.default.fire("Faltan datos","Selecciona fecha inicial y final.","warning");return}switch(this.cargando=!0,this.reportType){case"clientes":this.buscarClientes(t);break;case"productos":this.buscarProductos(t);break;case"usuarios":this.buscarUsuarios(t);break}})}buscarClientes(t){let e=t.clienteId||void 0,i=t.ordenClientes||{campo:"utilidad",dir:"desc"};if(!e){let s=parseInt(String(t.cantClientes||"").trim(),10);if(!Number.isFinite(s)||s<=0){this.cargando=!1,Gi.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos clientes? \xF3 selecciona un cliente.","warning");return}}let n=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,clienteId:e,CantClientes:e?void 0:t.cantClientes,orden:i.campo,dir:i.dir});this.reportes.getUtilidadPorClientes(n).subscribe({next:s=>{this.rowsClientes=s?.rows||[],this.footerClientes=s?.footer??null,this.cargando=!1,console.log("fotter clientes ",this.footerClientes)},error:s=>{console.error("[Utilidad x clientes][ERROR]",s),this.rowsClientes=[],this.cargando=!1;let d=s?.error?.mensaje||s?.message||"No se pudo consultar Utilidad por clientes.";Gi.default.fire("Error",d,"error")}})}buscarProductos(t){let e=t??this.filtroForm.getRawValue(),i=(e.productoId??"").toString().trim()||void 0,n=(e.farmaciaId??"").toString().trim()||void 0,s=e.ordenProductos||{campo:"utilidad",dir:"desc"};if(!i){let p=parseInt(String(e.cantProductos||"").trim(),10);if(!Number.isFinite(p)||p<=0){this.cargando=!1,Gi.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos productos? \xF3 selecciona un producto.","warning");return}}let d=this.cleanParams({fechaIni:e.fechaIni,fechaFin:e.fechaFin,productoId:i,cantProductos:i?void 0:e.cantProductos,orden:s.campo,dir:s.dir,farmaciaId:n});this.reportes.getUtilidadPorProductos(d).subscribe({next:p=>{this.rowsProductos=p?.rows||[],this.footerProductos=p?.footer??null,this.cargando=!1},error:p=>{this.rowsProductos=[],this.footerProductos=null,this.cargando=!1;let h=p?.error?.mensaje||p?.message||"No se pudo consultar Utilidad por productos.";Gi.default.fire("Error",h,"error")}})}buscarUsuarios(t){let e=t.usuarioId||void 0,i=t.ordenUsuarios||{campo:"utilidad",dir:"desc"},n=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,usuarioId:e,orden:i.campo,dir:i.dir});this.reportes.getUtilidadPorUsuarios(n).subscribe({next:s=>{this.rowsUsuarios=s?.rows||[],this.footerUsuarios=s?.footer??null,this.cargando=!1},error:s=>{console.error("[Utilidad x usuarios][ERROR]",s),this.rowsUsuarios=[],this.cargando=!1;let d=s?.error?.mensaje||s?.message||"No se pudo consultar Utilidad por usuarios.";Gi.default.fire("Error",d,"error")}})}cleanParams(t){let e={};return Object.entries(t).forEach(([i,n])=>{n!=null&&String(n).trim()!==""&&(e[i]=n)}),e}syncCantProductosState(){let t=(this.filtroForm.get("productoId")?.value||"").toString().trim(),e=this.filtroForm.get("cantProductos");e&&(t?(e.disable({emitEvent:!1}),e.setValue("",{emitEvent:!1})):e.enable({emitEvent:!1}))}resolverProductoPorCB(){return Q(this,null,function*(){this.errorProductoCB="";let t=String(this.filtroForm.value.codigoBarras||"").trim();if(!t){this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.rowsProductos=[],this.footerProductos=null;return}try{let i=(yield Ct(this.productoSrv.buscarPorCodigoBarras(t)))?.producto;i&&i._id?(this.filtroForm.patchValue({productoId:i._id,cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre=i.nombre||"",this.rowsProductos=[],this.footerProductos=null):(this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="No se encontr\xF3 un producto con ese c\xF3digo.")}catch{this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="Error consultando el producto."}})}static \u0275fac=function(e){return new(e||o)(P(He),P(zt),P(ze),P(gn),P($t),P(It),P(Fe))};static \u0275cmp=V({type:o,selectors:[["app-reportes-utilidad"]],decls:39,vars:18,consts:[[1,"container-fluid"],[1,"titulo",2,"text-align","center"],[1,"mb-3",3,"formGroup"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-6"],[1,"form-label","d-block","mb-1"],[1,"d-flex","gap-2","flex-wrap"],[1,"report-chip"],["type","radio","formControlName","tipo","value","clientes"],["type","radio","formControlName","tipo","value","usuarios"],["type","radio","formControlName","tipo","value","productos"],[1,"col-1"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-1","text-end"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"my-3"],["class","row g-2 align-items-end",4,"ngIf"],[4,"ngIf"],[1,"col-md-3"],["formControlName","usuarioId",1,"form-select",3,"disabled"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["formControlName","ordenUsuarios",1,"form-select",3,"disabled"],[3,"ngValue"],[1,"col-md-4"],["formControlName","clienteId",1,"form-select",3,"disabled"],["type","number","min","1","formControlName","cantClientes",1,"form-control",3,"disabled"],["formControlName","ordenClientes",1,"form-select",3,"disabled"],["formControlName","farmaciaId",1,"form-select",3,"disabled"],["type","text","formControlName","codigoBarras","placeholder","Escanea o escribe el c\xF3digo",1,"form-control",3,"keyup.enter","disabled"],["class","text-danger small",4,"ngIf"],[1,"col-md-5"],["type","text","placeholder","Se llenar\xE1 al resolver el c\xF3digo","readonly","",1,"form-control",3,"value"],["type","number","min","1","formControlName","cantProductos",1,"form-control",3,"disabled"],["formControlName","ordenProductos",1,"form-select",3,"disabled"],[1,"text-danger","small"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"text-end","text-success"],[1,"text-end","text-negativo"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"table-light"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","12",1,"text-center","text-muted"],["colspan","7",1,"text-center","text-muted"],["colspan","2",1,"text-end"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h3",1),c(2,"Reportes Tops de utilidades"),r(),a(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),c(7,"Fecha inicial"),r(),f(8,"input",6),r(),a(9,"div",4)(10,"label",5),c(11,"Fecha final"),r(),f(12,"input",7),r(),a(13,"div",8)(14,"label",9),c(15,"Reporte:"),r(),a(16,"div",10)(17,"label",11),f(18,"input",12),c(19," Utilidad por clientes "),r(),a(20,"label",11),f(21,"input",13),c(22," Utilidad por usuarios "),r(),a(23,"label",11),f(24,"input",14),c(25," Utilidad por productos "),r()()(),a(26,"div",15)(27,"button",16),g("click",function(){return i.limpiar()}),f(28,"i",17),r()(),a(29,"div",18)(30,"button",19),g("click",function(){return i.buscar()}),c(31),r()()(),f(32,"hr",20),S(33,m_,20,11,"div",21)(34,u_,24,12,"div",21)(35,g_,33,15,"div",21),r(),S(36,y_,31,3,"div",22)(37,w_,33,3,"div",22)(38,T_,23,3,"div",22),r()),e&2&&(l(3),m("formGroup",i.filtroForm),l(5),m("disabled",i.cargando),l(4),m("disabled",i.cargando),l(5),G("active",i.filtroForm.value.tipo==="clientes"),l(3),G("active",i.filtroForm.value.tipo==="usuarios"),l(3),G("active",i.filtroForm.value.tipo==="productos"),l(4),m("disabled",i.cargando),l(3),m("disabled",i.cargando),l(),x(" ",i.cargando?"Consultando\u2026":"Buscar"," "),l(2),m("ngIf",i.reportType==="usuarios"),l(),m("ngIf",i.reportType==="clientes"),l(),m("ngIf",i.reportType==="productos"),l(),m("ngIf",i.reportType==="usuarios"),l(),m("ngIf",i.reportType==="clientes"),l(),m("ngIf",i.reportType==="productos"))},dependencies:[j,Qe,Y,z,Te,De,ke,ce,de,ie,Ae,le,ln,Z,Oe,Et,Ye,Xe,Ve,_e],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-positivo[_ngcontent-%COMP%]{color:#325301}.text-negativo[_ngcontent-%COMP%]{color:red}.report-chip[_ngcontent-%COMP%]{border:1px solid #d0d7de;border-radius:9999px;padding:.375rem .75rem;cursor:pointer;-webkit-user-select:none;user-select:none;display:inline-flex;align-items:center;gap:.5rem;transition:all .15s ease-in-out}.report-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.report-chip[_ngcontent-%COMP%]:hover{background:#a5d1fa}.report-chip.active[_ngcontent-%COMP%]{border-color:#0d6efd;background:#e7f1ff;color:#0d6efd;font-weight:600;box-shadow:0 0 0 2px #0d6efd26 inset}"]})};var O_=["paginator"],k_=()=>["detail"],D_=()=>[15,30,50,100];function F_(o,t){if(o&1){let e=I();a(0,"button",42),g("click",function(){b(e);let n=u();return v(n.limpiarProveedor())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function R_(o,t){if(o&1){let e=I();a(0,"button",44),g("click",function(){b(e);let n=u();return v(n.limpiarProducto())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function A_(o,t){if(o&1){let e=I();a(0,"button",45),g("click",function(){b(e);let n=u();return v(n.limpiarCodigo())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function V_(o,t){if(o&1){let e=I();a(0,"button",46),g("click",function(){b(e);let n=u();return v(n.limpiarDesde())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function N_(o,t){if(o&1){let e=I();a(0,"button",47),g("click",function(){b(e);let n=u();return v(n.limpiarHasta())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function B_(o,t){if(o&1){let e=I();a(0,"button",48),g("click",function(){b(e);let n=u();return v(n.limpiarIni())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function L_(o,t){if(o&1){let e=I();a(0,"button",49),g("click",function(){b(e);let n=u();return v(n.limpiarFin())}),f(1,"fa-icon",43),r()}if(o&2){let e=u();l(),m("icon",e.faTimes)}}function j_(o,t){o&1&&(a(0,"th",50),c(1,"Det."),r())}function U_(o,t){if(o&1){let e=I();a(0,"td",51)(1,"button",52),g("click",function(){let n=b(e).$implicit,s=u();return v(s.toggleDetalle(n))}),a(2,"mat-icon"),c(3),r()()()}if(o&2){let e=t.$implicit,i=u();l(),m("matTooltip",i.expandedId===e.compraId?"Ocultar detalle":"Ver detalle"),l(2),_(i.expandedId===e.compraId?"expand_less":"expand_more")}}function $_(o,t){o&1&&f(0,"td",53)}function H_(o,t){o&1&&(a(0,"th",50),c(1,"Fecha"),r())}function z_(o,t){if(o&1&&(a(0,"td",51),c(1),y(2,"date"),r()),o&2){let e=t.$implicit;l(),_(w(2,1,e.fecha,"dd/MM/yyyy HH:mm"))}}function q_(o,t){o&1&&f(0,"td",53)}function W_(o,t){o&1&&(a(0,"th",50),c(1,"Proveedor"),r())}function G_(o,t){if(o&1&&(a(0,"td",51),c(1),r()),o&2){let e=t.$implicit;l(),_(e.proveedor)}}function K_(o,t){o&1&&(a(0,"td",54)(1,"strong"),c(2,"Gran Total ==>"),r()())}function Q_(o,t){o&1&&(a(0,"th",55),c(1,"Total"),r())}function Y_(o,t){if(o&1&&(a(0,"td",56),c(1),y(2,"number"),r()),o&2){let e=t.$implicit;l(),x(" $",w(2,1,e.total,"1.2-2")," ")}}function X_(o,t){if(o&1&&(a(0,"td",57),c(1),y(2,"currency"),r()),o&2){let e=u();l(),x(" ",Kl(2,1,(e.footer==null?null:e.footer.totalCompras)||0,"MXN","symbol-narrow","1.2-2")," ")}}function Z_(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),r(),a(3,"td"),c(4),r(),a(5,"td",60),c(6),y(7,"number"),r(),a(8,"td"),c(9),r(),a(10,"td"),c(11),y(12,"date"),r(),a(13,"td",60),c(14),y(15,"number"),r(),a(16,"td",60),c(17),y(18,"number"),r()()),o&2){let e=t.$implicit;l(2),_(e.nombre),l(2),_(e.codigoBarras),l(2),_(M(7,7,e.cantidad)),l(3),_(e.lote),l(2),_(w(12,9,e.fechaCaducidad,"dd/MM/yyyy")),l(3),x("$",w(15,12,e.costoUnitario,"1.2-2"),""),l(3),x("$",w(18,15,e.precioUnitario,"1.2-2"),"")}}function J_(o,t){o&1&&(a(0,"tr")(1,"td",62),c(2,"Sin productos en esta compra."),r()())}function e1(o,t){if(o&1&&(a(0,"td",51)(1,"div",58)(2,"table",59)(3,"thead")(4,"tr")(5,"th"),c(6,"Producto"),r(),a(7,"th"),c(8,"C\xF3digo de Barras"),r(),a(9,"th",60),c(10,"Cantidad"),r(),a(11,"th"),c(12,"Lote"),r(),a(13,"th"),c(14,"Caducidad"),r(),a(15,"th",60),c(16,"Costo U."),r(),a(17,"th",60),c(18,"Precio U."),r()()(),a(19,"tbody"),S(20,Z_,19,18,"tr",61)(21,J_,3,0,"tr",40),r()()()()),o&2){let e=t.$implicit,i=u();te("colspan",i.displayedColumns.length),l(20),m("ngForOf",e.productos)("ngForTrackBy",i.trackByProd),l(),m("ngIf",!e.productos||e.productos.length===0)}}function t1(o,t){o&1&&f(0,"tr",63)}function i1(o,t){o&1&&f(0,"tr",64)}function n1(o,t){o&1&&f(0,"tr",64)}function o1(o,t){if(o&1&&f(0,"tr",65),o&2){let e=u();xt("display",e.rows.length?"":"none")}}function r1(o,t){if(o&1&&(a(0,"tr")(1,"td",66),c(2," Sin resultados en el rango/criterios seleccionados. "),r()()),o&2){let e=u();l(),te("colspan",e.displayedColumns.length)}}function a1(){let o=new ka;return o.itemsPerPageLabel="Compras por p\xE1gina:",o.nextPageLabel="Siguiente",o.previousPageLabel="Anterior",o.firstPageLabel="Inicio",o.lastPageLabel="Fin",o.getRangeLabel=(t,e,i)=>{if(i===0||e===0)return`0 de ${i}`;let n=t*e+1,s=Math.min(n+e-1,i);return`${n} \u2013 ${s} de ${i}`},o}var Tr=class o{constructor(t,e,i){this.comprasSrv=t;this.cdr=e;this.library=i;i.addIcons(ct)}proveedor="";importeDesde=null;importeHasta=null;fechaIni="";fechaFin="";productoNombre="";codigoBarras="";rows=[];displayedColumns=["acciones","fecha","proveedor","total"];table;isDetailRow=(t,e)=>this.expandedId===e.compraId;page=1;limit=15;paginacion={total:0,page:1,limit:15};cargando=!1;expandedId=null;paginator;faTimes=ct;footer=null;ngOnInit(){this.setFechasPorDefecto(),this.buscar(!0)}toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(t)}getFechaFinExclusiveISO(){let t=new Date(this.fechaFin);return t.setDate(t.getDate()+1),this.toLocalISODate(t)}limpiarFiltros(){this.proveedor="",this.importeDesde=null,this.importeHasta=null,this.setFechasPorDefecto(),this.productoNombre="",this.codigoBarras="",this.page=1,this.buscar(!0)}limpiarCodigo(){this.codigoBarras="",this.buscar(!0)}limpiarIni(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e)}limpiarFin(){let t=new Date;this.fechaFin=this.toLocalISODate(t)}limpiarDesde(){this.importeDesde=null,this.buscar(!0)}limpiarHasta(){this.importeHasta=null,this.buscar(!0)}limpiarProveedor(){this.proveedor="",this.buscar(!0)}limpiarProducto(){this.productoNombre="",this.buscar(!0)}buscar(t=!1){t&&(this.page=1);let e={page:this.page,limit:this.limit};this.fechaIni&&(e.fechaIni=this.fechaIni),this.fechaFin&&(e.fechaFin=this.fechaFin),this.proveedor&&(e.proveedor=this.proveedor.trim()),this.importeDesde!==null&&this.importeDesde!==void 0&&this.importeDesde!==""&&(e.importeDesde=this.importeDesde),this.importeHasta!==null&&this.importeHasta!==void 0&&this.importeHasta!==""&&(e.importeHasta=this.importeHasta),this.productoNombre?.trim()&&(e.productoNombre=this.productoNombre.trim()),this.codigoBarras?.trim()&&(e.codigoBarras=this.codigoBarras.trim()),this.cargando=!0,this.expandedId=null,this.comprasSrv.listar(e).subscribe({next:i=>{let n=i?.rows??[],s=i?.paginacion?.total??n.length,d=i?.paginacion?.page??this.page,p=i?.paginacion?.limit??this.limit;this.rows=n,this.paginacion={total:s,page:d,limit:p},this.limit=p,this.page=d,this.footer=i?.footer??null,this.cargando=!1,this.cdr.detectChanges(),this.table?.renderRows()},error:i=>{this.rows=[],this.paginacion={total:0,page:1,limit:this.limit},this.cargando=!1}})}cambioPagina(t){let e=t.pageSize!==this.limit;this.limit=t.pageSize,this.page=e?1:t.pageIndex+1,this.expandedId=null,this.buscar(!1)}toggleDetalle(t){this.expandedId=this.expandedId===t.compraId?null:t.compraId,this.table?.renderRows()}trackByCompra=(t,e)=>e.compraId;trackByProd=(t,e)=>`${e.codigoBarras}-${e.lote}-${e.fechaCaducidad}`;static \u0275fac=function(e){return new(e||o)(P(Sn),P(Fe),P(st))};static \u0275cmp=V({type:o,selectors:[["app-reporte-compras"]],viewQuery:function(e,i){if(e&1&&(Ee(Qo,5),Ee(O_,5)),e&2){let n;ye(n=Ce())&&(i.table=n.first),ye(n=Ce())&&(i.paginator=n.first)}},features:[Li([{provide:ka,useFactory:a1}])],decls:83,vars:33,consts:[[1,"filtros"],[1,"titulo","text-center"],[1,"row","mb-3"],[1,"col-3"],[2,"white-space","nowrap"],[1,"position-relative"],["type","text","placeholder","Nombre del proveedor",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar proveedor",3,"click",4,"ngIf"],["type","text","placeholder","Nombre del producto",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar producto",3,"click",4,"ngIf"],[1,"col-2"],["type","text","placeholder","C\xF3digo de barras",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar c\xF3d. barras",3,"click",4,"ngIf"],["type","number",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe desde",3,"click",4,"ngIf"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe hasta",3,"click",4,"ngIf"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha inicial",3,"click",4,"ngIf"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha final",3,"click",4,"ngIf"],[1,"col-4",2,"text-align","start","margin-top","1rem"],[1,"btn-rojo",3,"click","disabled"],[1,"col-4",2,"text-align","end","height","min-content","margin-top","1rem"],[1,"btn-gris",3,"click","disabled"],["mat-table","","multiTemplateDataRows","",1,"tabla",3,"dataSource"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","fecha"],["matColumnDef","proveedor"],["mat-footer-cell","","class","text-end",4,"matFooterCellDef"],["matColumnDef","total"],["mat-header-cell","","class","text-end",4,"matHeaderCellDef"],["mat-cell","","class","text-end fw-600",4,"matCellDef"],["mat-footer-cell","","class","text-end fw-700",4,"matFooterCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefTrackBy"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-footer-row","",3,"display",4,"matFooterRowDef"],[4,"ngIf"],[1,"paginator-custom",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],["type","button","matTooltip","Limpiar proveedor",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],["type","button","matTooltip","Limpiar producto",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar importe desde",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar importe hasta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar fecha inicial",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["type","button","matTooltip","Limpiar fecha final",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click","matTooltip"],["mat-footer-cell",""],["mat-footer-cell","",1,"text-end"],["mat-header-cell","",1,"text-end"],["mat-cell","",1,"text-end","fw-600"],["mat-footer-cell","",1,"text-end","fw-700"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"text-end"],[4,"ngFor","ngForOf","ngForTrackBy"],["colspan","7",1,"text-center","text-muted"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],[1,"text-center","text-muted","p-2"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h2",1),c(2,"Reporte General de Compras"),r(),a(3,"div",2)(4,"div",3)(5,"label",4),c(6,"Proveedor"),r(),a(7,"div",5)(8,"input",6),k("ngModelChange",function(s){return O(i.proveedor,s)||(i.proveedor=s),s}),g("keyup.enter",function(){return i.buscar(!0)}),r(),S(9,F_,2,1,"button",7),r()(),a(10,"div",3)(11,"label",4),c(12,"Producto"),r(),a(13,"div",5)(14,"input",8),k("ngModelChange",function(s){return O(i.productoNombre,s)||(i.productoNombre=s),s}),g("keyup.enter",function(){return i.buscar(!0)}),r(),S(15,R_,2,1,"button",9),r()(),a(16,"div",10)(17,"label",4),c(18,"C\xF3digo de barras"),r(),a(19,"div",5)(20,"input",11),k("ngModelChange",function(s){return O(i.codigoBarras,s)||(i.codigoBarras=s),s}),g("keyup.enter",function(){return i.buscar(!0)}),r(),S(21,A_,2,1,"button",12),r()(),a(22,"div",10)(23,"label",4),c(24,"Importe desde"),r(),a(25,"div",5)(26,"input",13),k("ngModelChange",function(s){return O(i.importeDesde,s)||(i.importeDesde=s),s}),g("keyup.enter",function(){return i.buscar(!0)}),r(),S(27,V_,2,1,"button",14),r()(),a(28,"div",10)(29,"label",4),c(30,"Importe hasta"),r(),a(31,"div",5)(32,"input",13),k("ngModelChange",function(s){return O(i.importeHasta,s)||(i.importeHasta=s),s}),g("keyup.enter",function(){return i.buscar(!0)}),r(),S(33,N_,2,1,"button",15),r()()(),a(34,"div",2)(35,"div",10)(36,"label",4),c(37,"Fecha inicial"),r(),a(38,"div",5)(39,"input",16),k("ngModelChange",function(s){return O(i.fechaIni,s)||(i.fechaIni=s),s}),g("change",function(){return i.buscar(!0)}),r(),S(40,B_,2,1,"button",17),r()(),a(41,"div",10)(42,"label",4),c(43,"Fecha final"),r(),a(44,"div",5)(45,"input",16),k("ngModelChange",function(s){return O(i.fechaFin,s)||(i.fechaFin=s),s}),g("change",function(){return i.buscar(!0)}),r(),S(46,L_,2,1,"button",18),r()(),a(47,"div",19)(48,"button",20),g("click",function(){return i.limpiarFiltros()}),a(49,"mat-icon"),c(50,"clear"),r(),c(51,"\xA0Limpiar "),r()(),a(52,"div",21)(53,"button",22),g("click",function(){return i.buscar(!0)}),a(54,"mat-icon"),c(55,"search"),r(),c(56,"\xA0Buscar "),r()()()(),a(57,"div")(58,"table",23),oe(59,24),S(60,j_,2,0,"th",25)(61,U_,4,2,"td",26)(62,$_,1,0,"td",27),re(),oe(63,28),S(64,H_,2,0,"th",25)(65,z_,3,4,"td",26)(66,q_,1,0,"td",27),re(),oe(67,29),S(68,W_,2,0,"th",25)(69,G_,2,1,"td",26)(70,K_,3,0,"td",30),re(),oe(71,31),S(72,Q_,2,0,"th",32)(73,Y_,3,4,"td",33)(74,X_,3,6,"td",34),re(),oe(75,35),S(76,e1,22,4,"td",26),re(),S(77,t1,1,0,"tr",36)(78,i1,1,0,"tr",37)(79,n1,1,0,"tr",38)(80,o1,1,2,"tr",39)(81,r1,3,1,"tr",40),r()(),a(82,"mat-paginator",41),g("page",function(s){return i.cambioPagina(s)}),r()),e&2&&(l(8),T("ngModel",i.proveedor),l(),m("ngIf",i.proveedor),l(5),T("ngModel",i.productoNombre),l(),m("ngIf",i.productoNombre),l(5),T("ngModel",i.codigoBarras),l(),m("ngIf",i.codigoBarras),l(5),T("ngModel",i.importeDesde),l(),m("ngIf",i.importeDesde),l(5),T("ngModel",i.importeHasta),l(),m("ngIf",i.importeHasta),l(6),T("ngModel",i.fechaIni),l(),m("ngIf",i.fechaIni),l(5),T("ngModel",i.fechaFin),l(),m("ngIf",i.fechaFin),l(2),m("disabled",i.cargando),l(5),m("disabled",i.cargando),l(4),G("loading",i.cargando),l(),m("dataSource",i.rows),l(19),m("matHeaderRowDef",i.displayedColumns),l(),m("matRowDefColumns",i.displayedColumns)("matRowDefTrackBy",i.trackByCompra),l(),m("matRowDefColumns",Ke(31,k_))("matRowDefWhen",i.isDetailRow),l(),m("matFooterRowDef",i.displayedColumns),l(),m("ngIf",!i.cargando&&i.rows.length===0),l(),m("length",i.paginacion.total||0)("pageSize",i.limit)("pageIndex",i.page-1)("pageSizeOptions",Ke(32,D_))("showFirstLastButtons",!0))},dependencies:[j,Y,z,Te,Re,Me,me,ie,Ae,Z,xe,gd,Qo,od,dd,ad,nd,pd,rd,md,sd,cd,ld,ud,hd,fd,yd,vd,Je,Ze,bd,_d,oi,wi,Ve,_e],styles:["[_nghost-%COMP%]     .mat-mdc-paginator{background:#f5fbff;box-shadow:0 2px 6px #0000000f}[_nghost-%COMP%]     .mat-mdc-icon-button{width:3.25rem;height:3.25rem;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .15s ease,transform .05s}[_nghost-%COMP%]     .mat-mdc-icon-button:hover{background:#8a2be2}[_nghost-%COMP%]     .mat-mdc-paginator-icon{fill:#0ff;width:3.25rem;height:3.25rem}[_nghost-%COMP%]     .mat-mdc-paginator-range-actions .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:#cbd5e1}[_nghost-%COMP%]     .mat-mdc-paginator-page-size .mat-mdc-select-value-text{font-size:1.3rem;color:#8a2be2;line-height:1.1}.paginator-custom[_ngcontent-%COMP%]{background-color:#fbdddd}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-page-size-label{font-size:1.3rem;color:#8a2be2;letter-spacing:.2px;margin-right:.5rem;line-height:1.1}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-range-label{font-size:1.3rem;color:#8a2be2}[_nghost-%COMP%]     .paginator-custom .mat-mdc-select-trigger, [_nghost-%COMP%]     .paginator-custom .mat-mdc-select-value-text{font-size:1.05rem;color:#8a2be2}"]})};var Ld=()=>{let o=K(ge),t=new ne({"x-auth-token":localStorage.getItem("auth_token")||""}),e=J.apiUrl,i=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];return Ll({farmacias:o.get(`${e}/farmacias`,{headers:t}).pipe(Se(n=>n?.data||n||[])),usuarios:o.get(`${e}/usuarios`,{headers:t}).pipe(Se(n=>n?.data||n||[])),motivos:Ie(i)})};var Or=class o{constructor(t){this.http=t}base=`${J.apiUrl}/reportes`;headers(){return new ne({"x-auth-token":localStorage.getItem("auth_token")||""})}buildParams(t){let e=new Le;return Object.entries(t).forEach(([i,n])=>{if(n==null)return;let s=String(n).trim();s!==""&&(e=e.set(i,s))}),e}getHistorial(t){return this.http.get(`${this.base}/compras-historial-producto`,{headers:this.headers(),params:this.buildParams(t)})}searchProductos(t){let e=`${J.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(Se(i=>i?.data??i?.rows??i??[]),Lt(()=>Ie([])))}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var l1=()=>({standalone:!0});function c1(o,t){if(o&1){let e=I();a(0,"button",39),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.selectProd(n))}),a(1,"div",40),c(2),r(),a(3,"small",41),c(4),r()()}if(o&2){let e=t.$implicit;l(2),_(e.nombre||"(sin nombre)"),l(2),x("CB: ",e.codigoBarras||"\u2014","")}}function d1(o,t){if(o&1&&(a(0,"div",37),S(1,c1,5,2,"button",38),r()),o&2){let e=u();l(),m("ngForOf",e.prodOpts)}}function m1(o,t){if(o&1&&(a(0,"span"),c(1),r()),o&2){let e=u(2);l(),x("\xB7 ",e.prodSel.codigoBarras,"")}}function p1(o,t){if(o&1){let e=I();a(0,"div",42)(1,"span",43),c(2),S(3,m1,2,1,"span",35),r(),a(4,"button",44),g("click",function(){b(e);let n=u(),s=$e(17);return v(n.clearProd(s))}),c(5,"Borrar"),r()()}if(o&2){let e=u();l(2),x(" ",e.prodSel.nombre," "),l(),m("ngIf",e.prodSel.codigoBarras)}}function u1(o,t){if(o&1&&(a(0,"option",45),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function f1(o,t){if(o&1&&(a(0,"option",45),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function h1(o,t){o&1&&(a(0,"span"),c(1,"\u25B2"),r())}function g1(o,t){o&1&&(a(0,"span"),c(1,"\u25BC"),r())}function _1(o,t){if(o&1&&(oe(0),S(1,h1,2,0,"span",35)(2,g1,2,0,"span",35),re()),o&2){let e=u(3);l(),m("ngIf",e.dir==="asc"),l(),m("ngIf",e.dir==="desc")}}function b1(o,t){o&1&&(oe(0),a(1,"span",41),c(2,"\u21C5"),r(),re())}function v1(o,t){if(o&1&&(a(0,"span",49),S(1,_1,3,2,"ng-container",35)(2,b1,3,0,"ng-container",35),r()),o&2){let e=u().$implicit,i=u();l(),m("ngIf",i.orden===e.key),l(),m("ngIf",i.orden!==e.key)}}function y1(o,t){if(o&1){let e=I();a(0,"th",46),g("click",function(){let n=b(e).$implicit,s=u();return v(s.onHeaderClick(n))}),a(1,"div",47)(2,"span"),c(3),r(),S(4,v1,3,2,"span",48),r()()}if(o&2){let e=t.$implicit,i=u();G("sortable",e.label!=="CB"),te("aria-sort",i.orden===e.key?i.dir==="asc"?"ascending":"descending":"none"),l(3),_(e.label),l(),m("ngIf",e.label!=="CB")}}function C1(o,t){if(o&1&&(a(0,"td"),c(1),r()),o&2){let e=t.$implicit,i=u().$implicit,n=u();G("text-end",e.right),l(),x(" ",n.formatCell(e,i)," ")}}function x1(o,t){if(o&1&&(a(0,"tr"),S(1,C1,2,3,"td",50),r()),o&2){let e=u();l(),m("ngForOf",e.headers)}}function S1(o,t){if(o&1&&(a(0,"tr")(1,"td",51),c(2,"Sin datos"),r()()),o&2){let e=u();l(),te("colspan",e.headers.length)}}function E1(o,t){if(o&1&&(a(0,"tfoot")(1,"tr",40)(2,"td",52),c(3),y(4,"number"),r(),a(5,"td",53),c(6),y(7,"currency"),r(),a(8,"td",53),c(9),y(10,"number"),r(),a(11,"td",53),c(12),y(13,"currency"),r(),a(14,"td",53),c(15),y(16,"currency"),r()()()),o&2){let e,i,n,s,d,p=t.ngIf;l(3),x("Num. de Compras: ",w(4,5,(e=p.compras)!==null&&e!==void 0?e:0,"1.0-0")," "),l(3),x(" Prom. ",M(7,8,(i=p.costoUnitProm)!==null&&i!==void 0?i:0)," "),l(3),x(" ",w(10,10,(n=p.piezas)!==null&&n!==void 0?n:0,"1.0-0")," "),l(3),x(" ",M(13,13,(s=p.costoTotal)!==null&&s!==void 0?s:0)," "),l(3),x(" Prom. ",M(16,15,(d=p.precioUnitProm)!==null&&d!==void 0?d:0)," ")}}function w1(o,t){if(o&1){let e=I();a(0,"nav",54)(1,"ul",55)(2,"li")(3,"button",56),g("click",function(){b(e);let n=u();return v(n.goFirst())}),f(4,"i",57),r()(),a(5,"li")(6,"button",58),g("click",function(){b(e);let n=u();return v(n.goPrev())}),f(7,"i",59),r()(),a(8,"li",60)(9,"span"),c(10),r()(),a(11,"li")(12,"button",61),g("click",function(){b(e);let n=u();return v(n.goNext())}),f(13,"i",62),r()(),a(14,"li")(15,"button",63),g("click",function(){b(e);let n=u();return v(n.goLast())}),f(16,"i",64),r()()()()}if(o&2){let e=u();l(2),G("disabled",!e.canPrev()),l(),m("disabled",!e.canPrev()),l(2),G("disabled",!e.canPrev()),l(),m("disabled",!e.canPrev()),l(4),Qt(" P\xE1gina: ",e.page," de ",e.totalPages,""),l(),G("disabled",!e.canNext()),l(),m("disabled",!e.canNext()),l(2),G("disabled",!e.canNext()),l(),m("disabled",!e.canNext())}}var kr=class o{constructor(t,e,i,n){this.fb=t;this.svc=e;this.proveedorService=i;this.usuarioService=n}filtroForm;cargando=!1;resp=null;rows=[];columns=[];footer=null;prodSel=null;prodOpts=[];prodInput$=new ve;subs=[];orden="fecha";dir="desc";page=1;limit=20;proveedores=[];usuarios=[];headers=[{label:"Fecha",key:"fecha",date:!0},{label:"Proveedor",key:"proveedor"},{label:"Producto",key:"producto"},{label:"CB",key:"precioUnitario"},{label:"Lote",key:"lote"},{label:"Caducidad",key:"fechaCaducidad",date:!0},{label:"Costo Unit.",key:"costoUnitario",right:!0,money:!0},{label:"Cantidad",key:"cantidad",right:!0},{label:"Costo Total",key:"costoTotal",right:!0,money:!0},{label:"Precio Unit.",key:"precioUnitario",right:!0,money:!0}];toYmdLocal(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}money=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",maximumFractionDigits:2});num=new Intl.NumberFormat("es-MX",{maximumFractionDigits:2});ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.filtroForm=this.fb.group({fechaIni:[this.toYmdLocal(e)],fechaFin:[this.toYmdLocal(t)],productoId:[""],q:[""],cb:[""],proveedorId:[""],usuarioId:[""],lote:[""],cadIni:[""],cadFin:[""]}),this.subs.push(this.prodInput$.pipe(Se(i=>(i||"").trim()),Ft(180),Rt(),ft(i=>i.length<2?Ie([]):this.svc.searchProductos(i))).subscribe(i=>this.prodOpts=Array.isArray(i)?i:[])),this.cargarProveedores(),this.cargarUsuarios(),this.buscar()}ngOnDestroy(){this.subs.forEach(t=>t.unsubscribe())}cargarProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||"(sin nombre)"})).sort((e,i)=>e.nombre.localeCompare(i.nombre,"es",{sensitivity:"base"}))})}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe(t=>{this.usuarios=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||e.usuario||"(sin nombre)"})).sort((e,i)=>(e.nombre||"").localeCompare(i.nombre||"","es",{sensitivity:"base"}))})}formatCell(t,e){let i=t.label==="CB"?e.codigoBarras??"":e[t.key];if(i==null)return"\u2014";if(t.date)try{return new Date(i).toLocaleDateString("es-MX")}catch{return"\u2014"}return t.money?this.money.format(+i||0):typeof i=="number"?this.num.format(i):String(i)}onHeaderClick(t){t.label!=="CB"&&(this.orden===t.key?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t.key,this.dir="desc"),this.buscar(!0))}exportCsv(){let t=this.headers.map(E=>E.label),e=(this.rows||[]).map(E=>this.headers.map(D=>this.formatCell(D,E))),i=[t,...e].map(E=>E.map(C).join(",")).join(`\r
`),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),d=URL.createObjectURL(n);s.href=d;let p=this.filtroForm.value.fechaIni??"",h=this.filtroForm.value.fechaFin??"";s.download=`historial_producto_${p}_${h}.csv`,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(d);function C(E){let D=(E??"").toString();return/[",\r\n]/.test(D)?`"${D.replace(/"/g,'""')}"`:D}}onProdInput(t){this.prodInput$.next((t||"").trim())}selectProd(t){this.prodSel=t,this.prodOpts=[],this.filtroForm.patchValue({productoId:t?._id||"",q:"",cb:t?.codigoBarras||""})}clearProd(t){this.prodSel=null,this.filtroForm.patchValue({productoId:"",q:"",cb:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}buscar(t=!0){if(this.cargando)return;t&&(this.page=1),this.cargando=!0;let e=this.filtroForm.getRawValue(),i=qe(ae({},e),{orden:this.orden,dir:this.dir,page:this.page,limit:this.limit});this.svc.getHistorial(i).subscribe({next:n=>{this.resp=n,this.rows=n?.rows||[],this.columns=n?.columns||[],this.page=n?.page??this.page,this.limit=n?.limit??this.limit,console.log("Respuesta: ",this.resp),this.cargando=!1},error:()=>{this.cargando=!1}})}sortBy(t){this.orden===t?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t,this.dir="desc"),this.buscar(!1)}get totalPages(){let t=this.resp?.pages??0;return t>0?t:0}get totalRows(){return this.resp?.total??this.rows?.length??0}canPrev(){return this.page>1}canNext(){return this.page<this.totalPages}changePage(t){this.cargando||t<1||t>this.totalPages||t===this.page||(this.page=t,this.buscar(!1))}goFirst(){this.canPrev()&&this.changePage(1)}goPrev(){this.canPrev()&&this.changePage(this.page-1)}goNext(){this.canNext()&&this.changePage(this.page+1)}goLast(){this.canNext()&&this.changePage(this.totalPages)}limpiar(t){let e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1);this.filtroForm.patchValue({fechaIni:this.toYmdLocal(i),fechaFin:this.toYmdLocal(e),productoId:"",q:"",cb:"",proveedorId:"",usuarioId:"",lote:"",cadIni:"",cadFin:""}),this.columns=[],this.rows=[],this.resp=null,this.footer=null,this.prodSel=null,this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0}))),this.page=1,this.orden="fecha",this.dir="desc",this.buscar()}isMoney(t){return["costoUnitario","costoTotal","precioUnitario"].includes(t)}static \u0275fac=function(e){return new(e||o)(P(He),P(Or),P(Ko),P(gn))};static \u0275cmp=V({type:o,selectors:[["app-historial-producto-page"]],decls:78,vars:27,consts:[["prodInput",""],[1,"container-fluid"],[1,"titulo","text-center"],[3,"formGroup"],[1,"row","g-2","align-items-end","filtros"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo de barras",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1 d-flex align-items-center gap-2 flex-wrap",4,"ngIf"],["type","hidden","formControlName","productoId"],[1,"col-md-3"],["formControlName","proveedorId",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuarioId",1,"form-select",3,"disabled"],[1,"row","mt-3"],["formControlName","lote","placeholder","Contiene...",1,"form-control",3,"disabled"],["type","date","formControlName","cadIni",1,"form-control",3,"disabled"],["type","date","formControlName","cadFin",1,"form-control",3,"disabled"],[1,"form-select",3,"ngModelChange","change","ngModel","ngModelOptions","disabled"],[3,"ngValue"],[1,"col-auto","ms-auto",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],["type","button",1,"btn-gris",2,"margin-left","8rem",3,"click"],[1,"d-flex","justify-content-end","mb-2","mt-2"],[1,"btn-amarillo",3,"click","disabled"],[1,"table-responsive"],[1,"tabla","w-100"],[3,"sortable","click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-2 paginacion",4,"ngIf"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1","d-flex","align-items-center","gap-2","flex-wrap"],[1,"badge","bg-success-subtle","text-success","border","mb-0"],["type","button",1,"btn","btn-link","btn-sm","p-0",3,"click"],[3,"value"],[3,"click"],[1,"d-flex","align-items-center","gap-1"],["class","sort-icon",4,"ngIf"],[1,"sort-icon"],[3,"text-end",4,"ngFor","ngForOf"],[1,"text-center","text-muted"],["colspan","6",1,"text-end"],[1,"text-end"],[1,"mt-2","paginacion"],[1,"pagination","pagination-sm","mb-0","justify-content-center"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[2,"margin-top","0.5rem","margin-left","10px","margin-right","10px"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,i){if(e&1){let n=I();a(0,"div",1)(1,"h4",2),c(2,"Historial de compras por producto"),r(),a(3,"form",3)(4,"div",4)(5,"div",5)(6,"label",6),c(7,"Fecha inicio"),r(),f(8,"input",7),r(),a(9,"div",5)(10,"label",6),c(11,"Fecha fin"),r(),f(12,"input",8),r(),a(13,"div",9)(14,"label",6),c(15,"Producto"),r(),a(16,"input",10,0),g("input",function(d){return b(n),v(i.onProdInput(d.target.value))}),r(),S(18,d1,2,1,"div",11)(19,p1,6,2,"div",12),f(20,"input",13),r(),a(21,"div",14)(22,"label",6),c(23,"Proveedor"),r(),a(24,"select",15)(25,"option",16),c(26,"(Todos)"),r(),S(27,u1,2,2,"option",17),r()(),a(28,"div",5)(29,"label",6),c(30,"Usuario"),r(),a(31,"select",18)(32,"option",16),c(33,"(Todos)"),r(),S(34,f1,2,2,"option",17),r()(),a(35,"div",19)(36,"div",5)(37,"label",6),c(38,"Lote"),r(),f(39,"input",20),r(),a(40,"div",5)(41,"label",6),c(42,"Caducidad desde"),r(),f(43,"input",21),r(),a(44,"div",5)(45,"label",6),c(46,"Caducidad hasta"),r(),f(47,"input",22),r(),a(48,"div",5)(49,"label",6),c(50,"Renglones x P\xE1gina"),r(),a(51,"select",23),k("ngModelChange",function(d){return b(n),O(i.limit,d)||(i.limit=d),v(d)}),g("change",function(){return b(n),v(i.buscar())}),a(52,"option",24),c(53,"25"),r(),a(54,"option",24),c(55,"50"),r(),a(56,"option",24),c(57,"100"),r(),a(58,"option",24),c(59,"200"),r()()(),a(60,"div",25)(61,"button",26),g("click",function(){b(n);let d=$e(17);return v(i.limpiar(d))}),f(62,"i",27),r(),a(63,"button",28),g("click",function(){return b(n),v(i.buscar())}),c(64,"Buscar"),r()()()()(),a(65,"div",29)(66,"button",30),g("click",function(){return b(n),v(i.exportCsv())}),c(67,"Exportar CSV"),r()(),a(68,"div",31)(69,"table",32)(70,"thead")(71,"tr"),S(72,y1,5,5,"th",33),r()(),a(73,"tbody"),S(74,x1,2,1,"tr",34)(75,S1,3,1,"tr",35),r(),S(76,E1,17,17,"tfoot",35),r()(),S(77,w1,17,14,"nav",36),r()}e&2&&(l(3),m("formGroup",i.filtroForm),l(5),m("disabled",i.cargando),l(4),m("disabled",i.cargando),l(4),m("disabled",i.cargando||!!i.prodSel),l(2),m("ngIf",i.prodOpts.length&&!i.prodSel),l(),m("ngIf",i.prodSel),l(5),m("disabled",i.cargando),l(3),m("ngForOf",i.proveedores),l(4),m("disabled",i.cargando),l(3),m("ngForOf",i.usuarios),l(5),m("disabled",i.cargando),l(4),m("disabled",i.cargando),l(4),m("disabled",i.cargando),l(4),T("ngModel",i.limit),m("ngModelOptions",Ke(26,l1))("disabled",i.cargando),l(),m("ngValue",25),l(2),m("ngValue",50),l(2),m("ngValue",100),l(2),m("ngValue",200),l(8),m("disabled",!i.rows.length),l(6),m("ngForOf",i.headers),l(2),m("ngForOf",i.rows),l(),m("ngIf",!i.rows.length),l(),m("ngIf",i.resp==null?null:i.resp.footer),l(),m("ngIf",i.totalPages>1))},dependencies:[j,Y,z,Te,Re,De,ke,ce,de,ie,le,Z,Oe,Ye,Xe,me,xe,Ve,_e],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;top:calc(100% + 4px);left:0;right:0;max-height:240px;overflow:auto;background:#fff;border:1px solid #dee2e6;border-radius:.375rem;box-shadow:0 6px 24px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;border:0;background:#fff;border-bottom:1px dashed #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap}th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}th[_ngcontent-%COMP%]   .sort-icon[_ngcontent-%COMP%]{font-size:.8rem;line-height:1}.text-end[_ngcontent-%COMP%]{text-align:end}.info-paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}"]})};var Dr=class o{constructor(t){this.http=t}api=J.apiUrl;headers(){return new ne({"Content-Type":"application/json"})}getReporte(t){let e=new Le;return Object.entries(t||{}).forEach(([i,n])=>{n!=null&&n!==""&&(e=e.set(i,String(n)))}),this.http.get(`${this.api}/reportes/compras-con-ventas`,{headers:this.headers(),params:e}).pipe(Lt(()=>Ie({nota:"",filtros:void 0,paginacion:{page:1,limit:20,total:0},rows:[],resumen:{sumCantidad:0,sumExistencia:0,avgVendidosFarmacia:0}})))}searchProductos(t){let e=`${J.apiUrl}/productos/buscar`,i=new Le().set("q",t).set("limit","50");return this.http.get(e,{headers:this.headers(),params:i}).pipe(Se(n=>{if(Array.isArray(n))return n;let s=["rows","data","productos","products","items","docs","result","results","list"];for(let d of s)if(Array.isArray(n?.[d]))return n[d];return[]}),Se(n=>n.map(s=>({_id:String(s?._id??""),nombre:String(s?.nombre??""),codigoBarras:s?.codigoBarras?String(s.codigoBarras):void 0}))),Se(n=>[...n].sort((s,d)=>s.nombre.localeCompare(d.nombre,"es",{sensitivity:"base"}))),Lt(()=>Ie([])))}getProveedores(){let t=`${J.apiUrl}/proveedores`;return this.http.get(t,{headers:this.headers()}).pipe(Se(e=>Array.isArray(e)?e:e?.rows??e?.data??[]),Se(e=>e.map(i=>({_id:String(i?._id??""),nombre:String(i?.nombre??"")}))),Se(e=>[...e].sort((i,n)=>i.nombre.localeCompare(n.nombre,"es",{sensitivity:"base"}))),Lt(()=>Ie([])))}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var _i=(o,t,e)=>({"bi-caret-up-fill":o,"bi-caret-down-fill":t,"bi-caret-up":e});function I1(o,t){if(o&1){let e=I();a(0,"button",49),g("click",function(){let n=b(e).$implicit,s=u(2);return v(s.selectProducto(n))}),a(1,"div",50),c(2),r(),a(3,"small",51),c(4),r()()}if(o&2){let e=t.$implicit;l(2),_(e.nombre||"(sin nombre)"),l(2),_(e.codigoBarras||"\u2014")}}function M1(o,t){if(o&1&&(a(0,"div",47),S(1,I1,5,2,"button",48),r()),o&2){let e=u();l(),m("ngForOf",e.prodOpts)}}function T1(o,t){if(o&1&&(a(0,"span"),c(1),r()),o&2){let e=u(2);l(),x(" \xB7 ",e.productoSel.codigoBarras,"")}}function O1(o,t){if(o&1){let e=I();a(0,"div",52)(1,"span",53),c(2),S(3,T1,2,1,"span",33),r(),a(4,"button",54),g("click",function(){b(e);let n=u();return v(n.clearProducto())}),c(5,"Borrar"),r()()}if(o&2){let e=u();l(2),x(" ",e.productoSel.nombre," "),l(),m("ngIf",e.productoSel.codigoBarras)}}function k1(o,t){if(o&1&&(a(0,"option",55),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function D1(o,t){if(o&1&&(a(0,"div",56)(1,"small"),c(2),r()()),o&2){let e=u();l(2),_(e.nota)}}function F1(o,t){o&1&&(a(0,"div"),c(1,"\u2014"),r())}function R1(o,t){if(o&1&&(a(0,"div"),c(1),r()),o&2){let e=t.$implicit;l(),_(e.farmacia||"\u2014")}}function A1(o,t){o&1&&(a(0,"div"),c(1,"\u2014"),r())}function V1(o,t){if(o&1&&(a(0,"div"),c(1),y(2,"number"),r()),o&2){let e=t.$implicit;l(),_(M(2,1,e.vendidos))}}function N1(o,t){if(o&1&&(a(0,"tr")(1,"td"),c(2),y(3,"date"),r(),a(4,"td"),c(5),r(),a(6,"td"),c(7),r(),a(8,"td"),c(9),r(),a(10,"td"),c(11),r(),a(12,"td",31),c(13),y(14,"currency"),r(),a(15,"td",35),c(16),y(17,"number"),r(),a(18,"td"),c(19),y(20,"date"),r(),a(21,"td",31),c(22),y(23,"number"),r(),a(24,"td",57),S(25,F1,2,0,"div",33)(26,R1,2,1,"div",32),r(),a(27,"td",58),S(28,A1,2,0,"div",33)(29,V1,3,3,"div",32),r()()),o&2){let e=t.$implicit;l(2),_(w(3,13,e.fecCompra,"dd/MM/yyyy")),l(3),_(e.proveedor||"\u2014"),l(2),_(e.producto),l(2),_(e.cb),l(2),_(e.lote),l(2),_(M(14,16,e.costo)),l(3),_(M(17,18,e.cantidad)),l(3),_(e.caducidad?w(20,20,e.caducidad,"dd/MM/yyyy"):"\u2014"),l(3),_(M(23,23,e.existencia)),l(3),m("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),l(),m("ngForOf",e.ventasPorFarmacia),l(2),m("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),l(),m("ngForOf",e.ventasPorFarmacia)}}function B1(o,t){o&1&&(a(0,"tr")(1,"td",59),c(2,"Sin resultados"),r()())}var Fr=class o{constructor(t,e){this.fb=t;this.reportesSvc=e}form;proveedores=[];prodOpts=[];productoSel=null;rows=[];cargando=!1;nota="";total=0;page=1;limit=20;get totalPaginas(){return Math.max(1,Math.ceil((this.total||0)/(this.limit||1)))}get totalPagina(){return this.rows.reduce((t,e)=>t+(e.costoTotal||0),0)}sumCantidad=0;sumExistencia=0;avgVendidosFarmacia=0;ngOnInit(){let t=new Date,e=t.getFullYear(),i=t.getMonth(),n=new Date(e,i,1).toISOString().slice(0,10),s=t.toISOString().slice(0,10);this.form=this.fb.group({fechaIni:[n],fechaFin:[s],productoId:[""],proveedorId:[""],lote:[""],codigoBarras:[""],sortBy:["caducidad"],sortDir:["asc"],limit:[this.limit]}),this.reportesSvc.getProveedores().subscribe(d=>this.proveedores=d),this.buscar(!0)}isSorted(t){return this.form?.value?.sortBy===t}isAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}isSort(t){return this.form?.value?.sortBy===t}dirIsAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}clickSort(t){let e=this.form.value.sortBy,i=this.form.value.sortDir||"asc";e===t?i=i==="asc"?"desc":"asc":i="asc",this.form.patchValue({sortBy:t,sortDir:i}),this.page=1,this.runQuery()}runQuery(){let t=this.form.value,e=qe(ae({},t),{page:this.page,limit:this.limit});this.cargando=!0,this.reportesSvc.getReporte(e).subscribe({next:i=>{this.rows=i?.rows??[],this.total=i?.paginacion?.total??0,this.page=i?.paginacion?.page??this.page,this.limit=i?.paginacion?.limit??this.limit,this.nota=i?.nota??"",this.sumCantidad=i?.resumen?.sumCantidad??0,this.sumExistencia=i?.resumen?.sumExistencia??0,this.avgVendidosFarmacia=i?.resumen?.avgVendidosFarmacia??0,this.cargando=!1,console.log("respuesta",i)},error:i=>{this.rows=[],this.total=0,this.nota="",this.sumCantidad=0,this.sumExistencia=0,this.avgVendidosFarmacia=0,this.cargando=!1}})}goToFirstPage(){this.page>1&&(this.page=1,this.runQuery())}goToPrevPage(){this.page>1&&(this.page--,this.runQuery())}goToNextPage(){this.page<this.totalPaginas&&(this.page++,this.runQuery())}goToLastPage(){let t=this.totalPaginas;this.page!==t&&(this.page=t,this.runQuery())}onChangeLimit(){this.page=1,this.runQuery()}onProductoInput(t){let e=(t||"").trim();if(e.length<2){this.prodOpts=[];return}this.reportesSvc.searchProductos(e).subscribe(i=>this.prodOpts=i.slice(0,10))}selectProducto(t){this.productoSel=t,this.prodOpts=[],this.form.patchValue({productoId:t._id})}clearProducto(t){this.productoSel=null,this.form.patchValue({productoId:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}limpiar(){let t=new Date,e=t.getFullYear(),i=t.getMonth(),n=new Date(e,i,1).toISOString().slice(0,10),s=t.toISOString().slice(0,10);this.productoSel=null,this.prodOpts=[],this.form.reset({fechaIni:n,fechaFin:s,productoId:"",proveedorId:"",lote:"",codigoBarras:"",sortBy:"caducidad",sortDir:"asc",limit:this.limit}),this.buscar(!0)}goPage(t){t<1||t>this.totalPaginas||(this.page=t,this.buscar(!1))}buscar(t=!1){t&&(this.page=1),this.runQuery()}static \u0275fac=function(e){return new(e||o)(P(He),P(Dr))};static \u0275cmp=V({type:o,selectors:[["app-reporte-compras-ventas"]],decls:112,vars:99,consts:[["prodInput",""],[1,"filtros"],[1,"titulo","text-center"],[1,"row","align-items-end",3,"formGroup"],[1,"col-sm-3"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control"],["type","date","formControlName","fechaFin",1,"form-control"],[1,"col-sm-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled","value"],["class","suggest",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-sm-2"],["formControlName","proveedorId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","align-items-end","mt-3","mb-2"],["type","text","formControlName","lote","placeholder","contiene\u2026",1,"form-control"],["type","text","formControlName","codigoBarras","placeholder","contiene\u2026",1,"form-control"],["type","number","formControlName","limit","min","1","max","200",1,"form-control",3,"change"],[1,"col-sm-2","mt-4"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"col-sm-3","mt-4"],["type","button",1,"btn-gris",3,"click","disabled"],["class","nota",4,"ngIf"],[1,"tabla-wrapper"],[1,"tabla"],[1,"th-sort",3,"click"],[1,"bi",3,"ngClass"],[1,"th-sort","text-end",3,"click"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","6",1,"text-end"],[1,"text-end","colortxt-c"],[1,"text-end","colortxt-v"],[1,"d-flex","align-items-center","justify-content-center","my-2","paginacion"],["aria-label","Primera p\xE1gina","matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["aria-label","P\xE1gina anterior","matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"px-2"],["aria-label","P\xE1gina siguiente","matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["aria-label","\xDAltima p\xE1gina","matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"suggest"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[3,"value"],[1,"nota"],[1,"multiline"],[1,"multiline","text-end","colortxt-v"],["colspan","12",1,"text-center","text-muted","p-2"]],template:function(e,i){if(e&1){let n=I();a(0,"div",1)(1,"h4",2),c(2,"Compras contra Ventas por producto"),r(),a(3,"form",3)(4,"div",4)(5,"label",5),c(6,"Fecha inicial"),r(),f(7,"input",6),r(),a(8,"div",4)(9,"label",5),c(10,"Fecha final"),r(),f(11,"input",7),r(),a(12,"div",8)(13,"label",5),c(14,"Producto"),r(),a(15,"input",9,0),g("input",function(){b(n);let d=$e(16);return v(i.onProductoInput(d.value))}),r(),S(17,M1,2,1,"div",10)(18,O1,6,2,"div",11),r(),a(19,"div",12)(20,"label",5),c(21,"Proveedor"),r(),a(22,"select",13)(23,"option",14),c(24,"TODOS"),r(),S(25,k1,2,2,"option",15),r()(),a(26,"div",16)(27,"div",12)(28,"label",5),c(29,"Lote"),r(),f(30,"input",17),r(),a(31,"div",12)(32,"label",5),c(33,"CB"),r(),f(34,"input",18),r(),a(35,"div",12)(36,"label",5),c(37,"# por p\xE1gina"),r(),a(38,"input",19),g("change",function(){return b(n),i.limit=i.form.value.limit||20,v(i.onChangeLimit())}),r()(),a(39,"div",20)(40,"button",21),g("click",function(){return b(n),v(i.limpiar())}),f(41,"i",22),r()(),a(42,"div",23)(43,"button",24),g("click",function(){return b(n),v(i.buscar(!0))}),c(44),r()()()(),S(45,D1,3,1,"div",25),r(),a(46,"div",26)(47,"table",27)(48,"thead")(49,"tr")(50,"th",28),g("click",function(){return b(n),v(i.clickSort("fecCompra"))}),c(51," Fec. compra "),f(52,"i",29),r(),a(53,"th",28),g("click",function(){return b(n),v(i.clickSort("proveedor"))}),c(54," Proveedor "),f(55,"i",29),r(),a(56,"th",28),g("click",function(){return b(n),v(i.clickSort("producto"))}),c(57," Producto "),f(58,"i",29),r(),a(59,"th",28),g("click",function(){return b(n),v(i.clickSort("cb"))}),c(60," CB "),f(61,"i",29),r(),a(62,"th",28),g("click",function(){return b(n),v(i.clickSort("lote"))}),c(63," Lote "),f(64,"i",29),r(),a(65,"th",30),g("click",function(){return b(n),v(i.clickSort("costo"))}),c(66," Costo "),f(67,"i",29),r(),a(68,"th",30),g("click",function(){return b(n),v(i.clickSort("cantidad"))}),c(69," Comprados "),f(70,"i",29),r(),a(71,"th",28),g("click",function(){return b(n),v(i.clickSort("caducidad"))}),c(72," Caducidad "),f(73,"i",29),r(),a(74,"th",30),g("click",function(){return b(n),v(i.clickSort("existencia"))}),c(75," Almac\xE9n "),f(76,"i",29),r(),a(77,"th"),c(78,"Farmacia"),r(),a(79,"th",31),c(80,"Vendidos"),r()()(),a(81,"tbody"),S(82,N1,30,25,"tr",32)(83,B1,3,0,"tr",33),r(),a(84,"tfoot")(85,"tr")(86,"th",34),c(87,"\u2211 Comprados:"),r(),a(88,"th",35),c(89),y(90,"number"),r(),a(91,"th",31),c(92,"\u2211 Almac\xE9n:"),r(),a(93,"th",31),c(94),y(95,"number"),r(),a(96,"th",31),c(97,"Prom. Vend.:"),r(),a(98,"th",36),c(99),y(100,"number"),r()()()()(),a(101,"div",37)(102,"button",38),g("click",function(){return b(n),v(i.goToFirstPage())}),f(103,"i",39),r(),a(104,"button",40),g("click",function(){return b(n),v(i.goToPrevPage())}),f(105,"i",41),r(),a(106,"span",42),c(107),r(),a(108,"button",43),g("click",function(){return b(n),v(i.goToNextPage())}),f(109,"i",44),r(),a(110,"button",45),g("click",function(){return b(n),v(i.goToLastPage())}),f(111,"i",46),r()()}e&2&&(l(3),m("formGroup",i.form),l(12),m("disabled",!!i.productoSel)("value",(i.productoSel==null?null:i.productoSel.nombre)||""),l(2),m("ngIf",i.prodOpts.length&&!i.productoSel),l(),m("ngIf",i.productoSel),l(7),m("ngForOf",i.proveedores),l(18),m("disabled",i.cargando),l(),x(" ",i.cargando?"Buscando\u2026":"Buscar"," "),l(),m("ngIf",i.nota),l(5),G("sorted",i.isSorted("fecCompra")),te("aria-sort",i.isSorted("fecCompra")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(63,_i,i.isSorted("fecCompra")&&i.isAsc(),i.isSorted("fecCompra")&&!i.isAsc(),!i.isSorted("fecCompra"))),l(),G("sorted",i.isSorted("proveedor")),te("aria-sort",i.isSorted("proveedor")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(67,_i,i.isSorted("proveedor")&&i.isAsc(),i.isSorted("proveedor")&&!i.isAsc(),!i.isSorted("proveedor"))),l(),G("sorted",i.isSorted("producto")),te("aria-sort",i.isSorted("producto")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(71,_i,i.isSorted("producto")&&i.isAsc(),i.isSorted("producto")&&!i.isAsc(),!i.isSorted("producto"))),l(),G("sorted",i.isSorted("cb")),te("aria-sort",i.isSorted("cb")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(75,_i,i.isSorted("cb")&&i.isAsc(),i.isSorted("cb")&&!i.isAsc(),!i.isSorted("cb"))),l(),G("sorted",i.isSorted("lote")),te("aria-sort",i.isSorted("lote")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(79,_i,i.isSorted("lote")&&i.isAsc(),i.isSorted("lote")&&!i.isAsc(),!i.isSorted("lote"))),l(),G("sorted",i.isSorted("costo")),te("aria-sort",i.isSorted("costo")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(83,_i,i.isSorted("costo")&&i.isAsc(),i.isSorted("costo")&&!i.isAsc(),!i.isSorted("costo"))),l(),G("sorted",i.isSorted("cantidad")),te("aria-sort",i.isSorted("cantidad")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(87,_i,i.isSorted("cantidad")&&i.isAsc(),i.isSorted("cantidad")&&!i.isAsc(),!i.isSorted("cantidad"))),l(),G("sorted",i.isSorted("caducidad")),te("aria-sort",i.isSorted("caducidad")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(91,_i,i.isSorted("caducidad")&&i.isAsc(),i.isSorted("caducidad")&&!i.isAsc(),!i.isSorted("caducidad"))),l(),G("sorted",i.isSorted("existencia")),te("aria-sort",i.isSorted("existencia")?i.isAsc()?"ascending":"descending":"none"),l(2),m("ngClass",gt(95,_i,i.isSorted("existencia")&&i.isAsc(),i.isSorted("existencia")&&!i.isAsc(),!i.isSorted("existencia"))),l(6),m("ngForOf",i.rows),l(),m("ngIf",!i.cargando&&i.rows.length===0),l(6),_(M(90,56,i.sumCantidad)),l(5),_(M(95,58,i.sumExistencia)),l(5),_(w(100,60,i.avgVendidosFarmacia,"1.0-2")),l(3),m("disabled",i.page<=1),l(2),m("disabled",i.page<=1),l(3),Qt("P\xE1gina ",i.page," de ",i.totalPaginas,""),l(),m("disabled",i.page>=i.totalPaginas),l(2),m("disabled",i.page>=i.totalPaginas))},dependencies:[j,Qe,Y,z,Te,Re,Me,De,ke,ce,de,ie,Ae,le,Z,Oe,Et,xi,Ye,Xe,Ve,_e],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.nota[_ngcontent-%COMP%]{margin-top:.5rem;color:#000091;text-align:center}.colortxt-c[_ngcontent-%COMP%]{color:#0453b3;font-weight:600}.colortxt-v[_ngcontent-%COMP%]{color:#b30404;font-weight:600}.suggest[_ngcontent-%COMP%]{position:absolute;z-index:10;background:#fff;border:1px solid #ddd;width:100%;max-height:260px;overflow:auto;border-radius:.5rem;box-shadow:0 8px 18px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;background:#fff;border:0;border-bottom:1px solid #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f6f8ff}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eaeaea;padding:.5rem;vertical-align:top}.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f3f8ff;cursor:pointer;white-space:nowrap}.text-end[_ngcontent-%COMP%]{text-align:right}.multiline[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1.35}.pager[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.sorted[_ngcontent-%COMP%]{text-decoration:underline}.sort-caret[_ngcontent-%COMP%]{margin-left:.25rem;font-size:.8em}.th-sort[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap;-webkit-user-select:none;user-select:none}.th-sort[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.35rem;opacity:.6;font-size:.9em}.th-sort.sorted[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}"]})};function em(o){let t=o.cloneNode(!0),e=t.querySelectorAll("[id]"),i=o.nodeName.toLowerCase();t.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return i==="canvas"?$d(o,t):(i==="input"||i==="select"||i==="textarea")&&Ud(o,t),jd("canvas",o,t,$d),jd("input, textarea, select",o,t,Ud),t}function jd(o,t,e,i){let n=t.querySelectorAll(o);if(n.length){let s=e.querySelectorAll(o);for(let d=0;d<n.length;d++)i(n[d],s[d])}}var L1=0;function Ud(o,t){t.type!=="file"&&(t.value=o.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${L1++}`)}function $d(o,t){let e=t.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function Wa(o){let t=o.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Ua(o,t,e){let{top:i,bottom:n,left:s,right:d}=o;return e>=i&&e<=n&&t>=s&&t<=d}function eo(o,t,e){o.top+=t,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function Hd(o,t,e,i){let{top:n,right:s,bottom:d,left:p,width:h,height:C}=o,E=h*t,D=C*t;return i>n-D&&i<d+D&&e>p-E&&e<s+E}var Rr=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Wa(e)})})}handleScroll(t){let e=ji(t),i=this.positions.get(e);if(!i)return null;let n=i.scrollPosition,s,d;if(e===this._document){let C=this.getViewportScrollPosition();s=C.top,d=C.left}else s=e.scrollTop,d=e.scrollLeft;let p=n.top-s,h=n.left-d;return this.positions.forEach((C,E)=>{C.clientRect&&e!==E&&e.contains(E)&&eo(C.clientRect,p,h)}),n.top=s,n.left=d,{top:p,left:h}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function tm(o,t){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(n=>i.appendChild(n)),i}function Ga(o,t,e){for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];n?o.setProperty(i,n,e?.has(i)?"important":""):o.removeProperty(i)}return o}function Pn(o,t){let e=t?"":"none";Ga(o.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function zd(o,t,e){Ga(o.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Ar(o,t){return t&&t!="none"?o+" "+t:o}function qd(o,t){o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.style.transform=Vr(t.left,t.top)}function Vr(o,t){return`translate3d(${Math.round(o)}px, ${Math.round(t)}px, 0)`}function Wd(o){let t=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*t}function j1(o){let t=getComputedStyle(o),e=La(t,"transition-property"),i=e.find(p=>p==="transform"||p==="all");if(!i)return 0;let n=e.indexOf(i),s=La(t,"transition-duration"),d=La(t,"transition-delay");return Wd(s[n])+Wd(d[n])}function La(o,t){return o.getPropertyValue(t).split(",").map(i=>i.trim())}var U1=new Set(["position"]),$a=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,n,s,d,p,h,C,E){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=n,this._previewTemplate=s,this._previewClass=d,this._pickupPositionOnPage=p,this._initialTransform=h,this._zIndex=C,this._renderer=E}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),Gd(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return j1(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,n;if(i&&t){let s=t.matchSize?this._initialDomRect:null,d=t.viewContainer.createEmbeddedView(i,t.context);d.detectChanges(),n=tm(d,this._document),this._previewEmbeddedView=d,t.matchSize?qd(n,s):n.style.transform=Vr(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=em(this._rootElement),qd(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return Ga(n.style,{"pointer-events":"none",margin:Gd(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},U1),Pn(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(s=>n.classList.add(s)):n.classList.add(e)),n}};function Gd(o){return"showPopover"in o}var $1={passive:!0},Kd={passive:!1},H1={passive:!1,capture:!0},z1=800,Qd=new Set(["position"]),Ha=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Sa(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new ve;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=ti.EMPTY;_pointerUpSubscription=ti.EMPTY;_scrollSubscription=ti.EMPTY;_resizeSubscription=ti.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Pn(e,t)))}_disabled=!1;beforeStarted=new ve;started=new ve;released=new ve;ended=new ve;entered=new ve;exited=new ve;dropped=new ve;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,n,s,d,p){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=s,this._dragDropRegistry=d,this._renderer=p,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Rr(i),d.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>Ei(i)),this._handles.forEach(i=>Pn(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Ei(t);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[Si(this._renderer,e,"mousedown",this._pointerDown,Kd),Si(this._renderer,e,"touchstart",this._pointerDown,$1),Si(this._renderer,e,"dragstart",this._nativeDragStart,Kd)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Ei(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),Pn(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),Pn(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),s=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+s>=this._config.dragStartThreshold){let p=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),h=this._dropContainer;if(!p){this._endDragSequence(t);return}(!h||!h.isDragging()&&!h.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,s=this._activeTransform;s.x=i.x-n.x+this._passiveTransform.x,s.y=i.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(s.x,s.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){Zn(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=Si(this._renderer,e,"selectstart",q1,H1)}),i){let n=this._rootElement,s=n.parentNode,d=this._placeholder=this._createPlaceholderElement(),p=this._anchor=this._anchor||this._document.createComment("");s.insertBefore(p,n),this._initialTransform=n.style.transform||"",this._preview=new $a(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(s,e)),zd(n,!1,Qd),this._document.body.appendChild(s.replaceChild(d,n)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),n=Zn(e),s=!n&&e.button!==0,d=this._rootElement,p=ji(e),h=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+z1>Date.now(),C=n?Nc(e):Vc(e);if(p&&p.draggable&&e.type==="mousedown"&&e.preventDefault(),i||s||h||C)return;if(this._handles.length){let R=d.style;this._rootElementTapHighlight=R.webkitTapHighlightColor||"",R.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(R=>this._updateOnScroll(R)),this._boundaryElement&&(this._boundaryRect=Wa(this._boundaryElement));let E=this._previewTemplate;this._pickupPositionInElement=E&&E.template&&!E.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let D=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:D.x,y:D.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){zd(this._rootElement,!0,Qd),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),s=this._getDragDistance(n),d=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:s,dropPoint:n,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:d,distance:s,dropPoint:n,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,d,s,n,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let s=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!s&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(s=this._initialContainer),s&&s!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=s,this._dropContainer.enter(this,t,e,s===this._initialContainer&&s.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:s,currentIndex:s.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let n=p=>{(!p||this._preview&&ji(p)===this._preview.element&&p.propertyName==="transform")&&(d(),i(),clearTimeout(s))},s=setTimeout(n,e*1.5),d=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=tm(this._placeholderRef,this._document)):i=em(this._rootElement),i.style.pointerEvents="none",i.classList.add("cdk-drag-placeholder"),i}_getPointerPositionInElement(t,e,i){let n=e===this._rootElement?null:e,s=n?n.getBoundingClientRect():t,d=Zn(i)?i.targetTouches[0]:i,p=this._getViewportScrollPosition(),h=d.pageX-s.left-p.left,C=d.pageY-s.top-p.top;return{x:s.left-t.left+h,y:s.top-t.top+C}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=Zn(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,s=i.pageY-e.top;if(this._ownerSVGElement){let d=this._ownerSVGElement.getScreenCTM();if(d){let p=this._ownerSVGElement.createSVGPoint();return p.x=n,p.y=s,p.matrixTransform(d.inverse())}}return{x:n,y:s}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:s,y:d}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,p=this._boundaryRect,{width:h,height:C}=this._getPreviewRect(),E=p.top+d,D=p.bottom-(C-d),R=p.left+s,N=p.right-(h-s);i=Yd(i,R,N),n=Yd(n,E,D)}return{x:i,y:n}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,n=this._pointerDirectionDelta,s=this._pointerPositionAtLastDirectionChange,d=Math.abs(e-s.x),p=Math.abs(i-s.y);return d>this._config.pointerDirectionChangeThreshold&&(n.x=e>s.x?1:-1,s.x=e),p>this._config.pointerDirectionChangeThreshold&&(n.y=i>s.y?1:-1,s.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Pn(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,n=Vr(t*i,e*i),s=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=s.transform&&s.transform!="none"?s.transform:""),s.transform=Ar(n,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,n=Vr(t,e);this._preview.setTransform(Ar(n,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||i.width===0&&i.height===0)return;let s=n.left-i.left,d=i.right-n.right,p=n.top-i.top,h=i.bottom-n.bottom;n.width>i.width?(s>0&&(t+=s),d>0&&(t-=d)):t=0,n.height>i.height?(p>0&&(e+=p),h>0&&(e-=h)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:Zn(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=ji(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&eo(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=jo(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Ei(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function Yd(o,t,e){return Math.max(t,Math.min(e,o))}function Zn(o){return o.type[0]==="t"}function q1(o){o.preventDefault()}function im(o,t,e){let i=Xd(t,o.length-1),n=Xd(e,o.length-1);if(i===n)return;let s=o[i],d=n<i?-1:1;for(let p=i;p!==n;p+=d)o[p]=o[p+d];o[n]=s}function Xd(o,t){return Math.max(0,Math.min(t,o))}var Nr=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,n){let s=this._itemPositions,d=this._getItemIndexFromPointerPosition(t,e,i,n);if(d===-1&&s.length>0)return null;let p=this.orientation==="horizontal",h=s.findIndex(F=>F.drag===t),C=s[d],E=s[h].clientRect,D=C.clientRect,R=h>d?1:-1,N=this._getItemOffsetPx(E,D,R),A=this._getSiblingOffsetPx(h,s,R),U=s.slice();return im(s,h,d),s.forEach((F,fe)=>{if(U[fe]===F)return;let Pe=F.drag===t,it=Pe?N:A,Ge=Pe?t.getPlaceholderElement():F.drag.getRootElement();F.offset+=it;let ui=Math.round(F.offset*(1/F.drag.scale));p?(Ge.style.transform=Ar(`translate3d(${ui}px, 0, 0)`,F.initialTransform),eo(F.clientRect,0,it)):(Ge.style.transform=Ar(`translate3d(0, ${ui}px, 0)`,F.initialTransform),eo(F.clientRect,it,0))}),this._previousSwap.overlaps=Ua(D,e,i),this._previousSwap.drag=C.drag,this._previousSwap.delta=p?n.x:n.y,{previousIndex:h,currentIndex:d}}enter(t,e,i,n){let s=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n,d=this._activeDraggables,p=d.indexOf(t),h=t.getPlaceholderElement(),C=d[s];if(C===t&&(C=d[s+1]),!C&&(s==null||s===-1||s<d.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(C=d[0]),p>-1&&d.splice(p,1),C&&!this._dragDropRegistry.isDragging(C)){let E=C.getRootElement();E.parentElement.insertBefore(h,E),d.splice(s,0,t)}else this._element.appendChild(h),d.push(t);h.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(n=>n.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(i=>i.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{eo(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:Wa(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getItemOffsetPx(t,e,i){let n=this.orientation==="horizontal",s=n?e.left-t.left:e.top-t.top;return i===-1&&(s+=n?e.width-t.width:e.height-t.height),s}_getSiblingOffsetPx(t,e,i){let n=this.orientation==="horizontal",s=e[t].clientRect,d=e[t+i*-1],p=s[n?"width":"height"]*i;if(d){let h=n?"left":"top",C=n?"right":"bottom";i===-1?p-=d.clientRect[h]-s[C]:p+=s[h]-d.clientRect[C]}return p}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,n=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let d=i[i.length-1].clientRect;return n?t>=d.right:e>=d.bottom}else{let d=i[0].clientRect;return n?t<=d.left:e<=d.top}}_getItemIndexFromPointerPosition(t,e,i,n){let s=this.orientation==="horizontal",d=this._itemPositions.findIndex(({drag:p,clientRect:h})=>{if(p===t)return!1;if(n){let C=s?n.x:n.y;if(p===this._previousSwap.drag&&this._previousSwap.overlaps&&C===this._previousSwap.delta)return!1}return s?e>=Math.floor(h.left)&&e<Math.floor(h.right):i>=Math.floor(h.top)&&i<Math.floor(h.bottom)});return d===-1||!this._sortPredicate(d,t)?-1:d}},za=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let n=e[i];this._relatedNodes.push([n,n.nextSibling])}this.withItems(t)}sort(t,e,i,n){let s=this._getItemIndexFromPointerPosition(t,e,i),d=this._previousSwap;if(s===-1||this._activeItems[s]===t)return null;let p=this._activeItems[s];if(d.drag===p&&d.overlaps&&d.deltaX===n.x&&d.deltaY===n.y)return null;let h=this.getItemIndex(t),C=t.getPlaceholderElement(),E=p.getRootElement();s>h?E.after(C):E.before(C),im(this._activeItems,h,s);let D=this._getRootNode().elementFromPoint(e,i);return d.deltaX=n.x,d.deltaY=n.y,d.drag=p,d.overlaps=E===D||E.contains(D),{previousIndex:h,currentIndex:s}}enter(t,e,i,n){let s=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n;s===-1&&(s=this._getClosestItemIndexToPointer(t,e,i));let d=this._activeItems[s],p=this._activeItems.indexOf(t);p>-1&&this._activeItems.splice(p,1),d&&!this._dragDropRegistry.isDragging(d)?(this._activeItems.splice(s,0,t),d.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[n,s]=this._relatedNodes[i];n.parentNode===t&&n.nextSibling!==s&&(s===null?t.appendChild(n):s.parentNode===t&&t.insertBefore(n,s))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),s=n?this._activeItems.findIndex(d=>{let p=d.getRootElement();return n===p||p.contains(n)}):-1;return s===-1||!this._sortPredicate(s,t)?-1:s}_getRootNode(){return this._rootNode||(this._rootNode=jo(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,s=-1;for(let d=0;d<this._activeItems.length;d++){let p=this._activeItems[d];if(p!==t){let{x:h,y:C}=p.getRootElement().getBoundingClientRect(),E=Math.hypot(e-h,i-C);E<n&&(n=E,s=d)}}return s}},Zd=.05,nm=.05,qt=function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o}(qt||{}),vt=function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o}(vt||{}),qa=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new ve;entered=new ve;exited=new ve;dropped=new ve;sorted=new ve;receivingStarted=new ve;receivingStopped=new ve;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=ti.EMPTY;_verticalScrollDirection=qt.NONE;_horizontalScrollDirection=vt.NONE;_scrollNode;_stopScrollTimers=new ve;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,n,s){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=s;let d=this.element=Ei(t);this._document=i,this.withOrientation("vertical").withElementContainer(d),e.registerDropContainer(this),this._parentPositions=new Rr(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,s,d,p,h={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:s,distance:d,dropPoint:p,event:h})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>t.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof Nr&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new za(this._document,this._dragDropRegistry);else{let e=new Nr(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Ei(this.element),i=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._domRect||!Hd(this._domRect,Zd,e,i))return;let s=this._sortStrategy.sort(t,e,i,n);s&&this.sorted.next({previousIndex:s.previousIndex,currentIndex:s.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=qt.NONE,s=vt.NONE;if(this._parentPositions.positions.forEach((d,p)=>{p===this._document||!d.clientRect||i||Hd(d.clientRect,Zd,t,e)&&([n,s]=W1(p,d.clientRect,this._direction,t,e),(n||s)&&(i=p))}),!n&&!s){let{width:d,height:p}=this._viewportRuler.getViewportSize(),h={width:d,height:p,top:0,right:d,bottom:p,left:0};n=om(h,e),s=rm(h,t),i=window}i&&(n!==this._verticalScrollDirection||s!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=s,this._scrollNode=i,(n||s)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),jl(0,Vl).pipe(So(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===qt.UP?t.scrollBy(0,-e):this._verticalScrollDirection===qt.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===vt.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===vt.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&Ua(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!Ua(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,i);return n?n===this._container||this._container.contains(n):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=jo(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function om(o,t){let{top:e,bottom:i,height:n}=o,s=n*nm;return t>=e-s&&t<=e+s?qt.UP:t>=i-s&&t<=i+s?qt.DOWN:qt.NONE}function rm(o,t){let{left:e,right:i,width:n}=o,s=n*nm;return t>=e-s&&t<=e+s?vt.LEFT:t>=i-s&&t<=i+s?vt.RIGHT:vt.NONE}function W1(o,t,e,i,n){let s=om(t,n),d=rm(t,i),p=qt.NONE,h=vt.NONE;if(s){let C=o.scrollTop;s===qt.UP?C>0&&(p=qt.UP):o.scrollHeight-C>o.clientHeight&&(p=qt.DOWN)}if(d){let C=o.scrollLeft;e==="rtl"?d===vt.RIGHT?C<0&&(h=vt.RIGHT):o.scrollWidth+C>o.clientWidth&&(h=vt.LEFT):d===vt.LEFT?C>0&&(h=vt.LEFT):o.scrollWidth-C>o.clientWidth&&(h=vt.RIGHT)}return[p,h]}var Jn={capture:!0},ja={passive:!1,capture:!0},G1=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275cmp=V({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),am=(()=>{class o{_ngZone=K(mt);_document=K(Gn);_styleLoader=K(Uc);_renderer=K(qn).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Sa([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new ve;pointerUp=new ve;scroll=new ve;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=Si(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,ja)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(G1),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=i.type.startsWith("touch"),s=p=>this.pointerUp.next(p),d=[["scroll",p=>this.scroll.next(p),Jn],["selectstart",this._preventDefaultWhileDragging,ja]];n?d.push(["touchend",s,Jn],["touchcancel",s,Jn]):d.push(["mouseup",s,Jn]),n||d.push(["mousemove",p=>this.pointerMove.next(p),ja]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=d.map(([p,h,C])=>Si(this._renderer,this._document,p,h,C))})}}stopDragging(e){this._activeDragInstances.update(i=>{let n=i.indexOf(e);return n>-1?(i.splice(n,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this.scroll];return e&&e!==this._document&&i.push(new ii(n=>this._ngZone.runOutsideAngular(()=>{let s=Si(this._renderer,e,"scroll",d=>{this._activeDragInstances().length&&n.next(d)},Jn);return()=>{s()}}))),Fi(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||o)};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),K1={dragStartThreshold:5,pointerDirectionChangeThreshold:5},sm=(()=>{class o{_document=K(Gn);_ngZone=K(mt);_viewportRuler=K(zo);_dragDropRegistry=K(am);_renderer=K(qn).createRenderer(null,null);constructor(){}createDrag(e,i=K1){return new Ha(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new qa(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Jd=new Ci("CDK_DRAG_PARENT");var Q1=new Ci("CdkDragHandle");var Y1=new Ci("CDK_DRAG_CONFIG"),X1=new Ci("CdkDropList"),lm=(()=>{class o{element=K(Hn);dropContainer=K(X1,{optional:!0,skipSelf:!0});_ngZone=K(mt);_viewContainerRef=K(wo);_dir=K(Ho,{optional:!0});_changeDetectorRef=K(Fe);_selfHandle=K(Q1,{optional:!0,self:!0});_parentDrag=K(Jd,{optional:!0,skipSelf:!0});_dragDropRegistry=K(am);_destroyed=new ve;_handles=new ni([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new Ue;released=new Ue;ended=new Ue;entered=new Ue;exited=new Ue;dropped=new Ue;moved=new ii(e=>{let i=this._dragRef.moved.pipe(Se(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=K(tn);constructor(){let e=this.dropContainer,i=K(Y1,{optional:!0}),n=K(sm);this._dragRef=n.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(So(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Eo(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,n=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),n=i.indexOf(e);n>-1&&(i.splice(n,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Ei(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,n=this.dragStartDelay,s=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,d=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:jc(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(s).withPreviewTemplate(d).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(xo(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let n=this._dragDropRegistry.getDragDirectiveForNode(i);if(n){e.withParent(n._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:n,constrainPosition:s,previewClass:d,boundaryElement:p,draggingDisabled:h,rootElementSelector:C,previewContainer:E}=e;this.disabled=h??!1,this.dragStartDelay=n||0,i&&(this.lockAxis=i),s&&(this.constrainPosition=s),d&&(this.previewClass=d),p&&(this.boundaryElement=p),C&&(this.rootElementSelector=C),E&&(this.previewContainer=E)}_setupHandlesListener(){this._handles.pipe(Vi(e=>{let i=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),ft(e=>Fi(...e.map(i=>i._stateChanges.pipe(Ai(i))))),So(this._destroyed)).subscribe(e=>{let i=this._dragRef,n=e.element.nativeElement;e.disabled?i.disableHandle(n):i.enableHandle(n)})}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Po({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,n){i&2&&G("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",fi],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Ql]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Li([{provide:Jd,useExisting:o}]),en]})}return o})();var Br=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Wn({type:o});static \u0275inj=$n({providers:[sm],imports:[qo]})}return o})();var Rp=lt(el());var Nn=class o{constructor(t){this.http=t}base=`${J.apiUrl}/label-designs`;headers(){let t=localStorage.getItem("token")||"";return new ne({"x-auth-token":t})}list(){return this.http.get(this.base,{headers:this.headers()})}get(t){return this.http.get(`${this.base}/${t}`,{headers:this.headers()})}create(t){return this.http.post(this.base,t,{headers:this.headers()})}update(t,e){return this.http.put(`${this.base}/${t}`,e,{headers:this.headers()})}remove(t){return this.http.delete(`${this.base}/${t}`,{headers:this.headers()})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var Z2=["barcodeSvg"];function J2(o,t){if(o&1){let e=I();a(0,"div")(1,"div")(2,"label",4),c(3,"Fuente (pt)"),r(),a(4,"input",27),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.fontSize,n)||(s.selected.fontSize=n),v(n)}),r()(),a(5,"div",14)(6,"div",15)(7,"label")(8,"input",28),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.bold,n)||(s.selected.bold=n),v(n)}),r(),c(9," Negritas"),r()(),a(10,"div",16)(11,"label",29),c(12,"Alineaci\xF3n"),r(),a(13,"select",5),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.align,n)||(s.selected.align=n),v(n)}),a(14,"option"),c(15,"left"),r(),a(16,"option"),c(17,"center"),r(),a(18,"option"),c(19,"right"),r()()()(),a(20,"div",14)(21,"div",30)(22,"label",29),c(23,"Prefix"),r(),a(24,"input",5),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.prefix,n)||(s.selected.prefix=n),v(n)}),r()(),a(25,"div",30)(26,"label",31),c(27,"Suffix"),r(),a(28,"input",5),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.suffix,n)||(s.selected.suffix=n),v(n)}),r()(),a(29,"label")(30,"input",28),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.uppercase,n)||(s.selected.uppercase=n),v(n)}),r(),c(31," MAY\xDASCULAS"),r()()()}if(o&2){let e=u(2);l(4),T("ngModel",e.selected.fontSize),l(4),T("ngModel",e.selected.bold),l(5),T("ngModel",e.selected.align),l(11),T("ngModel",e.selected.prefix),l(4),T("ngModel",e.selected.suffix),l(2),T("ngModel",e.selected.uppercase)}}function eS(o,t){if(o&1){let e=I();a(0,"div")(1,"label"),c(2,"S\xEDmbolo"),r(),a(3,"select",5),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.barcode.symbology,n)||(s.selected.barcode.symbology=n),v(n)}),a(4,"option"),c(5,"CODE128"),r(),a(6,"option"),c(7,"EAN13"),r(),a(8,"option"),c(9,"EAN8"),r(),a(10,"option"),c(11,"QR"),r()(),a(12,"label"),c(13,"Width(px)"),r(),a(14,"input",8),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.barcode.width,n)||(s.selected.barcode.width=n),v(n)}),r(),a(15,"label"),c(16,"Height(px)"),r(),a(17,"input",8),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.barcode.height,n)||(s.selected.barcode.height=n),v(n)}),r(),a(18,"label")(19,"input",28),k("ngModelChange",function(n){b(e);let s=u(2);return O(s.selected.barcode.displayValue,n)||(s.selected.barcode.displayValue=n),v(n)}),r(),c(20," Mostrar texto"),r()()}if(o&2){let e=u(2);l(3),T("ngModel",e.selected.barcode.symbology),l(11),T("ngModel",e.selected.barcode.width),l(3),T("ngModel",e.selected.barcode.height),l(2),T("ngModel",e.selected.barcode.displayValue)}}function tS(o,t){if(o&1){let e=I();a(0,"div")(1,"h4",6),c(2,"Propiedades"),r(),a(3,"div",26),c(4,"Tipo: "),a(5,"span")(6,"strong"),c(7),r()()(),S(8,J2,32,6,"div",17)(9,eS,21,4,"div",17),a(10,"button",19),g("click",function(){b(e);let n=u();return v(n.deleteSelected())}),c(11,"Eliminar elemento"),r()()}if(o&2){let e=u();l(7),_(e.selected.type),l(),m("ngIf",e.selected.type!=="barcode"),l(),m("ngIf",e.selected.type==="barcode")}}function iS(o,t){if(o&1&&(a(0,"div",36),c(1),r()),o&2){let e=u().$implicit,i=u();m("ngStyle",i.textStyle(e)),l(),x(" ",i.sampleValue(e)," ")}}function nS(o,t){if(o&1&&(a(0,"div",36),c(1),r()),o&2){let e=u().$implicit,i=u();m("ngStyle",i.textStyle(e)),l(),x(" ",i.formatPrice(123.45,e)," ")}}function oS(o,t){o&1&&(a(0,"div"),zl(),f(1,"svg",null,0),r())}function rS(o,t){if(o&1){let e=I();a(0,"div",32),g("click",function(n){let s=b(e).$implicit,d=u();return n.stopPropagation(),v(d.selected=s)})("cdkDragEnded",function(n){let s=b(e).$implicit,d=u();return v(d.onDragEnd(n,s))}),oe(1,33),S(2,iS,2,2,"div",34)(3,nS,2,2,"div",34)(4,oS,3,0,"div",35),re(),r()}if(o&2){let e=t.$implicit,i=u();xt("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),G("selected",e===i.selected),l(),m("ngSwitch",e.type),l(),m("ngSwitchCase","text"),l(),m("ngSwitchCase","price"),l(),m("ngSwitchCase","barcode")}}function aS(o,t){if(o&1){let e=I();a(0,"li",19),g("click",function(){let n=b(e).$implicit,s=u();return v(s.load(n))}),c(1),a(2,"button",37),g("click",function(n){let s=b(e).$implicit,d=u();return v(d.remove(s,n))}),c(3,"Borrar"),r()()}if(o&2){let e=t.$implicit,i=u();G("active",e._id===i.design._id),l(),x(" ",e.nombre," ")}}var Zr=class o{constructor(t){this.svc=t}design=this.blankDesign();disenos=[];selected=null;barcodeSvgs;ngOnInit(){this.refreshList()}blankDesign(){return{nombre:"",widthMm:50,heightMm:30,marginMm:2,gapXmm:2,gapYmm:2,cols:3,rows:8,elements:[]}}refreshList(){this.svc.list().subscribe(t=>this.disenos=t||[])}load(t){t?._id?this.svc.get(t._id).subscribe(e=>this.design=e):this.design=ae({},t)}nuevo(){this.design=this.blankDesign(),this.selected=null}addText(t){this.design.elements.push({type:"text",field:t,x:5,y:5,w:60,h:10,fontSize:9,align:"left",bold:!1,uppercase:!1,prefix:"",suffix:""})}addPrice(){this.design.elements.push({type:"price",field:"precioVenta",x:5,y:20,w:60,h:15,fontSize:16,align:"left",bold:!0,prefix:"$"})}addBarcode(){this.design.elements.push({type:"barcode",field:"codigoBarras",x:5,y:40,w:80,h:25,barcode:{symbology:"CODE128",width:1,height:30,displayValue:!1}}),setTimeout(()=>this.renderBarcodes(),0)}deleteSelected(){this.selected&&(this.design.elements=this.design.elements.filter(t=>t!==this.selected),this.selected=null)}onDragEnd(t,e){let n=t.source.element.nativeElement.parentElement.getBoundingClientRect(),s=t.source.getFreeDragPosition();e.x=Math.max(0,Math.min(100,s.x/n.width*100)),e.y=Math.max(0,Math.min(100,s.y/n.height*100))}textStyle(t){return{"font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"text-align":t.align||"left",width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start",overflow:"hidden","white-space":"nowrap"}}sampleValue(t){let e={nombre:"Ciprofloxacino 3.5 mg / Dexametasona 1 mg / 1 mL SONS C/5 mL Sol Oftalmica",renglon1:"Ciprofloxacino / Dexametasona",renglon2:"3.5 mg /1 mg / 1 mL C/5 mL",codigoBarras:"7501234567890",precioVenta:"123.45",custom:t.text||"Texto fijo"},i=t.field||"nombre",n=e[i]||"";return t.uppercase&&(n=String(n).toUpperCase()),`${t.prefix||""}${n}${t.suffix||""}`}formatPrice(t,e){let i=(e.prefix||"$")+Number(t||0).toFixed(2);return e.uppercase?i.toUpperCase():i}renderBarcodes(){let t=this.barcodeSvgs.toArray(),e=0;this.design.elements.forEach(i=>{if(i.type!=="barcode")return;let n=t[e++]?.nativeElement;if(!n)return;if(i.barcode?.symbology==="QR"){n.innerHTML="";return}let s=this.sampleValue(qe(ae({},i),{field:"codigoBarras"}));(0,Rp.default)(n,s,{format:i.barcode?.symbology||"CODE128",width:i.barcode?.width||1,height:i.barcode?.height||30,displayValue:i.barcode?.displayValue||!1,margin:0})})}save(){let t=this.design;if(!t||!t.nombre?.trim()){alert("Ponle un nombre al dise\xF1o.");return}if(!t.widthMm||!t.heightMm){alert("Define el tama\xF1o de la etiqueta (ancho/alto en mm).");return}Array.isArray(t.elements)||(t.elements=[]),(t._id?this.svc.update(t._id,t):this.svc.create(t)).subscribe({next:i=>{this.design=i,this.refreshList()},error:i=>{console.error("Error al guardar dise\xF1o",i);let n=i?.error?.error||i?.error?.mensaje||i?.message||"No se pudo guardar el dise\xF1o";alert(n)}})}remove(t,e){e.stopPropagation(),t._id&&confirm(`\xBFEliminar dise\xF1o "${t.nombre}"?`)&&this.svc.remove(t._id).subscribe(()=>this.refreshList())}static \u0275fac=function(e){return new(e||o)(P(Nn))};static \u0275cmp=V({type:o,selectors:[["app-label-designer"]],viewQuery:function(e,i){if(e&1&&Ee(Z2,5),e&2){let n;ye(n=Ce())&&(i.barcodeSvgs=n)}},decls:75,vars:19,consts:[["barcodeSvg",""],[1,"designer"],[1,"sidebar"],[1,"titulo","text-center"],[2,"margin-right","1rem"],[3,"ngModelChange","ngModel"],[1,"subtitulo","text-center","mt-1"],[1,"grid"],["type","number",3,"ngModelChange","ngModel"],[1,"row","mb-1"],[1,"col-4"],[1,"btn-rojo-chico",3,"click"],[1,"col-4",2,"text-align","center"],[1,"col-4",2,"text-align","end"],[1,"row"],[1,"col-5"],[1,"col-7",2,"text-align","end"],[4,"ngIf"],[1,"acciones"],[3,"click"],[1,"canvas-wrap"],[1,"label-canvas",3,"click"],[1,"label-inner"],["class","el","cdkDrag","",3,"selected","left","top","width","height","click","cdkDragEnded",4,"ngFor","ngForOf"],[1,"design-list"],[3,"active","click",4,"ngFor","ngForOf"],[2,"text-align","center"],["type","number",2,"width","4rem",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],[2,"margin-right","0.5rem"],[1,"col-6"],[2,"margin-right","0.5rem","text-align","end"],["cdkDrag","",1,"el",3,"click","cdkDragEnded"],[3,"ngSwitch"],[3,"ngStyle",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"ngStyle"],[1,"mini",3,"click"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"div",2)(2,"h3",3),c(3,"Dise\xF1o"),r(),a(4,"label",4),c(5,"Nombre"),r(),a(6,"input",5),k("ngModelChange",function(s){return O(i.design.nombre,s)||(i.design.nombre=s),s}),r(),a(7,"h4",6),c(8,"Tama\xF1o etiqueta (mm)"),r(),a(9,"div",7)(10,"label"),c(11,"Ancho"),r(),a(12,"input",8),k("ngModelChange",function(s){return O(i.design.widthMm,s)||(i.design.widthMm=s),s}),r(),a(13,"label"),c(14,"Alto"),r(),a(15,"input",8),k("ngModelChange",function(s){return O(i.design.heightMm,s)||(i.design.heightMm=s),s}),r(),a(16,"label"),c(17,"Margen"),r(),a(18,"input",8),k("ngModelChange",function(s){return O(i.design.marginMm,s)||(i.design.marginMm=s),s}),r()(),a(19,"h4",6),c(20,"Hoja (mm)"),r(),a(21,"div",7)(22,"label"),c(23,"Ancho p\xE1g."),r(),a(24,"input",8),k("ngModelChange",function(s){return O(i.design.pageWidthMm,s)||(i.design.pageWidthMm=s),s}),r(),a(25,"label"),c(26,"Alto p\xE1g."),r(),a(27,"input",8),k("ngModelChange",function(s){return O(i.design.pageHeightMm,s)||(i.design.pageHeightMm=s),s}),r(),a(28,"label"),c(29,"Cols"),r(),a(30,"input",8),k("ngModelChange",function(s){return O(i.design.cols,s)||(i.design.cols=s),s}),r(),a(31,"label"),c(32,"Rens"),r(),a(33,"input",8),k("ngModelChange",function(s){return O(i.design.rows,s)||(i.design.rows=s),s}),r(),a(34,"label"),c(35,"Gap X"),r(),a(36,"input",8),k("ngModelChange",function(s){return O(i.design.gapXmm,s)||(i.design.gapXmm=s),s}),r(),a(37,"label"),c(38,"Gap Y"),r(),a(39,"input",8),k("ngModelChange",function(s){return O(i.design.gapYmm,s)||(i.design.gapYmm=s),s}),r()(),a(40,"div")(41,"h4",6),c(42,"Agregar elemento"),r(),a(43,"div",9)(44,"div",10)(45,"button",11),g("click",function(){return i.addText("nombre")}),c(46,"Nombre"),r()(),a(47,"div",12)(48,"button",11),g("click",function(){return i.addText("renglon1")}),c(49,"Rengl\xF3n 1"),r()(),a(50,"div",13)(51,"button",11),g("click",function(){return i.addText("renglon2")}),c(52,"Rengl\xF3n 2"),r()()(),a(53,"div",14)(54,"div",15)(55,"button",11),g("click",function(){return i.addPrice()}),c(56,"Precio"),r()(),a(57,"div",16)(58,"button",11),g("click",function(){return i.addBarcode()}),c(59,"C\xF3digo de barras"),r()()()(),S(60,tS,12,3,"div",17),a(61,"div",18)(62,"button",19),g("click",function(){return i.save()}),c(63,"Guardar dise\xF1o"),r(),a(64,"button",19),g("click",function(){return i.nuevo()}),c(65,"Nuevo"),r()()(),a(66,"div",20)(67,"div",21),g("click",function(){return i.selected=null}),a(68,"div",22),S(69,rS,5,14,"div",23),r()(),a(70,"div",24)(71,"h4"),c(72,"Mis dise\xF1os guardados"),r(),a(73,"ul"),S(74,aS,4,3,"li",25),r()()()()),e&2&&(l(6),T("ngModel",i.design.nombre),l(6),T("ngModel",i.design.widthMm),l(3),T("ngModel",i.design.heightMm),l(3),T("ngModel",i.design.marginMm),l(6),T("ngModel",i.design.pageWidthMm),l(3),T("ngModel",i.design.pageHeightMm),l(3),T("ngModel",i.design.cols),l(3),T("ngModel",i.design.rows),l(3),T("ngModel",i.design.gapXmm),l(3),T("ngModel",i.design.gapYmm),l(21),m("ngIf",i.selected),l(7),xt("width",i.design.widthMm+"mm")("height",i.design.heightMm+"mm"),l(),xt("padding",(i.design.marginMm||0)+"mm"),l(),m("ngForOf",i.design.elements),l(5),m("ngForOf",i.disenos))},dependencies:[me,ce,de,ie,Ae,at,le,Z,xe,j,Y,z,rn,To,Oo,Br,lm],styles:[".designer[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr;gap:12px}.sidebar[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;border-radius:8px;background-color:#d3f9ec}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:6px 10px;align-items:center}.canvas-wrap[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 220px;gap:12px;align-items:start}.label-canvas[_ngcontent-%COMP%]{background:#fff;border:1px dashed #bbb;position:relative}.label-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#fafafa}.el[_ngcontent-%COMP%]{position:absolute;border:1px dashed transparent;padding:2px;box-sizing:border-box}.el.selected[_ngcontent-%COMP%]{border-color:#1976d2}.design-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.design-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:6px;cursor:pointer}.design-list[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#eef5ff}.design-list[_ngcontent-%COMP%]   .mini[_ngcontent-%COMP%]{font-size:12px}"]})};var tl=lt(el());var Ap=lt(_t());var Jr=class o{constructor(t){this.http=t}api=`${J.apiUrl}/labels/products`;search(t){let e=new Le().set("farmaciaId",t.farmaciaId);return t.nombre&&(e=e.set("nombre",t.nombre)),t.categoria&&(e=e.set("categoria",t.categoria)),t.page&&(e=e.set("page",String(t.page))),t.limit&&(e=e.set("limit",String(t.limit))),this.http.get(this.api,{params:e,headers:new ne({"x-auth-token":localStorage.getItem("token")||""})})}static \u0275fac=function(e){return new(e||o)(he(ge))};static \u0275prov=se({token:o,factory:o.\u0275fac,providedIn:"root"})};var lS=["printHost"],cS=["printBarcode"];function dS(o,t){if(o&1&&(a(0,"option",39),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function mS(o,t){if(o&1&&(a(0,"option",39),c(1),r()),o&2){let e=t.$implicit;m("value",e._id),l(),_(e.nombre)}}function pS(o,t){if(o&1){let e=I();a(0,"tr")(1,"td")(2,"input",40),k("ngModelChange",function(n){let s=b(e).$implicit;return O(s._checked,n)||(s._checked=n),v(n)}),g("ngModelChange",function(){let n=b(e).$implicit,s=u();return v(s.onToggleRow(n))}),r()(),a(3,"td"),c(4),r(),a(5,"td"),c(6),r(),a(7,"td"),c(8),r(),a(9,"td"),c(10),r(),a(11,"td"),c(12),r(),a(13,"td"),c(14),y(15,"currency"),r(),a(16,"td"),c(17),r()()}if(o&2){let e=t.$implicit;l(2),T("ngModel",e._checked),l(2),_(e.nombre),l(2),_(e.codigoBarras),l(2),_(e.renglon1),l(2),_(e.renglon2),l(2),_(e.categoria),l(2),_(M(15,8,e.precioVenta)),l(3),_(e.existencia)}}function uS(o,t){if(o&1&&(a(0,"div"),c(1),r()),o&2){let e=u().$implicit,i=u().$implicit,n=u(2);l(),_(n.valorCampo(i,e))}}function fS(o,t){if(o&1&&(a(0,"div"),c(1),r()),o&2){let e=u().$implicit,i=u().$implicit,n=u(2);l(),_(n.valorPrecio(i,e))}}function hS(o,t){o&1&&f(0,"img",51)}function gS(o,t){if(o&1&&(oe(0),a(1,"div",47),oe(2,48),S(3,uS,2,1,"div",49)(4,fS,2,1,"div",49)(5,hS,1,0,"img",50),re(),r(),re()),o&2){let e=t.$implicit,i=u(3);l(),xt("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),m("ngStyle",i.styleTexto(e)),l(),m("ngSwitch",e.type),l(),m("ngSwitchCase","text"),l(),m("ngSwitchCase","price"),l(),m("ngSwitchCase","barcode")}}function _S(o,t){if(o&1&&(oe(0),a(1,"div",45)(2,"div",46),S(3,gS,6,13,"ng-container",44),r()(),re()),o&2){let e=u().ngIf;l(),xt("width",(e.widthMm||0)+"mm")("height",(e.heightMm||0)+"mm"),l(),xt("padding",(e.marginMm||0)+"mm"),l(),m("ngForOf",e.elements)}}function bS(o,t){if(o&1&&(a(0,"div",41)(1,"div",42,0)(3,"div",43),S(4,_S,4,7,"ng-container",44),r()()()),o&2){let e=t.ngIf,i=u();l(),xt("width",(e.pageWidthMm||210)+"mm")("height",(e.pageHeightMm||297)+"mm"),l(2),xt("gap",(e.gapYmm||0)+"mm "+(e.gapXmm||0)+"mm")("grid-template-columns","repeat("+(e.cols||1)+", "+(e.widthMm||0)+"mm)")("grid-template-rows","repeat("+(e.rows||1)+", "+(e.heightMm||0)+"mm)"),l(),m("ngForOf",i.itemsParaImprimir)}}var ea=class o{constructor(t,e,i,n,s){this.designsSvc=t;this.prodSvc=e;this.farmacia=i;this.cdr=n;this.zone=s}disenos=[];designId=null;design=null;fNombre="";fCategoria="";productos=[];allChecked=!1;mostrarPrint=!1;itemsParaImprimir=[];farmacias=[];farmaciaId="";printHost;printBarcodes;get seleccionados(){return this.productos.filter(t=>t._checked)}page=1;limit=20;totalFiltrado=0;totalPages=1;selectedIds=new Set;selectedItems=new Map;get totalSeleccionados(){return this.selectedIds.size}ngOnInit(){this.designsSvc.list().subscribe(e=>{this.disenos=e,e.length&&(this.designId=e[0]._id,this.loadDesign())});let t=localStorage.getItem("farmaciaId_print")||"";this.farmaciaId=t,this.cargarFarmacias(),window.addEventListener("afterprint",()=>{this.mostrarPrint=!1,this.cdr.detectChanges()})}renderBarcodesIn(t){let e=Array.from(t.querySelectorAll("img.barcode")),i=0;for(let n of this.itemsParaImprimir)for(let s of this.design?.elements||[]){if(s.type!=="barcode")continue;let d=e[i++];if(!d)continue;let p=this.valorCampo(n,qe(ae({},s),{field:"codigoBarras"}))||"";if((s.barcode?.symbology||"CODE128")==="QR"){d.src="";continue}(0,tl.default)(d,p,{format:s.barcode?.symbology||"CODE128",width:s.barcode?.width||1,height:s.barcode?.height||30,displayValue:s.barcode?.displayValue||!1,margin:0})}}buildPrintHtml(t){return`<!doctype html><html><head><meta charset="utf-8">
  <style>
    @page { margin: 0; }
    html, body { margin: 0; padding: 0; }
    .page { margin: 0 auto; overflow: hidden; }
    .labels-grid { display: grid; }
    .label-box { background:#fff; position: relative; }
    .label-inner { position: relative; width:100%; height:100%; }
    .el { position:absolute; }
    img { max-width: 100%; max-height: 100%; display: block; }
  </style></head><body>${t.outerHTML}</body></html>`}printViaNewWindow(t){let e=window.open("","_blank","width=800,height=600");if(!e){alert("\u26A0\uFE0F El navegador bloque\xF3 la ventana de impresi\xF3n. Habilita pop-ups para continuar.");return}e.document.open(),e.document.write(t),e.document.close(),e.onload=()=>{setTimeout(()=>{e.focus(),e.print(),e.close()},300)}}cargarFarmacias(){this.farmacia.obtenerFarmacias().subscribe({next:t=>{this.farmacias=t||[]},error:()=>{this.farmacias=[]}})}normalizeDesign(t){let e=t?.size||{},i=t?.layout||{};return qe(ae({},t),{widthMm:e.widthMm??t.widthMm??0,heightMm:e.heightMm??t.heightMm??0,marginMm:e.marginMm??t.marginMm??0,pageWidthMm:i.pageWidthMm??t.pageWidthMm??210,pageHeightMm:i.pageHeightMm??t.pageHeightMm??297,cols:i.columns??t.cols??1,rows:i.rows??t.rows??1,gapXmm:i.gapXmm??t.gapXmm??0,gapYmm:i.gapYmm??t.gapYmm??0})}loadDesign(){this.designId&&this.designsSvc.get(this.designId).subscribe(t=>{this.design=this.normalizeDesign(t)})}buscar(){let t=this.farmaciaId?.trim();if(!t){Ap.default.fire({icon:"info",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.prodSvc.search({farmaciaId:t,nombre:this.fNombre,categoria:this.fCategoria,page:this.page,limit:this.limit}).subscribe(e=>{this.productos=(e.rows||[]).map(i=>{let n=String(i._id);return qe(ae({},i),{_id:n,_checked:this.selectedIds.has(n)})}),this.allChecked=this.productos.length>0&&this.productos.every(i=>i._checked),this.totalFiltrado=e?.paginacion?.total??this.productos.length,this.totalPages=e?.paginacion?.totalPages??1,this.page=e?.paginacion?.page??1,this.limit=e?.paginacion?.limit??this.limit})}onToggleRow(t){let e=String(t._id);t._checked?(this.selectedIds.add(e),this.selectedItems.set(e,t)):(this.selectedIds.delete(e),this.selectedItems.delete(e)),this.allChecked=this.productos.length>0&&this.productos.every(i=>this.selectedIds.has(String(i._id)))}toggleAll(t){this.allChecked=t.target.checked;for(let e of this.productos){let i=String(e._id);e._checked=this.allChecked,this.allChecked?(this.selectedIds.add(i),this.selectedItems.set(i,e)):(this.selectedIds.delete(i),this.selectedItems.delete(i))}}trackById=(t,e)=>e?._id;onFarmaciaChange(){localStorage.setItem("farmaciaId_print",this.farmaciaId),this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.buscar()}limpiar(){this.fCategoria="",this.fNombre="",this.buscar()}updateChecked(){this.seleccionados}irPrimera(){this.page!==1&&(this.page=1,this.buscar())}irAnterior(){this.page>1&&(this.page--,this.buscar())}irSiguiente(){this.page<this.totalPages&&(this.page++,this.buscar())}irUltima(){this.page!==this.totalPages&&(this.page=this.totalPages,this.buscar())}cambiarLimit(t){this.limit=Number(t)||20,this.page=1,this.buscar()}escapeHtml(t){return String(t??"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}barcodeDataUrl(t,e="CODE128",i=1,n=30,s=!1){let d=document.createElement("canvas"),p=t&&String(t).trim().length?String(t):"000000000000";return(0,tl.default)(d,p,{format:e,width:i,height:n,displayValue:s,margin:0}),d.toDataURL("image/png")}previsualizar(){!this.design||this.selectedIds.size===0||(this.itemsParaImprimir=Array.from(this.selectedItems.values()),this.mostrarPrint=!0,setTimeout(()=>{this.cdr.detectChanges();let t=this.printHost?.nativeElement;if(!t)return;let e=t.cloneNode(!0);console.log(this.itemsParaImprimir[0]),this.renderBarcodesIn(e);let i=this.buildPrintHtml(e);this.printViaNewWindow(i),setTimeout(()=>{this.mostrarPrint=!1,this.cdr.detectChanges()},300)},0))}styleTexto(t){return{position:"absolute","font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"text-align":t.align||"left",overflow:"hidden",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start"}}valorCampo(t,e){let i={nombre:t.nombre,renglon1:t.renglon1,renglon2:t.renglon2,codigoBarras:t.codigoBarras,precioVenta:t.precioVenta},n=e.field&&i[e.field]!=null?i[e.field]:e.text||"";return e.uppercase&&typeof n=="string"&&(n=n.toUpperCase()),`${e.prefix||""}${n}${e.suffix||""}`}valorPrecio(t,e){let i=t.precioVenta??0,n=(e.prefix||"$")+Number(i).toFixed(2)+(e.suffix||"");return e.uppercase?n.toUpperCase():n}static \u0275fac=function(e){return new(e||o)(P(Nn),P(Jr),P(ze),P(Fe),P(mt))};static \u0275cmp=V({type:o,selectors:[["app-etiquetas-print"]],viewQuery:function(e,i){if(e&1&&(Ee(lS,5),Ee(cS,5)),e&2){let n;ye(n=Ce())&&(i.printHost=n.first),ye(n=Ce())&&(i.printBarcodes=n)}},decls:90,vars:28,consts:[["printHost",""],[1,"etiquetas"],[1,"titulo","text-center"],[1,"filtros"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"col-md-3"],["placeholder","Nombre",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],["placeholder","Categor\xEDa",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],[1,"col-md-1"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"col-md-1",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"row","g-2","align-items-end","mb-2"],[1,"col-md-6",2,"margin-top","1.3rem"],["matTooltip","Imprimir","aria-label","Imprimir",1,"btn-amarillo","btn-icon-only",3,"click","disabled"],[1,"bi","bi-printer"],[1,"col-md-6",2,"margin-top","1.3rem","text-align","end"],[1,"btn-gris",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change","checked"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-2","paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","etiquetas-impresion",4,"ngIf"],[3,"value"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"etiquetas-impresion"],[1,"page"],[1,"labels-grid"],[4,"ngFor","ngForOf"],[1,"label-box"],[1,"label-inner"],[1,"el",3,"ngStyle"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","barcode",4,"ngSwitchCase"],[1,"barcode"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"h2",2),c(2,"Impresi\xF3n de etiquetas"),r(),a(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),c(7,"Farmacia"),r(),a(8,"div")(9,"select",7),k("ngModelChange",function(s){return O(i.farmaciaId,s)||(i.farmaciaId=s),s}),g("change",function(){return i.onFarmaciaChange()}),a(10,"option",8),c(11,"\u2014 Selecciona \u2014"),r(),S(12,dS,2,2,"option",9),r()()(),a(13,"div",5)(14,"label",6),c(15,"Dise\xF1o"),r(),a(16,"div")(17,"select",10),k("ngModelChange",function(s){return O(i.designId,s)||(i.designId=s),s}),g("change",function(){return i.loadDesign()}),S(18,mS,2,2,"option",9),r()()(),a(19,"div",11)(20,"label",6),c(21,"Nombre"),r(),a(22,"div")(23,"input",12),k("ngModelChange",function(s){return O(i.fNombre,s)||(i.fNombre=s),s}),g("keyup.enter",function(){return i.buscar()}),r()()(),a(24,"div",11)(25,"label",6),c(26,"Categor\xEDa"),r(),a(27,"div")(28,"input",13),k("ngModelChange",function(s){return O(i.fCategoria,s)||(i.fCategoria=s),s}),g("keyup.enter",function(){return i.buscar()}),r()()(),a(29,"div",14)(30,"label",6),c(31,"x p\xE1g.:"),r(),a(32,"div")(33,"select",15),g("ngModelChange",function(s){return i.cambiarLimit(s)}),a(34,"option",16),c(35,"10"),r(),a(36,"option",16),c(37,"20"),r(),a(38,"option",16),c(39,"50"),r(),a(40,"option",16),c(41,"100"),r()()()(),a(42,"div",17)(43,"button",18),g("click",function(){return i.limpiar()}),f(44,"i",19),r()()(),a(45,"div",20)(46,"div",21)(47,"button",22),g("click",function(){return i.previsualizar()}),f(48,"i",23),r()(),a(49,"div",24)(50,"button",25),g("click",function(){return i.buscar()}),c(51,"Buscar"),r()()()(),a(52,"table",26)(53,"thead")(54,"tr")(55,"th")(56,"input",27),g("change",function(s){return i.toggleAll(s)}),r()(),a(57,"th"),c(58,"Nombre"),r(),a(59,"th"),c(60,"C\xF3digo barras"),r(),a(61,"th"),c(62,"Rengl\xF3n 1"),r(),a(63,"th"),c(64,"Rengl\xF3n 2"),r(),a(65,"th"),c(66,"Categor\xEDa"),r(),a(67,"th"),c(68,"Precio"),r(),a(69,"th"),c(70,"Exist."),r()()(),a(71,"tbody"),S(72,pS,18,10,"tr",28),r()()(),a(73,"div",29)(74,"span")(75,"b"),c(76,"Etiquetas a imprimir:"),r(),c(77),r()(),a(78,"div",29)(79,"button",30),g("click",function(){return i.irPrimera()}),f(80,"i",31),r(),a(81,"button",32),g("click",function(){return i.irAnterior()}),f(82,"i",33),r(),a(83,"span"),c(84),r(),a(85,"button",34),g("click",function(){return i.irSiguiente()}),f(86,"i",35),r(),a(87,"button",36),g("click",function(){return i.irUltima()}),f(88,"i",37),r()(),S(89,bS,5,11,"div",38)),e&2&&(l(9),T("ngModel",i.farmaciaId),l(3),m("ngForOf",i.farmacias),l(5),T("ngModel",i.designId),m("disabled",!i.farmaciaId||!(i.disenos&&i.disenos.length)),l(),m("ngForOf",i.disenos),l(5),T("ngModel",i.fNombre),m("disabled",!i.farmaciaId),l(5),T("ngModel",i.fCategoria),m("disabled",!i.farmaciaId),l(5),m("ngModel",i.limit),l(),m("ngValue",10),l(2),m("ngValue",20),l(2),m("ngValue",50),l(2),m("ngValue",100),l(7),m("disabled",!i.farmaciaId||i.seleccionados.length===0||!i.design),l(3),m("disabled",!i.farmaciaId),l(6),m("checked",i.allChecked),l(16),m("ngForOf",i.productos)("ngForTrackBy",i.trackById),l(5),x(" ",i.totalSeleccionados,""),l(2),m("disabled",i.page<=1),l(2),m("disabled",i.page<=1),l(3),jt("\xA0 ",i.totalFiltrado," productos. P\xE1gina ",i.page," / ",i.totalPages," \xA0"),l(),m("disabled",i.page>=i.totalPages),l(2),m("disabled",i.page>=i.totalPages),l(2),m("ngIf",i.mostrarPrint&&i.design))},dependencies:[me,ce,de,ie,at,le,Z,xe,j,Y,z,rn,To,Oo,Re,Br,Ve,_e],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.btn-icon-only[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;padding:0;display:inline-flex;align-items:center;justify-content:center;border-radius:.5rem}.btn-icon-only[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1}.barra[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:6px}.etiquetas-impresion[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;z-index:9999}.page[_ngcontent-%COMP%]{margin:0 auto;position:relative}.labels-grid[_ngcontent-%COMP%]{display:grid}.label-box[_ngcontent-%COMP%]{background:#fff;border:1px dashed transparent;position:relative}.label-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}.el[_ngcontent-%COMP%]{position:absolute}@media print{.barra[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]{display:none!important}.etiquetas-impresion[_ngcontent-%COMP%]{display:block!important}@page{margin:0}}"]})};var Vp=[{path:"",component:xr,children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Zo},{path:"ventas",component:rr,canActivate:[Pt],data:{rolesPermitidos:["admin","empleado"]}},{path:"pedidos",component:ar,canActivate:[Pt],data:{rolesPermitidos:["admin","empleado"]}},{path:"devoluciones",component:cr,canActivate:[Pt],data:{rolesPermitidos:["admin","empleado"]}},{path:"inicio-turno",component:mr,canActivate:[Pt],data:{rolesPermitidos:["admin","empleado"]}},{path:"surtir-farmacia",component:ur,canActivate:[Pt],data:{rolesPermitidos:["admin"]}},{path:"compras",component:hr,canActivate:[Pt],data:{rolesPermitidos:["admin"]}},{path:"ajustes-inventario",component:vr,canActivate:[Pt],data:{rolesPermitidos:["admin"]}},{path:"farmacias",loadComponent:()=>import("./chunk-PAP3MG3O.js").then(o=>o.FarmaciasComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"inventario-farmacias",loadComponent:()=>import("./chunk-FH5IC3JR.js").then(o=>o.AjustesInventarioFarmaciaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"usuarios",loadComponent:()=>import("./chunk-VRLWPLEJ.js").then(o=>o.UsuariosComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"clientes",loadComponent:()=>import("./chunk-BPY6GVT6.js").then(o=>o.ClientesComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"proveedores",loadComponent:()=>import("./chunk-YM63YPBX.js").then(o=>o.ProveedoresComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"cortes-de-caja",loadComponent:()=>import("./chunk-VKCZFB4W.js").then(o=>o.CortesDeCajaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Pt]},{path:"reporte/ventas-por-farmacia",component:Sr},{path:"reporte/ventas-producto",component:Er},{path:"reporte/ventas",component:Pr},{path:"reporte/pedidos",component:wr},{path:"reporte/resumen-utilidades",component:Ir},{path:"reporte/utilidades",component:Mr},{path:"reporte/compras",component:Tr},{path:"reportes/devoluciones",loadComponent:()=>import("./chunk-QDHLQ2OT.js").then(o=>o.DevolucionesPageComponent),resolve:{cat:Ld}},{path:"reportes-compras",loadComponent:()=>import("./chunk-NOMZORW4.js").then(o=>o.ComprasPageComponent)},{path:"reportes/compras-historial-producto",component:kr},{path:"reportes/cancelaciones",loadComponent:()=>import("./chunk-4OPOG3OS.js").then(o=>o.CancelacionesPageComponent)},{path:"reportes/compras-ventas",component:Fr},{path:"etiquetas/print",component:ea},{path:"etiquetas/design",component:Zr}]},{path:"login",component:_n}];function Np(o){return new ue(3e3,!1)}function vS(){return new ue(3100,!1)}function yS(){return new ue(3101,!1)}function CS(o){return new ue(3001,!1)}function xS(o){return new ue(3003,!1)}function SS(o){return new ue(3004,!1)}function Lp(o,t){return new ue(3005,!1)}function jp(){return new ue(3006,!1)}function Up(){return new ue(3007,!1)}function $p(o,t){return new ue(3008,!1)}function Hp(o){return new ue(3002,!1)}function zp(o,t,e,i,n){return new ue(3010,!1)}function qp(){return new ue(3011,!1)}function Wp(){return new ue(3012,!1)}function Gp(){return new ue(3200,!1)}function Kp(){return new ue(3202,!1)}function Qp(){return new ue(3013,!1)}function Yp(o){return new ue(3014,!1)}function Xp(o){return new ue(3015,!1)}function Zp(o){return new ue(3016,!1)}function Jp(o,t){return new ue(3404,!1)}function ES(o){return new ue(3502,!1)}function eu(o){return new ue(3503,!1)}function tu(){return new ue(3300,!1)}function iu(o){return new ue(3504,!1)}function nu(o){return new ue(3301,!1)}function ou(o,t){return new ue(3302,!1)}function ru(o){return new ue(3303,!1)}function au(o,t){return new ue(3400,!1)}function su(o){return new ue(3401,!1)}function lu(o){return new ue(3402,!1)}function cu(o,t){return new ue(3505,!1)}function vi(o){switch(o.length){case 0:return new ci;case 1:return o[0];default:return new $i(o)}}function rl(o,t,e=new Map,i=new Map){let n=[],s=[],d=-1,p=null;if(t.forEach(h=>{let C=h.get("offset"),E=C==d,D=E&&p||new Map;h.forEach((R,N)=>{let A=N,U=R;if(N!=="offset")switch(A=o.normalizePropertyName(A,n),U){case Cn:U=e.get(N);break;case Ht:U=i.get(N);break;default:U=o.normalizeStyleValue(N,A,U,n);break}D.set(A,U)}),E||s.push(D),p=D,d=C}),n.length)throw ES(n);return s}function ta(o,t,e,i){switch(t){case"start":o.onStart(()=>i(e&&il(e,"start",o)));break;case"done":o.onDone(()=>i(e&&il(e,"done",o)));break;case"destroy":o.onDestroy(()=>i(e&&il(e,"destroy",o)));break}}function il(o,t,e){let i=e.totalTime,n=!!e.disabled,s=ia(o.element,o.triggerName,o.fromState,o.toState,t||o.phaseName,i??o.totalTime,n),d=o._data;return d!=null&&(s._data=d),s}function ia(o,t,e,i,n="",s=0,d){return{element:o,triggerName:t,fromState:e,toState:i,phaseName:n,totalTime:s,disabled:!!d}}function Ot(o,t,e){let i=o.get(t);return i||o.set(t,i=e),i}function al(o){let t=o.indexOf(":"),e=o.substring(1,t),i=o.slice(t+1);return[e,i]}var wS=typeof document>"u"?null:document.documentElement;function na(o){let t=o.parentNode||o.host||null;return t===wS?null:t}function PS(o){return o.substring(1,6)=="ebkit"}var Qi=null,Bp=!1;function du(o){Qi||(Qi=IS()||{},Bp=Qi.style?"WebkitAppearance"in Qi.style:!1);let t=!0;return Qi.style&&!PS(o)&&(t=o in Qi.style,!t&&Bp&&(t="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in Qi.style)),t}function IS(){return typeof document<"u"?document.body:null}function sl(o,t){for(;t;){if(t===o)return!0;t=na(t)}return!1}function ll(o,t,e){if(e)return Array.from(o.querySelectorAll(t));let i=o.querySelector(t);return i?[i]:[]}var MS=1e3,cl="{{",TS="}}",dl="ng-enter",oa="ng-leave",fo="ng-trigger",ho=".ng-trigger",ml="ng-animating",ra=".ng-animating";function pi(o){if(typeof o=="number")return o;let t=o.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:nl(parseFloat(t[1]),t[2])}function nl(o,t){switch(t){case"s":return o*MS;default:return o}}function go(o,t,e){return o.hasOwnProperty("duration")?o:OS(o,t,e)}function OS(o,t,e){let i=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,n,s=0,d="";if(typeof o=="string"){let p=o.match(i);if(p===null)return t.push(Np(o)),{duration:0,delay:0,easing:""};n=nl(parseFloat(p[1]),p[2]);let h=p[3];h!=null&&(s=nl(parseFloat(h),p[4]));let C=p[5];C&&(d=C)}else n=o;if(!e){let p=!1,h=t.length;n<0&&(t.push(vS()),p=!0),s<0&&(t.push(yS()),p=!0),p&&t.splice(h,0,Np(o))}return{duration:n,delay:s,easing:d}}function mu(o){return o.length?o[0]instanceof Map?o:o.map(t=>new Map(Object.entries(t))):[]}function Xt(o,t,e){t.forEach((i,n)=>{let s=aa(n);e&&!e.has(n)&&e.set(n,o.style[s]),o.style[s]=i})}function Ti(o,t){t.forEach((e,i)=>{let n=aa(i);o.style[n]=""})}function Bn(o){return Array.isArray(o)?o.length==1?o[0]:Td(o):o}function pu(o,t,e){let i=t.params||{},n=pl(o);n.length&&n.forEach(s=>{i.hasOwnProperty(s)||e.push(CS(s))})}var ol=new RegExp(`${cl}\\s*(.+?)\\s*${TS}`,"g");function pl(o){let t=[];if(typeof o=="string"){let e;for(;e=ol.exec(o);)t.push(e[1]);ol.lastIndex=0}return t}function Ln(o,t,e){let i=`${o}`,n=i.replace(ol,(s,d)=>{let p=t[d];return p==null&&(e.push(xS(d)),p=""),p.toString()});return n==i?o:n}var kS=/-+([a-z0-9])/g;function aa(o){return o.replace(kS,(...t)=>t[1].toUpperCase())}function uu(o,t){return o===0||t===0}function fu(o,t,e){if(e.size&&t.length){let i=t[0],n=[];if(e.forEach((s,d)=>{i.has(d)||n.push(d),i.set(d,s)}),n.length)for(let s=1;s<t.length;s++){let d=t[s];n.forEach(p=>d.set(p,sa(o,p)))}}return t}function kt(o,t,e){switch(t.type){case X.Trigger:return o.visitTrigger(t,e);case X.State:return o.visitState(t,e);case X.Transition:return o.visitTransition(t,e);case X.Sequence:return o.visitSequence(t,e);case X.Group:return o.visitGroup(t,e);case X.Animate:return o.visitAnimate(t,e);case X.Keyframes:return o.visitKeyframes(t,e);case X.Style:return o.visitStyle(t,e);case X.Reference:return o.visitReference(t,e);case X.AnimateChild:return o.visitAnimateChild(t,e);case X.AnimateRef:return o.visitAnimateRef(t,e);case X.Query:return o.visitQuery(t,e);case X.Stagger:return o.visitStagger(t,e);default:throw SS(t.type)}}function sa(o,t){return window.getComputedStyle(o)[t]}var Tl=(()=>{class o{validateStyleProperty(e){return du(e)}containsElement(e,i){return sl(e,i)}getParentElement(e){return na(e)}query(e,i,n){return ll(e,i,n)}computeStyle(e,i,n){return n||""}animate(e,i,n,s,d,p=[],h){return new ci(n,s)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=se({token:o,factory:o.\u0275fac})}return o})(),Xi=class{static NOOP=new Tl},Zi=class{};var DS=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),pa=class extends Zi{normalizePropertyName(t,e){return aa(t)}normalizeStyleValue(t,e,i,n){let s="",d=i.toString().trim();if(DS.has(e)&&i!==0&&i!=="0")if(typeof i=="number")s="px";else{let p=i.match(/^[+-]?[\d\.]+([a-z]*)$/);p&&p[1].length==0&&n.push(Lp(t,i))}return d+s}};var ua="*";function FS(o,t){let e=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(i=>RS(i,e,t)):e.push(o),e}function RS(o,t,e){if(o[0]==":"){let h=AS(o,e);if(typeof h=="function"){t.push(h);return}o=h}let i=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(i==null||i.length<4)return e.push(Xp(o)),t;let n=i[1],s=i[2],d=i[3];t.push(hu(n,d));let p=n==ua&&d==ua;s[0]=="<"&&!p&&t.push(hu(d,n))}function AS(o,t){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(Zp(o)),"* => *"}}var la=new Set(["true","1"]),ca=new Set(["false","0"]);function hu(o,t){let e=la.has(o)||ca.has(o),i=la.has(t)||ca.has(t);return(n,s)=>{let d=o==ua||o==n,p=t==ua||t==s;return!d&&e&&typeof n=="boolean"&&(d=n?la.has(o):ca.has(o)),!p&&i&&typeof s=="boolean"&&(p=s?la.has(t):ca.has(t)),d&&p}}var wu=":self",VS=new RegExp(`s*${wu}s*,?`,"g");function Pu(o,t,e,i){return new bl(o).build(t,e,i)}var gu="",bl=class{_driver;constructor(t){this._driver=t}build(t,e,i){let n=new vl(e);return this._resetContextStyleTimingState(n),kt(this,Bn(t),n)}_resetContextStyleTimingState(t){t.currentQuerySelector=gu,t.collectedStyles=new Map,t.collectedStyles.set(gu,new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,n=e.depCount=0,s=[],d=[];return t.name.charAt(0)=="@"&&e.errors.push(jp()),t.definitions.forEach(p=>{if(this._resetContextStyleTimingState(e),p.type==X.State){let h=p,C=h.name;C.toString().split(/\s*,\s*/).forEach(E=>{h.name=E,s.push(this.visitState(h,e))}),h.name=C}else if(p.type==X.Transition){let h=this.visitTransition(p,e);i+=h.queryCount,n+=h.depCount,d.push(h)}else e.errors.push(Up())}),{type:X.Trigger,name:t.name,states:s,transitions:d,queryCount:i,depCount:n,options:null}}visitState(t,e){let i=this.visitStyle(t.styles,e),n=t.options&&t.options.params||null;if(i.containsDynamicStyles){let s=new Set,d=n||{};i.styles.forEach(p=>{p instanceof Map&&p.forEach(h=>{pl(h).forEach(C=>{d.hasOwnProperty(C)||s.add(C)})})}),s.size&&e.errors.push($p(t.name,[...s.values()]))}return{type:X.State,name:t.name,style:i,options:n?{params:n}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;let i=kt(this,Bn(t.animation),e),n=FS(t.expr,e.errors);return{type:X.Transition,matchers:n,animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Yi(t.options)}}visitSequence(t,e){return{type:X.Sequence,steps:t.steps.map(i=>kt(this,i,e)),options:Yi(t.options)}}visitGroup(t,e){let i=e.currentTime,n=0,s=t.steps.map(d=>{e.currentTime=i;let p=kt(this,d,e);return n=Math.max(n,e.currentTime),p});return e.currentTime=n,{type:X.Group,steps:s,options:Yi(t.options)}}visitAnimate(t,e){let i=jS(t.timings,e.errors);e.currentAnimateTimings=i;let n,s=t.styles?t.styles:At({});if(s.type==X.Keyframes)n=this.visitKeyframes(s,e);else{let d=t.styles,p=!1;if(!d){p=!0;let C={};i.easing&&(C.easing=i.easing),d=At(C)}e.currentTime+=i.duration+i.delay;let h=this.visitStyle(d,e);h.isEmptyStep=p,n=h}return e.currentAnimateTimings=null,{type:X.Animate,timings:i,style:n,options:null}}visitStyle(t,e){let i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){let i=[],n=Array.isArray(t.styles)?t.styles:[t.styles];for(let p of n)typeof p=="string"?p===Ht?i.push(p):e.errors.push(Hp(p)):i.push(new Map(Object.entries(p)));let s=!1,d=null;return i.forEach(p=>{if(p instanceof Map&&(p.has("easing")&&(d=p.get("easing"),p.delete("easing")),!s)){for(let h of p.values())if(h.toString().indexOf(cl)>=0){s=!0;break}}}),{type:X.Style,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){let i=e.currentAnimateTimings,n=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{typeof d!="string"&&d.forEach((p,h)=>{let C=e.collectedStyles.get(e.currentQuerySelector),E=C.get(h),D=!0;E&&(s!=n&&s>=E.startTime&&n<=E.endTime&&(e.errors.push(zp(h,E.startTime,E.endTime,s,n)),D=!1),s=E.startTime),D&&C.set(h,{startTime:s,endTime:n}),e.options&&pu(p,e.options,e.errors)})})}visitKeyframes(t,e){let i={type:X.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(qp()),i;let n=1,s=0,d=[],p=!1,h=!1,C=0,E=t.steps.map(fe=>{let Pe=this._makeStyleAst(fe,e),it=Pe.offset!=null?Pe.offset:LS(Pe.styles),Ge=0;return it!=null&&(s++,Ge=Pe.offset=it),h=h||Ge<0||Ge>1,p=p||Ge<C,C=Ge,d.push(Ge),Pe});h&&e.errors.push(Wp()),p&&e.errors.push(Gp());let D=t.steps.length,R=0;s>0&&s<D?e.errors.push(Kp()):s==0&&(R=n/(D-1));let N=D-1,A=e.currentTime,U=e.currentAnimateTimings,F=U.duration;return E.forEach((fe,Pe)=>{let it=R>0?Pe==N?1:R*Pe:d[Pe],Ge=it*F;e.currentTime=A+U.delay+Ge,U.duration=Ge,this._validateStyleAst(fe,e),fe.offset=it,i.styles.push(fe)}),i}visitReference(t,e){return{type:X.Reference,animation:kt(this,Bn(t.animation),e),options:Yi(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:X.AnimateChild,options:Yi(t.options)}}visitAnimateRef(t,e){return{type:X.AnimateRef,animation:this.visitReference(t.animation,e),options:Yi(t.options)}}visitQuery(t,e){let i=e.currentQuerySelector,n=t.options||{};e.queryCount++,e.currentQuery=t;let[s,d]=NS(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Ot(e.collectedStyles,e.currentQuerySelector,new Map);let p=kt(this,Bn(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:X.Query,selector:s,limit:n.limit||0,optional:!!n.optional,includeSelf:d,animation:p,originalSelector:t.selector,options:Yi(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(Qp());let i=t.timings==="full"?{duration:0,delay:0,easing:"full"}:go(t.timings,e.errors,!0);return{type:X.Stagger,animation:kt(this,Bn(t.animation),e),timings:i,options:null}}};function NS(o){let t=!!o.split(/\s*,\s*/).find(e=>e==wu);return t&&(o=o.replace(VS,"")),o=o.replace(/@\*/g,ho).replace(/@\w+/g,e=>ho+"-"+e.slice(1)).replace(/:animating/g,ra),[o,t]}function BS(o){return o?ae({},o):null}var vl=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(t){this.errors=t}};function LS(o){if(typeof o=="string")return null;let t=null;if(Array.isArray(o))o.forEach(e=>{if(e instanceof Map&&e.has("offset")){let i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let e=o;t=parseFloat(e.get("offset")),e.delete("offset")}return t}function jS(o,t){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let s=go(o,t).duration;return ul(s,0,"")}let e=o;if(e.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=ul(0,0,"");return s.dynamic=!0,s.strValue=e,s}let n=go(e,t);return ul(n.duration,n.delay,n.easing)}function Yi(o){return o?(o=ae({},o),o.params&&(o.params=BS(o.params))):o={},o}function ul(o,t,e){return{duration:o,delay:t,easing:e}}function Ol(o,t,e,i,n,s,d=null,p=!1){return{type:1,element:o,keyframes:t,preStyleProps:e,postStyleProps:i,duration:n,delay:s,totalTime:n+s,easing:d,subTimeline:p}}var bo=class{_map=new Map;get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}},US=1,$S=":enter",HS=new RegExp($S,"g"),zS=":leave",qS=new RegExp(zS,"g");function Iu(o,t,e,i,n,s=new Map,d=new Map,p,h,C=[]){return new yl().buildKeyframes(o,t,e,i,n,s,d,p,h,C)}var yl=class{buildKeyframes(t,e,i,n,s,d,p,h,C,E=[]){C=C||new bo;let D=new Cl(t,e,C,n,s,E,[]);D.options=h;let R=h.delay?pi(h.delay):0;D.currentTimeline.delayNextStep(R),D.currentTimeline.setStyles([d],null,D.errors,h),kt(this,i,D);let N=D.timelines.filter(A=>A.containsAnimation());if(N.length&&p.size){let A;for(let U=N.length-1;U>=0;U--){let F=N[U];if(F.element===e){A=F;break}}A&&!A.allowOnlyTimelineStyles()&&A.setStyles([p],null,D.errors,h)}return N.length?N.map(A=>A.buildKeyframes()):[Ol(e,[],[],[],0,R,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){let i=e.subInstructions.get(e.element);if(i){let n=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,n,n.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){let i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){for(let n of t){let s=n?.delay;if(s){let d=typeof s=="number"?s:pi(Ln(s,n?.params??{},e.errors));i.delayNextStep(d)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime,d=i.duration!=null?pi(i.duration):null,p=i.delay!=null?pi(i.delay):null;return d!==0&&t.forEach(h=>{let C=e.appendInstructionToTimeline(h,d,p);s=Math.max(s,C.duration+C.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),kt(this,t.animation,e),e.previousNode=t}visitSequence(t,e){let i=e.subContextCount,n=e,s=t.options;if(s&&(s.params||s.delay)&&(n=e.createSubContext(s),n.transformIntoNewTimeline(),s.delay!=null)){n.previousNode.type==X.Style&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=fa);let d=pi(s.delay);n.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>kt(this,d,n)),n.currentTimeline.applyStylesToKeyframe(),n.subContextCount>i&&n.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){let i=[],n=e.currentTimeline.currentTime,s=t.options&&t.options.delay?pi(t.options.delay):0;t.steps.forEach(d=>{let p=e.createSubContext(t.options);s&&p.delayNextStep(s),kt(this,d,p),n=Math.max(n,p.currentTimeline.currentTime),i.push(p.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(n),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){let i=t.strValue,n=e.params?Ln(i,e.params,e.errors):i;return go(n,e.errors)}else return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){let i=e.currentAnimateTimings=this._visitTiming(t.timings,e),n=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),n.snapshotCurrentStyles());let s=t.style;s.type==X.Keyframes?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),n.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){let i=e.currentTimeline,n=e.currentAnimateTimings;!n&&i.hasCurrentStyleProperties()&&i.forwardFrame();let s=n&&n.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){let i=e.currentAnimateTimings,n=e.currentTimeline.duration,s=i.duration,p=e.createSubContext().currentTimeline;p.easing=i.easing,t.styles.forEach(h=>{let C=h.offset||0;p.forwardTime(C*s),p.setStyles(h.styles,h.easing,e.errors,e.options),p.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(p),e.transformIntoNewTimeline(n+s),e.previousNode=t}visitQuery(t,e){let i=e.currentTimeline.currentTime,n=t.options||{},s=n.delay?pi(n.delay):0;s&&(e.previousNode.type===X.Style||i==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=fa);let d=i,p=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!n.optional,e.errors);e.currentQueryTotal=p.length;let h=null;p.forEach((C,E)=>{e.currentQueryIndex=E;let D=e.createSubContext(t.options,C);s&&D.delayNextStep(s),C===e.element&&(h=D.currentTimeline),kt(this,t.animation,D),D.currentTimeline.applyStylesToKeyframe();let R=D.currentTimeline.currentTime;d=Math.max(d,R)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),h&&(e.currentTimeline.mergeTimelineCollectedStyles(h),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){let i=e.parentContext,n=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),p=d*(e.currentQueryTotal-1),h=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":h=p-h;break;case"full":h=i.currentStaggerTime;break}let E=e.currentTimeline;h&&E.delayNextStep(h);let D=E.currentTime;kt(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=n.currentTime-D+(n.startTime-i.currentTimeline.startTime)}},fa={},Cl=class o{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=fa;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(t,e,i,n,s,d,p,h){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=n,this._leaveClassName=s,this.errors=d,this.timelines=p,this.currentTimeline=h||new ha(this._driver,e,0),p.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;let i=t,n=this.options;i.duration!=null&&(n.duration=pi(i.duration)),i.delay!=null&&(n.delay=pi(i.delay));let s=i.params;if(s){let d=n.params;d||(d=this.options.params={}),Object.keys(s).forEach(p=>{(!e||!d.hasOwnProperty(p))&&(d[p]=Ln(s[p],d,this.errors))})}}_copyOptions(){let t={};if(this.options){let e=this.options.params;if(e){let i=t.params={};Object.keys(e).forEach(n=>{i[n]=e[n]})}}return t}createSubContext(t=null,e,i){let n=e||this.element,s=new o(this._driver,n,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(n,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=fa,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){let n={duration:e??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},s=new xl(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,n,t.stretchStartingKeyframe);return this.timelines.push(s),n}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,n,s,d){let p=[];if(n&&p.push(this.element),t.length>0){t=t.replace(HS,"."+this._enterClassName),t=t.replace(qS,"."+this._leaveClassName);let h=i!=1,C=this._driver.query(this.element,t,h);i!==0&&(C=i<0?C.slice(C.length+i,C.length):C.slice(0,i)),p.push(...C)}return!s&&p.length==0&&d.push(Yp(e)),p}},ha=class o{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(t,e,i,n){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=n,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new o(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=US,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Ht),this._currentKeyframe.set(e,Ht);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,n){e&&this._previousKeyframe.set("easing",e);let s=n&&n.params||{},d=WS(t,this._globalTimelineStyles);for(let[p,h]of d){let C=Ln(h,s,i);this._pendingStyles.set(p,C),this._localTimelineStyles.has(p)||this._backFill.set(p,this._globalTimelineStyles.get(p)??Ht),this._updateStyle(p,C)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{let n=this._styleSummary.get(i);(!n||e.time>n.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let t=new Set,e=new Set,i=this._keyframes.size===1&&this.duration===0,n=[];this._keyframes.forEach((p,h)=>{let C=new Map([...this._backFill,...p]);C.forEach((E,D)=>{E===Cn?t.add(D):E===Ht&&e.add(D)}),i||C.set("offset",h/this.duration),n.push(C)});let s=[...t.values()],d=[...e.values()];if(i){let p=n[0],h=new Map(p);p.set("offset",0),h.set("offset",1),n=[p,h]}return Ol(this.element,n,s,d,this.duration,this.startTime,this.easing,!1)}},xl=class extends ha{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(t,e,i,n,s,d,p=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=n,this.postStyleProps=s,this._stretchStartingKeyframe=p,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:n}=this.timings;if(this._stretchStartingKeyframe&&e){let s=[],d=i+e,p=e/d,h=new Map(t[0]);h.set("offset",0),s.push(h);let C=new Map(t[0]);C.set("offset",_u(p)),s.push(C);let E=t.length-1;for(let D=1;D<=E;D++){let R=new Map(t[D]),N=R.get("offset"),A=e+N*i;R.set("offset",_u(A/d)),s.push(R)}i=d,e=0,n="",t=s}return Ol(this.element,t,this.preStyleProps,this.postStyleProps,i,e,n,!0)}};function _u(o,t=3){let e=Math.pow(10,t-1);return Math.round(o*e)/e}function WS(o,t){let e=new Map,i;return o.forEach(n=>{if(n==="*"){i??=t.keys();for(let s of i)e.set(s,Ht)}else for(let[s,d]of n)e.set(s,d)}),e}function bu(o,t,e,i,n,s,d,p,h,C,E,D,R){return{type:0,element:o,triggerName:t,isRemovalTransition:n,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:p,queriedElements:h,preStyleProps:C,postStyleProps:E,totalTime:D,errors:R}}var fl={},ga=class{_triggerName;ast;_stateStyles;constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,n){return GS(this.ast.matchers,t,e,i,n)}buildStyles(t,e,i){let n=this._stateStyles.get("*");return t!==void 0&&(n=this._stateStyles.get(t?.toString())||n),n?n.buildStyles(e,i):new Map}build(t,e,i,n,s,d,p,h,C,E){let D=[],R=this.ast.options&&this.ast.options.params||fl,N=p&&p.params||fl,A=this.buildStyles(i,N,D),U=h&&h.params||fl,F=this.buildStyles(n,U,D),fe=new Set,Pe=new Map,it=new Map,Ge=n==="void",ui={params:Mu(U,R),delay:this.ast.options?.delay},Jt=E?[]:Iu(t,e,this.ast.animation,s,d,A,F,ui,C,D),ut=0;return Jt.forEach(yt=>{ut=Math.max(yt.duration+yt.delay,ut)}),D.length?bu(e,this._triggerName,i,n,Ge,A,F,[],[],Pe,it,ut,D):(Jt.forEach(yt=>{let Oi=yt.element,Ji=Ot(Pe,Oi,new Set);yt.preStyleProps.forEach(ki=>Ji.add(ki));let kl=Ot(it,Oi,new Set);yt.postStyleProps.forEach(ki=>kl.add(ki)),Oi!==e&&fe.add(Oi)}),bu(e,this._triggerName,i,n,Ge,A,F,Jt,[...fe.values()],Pe,it,ut))}};function GS(o,t,e,i,n){return o.some(s=>s(t,e,i,n))}function Mu(o,t){let e=ae({},t);return Object.entries(o).forEach(([i,n])=>{n!=null&&(e[i]=n)}),e}var Sl=class{styles;defaultParams;normalizer;constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){let i=new Map,n=Mu(t,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((d,p)=>{d&&(d=Ln(d,n,e));let h=this.normalizer.normalizePropertyName(p,e);d=this.normalizer.normalizeStyleValue(p,h,d,e),i.set(p,d)})}),i}};function KS(o,t,e){return new El(o,t,e)}var El=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,e.states.forEach(n=>{let s=n.options&&n.options.params||{};this.states.set(n.name,new Sl(n.style,s,i))}),vu(this.states,"true","1"),vu(this.states,"false","0"),e.transitions.forEach(n=>{this.transitionFactories.push(new ga(t,n,this.states))}),this.fallbackTransition=QS(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,n){return this.transitionFactories.find(d=>d.match(t,e,i,n))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}};function QS(o,t,e){let i=[(d,p)=>!0],n={type:X.Sequence,steps:[],options:null},s={type:X.Transition,animation:n,matchers:i,options:null,queryCount:0,depCount:0};return new ga(o,s,t)}function vu(o,t,e){o.has(t)?o.has(e)||o.set(e,o.get(t)):o.has(e)&&o.set(t,o.get(e))}var YS=new bo,wl=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i}register(t,e){let i=[],n=[],s=Pu(this._driver,e,i,n);if(i.length)throw eu(i);this._animations.set(t,s)}_buildPlayer(t,e,i){let n=t.element,s=rl(this._normalizer,t.keyframes,e,i);return this._driver.animate(n,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){let n=[],s=this._animations.get(t),d,p=new Map;if(s?(d=Iu(this._driver,e,s,dl,oa,new Map,new Map,i,YS,n),d.forEach(E=>{let D=Ot(p,E.element,new Map);E.postStyleProps.forEach(R=>D.set(R,null))})):(n.push(tu()),d=[]),n.length)throw iu(n);p.forEach((E,D)=>{E.forEach((R,N)=>{E.set(N,this._driver.computeStyle(D,N,Ht))})});let h=d.map(E=>{let D=p.get(E.element);return this._buildPlayer(E,new Map,D)}),C=vi(h);return this._playersById.set(t,C),C.onDestroy(()=>this.destroy(t)),this.players.push(C),C}destroy(t){let e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);let i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){let e=this._playersById.get(t);if(!e)throw nu(t);return e}listen(t,e,i,n){let s=ia(e,"","","");return ta(this._getPlayer(t),i,s,n),()=>{}}command(t,e,i,n){if(i=="register"){this.register(t,n[0]);return}if(i=="create"){let d=n[0]||{};this.create(t,e,d);return}let s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(n[0]));break;case"destroy":this.destroy(t);break}}},yu="ng-animate-queued",XS=".ng-animate-queued",hl="ng-animate-disabled",ZS=".ng-animate-disabled",JS="ng-star-inserted",eE=".ng-star-inserted",tE=[],Tu={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},iE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Zt="__ng_removed",vo=class{namespaceId;value;options;get params(){return this.options.params}constructor(t,e=""){this.namespaceId=e;let i=t&&t.hasOwnProperty("value"),n=i?t.value:t;if(this.value=oE(n),i){let s=t,{value:d}=s,p=Al(s,["value"]);this.options=p}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){let e=t.params;if(e){let i=this.options.params;Object.keys(e).forEach(n=>{i[n]==null&&(i[n]=e[n])})}}},_o="void",gl=new vo(_o),Pl=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this._hostClassName="ng-tns-"+t,Kt(e,this._hostClassName)}listen(t,e,i,n){if(!this._triggers.has(e))throw ou(i,e);if(i==null||i.length==0)throw ru(e);if(!rE(i))throw au(i,e);let s=Ot(this._elementListeners,t,[]),d={name:e,phase:i,callback:n};s.push(d);let p=Ot(this._engine.statesByElement,t,new Map);return p.has(e)||(Kt(t,fo),Kt(t,fo+"-"+e),p.set(e,gl)),()=>{this._engine.afterFlush(()=>{let h=s.indexOf(d);h>=0&&s.splice(h,1),this._triggers.has(e)||p.delete(e)})}}register(t,e){return this._triggers.has(t)?!1:(this._triggers.set(t,e),!0)}_getTrigger(t){let e=this._triggers.get(t);if(!e)throw su(t);return e}trigger(t,e,i,n=!0){let s=this._getTrigger(e),d=new yo(this.id,e,t),p=this._engine.statesByElement.get(t);p||(Kt(t,fo),Kt(t,fo+"-"+e),this._engine.statesByElement.set(t,p=new Map));let h=p.get(e),C=new vo(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&h&&C.absorbOptions(h.options),p.set(e,C),h||(h=gl),!(C.value===_o)&&h.value===C.value){if(!lE(h.params,C.params)){let U=[],F=s.matchStyles(h.value,h.params,U),fe=s.matchStyles(C.value,C.params,U);U.length?this._engine.reportError(U):this._engine.afterFlush(()=>{Ti(t,F),Xt(t,fe)})}return}let R=Ot(this._engine.playersByElement,t,[]);R.forEach(U=>{U.namespaceId==this.id&&U.triggerName==e&&U.queued&&U.destroy()});let N=s.matchTransition(h.value,C.value,t,C.params),A=!1;if(!N){if(!n)return;N=s.fallbackTransition,A=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:N,fromState:h,toState:C,player:d,isFallbackTransition:A}),A||(Kt(t,yu),d.onStart(()=>{jn(t,yu)})),d.onDone(()=>{let U=this.players.indexOf(d);U>=0&&this.players.splice(U,1);let F=this._engine.playersByElement.get(t);if(F){let fe=F.indexOf(d);fe>=0&&F.splice(fe,1)}}),this.players.push(d),R.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(n=>n.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);let e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){let i=this._engine.driver.query(t,ho,!0);i.forEach(n=>{if(n[Zt])return;let s=this._engine.fetchNamespacesByElement(n);s.size?s.forEach(d=>d.triggerLeaveAnimation(n,e,!1,!0)):this.clearElementCache(n)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(n=>this.clearElementCache(n)))}triggerLeaveAnimation(t,e,i,n){let s=this._engine.statesByElement.get(t),d=new Map;if(s){let p=[];if(s.forEach((h,C)=>{if(d.set(C,h.value),this._triggers.has(C)){let E=this.trigger(t,C,_o,n);E&&p.push(E)}}),p.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&vi(p).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){let e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){let n=new Set;e.forEach(s=>{let d=s.name;if(n.has(d))return;n.add(d);let h=this._triggers.get(d).fallbackTransition,C=i.get(d)||gl,E=new vo(_o),D=new yo(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:h,fromState:C,toState:E,player:D,isFallbackTransition:!0})})}}removeNode(t,e){let i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let n=!1;if(i.totalAnimations){let s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)n=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){n=!0;break}}}if(this.prepareLeaveAnimationListeners(t),n)i.markElementAsRemoved(this.id,t,!1,e);else{let s=t[Zt];(!s||s===Tu)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Kt(t,this._hostClassName)}drainQueuedTransitions(t){let e=[];return this._queue.forEach(i=>{let n=i.player;if(n.destroyed)return;let s=i.element,d=this._elementListeners.get(s);d&&d.forEach(p=>{if(p.name==i.triggerName){let h=ia(s,i.triggerName,i.fromState.value,i.toState.value);h._data=t,ta(i.player,p.phase,h,p.callback)}}),n.markedForDestroy?this._engine.afterFlush(()=>{n.destroy()}):e.push(i)}),this._queue=[],e.sort((i,n)=>{let s=i.transition.ast.depCount,d=n.transition.ast.depCount;return s==0||d==0?s-d:this._engine.driver.containsElement(i.element,n.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}},Il=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(t,e)=>{};_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i}get queuedPlayers(){let t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){let i=new Pl(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){let i=this._namespaceList,n=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,p=this.driver.getParentElement(e);for(;p;){let h=n.get(p);if(h){let C=i.indexOf(h);i.splice(C+1,0,t),d=!0;break}p=this.driver.getParentElement(p)}d||i.unshift(t)}else i.push(t);return n.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let n=this._namespaceLookup[t];n&&n.register(e,i)&&this.totalAnimations++}destroy(t,e){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let i=this._fetchNamespace(t);this.namespacesByHostElement.delete(i.hostElement);let n=this._namespaceList.indexOf(i);n>=0&&this._namespaceList.splice(n,1),i.destroy(e),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){let e=new Set,i=this.statesByElement.get(t);if(i){for(let n of i.values())if(n.namespaceId){let s=this._fetchNamespace(n.namespaceId);s&&e.add(s)}}return e}trigger(t,e,i,n){if(da(e)){let s=this._fetchNamespace(t);if(s)return s.trigger(e,i,n),!0}return!1}insertNode(t,e,i,n){if(!da(e))return;let s=e[Zt];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){let d=this._fetchNamespace(t);d&&d.insertNode(e,i)}n&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Kt(t,hl)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),jn(t,hl))}removeNode(t,e,i){if(da(e)){let n=t?this._fetchNamespace(t):null;n?n.removeNode(e,i):this.markElementAsRemoved(t,e,!1,i);let s=this.namespacesByHostElement.get(e);s&&s.id!==t&&s.removeNode(e,i)}else this._onRemovalComplete(e,i)}markElementAsRemoved(t,e,i,n,s){this.collectedLeaveElements.push(e),e[Zt]={namespaceId:t,setForRemoval:n,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,n,s){return da(e)?this._fetchNamespace(t).listen(e,i,n,s):()=>{}}_buildInstruction(t,e,i,n,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,n,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,ho,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(t,ra,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){let e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){let e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return vi(this.players).onDone(()=>t());t()})}processLeaveNode(t){let e=t[Zt];if(e&&e.setForRemoval){if(t[Zt]=Tu,e.namespaceId){this.destroyInnerAnimations(t);let i=this._fetchNamespace(e.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}t.classList?.contains(hl)&&this.markElementAsDisabled(t,!1),this.driver.query(t,ZS,!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,n)=>this._balanceNamespaceList(i,n)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++){let n=this.collectedEnterElements[i];Kt(n,JS)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let i=[];try{e=this._flushAnimations(i,t)}finally{for(let n=0;n<i.length;n++)i[n]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++){let n=this.collectedLeaveElements[i];this.processLeaveNode(n)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){let i=this._whenQuietFns;this._whenQuietFns=[],e.length?vi(e).onDone(()=>{i.forEach(n=>n())}):i.forEach(n=>n())}}reportError(t){throw lu(t)}_flushAnimations(t,e){let i=new bo,n=[],s=new Map,d=[],p=new Map,h=new Map,C=new Map,E=new Set;this.disabledNodes.forEach(L=>{E.add(L);let H=this.driver.query(L,XS,!0);for(let W=0;W<H.length;W++)E.add(H[W])});let D=this.bodyNode,R=Array.from(this.statesByElement.keys()),N=Su(R,this.collectedEnterElements),A=new Map,U=0;N.forEach((L,H)=>{let W=dl+U++;A.set(H,W),L.forEach(pe=>Kt(pe,W))});let F=[],fe=new Set,Pe=new Set;for(let L=0;L<this.collectedLeaveElements.length;L++){let H=this.collectedLeaveElements[L],W=H[Zt];W&&W.setForRemoval&&(F.push(H),fe.add(H),W.hasAnimation?this.driver.query(H,eE,!0).forEach(pe=>fe.add(pe)):Pe.add(H))}let it=new Map,Ge=Su(R,Array.from(fe));Ge.forEach((L,H)=>{let W=oa+U++;it.set(H,W),L.forEach(pe=>Kt(pe,W))}),t.push(()=>{N.forEach((L,H)=>{let W=A.get(H);L.forEach(pe=>jn(pe,W))}),Ge.forEach((L,H)=>{let W=it.get(H);L.forEach(pe=>jn(pe,W))}),F.forEach(L=>{this.processLeaveNode(L)})});let ui=[],Jt=[];for(let L=this._namespaceList.length-1;L>=0;L--)this._namespaceList[L].drainQueuedTransitions(e).forEach(W=>{let pe=W.player,rt=W.element;if(ui.push(pe),this.collectedEnterElements.length){let dt=rt[Zt];if(dt&&dt.setForMove){if(dt.previousTriggersValues&&dt.previousTriggersValues.has(W.triggerName)){let Di=dt.previousTriggersValues.get(W.triggerName),Bt=this.statesByElement.get(W.element);if(Bt&&Bt.has(W.triggerName)){let Co=Bt.get(W.triggerName);Co.value=Di,Bt.set(W.triggerName,Co)}}pe.destroy();return}}let ei=!D||!this.driver.containsElement(D,rt),Dt=it.get(rt),yi=A.get(rt),Be=this._buildInstruction(W,i,yi,Dt,ei);if(Be.errors&&Be.errors.length){Jt.push(Be);return}if(ei){pe.onStart(()=>Ti(rt,Be.fromStyles)),pe.onDestroy(()=>Xt(rt,Be.toStyles)),n.push(pe);return}if(W.isFallbackTransition){pe.onStart(()=>Ti(rt,Be.fromStyles)),pe.onDestroy(()=>Xt(rt,Be.toStyles)),n.push(pe);return}let Rl=[];Be.timelines.forEach(dt=>{dt.stretchStartingKeyframe=!0,this.disabledNodes.has(dt.element)||Rl.push(dt)}),Be.timelines=Rl,i.append(rt,Be.timelines);let Ru={instruction:Be,player:pe,element:rt};d.push(Ru),Be.queriedElements.forEach(dt=>Ot(p,dt,[]).push(pe)),Be.preStyleProps.forEach((dt,Di)=>{if(dt.size){let Bt=h.get(Di);Bt||h.set(Di,Bt=new Set),dt.forEach((Co,xa)=>Bt.add(xa))}}),Be.postStyleProps.forEach((dt,Di)=>{let Bt=C.get(Di);Bt||C.set(Di,Bt=new Set),dt.forEach((Co,xa)=>Bt.add(xa))})});if(Jt.length){let L=[];Jt.forEach(H=>{L.push(cu(H.triggerName,H.errors))}),ui.forEach(H=>H.destroy()),this.reportError(L)}let ut=new Map,yt=new Map;d.forEach(L=>{let H=L.element;i.has(H)&&(yt.set(H,H),this._beforeAnimationBuild(L.player.namespaceId,L.instruction,ut))}),n.forEach(L=>{let H=L.element;this._getPreviousPlayers(H,!1,L.namespaceId,L.triggerName,null).forEach(pe=>{Ot(ut,H,[]).push(pe),pe.destroy()})});let Oi=F.filter(L=>Eu(L,h,C)),Ji=new Map;xu(Ji,this.driver,Pe,C,Ht).forEach(L=>{Eu(L,h,C)&&Oi.push(L)});let ki=new Map;N.forEach((L,H)=>{xu(ki,this.driver,new Set(L),h,Cn)}),Oi.forEach(L=>{let H=Ji.get(L),W=ki.get(L);Ji.set(L,new Map([...H?.entries()??[],...W?.entries()??[]]))});let Ca=[],Dl=[],Fl={};d.forEach(L=>{let{element:H,player:W,instruction:pe}=L;if(i.has(H)){if(E.has(H)){W.onDestroy(()=>Xt(H,pe.toStyles)),W.disabled=!0,W.overrideTotalTime(pe.totalTime),n.push(W);return}let rt=Fl;if(yt.size>1){let Dt=H,yi=[];for(;Dt=Dt.parentNode;){let Be=yt.get(Dt);if(Be){rt=Be;break}yi.push(Dt)}yi.forEach(Be=>yt.set(Be,rt))}let ei=this._buildAnimation(W.namespaceId,pe,ut,s,ki,Ji);if(W.setRealPlayer(ei),rt===Fl)Ca.push(W);else{let Dt=this.playersByElement.get(rt);Dt&&Dt.length&&(W.parentPlayer=vi(Dt)),n.push(W)}}else Ti(H,pe.fromStyles),W.onDestroy(()=>Xt(H,pe.toStyles)),Dl.push(W),E.has(H)&&n.push(W)}),Dl.forEach(L=>{let H=s.get(L.element);if(H&&H.length){let W=vi(H);L.setRealPlayer(W)}}),n.forEach(L=>{L.parentPlayer?L.syncPlayerEvents(L.parentPlayer):L.destroy()});for(let L=0;L<F.length;L++){let H=F[L],W=H[Zt];if(jn(H,oa),W&&W.hasAnimation)continue;let pe=[];if(p.size){let ei=p.get(H);ei&&ei.length&&pe.push(...ei);let Dt=this.driver.query(H,ra,!0);for(let yi=0;yi<Dt.length;yi++){let Be=p.get(Dt[yi]);Be&&Be.length&&pe.push(...Be)}}let rt=pe.filter(ei=>!ei.destroyed);rt.length?aE(this,H,rt):this.processLeaveNode(H)}return F.length=0,Ca.forEach(L=>{this.players.push(L),L.onDone(()=>{L.destroy();let H=this.players.indexOf(L);this.players.splice(H,1)}),L.play()}),Ca}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,n,s){let d=[];if(e){let p=this.playersByQueriedElement.get(t);p&&(d=p)}else{let p=this.playersByElement.get(t);if(p){let h=!s||s==_o;p.forEach(C=>{C.queued||!h&&C.triggerName!=n||d.push(C)})}}return(i||n)&&(d=d.filter(p=>!(i&&i!=p.namespaceId||n&&n!=p.triggerName))),d}_beforeAnimationBuild(t,e,i){let n=e.triggerName,s=e.element,d=e.isRemovalTransition?void 0:t,p=e.isRemovalTransition?void 0:n;for(let h of e.timelines){let C=h.element,E=C!==s,D=Ot(i,C,[]);this._getPreviousPlayers(C,E,d,p,e.toState).forEach(N=>{let A=N.getRealPlayer();A.beforeDestroy&&A.beforeDestroy(),N.destroy(),D.push(N)})}Ti(s,e.fromStyles)}_buildAnimation(t,e,i,n,s,d){let p=e.triggerName,h=e.element,C=[],E=new Set,D=new Set,R=e.timelines.map(A=>{let U=A.element;E.add(U);let F=U[Zt];if(F&&F.removedBeforeQueried)return new ci(A.duration,A.delay);let fe=U!==h,Pe=sE((i.get(U)||tE).map(ut=>ut.getRealPlayer())).filter(ut=>{let yt=ut;return yt.element?yt.element===U:!1}),it=s.get(U),Ge=d.get(U),ui=rl(this._normalizer,A.keyframes,it,Ge),Jt=this._buildPlayer(A,ui,Pe);if(A.subTimeline&&n&&D.add(U),fe){let ut=new yo(t,p,U);ut.setRealPlayer(Jt),C.push(ut)}return Jt});C.forEach(A=>{Ot(this.playersByQueriedElement,A.element,[]).push(A),A.onDone(()=>nE(this.playersByQueriedElement,A.element,A))}),E.forEach(A=>Kt(A,ml));let N=vi(R);return N.onDestroy(()=>{E.forEach(A=>jn(A,ml)),Xt(h,e.toStyles)}),D.forEach(A=>{Ot(n,A,[]).push(N)}),N}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new ci(t.duration,t.delay)}},yo=class{namespaceId;triggerName;element;_player=new ci;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(n=>ta(t,i,void 0,n))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){let e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Ot(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){let e=this._player;e.triggerCallback&&e.triggerCallback(t)}};function nE(o,t,e){let i=o.get(t);if(i){if(i.length){let n=i.indexOf(e);i.splice(n,1)}i.length==0&&o.delete(t)}return i}function oE(o){return o??null}function da(o){return o&&o.nodeType===1}function rE(o){return o=="start"||o=="done"}function Cu(o,t){let e=o.style.display;return o.style.display=t??"none",e}function xu(o,t,e,i,n){let s=[];e.forEach(h=>s.push(Cu(h)));let d=[];i.forEach((h,C)=>{let E=new Map;h.forEach(D=>{let R=t.computeStyle(C,D,n);E.set(D,R),(!R||R.length==0)&&(C[Zt]=iE,d.push(C))}),o.set(C,E)});let p=0;return e.forEach(h=>Cu(h,s[p++])),d}function Su(o,t){let e=new Map;if(o.forEach(p=>e.set(p,[])),t.length==0)return e;let i=1,n=new Set(t),s=new Map;function d(p){if(!p)return i;let h=s.get(p);if(h)return h;let C=p.parentNode;return e.has(C)?h=C:n.has(C)?h=i:h=d(C),s.set(p,h),h}return t.forEach(p=>{let h=d(p);h!==i&&e.get(h).push(p)}),e}function Kt(o,t){o.classList?.add(t)}function jn(o,t){o.classList?.remove(t)}function aE(o,t,e){vi(e).onDone(()=>o.processLeaveNode(t))}function sE(o){let t=[];return Ou(o,t),t}function Ou(o,t){for(let e=0;e<o.length;e++){let i=o[e];i instanceof $i?Ou(i.players,t):t.push(i)}}function lE(o,t){let e=Object.keys(o),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n=0;n<e.length;n++){let s=e[n];if(!t.hasOwnProperty(s)||o[s]!==t[s])return!1}return!0}function Eu(o,t,e){let i=e.get(o);if(!i)return!1;let n=t.get(o);return n?i.forEach(s=>n.add(s)):t.set(o,i),e.delete(o),!0}var Un=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(t,e)=>{};constructor(t,e,i){this._driver=e,this._normalizer=i,this._transitionEngine=new Il(t.body,e,i),this._timelineEngine=new wl(t.body,e,i),this._transitionEngine.onRemovalComplete=(n,s)=>this.onRemovalComplete(n,s)}registerTrigger(t,e,i,n,s){let d=t+"-"+n,p=this._triggerCache[d];if(!p){let h=[],C=[],E=Pu(this._driver,s,h,C);if(h.length)throw Jp(n,h);p=KS(n,E,this._normalizer),this._triggerCache[d]=p}this._transitionEngine.registerTrigger(e,n,p)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,n){this._transitionEngine.insertNode(t,e,i,n)}onRemove(t,e,i){this._transitionEngine.removeNode(t,e,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,n){if(i.charAt(0)=="@"){let[s,d]=al(i),p=n;this._timelineEngine.command(s,e,d,p)}else this._transitionEngine.trigger(t,e,i,n)}listen(t,e,i,n,s){if(i.charAt(0)=="@"){let[d,p]=al(i);return this._timelineEngine.listen(d,e,p,s)}return this._transitionEngine.listen(t,e,i,n,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}};function cE(o,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=_l(t[0]),t.length>1&&(i=_l(t[t.length-1]))):t instanceof Map&&(e=_l(t)),e||i?new dE(o,e,i):null}var dE=(()=>{class o{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,i,n){this._element=e,this._startStyles=i,this._endStyles=n;let s=o.initialStylesByElement.get(e);s||o.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Xt(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Xt(this._element,this._initialStyles),this._endStyles&&(Xt(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(o.initialStylesByElement.delete(this._element),this._startStyles&&(Ti(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ti(this._element,this._endStyles),this._endStyles=null),Xt(this._element,this._initialStyles),this._state=3)}}return o})();function _l(o){let t=null;return o.forEach((e,i)=>{mE(i)&&(t=t||new Map,t.set(i,e))}),t}function mE(o){return o==="display"||o==="position"}var _a=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(t,e,i,n){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=n,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;let e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){let e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,n)=>{n!=="offset"&&t.set(n,this._finished?i:sa(this.element,n))}),this.currentSnapshot=t}triggerCallback(t){let e=t==="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},ba=class{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}containsElement(t,e){return sl(t,e)}getParentElement(t){return na(t)}query(t,e,i){return ll(t,e,i)}computeStyle(t,e,i){return sa(t,e)}animate(t,e,i,n,s,d=[]){let p=n==0?"both":"forwards",h={duration:i,delay:n,fill:p};s&&(h.easing=s);let C=new Map,E=d.filter(N=>N instanceof _a);uu(i,n)&&E.forEach(N=>{N.currentSnapshot.forEach((A,U)=>C.set(U,A))});let D=mu(e).map(N=>new Map(N));D=fu(t,D,C);let R=cE(t,D);return new _a(t,D,h,R)}};var ma="@",ku="@.disabled",va=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(t,e,i,n){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=n}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,n=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,n)}removeChild(t,e,i){this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,n){this.delegate.setAttribute(t,e,i,n)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,n){this.delegate.setStyle(t,e,i,n)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){e.charAt(0)==ma&&e==ku?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i,n){return this.delegate.listen(t,e,i,n)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}},Ml=class extends va{factory;constructor(t,e,i,n,s){super(e,i,n,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){e.charAt(0)==ma?e.charAt(1)=="."&&e==ku?(i=i===void 0?!0:!!i,this.disableAnimations(t,i)):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i,n){if(e.charAt(0)==ma){let s=pE(t),d=e.slice(1),p="";return d.charAt(0)!=ma&&([d,p]=uE(d)),this.engine.listen(this.namespaceId,s,d,p,h=>{let C=h._data||-1;this.factory.scheduleListenerCallback(C,i,h)})}return this.delegate.listen(t,e,i,n)}};function pE(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function uE(o){let t=o.indexOf("."),e=o.substring(0,t),i=o.slice(t+1);return[e,i]}var ya=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(t,e,i){this.delegate=t,this.engine=e,this._zone=i,e.onRemovalComplete=(n,s)=>{s?.removeChild(null,n)}}createRenderer(t,e){let i="",n=this.delegate.createRenderer(t,e);if(!t||!e?.data?.animation){let C=this._rendererCache,E=C.get(n);if(!E){let D=()=>C.delete(n);E=new va(i,n,this.engine,D),C.set(n,E)}return E}let s=e.id,d=e.id+"-"+this._currentId;this._currentId++,this.engine.register(d,t);let p=C=>{Array.isArray(C)?C.forEach(p):this.engine.registerTrigger(s,d,t,C.name,C)};return e.data.animation.forEach(p),new Ml(this,d,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,i){if(t>=0&&t<this._microtaskId){this._zone.run(()=>e(i));return}let n=this._animationCallbacksBuffer;n.length==0&&queueMicrotask(()=>{this._zone.run(()=>{n.forEach(s=>{let[d,p]=s;d(p)}),this._animationCallbacksBuffer=[]})}),n.push([e,i])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(t){this.engine.flush(),this.delegate.componentReplaced?.(t)}};var hE=(()=>{class o extends Un{constructor(e,i,n){super(e,i,n)}ngOnDestroy(){this.flush()}static \u0275fac=function(i){return new(i||o)(he(Gn),he(Xi),he(Zi))};static \u0275prov=se({token:o,factory:o.\u0275fac})}return o})();function gE(){return new pa}function _E(o,t,e){return new ya(o,t,e)}var Du=[{provide:Zi,useFactory:gE},{provide:Un,useClass:hE},{provide:qn,useFactory:_E,deps:[Yl,Un,mt]}],qk=[{provide:Xi,useClass:Tl},{provide:zn,useValue:"NoopAnimations"},...Du],bE=[{provide:Xi,useFactory:()=>new ba},{provide:zn,useFactory:()=>"BrowserAnimations"},...Du];function Fu(){return ql("NgEagerAnimations"),[...bE]}Xl(Yo,{providers:[ic(Vp),Fu(),Zl(Jl([(o,t)=>{let e=localStorage.getItem("token");if(e){let i=o.clone({setHeaders:{"x-auth-token":e}});return t(i)}return t(o)}]))]}).catch(o=>console.error(o));
