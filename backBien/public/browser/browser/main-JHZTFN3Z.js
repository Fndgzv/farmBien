import{a as Bf,b as Lf}from"./chunk-BL6NNVQW.js";import{a as Na}from"./chunk-34HLRTKY.js";import{A as Gf,B as qf,C as Xf,D as Kf,E as Yf,F as Qf,G as Jf,H as y0,I as tp,J as ip,a as Tf,b as Pf,c as kf,d as Aa,e as If,f as Mf,g as Rf,j as Nf,k as Js,l as b0,m as Da,n as Zs,o as Ra,p as wn,q as kr,r as Yn,s as tl,t as Vf,u as Uf,v as jf,w as Wf,x as Hf,y as zf,z as $f}from"./chunk-7AHVNB4E.js";import{a as el}from"./chunk-J2DDS6AL.js";import{a as Vs,c as Us,d as Qi,e as Rm,f as Nm,g as Bm,h as Pa}from"./chunk-BOYW3R3O.js";import{a as Zt}from"./chunk-YJ6IPZHP.js";import{d as Zf,e as ep}from"./chunk-KODG3G25.js";import{a as ki}from"./chunk-JKGFMHHD.js";import{A as nf,B as rf,D as af,E as of,G as sf,H as Fa,I as lf,J as cf,K as df,L as uf,M as mf,N as Sn,O as _i,P as ff,Q as pf,R as hf,S as gf,U as _f,a as bi,b as ei,c as ti,d as jm,e as Wm,f as Hm,h as zm,i as $m,k as Gm,l as Ma,m as qm,n as Xm,o as Km,r as Ym,s as Qm,t as g0,u as Jm,w as Zm,x as ef,y as $s,z as tf}from"./chunk-BYRD3BZU.js";import{a as Fm,b as Am}from"./chunk-WNBONMO5.js";import{$ as je,$a as Fo,$b as Q,$c as qe,A as Pi,Ad as nt,Ae as Df,Bb as l,Bd as Kn,Be as x0,C as dn,Ca as Mo,Cb as s,Cd as Bi,Ce as ut,Db as y,Dd as ka,De as Lt,E as Ms,Eb as at,Ed as Um,F as bm,Fa as Em,Fb as ot,Fd as Ia,G as un,Gd as zs,H as ym,Ha as As,Hb as ie,Hd as Jt,Ic as si,Id as rt,Jb as E,Jc as We,Jd as Bt,Kb as _,Kc as Be,Kd as vf,Lb as Pm,Lc as Ns,Ld as xf,Mb as km,Mc as Bs,Md as Gs,Nb as p0,Nd as bf,Ob as Xr,Oc as Ta,Od as Yr,P as Gr,Pb as h0,Pd as Tr,Q as Ui,Qb as Ot,Qc as Ls,Qd as yf,R as Fs,Rb as St,S as mn,Sb as wt,Sc as Rt,Sd as Cf,T as ft,Tc as Ct,Td as Pr,U as Cm,Ua as qr,Uc as Nt,V as Ze,Vb as $t,Vc as Ae,Vd as Sf,W as ko,Wa as Tm,Wb as d,Xa as Sa,Xb as k,Xd as _0,Y as Sr,Ya as c,Yb as R,Zb as fn,_ as ct,_a as f0,_b as Cn,a as Gn,ab as wa,ac as J,ad as Ht,bb as te,bc as Z,bd as dt,be as wf,c as qn,cd as Om,ce as qs,db as Os,dc as Kr,dd as Dm,de as Ef,ea as Sm,ec as Qt,ed as Ge,ee as v0,f as yt,fc as gi,fd as Lm,fe as Xs,g as Xn,ga as ya,gc as ji,gd as li,ha as T,hb as Te,hc as Wi,hd as Xe,i as hm,ia as P,ib as Ao,id as Pe,ie as Ks,ja as wm,jb as Ds,k as ks,kc as F,kd as ze,l as lt,lb as N,lc as oe,ld as Mt,m as gm,mc as Y,me as Ys,na as Ca,nc as Ni,nd as wr,ne as Qs,oc as Im,od as js,p as Ti,pc as Ea,pd as _t,pe as Ff,q as xt,qd as Ft,qe as Af,ra as Yt,rb as Je,rc as Wt,rd as Gt,s as Is,sa as Yi,sb as p,sd as Er,tb as Ri,td as Ws,ub as Re,uc as mr,ud as ci,ue as Of,v as _m,va as Io,vb as Rs,vc as Mm,vd as Hs,w as vm,wd as Vm,x as xm,xa as m0,xd as di,xe as Oa,y as zr,yd as tt,z as $r,zc as Oo,zd as it}from"./chunk-ZD3EORSU.js";import{a as Qe,b as jt,c as pm,d as Ne,e as hi,f as Le}from"./chunk-EQDQRRRY.js";var an=Ne(yd=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});function rM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var aM=function i(t,e){rM(this,i),this.data=t,this.text=e.text||t,this.options=e};yd.default=aM});var l1=Ne(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.CODE39=void 0;var oM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),sM=an(),lM=cM(sM);function cM(i){return i&&i.__esModule?i:{default:i}}function dM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function uM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function mM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var fM=function(i){mM(t,i);function t(e,n){return dM(this,t),e=e.toUpperCase(),n.mod43&&(e+=gM(_M(e))),uM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return oM(t,[{key:"encode",value:function(){for(var n=Cd("*"),r=0;r<this.data.length;r++)n+=Cd(this.data[r])+"0";return n+=Cd("*"),{data:n,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),t}(lM.default),o1=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],pM=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function Cd(i){return hM(s1(i))}function hM(i){return pM[i].toString(2)}function gM(i){return o1[i]}function s1(i){return o1.indexOf(i)}function _M(i){for(var t=0,e=0;e<i.length;e++)t+=s1(i[e]);return t=t%43,t}Sc.CODE39=fM});var uo=Ne(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});var ss;function Sd(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var c1=ai.SET_A=0,d1=ai.SET_B=1,u1=ai.SET_C=2,jV=ai.SHIFT=98,vM=ai.START_A=103,xM=ai.START_B=104,bM=ai.START_C=105,WV=ai.MODULO=103,HV=ai.STOP=106,zV=ai.FNC1=207,$V=ai.SET_BY_CODE=(ss={},Sd(ss,vM,c1),Sd(ss,xM,d1),Sd(ss,bM,u1),ss),GV=ai.SWAP={101:c1,100:d1,99:u1},qV=ai.A_START_CHAR="\xD0",XV=ai.B_START_CHAR="\xD1",KV=ai.C_START_CHAR="\xD2",YV=ai.A_CHARS="[\0-_\xC8-\xCF]",QV=ai.B_CHARS="[ -\x7F\xC8-\xCF]",JV=ai.C_CHARS="(\xCF*[0-9]{2}\xCF*)",ZV=ai.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011]});var ls=Ne(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});var yM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),CM=an(),SM=wM(CM),bn=uo();function wM(i){return i&&i.__esModule?i:{default:i}}function EM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function TM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function PM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var kM=function(i){PM(t,i);function t(e,n){EM(this,t);var r=TM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.substring(1),n));return r.bytes=e.split("").map(function(a){return a.charCodeAt(0)}),r}return yM(t,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var n=this.bytes,r=n.shift()-105,a=bn.SET_BY_CODE[r];if(a===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&n.unshift(bn.FNC1);var o=t.next(n,1,a);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:t.getBar(r)+o.result+t.getBar((o.checksum+r)%bn.MODULO)+t.getBar(bn.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var n=this.options.ean128||!1;return typeof n=="string"&&(n=n.toLowerCase()==="true"),n}}],[{key:"getBar",value:function(n){return bn.BARS[n]?bn.BARS[n].toString():""}},{key:"correctIndex",value:function(n,r){if(r===bn.SET_A){var a=n.shift();return a<32?a+64:a-32}else return r===bn.SET_B?n.shift()-32:(n.shift()-48)*10+n.shift()-48}},{key:"next",value:function(n,r,a){if(!n.length)return{result:"",checksum:0};var o=void 0,u=void 0;if(n[0]>=200){u=n.shift()-105;var m=bn.SWAP[u];m!==void 0?o=t.next(n,r+1,m):((a===bn.SET_A||a===bn.SET_B)&&u===bn.SHIFT&&(n[0]=a===bn.SET_A?n[0]>95?n[0]-96:n[0]:n[0]<32?n[0]+96:n[0]),o=t.next(n,r+1,a))}else u=t.correctIndex(n,a),o=t.next(n,r+1,a);var f=t.getBar(u),h=u*r;return{result:f+o.result,checksum:h+o.checksum}}}]),t}(SM.default);wd.default=kM});var g1=Ne(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});var Nr=uo(),m1=function(t){return t.match(new RegExp("^"+Nr.A_CHARS+"*"))[0].length},f1=function(t){return t.match(new RegExp("^"+Nr.B_CHARS+"*"))[0].length},p1=function(t){return t.match(new RegExp("^"+Nr.C_CHARS+"*"))[0]};function Ed(i,t){var e=t?Nr.A_CHARS:Nr.B_CHARS,n=i.match(new RegExp("^("+e+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(n)return n[1]+"\xCC"+h1(i.substring(n[1].length));var r=i.match(new RegExp("^"+e+"+"))[0];return r.length===i.length?i:r+String.fromCharCode(t?205:206)+Ed(i.substring(r.length),!t)}function h1(i){var t=p1(i),e=t.length;if(e===i.length)return i;i=i.substring(e);var n=m1(i)>=f1(i);return t+String.fromCharCode(n?206:205)+Ed(i,n)}Td.default=function(i){var t=void 0,e=p1(i).length;if(e>=2)t=Nr.C_START_CHAR+h1(i);else{var n=m1(i)>f1(i);t=(n?Nr.A_START_CHAR:Nr.B_START_CHAR)+Ed(i,n)}return t.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(r,a){return"\xCB"+a})}});var v1=Ne(kd=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});var IM=ls(),MM=_1(IM),FM=g1(),AM=_1(FM);function _1(i){return i&&i.__esModule?i:{default:i}}function OM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Pd(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function DM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var RM=function(i){DM(t,i);function t(e,n){if(OM(this,t),/^[\x00-\x7F\xC8-\xD3]+$/.test(e))var r=Pd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,AM.default)(e),n));else var r=Pd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Pd(r)}return t}(MM.default);kd.default=RM});var b1=Ne(Id=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});var NM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),BM=ls(),LM=VM(BM),x1=uo();function VM(i){return i&&i.__esModule?i:{default:i}}function UM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function jM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function WM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var HM=function(i){WM(t,i);function t(e,n){return UM(this,t),jM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,x1.A_START_CHAR+e,n))}return NM(t,[{key:"valid",value:function(){return new RegExp("^"+x1.A_CHARS+"+$").test(this.data)}}]),t}(LM.default);Id.default=HM});var C1=Ne(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});var zM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),$M=ls(),GM=qM($M),y1=uo();function qM(i){return i&&i.__esModule?i:{default:i}}function XM(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function KM(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function YM(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var QM=function(i){YM(t,i);function t(e,n){return XM(this,t),KM(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y1.B_START_CHAR+e,n))}return zM(t,[{key:"valid",value:function(){return new RegExp("^"+y1.B_CHARS+"+$").test(this.data)}}]),t}(GM.default);Md.default=QM});var w1=Ne(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});var JM=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),ZM=ls(),eF=tF(ZM),S1=uo();function tF(i){return i&&i.__esModule?i:{default:i}}function iF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function nF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function rF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var aF=function(i){rF(t,i);function t(e,n){return iF(this,t),nF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,S1.C_START_CHAR+e,n))}return JM(t,[{key:"valid",value:function(){return new RegExp("^"+S1.C_CHARS+"+$").test(this.data)}}]),t}(eF.default);Fd.default=aF});var E1=Ne(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.CODE128C=lr.CODE128B=lr.CODE128A=lr.CODE128=void 0;var oF=v1(),sF=wc(oF),lF=b1(),cF=wc(lF),dF=C1(),uF=wc(dF),mF=w1(),fF=wc(mF);function wc(i){return i&&i.__esModule?i:{default:i}}lr.CODE128=sF.default;lr.CODE128A=cF.default;lr.CODE128B=uF.default;lr.CODE128C=fF.default});var mo=Ne(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});var lU=Br.SIDE_BIN="101",cU=Br.MIDDLE_BIN="01010",dU=Br.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},uU=Br.EAN2_STRUCTURE=["LL","LG","GL","GG"],mU=Br.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],fU=Br.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]});var fo=Ne(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});var pF=mo(),hF=function(t,e,n){var r=t.split("").map(function(o,u){return pF.BINARIES[e[u]]}).map(function(o,u){return o?o[t[u]]:""});if(n){var a=t.length-1;r=r.map(function(o,u){return u<a?o+n:o})}return r.join("")};Ad.default=hF});var Dd=Ne(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});var gF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),po=mo(),_F=fo(),T1=P1(_F),vF=an(),xF=P1(vF);function P1(i){return i&&i.__esModule?i:{default:i}}function bF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function yF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function CF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var SF=function(i){CF(t,i);function t(e,n){bF(this,t);var r=yF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.fontSize=!n.flat&&n.fontSize>n.width*10?n.width*10:n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return gF(t,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(n,r){return this.text.substr(n,r)}},{key:"leftEncode",value:function(n,r){return(0,T1.default)(n,r)}},{key:"rightText",value:function(n,r){return this.text.substr(n,r)}},{key:"rightEncode",value:function(n,r){return(0,T1.default)(n,r)}},{key:"encodeGuarded",value:function(){var n={fontSize:this.fontSize},r={height:this.guardHeight};return[{data:po.SIDE_BIN,options:r},{data:this.leftEncode(),text:this.leftText(),options:n},{data:po.MIDDLE_BIN,options:r},{data:this.rightEncode(),text:this.rightText(),options:n},{data:po.SIDE_BIN,options:r}]}},{key:"encodeFlat",value:function(){var n=[po.SIDE_BIN,this.leftEncode(),po.MIDDLE_BIN,this.rightEncode(),po.SIDE_BIN];return{data:n.join(""),text:this.text}}}]),t}(xF.default);Od.default=SF});var I1=Ne(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});var wF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),cs=function i(t,e,n){t===null&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(r===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,n)}else{if("value"in r)return r.value;var o=r.get;return o===void 0?void 0:o.call(n)}},EF=mo(),TF=Dd(),PF=kF(TF);function kF(i){return i&&i.__esModule?i:{default:i}}function IF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function MF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function FF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var k1=function(t){var e=t.substr(0,12).split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r*3:n+r},0);return(10-e%10)%10},AF=function(i){FF(t,i);function t(e,n){IF(this,t),e.search(/^[0-9]{12}$/)!==-1&&(e+=k1(e));var r=MF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.lastChar=n.lastChar,r}return wF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===k1(this.data)}},{key:"leftText",value:function(){return cs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var n=this.data.substr(1,6),r=EF.EAN13_STRUCTURE[this.data[0]];return cs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,n,r)}},{key:"rightText",value:function(){return cs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var n=this.data.substr(7,6);return cs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,n,"RRRRRR")}},{key:"encodeGuarded",value:function(){var n=cs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(n.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(n.push({data:"00"}),n.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),n}}]),t}(PF.default);Rd.default=AF});var F1=Ne(Nd=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});var OF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Ec=function i(t,e,n){t===null&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(r===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,n)}else{if("value"in r)return r.value;var o=r.get;return o===void 0?void 0:o.call(n)}},DF=Dd(),RF=NF(DF);function NF(i){return i&&i.__esModule?i:{default:i}}function BF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function LF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function VF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var M1=function(t){var e=t.substr(0,7).split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r:n+r*3},0);return(10-e%10)%10},UF=function(i){VF(t,i);function t(e,n){return BF(this,t),e.search(/^[0-9]{7}$/)!==-1&&(e+=M1(e)),LF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return OF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===M1(this.data)}},{key:"leftText",value:function(){return Ec(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var n=this.data.substr(0,4);return Ec(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,n,"LLLL")}},{key:"rightText",value:function(){return Ec(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var n=this.data.substr(4,4);return Ec(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,n,"RRRR")}}]),t}(RF.default);Nd.default=UF});var O1=Ne(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var jF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),WF=mo(),HF=fo(),zF=A1(HF),$F=an(),GF=A1($F);function A1(i){return i&&i.__esModule?i:{default:i}}function qF(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function XF(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function KF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var YF=function(t){var e=t.split("").map(function(n){return+n}).reduce(function(n,r,a){return a%2?n+r*9:n+r*3},0);return e%10},QF=function(i){KF(t,i);function t(e,n){return qF(this,t),XF(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return jF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var n=WF.EAN5_STRUCTURE[YF(this.data)];return{data:"1011"+(0,zF.default)(this.data,n,"01"),text:this.text}}}]),t}(GF.default);Bd.default=QF});var R1=Ne(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});var JF=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),ZF=mo(),eA=fo(),tA=D1(eA),iA=an(),nA=D1(iA);function D1(i){return i&&i.__esModule?i:{default:i}}function rA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function aA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function oA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var sA=function(i){oA(t,i);function t(e,n){return rA(this,t),aA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return JF(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var n=ZF.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,tA.default)(this.data,n,"01"),text:this.text}}}]),t}(nA.default);Ld.default=sA});var Ud=Ne(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});var lA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();Tc.checksum=Vd;var cA=fo(),ho=N1(cA),dA=an(),uA=N1(dA);function N1(i){return i&&i.__esModule?i:{default:i}}function mA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function fA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function pA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var hA=function(i){pA(t,i);function t(e,n){mA(this,t),e.search(/^[0-9]{11}$/)!==-1&&(e+=Vd(e));var r=fA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.displayValue=n.displayValue,n.fontSize>n.width*10?r.fontSize=n.width*10:r.fontSize=n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return lA(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==Vd(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var n="";return n+="101",n+=(0,ho.default)(this.data.substr(0,6),"LLLLLL"),n+="01010",n+=(0,ho.default)(this.data.substr(6,6),"RRRRRR"),n+="101",{data:n,text:this.text}}},{key:"guardedEncoding",value:function(){var n=[];return this.displayValue&&n.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),n.push({data:"101"+(0,ho.default)(this.data[0],"L"),options:{height:this.guardHeight}}),n.push({data:(0,ho.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),n.push({data:"01010",options:{height:this.guardHeight}}),n.push({data:(0,ho.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),n.push({data:(0,ho.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&n.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),n}}]),t}(uA.default);function Vd(i){var t=0,e;for(e=1;e<11;e+=2)t+=parseInt(i[e]);for(e=0;e<11;e+=2)t+=parseInt(i[e])*3;return(10-t%10)%10}Tc.default=hA});var V1=Ne(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});var gA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),_A=fo(),vA=L1(_A),xA=an(),bA=L1(xA),yA=Ud();function L1(i){return i&&i.__esModule?i:{default:i}}function CA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function jd(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function SA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var wA=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],EA=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],TA=function(i){SA(t,i);function t(e,n){CA(this,t);var r=jd(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));if(r.isValid=!1,e.search(/^[0-9]{6}$/)!==-1)r.middleDigits=e,r.upcA=B1(e,"0"),r.text=n.text||""+r.upcA[0]+e+r.upcA[r.upcA.length-1],r.isValid=!0;else if(e.search(/^[01][0-9]{7}$/)!==-1)if(r.middleDigits=e.substring(1,e.length-1),r.upcA=B1(r.middleDigits,e[0]),r.upcA[r.upcA.length-1]===e[e.length-1])r.isValid=!0;else return jd(r);else return jd(r);return r.displayValue=n.displayValue,n.fontSize>n.width*10?r.fontSize=n.width*10:r.fontSize=n.fontSize,r.guardHeight=n.height+r.fontSize/2+n.textMargin,r}return gA(t,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var n="";return n+="101",n+=this.encodeMiddleDigits(),n+="010101",{data:n,text:this.text}}},{key:"guardedEncoding",value:function(){var n=[];return this.displayValue&&n.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),n.push({data:"101",options:{height:this.guardHeight}}),n.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),n.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&n.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),n}},{key:"encodeMiddleDigits",value:function(){var n=this.upcA[0],r=this.upcA[this.upcA.length-1],a=EA[parseInt(r)][parseInt(n)];return(0,vA.default)(this.middleDigits,a)}}]),t}(bA.default);function B1(i,t){for(var e=parseInt(i[i.length-1]),n=wA[e],r="",a=0,o=0;o<n.length;o++){var u=n[o];u==="X"?r+=i[a++]:r+=u}return r=""+t+r,""+r+(0,yA.checksum)(r)}Wd.default=TA});var U1=Ne(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.UPCE=on.UPC=on.EAN2=on.EAN5=on.EAN8=on.EAN13=void 0;var PA=I1(),kA=go(PA),IA=F1(),MA=go(IA),FA=O1(),AA=go(FA),OA=R1(),DA=go(OA),RA=Ud(),NA=go(RA),BA=V1(),LA=go(BA);function go(i){return i&&i.__esModule?i:{default:i}}on.EAN13=kA.default;on.EAN8=MA.default;on.EAN5=AA.default;on.EAN2=DA.default;on.UPC=NA.default;on.UPCE=LA.default});var j1=Ne(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});var wU=ds.START_BIN="1010",EU=ds.END_BIN="11101",TU=ds.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]});var zd=Ne(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});var VA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Pc=j1(),UA=an(),jA=WA(UA);function WA(i){return i&&i.__esModule?i:{default:i}}function HA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function zA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function $A(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var GA=function(i){$A(t,i);function t(){return HA(this,t),zA(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return VA(t,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var n=this,r=this.data.match(/.{2}/g).map(function(a){return n.encodePair(a)}).join("");return{data:Pc.START_BIN+r+Pc.END_BIN,text:this.text}}},{key:"encodePair",value:function(n){var r=Pc.BINARIES[n[1]];return Pc.BINARIES[n[0]].split("").map(function(a,o){return(a==="1"?"111":"1")+(r[o]==="1"?"000":"0")}).join("")}}]),t}(jA.default);Hd.default=GA});var H1=Ne($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});var qA=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),XA=zd(),KA=YA(XA);function YA(i){return i&&i.__esModule?i:{default:i}}function QA(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function JA(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function ZA(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var W1=function(t){var e=t.substr(0,13).split("").map(function(n){return parseInt(n,10)}).reduce(function(n,r,a){return n+r*(3-a%2*2)},0);return Math.ceil(e/10)*10-e},eO=function(i){ZA(t,i);function t(e,n){return QA(this,t),e.search(/^[0-9]{13}$/)!==-1&&(e+=W1(e)),JA(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return qA(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===W1(this.data)}}]),t}(KA.default);$d.default=eO});var $1=Ne(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.ITF14=_o.ITF=void 0;var tO=zd(),iO=z1(tO),nO=H1(),rO=z1(nO);function z1(i){return i&&i.__esModule?i:{default:i}}_o.ITF=iO.default;_o.ITF14=rO.default});var vo=Ne(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});var aO=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),oO=an(),sO=lO(oO);function lO(i){return i&&i.__esModule?i:{default:i}}function cO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function dO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function uO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var mO=function(i){uO(t,i);function t(e,n){return cO(this,t),dO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return aO(t,[{key:"encode",value:function(){for(var n="110",r=0;r<this.data.length;r++){var a=parseInt(this.data[r]),o=a.toString(2);o=fO(o,4-o.length);for(var u=0;u<o.length;u++)n+=o[u]=="0"?"100":"110"}return n+="1001",{data:n,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),t}(sO.default);function fO(i,t){for(var e=0;e<t;e++)i="0"+i;return i}Gd.default=mO});var us=Ne(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.mod10=pO;kc.mod11=hO;function pO(i){for(var t=0,e=0;e<i.length;e++){var n=parseInt(i[e]);(e+i.length)%2===0?t+=n:t+=n*2%10+Math.floor(n*2/10)}return(10-t%10)%10}function hO(i){for(var t=0,e=[2,3,4,5,6,7],n=0;n<i.length;n++){var r=parseInt(i[i.length-1-n]);t+=e[n%e.length]*r}return(11-t%11)%11}});var G1=Ne(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});var gO=vo(),_O=xO(gO),vO=us();function xO(i){return i&&i.__esModule?i:{default:i}}function bO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function yO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function CO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var SO=function(i){CO(t,i);function t(e,n){return bO(this,t),yO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,vO.mod10)(e),n))}return t}(_O.default);qd.default=SO});var q1=Ne(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});var wO=vo(),EO=PO(wO),TO=us();function PO(i){return i&&i.__esModule?i:{default:i}}function kO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function IO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function MO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var FO=function(i){MO(t,i);function t(e,n){return kO(this,t),IO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,TO.mod11)(e),n))}return t}(EO.default);Xd.default=FO});var K1=Ne(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});var AO=vo(),OO=DO(AO),X1=us();function DO(i){return i&&i.__esModule?i:{default:i}}function RO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function NO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function BO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var LO=function(i){BO(t,i);function t(e,n){return RO(this,t),e+=(0,X1.mod10)(e),e+=(0,X1.mod10)(e),NO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return t}(OO.default);Kd.default=LO});var Q1=Ne(Yd=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});var VO=vo(),UO=jO(VO),Y1=us();function jO(i){return i&&i.__esModule?i:{default:i}}function WO(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function HO(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function zO(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var $O=function(i){zO(t,i);function t(e,n){return WO(this,t),e+=(0,Y1.mod11)(e),e+=(0,Y1.mod10)(e),HO(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return t}(UO.default);Yd.default=$O});var J1=Ne(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.MSI1110=An.MSI1010=An.MSI11=An.MSI10=An.MSI=void 0;var GO=vo(),qO=ms(GO),XO=G1(),KO=ms(XO),YO=q1(),QO=ms(YO),JO=K1(),ZO=ms(JO),e5=Q1(),t5=ms(e5);function ms(i){return i&&i.__esModule?i:{default:i}}An.MSI=qO.default;An.MSI10=KO.default;An.MSI11=QO.default;An.MSI1010=ZO.default;An.MSI1110=t5.default});var Z1=Ne(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.pharmacode=void 0;var i5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),n5=an(),r5=a5(n5);function a5(i){return i&&i.__esModule?i:{default:i}}function o5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function s5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function l5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var c5=function(i){l5(t,i);function t(e,n){o5(this,t);var r=s5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.number=parseInt(e,10),r}return i5(t,[{key:"encode",value:function(){for(var n=this.number,r="";!isNaN(n)&&n!=0;)n%2===0?(r="11100"+r,n=(n-2)/2):(r="100"+r,n=(n-1)/2);return r=r.slice(0,-2),{data:r,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t}(r5.default);Ic.pharmacode=c5});var e_=Ne(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.codabar=void 0;var d5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),u5=an(),m5=f5(u5);function f5(i){return i&&i.__esModule?i:{default:i}}function p5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function h5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function g5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var _5=function(i){g5(t,i);function t(e,n){p5(this,t),e.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(e="A"+e+"A");var r=h5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.toUpperCase(),n));return r.text=r.options.text||r.text.replace(/[A-D]/g,""),r}return d5(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var n=[],r=this.getEncodings(),a=0;a<this.data.length;a++)n.push(r[this.data.charAt(a)]),a!==this.data.length-1&&n.push("0");return{text:this.text,data:n.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t}(m5.default);Mc.codabar=_5});var t_=Ne(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});var UU=fs.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","\xFF"],jU=fs.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],WU=fs.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"\x7F":["(%)","T"]}});var Jd=Ne(Qd=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});var v5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Fc=t_(),x5=an(),b5=y5(x5);function y5(i){return i&&i.__esModule?i:{default:i}}function C5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function S5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function w5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var E5=function(i){w5(t,i);function t(e,n){return C5(this,t),S5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return v5(t,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var n=this.data.split("").flatMap(function(u){return Fc.MULTI_SYMBOLS[u]||u}),r=n.map(function(u){return t.getEncoding(u)}).join(""),a=t.checksum(n,20),o=t.checksum(n.concat(a),15);return{text:this.text,data:t.getEncoding("\xFF")+r+t.getEncoding(a)+t.getEncoding(o)+t.getEncoding("\xFF")+"1"}}}],[{key:"getEncoding",value:function(n){return Fc.BINARIES[t.symbolValue(n)]}},{key:"getSymbol",value:function(n){return Fc.SYMBOLS[n]}},{key:"symbolValue",value:function(n){return Fc.SYMBOLS.indexOf(n)}},{key:"checksum",value:function(n,r){var a=n.slice().reverse().reduce(function(o,u,m){var f=m%r+1;return o+t.symbolValue(u)*f},0);return t.getSymbol(a%47)}}]),t}(b5.default);Qd.default=E5});var i_=Ne(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});var T5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),P5=Jd(),k5=I5(P5);function I5(i){return i&&i.__esModule?i:{default:i}}function M5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function F5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function A5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var O5=function(i){A5(t,i);function t(e,n){return M5(this,t),F5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return T5(t,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),t}(k5.default);Zd.default=O5});var r_=Ne(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.CODE93FullASCII=xo.CODE93=void 0;var D5=Jd(),R5=n_(D5),N5=i_(),B5=n_(N5);function n_(i){return i&&i.__esModule?i:{default:i}}xo.CODE93=R5.default;xo.CODE93FullASCII=B5.default});var a_=Ne(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.GenericBarcode=void 0;var L5=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),V5=an(),U5=j5(V5);function j5(i){return i&&i.__esModule?i:{default:i}}function W5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function H5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function z5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var $5=function(i){z5(t,i);function t(e,n){return W5(this,t),H5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return L5(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t}(U5.default);Ac.GenericBarcode=$5});var l_=Ne(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});var G5=l1(),Oc=E1(),bo=U1(),o_=$1(),ps=J1(),q5=Z1(),X5=e_(),s_=r_(),K5=a_();eu.default={CODE39:G5.CODE39,CODE128:Oc.CODE128,CODE128A:Oc.CODE128A,CODE128B:Oc.CODE128B,CODE128C:Oc.CODE128C,EAN13:bo.EAN13,EAN8:bo.EAN8,EAN5:bo.EAN5,EAN2:bo.EAN2,UPC:bo.UPC,UPCE:bo.UPCE,ITF14:o_.ITF14,ITF:o_.ITF,MSI:ps.MSI,MSI10:ps.MSI10,MSI11:ps.MSI11,MSI1010:ps.MSI1010,MSI1110:ps.MSI1110,pharmacode:q5.pharmacode,codabar:X5.codabar,CODE93:s_.CODE93,CODE93FullASCII:s_.CODE93FullASCII,GenericBarcode:K5.GenericBarcode}});var hs=Ne(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});var Y5=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i};tu.default=function(i,t){return Y5({},i,t)}});var c_=Ne(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.default=Q5;function Q5(i){var t=[];function e(n){if(Array.isArray(n))for(var r=0;r<n.length;r++)e(n[r]);else n.text=n.text||"",n.data=n.data||"",t.push(n)}return e(i),t}});var d_=Ne(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});nu.default=J5;function J5(i){return i.marginTop=i.marginTop||i.margin,i.marginBottom=i.marginBottom||i.margin,i.marginRight=i.marginRight||i.margin,i.marginLeft=i.marginLeft||i.margin,i}});var au=Ne(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.default=Z5;function Z5(i){var t=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var e in t)t.hasOwnProperty(e)&&(e=t[e],typeof i[e]=="string"&&(i[e]=parseInt(i[e],10)));return typeof i.displayValue=="string"&&(i.displayValue=i.displayValue!="false"),i}});var su=Ne(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});var eD={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};ou.default=eD});var f_=Ne(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});var tD=au(),iD=m_(tD),nD=su(),u_=m_(nD);function m_(i){return i&&i.__esModule?i:{default:i}}function rD(i){var t={};for(var e in u_.default)u_.default.hasOwnProperty(e)&&(i.hasAttribute("jsbarcode-"+e.toLowerCase())&&(t[e]=i.getAttribute("jsbarcode-"+e.toLowerCase())),i.hasAttribute("data-"+e.toLowerCase())&&(t[e]=i.getAttribute("data-"+e.toLowerCase())));return t.value=i.getAttribute("jsbarcode-value")||i.getAttribute("data-value"),t=(0,iD.default)(t),t}lu.default=rD});var cu=Ne(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.getTotalWidthOfEncodings=On.calculateEncodingAttributes=On.getBarcodePadding=On.getEncodingHeight=On.getMaximumHeightOfEncodings=void 0;var aD=hs(),oD=sD(aD);function sD(i){return i&&i.__esModule?i:{default:i}}function p_(i,t){return t.height+(t.displayValue&&i.text.length>0?t.fontSize+t.textMargin:0)+t.marginTop+t.marginBottom}function h_(i,t,e){if(e.displayValue&&t<i){if(e.textAlign=="center")return Math.floor((i-t)/2);if(e.textAlign=="left")return 0;if(e.textAlign=="right")return Math.floor(i-t)}return 0}function lD(i,t,e){for(var n=0;n<i.length;n++){var r=i[n],a=(0,oD.default)(t,r.options),o;a.displayValue?o=uD(r.text,a,e):o=0;var u=r.data.length*a.width;r.width=Math.ceil(Math.max(o,u)),r.height=p_(r,a),r.barcodePadding=h_(o,u,a)}}function cD(i){for(var t=0,e=0;e<i.length;e++)t+=i[e].width;return t}function dD(i){for(var t=0,e=0;e<i.length;e++)i[e].height>t&&(t=i[e].height);return t}function uD(i,t,e){var n;if(e)n=e;else if(typeof document<"u")n=document.createElement("canvas").getContext("2d");else return 0;n.font=t.fontOptions+" "+t.fontSize+"px "+t.font;var r=n.measureText(i);if(!r)return 0;var a=r.width;return a}On.getMaximumHeightOfEncodings=dD;On.getEncodingHeight=p_;On.getBarcodePadding=h_;On.calculateEncodingAttributes=lD;On.getTotalWidthOfEncodings=cD});var g_=Ne(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});var mD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),fD=hs(),pD=hD(fD),du=cu();function hD(i){return i&&i.__esModule?i:{default:i}}function gD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _D=function(){function i(t,e,n){gD(this,i),this.canvas=t,this.encodings=e,this.options=n}return mD(i,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var e=0;e<this.encodings.length;e++){var n=(0,pD.default)(this.options,this.encodings[e].options);this.drawCanvasBarcode(n,this.encodings[e]),this.drawCanvasText(n,this.encodings[e]),this.moveCanvasDrawing(this.encodings[e])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var e=this.canvas.getContext("2d");e.save(),(0,du.calculateEncodingAttributes)(this.encodings,this.options,e);var n=(0,du.getTotalWidthOfEncodings)(this.encodings),r=(0,du.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=n+this.options.marginLeft+this.options.marginRight,this.canvas.height=r,e.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(e.fillStyle=this.options.background,e.fillRect(0,0,this.canvas.width,this.canvas.height)),e.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(e,n){var r=this.canvas.getContext("2d"),a=n.data,o;e.textPosition=="top"?o=e.marginTop+e.fontSize+e.textMargin:o=e.marginTop,r.fillStyle=e.lineColor;for(var u=0;u<a.length;u++){var m=u*e.width+n.barcodePadding;a[u]==="1"?r.fillRect(m,o,e.width,e.height):a[u]&&r.fillRect(m,o,e.width,e.height*a[u])}}},{key:"drawCanvasText",value:function(e,n){var r=this.canvas.getContext("2d"),a=e.fontOptions+" "+e.fontSize+"px "+e.font;if(e.displayValue){var o,u;e.textPosition=="top"?u=e.marginTop+e.fontSize-e.textMargin:u=e.height+e.textMargin+e.marginTop+e.fontSize,r.font=a,e.textAlign=="left"||n.barcodePadding>0?(o=0,r.textAlign="left"):e.textAlign=="right"?(o=n.width-1,r.textAlign="right"):(o=n.width/2,r.textAlign="center"),r.fillText(n.text,o,u)}}},{key:"moveCanvasDrawing",value:function(e){var n=this.canvas.getContext("2d");n.translate(e.width,0)}},{key:"restoreCanvas",value:function(){var e=this.canvas.getContext("2d");e.restore()}}]),i}();uu.default=_D});var __=Ne(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});var vD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),xD=hs(),bD=yD(xD),mu=cu();function yD(i){return i&&i.__esModule?i:{default:i}}function CD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Dc="http://www.w3.org/2000/svg",SD=function(){function i(t,e,n){CD(this,i),this.svg=t,this.encodings=e,this.options=n,this.document=n.xmlDocument||document}return vD(i,[{key:"render",value:function(){var e=this.options.marginLeft;this.prepareSVG();for(var n=0;n<this.encodings.length;n++){var r=this.encodings[n],a=(0,bD.default)(this.options,r.options),o=this.createGroup(e,a.marginTop,this.svg);this.setGroupOptions(o,a),this.drawSvgBarcode(o,a,r),this.drawSVGText(o,a,r),e+=r.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,mu.calculateEncodingAttributes)(this.encodings,this.options);var e=(0,mu.getTotalWidthOfEncodings)(this.encodings),n=(0,mu.getMaximumHeightOfEncodings)(this.encodings),r=e+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(r,n),this.options.background&&this.drawRect(0,0,r,n,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(e,n,r){var a=r.data,o;n.textPosition=="top"?o=n.fontSize+n.textMargin:o=0;for(var u=0,m=0,f=0;f<a.length;f++)m=f*n.width+r.barcodePadding,a[f]==="1"?u++:u>0&&(this.drawRect(m-n.width*u,o,n.width*u,n.height,e),u=0);u>0&&this.drawRect(m-n.width*(u-1),o,n.width*u,n.height,e)}},{key:"drawSVGText",value:function(e,n,r){var a=this.document.createElementNS(Dc,"text");if(n.displayValue){var o,u;a.setAttribute("style","font:"+n.fontOptions+" "+n.fontSize+"px "+n.font),n.textPosition=="top"?u=n.fontSize-n.textMargin:u=n.height+n.textMargin+n.fontSize,n.textAlign=="left"||r.barcodePadding>0?(o=0,a.setAttribute("text-anchor","start")):n.textAlign=="right"?(o=r.width-1,a.setAttribute("text-anchor","end")):(o=r.width/2,a.setAttribute("text-anchor","middle")),a.setAttribute("x",o),a.setAttribute("y",u),a.appendChild(this.document.createTextNode(r.text)),e.appendChild(a)}}},{key:"setSvgAttributes",value:function(e,n){var r=this.svg;r.setAttribute("width",e+"px"),r.setAttribute("height",n+"px"),r.setAttribute("x","0px"),r.setAttribute("y","0px"),r.setAttribute("viewBox","0 0 "+e+" "+n),r.setAttribute("xmlns",Dc),r.setAttribute("version","1.1"),r.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(e,n,r){var a=this.document.createElementNS(Dc,"g");return a.setAttribute("transform","translate("+e+", "+n+")"),r.appendChild(a),a}},{key:"setGroupOptions",value:function(e,n){e.setAttribute("style","fill:"+n.lineColor+";")}},{key:"drawRect",value:function(e,n,r,a,o){var u=this.document.createElementNS(Dc,"rect");return u.setAttribute("x",e),u.setAttribute("y",n),u.setAttribute("width",r),u.setAttribute("height",a),o.appendChild(u),u}}]),i}();fu.default=SD});var v_=Ne(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});var wD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function ED(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var TD=function(){function i(t,e,n){ED(this,i),this.object=t,this.encodings=e,this.options=n}return wD(i,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),i}();pu.default=TD});var x_=Ne(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});var PD=g_(),kD=hu(PD),ID=__(),MD=hu(ID),FD=v_(),AD=hu(FD);function hu(i){return i&&i.__esModule?i:{default:i}}gu.default={CanvasRenderer:kD.default,SVGRenderer:MD.default,ObjectRenderer:AD.default}});var bu=Ne(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});function _u(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function vu(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function xu(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var OD=function(i){xu(t,i);function t(e,n){_u(this,t);var r=vu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.name="InvalidInputException",r.symbology=e,r.input=n,r.message='"'+r.input+'" is not a valid input for '+r.symbology,r}return t}(Error),DD=function(i){xu(t,i);function t(){_u(this,t);var e=vu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="InvalidElementException",e.message="Not supported type to render on",e}return t}(Error),RD=function(i){xu(t,i);function t(){_u(this,t);var e=vu(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="NoElementException",e.message="No element to render on.",e}return t}(Error);gs.InvalidInputException=OD;gs.InvalidElementException=DD;gs.NoElementException=RD});var y_=Ne(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});var ND=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},BD=f_(),yu=b_(BD),LD=x_(),_s=b_(LD),VD=bu();function b_(i){return i&&i.__esModule?i:{default:i}}function Cu(i){if(typeof i=="string")return UD(i);if(Array.isArray(i)){for(var t=[],e=0;e<i.length;e++)t.push(Cu(i[e]));return t}else{if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLImageElement)return jD(i);if(i&&i.nodeName&&i.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&i instanceof SVGElement)return{element:i,options:(0,yu.default)(i),renderer:_s.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement)return{element:i,options:(0,yu.default)(i),renderer:_s.default.CanvasRenderer};if(i&&i.getContext)return{element:i,renderer:_s.default.CanvasRenderer};if(i&&(typeof i>"u"?"undefined":ND(i))==="object"&&!i.nodeName)return{element:i,renderer:_s.default.ObjectRenderer};throw new VD.InvalidElementException}}function UD(i){var t=document.querySelectorAll(i);if(t.length!==0){for(var e=[],n=0;n<t.length;n++)e.push(Cu(t[n]));return e}}function jD(i){var t=document.createElement("canvas");return{element:t,options:(0,yu.default)(i),renderer:_s.default.CanvasRenderer,afterRender:function(){i.setAttribute("src",t.toDataURL())}}}Su.default=Cu});var C_=Ne(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});var WD=function(){function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function HD(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var zD=function(){function i(t){HD(this,i),this.api=t}return WD(i,[{key:"handleCatch",value:function(e){if(e.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw e.message;else throw e;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(e){try{var n=e.apply(void 0,arguments);return this.api._options.valid(!0),n}catch(r){return this.handleCatch(r),this.api}}}]),i}();wu.default=zD});var Pu=Ne((cj,I_)=>{"use strict";var $D=l_(),ha=Lr($D),GD=hs(),vs=Lr(GD),qD=c_(),w_=Lr(qD),XD=d_(),S_=Lr(XD),KD=y_(),YD=Lr(KD),QD=au(),JD=Lr(QD),ZD=C_(),e6=Lr(ZD),E_=bu(),t6=su(),T_=Lr(t6);function Lr(i){return i&&i.__esModule?i:{default:i}}var yr=function(){},Rc=function(t,e,n){var r=new yr;if(typeof t>"u")throw Error("No element to render on was provided.");return r._renderProperties=(0,YD.default)(t),r._encodings=[],r._options=T_.default,r._errorHandler=new e6.default(r),typeof e<"u"&&(n=n||{},n.format||(n.format=k_()),r.options(n)[n.format](e,n).render()),r};Rc.getModule=function(i){return ha.default[i]};for(Eu in ha.default)ha.default.hasOwnProperty(Eu)&&i6(ha.default,Eu);var Eu;function i6(i,t){yr.prototype[t]=yr.prototype[t.toUpperCase()]=yr.prototype[t.toLowerCase()]=function(e,n){var r=this;return r._errorHandler.wrapBarcodeCall(function(){n.text=typeof n.text>"u"?void 0:""+n.text;var a=(0,vs.default)(r._options,n);a=(0,JD.default)(a);var o=i[t],u=P_(e,o,a);return r._encodings.push(u),r})}}function P_(i,t,e){i=""+i;var n=new t(i,e);if(!n.valid())throw new E_.InvalidInputException(n.constructor.name,i);var r=n.encode();r=(0,w_.default)(r);for(var a=0;a<r.length;a++)r[a].options=(0,vs.default)(e,r[a].options);return r}function k_(){return ha.default.CODE128?"CODE128":Object.keys(ha.default)[0]}yr.prototype.options=function(i){return this._options=(0,vs.default)(this._options,i),this};yr.prototype.blank=function(i){var t=new Array(i+1).join("0");return this._encodings.push({data:t}),this};yr.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var i;for(var t in this._renderProperties){i=this._renderProperties[t];var e=(0,vs.default)(this._options,i.options);e.format=="auto"&&(e.format=k_()),this._errorHandler.wrapBarcodeCall(function(){var n=e.value,r=ha.default[e.format.toUpperCase()],a=P_(n,r,e);Tu(i,a,e)})}}};yr.prototype.render=function(){if(!this._renderProperties)throw new E_.NoElementException;if(Array.isArray(this._renderProperties))for(var i=0;i<this._renderProperties.length;i++)Tu(this._renderProperties[i],this._encodings,this._options);else Tu(this._renderProperties,this._encodings,this._options);return this};yr.prototype._defaults=T_.default;function Tu(i,t,e){t=(0,w_.default)(t);for(var n=0;n<t.length;n++)t[n].options=(0,vs.default)(e,t[n].options),(0,S_.default)(t[n].options);(0,S_.default)(e);var r=i.renderer,a=new r(i.element,t,e);a.render(),i.afterRender&&i.afterRender()}typeof window<"u"&&(window.JsBarcode=Rc);typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(i,t){var e=[];return jQuery(this).each(function(){e.push(this)}),Rc(e,i,t)});I_.exports=Rc});var np=Ge.apiUrl,qt=class i{constructor(t,e){this.router=t;this.http=e;this.cargarStorage()}apiUrl=`${Ge.apiUrl}/auth`;isLoginVisible=new Xn(!1);isEditProfileVisible=new Xn(!1);isChangePasswordVisible=new Xn(!1);userNombreSubject=new Xn(localStorage.getItem("user_nombre"));userRolSubject=new Xn(localStorage.getItem("user_rol"));usuarioSubject=new Xn(this.getUserData());usuario$=this.usuarioSubject.asObservable();farmaciaSubject=new Xn(this.getFarmaciaData());farmacia$=this.farmaciaSubject.asObservable();token="";usuario=null;userNombre$=this.userNombreSubject.asObservable();userRol$=this.userRolSubject.asObservable();login(t,e,n){let r=`${np}/auth/login`,a={usuario:t,password:e};return n&&(a.firma=n),this.http.post(r,a).pipe(mn(o=>{o?.token&&o?.user&&(this.guardarToken(o.token),localStorage.setItem("usuario",JSON.stringify(o.user)),this.usuario=o.user,this.usuarioSubject.next(o.user))}))}fetchUserDataFromBackend(){let t=localStorage.getItem("auth_token");if(!t)return;let e=new qe({"x-auth-token":t,"Content-Type":"application/json"}),n={};this.http.get(`${this.apiUrl}/me`,{headers:e}).subscribe({next:r=>{r.usuario&&(localStorage.setItem("user_nombre",r.usuario.nombre),localStorage.setItem("user_rol",r.usuario.rol),localStorage.setItem("user_email",r.usuario.email),localStorage.setItem("user_farmacia",r.usuario.farmacia),localStorage.setItem("user_telefono",r.usuario.telefono),localStorage.setItem("user_domicilio",r.usuario.domicilio),this.userNombreSubject.next(r.usuario.nombre),this.userRolSubject.next(r.usuario.rol))},error:r=>{console.error("\u274C Error al obtener datos del usuario:",r)}})}register(t,e,n,r,a){let o=new qe({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/auto-register`,{nombre:t,password:e,email:n,telefono:r,domicilio:a},{headers:o})}setUserData(t,e,n,r="",a=null,o="",u=""){localStorage.setItem("auth_token",t),localStorage.setItem("user_nombre",e),localStorage.setItem("user_rol",n),localStorage.setItem("user_email",r),o&&localStorage.setItem("user_telefono",o),u&&localStorage.setItem("user_domicilio",u),localStorage.setItem("user_farmacia",JSON.stringify(a)),this.userNombreSubject.next(e),this.userRolSubject.next(n),this.setFarmacia(a)}logout(){this.token="",this.usuario=null,localStorage.clear(),this.farmaciaSubject.next(null),this.usuarioSubject.next(null),this.router.navigateByUrl("/")}guardarToken(t){this.token=t,localStorage.setItem("token",t)}cargarStorage(){let t=localStorage.getItem("token"),e=localStorage.getItem("usuario");this.token=t||"";try{this.usuario=e&&e!=="undefined"?JSON.parse(e):null}catch(n){console.error("\u274C Error al parsear usuario en cargarStorage:",n),this.usuario=null,localStorage.removeItem("usuario")}}getUsuario(){return this.usuario}getUserData(){let t=localStorage.getItem("usuario");try{return t&&t!=="undefined"?JSON.parse(t):null}catch(e){return console.error("Error al parsear usuario del localStorage:",e),null}}getFarmaciaData(){let t=localStorage.getItem("user_farmacia");try{return t?JSON.parse(t):null}catch{return null}}showLogin(){this.isLoginVisible.next(!0)}hideLogin(){this.isLoginVisible.next(!1)}changePassword(t,e,n){let r=localStorage.getItem("auth_token");if(!r)return console.error("No hay token en localStorage"),gm(()=>new Error("No hay token disponible"));let a=new qe({"x-auth-token":r||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/change-password`,{passwordActual:t,nuevaPassword:e,confirmarPassword:n},{headers:a})}showChangePassword(){this.isChangePasswordVisible.next(!0),this.isEditProfileVisible.next(!1)}hideChangePassword(){this.isChangePasswordVisible.next(!1)}showEditProfile(){this.isEditProfileVisible.next(!0)}hideEditProfile(){this.isEditProfileVisible.next(!1)}updateUser(t,e,n,r,a){let o=localStorage.getItem("auth_token");if(!o)return console.error("\u274C No hay token disponible, la solicitud ser\xE1 rechazada."),new qn(m=>{m.error({mensaje:"No hay token de autenticaci\xF3n."})});let u=new qe({"Content-Type":"application/json","x-auth-token":o});return this.http.put(`${this.apiUrl}/update`,{nombre:t,password:e,email:n,telefono:r,domicilio:a},{headers:u})}isAuthenticated(){let t=localStorage.getItem("token");if(!t)return!1;try{let n=JSON.parse(atob(t.split(".")[1])).exp,r=Math.floor(Date.now()/1e3);return n>r}catch{return!1}}get isLoggedIn(){return this.isAuthenticated()}tieneRol(t){let e=this.getUserData();return e&&t.includes(e.rol)}verificaToken(){let t=`${np}/auth/renew`;return this.http.get(t).pipe(mn(e=>{this.guardarToken(e.token),localStorage.setItem("usuario",JSON.stringify(e.usuario)),this.usuario=e.usuario,this.usuarioSubject.next(e.usuario)}),xt(()=>!0),Pi(()=>(this.logout(),lt(!1))))}notifyUserChange(){let t=this.getUserData(),e=localStorage.getItem("token");t&&e?(this.usuarioSubject.next(t),this.userNombreSubject.next(t.nombre),this.userRolSubject.next(t.rol)):(this.usuarioSubject.next(null),this.userNombreSubject.next(null),this.userRolSubject.next(null))}getPayload(t){try{return JSON.parse(atob(t.split(".")[1]))}catch{return null}}getUserId(){return localStorage.getItem("user_id")}setFarmacia(t){t?localStorage.setItem("user_farmacia",JSON.stringify(t)):localStorage.removeItem("user_farmacia"),this.farmaciaSubject.next(t)}obtenerFirma(t){return this.http.get(`${Ge.apiUrl}/farmacias/firma/${t}`)}static \u0275fac=function(e){return new(e||i)(ct(Qi),ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var il=class i{constructor(t){this.authService=t}ngOnInit(){this.authService.notifyUserChange()}static \u0275fac=function(e){return new(e||i)(te(qt))};static \u0275cmp=Te({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(e,n){e&1&&y(0,"router-outlet")},dependencies:[Us],encapsulation:2})};var Ji=i=>{let t=je(qt),e=je(Qi);if(!t.isAuthenticated())return e.navigate(["/login"]),!1;let n=t.getUserData(),r=n?.rol,a=i.data?.rolesPermitidos;if(!r)return console.warn("\u26A0\uFE0F Usuario inv\xE1lido o sin rol:",n),e.navigate(["/login"]),!1;if(!a||a.includes(r)){if(r==="empleado"){let o=["ventas","pedidos","devoluciones"],u=localStorage.getItem("corte_activo");if(o.includes(i.routeConfig?.path||"")&&!u)return e.navigate(["/inicio-turno"]),!1}return!0}return e.navigate(["/home"]),!1};function qv(i,t){if(i&1&&y(0,"button",18),i&2){let e=t.index,n=_(2);Re("active",e===n.activeSlideIndex),Je("data-bs-slide-to",e)("aria-label","Slide "+(e+1))}}function Xv(i,t){if(i&1&&(l(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"div",11),y(5,"img",12),l(6,"div",13)(7,"h5",14),d(8),s(),l(9,"p",15),d(10),s()()()()()(),l(11,"div",16),N(12,qv,1,4,"button",17),s()()),i&2){let e=t.$implicit,n=t.index,r=_();Re("active",n===0),c(5),p("src",e.image,qr)("alt",e.image),c(3),k(e.title),c(2),k(e.description),c(2),p("ngForOf",r.carouselItems)}}var nl=class i{carouselItems=[{image:"./assets/images/PromoLunes.jfif",title:"LUNES !! de Bienestar",description:"Aprovecha nuestros descuentos en medicamentos seleccionados."},{image:"./assets/images/ofer4x3.png",title:"Paga 3 y ll\xE9vate 4",description:"Ahorra a\xFAn m\xE1s con nuestras grandes ofertas, consulta productos participantes"},{image:"./assets/images/bebes.jfif",title:"Cuida a tu Beb\xE9",description:"Encuentra productos esenciales para el cuidado de tu beb\xE9."},{image:"./assets/images/prodBelleza.jfif",title:"Productos de Belleza",description:"Descubre nuestra l\xEDnea de productos de belleza y bienestar."},{image:"./assets/images/saludSex.jfif",title:"Salud Sexual y Bienestar",description:"Todo lo que necesitas para tu salud y bienestar \xEDntimo."}];activeSlideIndex=0;ngAfterViewInit(){let t=document.getElementById("carouselExampleIndicators");t&&t.addEventListener("slid.bs.carousel",e=>{this.activeSlideIndex=e.to})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-carousel"]],decls:7,vars:1,consts:[["id","carouselExampleIndicators","data-bs-ride","carousel",1,"carousel","slide","mt-6","mx-auto"],[1,"carousel-inner","text-center"],["class","carousel-item",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],["type","button","data-bs-target","#carouselExampleIndicators","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"carousel-item"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6"],[1,"card","custom-carousel-card"],[1,"card-img-top","custom-carousel-image",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"carousel-indicators"],["type","button","data-bs-target","#carouselExampleIndicators",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExampleIndicators"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1),N(2,Xv,13,7,"div",2),s(),l(3,"button",3),y(4,"span",4),s(),l(5,"button",5),y(6,"span",6),s()()),e&2&&(c(2),p("ngForOf",n.carouselItems))},dependencies:[Ae,We],styles:[".carousel[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto;padding-top:50px}.mt-6[_ngcontent-%COMP%]{margin-top:4rem}.carousel-inner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;overflow:hidden}.carousel-item[_ngcontent-%COMP%]{margin-right:0;backface-visibility:hidden;transition:transform .6s ease-in-out}.custom-carousel-card[_ngcontent-%COMP%]{width:100%;max-width:800px;margin:auto;border-radius:10px;overflow:hidden;box-shadow:0 4px 6px #0003;background-color:#007bff;color:#fff}.custom-carousel-image[_ngcontent-%COMP%]{width:100%;object-fit:cover}.carousel-control-prev[_ngcontent-%COMP%], .carousel-control-next[_ngcontent-%COMP%]{filter:invert(100%);width:6%;opacity:.8;transition:all .3s ease-in-out}.carousel-control-prev[_ngcontent-%COMP%]{left:8rem}.carousel-control-next[_ngcontent-%COMP%]{right:8rem}.carousel-control-prev[_ngcontent-%COMP%]:hover, .carousel-control-next[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.2)}.card-body[_ngcontent-%COMP%]{padding:5px}.card-text[_ngcontent-%COMP%]{margin-bottom:0}.carousel-indicators[_ngcontent-%COMP%]{position:relative;bottom:-10px;margin-top:0;display:flex;justify-content:center;align-items:center}.carousel-indicators[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background-color:#00000080;border:none;margin:10px;transition:background-color .3s ease-in-out}.carousel-indicators[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{background-color:#007bff;width:14px;height:14px}"]})};function Kv(i,t){i&1&&y(0,"img",5)}var rl=class i{constructor(t,e){this.authService=t;this.cdRef=e}ngOnInit(){this.authService.isEditProfileVisible.subscribe(()=>{this.cdRef.detectChanges()})}isLoginVisible(){return this.authService.isLoginVisible.value}static \u0275fac=function(e){return new(e||i)(te(qt),te(Wt))};static \u0275cmp=Te({type:i,selectors:[["app-home"]],decls:8,vars:1,consts:[[1,"home-container"],["src","assets/images/farmBienLogo.png","alt","Imagen Home","class","home-image",4,"ngIf"],[1,"text-container"],[1,"text-2xl","font-bold"],[1,"mt-1"],["src","assets/images/farmBienLogo.png","alt","Imagen Home",1,"home-image"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,Kv,1,0,"img",1),l(2,"div",2)(3,"h2",3),d(4,"Bienvenido a Farmacias del Bienestar"),s(),l(5,"p",4),d(6,"Encuentra los mejores productos y consultorio m\xE9dico."),s()()(),y(7,"app-carousel")),e&2&&(c(),p("ngIf",!n.authService.isLoginVisible.value&&!n.authService.isEditProfileVisible.value))},dependencies:[Ae,Be,nl],styles:[".home-container[_ngcontent-%COMP%]{position:relative;z-index:10;text-align:left;padding:0;margin-top:0}.text-container[_ngcontent-%COMP%]{position:absolute;text-align:left;max-width:600px;margin-left:40px}.home-image[_ngcontent-%COMP%]{position:absolute;top:10px;right:20px!important;width:150px;height:auto}"]})};var sl=hi(ki());var al=hi(ki());function Yv(i,t){if(i&1&&(l(0,"option",6),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}var ol=class i{constructor(t,e){this.farmaciaService=t;this.http=e}farmacias=[];farmaciaSeleccionada="";farmaciaConfirmada=new Yt;ngOnInit(){let t=localStorage.getItem("token");this.farmaciaService.obtenerFarmacias().subscribe({next:e=>this.farmacias=e,error:()=>al.default.fire("Error","No se pudieron cargar las farmacias","error")})}confirmar(){if(!this.farmaciaSeleccionada){al.default.fire({icon:"error",title:"Selecci\xF3n de Farmacia",text:"\xA1Por favor, selecciona una farmacia para continuar!"});return}let t=this.farmacias.find(n=>n._id===this.farmaciaSeleccionada);if(!t){console.error("Farmacia no encontrada");return}let e={_id:t._id,nombre:t.nombre,direccion:t.direccion,telefono:t.telefono};localStorage.setItem("user_farmacia",JSON.stringify(e)),this.farmaciaConfirmada.emit(e),al.default.fire({icon:"success",title:"Inicio de sesi\xF3n exitoso",text:"Bienvenido, administrador",timer:1e3,showConfirmButton:!1})}static \u0275fac=function(e){return new(e||i)(te(Zt),te(dt))};static \u0275cmp=Te({type:i,selectors:[["app-farmacia-selector"]],outputs:{farmaciaConfirmada:"farmaciaConfirmada"},decls:10,vars:2,consts:[[1,"modal-overlay"],[1,"modal-content"],[1,"selectPharma",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"mt-3","login-logout-button",3,"click"],[3,"value"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h4"),d(3,"Selecciona una farmacia"),s(),l(4,"select",2),Z("ngModelChange",function(a){return J(n.farmaciaSeleccionada,a)||(n.farmaciaSeleccionada=a),a}),l(5,"option",3),d(6,"-- Elige una farmacia --"),s(),N(7,Yv,2,2,"option",4),s(),l(8,"button",5),E("click",function(){return n.confirmar()}),d(9,"Confirmar"),s()()()),e&2&&(c(4),Q("ngModel",n.farmaciaSeleccionada),c(3),p("ngForOf",n.farmacias))},dependencies:[Ae,We,rt,it,nt,tt,ze,_t],styles:[".modal-overlay[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding-top:20px;padding-bottom:20px}.modal-content[_ngcontent-%COMP%]{padding:8px;background:#f1fbfb;border-radius:5px;box-shadow:-6px 0 6px #1303fa33;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.selectPharma[_ngcontent-%COMP%]{border-radius:5px;width:90%;height:32px;color:#00f}"]})};var Qv=i=>({"-webkit-text-security":i});function Jv(i,t){if(i&1){let e=ie();l(0,"form",6),E("ngSubmit",function(){T(e);let r=_();return P(r.onSubmit())}),l(1,"div",7),y(2,"input",8),s(),l(3,"div",7),y(4,"input",9),l(5,"button",10),E("click",function(){T(e);let r=_();return P(r.toggleMostrarPassword())}),y(6,"fa-icon",11),s()(),l(7,"button",12),d(8,"Iniciar"),s()()}if(i&2){let e=_();p("formGroup",e.loginForm),c(4),p("type","text")("ngStyle",gi(5,Qv,e.mostrarPassword?"none":"disc")),c(2),p("icon",e.mostrarPassword?"eye-slash":"eye"),c(),p("disabled",e.loginForm.invalid)}}function Zv(i,t){if(i&1){let e=ie();l(0,"app-farmacia-selector",13),E("farmaciaConfirmada",function(r){T(e);let a=_();return P(a.onFarmaciaConfirmada(r))}),s()}}var Ba=class i{constructor(t,e,n,r,a,o){this.fb=t;this.http=e;this.authService=n;this.router=r;this.cdr=a;this.library=o;o.addIcons(ef,Ma),this.loginForm=this.fb.group({usuario:["",Pe.required],password:["",Pe.required]})}loginForm;errorMessage="";showFarmaciaSelector=!1;farmaciaSubject;mostrarPassword=!1;farmaciaId="";closeLogin(){this.authService.hideLogin(),this.cdr.detectChanges()}onSubmit(){if(!this.loginForm.valid){this.showErrorAlert("Por favor, completa todos los campos correctamente.");return}let{usuario:t,password:e}=this.loginForm.value,n=r=>{this.authService.login(t,e,r).subscribe({next:a=>{a&&a.token&&a.user?(this.authService.setUserData(a.token,a.user.nombre,a.user.rol,a.user.email,a.user.farmacia,a.user.telefono,a.user.domicilio),a.user.rol==="admin"?this.showFarmaciaSelector=!0:(this.farmaciaId=a.user.farmacia?._id||"",this.verificarCorteActivoYRedirigir())):this.showErrorAlert("Respuesta del servidor no v\xE1lida")},error:a=>Le(this,null,function*(){if(a?.status===401&&a?.error?.requiereFirma){let{value:u}=yield sl.default.fire({title:"Autorizaci\xF3n requerida",input:"password",inputLabel:"Firma de la farmacia",inputPlaceholder:"Ingresa la firma",inputAttributes:{autocapitalize:"off",autocorrect:"off"},showCancelButton:!0,confirmButtonText:"Autorizar",cancelButtonText:"Cancelar"});if(!u)return;n(u);return}console.error("\u274C Error en login:",a),this.showErrorAlert(a?.error?.mensaje||"Error en autenticaci\xF3n")})})};n()}onFarmaciaConfirmada(t){this.authService.setFarmacia(t),this.showFarmaciaSelector=!1,this.farmaciaId=t._id,this.verificarCorteActivoYRedirigir()}toggleMostrarPassword(){this.mostrarPassword=!this.mostrarPassword}showErrorAlert(t){sl.default.fire({icon:"error",title:"Error en el inicio de sesi\xF3n",text:t,confirmButtonText:"Intentar de nuevo"})}verificarCorteActivoYRedirigir(){let t=JSON.parse(localStorage.getItem("usuario")||"null"),e=localStorage.getItem("auth_token");if(!t||!t.id||!t.rol){console.error("Usuario no v\xE1lido en localStorage"),this.router.navigate(["/home"]);return}let n=new qe({"x-auth-token":e||""});this.http.get(`${Ge.apiUrl}/cortes/activo/${t.id}/${this.farmaciaId}`,{headers:n}).subscribe({next:r=>{if(r?.corte){localStorage.setItem("corte_activo",r.corte._id);let a=new Date(r.corte.fechaInicio).toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),o=Number(r.corte.efectivoInicial||0).toFixed(2),u=r.corte.saldoInicialRecargas!==void 0?`<p><strong>Saldo inicial recargas:</strong> $${Number(r.corte.saldoInicialRecargas).toFixed(2)}</p>`:"";sl.default.fire({title:"Turno ya activo",html:`
              <p>Ya tienes un turno abierto.</p>
              <p><strong>Inicio:</strong> ${a}</p>
              <p><strong>Efectivo inicial:</strong> $${o}</p>
              ${u}
            `,icon:"info",timer:2e3,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.authService.hideLogin(),this.router.navigate(["/home"])})}else localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])},error:r=>{console.error("Error al verificar corte activo:",r),localStorage.removeItem("corte_activo"),this.authService.hideLogin(),this.router.navigate(["/inicio-turno"])}})}static \u0275fac=function(e){return new(e||i)(te(Jt),te(dt),te(qt),te(Qi),te(Wt),te(bi))};static \u0275cmp=Te({type:i,selectors:[["app-login"]],decls:9,vars:2,consts:[[1,"login-overlay"],[1,"login-container"],[1,"close-button",3,"click"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"login-image"],["class","login-form",3,"formGroup","ngSubmit",4,"ngIf"],[3,"farmaciaConfirmada",4,"ngIf"],[1,"login-form",3,"ngSubmit","formGroup"],[1,"input-group"],["formControlName","usuario","placeholder","Usuario","required","","autocomplete","off","spellcheck","false","autocapitalize","off",1,"form-control"],["formControlName","password","placeholder","Contrase\xF1a","autocomplete","new-password","spellcheck","false","autocapitalize","off","required","",1,"form-control",3,"type","ngStyle"],["type","button","tabindex","-1","title","Mostrar/Ocultar contrase\xF1a",1,"btn-gris",3,"click"],[3,"icon"],["type","submit",1,"login-logout-button","mb-3","mt-3",3,"disabled"],[3,"farmaciaConfirmada"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),E("click",function(){return n.closeLogin()}),d(3,"\u2716"),s(),y(4,"img",3),l(5,"h2"),d(6,"Iniciar sesi\xF3n"),s(),N(7,Jv,9,7,"form",4)(8,Zv,1,0,"app-farmacia-selector",5),s()()),e&2&&(c(7),p("ngIf",!n.showFarmaciaSelector),c(),p("ngIf",n.showFarmaciaSelector))},dependencies:[Bt,Ft,Xe,ze,Mt,ka,ci,di,Ae,Be,Ta,ol,ti,ei],styles:[".login-overlay[_ngcontent-%COMP%]{position:absolute;top:80px;right:0;width:100%;height:calc(100vh - 80px);background:#00000080;display:flex;justify-content:flex-end;align-items:center;z-index:1050}.login-container[_ngcontent-%COMP%]{width:350px;background:#fff;padding:0;border-radius:10px;box-shadow:-4px 0 6px #0003;display:flex;flex-direction:column;align-items:center;max-height:95vh;overflow-y:auto;position:relative;margin-right:1px}.login-image[_ngcontent-%COMP%]{width:80%;max-height:120px;object-fit:contain;margin-bottom:10px;margin-top:20px}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;font-weight:700;cursor:pointer;color:#333}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;margin-top:2rem}.input-group[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:center;margin-bottom:2rem}"]})};var er=class i{nombreFarmacia;direccion;telefono;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-ticket-header"]],inputs:{nombreFarmacia:"nombreFarmacia",direccion:"direccion",telefono:"telefono"},decls:15,vars:3,consts:[[1,"lineBottom"],[1,"encabezado-flex"],["src","assets/images/farmBienIcon.png","alt","Logo",1,"logo","logo-ticket"],[2,"font-size","large"],[2,"font-size","large","margin-left","70px"],[1,"datos-farmacia",2,"font-size","16px"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1),y(2,"img",2),l(3,"div")(4,"span",3),d(5,"FARMACIAS DEL BIENESTAR"),s(),y(6,"br"),l(7,"span",4),d(8,"PARA TODOS"),s()()(),l(9,"div",5),d(10),y(11,"br"),d(12),y(13,"br"),d(14),s()()),e&2&&(c(10),R(" Sucursal: ",n.nombreFarmacia,""),c(2),R(" ",n.direccion,""),c(2),R(" Tel\xE9fono: ",n.telefono," "))},dependencies:[Ae],styles:[".encabezado-flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}.logo[_ngcontent-%COMP%]{width:40px;height:auto;margin-right:30px}.datos-farmacia[_ngcontent-%COMP%]{font-size:16px;line-height:1.3;margin-top:4px;text-align:center}"]})};var tr=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-ticket-footer"]],decls:5,vars:0,consts:[[1,"mensaje-final",2,"font-style","oblique","font-size","18px"]],template:function(e,n){e&1&&(l(0,"div",0),d(1," \xA1Gracias por su preferencia!"),y(2,"br"),d(3," Bienestar para todos"),y(4,"br"),s())},styles:[".mensaje-final[_ngcontent-%COMP%]{text-align:center;margin-top:10px;font-weight:700}"]})};function ex(i,t){if(i&1&&(l(0,"td",24),d(1),s()),i&2){let e=_().$implicit;c(),R("Desc. ",e.cadenaDescuento,"")}}function tx(i,t){if(i&1&&(l(0,"td",25)(1,"strong"),d(2),F(3,"number"),s()()),i&2){let e=_().$implicit;c(2),R("$",Y(3,1,e.descuento,"1.2-2"),"")}}function ix(i,t){if(i&1&&(at(0,17),l(1,"tr")(2,"td",7)(3,"span",18),d(4),s()()(),l(5,"tr")(6,"td"),d(7),F(8,"number"),s(),l(9,"td"),d(10),s(),l(11,"td",19)(12,"span",20),d(13),s()(),l(14,"td",21),d(15),F(16,"number"),s()(),l(17,"tr"),N(18,ex,2,1,"td",22)(19,tx,4,4,"td",23),s(),ot()),i&2){let e=t.$implicit;c(4),R(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),c(3),R("$",Y(8,7,e.precioOriginal,"1.2-2"),""),c(3),k(e.cantidad),c(3),R(" ",e.descuento>0?e.tipoDescuento:""," "),c(2),R("$",Y(16,10,e.precioOriginal*e.cantidad,"1.2-2"),""),c(3),p("ngIf",e.cadenaDescuento!=""),c(),p("ngIf",e.descuento>0)}}function nx(i,t){if(i&1&&(l(0,"div",26),d(1,"Felicidades!!! usted us\xF3 su monedero: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.venta.formaPago.vale,"1.2-2"),"")}}function rx(i,t){if(i&1&&(l(0,"div"),d(1,"Usted ahorr\xF3: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.venta.totalDescuento,"1.2-2"),"")}}function ax(i,t){if(i&1&&(l(0,"div"),d(1,"Abon\xF3 a su monedero: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.venta.totalMonederoCliente,"1.2-2"),"")}}function ox(i,t){if(i&1&&(l(0,"div"),d(1,"Su monedero ahora cuenta con: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.venta.AsiQuedaMonedero,"1.2-2"),"")}}var ll=class i{venta;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-venta-ticket"]],inputs:{venta:"venta"},decls:53,vars:24,consts:[[1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono"],[1,"productos","lineBottom"],[1,"col-unit"],[1,"col-cant"],[1,"col-promo"],[1,"col-importe"],["colspan","4"],[1,"lineBottom"],[1,"th-promo"],["style","font-size: 16px;",4,"ngFor","ngForOf"],[1,"totales-line","lineBottom"],[1,"totales"],["class","text-right",4,"ngIf"],[4,"ngIf"],[1,"info-general","lineBottom"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"producto-nombre"],[1,"promo-cell"],[1,"promo-value"],[1,"importe-cell"],["colspan","3",4,"ngIf"],["colspan","1","class","text-right",4,"ngIf"],["colspan","3"],["colspan","1",1,"text-right"],[1,"text-right"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"table",2)(3,"colgroup"),y(4,"col",3)(5,"col",4)(6,"col",5)(7,"col",6),s(),l(8,"thead")(9,"tr")(10,"th",7),d(11,"PRODUCTO"),s()(),l(12,"tr",8)(13,"th"),d(14,"P.U."),s(),l(15,"th"),d(16,"CAN"),s(),l(17,"th",9),d(18,"PROMO"),s(),l(19,"th"),d(20,"IMPORTE"),s()()(),l(21,"tbody"),N(22,ix,20,13,"ng-container",10),s()(),l(23,"div",11)(24,"div"),d(25,"Cantidad de productos: "),l(26,"strong"),d(27),s()(),l(28,"div"),d(29,"Total: "),l(30,"strong"),d(31),F(32,"number"),s()()(),l(33,"div",12)(34,"div"),d(35,"Cambio: "),l(36,"strong"),d(37),F(38,"number"),s()(),N(39,nx,5,4,"div",13)(40,rx,5,4,"div",14)(41,ax,5,4,"div",14)(42,ox,5,4,"div",14),s(),l(43,"div",15)(44,"div",16),d(45),s(),d(46),F(47,"date"),y(48,"br"),d(49),y(50,"br"),d(51),s(),y(52,"app-ticket-footer"),s()),e&2&&(c(),p("nombreFarmacia",n.venta.farmacia.nombre)("direccion",n.venta.farmacia.direccion)("telefono",n.venta.farmacia.telefono),c(21),p("ngForOf",n.venta.productos),c(5),k(n.venta.cantidadProductos),c(4),R("$",Y(32,15,n.venta.total,"1.2-2"),""),c(6),R("$",Y(38,18,n.venta.elcambio,"1.2-2"),""),c(2),p("ngIf",n.venta.formaPago.vale),c(),p("ngIf",n.venta.totalDescuento>0),c(),p("ngIf",n.venta.totalMonederoCliente>0&&n.venta.cliente),c(),p("ngIf",n.venta.AsiQuedaMonedero>0&&n.venta.cliente),c(3),R("Folio: ",n.venta.folio,""),c(),R(" Fecha: ",Y(47,21,n.venta.fecha,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",n.venta.usuario,""),c(2),R(" Cliente: ",n.venta.cliente||"P\xFAblico general"," "))},dependencies:[Ae,We,Be,Ct,Rt,er,tr],styles:[".totales[_ngcontent-%COMP%]{font-size:17px!important;line-height:1.5}.totales[_ngcontent-%COMP%]{text-align:end}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}.productos[_ngcontent-%COMP%]{width:100%;table-layout:fixed;border-collapse:collapse}.productos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1px 0;font-size:17px}.col-unit[_ngcontent-%COMP%]{width:24%}.col-cant[_ngcontent-%COMP%]{width:12%}.col-promo[_ngcontent-%COMP%]{width:36%}.col-importe[_ngcontent-%COMP%]{width:28%}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){text-align:left}.productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){text-align:left}.promo-cell[_ngcontent-%COMP%]{text-align:right;padding-right:0}.importe-cell[_ngcontent-%COMP%]{text-align:right;padding-left:0}.th-promo[_ngcontent-%COMP%]{text-align:right}.promo-value[_ngcontent-%COMP%]{display:inline-block;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:clip;font-size:16px;letter-spacing:-.2px}.totales-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;font-size:17px;margin-top:2px}.text-right[_ngcontent-%COMP%]{text-align:right!important}"]})};var rp={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var dx=["panel"],ux=["*"];function mx(i,t){if(i&1&&(l(0,"div",1,0),km(2),s()),i&2){let e=t.id,n=_();Rs(n._classList),Re("mat-mdc-autocomplete-visible",n.showPanel)("mat-mdc-autocomplete-hidden",!n.showPanel)("mat-autocomplete-panel-animations-enabled",!n._animationsDisabled)("mat-primary",n._color==="primary")("mat-accent",n._color==="accent")("mat-warn",n._color==="warn"),p("id",n.id),Je("aria-label",n.ariaLabel||null)("aria-labelledby",n._getPanelAriaLabelledby(e))}}var C0=class{source;option;constructor(t,e){this.source=t,this.option=e}},sp=new Sr("mat-autocomplete-default-options",{providedIn:"root",factory:fx});function fx(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1}}var cl=(()=>{class i{_changeDetectorRef=je(Wt);_elementRef=je(Io);_defaults=je(sp);_animationsDisabled=je(Mo,{optional:!0})==="NoopAnimations";_activeOptionChanges=Gn.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new Yt;opened=new Yt;closed=new Yt;optionActivated=new Yt;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=je(wf).getId("mat-autocomplete-");inertGroups;constructor(){let e=je(yf);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new Ef(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let n=new C0(this,e);this.optionSelected.emit(n)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let n=e?e+" ":"";return this.ariaLabelledby?n+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Te({type:i,selectors:[["mat-autocomplete"]],contentQueries:function(n,r,a){if(n&1&&(h0(a,Aa,5),h0(a,Pf,5)),n&2){let o;St(o=wt())&&(r.options=o),St(o=wt())&&(r.optionGroups=o)}},viewQuery:function(n,r){if(n&1&&(Ot(f0,7),Ot(dx,5)),n&2){let a;St(a=wt())&&(r.template=a.first),St(a=wt())&&(r.panel=a.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",mr],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",mr],requireSelection:[2,"requireSelection","requireSelection",mr],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",mr],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",mr]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[Kr([{provide:Tf,useExisting:i}])],ngContentSelectors:ux,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(n,r){n&1&&(Pm(),N(0,mx,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return i})();var px={provide:Lm,useExisting:Cm(()=>Qr),multi:!0};var lp=new Sr("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let i=je(Oa);return()=>i.scrollStrategies.reposition()}});function hx(i){return()=>i.scrollStrategies.reposition()}var gx={provide:lp,deps:[Oa],useFactory:hx},Qr=(()=>{class i{_environmentInjector=je(Sm);_element=je(Io);_overlay=je(Oa);_viewContainerRef=je(Os);_zone=je(Yi);_changeDetectorRef=je(Wt);_dir=je(Ks,{optional:!0});_formField=je(Nf,{optional:!0,host:!0});_viewportRuler=je(Ys);_scrollStrategy=je(lp);_renderer=je(wa);_defaults=je(sp,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new yt;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=Gn.EMPTY;_breakpointObserver=je(_0);_handsetLandscapeSubscription=Gn.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new yt;_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&Xs(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return zr(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe($r(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe($r(()=>this._overlayAttached)):lt()).pipe(xt(e=>e instanceof kf?e:null))}optionSelections=_m(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(Gr(e),Ui(()=>zr(...e.map(n=>n.onSelectionChange)))):this._initialized.pipe(Ui(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new qn(e=>{let n=a=>{let o=Yr(a),u=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,m=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&o!==this._element.nativeElement&&!this._hasFocus()&&(!u||!u.contains(o))&&(!m||!m.contains(o))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(o)&&e.next(a)},r=[this._renderer.listen("document","click",n),this._renderer.listen("document","auxclick",n),this._renderer.listen("document","touchend",n)];return()=>{r.forEach(a=>a())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let n=e.keyCode,r=qs(e);if(n===27&&!r&&e.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&n===13&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){let a=this.autocomplete._keyManager.activeItem,o=n===38||n===40;n===9||o&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):o&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(o||this.autocomplete._keyManager.activeItem!==a)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let n=e.target,r=n.value;if(n.type==="number"&&(r=r==""?null:parseFloat(r)),this._previousValue!==r){if(this._previousValue=r,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(r),!r)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let a=this.autocomplete.options?.find(o=>o.selected);if(a){let o=this._getDisplayValue(a.value);r!==o&&a.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let a=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(a)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return bf()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new qn(r=>{As(()=>{r.next()},{injector:this._environmentInjector})}),n=this.autocomplete.options?.changes.pipe(mn(()=>this._positionStrategy.reapplyLastPosition()),bm(0))??lt();return zr(e,n).pipe(Ui(()=>this._zone.run(()=>{let r=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),r!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),Ms(1)).subscribe(r=>this._setValueAndClose(r))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let n=this.autocomplete;return n&&n.displayWith?n.displayWith(e):e}_assignOptionValue(e){let n=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(n??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let n=this.autocomplete,r=e?e.source:this._pendingAutoselectedOption;r?(this._clearPreviousSelectedOption(r),this._assignOptionValue(r.value),this._onChange(r.value),n._emitSelectEvent(r),this._element.nativeElement.focus()):n.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,n){this.autocomplete?.options?.forEach(r=>{r!==e&&r.selected&&r.deselect(n)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let n=this.autocomplete.id;v0(this._trackedModal,"aria-owns",n)}}_attachOverlay(e){this.autocomplete;let n=this._overlayRef;n?(this._positionStrategy.setOrigin(this._getConnectedElement()),n.updateSize({width:this._getPanelWidth()})):(this._portal=new Af(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),n=this._overlay.create(this._getOverlayConfig()),this._overlayRef=n,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&n&&n.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(rp.HandsetLandscape).subscribe(a=>{a.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),n&&!n.hasAttached()&&(n.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let r=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&r!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!qs(e)||e.keyCode===38&&qs(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new Of({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){let e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let n=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,a=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}],o;this.position==="above"?o=a:this.position==="below"?o=n:o=[...n,...a],e.withPositions(o)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let n=-1;for(let r=0;r<e.options.length;r++)if(!e.options.get(r).disabled){n=r;break}e._keyManager.setActiveItem(n)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let n=this.autocomplete,r=If(e,n.options,n.optionGroups);if(e===0&&r===1)n._setScrollTop(0);else if(n.panel){let a=n.options.toArray()[e];if(a){let o=a._getHostElement(),u=Mf(o.offsetTop,o.offsetHeight,n._getScrollTop(),n.panel.nativeElement.offsetHeight);n._setScrollTop(u)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let n=this.autocomplete.id;this._trackedModal&&Xs(this._trackedModal,"aria-owns",n),v0(e,"aria-owns",n),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;Xs(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ds({type:i,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(n,r){n&1&&E("focusin",function(){return r._handleFocus()})("blur",function(){return r._onTouched()})("input",function(o){return r._handleInput(o)})("keydown",function(o){return r._handleKeydown(o)})("click",function(){return r._handleClick()}),n&2&&Je("autocomplete",r.autocompleteAttribute)("role",r.autocompleteDisabled?null:"combobox")("aria-autocomplete",r.autocompleteDisabled?null:"list")("aria-activedescendant",r.panelOpen&&r.activeOption?r.activeOption.id:null)("aria-expanded",r.autocompleteDisabled?null:r.panelOpen.toString())("aria-controls",r.autocompleteDisabled||!r.panelOpen||r.autocomplete==null?null:r.autocomplete.id)("aria-haspopup",r.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",mr]},exportAs:["matAutocompleteTrigger"],features:[Kr([px]),ya]})}return i})(),La=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ao({type:i});static \u0275inj=ko({providers:[gx],imports:[Df,b0,x0,Qs,b0,x0]})}return i})();var vi=hi(ki());var dl=class i{constructor(t){this.http=t}apiUrl=`${Ge.apiUrl}/ventas`;crearVenta(t){let e=localStorage.getItem("auth_token"),n=new qe({"Content-Type":"application/json","x-auth-token":e||""});return this.http.post(`${this.apiUrl}`,t,{headers:n})}obtenerHistorialCompras(t,e){let n=localStorage.getItem("auth_token");if(!n)return console.error("\u274C No hay token disponible."),new qn(a=>a.next([]));let r=new qe({"x-auth-token":n});return this.http.get(`${this.apiUrl}/historial/${t}/${e}`,{headers:r})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var Zi=class i{constructor(t){this.http=t}apiUrl=`${Ge.apiUrl}/productos`;imgCache=new Map;revoked=[];crearProducto(t){return this.http.post(`${Ge.apiUrl}/productos`,t)}buscarPorCodigoBarras(t){let e=localStorage.getItem("auth_token")||"",n=new qe({"x-auth-token":e}),r=new Ht().set("codigoBarras",t);return this.http.get(`${this.apiUrl}/buscar-por-cb`,{params:r,headers:n})}obtenerProductos(){return this.http.get(`${this.apiUrl}`)}consultarPrecioPorCodigo(t,e){return this.http.get(`${this.apiUrl}/precio/${t}/${e}`)}existenciaPorId(t){return this.http.get(`${this.apiUrl}/ver-existencia/${t}`)}existenciaPorFarmaciaYProducto(t,e){return this.http.get(`${this.apiUrl}/inventario/${t}/${e}`)}actualizarProductos(t){return this.http.put(`${this.apiUrl}/actualizar-masivo`,t)}actualizarProductoIndividual(t,e){return this.http.put(`${this.apiUrl}/actualizar-producto/${t}`,e)}obtenerProductoPorId(t){return this.http.get(`${this.apiUrl}/${t}`)}buscar(t,e=12){let n=new Ht().set("q",t).set("limit",e);return this.http.get(`${this.apiUrl}/search`,{params:n})}eliminarProducto(t){return this.http.delete(`${this.apiUrl}/${t}`)}actualizarImagenProducto(t,e){let n=new FormData;return n.append("imagen",e),this.http.put(`${this.apiUrl}/${t}/imagen`,n)}obtenerImagenProductoUrl(t){return`${this.apiUrl}/${t}/imagen`}getImagenObjectUrl(t){let e=this.imgCache.get(t);return e?lt(e):this.http.get(`${this.apiUrl}/${t}/imagen`,{responseType:"blob"}).pipe(xt(n=>URL.createObjectURL(n)),mn(n=>this.imgCache.set(t,n)),Pi(()=>lt("")))}clearImagenFromCache(t){let e=this.imgCache.get(t);e&&(URL.revokeObjectURL(e),this.imgCache.delete(t))}ngOnDestroy(){for(let[,t]of this.imgCache)URL.revokeObjectURL(t);this.imgCache.clear()}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ua=class i{clavePausadas="ventas_pausadas";setVentasPausadas(t){localStorage.setItem(this.clavePausadas,JSON.stringify(t))}getVentasPausadas(){let t=localStorage.getItem(this.clavePausadas);return t?JSON.parse(t):[]}limpiarVentasPausadas(){localStorage.removeItem(this.clavePausadas)}existenVentasPausadas(){return this.getVentasPausadas().length>0}static \u0275fac=function(e){return new(e||i)};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var xx=["codigoBarrasRef"],bx=["efectivoRecibidoRef"],yx=["cliTrigger"];function Cx(i,t){if(i&1&&(l(0,"option",64),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e),c(),R("",e,"\xD7")}}function Sx(i,t){if(i&1&&(l(0,"small"),d(1),s()),i&2){let e=_().$implicit;c(),R(" \u2014 ",e.telefono,"")}}function wx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),N(2,Sx,2,1,"small",21),s()),i&2){let e=t.$implicit;p("value",e),c(),R(" ",e.nombre," "),c(),p("ngIf",e.telefono)}}function Ex(i,t){i&1&&(l(0,"mat-option"),d(1," Sin coincidencias "),s())}function Tx(i,t){if(i&1&&y(0,"option",65),i&2){let e=t.$implicit;p("value",e.nombre+(e.telefono?" \u2014 "+e.telefono:""))}}function Px(i,t){if(i&1){let e=ie();l(0,"button",66),E("click",function(){T(e);let r=_();return P(r.limpiarCliente())}),y(1,"fa-icon",67),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function kx(i,t){if(i&1&&(l(0,"span",68),d(1),s()),i&2){let e=_();c(),k(e.nombreCliente)}}function Ix(i,t){if(i&1){let e=ie();l(0,"div",16)(1,"input",69),Z("ngModelChange",function(r){T(e);let a=_();return J(a.aplicaInapam,r)||(a.aplicaInapam=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return r.yaPreguntoInapam=!0,P(r.VerSiPreguntaINAPAM())}),s(),l(2,"label",70),d(3,"Presenta cred. INAPAM"),s()()}if(i&2){let e=_();c(),Q("ngModel",e.aplicaInapam)}}function Mx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),fn(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function Fx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),R(" ",e.nombre," ")}}function Ax(i,t){if(i&1&&(l(0,"div",82)(1,"strong"),d(2,"Ubicaci\xF3n:"),s(),l(3,"div"),d(4),s()()),i&2){let e=_(3);c(4),R(" ",e.productoConsultado.ubicacionEnFarmacia," ")}}function Ox(i,t){if(i&1){let e=ie();l(0,"div",78)(1,"div",79)(2,"img",80),E("error",function(){T(e);let r=_(2);return P(r.consultaImgUrl=r.placeholderSrc)}),s()(),N(3,Ax,5,1,"div",81),s()}if(i&2){let e=_(2);c(2),p("src",e.consultaImgUrl,qr),c(),p("ngIf",e.productoConsultado)}}function Dx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e.codigoBarras),c(),fn(" ",e.codigoBarras," \u2014 ",e.nombre," ")}}function Rx(i,t){if(i&1&&(l(0,"mat-option",65),d(1),s()),i&2){let e=t.$implicit;p("value",e.codigoBarras),c(),R(" ",e.nombre," ")}}function Nx(i,t){if(i&1){let e=ie();l(0,"div")(1,"mat-form-field",83)(2,"input",84),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.busquedaConsultaCodigo,r)||(a.busquedaConsultaCodigo=r),P(r)}),E("input",function(){T(e);let r=_(2);return P(r.filtrarConsultaPorCodigo())}),s(),l(3,"mat-autocomplete",85,5),E("optionSelected",function(r){T(e);let a=_(2);return P(a.onSelectConsultaCodigo(r))}),N(5,Dx,2,3,"mat-option",20),s()(),l(6,"mat-form-field",83)(7,"input",86),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.busquedaConsultaNombre,r)||(a.busquedaConsultaNombre=r),P(r)}),E("input",function(){T(e);let r=_(2);return P(r.filtrarConsultaPorNombre())}),s(),l(8,"mat-autocomplete",85,6),E("optionSelected",function(r){T(e);let a=_(2);return P(a.onSelectConsultaNombre(r))}),N(10,Rx,2,2,"mat-option",20),s()()()}if(i&2){let e=$t(4),n=$t(9),r=_(2);c(2),Q("ngModel",r.busquedaConsultaCodigo),p("matAutocomplete",e),c(3),p("ngForOf",r.productosConsultaFiltradosPorCodigo),c(2),Q("ngModel",r.busquedaConsultaNombre),p("matAutocomplete",n),c(3),p("ngForOf",r.productosConsultaFiltradosPorNombre)}}function Bx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo1),c(),k(e.productoConsultado.precioLunes)}}function Lx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.lunesMasInapam)}}function Vx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo2),c(),k(e.productoConsultado.precioMartes)}}function Ux(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.martesMasInapam)}}function jx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo3),c(),k(e.productoConsultado.precioMiercoles)}}function Wx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.miercolesMasInapam)}}function Hx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo4),c(),k(e.productoConsultado.precioJueves)}}function zx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.juevesMasInapam)}}function $x(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo5),c(),k(e.productoConsultado.precioViernes)}}function Gx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.viernesMasInapam)}}function qx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo6),c(),k(e.productoConsultado.precioSabado)}}function Xx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.sabadoMasInapam)}}function Kx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2),s(),d(3),s()),i&2){let e=_(3);c(2),k(e.productoConsultado.promo0),c(),k(e.productoConsultado.precioDomingo)}}function Yx(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.domingoMasInapam)}}function Qx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Promo: "),s(),d(3),s()),i&2){let e=_(3);c(3),k(e.productoConsultado.promo)}}function Jx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio c/promo: "),s(),d(3),s()),i&2){let e=_(3);c(3),k(e.productoConsultado.precioConDescuento)}}function Zx(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio promo + inapam: "),s(),d(3),s()),i&2){let e=_(3);c(3),k(e.productoConsultado.precioDescuentoMasInapam)}}function e2(i,t){if(i&1&&(l(0,"p")(1,"strong"),d(2,"Precio Inapam: "),s(),d(3),s()),i&2){let e=_(3);c(3),R("",e.productoConsultado.precioInapam," ")}}function t2(i,t){if(i&1&&(l(0,"p"),d(1),s()),i&2){let e=_(3);c(),k(e.productoConsultado.promoCliente)}}function i2(i,t){if(i&1&&(l(0,"div")(1,"p")(2,"strong"),d(3,"Nombre: "),s(),d(4),s(),l(5,"p")(6,"strong"),d(7,"Precio Normal:"),s(),d(8),F(9,"currency"),s(),N(10,Bx,4,2,"p",21)(11,Lx,2,1,"p",21)(12,Vx,4,2,"p",21)(13,Ux,2,1,"p",21)(14,jx,4,2,"p",21)(15,Wx,2,1,"p",21)(16,Hx,4,2,"p",21)(17,zx,2,1,"p",21)(18,$x,4,2,"p",21)(19,Gx,2,1,"p",21)(20,qx,4,2,"p",21)(21,Xx,2,1,"p",21)(22,Kx,4,2,"p",21)(23,Yx,2,1,"p",21)(24,Qx,4,1,"p",21)(25,Jx,4,1,"p",21)(26,Zx,4,1,"p",21)(27,e2,4,1,"p",21)(28,t2,2,1,"p",21),s()),i&2){let e=_(2);c(4),k(e.productoConsultado.nombre),c(4),R(" ",oe(9,21,e.productoConsultado.precioNormal),""),c(2),p("ngIf",e.productoConsultado.promo1),c(),p("ngIf",e.productoConsultado.lunesMasInapam),c(),p("ngIf",e.productoConsultado.promo2),c(),p("ngIf",e.productoConsultado.martesMasInapam),c(),p("ngIf",e.productoConsultado.promo3),c(),p("ngIf",e.productoConsultado.miercolesMasInapam),c(),p("ngIf",e.productoConsultado.promo4),c(),p("ngIf",e.productoConsultado.juevesMasInapam),c(),p("ngIf",e.productoConsultado.promo5),c(),p("ngIf",e.productoConsultado.viernesMasInapam),c(),p("ngIf",e.productoConsultado.promo6),c(),p("ngIf",e.productoConsultado.sabadoMasInapam),c(),p("ngIf",e.productoConsultado.promo0),c(),p("ngIf",e.productoConsultado.domingoMasInapam),c(),p("ngIf",e.productoConsultado.promo),c(),p("ngIf",e.productoConsultado.precioConDescuento),c(),p("ngIf",e.productoConsultado.precioDescuentoMasInapam),c(),p("ngIf",e.productoConsultado.precioInapam),c(),p("ngIf",e.productoConsultado.promoCliente)}}function n2(i,t){if(i&1){let e=ie();l(0,"div",71)(1,"div",72)(2,"h2"),d(3,"Consultar Precio"),s(),l(4,"div",73)(5,"input",74),Z("ngModelChange",function(r){T(e);let a=_();return J(a.codigoConsulta,r)||(a.codigoConsulta=r),P(r)}),E("keyup.enter",function(){T(e);let r=_();return P(r.consultarPrecio())}),s(),l(6,"button",75),E("click",function(){T(e);let r=_();return P(r.limpiarBarras())}),y(7,"fa-icon",67),s()(),N(8,Ox,4,2,"div",76)(9,Nx,11,6,"div",21)(10,i2,29,23,"div",21),l(11,"button",77),E("click",function(){T(e);let r=_();return P(r.cerrarModalConsultaPrecio())}),d(12,"Cerrar"),s()()()}if(i&2){let e=_();c(5),Q("ngModel",e.codigoConsulta),c(2),p("icon",e.faTimes),c(),p("ngIf",e.consultaEncontrado),c(),p("ngIf",!e.consultaEncontrado),c(),p("ngIf",e.productoConsultado)}}function r2(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td",44)(2,"div",87)(3,"button",88),E("click",function(){let r=T(e).index,a=_();return P(a.eliminarProducto(r))}),y(4,"i",40),s(),l(5,"button",89),E("click",function(){let r=T(e).index,a=_();return P(a.incrementarCantidad(r))}),y(6,"i",90),s(),l(7,"button",91),E("click",function(){let r=T(e).index,a=_();return P(a.decrementarCantidad(r))}),y(8,"i",92),s()()(),l(9,"td",45)(10,"div",93)(11,"button",94),E("click",function(){let r=T(e).$implicit,a=_();return P(a.openPreviewVenta(r))}),l(12,"img",95),E("error",function(r){let a=T(e).$implicit,o=_();return P(o.onThumbError(r,a))}),s()()()(),l(13,"td",46)(14,"div",96),d(15),s(),l(16,"small",97),d(17),s()(),l(18,"td"),d(19),s(),l(20,"td"),d(21),F(22,"currency"),s(),l(23,"td"),d(24),F(25,"currency"),s(),l(26,"td"),d(27),s(),l(28,"td"),d(29),s(),l(30,"td"),d(31),F(32,"currency"),s(),l(33,"td"),d(34),F(35,"currency"),s(),l(36,"td"),d(37),F(38,"currency"),s()()}if(i&2){let e=t.$implicit,n=_();c(3),Re("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(2),Re("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(2),Re("deshabilitado",e.esGratis),p("disabled",e.esGratis),c(5),p("src",n.thumbs[e.producto]||n.placeholderSrc,qr),c(3),k(e.nombre),c(2),k(e.ubicacionEnFarmacia),c(2),k(e.cantidad),c(2),k(oe(22,20,e.precioOriginal)),c(3),k(oe(25,22,e.precioOriginal*e.cantidad)),c(3),k(e.tipoDescuento!=="Ninguno"?e.tipoDescuento:"-"),c(2),k(e.cadDesc),c(2),k(oe(32,24,e.alMonedero*e.cantidad)),c(3),k(oe(35,26,e.descuentoUnitario*e.cantidad)),c(3),k(oe(38,28,e.precioFinal*e.cantidad))}}function a2(i,t){if(i&1){let e=ie();l(0,"div",98)(1,"button",99),E("click",function(){T(e);let r=_();return P(r.pausarVenta())}),d(2,"Pausar Venta"),s(),l(3,"button",100),E("click",function(){T(e);let r=_();return P(r.cancelarVenta())}),d(4,"Cancelar Venta"),s(),l(5,"button",101),E("click",function(){T(e);let r=_();return P(r.abrirModalPago())}),d(6,"Finalizar Venta"),s()()}}function o2(i,t){if(i&1){let e=ie();l(0,"button",104),E("click",function(){let r=T(e).index,a=_(2);return P(a.reanudarVenta(r))}),d(1),s()}if(i&2){let e=t.$implicit;c(),R(" ",e.captionButtomReanudar," ")}}function s2(i,t){if(i&1&&(l(0,"div",102)(1,"h2",34),d(2,"Ventas Pausadas"),s(),N(3,o2,2,1,"button",103),s()),i&2){let e=_();c(3),p("ngForOf",e.ventasPausadas)}}function l2(i,t){if(i&1&&(l(0,"div",110)(1,"label",135),d(2,"Monto monedero usado:"),s(),l(3,"div",136)(4,"span",137),d(5),F(6,"currency"),s()()()),i&2){let e=_(3);c(5),R(" ",oe(6,1,e.montoVale)," ")}}function c2(i,t){if(i&1){let e=ie();l(0,"div",127)(1,"div",110)(2,"label",128),d(3),F(4,"currency"),s()(),l(5,"div",110)(6,"div",129)(7,"label",130),d(8,"Usar monedero:"),s()(),l(9,"div",131)(10,"input",132),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.usarMonedero,r)||(a.usarMonedero=r),P(r)}),E("ngModelChange",function(){T(e);let r=_(2);return P(r.onToggleMonedero())}),s(),l(11,"label",133),d(12,"S\xED"),s()()(),N(13,l2,7,3,"div",134),s()}if(i&2){let e=_(2);c(3),R(" Tiene en monedero: ",oe(4,3,e.montoMonederoCliente)," "),c(7),Q("ngModel",e.usarMonedero),c(3),p("ngIf",e.usarMonedero)}}function d2(i,t){i&1&&(l(0,"p",138),d(1," A\xFAn falta cubrir el total de la venta. "),s())}function u2(i,t){i&1&&(l(0,"p",139),d(1," El total de la venta ha sido cubierto. "),s())}function m2(i,t){if(i&1){let e=ie();l(0,"button",140),E("click",function(){T(e);let r=_(2);return P(r.habilitarInputs())}),y(1,"i",141),d(2," Habilitar pagos "),s()}}function f2(i,t){if(i&1){let e=ie();l(0,"div",71)(1,"div",105)(2,"div",106)(3,"h5",107),d(4,"M\xE9todo de Pago"),s()(),l(5,"div",108)(6,"p",109),d(7,"Total a pagar: "),l(8,"strong"),d(9),F(10,"currency"),s()(),l(11,"div",110)(12,"label",111),d(13,"Efectivo:"),s(),l(14,"div",112)(15,"input",113,7),Z("ngModelChange",function(r){T(e);let a=_();return J(a.efectivoRecibido,r)||(a.efectivoRecibido=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return P(r.calculaCambio())}),s()()(),l(17,"div",110)(18,"label",114),d(19,"Tarjeta:"),s(),l(20,"div",112)(21,"input",115),Z("ngModelChange",function(r){T(e);let a=_();return J(a.montoTarjeta,r)||(a.montoTarjeta=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return P(r.pagoTarjeta())}),s()()(),l(22,"div",110)(23,"label",116),d(24,"Transferencia:"),s(),l(25,"div",112)(26,"input",117),Z("ngModelChange",function(r){T(e);let a=_();return J(a.montoTransferencia,r)||(a.montoTransferencia=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return P(r.pagoTransferencia())}),s()()(),N(27,c2,14,5,"div",118),l(28,"p",119),d(29,"Cambio: "),l(30,"strong"),d(31),F(32,"currency"),s()(),N(33,d2,2,0,"p",120)(34,u2,2,0,"p",121),s(),l(35,"div",122)(36,"button",123),E("click",function(){T(e);let r=_();return P(r.cancelarPago())}),d(37,"Cancelar"),s(),l(38,"button",124),d(39," Imprimir "),s()(),l(40,"div",125),N(41,m2,3,0,"button",126),s()()()}if(i&2){let e=_();c(9),k(oe(10,19,e.total)),c(6),Q("ngModel",e.efectivoRecibido),p("min",0)("disabled",e.ocultarEfectivo),Je("autofocus",!0),c(6),Q("ngModel",e.montoTarjeta),p("min",0)("max",e.total-e.pagoTransferencia1-e.pagoVale1)("disabled",e.ocultaTarjeta),c(5),Q("ngModel",e.montoTransferencia),p("min",0)("max",e.total-e.pagoTarjeta1-e.pagoVale1)("disabled",e.ocultaTransferencia),c(),p("ngIf",e.montoMonederoCliente>0),c(4),k(oe(32,21,e.cambio)),c(2),p("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),c(),p("ngIf",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1>=e.total),c(4),p("disabled",e.pagoEfectivo+e.pagoTarjeta1+e.pagoTransferencia1+e.pagoVale1<e.total),c(3),p("ngIf",e.inputsHabilitados)}}function p2(i,t){if(i&1&&y(0,"app-venta-ticket",142),i&2){let e=_();p("venta",e.ventaParaImpresion)}}var ul=class i{constructor(t,e,n,r,a,o,u){this.fb=t;this.ventasService=e;this.productoService=n;this.clienteService=r;this.ventaService=a;this.cdRef=o;this.ngZone=u;this.ventaForm=this.fb.group({cliente:[""],producto:[""],cantidad:[1]})}codigoBarrasRef;efectivoRecibidoRef;cliTrigger;opcionesClientes=[];pendingFocusEfectivo=!1;barcodeFocusTimer=null;telefonoCliente="";nombreCliente="";cliente="";montoMonederoCliente=0;usarMonedero=!1;hayProducto=!1;ventaForm;carrito=[];precioEnFarmacia=0;ubicacionEnFarmacia="";total=0;totalArticulos=0;totalDescuento=0;totalAlmonedero=0;ventasPausadas=[];captionButtomReanudar="";efectivoRecibido=null;montoTarjeta=null;montoTransferencia=null;montoVale=null;cambio=0;inputsHabilitados=!1;tipoDescuento="";cadDesc="";ptjeDescuento=0;alMonedero=0;productoAplicaMonedero=!1;hayCliente=!1;aplicaGratis=!1;ocultarEfectivo=!1;ocultaTarjeta=!1;ocultaTransferencia=!1;ocultaVale=!1;mostrarModalPago=!1;codigoBarras="";busquedaProducto="";busquedaPorCodigo="";productosFiltrados=[];productosFiltradosPorCodigo=[];productos=[];clientes=[];farmaciaId="";farmaciaNombre="";farmaciaDireccion="";farmaciaTelefono="";nombreUs="";mostrarModalConsultaPrecio=!1;codigoConsulta="";productoConsultado=null;busquedaConsultaCodigo="";busquedaConsultaNombre="";productosConsultaFiltradosPorCodigo=[];productosConsultaFiltradosPorNombre=[];aplicaInapam=!1;yaPreguntoInapam=!1;fechaIni=new Date;fechaFin=new Date;faTimes=_i;ventaParaImpresion=null;mostrarTicket=!1;folioVentaGenerado=null;venta=null;ventaEnProceso=!1;clienteNombreCtrl=new js({value:"",disabled:!1});filteredClientes$=lt([]);placeholderSrc="assets/images/farmBienIcon.png";thumbs={};consultaEncontrado=!1;consultaImgUrl=this.placeholderSrc;thumbScale=2;scales=[1,1.5,2,2.5,3,3.5,4];onScaleChange(t){this.thumbScale=t,localStorage.setItem("thumbScale",String(t))}resetConsulta(){this.codigoConsulta="",this.busquedaConsultaCodigo="",this.busquedaConsultaNombre="",this.productoConsultado=null,this.productosConsultaFiltradosPorCodigo=[],this.productosConsultaFiltradosPorNombre=[],this.consultaEncontrado=!1,this.consultaImgUrl=this.placeholderSrc}toNum(t){let e=Number(t);return Number.isFinite(e)?e:0}round2(t){return Math.round((t+Number.EPSILON)*100)/100}get pagoEfectivo(){return this.toNum(this.efectivoRecibido)}get pagoTarjeta1(){return this.toNum(this.montoTarjeta)}get pagoTransferencia1(){return this.toNum(this.montoTransferencia)}get pagoVale1(){return this.toNum(this.montoVale)}get totalPagado(){return this.round2(this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)}trackByProducto=(t,e)=>e.producto;ngAfterViewInit(){this.focusBarcode(),this.clienteNombreCtrl.valueChanges.pipe(Gr(this.clienteNombreCtrl.value??""),dn(50),un()).subscribe(()=>{this.clienteNombreCtrl.enabled&&this.cliTrigger&&(this.cliTrigger.panelOpen?this.cliTrigger.updatePosition():this.cliTrigger.openPanel())})}ngAfterViewChecked(){this.pendingFocusEfectivo&&this.mostrarModalPago&&(this.pendingFocusEfectivo=!1,setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0))}ngOnInit(){this.obtenerProductos();let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono);let n=localStorage.getItem("user_nombre");this.nombreUs=n||"",this.ventasPausadas=this.ventaService.getVentasPausadas(),this.filteredClientes$=this.clienteNombreCtrl.valueChanges.pipe(xt(r=>typeof r=="string"?r:r?.nombre??""),xt(r=>r.trim()),dn(200),un(),Ui(r=>r.length<2?lt([]):this.clienteService.buscarClientesPorNombre(r,20).pipe(xt(a=>a?.rows??[]),Pi(()=>lt([]))))),this.clienteNombreCtrl.valueChanges.pipe(Gr(""),dn(120),un(),xt(r=>typeof r=="string"?r:r?.nombre??"")).subscribe(r=>{this.opcionesClientes=this.filtraClientesLocal(r),(r||"").length&&this.opcionesClientes.length&&!this.clienteNombreCtrl.disabled?this.cliTrigger?.openPanel():this.cliTrigger?.closePanel()})}onClienteInput(){let t=this.clienteNombreCtrl.value;typeof t=="string"&&t.trim()&&this.cliTrigger?.openPanel()}displayCliente=t=>t?.nombre||"";onClienteSelected(t){t&&(this.cliente=t._id,this.nombreCliente=t.nombre||"",this.telefonoCliente=t.telefono||"",this.montoMonederoCliente=Number(t.totalMonedero||0),this.recalcularRenglones(),this.hayCliente=!0,this.focusBarcode(60))}ngOnDestroy(){this.carrito.length>0&&this.pausarVenta()}handleEnter(t){this.mostrarModalPago&&(t.preventDefault(),this.pagoEfectivo+this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total&&this.finalizarVenta())}clearBarcodeFocusTimer(){this.barcodeFocusTimer&&(clearTimeout(this.barcodeFocusTimer),this.barcodeFocusTimer=null)}focusBarcode(t=60){this.clearBarcodeFocusTimer(),this.barcodeFocusTimer=setTimeout(()=>{let e=document.activeElement,n=!!e&&(e.tagName==="INPUT"||e.getAttribute("contenteditable")==="true");!this.mostrarModalPago&&!n&&this.codigoBarrasRef&&this.codigoBarrasRef.nativeElement.focus(),this.barcodeFocusTimer=null},t)}nombreDiaSemana(t){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][t]||""}abrirAutoClientes(){this.clienteNombreCtrl.enabled&&setTimeout(()=>this.cliTrigger?.openPanel(),0)}VerSiPreguntaINAPAM(){return Le(this,null,function*(){if(this.aplicaInapam){let t=yield vi.default.fire({icon:"question",title:"Credencial INAPAM vigente",html:`<h4>Me puede mostrar su credencial de INAPAM por favor?</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=t.isConfirmed}this.recalcularRenglones()})}recalcularRenglones(){return Le(this,null,function*(){if(this.carrito.length>0){for(let t=0;t<this.carrito.length;t++){let e=this.productos.find(r=>r._id===this.carrito[t].producto);this.descuentoMenorA25(this.carrito[t].producto)&&(yield this.preguntaINAPAM(e)),e.categoria==="Recargas"||e.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(e);let n=this.carrito[t].precioOriginal;n*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=n*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=e.nombre),this.carrito[t].precioFinal=n,this.carrito[t].tipoDescuento=this.tipoDescuento,this.carrito[t].cadDesc=this.cadDesc,this.carrito[t].alMonedero=this.alMonedero,this.carrito[t].descuentoUnitario=this.carrito[t].precioOriginal-n,this.carrito[t].iva=e.iva?n*.16:0,this.aplicaGratis&&this.validarProductoGratis(e._id)}this.calcularTotal()}})}buscarCliente(){this.telefonoCliente.length===10&&this.clienteService.buscarClientePorTelefono(this.telefonoCliente).subscribe({next:t=>{t&&t.nombre?(this.nombreCliente=t.nombre,this.ventaForm.controls.cliente.setValue(t._id),this.cliente=t._id,this.montoMonederoCliente=t.totalMonedero,this.hayCliente=!0,this.recalcularRenglones(),this.focusBarcode()):this.mostrarModalCrearCliente()},error:t=>{console.error("\u274C Error al buscar cliente:",t),this.mostrarModalCrearCliente()}})}mostrarModalCrearCliente(){vi.default.fire({icon:"warning",title:"Cliente no encontrado",text:"\xBFDesea registrar un nuevo cliente?",showCancelButton:!0,confirmButtonText:"Crear Cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{t.isConfirmed?this.abrirFormularioNuevoCliente():(this.limpiarCliente(),this.focusBarcode())})}abrirFormularioNuevoCliente(){vi.default.fire({title:"Registrar Cliente",html:'<input id="nuevoNombreCliente" class="swal2-input" style="width: 80%;" placeholder="Ap. paterno Ap. materno Nombre(s)">',showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let t=document.getElementById("nuevoNombreCliente").value;return t||vi.default.showValidationMessage("El nombre es obligatorio"),{nombre:t,telefono:this.telefonoCliente,totalMonedero:this.montoMonederoCliente}}}).then(t=>{t.isConfirmed?this.registrarNuevoCliente(t.value):t.dismiss===vi.default.DismissReason.cancel&&(this.limpiarCliente(),this.focusBarcode())})}registrarNuevoCliente(t){this.clienteService.crearCliente(t).subscribe({next:e=>{let n=e?.cliente??e?.data??e?.result??e,r=n?._id??e?.insertedId??e?._id??null,a=n?.nombre??t?.nombre??"",o=n?.telefono??t?.telefono??"",u=Number(n?.totalMonedero??0);if(r&&a){this.nombreCliente=a,this.ventaForm.controls.cliente.setValue(r),this.hayCliente=!0,this.cliente=r,this.montoMonederoCliente=u;try{(this.clientes||[]).some(f=>f?._id===r)||(this.clientes=[{_id:r,nombre:a,telefono:o,totalMonedero:u},...this.clientes||[]])}catch{}this.recalcularRenglones(),vi.default.fire({icon:"success",title:"Cliente registrado",text:`El cliente ${a} ha sido registrado correctamente.`,timer:1500,showConfirmButton:!1})}else console.error("\u26A0\uFE0F Respuesta inesperada del backend:",e),vi.default.fire({icon:"warning",title:"Cliente registrado",text:"Se registr\xF3 el cliente, pero no pude leer su ID desde la respuesta.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("\u274C Error al registrar cliente:",e),vi.default.fire({icon:"error",title:"Error",text:"No se pudo registrar el cliente. Int\xE9ntelo de nuevo.",confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1})}})}limpiarCliente(){this.cliente="",this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.hayCliente=!1,this.ventaForm.controls.cliente.setValue(""),this.clienteNombreCtrl.setValue(""),this.recalcularRenglones(),this.focusBarcode(60)}limpiarBarras(){this.resetConsulta()}limpiarProducto(){this.codigoBarras="",this.busquedaProducto="",this.busquedaPorCodigo="",this.productosFiltrados=this.productos,this.productosFiltradosPorCodigo=this.productos,this.filtrarProductos(),this.filtrarPorCodigo(),this.focusBarcode()}filtrarProductos(){this.busquedaProducto?this.productosFiltrados=this.productos.filter(t=>t.nombre.toLowerCase().includes(this.busquedaProducto.toLowerCase())):this.productosFiltrados=this.productos}filtrarPorCodigo(){this.busquedaPorCodigo?this.productosFiltradosPorCodigo=this.productos.filter(t=>t.codigoBarras.includes(this.busquedaPorCodigo)):this.productosFiltradosPorCodigo=this.productos}seleccionarProducto(t){let e=t.option.value,n=this.productos.find(r=>r._id===e);n&&(this.busquedaProducto=n.nombre,this.existenciaProducto(this.farmaciaId,n._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(n)}).catch(r=>{console.error("Error en existenciaProducto: ",r)})),this.focusBarcode(100)}seleccionarPorCodigo(t){let e=t.option.value,n=this.productos.find(r=>r._id===e);n&&(this.busquedaPorCodigo=n.codigoBarras,this.existenciaProducto(this.farmaciaId,n._id,1).then(()=>{this.hayProducto&&this.agregarProductoAlCarrito(n)}).catch(r=>{console.error("Error en existenciaProducto: ",r)})),this.focusBarcode(100)}displayNombre=t=>{let e=this.productos.find(n=>n._id===t);return e?e.nombre:""};displayCodigo=t=>{let e=this.productos.find(n=>n._id===t);return e?`${e.codigoBarras} \u2014 ${e.nombre}`:""};pausarVenta(){this.ventasPausadas.push({_uid:"p"+Date.now()+Math.random().toString(36).slice(2,8),cliente:this.ventaForm.value.cliente,productos:[...this.carrito],clienteId:this.cliente||null,telefonoCliente:this.telefonoCliente||null,nombreCliente:this.nombreCliente||null,montoMonederoCliente:this.montoMonederoCliente||null,total:this.total,totalArticulos:this.totalArticulos,totalDescuento:this.totalDescuento,totalAlmonedero:this.totalAlmonedero,aplicaInapam:this.aplicaInapam,captionButtomReanudar:this.captionButtomReanudar||"(venta pausada)"}),this.ventaService.setVentasPausadas(this.ventasPausadas),this.ventasPausadas=this.ventaService.getVentasPausadas()||[],this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.telefonoCliente="",this.nombreCliente="",this.montoMonederoCliente=0,this.aplicaInapam=!1,this.cliente="",this.captionButtomReanudar="",this.ventaForm.controls.cliente.setValue(""),this.hayCliente=!1,this.focusBarcode()}reanudarVenta(t){this.carrito.length&&this.pausarVenta();let e=this.ventasPausadas[t];this.ventaForm.patchValue({cliente:e.cliente}),this.carrito=[...e.productos],this.telefonoCliente=e.telefonoCliente,this.nombreCliente=e.nombreCliente,this.montoMonederoCliente=e.montoMonederoCliente,this.cliente=e.clienteId,this.total=e.total,this.totalArticulos=e.totalArticulos,this.totalDescuento=e.totalDescuento,this.totalAlmonedero=e.totalAlmonedero,this.aplicaInapam=e.aplicaInapam,this.captionButtomReanudar=e.captionButtomReanudar,this.ventasPausadas.splice(t,1),this.ventaService.setVentasPausadas(this.ventasPausadas),this.focusBarcode(0)}obtenerProductos(){this.productoService.obtenerProductos().subscribe({next:t=>{this.productos=t||[],this.thumbs={};for(let e of this.productos)this.thumbs[e._id]=this.placeholderSrc;ks(this.productos).pipe(Is(e=>e?.imagen?this.productoService.getImagenObjectUrl(e._id).pipe(mn(n=>{this.thumbs[e._id]=n||this.placeholderSrc}),Pi(()=>lt(null))):lt(null),6)).subscribe()},error:t=>console.error("Error al obtener productos",t)})}onThumbError(t,e){let n=t.target;n&&n.src!==this.placeholderSrc&&(n.src=this.placeholderSrc)}agregarProductoPorCodigo(){if(this.codigoBarras.length===0&&this.carrito.length>0)this.abrirModalPago();else{let t=this.productos.find(e=>e.codigoBarras===this.codigoBarras);t?this.existenciaProducto(this.farmaciaId,t._id,1).then(()=>{if(!this.hayProducto){this.codigoBarras="";return}this.agregarProductoAlCarrito(t)}).catch(e=>{console.error("Error en existenciaProducto: ",e)}):vi.default.fire({icon:"warning",title:"Producto no encontrado",text:"Verifica el c\xF3digo de barras",timer:1300,showConfirmButton:!1,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>this.focusBarcode(60)),this.codigoBarras="",this.focusBarcode()}}agregarProductoAlCarrito(t){return Le(this,null,function*(){let e=this.carrito.find(n=>n.producto===t._id&&!n.esGratis);if(e)this.existenciaProducto(this.farmaciaId,t._id,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(n=>{console.error("Error en existenciaProducto: ",n)});else{let n=this.precioEnFarmacia;this.descuentoMenorA25(t)&&(yield this.preguntaINAPAM(t)),t.categoria==="Recargas"||t.categoria==="Servicio M\xE9dico"?(this.ptjeDescuento=0,this.productoAplicaMonedero=!1,this.cadDesc="",this.tipoDescuento="",this.alMonedero=0):this.descuentoYpromo(t),n*=(100-this.ptjeDescuento)/100,this.productoAplicaMonedero&&(this.alMonedero=n*.02,this.tipoDescuento===""?(this.tipoDescuento="Cliente",this.cadDesc="2% Moned."):(this.tipoDescuento=`${this.tipoDescuento}-Cliente`,this.cadDesc=`${this.cadDesc} + 2% Moned.`)),this.tipoDescuento=this.limpiarPromocion(this.tipoDescuento),this.captionButtomReanudar===""&&(this.captionButtomReanudar=t.nombre);let r={producto:t._id,codBarras:t.codigoBarras,nombre:t.nombre,cantidad:1,precioFinal:n,precioOriginal:this.precioEnFarmacia,ubicacionEnFarmacia:this.ubicacionEnFarmacia,tipoDescuento:this.tipoDescuento,cadDesc:this.cadDesc,alMonedero:this.alMonedero,descuentoUnitario:this.precioEnFarmacia-n,iva:t.iva?n*.16:0,cantidadPagada:1,farmacia:this.farmaciaId,promoCantidadRequerida:t.promoCantidadRequerida};this.carrito=[r,...this.carrito]}this.aplicaGratis&&this.validarProductoGratis(t._id),this.calcularTotal()})}limpiarPromocion(t){let e=(t||"").toString();return e.startsWith("-")?e.slice(1):e}preguntaINAPAM(t){return Le(this,null,function*(){if(t.descuentoINAPAM&&!this.yaPreguntoInapam){this.yaPreguntoInapam=!0;let e=yield vi.default.fire({icon:"question",title:"\xBFTiene credencial INAPAM vigente?",html:`<h4>Me la puede mostrar por favor</h4>
                <p style="color: green;">Revisa que su credencial de INAPAM:</p>
                <p style="color: green;"> * Pertenezca al cliente</p>
                <p style="color: green;"> * No este vencida</p>`,showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED cumple",cancelButtonText:"No cumple",focusCancel:!0});this.aplicaInapam=e.isConfirmed}})}descuentoMenorA25(t){let n=new Date().getDay(),r=0;switch(n){case 0:r=t?.descuentoDomingo??null;break;case 1:r=t?.descuentoLunes??null;break;case 2:r=t?.descuentoMartes??null;break;case 3:r=t?.descuentoMiercoles??null;break;case 4:r=t?.descuentoJueves??null;break;case 5:r=t?.descuentoViernes??null;break;case 6:r=t?.descuentoSabado??null;break;default:r=0}return r?r<25:!0}descuentoYpromo(t){let e=this.soloFecha(new Date),n=e.getDay();if(this.tipoDescuento="",this.cadDesc="",this.ptjeDescuento=0,this.productoAplicaMonedero=this.hayCliente,this.alMonedero=0,this.fechaIni=this.soloFecha(new Date(e)),this.fechaFin=this.soloFecha(new Date(e)),this.aplicaGratis=!0,t.promoCantidadRequerida&&this.soloFecha(new Date(t.inicioPromoCantidad))<=this.soloFecha(e)&&this.soloFecha(new Date(t.finPromoCantidad))>=this.soloFecha(e))this.aplicaGratis=!1,this.cadDesc="",this.tipoDescuento=`${t.promoCantidadRequerida}x${t.promoCantidadRequerida-1}`,this.productoAplicaMonedero=!1,t.promoCantidadRequerida===2&&(this.aplicaGratis=!0),this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento+="-INAPAM",this.cadDesc="5%");else{let r=0,a=!1;switch(n){case 1:this.fechaIni=t?.promoLunes?.inicio??null,this.fechaFin=t?.promoLunes?.fin??null,r=t?.promoLunes?.porcentaje??null,this.productoAplicaMonedero=t?.promoLunes?.monedero??null;break;case 2:this.fechaIni=t?.promoMartes?.inicio??null,this.fechaFin=t?.promoMartes?.fin??null,r=t?.promoMartes?.porcentaje??null,this.productoAplicaMonedero=t?.promoMartes?.monedero??null;break;case 3:this.fechaIni=t?.promoMiercoles?.inicio??null,this.fechaFin=t?.promoMiercoles?.fin??null,r=t?.promoMiercoles?.porcentaje??null,this.productoAplicaMonedero=t?.promoMiercoles?.monedero??null;break;case 4:this.fechaIni=t?.promoJueves?.inicio??null,this.fechaFin=t?.promoJueves?.fin??null,r=t?.promoJueves?.porcentaje??null,this.productoAplicaMonedero=t?.promoJueves?.monedero??null;break;case 5:this.fechaIni=t?.promoViernes?.inicio??null,this.fechaFin=t?.promoViernes?.fin??null,r=t?.promoViernes?.porcentaje??null,this.productoAplicaMonedero=t?.promoViernes?.monedero??null;break;case 6:this.fechaIni=t?.promoSabado?.inicio??null,this.fechaFin=t?.promoSabado?.fin??null,r=t?.promoSabado?.porcentaje??null,this.productoAplicaMonedero=t?.promoSadado?.monedero??null;break;case 0:this.fechaIni=t?.promoDomingo?.inicio??null,this.fechaFin=t?.promoDomingo?.fin??null,r=t?.promoDomingo?.porcentaje??null,this.productoAplicaMonedero=t?.promoDomingo?.monedero??null;break}if(!r||r<=0?(this.fechaIni=this.soloFecha(new Date(e)),this.fechaIni.setDate(this.fechaIni.getDate()+5),this.fechaIni=this.soloFecha(this.fechaIni)):a=!0,a&&this.soloFecha(new Date(this.fechaIni))<=e&&this.soloFecha(new Date(this.fechaFin))>=e&&(this.tipoDescuento=this.nombreDiaSemana(n),this.ptjeDescuento=r,this.cadDesc=`${r}%`,this.productoAplicaMonedero=this.productoAplicaMonedero&&this.hayCliente),t.promoDeTemporada&&this.soloFecha(new Date(t.promoDeTemporada.inicio))<=e&&this.soloFecha(new Date(t.promoDeTemporada.fin))>=e){let o=t.promoDeTemporada.porcentaje;o>this.ptjeDescuento&&(this.ptjeDescuento=o,this.tipoDescuento="Temporada",this.cadDesc=`${o}%`,this.productoAplicaMonedero=t.promoDeTemporada.monedero&&this.hayCliente)}if(this.ptjeDescuento>0){if(this.ptjeDescuento<25&&this.aplicaInapam&&t.descuentoINAPAM){let o=this.precioEnFarmacia*(1-this.ptjeDescuento/100)*.95;this.ptjeDescuento=(1-o/this.precioEnFarmacia)*100,this.tipoDescuento+="-INAPAM",this.cadDesc+="+ 5%",this.productoAplicaMonedero=this.hayCliente}}else this.aplicaInapam&&t.descuentoINAPAM&&(this.ptjeDescuento=5,this.tipoDescuento="INAPAM",this.cadDesc="5%",this.productoAplicaMonedero=this.hayCliente);this.ptjeDescuento<=0&&(this.productoAplicaMonedero=this.hayCliente)}}soloFecha(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}eliminarProducto(t){let e=this.carrito[t];if(e.esGratis)this.carrito.splice(t,1);else{let n=e.producto;this.carrito.splice(t,1);let r=this.carrito.findIndex(a=>a.producto===n&&a.esGratis);r!==-1&&this.carrito.splice(r,1)}this.calcularTotal()}incrementarCantidad(t){let e=this.carrito[t];e.esGratis||this.existenciaProducto(this.farmaciaId,e.producto,e.cantidad+1).then(()=>{this.hayProducto&&(e.cantidad+=1,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal())}).catch(n=>{console.error("Error en existenciaProducto: ",n)}),this.calcularTotal()}decrementarCantidad(t){let e=this.carrito[t];e.cantidad>1&&!e.esGratis?(e.cantidad--,this.esPromocionPorCantidad(e.tipoDescuento)&&this.validarProductoGratis(e.producto),this.calcularTotal()):e.cantidad===1&&!e.esGratis&&(e.cantidad--,this.eliminarProducto(t))}esPromocionPorCantidad(t){return["2x1","3x2","4x3"].some(n=>t?.startsWith(n))}validarProductoGratis(t){let e=this.carrito.find(o=>o.producto===t&&!o.esGratis);if(!e||!e.promoCantidadRequerida)return;let n=e.cantidad,r=e.promoCantidadRequerida,a=this.carrito.some(o=>o.producto===t&&o.esGratis);if(n>=r-1){let o=Math.floor(n/(r-1));if(this.existenciaProducto(this.farmaciaId,t,n+o),!this.hayProducto)return;if(!a)this.carrito.push({producto:e.producto,nombre:e.nombre,cantidad:1,precioFinal:0,precioOriginal:e.precioOriginal,tipoDescuento:`${r}x${r-1}-Gratis`,cadDesc:"100%",alMonedero:0,descuentoUnitario:e.precioOriginal,iva:0,lote:e.lote,fechaCaducidad:e.fechaCaducidad,cantidadPagada:0,esGratis:!0,controlesDeshabilitados:!0,lotes:e.lotes,farmacia:this.farmaciaId});else{let u=this.carrito.find(m=>m.producto===t&&m.esGratis);u&&(u.cantidad=o,u.cadDesc="100%",u.tipoDescuento=`${r}x${r-1}-Gratis`)}}else{let o=this.carrito.findIndex(u=>u.producto===t&&u.esGratis);o!==-1&&this.carrito.splice(o,1)}}calcularTotal(){this.total=this.round2(this.carrito.reduce((t,e)=>t+e.precioFinal*e.cantidad,0)),this.totalDescuento=this.round2(this.carrito.reduce((t,e)=>t+e.descuentoUnitario*e.cantidad,0)),this.totalArticulos=this.carrito.reduce((t,e)=>t+e.cantidad,0),this.totalAlmonedero=this.round2(this.carrito.reduce((t,e)=>t+e.alMonedero*e.cantidad,0))}cancelarVenta(){this.captionButtomReanudar="",this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1,this.folioVentaGenerado=null,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.hayCliente=!1}abrirModalPago(){vi.default.fire({icon:"question",title:"\xBFDESEA AGREGAR ALGO M\xC1S?",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,focusConfirm:!0,confirmButtonText:"NO, ir a cobrar",cancelButtonText:"SI, agregar m\xE1s productos"}).then(t=>{t.isConfirmed&&(this.usarMonedero=!1,this.mostrarModalPago=!0,this.montoTarjeta=null,this.montoTransferencia=null,this.montoVale=null,this.efectivoRecibido=null,this.cambio=0,this.clearBarcodeFocusTimer(),this.codigoBarrasRef?.nativeElement?.blur(),this.cdRef.detectChanges(),setTimeout(()=>this.efectivoRecibidoRef?.nativeElement?.focus(),0),this.calcularTotal())})}calculaCambio(){this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.efectivoRecibido=0,this.cambio=0):this.total-this.pagoEfectivo-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1<0?this.cambio=this.pagoEfectivo-(this.total-(this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1)):this.cambio=0}pagoTarjeta(){this.pagoTarjeta1>=this.total?(this.montoTarjeta=this.total,this.efectivoRecibido=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTarjeta=this.total-this.pagoTransferencia1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.ocultaTarjeta=!1,this.calculaCambio())}pagoTransferencia(){this.pagoTransferencia1>=this.total?(this.montoTransferencia=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoVale=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoTransferencia=this.total-this.pagoTarjeta1-this.pagoVale1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}pagoVale(){this.pagoVale1>=this.total?(this.montoVale=this.total,this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.cambio=0,this.inhabilitarInputs()):this.pagoTarjeta1+this.pagoTransferencia1+this.pagoVale1>=this.total?(this.montoVale=this.total-this.pagoTarjeta1-this.pagoTransferencia1,this.efectivoRecibido=0,this.cambio=0,this.inhabilitarInputs()):(this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.calculaCambio())}onToggleMonedero(){this.usarMonedero?this.montoMonederoCliente>=this.total?this.montoVale=this.total:this.montoVale=this.montoMonederoCliente:this.habilitarInputs(),this.pagoVale()}habilitarInputs(){this.ocultarEfectivo=!1,this.ocultaTarjeta=!1,this.ocultaTransferencia=!1,this.ocultaVale=!1,this.inputsHabilitados=!1,this.montoVale=0,this.usarMonedero=!1,this.calculaCambio()}inhabilitarInputs(){this.ocultarEfectivo=!0,this.ocultaTarjeta=!0,this.ocultaTransferencia=!0,this.ocultaVale=!0,this.inputsHabilitados=!0}cancelarPago(){this.efectivoRecibido=0,this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.cambio=0,this.mostrarModalPago=!1,this.focusBarcode(50)}finalizarVenta(){this.efectivoRecibido=Math.max(0,this.pagoEfectivo),this.montoTarjeta=Math.max(0,this.pagoTarjeta1),this.montoTransferencia=Math.max(0,this.pagoTransferencia1),this.montoVale=Math.max(0,this.pagoVale1),this.cambio=Math.max(0,this.cambio);let t=this.efectivoRecibido+this.montoTarjeta+this.montoTransferencia+this.montoVale;if(this.montoTarjeta+this.montoTransferencia+this.montoVale>this.total){vi.default.fire("Error","El monto con tarjeta, transferencia y/o monedero no puede exceder el total.","error");return}if(t<this.total){vi.default.fire("Pago incompleto","La suma de pagos no cubre el total de la venta.","warning");return}let n=this.folioVentaGenerado||this.generarFolioLocal();this.folioVentaGenerado=n;let r=this.carrito.map(v=>({producto:v.producto,nombre:v.nombre,barrasYNombre:`${v.codBarras.slice(-3)} ${v.nombre}`,cantidad:v.cantidad,precio:v.precioFinal,totalRen:v.precioFinal*v.cantidad,precioOriginal:v.precioOriginal,iva:v.iva,tipoDescuento:v.tipoDescuento,descuento:(v.descuentoUnitario??0)*v.cantidad,cadenaDescuento:v.cadDesc??"",monederoCliente:(v.almonedero??0)*v.cantidad}));this.ventaParaImpresion={folio:this.folioVentaGenerado,cliente:this.nombreCliente,farmacia:{nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono},productos:r,cantidadProductos:this.totalArticulos,total:this.total,totalDescuento:this.totalDescuento,totalMonederoCliente:this.totalAlmonedero,formaPago:{efectivo:this.total-this.montoTarjeta-this.montoTransferencia-this.montoVale,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,vale:this.montoVale},AsiQuedaMonedero:this.montoMonederoCliente-this.montoVale+this.totalAlmonedero,elcambio:this.cambio,fecha:new Date().toISOString(),usuario:this.nombreUs},console.log("Datos enviados al ticket: ",this.ventaParaImpresion),this.mostrarTicket=!0,this.mostrarModalPago=!1,this.cdRef.detectChanges();let a=!1,o=()=>{a||(a=!0,u(),this.ngZone.run(()=>{this.mostrarTicket=!1,this.hayCliente=!1,this.guardarVentaDespuesDeImpresion(n)}))},u=()=>{window.removeEventListener("afterprint",m),f?.removeEventListener?.("change",h),g&&clearTimeout(g)},m=()=>o(),f=window.matchMedia?window.matchMedia("print"):null,h=v=>{v?.matches||o()};window.addEventListener("afterprint",m),f?.addEventListener?.("change",h);let g=setTimeout(o,6e3);setTimeout(()=>{try{window.print()}catch{o()}},0)}limpiarVenta(){this.carrito=[],this.total=0,this.totalArticulos=0,this.totalDescuento=0,this.totalAlmonedero=0,this.limpiarCliente(),this.montoTarjeta=0,this.montoTransferencia=0,this.montoVale=0,this.efectivoRecibido=0,this.cambio=0,this.aplicaInapam=!1,this.yaPreguntoInapam=!1}yyyymmddLocal(t=new Date){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}${n}${r}`}generarFolioLocal(){let t="FB",e=this.yyyymmddLocal(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";for(let a=0;a<6;a++){let o=Math.floor(Math.random()*n.length);r+=n[o]}return`${t}${e}-${r}`}guardarVentaDespuesDeImpresion(t){let e=this.carrito.map(r=>({producto:r.producto,cantidad:r.cantidad,precio:r.precioFinal,totalRen:r.precioFinal*r.cantidad,precioOriginal:r.precioOriginal,iva:r.iva,tipoDescuento:r.tipoDescuento,descuento:(r.descuentoUnitario??0)*r.cantidad})),n={folio:t,clienteId:this.cliente,productos:e,aplicaInapam:this.aplicaInapam,efectivo:this.total-this.pagoTarjeta1-this.pagoTransferencia1-this.pagoVale1,tarjeta:this.montoTarjeta,transferencia:this.montoTransferencia,importeVale:this.pagoVale1,farmacia:this.farmaciaId,totaMonederoCliente:this.totalAlmonedero};this.ventasService.crearVenta(n).subscribe({next:()=>{this.folioVentaGenerado=null,this.limpiarVenta(),this.mostrarModalPago=!1,this.ventaService.setVentasPausadas(this.ventasPausadas),vi.default.fire({icon:"success",title:"Venta Registrada",text:"Venta finalizada correctamente",timer:1300,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1,didClose:()=>{this.focusBarcode(50)}})},error:r=>{let a=r?.error?.mensaje||"Error al finalizar la venta";vi.default.fire("Error",a,"error"),a.includes("**")||(this.mostrarModalPago=!1,this.limpiarVenta(),setTimeout(()=>this.focusBarcode(50),0))}})}abrirModalConsultaPrecio(){this.mostrarModalConsultaPrecio=!0,this.codigoConsulta="",this.productoConsultado=null,this.limpiarProducto()}cerrarModalConsultaPrecio(){this.resetConsulta(),this.mostrarModalConsultaPrecio=!1,this.focusBarcode(50)}consultarPrecio(){this.codigoConsulta.trim()&&this.productoService.consultarPrecioPorCodigo(this.farmaciaId,this.codigoConsulta).subscribe({next:t=>{let e=!!t&&t.nombre!==void 0;if(this.consultaEncontrado=e,!e){this.productoConsultado=null,this.consultaImgUrl=this.placeholderSrc;return}!t||t.nombre===void 0?this.productoConsultado={nombre:"Producto no encontrado",precioNormal:null,promo1:null,precioLunes:null,lunesMasInapam:null,promo2:null,precioMartes:null,martesMasInapam:null,promo3:null,precioMiercoles:null,miercolesMasInapam:null,promo4:null,precioJueves:null,juevesMasInapam:null,promo5:null,precioViernes:null,viernesMasInapam:null,promo6:null,precioSabado:null,sabadoMasInapam:null,promo0:null,precioDomingo:null,domingoMasInapam:null,promo:null,precioConDescuento:null,precioInapam:null,precioDescuentoMasInapam:null,promoCliente:null,ubicacionEnFarmacia:null}:this.productoConsultado={nombre:t.nombre,precioNormal:t.precioNormal,promo1:t.promo1,precioLunes:t.precioLunes,lunesMasInapam:t.lunesMasInapam,promo2:t.promo2,precioMartes:t.precioMartes,martesMasInapam:t.martesMasInapam,promo3:t.promo3,precioMiercoles:t.precioMiercoles,miercolesMasInapam:t.miercolesMasInapam,promo4:t.promo4,precioJueves:t.precioJueves,juevesMasInapam:t.juevesMasInapam,promo5:t.promo5,precioViernes:t.precioViernes,viernesMasInapam:t.viernesMasInapam,promo6:t.promo6,precioSabado:t.precioSabado,sabadoMasInapam:t.sabadoMasInapam,promo0:t.promo0,precioDomingo:t.precioDomingo,domingoMasInapam:t.domingoMasInapam,promo:t.promo,precioConDescuento:t.precioConDescuento,precioInapam:t.precioInapam,precioDescuentoMasInapam:t.precioDescuentoMasInapam,promoCliente:t.promoCliente,ubicacionEnFarmacia:t.ubicacionEnFarmacia};let n=t._id??(this.productos||[]).find(r=>r.codigoBarras===this.codigoConsulta)?._id;this.consultaImgUrl=n?this.productoService.obtenerImagenProductoUrl(n):this.placeholderSrc},error:t=>{console.error("\u274C Error al consultar precio:",t),this.productoConsultado={nombre:"Error en la consulta",precioNormal:null,promo:null,precioFinal:null}}})}filtrarConsultaPorCodigo(){let t=(this.busquedaConsultaCodigo||"").trim();if(!t){this.productosConsultaFiltradosPorCodigo=[];return}this.productosConsultaFiltradosPorCodigo=this.productos.filter(e=>(e.codigoBarras||"").includes(t))}filtrarConsultaPorNombre(){let t=(this.busquedaConsultaNombre||"").trim().toLowerCase();if(!t){this.productosConsultaFiltradosPorNombre=[];return}this.productosConsultaFiltradosPorNombre=this.productos.filter(e=>(e.nombre||"").toLowerCase().includes(t))}onSelectConsultaCodigo(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaCodigo=t.option.viewValue,this.consultarPrecio()}onSelectConsultaNombre(t){let e=t.option.value;this.codigoConsulta=e,this.busquedaConsultaNombre=t.option.viewValue,this.consultarPrecio()}existenciaProducto(t,e,n){return new Promise((r,a)=>{this.productoService.existenciaPorFarmaciaYProducto(t,e).subscribe({next:o=>{this.precioEnFarmacia=o.precioVenta,this.ubicacionEnFarmacia=o.ubicacionEnFarmacia,o.existencia>=n?(this.hayProducto=!0,r()):(vi.default.fire({icon:"error",title:"No hay suficiente existencia",html:`Producto: ${o.nombre}<br>Cantidad disponible: ${o.existencia}<br>Cantidad requerida: ${n}`,confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1}),this.hayProducto=!1,r())},error:o=>{console.error("Error al obtener la existencia del producto:",o),this.hayProducto=!1,a(o)}})})}clienteBoxVisible=!1;clienteIndex=-1;onClienteBlur(){setTimeout(()=>{this.clienteBoxVisible=!1},120)}onClienteKeyDown(t){!this.clienteBoxVisible||this.opcionesClientes.length===0||(t.key==="ArrowDown"?(t.preventDefault(),this.clienteIndex=Math.min(this.clienteIndex+1,this.opcionesClientes.length-1)):t.key==="ArrowUp"?(t.preventDefault(),this.clienteIndex=Math.max(this.clienteIndex-1,0)):t.key==="Enter"?(t.preventDefault(),this.clienteIndex>=0&&this.selectCliente(this.opcionesClientes[this.clienteIndex])):t.key==="Escape"&&(this.clienteBoxVisible=!1))}selectCliente(t){t&&(this.clienteNombreCtrl.setValue(t.nombre,{emitEvent:!1}),this.clienteBoxVisible=!1,this.onClienteSelected(t))}trackByCliente=(t,e)=>e?._id||e?.nombre||t;ensureClientesArray(t){return Array.isArray(t)?t:Array.isArray(t?.rows)?t.rows:Array.isArray(t?.data)?t.data:Array.isArray(t?.clientes)?t.clientes:[]}filtraClientesLocal(t){let e=Array.isArray(this.clientes)?this.clientes:Array.isArray(this.clientes?.rows)?this.clientes.rows:[],n=(t||"").trim().toLowerCase();if(!n)return e.slice(0,50);let r=t.replace(/\D/g,"");return e.filter(a=>{let o=(a?.nombre||"").toLowerCase(),u=String(a?.telefono||"");return o.includes(n)||r&&u.includes(r)}).slice(0,50)}filtraClientesDatalist(t){this.opcionesClientes=this.filtraClientesLocal(t)}onClienteElegidoDesdeTexto(t){let e=String(t||"").split(" \u2014 ")[0].trim().toLowerCase();if(!e)return;let r=this.ensureClientesArray(this.clientes).find(a=>String(a?.nombre||"").toLowerCase()===e);r&&this.onClienteSelected(r)}openPreviewVenta(t){let n=(this.productos||[]).find(a=>a._id===t.producto)?.imagen?this.productoService.obtenerImagenProductoUrl(t.producto):this.placeholderSrc,r=new Image;r.src=n,r.onload=()=>{let a=r.naturalWidth||0,o=r.naturalHeight||0,u=a*3,m=o*3,f=Math.floor(window.innerWidth*.9),h=Math.floor(window.innerHeight*.9),g=Math.min(f/u,h/m,1),v=Math.max(1,Math.round(u*g)),b=Math.max(1,Math.round(m*g));vi.default.fire({width:"auto",background:"#000",showConfirmButton:!1,showCloseButton:!0,padding:0,html:`
        <div style="max-width:${f}px;max-height:${h}px;display:flex;align-items:center;justify-content:center;">
          <img src="${n}" alt=""
               style="width:${v}px;height:${b}px;object-fit:contain;display:block;"/>
        </div>`})},r.onerror=()=>{vi.default.fire({icon:"error",title:"No se pudo cargar la imagen",text:"Int\xE9ntalo de nuevo."})}}static \u0275fac=function(e){return new(e||i)(te(Jt),te(dl),te(Zi),te(wn),te(Ua),te(Wt),te(Yi))};static \u0275cmp=Te({type:i,selectors:[["app-ventas"]],viewQuery:function(e,n){if(e&1&&(Ot(xx,5),Ot(bx,5),Ot(yx,5,Qr)),e&2){let r;St(r=wt())&&(n.codigoBarrasRef=r.first),St(r=wt())&&(n.efectivoRecibidoRef=r.first),St(r=wt())&&(n.cliTrigger=r.first)}},hostBindings:function(e,n){e&1&&E("keydown.enter",function(a){return n.handleEnter(a)},!1,Sa)},decls:116,vars:46,consts:[["autoClientes","matAutocomplete"],["codigoBarrasRef",""],["autoCodigo","matAutocomplete"],["autoNombre","matAutocomplete"],["payForm","ngForm"],["autoConsCodigo","matAutocomplete"],["autoConsNombre","matAutocomplete"],["efectivoRecibidoRef",""],[1,"row","align-items-center","titulo-row"],[1,"col-6","text-end"],[1,"titulo","mb-0"],[1,"col-6","d-flex","justify-content-center"],[1,"me-2","mb-0"],[1,"form-select","form-select-sm","scale-select",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"row","align-items-center","mb-1"],[1,"col-md-2"],["appearance","outline",1,"compact-field"],["type","text","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["id","clientesList"],[1,"col-md-1","text-end"],[1,"cliente-tel"],[1,"col-md-2","position-relative"],["type","text",1,"form-control","pe-5",3,"ngModelChange","input","ngModel"],["type","button","matTooltip","Limpiar cliente","class","btn btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-3"],["class","cliente-nombre",4,"ngIf"],["class","col-md-2",4,"ngIf"],[1,"col-md-2","text-end"],[1,"btn-gris","consultar-precio",3,"click"],[1,"productos-container"],[1,"subtitulo"],["type","text","id","codigoBarras","placeholder","Escanear C\xF3d. barras",1,"input-text","input-cb",3,"ngModelChange","keyup.enter","ngModel","disabled"],["appearance","outline",1,"compact-field","wide-field","mr-field"],["matInput","",3,"ngModelChange","input","ngModel","matAutocomplete"],["appearance","outline",1,"compact-field","wider-field"],["matTooltip","Limpiar producto",1,"btn-rojo-tache",3,"click"],[1,"fas","fa-times"],["class","modal-overlay",4,"ngIf"],[1,"ventas-container"],[1,"tabla"],[1,"col-acciones"],[1,"col-img"],[1,"col-producto"],[1,"col-cant"],[1,"col-precio"],[1,"col-imp-normal"],[1,"col-promo"],[1,"col-desc-porc"],[1,"col-monedero"],[1,"col-desc"],[1,"col-precio-final"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"total-container"],[1,"left"],[1,"center"],[1,"right"],["class","botones-container",4,"ngIf"],["class","mt-4",4,"ngIf"],[3,"ngSubmit"],["class","ticket-impresion",3,"venta",4,"ngIf"],[3,"ngValue"],[3,"value"],["type","button","matTooltip","Limpiar cliente",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"cliente-nombre"],["type","checkbox","id","aplicaInapam","name","aplicaInapam",3,"ngModelChange","ngModel"],["for","aplicaInapam"],[1,"modal-overlay"],[1,"modal-content",2,"width","600px"],[1,"input-container","position-relative"],["type","text","placeholder","C\xF3digo de barras",1,"input-field",3,"ngModelChange","keyup.enter","ngModel"],["matTooltip","Limpiar c\xF3d. barras",1,"btn","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["class","row",4,"ngIf"],["matTooltip","Salir de consultar",1,"btn-rojo-tache",3,"click"],[1,"row"],[1,"consulta-img-wrap","col-sm-7","text-center"],["alt","Imagen de producto",3,"error","src"],["class","col-sm-5 text-center mt-4",4,"ngIf"],[1,"col-sm-5","text-center","mt-4"],["appearance","outline",1,"w-100","mb-1","compact-field"],["matInput","","placeholder","Buscar C\xF3d. barras",3,"ngModelChange","input","ngModel","matAutocomplete"],[3,"optionSelected"],["matInput","","placeholder","Buscar producto por nombre",3,"ngModelChange","input","ngModel","matAutocomplete"],["role","group","aria-label","Acciones",1,"acciones-group"],["matTooltip","Eliminar rengl\xF3n",1,"btn-icono","btn-rojo-tache",3,"click","disabled"],["matTooltip","Aumentar uno",1,"btn-icono","btn-verde",3,"click","disabled"],[1,"fas","fa-plus"],["matTooltip","Quitar uno",1,"btn-icono","btn-gris",3,"click","disabled"],[1,"fas","fa-minus"],[1,"img-cell"],["type","button",1,"img-button",3,"click"],["alt","","loading","lazy","decoding","async","matTooltip","Ver imagen","matTooltipPosition","right","matTooltipClass","tip-tight",3,"error","src"],[1,"prod-nombre"],[1,"prod-ubicacion"],[1,"botones-container"],[1,"btn-amarillo",3,"click"],[1,"btn-rojo",3,"click"],[1,"btn-verde","btn-right",3,"click"],[1,"mt-4"],["class","btn-gris d-block w-100 mb-2",3,"click",4,"ngFor","ngForOf"],[1,"btn-gris","d-block","w-100","mb-2",3,"click"],[1,"modal-content"],[1,"modal-header","bg-info-subtle","text-blue"],[1,"modal-title"],[1,"modal-body"],[1,"total-pago"],[1,"form-group","row","mb-2"],["for","efectivoRecibido",1,"col-sm-4","col-form-label","text-left"],[1,"col-sm-7","offset-sm-1","d-flex","justify-content-end"],["id","efectivoRecibido","name","efectivoRecibido","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","disabled"],["for","montoTarjeta",1,"col-sm-4","col-form-label","text-left"],["id","montoTarjeta","name","montoTarjeta","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["for","montoTransferencia",1,"col-sm-4","col-form-label"],["id","montoTransferencia","name","montoTransferencia","type","number","step","0.1","autocomplete","off","inputmode","decimal",1,"form-control","text-end",3,"ngModelChange","ngModel","min","max","disabled"],["class","monedero-container",4,"ngIf"],[1,"mt-3","cambio"],["class","text-danger mt-3",4,"ngIf"],["class","text-success mt-3",4,"ngIf"],[1,"btns-container"],["type","button",1,"btn-rojo-tache",3,"click"],["type","submit",1,"btn-gris",3,"disabled"],[1,"button-container"],["type","button","class","btn-amarillo",3,"click",4,"ngIf"],[1,"monedero-container"],[1,"col-12","text-center",2,"color","rgb(3, 7, 83)","font-weight","bold","font-size","large"],[1,"col-sm-8"],["for","usarMonedero",1,"col-form-label"],[1,"col-sm-4","d-flex","align-items-center"],["id","usarMonedero","type","checkbox","name","usarMonedero",1,"form-check-input",3,"ngModelChange","ngModel"],["for","usarMonedero",1,"ms-2"],["class","form-group row mb-2",4,"ngIf"],[1,"col-sm-8","col-form-label","text-left"],[1,"col-sm-4","d-flex","justify-content-end"],[1,"form-control-plaintext","text-end"],[1,"text-danger","mt-3"],[1,"text-success","mt-3"],["type","button",1,"btn-amarillo",3,"click"],[1,"fas","fa-sync-alt"],[1,"ticket-impresion",3,"venta"]],template:function(e,n){if(e&1){let r=ie();l(0,"div")(1,"div",8)(2,"div",9)(3,"h1",10),d(4,"Ventas"),s()(),l(5,"div",11)(6,"label",12),d(7,"Tama\xF1o imagen:"),s(),l(8,"select",13),Z("ngModelChange",function(o){return T(r),J(n.thumbScale,o)||(n.thumbScale=o),P(o)}),E("ngModelChange",function(o){return T(r),P(n.onScaleChange(o))}),N(9,Cx,2,2,"option",14),s()()(),l(10,"div",15)(11,"div",16)(12,"mat-form-field",17)(13,"mat-label"),d(14,"Busca cliente, nombre"),s(),y(15,"input",18),l(16,"mat-autocomplete",19,0),E("optionSelected",function(o){return T(r),P(n.onClienteSelected(o.option.value))}),N(18,wx,3,3,"mat-option",20),F(19,"async"),N(20,Ex,2,0,"mat-option",21),F(21,"async"),s()(),l(22,"datalist",22),N(23,Tx,1,1,"option",20),s()(),l(24,"div",23)(25,"label",24),d(26,"Tel.:"),s()(),l(27,"div",25)(28,"input",26),Z("ngModelChange",function(o){return T(r),J(n.telefonoCliente,o)||(n.telefonoCliente=o),P(o)}),E("input",function(){return T(r),P(n.buscarCliente())}),s(),N(29,Px,2,1,"button",27),s(),l(30,"div",28),N(31,kx,2,1,"span",29),s(),N(32,Ix,4,1,"div",30),l(33,"div",31)(34,"button",32),E("click",function(){return T(r),P(n.abrirModalConsultaPrecio())}),d(35,"Consultar Precio"),s()()(),l(36,"div",33)(37,"h2",34),d(38,"Producto:"),s(),l(39,"input",35,1),Z("ngModelChange",function(o){return T(r),J(n.codigoBarras,o)||(n.codigoBarras=o),P(o)}),E("keyup.enter",function(){return T(r),P(n.agregarProductoPorCodigo())}),s(),l(41,"mat-form-field",36)(42,"mat-label"),d(43,"Buscar C\xF3d. barras"),s(),l(44,"input",37),Z("ngModelChange",function(o){return T(r),J(n.busquedaPorCodigo,o)||(n.busquedaPorCodigo=o),P(o)}),E("input",function(){return T(r),P(n.filtrarPorCodigo())}),s(),l(45,"mat-autocomplete",19,2),E("optionSelected",function(o){return T(r),P(n.seleccionarPorCodigo(o))}),N(47,Mx,2,3,"mat-option",20),s()(),l(48,"mat-form-field",38)(49,"mat-label"),d(50,"Buscar producto"),s(),l(51,"input",37),Z("ngModelChange",function(o){return T(r),J(n.busquedaProducto,o)||(n.busquedaProducto=o),P(o)}),E("input",function(){return T(r),P(n.filtrarProductos())}),s(),l(52,"mat-autocomplete",19,3),E("optionSelected",function(o){return T(r),P(n.seleccionarProducto(o))}),N(54,Fx,2,2,"mat-option",20),s()(),l(55,"button",39),E("click",function(){return T(r),P(n.limpiarProducto())}),y(56,"i",40),s()(),N(57,n2,13,5,"div",41),l(58,"div",42)(59,"table",43)(60,"colgroup"),y(61,"col",44)(62,"col",45)(63,"col",46)(64,"col",47)(65,"col",48)(66,"col",49)(67,"col",50)(68,"col",51)(69,"col",52)(70,"col",53)(71,"col",54),s(),l(72,"thead")(73,"tr")(74,"th",44),d(75,"Acc."),s(),l(76,"th",45),d(77,"Imagen"),s(),l(78,"th"),d(79,"Producto / ubic."),s(),l(80,"th"),d(81,"Cant."),s(),l(82,"th"),d(83,"P. U."),s(),l(84,"th"),d(85,"Imp. normal"),s(),l(86,"th"),d(87,"Promo"),s(),l(88,"th"),d(89,"% desc."),s(),l(90,"th"),d(91,"Moned."),s(),l(92,"th"),d(93,"Desc."),s(),l(94,"th"),d(95,"Precio Final"),s()()(),l(96,"tbody"),N(97,r2,39,30,"tr",55),s()()(),l(98,"div",56)(99,"div",57),d(100),s(),l(101,"div",58),d(102),F(103,"currency"),s(),l(104,"div",58),d(105),F(106,"currency"),s(),l(107,"div",59),d(108),F(109,"currency"),s()(),N(110,a2,7,0,"div",60)(111,s2,4,1,"div",61),s(),l(112,"form",62,4),E("ngSubmit",function(){return T(r),P(n.finalizarVenta())}),N(114,f2,42,23,"div",41),s(),N(115,p2,1,1,"app-venta-ticket",63)}if(e&2){let r,a=$t(17),o=$t(46),u=$t(53);c(8),Q("ngModel",n.thumbScale),c(),p("ngForOf",n.scales),c(6),p("formControl",n.clienteNombreCtrl)("matAutocomplete",a),c(),p("displayWith",n.displayCliente),c(2),p("ngForOf",oe(19,36,n.filteredClientes$)),c(2),p("ngIf",((r=oe(21,38,n.filteredClientes$))==null?null:r.length)===0),c(3),p("ngForOf",n.opcionesClientes),c(5),Q("ngModel",n.telefonoCliente),c(),p("ngIf",n.telefonoCliente),c(2),p("ngIf",n.nombreCliente),c(),p("ngIf",n.carrito.length>0),c(7),Q("ngModel",n.codigoBarras),p("disabled",n.mostrarModalPago),Je("tabindex",n.mostrarModalPago?-1:0),c(5),Q("ngModel",n.busquedaPorCodigo),p("matAutocomplete",o),c(),p("displayWith",n.displayCodigo),c(2),p("ngForOf",n.productosFiltradosPorCodigo),c(4),Q("ngModel",n.busquedaProducto),p("matAutocomplete",u),c(),p("displayWith",n.displayNombre),c(2),p("ngForOf",n.productosFiltrados),c(3),p("ngIf",n.mostrarModalConsultaPrecio),c(),Ri("--thumb-scale",n.thumbScale),c(39),p("ngForOf",n.carrito)("ngForTrackBy",n.trackByProducto),c(3),R("Total de art\xEDculos: ",n.totalArticulos,""),c(2),R("Abono al Monedero: ",oe(103,40,n.totalAlmonedero),""),c(3),R("Usted ahorr\xF3: ",oe(106,42,n.totalDescuento),""),c(3),R("Total: ",oe(109,44,n.total),""),c(2),p("ngIf",n.carrito.length),c(),p("ngIf",n.ventasPausadas.length),c(3),p("ngIf",n.mostrarModalPago),c(),p("ngIf",n.ventaParaImpresion&&n.mostrarTicket)}},dependencies:[Ae,We,Be,Ls,Nt,rt,Ft,it,nt,Xe,Gt,li,tt,ze,Mt,Bi,Kn,_t,wr,Bt,Ws,ti,ei,ll,La,cl,Aa,Qr,Ra,Zs,Js,Rf,Da,ut],styles:[".ventas-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.cliente[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.cliente-tel[_ngcontent-%COMP%]{font-size:large}.cliente-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:700;padding:10px 15px;border-radius:5px;margin-left:15px}.consultar-precio[_ngcontent-%COMP%]{margin-left:auto}.productos-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;flex-wrap:wrap;border-bottom:2px solid #0453b3}.productos-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.productos-container[_ngcontent-%COMP%]   .subtitulo[_ngcontent-%COMP%]{margin:0 6px 0 0}.input-text.input-cb[_ngcontent-%COMP%]{height:40px;padding:8px 10px;width:180px;margin-right:5rem}.wide-field[_ngcontent-%COMP%]{width:400px}.wider-field[_ngcontent-%COMP%]{width:340px}.wide-client[_ngcontent-%COMP%]{width:360px}.mr-field[_ngcontent-%COMP%]{margin-right:5rem}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}[_nghost-%COMP%]     .compact-field{transform:translateY(10px)}.total-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;margin-top:10px;padding:10px;border-top:2px solid #ccc;font-size:16px;line-height:1.5}.left[_ngcontent-%COMP%]{text-align:left;font-size:xx-large;color:#8a2be2}.center[_ngcontent-%COMP%]{text-align:center}.right[_ngcontent-%COMP%]{text-align:right;font-size:xx-large;color:#8a2be2}.botones-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px}.botones-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:45px;min-width:130px;font-size:16px;padding:6px 12px;border-radius:8px;vertical-align:middle;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 5px 15px #0000004d;text-align:center;width:400px;align-items:center;background-color:var(--fondo-modal);padding:5px}.select[_ngcontent-%COMP%]{width:300px;height:41px}.input-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1000;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.modal-dialog[_ngcontent-%COMP%]{width:400px;margin:auto}.show-modal[_ngcontent-%COMP%]{display:block!important}.input-field[_ngcontent-%COMP%]{flex-grow:1;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}.deshabilitado[_ngcontent-%COMP%]{opacity:.5!important;cursor:not-allowed!important;pointer-events:none!important}.cambio[_ngcontent-%COMP%]{font-size:30px;color:#030753;font-weight:700}.total-pago[_ngcontent-%COMP%]{font-size:20px;color:#030753;font-weight:700}.modal-body[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{text-align:left!important}.monedero-container[_ngcontent-%COMP%]{padding-top:1rem;border-top:1px solid rgb(3,7,83);border-bottom:1px solid rgb(3,7,83);color:#030753}.btns-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between!important;width:90%;border-top:1px solid rgb(3,7,83);padding:1rem}.button-container[_ngcontent-%COMP%]{flex-grow:1;text-align:center}.mr-2[_ngcontent-%COMP%]{margin-right:8px!important}.btn[_ngcontent-%COMP%]{width:1.7rem;margin-right:15px}.ventas-container[_ngcontent-%COMP%]{--thumb-w-base: 56px;--thumb-h-base: 56px;--thumb-w: calc(var(--thumb-w-base) * var(--thumb-scale));--thumb-h: calc(var(--thumb-h-base) * var(--thumb-scale))}.tabla[_ngcontent-%COMP%]{table-layout:fixed;width:100%}col.col-acciones[_ngcontent-%COMP%]{width:48px}col.col-img[_ngcontent-%COMP%]{width:var(--thumb-w)}col.col-cant[_ngcontent-%COMP%]{width:65px}col.col-precio[_ngcontent-%COMP%]{width:80px}col.col-imp-normal[_ngcontent-%COMP%]{width:110px}col.col-promo[_ngcontent-%COMP%]{width:160px}col.col-desc-porc[_ngcontent-%COMP%]{width:165px}col.col-monedero[_ngcontent-%COMP%]{width:75px}col.col-desc[_ngcontent-%COMP%]{width:80px}col.col-precio-final[_ngcontent-%COMP%]{width:115px}col.col-producto[_ngcontent-%COMP%]{width:auto}.col-img[_ngcontent-%COMP%]{text-align:center;padding:0}.img-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.img-button[_ngcontent-%COMP%]{background:transparent;border:0;padding:4px;position:relative;line-height:0;display:inline-block;width:var(--thumb-w)!important;height:var(--thumb-h)!important;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%!important;height:100%!important;object-fit:contain!important;max-width:100%}.col-acciones[_ngcontent-%COMP%]{text-align:center}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;align-items:center;justify-content:center}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row}}.img-button[_ngcontent-%COMP%]   .zoom-corner[_ngcontent-%COMP%]{position:absolute;right:6px;bottom:6px;background:#0000008c;color:#fff;border-radius:4px;padding:2px 4px;font-size:12px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:auto}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{vertical-align:middle}.consulta-img-wrap[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:8px 0 6px}.consulta-img-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:70%;max-height:220px;object-fit:contain;border-radius:6px;box-shadow:0 2px 10px #00000040}.col-acciones[_ngcontent-%COMP%]{width:48px;min-width:48px;text-align:center;vertical-align:middle}.acciones-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px}@media (max-width: 600px){.acciones-group[_ngcontent-%COMP%]{flex-direction:row;gap:8px}}.col-img[_ngcontent-%COMP%]{width:calc(var(--thumb-col-base) * var(--thumb-scale));min-width:calc(var(--thumb-col-base) * var(--thumb-scale))}.col-cant[_ngcontent-%COMP%]{width:70px}.col-precio[_ngcontent-%COMP%]{width:100px}.col-imp-normal[_ngcontent-%COMP%]{width:120px}.col-promo[_ngcontent-%COMP%]{width:150px}.col-desc-porc[_ngcontent-%COMP%], .col-monedero[_ngcontent-%COMP%]{width:80px}.col-desc[_ngcontent-%COMP%]{width:100px}.col-precio-final[_ngcontent-%COMP%]{width:120px}.col-producto[_ngcontent-%COMP%]{width:auto}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){white-space:normal;overflow-wrap:anywhere;line-height:1.3}.tabla[_ngcontent-%COMP%]   td.col-precio[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-imp-normal[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-monedero[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-desc[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td.col-precio-final[_ngcontent-%COMP%]{text-align:right}.titulo-row[_ngcontent-%COMP%]{margin-bottom:6px}.scale-select[_ngcontent-%COMP%]{width:120px}@media (max-width: 576px){.scale-select[_ngcontent-%COMP%]{width:100px}}"]})};function h2(i,t){if(i&1&&(l(0,"div",3),d(1," Resta: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function g2(i,t){if(i&1&&(l(0,"div",3),d(1," Pago final: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.pedido.pedido.total-e.pedido.pedido.aCuenta,"1.2-2"),"")}}function _2(i,t){if(i&1&&(l(0,"div",3),d(1," Dinero devuelto: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_();c(3),R("$",Y(4,1,e.pedido.pedido.aCuenta,"1.2-2"),"")}}function v2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido pronto se entregar\xE1"),s()())}function x2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido le ha sido entregado"),s()())}function b2(i,t){i&1&&(l(0,"div",8)(1,"strong"),d(2,"Su pedido fue CANCELADO"),s()())}var No=class i{pedido;fechaActual=new Date;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-pedido-ticket"]],inputs:{pedido:"pedido"},decls:36,vars:25,consts:[["id","ticketPedido",1,"ticket-impresion",2,"font-family","Roboto Condensed, Arial, sans-serif"],[3,"nombreFarmacia","direccion","telefono"],[1,"info-pedido"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["style","text-align: center;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[2,"text-align","center"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"div",2)(3,"div"),d(4,"Pedido: "),l(5,"strong"),d(6),s()(),l(7,"div",3),d(8,"Total: "),l(9,"strong"),d(10),F(11,"number"),s()(),l(12,"div",3),d(13,"Anticipo: "),l(14,"strong"),d(15),F(16,"number"),s()(),N(17,h2,5,4,"div",4)(18,g2,5,4,"div",4)(19,_2,5,4,"div",4),y(20,"hr"),N(21,v2,3,0,"div",5)(22,x2,3,0,"div",5)(23,b2,3,0,"div",5),y(24,"hr"),l(25,"div",6)(26,"div",7),d(27),s(),d(28),F(29,"date"),y(30,"br"),d(31),y(32,"br"),d(33),s(),y(34,"hr")(35,"app-ticket-footer"),s()()),e&2&&(c(),p("nombreFarmacia",n.pedido.farmaNombre)("direccion",n.pedido.farmaDireccion)("telefono",n.pedido.farmaTelefono),c(5),k(n.pedido.pedido.descripcion),c(4),R("$",Y(11,16,n.pedido.pedido.total,"1.2-2"),""),c(5),R("$",Y(16,19,n.pedido.pedido.aCuenta,"1.2-2"),""),c(2),p("ngIf",n.pedido.movimiento==="agregar"),c(),p("ngIf",n.pedido.movimiento==="surtir"),c(),p("ngIf",n.pedido.movimiento==="cancelar"),c(2),p("ngIf",n.pedido.movimiento==="agregar"),c(),p("ngIf",n.pedido.movimiento==="surtir"),c(),p("ngIf",n.pedido.movimiento==="cancelar"),c(4),R("Folio pedido: ",n.pedido.pedido.folio,""),c(),R(" Fecha: ",Y(29,22,n.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",n.pedido.userName,""),c(2),R(" Cliente: ",n.pedido.client||"P\xFAblico general"," "))},dependencies:[Ae,Be,Ct,Rt,tr,er],styles:[".info-general[_ngcontent-%COMP%]{font-size:14px!important}.info-pedido[_ngcontent-%COMP%]{font-size:16px!important}"]})};var Ke=hi(ki());var $e=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}($e||{}),En="*";function Zr(i,t){return{type:$e.Trigger,name:i,definitions:t,options:{}}}function ea(i,t=null){return{type:$e.Animate,styles:t,timings:i}}function up(i,t=null){return{type:$e.Sequence,steps:i,options:t}}function pn(i){return{type:$e.Style,styles:i,offset:null}}function nr(i,t,e){return{type:$e.State,name:i,styles:t,options:e}}function ta(i,t,e=null){return{type:$e.Transition,expr:i,animation:t,options:e}}var ir=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(t=0,e=0){this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},Jr=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(t){this.players=t;let e=0,n=0,r=0,a=this.players.length;a==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++e==a&&this._onFinish()}),o.onDestroy(()=>{++n==a&&this._onDestroy()}),o.onStart(()=>{++r==a&&this._onStart()})}),this.totalTime=this.players.reduce((o,u)=>Math.max(o,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){let e=t*this.totalTime;this.players.forEach(n=>{let r=n.totalTime?Math.min(1,e/n.totalTime):1;n.setPosition(r)})}getPosition(){let t=this.players.reduce((e,n)=>e===null||n.totalTime>e.totalTime?n:e,null);return t!=null?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},ja="!";var Wa=class i{constructor(t){this.http=t}apiUrl=`${Ge.apiUrl}/pedidos/`;obtenerPedidos(t,...e){let n;if(typeof t=="string"){let[o,u,m,f,h,g]=e;n={farmaciaId:t,fechaIni:o,fechaFin:u,folio:m,estado:f,descripcion:h,descripcionMinima:g}}else n=t;let r=new Ht().set("farmacia",n.farmaciaId),a=(o,u)=>{if(!o||!u)return;let m=new Date(o);r=r.set(u,m.toISOString().slice(0,10))};return a(n.fechaIni,"fechaInicio"),a(n.fechaFin,"fechaFin"),n.folio&&/^[A-Za-z0-9]{6}$/.test(n.folio)&&(r=r.set("folio",n.folio)),n.estado&&(r=r.set("estado",n.estado)),n.descripcion&&(r=r.set("descripcion",n.descripcion)),n.descripcionMinima!==void 0&&(r=r.set("descripcionMinima",String(!!n.descripcionMinima))),n.page&&(r=r.set("page",String(n.page))),n.limit&&(r=r.set("limit",String(n.limit))),n.sortBy&&(r=r.set("sortBy",n.sortBy)),n.sortDir&&(r=r.set("sortDir",(n.sortDir||"desc").toLowerCase())),n.clienteNombre&&(r=r.set("clienteNombre",n.clienteNombre)),n.clienteNull!==void 0&&(r=r.set("clienteNull",String(!!n.clienteNull))),this.http.get(this.apiUrl,{params:r})}agregarPedido(t){return this.http.post(this.apiUrl,t)}surtirPedido(t){let e=localStorage.getItem("auth_token"),n=new qe({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}surtir`,t,{headers:n})}cancelarPedido(t){let e=localStorage.getItem("auth_token"),n=new qe({"x-auth-token":e||"","Content-Type":"application/json"});return this.http.put(`${this.apiUrl}cancelar`,t,{headers:n})}actualizarCostoPedido(t,e){return this.http.patch(`${this.apiUrl}actualizar-costo/${t}`,{costo:e})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var y2=["contenedorTicket"];function C2(i,t){if(i&1){let e=ie();l(0,"button",22),E("click",function(){T(e);let r=_();return P(r.limpiarFiltroCompleto())}),y(1,"i",23),s()}}function S2(i,t){if(i&1){let e=ie();l(0,"button",24),E("click",function(){T(e);let r=_();return P(r.buscarSinFolio())}),d(1,"Buscar"),s()}if(i&2){let e=_();p("disabled",e.pedidos.length>0)}}function w2(i,t){i&1&&(l(0,"h2",25),d(1,"Pedidos pendientes de entrega"),s())}function E2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Levant\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k(e.usuarioPidio.nombre),c(2),R("",Ni(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")," ")}}function T2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Surti\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k(e.usuarioSurtio.nombre),c(2),R("",Ni(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City")," ")}}function P2(i,t){if(i&1&&(l(0,"tr")(1,"td",40),d(2,"Cancel\xF3:"),s(),l(3,"td",38),d(4),s(),l(5,"td",40),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k(e.usuarioCancelo.nombre),c(2),R("",Ni(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City")," ")}}function k2(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td",38)(2,"button",31),E("click",function(){T(e);let r=_(2).$implicit,a=_(2);return P(a.surtirPedido(r))}),y(3,"fa-icon",17),s()(),l(4,"td",38)(5,"button",32),E("click",function(){T(e);let r=_(2).$implicit,a=_(2);return P(a.CancelarPedido(r))}),y(6,"i",23),s()()()}i&2&&(c(3),p("icon","shopping-cart"))}function I2(i,t){if(i&1&&(l(0,"tr")(1,"td",35)(2,"div",36)(3,"table",37)(4,"thead")(5,"tr")(6,"th",38),d(7),s(),l(8,"th",38),d(9),F(10,"currency"),s()()(),l(11,"tbody")(12,"tr")(13,"td",39),d(14),F(15,"currency"),s(),l(16,"td",39),d(17),F(18,"currency"),s()(),l(19,"tr")(20,"td"),d(21,"Efectivo:"),s(),l(22,"td"),d(23),F(24,"currency"),s(),l(25,"td"),d(26,"Efectivo:"),s(),l(27,"td"),d(28),F(29,"currency"),s()(),l(30,"tr")(31,"td"),d(32,"Tarjeta:"),s(),l(33,"td"),d(34),F(35,"currency"),s(),l(36,"td"),d(37,"Tarjeta:"),s(),l(38,"td"),d(39),F(40,"currency"),s()(),l(41,"tr")(42,"td"),d(43,"Transferencia:"),s(),l(44,"td"),d(45),F(46,"currency"),s(),l(47,"td"),d(48,"Transferencia:"),s(),l(49,"td"),d(50),F(51,"currency"),s()(),l(52,"tr")(53,"td"),d(54,"Monedero:"),s(),l(55,"td"),d(56),F(57,"currency"),s(),l(58,"td"),d(59,"Monedero"),s(),l(60,"td"),d(61),F(62,"currency"),s()(),N(63,E2,8,6,"tr",34)(64,T2,8,6,"tr",34)(65,P2,8,6,"tr",34)(66,k2,7,1,"tr",34),s()()()()()),i&2){let e=_().$implicit,n=_(2);c(7),R("Estado: ",e.estado,""),c(2),R("Precio: ",oe(10,16,e.total),""),c(5),R("Anticipo: ",oe(15,18,e.aCuenta),""),c(3),R("Resta: ",oe(18,20,e.resta),""),c(6),k(oe(24,22,e.pagoACuenta.efectivo)),c(5),k(oe(29,24,e.pagoResta.efectivo)),c(6),k(oe(35,26,e.pagoACuenta.tarjeta)),c(5),k(oe(40,28,e.pagoResta.tarjeta)),c(6),k(oe(46,30,e.pagoACuenta.transferencia)),c(5),k(oe(51,32,e.pagoResta.transferencia)),c(6),k(oe(57,34,e.pagoACuenta.vale)),c(5),k(oe(62,36,e.pagoResta.vale)),c(2),p("ngIf",n.esAdmin),c(),p("ngIf",e.estado==="entregado"&&n.esAdmin),c(),p("ngIf",e.estado==="cancelado"&&n.esAdmin),c(),p("ngIf",e.estado==="inicial")}}function M2(i,t){if(i&1){let e=ie();at(0),l(1,"tr")(2,"td")(3,"button",28),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.pedidoDetalleAbiertoId===r._id?a.cerrarDetallePedido(r):a.abrirDetallePedido(r))}),y(4,"fa-icon",29),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"date"),s(),l(10,"td"),d(11),s(),l(12,"td"),d(13),s(),l(14,"td"),d(15),F(16,"currency"),s(),l(17,"td"),d(18),F(19,"currency"),s(),l(20,"td"),d(21),F(22,"currency"),s(),l(23,"td",30)(24,"button",31),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.surtirPedido(r))}),y(25,"fa-icon",17),s(),l(26,"button",32),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.CancelarPedido(r))}),y(27,"i",23),s(),l(28,"button",33),E("click",function(){T(e);let r=_(2);return P(r.limpiarFiltroCompleto())}),y(29,"fa-icon",17),s()()(),N(30,I2,67,38,"tr",34),ot()}if(i&2){let e=t.$implicit,n=_(2);c(3),p("matTooltip",n.pedidoDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),c(),p("icon",n.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",n.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),k(e.folio),c(2),k(Ni(9,13,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),c(3),k((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),c(2),k(e.descripcion),c(2),k(oe(16,17,e.total)),c(3),k(oe(19,19,e.aCuenta)),c(3),k(oe(22,21,e.resta)),c(4),p("icon","shopping-cart"),c(4),p("icon","eye-slash"),c(),p("ngIf",n.pedidoDetalleAbiertoId===e._id)}}function F2(i,t){if(i&1&&(l(0,"table",26)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th"),d(7,"F. pedido"),s(),l(8,"th"),d(9,"Cliente"),s(),l(10,"th"),d(11,"Descripci\xF3n"),s(),l(12,"th"),d(13,"Precio"),s(),l(14,"th"),d(15,"A cuenta"),s(),l(16,"th"),d(17,"Resta"),s(),l(18,"th"),d(19,"Acciones"),s()()(),l(20,"tbody"),N(21,M2,31,23,"ng-container",27),s()()),i&2){let e=_();c(21),p("ngForOf",e.pedidos)}}function A2(i,t){i&1&&(l(0,"p",41),d(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),s())}function O2(i,t){if(i&1&&y(0,"app-pedido-ticket",42),i&2){let e=_();p("pedido",e.paraImpresion)}}var ml=class i{constructor(t,e,n,r,a,o,u){this.library=t;this.pedidosService=e;this.authService=n;this.clienteService=r;this.FarmaciaService=a;this.cdr=o;this.ngZone=u;this.library.addIcons(Sn,Fa,Ma,_i)}contenedorTicket;pedidoTicketComp;pedidos=[];filtroFolio="";filtroDescripcion="";filtroFechaPedido="";esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmaciaId=null;farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";usuarioId="";usuarioRol="";usuarioNombre="";firmaAutorizada="";yaImprimio=!1;paraGuardar=null;folioGenerado=null;faTimes=_i;mostrarTicket=!1;paraImpresion=null;imprimirY(t){this.mostrarTicket=!0,this.cdr.detectChanges(),setTimeout(()=>{window.print(),this.mostrarTicket=!1,t()},300)}ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){Ke.default.fire("Error","No se encontr\xF3 la farmacia en localStorage","error");return}e&&(this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaTelefono=e.telefono,this.farmaciaDireccion=e.direccion);let n=this.authService.getUserData(),r=n?.rol,a=n?.nombre,o=n?.id;this.usuarioId=o,this.usuarioRol=r,this.usuarioNombre=a,this.authService.obtenerFirma(e._id).subscribe({next:u=>{this.firmaAutorizada=u.firma,console.log("La firma es: ",this.firmaAutorizada)},error:u=>{console.error("\u274C Error al obtener firma de farmacia:",u),Ke.default.fire("Error","No se pudo obtener la firma de la farmacia","error")}})}formatearFecha(t){let e=new Date(t),n=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${n}/${r}/${a}`}obtenerPedido(t){if(!this.farmaciaId){Ke.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio=t.trim(),/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.pedidosService.obtenerPedidos(this.farmaciaId,void 0,void 0,this.filtroFolio,"inicial").subscribe({next:e=>{this.pedidos=e.pedidos},error:e=>{console.error("Error al buscar por folio:",e),this.pedidos=[]}}):this.pedidos=[]}buscarSinFolio(){return Le(this,null,function*(){if(!this.farmaciaId){Ke.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.filtroFolio="";let t=this.filtroFechaPedido,e=this.filtroDescripcion?.trim();if(!t||!e){yield Ke.default.fire("Campos incompletos","Debes proporcionar fecha y descripci\xF3n para buscar sin folio.","warning");return}if(e.length<5){yield Ke.default.fire({icon:"info",title:"Descripci\xF3n muy corta",text:"Ingresa al menos 5 caracteres.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.pedidosService.obtenerPedidos(this.farmaciaId,t,void 0,void 0,"inicial",e,!0).subscribe({next:n=>{this.filtroFechaPedido="",this.filtroDescripcion="",!n.pedidos||n.pedidos.length===0?(Ke.default.fire({icon:"info",title:"No encontrado",text:`El d\xEDa ${t} no existe un pedido pendiente de entrega de ${e}`,timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[]):this.pedidos=n.pedidos},error:n=>{console.error("Error al buscar sin folio:",n),Ke.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.filtroFechaPedido="",this.filtroDescripcion=""}})})}limpiarFiltro(){this.filtroFolio=""}limpiarFiltroCompleto(){return Le(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroDescripcion="",this.pedidos=[]})}CancelarPedido(t){return Le(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){Ke.default.fire({icon:"success",title:"En pedidos entregados, NO se aceptan cancelaciones",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(t.estado==="cancelado"){Ke.default.fire({icon:"success",title:"El pedido ya fue cancelado con anterioridad.",html:`Fecha: ${this.formatearFecha(t.fechaCancelacion)}<br><br>Cancelado por: ${t.usuarioCancelo.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(t.cliente?this.nombreCliente=t.cliente.nombre:this.nombreCliente="P\xFAblico general",(yield Ke.default.fire({icon:"question",title:`Cancelar: ${t.folio}`,html:`<p><strong>Cliente:</strong></p><p><strong>${this.nombreCliente}</strong></p><p><strong>\xBFRealmente deseas CANCELAR el pedido de:</strong></p><p><strong>${t.descripcion}?</strong></p>`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed&&(yield Ke.default.fire({title:"Autorizaci\xF3n requerida",html:`
        <p style="color: rgb(3, 7, 83)";>Debes devolver en efectivo: <strong>$${(t.aCuenta-t.pagoACuenta.vale).toFixed(2)}</strong></p>
        <p style="color: rgb(3, 7, 83)";>Debes devolver en monedero: <strong>$${t.pagoACuenta.vale.toFixed(2)}</strong></p>
        <div id="firma-container"></div>
      `,didOpen:()=>{let r=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("id","firma-autorizada"),r.setAttribute("placeholder","Ingrese la firma"),r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),r.setAttribute("class","swal2-input"),r.setAttribute("style","font-family: text-security-disc, sans-serif; -webkit-text-security: disc;"),r.setAttribute("name","firma_"+Date.now()),r.focus(),document.getElementById("firma-container")?.appendChild(r)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Le(this,null,function*(){let r=Ke.default.getConfirmButton(),a=document.getElementById("firma-autorizada")?.value?.trim();if(!a)return Ke.default.showValidationMessage("Debes ingresar la firma para continuar."),!1;try{return(yield Ti(this.FarmaciaService.verificarFirma(this.farmaciaId,a))).autenticado?!0:(Ke.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),!1)}catch(o){return Ke.default.showValidationMessage("Error al verificar la firma."),console.error(o),!1}finally{r&&(r.disabled=!1)}})})).isConfirmed){let r={folio:t.folio},a=Qe({},t);this.paraImpresion={pedido:a,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"cancelar"},this.imprimirY(()=>{this.pedidosService.cancelarPedido(r).subscribe({next:()=>{Ke.default.fire({icon:"success",title:"Pedido cancelado correctamente",confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto()},error:o=>{console.error("Error al cancelar pedido:",o),Ke.default.fire({icon:"error",title:"Error",text:o.error?.mensaje||"No se pudo cancelar el pedido"})}})})}})}surtirPedido(t){return Le(this,null,function*(){if(this.pedidoDetalleAbiertoId=null,t.estado==="entregado"){Ke.default.fire({icon:"success",title:"El pedido ya fue entregado",html:`Fecha: ${this.formatearFecha(t.fechaEntrega)}<br><br>Entregado por: ${t.usuarioSurtio.nombre}`,confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}t.cliente?(this.nombreCliente=t.cliente.nombre,this.idCliente=t.cliente._id,this.totalMonedero=t.cliente.totalMonedero):(this.nombreCliente="P\xFAblico general",this.idCliente="",this.totalMonedero=0);let e=yield this.mostrarModalPago(t.resta,"Captura del resto","Faltante","Guardar");if(!e)return;let n={folio:t.folio,pagoResta:{efectivo:t.resta-(e.tarjeta+e.transferencia+e.vale),tarjeta:e.tarjeta,transferencia:e.transferencia,vale:e.vale}},r=jt(Qe({},t),{pagoResta:Qe({},n.pagoResta)});this.paraImpresion={pedido:r,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"surtir"},this.imprimirY(()=>{this.pedidosService.surtirPedido(n).subscribe({next:a=>Le(this,null,function*(){yield Ke.default.fire({icon:"success",title:"\xC9xito",html:"<h3>Pedido surtido y registrado correctamente</h3>",confirmButtonText:"Continuar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto()}),error:a=>{console.error("Error al surtir pedido:",a),Ke.default.fire({icon:"error",title:"Error",text:a.error?.mensaje||"No se pudo surtir el pedido"})}})})})}agregarPedido(){return Le(this,null,function*(){this.pedidoDetalleAbiertoId=null;let t=yield this.capturarCliente();if(t===null)return;let e=t==="sin-cliente"?null:t._id;t==="sin-cliente"?(this.nombreCliente="P\xFAblico general",this.totalMonedero=0):(this.nombreCliente=t.nombre,this.totalMonedero=t.totalMonedero);let n=yield this.solicitarDatosPedido();if(!n)return;let{descripcion:r,total:a,anticipo:o}=n,u=yield this.mostrarModalPago(o,"Captura del pago a cuenta","Anticipo","Imprimir");if(!u)return;let m=u.efectivo+u.tarjeta+u.transferencia+u.vale,f=this.folioGenerado||this.generarFolioLocal();this.folioGenerado=f,this.paraGuardar={folio:this.folioGenerado,farmacia:this.farmaciaId,clienteId:e,usuarioPidio:this.usuarioId,descripcion:r,total:a,aCuenta:m,pagoACuenta:u},this.paraImpresion={pedido:this.paraGuardar,farmaNombre:this.farmaciaNombre,farmaDireccion:this.farmaciaDireccion,farmaTelefono:this.farmaciaTelefono,userName:this.usuarioNombre,client:this.nombreCliente,movimiento:"agregar"},this.mostrarTicket=!0,this.cdr.detectChanges(),setTimeout(()=>{document.getElementById("ticketPedido")?(window.print(),this.mostrarTicket=!1,this.guardarPedido()):console.warn("\u274C Ticket a\xFAn no est\xE1 renderizado")},300)})}guardarPedido(){this.pedidosService.agregarPedido(this.paraGuardar).subscribe({next:t=>Le(this,null,function*(){yield Ke.default.fire({icon:"success",title:"\xC9xito",html:"<h3><strong>Pedido agregado correctamente</strong></h3>",confirmButtonText:"Aceptar",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.limpiarFiltroCompleto(),this.folioGenerado=""}),error:t=>{let e=t.error?.mensaje||t.error?.message||"Falla en el sistema";Ke.default.fire({icon:"error",title:"Error al registrar pedido",html:`<p>${e}</p>
                  <p><strong>No se registr\xF3 el pedido</strong></p>`,confirmButtonText:"Continuar",allowOutsideClick:!1,allowEscapeKey:!1})}})}yyyymmddLocal(t=new Date){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}${n}`}generarFolioLocal(){let t="FBPed",e=this.yyyymmddLocal(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";for(let a=0;a<6;a++){let o=Math.floor(Math.random()*n.length);r+=n[o]}return`${t}${e}-${r}`}solicitarDatosPedido(){return Le(this,null,function*(){let{value:t}=yield Ke.default.fire({title:"Nuevo pedido",html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><input id="swal-input-descripcion" class="swal2-input" placeholder="Descripci\xF3n del pedido"><input id="swal-input-total" class="swal2-input" type="number" min="0" placeholder="Total $"><input id="swal-input-anticipo" class="swal2-input" type="number" min="0" placeholder="Anticipo $">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let e=document.getElementById("swal-input-descripcion").value.trim(),n=document.getElementById("swal-input-total").value.trim(),r=parseFloat(n),a=document.getElementById("swal-input-anticipo").value.trim(),o=parseFloat(a);if(!e||isNaN(r)||r<=0||isNaN(o)||o<=0){Ke.default.showValidationMessage("Completa todos los campos correctamente");return}if(o>r){Ke.default.showValidationMessage("El anticipo no puede ser mayor que el total a pagar");return}return{descripcion:e,total:r,anticipo:o}}});return t||null})}mostrarModalPago(t,e,n,r){return Le(this,null,function*(){let{value:a}=yield Ke.default.fire({title:e,html:`<p style = "color: blue"><strong>${this.nombreCliente}</strong></p><h2><strong>${n} a pagar:</strong> $${t}</h2><input id="swal-efectivo" type="number" class="swal2-input" placeholder="Efectivo" min="0"><input id="swal-tarjeta" type="number" class="swal2-input" placeholder="Tarjeta" min="0"><input id="swal-transferencia" type="number" class="swal2-input" placeholder="Transferencia" min="0">`+(this.totalMonedero>0?`<label style="color: rgb(3, 7, 83); font-weight: bold; font-size: large; display: block; margin-top: 14px;">
                    Tiene en monedero: $${this.totalMonedero.toFixed(2)}
            </label>
            <input id="swal-vale" type="number" class="swal2-input" style="margin-top: 2px; width: 50%"
              placeholder="monedero"
              min="0"
              max="${this.totalMonedero}">`:""),focusConfirm:!1,showCancelButton:!0,confirmButtonText:r,cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let o=parseFloat(document.getElementById("swal-efectivo").value)||0,u=parseFloat(document.getElementById("swal-tarjeta").value)||0,m=parseFloat(document.getElementById("swal-transferencia").value)||0,f=document.getElementById("swal-vale"),h=f&&parseFloat(f.value)||0,g=u+m+h;if(h>this.totalMonedero)return Ke.default.showValidationMessage(`El monto del monedero no puede ser mayor a $${this.totalMonedero.toFixed(2)}`),!1;if(g>t){Ke.default.showValidationMessage(`El pago con tarjeta + transferencia + monedero = $${g} no puede exceder de ($${t})`);return}if(g===t&&o>0){Ke.default.showValidationMessage("Revisa bien los montos, el pago es excesivo");return}if(g+o<t){Ke.default.showValidationMessage("El pago a\xFAn no es suficiente");return}return{efectivo:o,tarjeta:u,transferencia:m,vale:h}}});if(a){let u=a.efectivo+a.tarjeta+a.transferencia+a.vale-t;a.efectivo=a.efectivo-u,u>0&&(yield Ke.default.fire({icon:"info",html:`<h1><strong>$${u.toFixed(2)}</strong></h1>`,title:"favor de entregar el cambio",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}))}return a||null})}capturarCliente(){return Le(this,null,function*(){for(;;){let t=yield Ke.default.fire({title:"Buscar cliente",input:"text",inputLabel:"Tel\xE9fono del cliente (opcional)",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Buscar cliente",denyButtonText:"Continuar sin cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:r=>{let a=r?.trim();return a?/^\d{10}$/.test(a)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":null}});if(t.isDismissed)return null;if(t.isDenied)return"sin-cliente";let e=t.value?.trim();if(!e)continue;let n=yield this.buscarClientePorTelefono(e);if(n){if((yield Ke.default.fire({title:"Cliente encontrado",html:`<p style = "color: blue"><strong>${n.nombre}</strong></p><p>\xBFDeseas continuar con este cliente?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return n}else if(yield this.preguntarCrearCliente(e)){let a=yield this.mostrarModalAltaCliente(e);if(a)return a}}})}buscarClientePorTelefono(t){return Le(this,null,function*(){try{return yield Ti(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}preguntarCrearCliente(t){return Le(this,null,function*(){return(yield Ke.default.fire({title:"Cliente no encontrado",text:`\xBFDeseas dar de alta un nuevo cliente con el tel\xE9fono ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, crear",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed})}mostrarModalAltaCliente(t){return Le(this,null,function*(){let{value:e}=yield Ke.default.fire({title:"Nuevo cliente",html:'<input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let r=document.getElementById("swal-input-nombre").value.trim(),a=document.getElementById("swal-input-domicilio").value.trim();if(!r){Ke.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:r,domicilio:a}}});if(!e)return null;let n={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let r=yield Ti(this.clienteService.crearCliente(n));return Ke.default.fire("\xC9xito","Cliente registrado correctamente","success"),r}catch{return Ke.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}static \u0275fac=function(e){return new(e||i)(te(bi),te(Wa),te(qt),te(wn),te(Zt),te(Wt),te(Yi))};static \u0275cmp=Te({type:i,selectors:[["app-pedidos"]],viewQuery:function(e,n){if(e&1&&(Ot(y2,5),Ot(No,5)),e&2){let r;St(r=wt())&&(n.contenedorTicket=r.first),St(r=wt())&&(n.pedidoTicketComp=r.first)}},decls:31,vars:12,consts:[[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","align-items-center","filter-container"],[1,"col-md-1","text-end"],["for","filtroFolio",1,"lbl-folio-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-2","position-relative"],["type","text","id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio del pedido","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFolio",1,"lbl-folio-pedido"],[1,"col-md-2"],["type","date",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Descripci\xF3n...","minlength","5","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-md-1"],["class","btn-gris",3,"disabled","click",4,"ngIf"],[1,"col-2","text-end"],["matTooltip","Levantar un pedido",1,"btn-verde",3,"click"],[3,"icon"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["class","ticket-impresion",3,"pedido",4,"ngIf"],["matTooltip","Limpiar folio del pedido",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fas","fa-times"],[1,"btn-gris",3,"click","disabled"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[1,"d-flex","gap-1","align-items-center"],["matTooltip","Surtir pedido",1,"btn-verde","btn-icono",3,"click"],["matTooltip","Cancelar pedido",1,"btn-rojo-tache","btn-icono",3,"click"],["matTooltip","Cierra la tabla",1,"btn-gris","btn-icono",3,"click"],[4,"ngIf"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","2",1,"sub-title-tabla"],["colspan","1"],[1,"no-found-error"],[1,"ticket-impresion",3,"pedido"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Pedidos"),s()(),l(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Folio:"),s()(),l(8,"div",6)(9,"input",7),Z("ngModelChange",function(a){return J(n.filtroFolio,a)||(n.filtroFolio=a),a}),E("ngModelChange",function(a){return n.obtenerPedido(a)}),s(),N(10,C2,2,0,"button",8),s(),l(11,"div",4)(12,"label",9),d(13,"Fecha:"),s()(),l(14,"div",10)(15,"input",11),Z("ngModelChange",function(a){return J(n.filtroFechaPedido,a)||(n.filtroFechaPedido=a),a}),s()(),l(16,"div",4)(17,"label",9),d(18,"Descripci\xF3n:"),s()(),l(19,"div",10)(20,"input",12),Z("ngModelChange",function(a){return J(n.filtroDescripcion,a)||(n.filtroDescripcion=a),a}),s()(),l(21,"div",13),N(22,S2,2,1,"button",14),s(),l(23,"div",15)(24,"button",16),E("click",function(){return n.agregarPedido()}),d(25," Agregar Pedido "),y(26,"fa-icon",17),s()()(),N(27,w2,2,0,"h2",18)(28,F2,22,1,"table",19)(29,A2,2,0,"p",20),s(),N(30,O2,1,1,"app-pedido-ticket",21)),e&2&&(c(9),Q("ngModel",n.filtroFolio),c(),p("ngIf",n.filtroFolio),c(5),Q("ngModel",n.filtroFechaPedido),p("disabled",n.pedidos.length>0),c(5),Q("ngModel",n.filtroDescripcion),p("disabled",n.pedidos.length>0),c(2),p("ngIf",n.filtroFechaPedido&&n.filtroDescripcion),c(4),p("icon","plus"),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.filtroFolio.length===6&&n.pedidos.length===0),c(),p("ngIf",n.paraImpresion&&n.mostrarTicket))},dependencies:[ti,ei,rt,Xe,ze,ka,Um,Ia,zs,_t,Ae,si,We,Be,Nt,Rt,No,Lt,ut],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-folio-pedido[_ngcontent-%COMP%]{font-size:large}"],data:{animation:[Zr("expandCollapse",[nr("true",pn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",pn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),ta("true <=> false",ea("300ms ease-in-out"))])]}})};var ui=hi(ki());function D2(i,t){if(i&1&&(at(0),l(1,"tr")(2,"td",4)(3,"span",13),d(4),s()()(),l(5,"tr")(6,"td"),d(7),F(8,"number"),s(),l(9,"td"),d(10),s(),l(11,"td",6),d(12),F(13,"number"),s()(),l(14,"tr")(15,"td",4),d(16),s()(),ot()),i&2){let e=t.$implicit;c(4),R(" ",e.barrasYNombre||(e.producto==null?null:e.producto.nombre)," "),c(3),R("$",Y(8,5,e.precio,"1.2-2"),""),c(3),k(e.cantidad),c(2),R("$",Y(13,8,e.precio*e.cantidad,"1.2-2")," "),c(4),R("Motivo: ",e.motivo,"")}}function R2(i,t){if(i&1&&(l(0,"strong"),d(1),F(2,"number"),s()),i&2){let e=_(3);c(),R("+$",Y(2,1,e.venta.monederoIngreso,"1.2-2"),"")}}function N2(i,t){if(i&1&&(l(0,"span"),d(1," \u2014 "),l(2,"strong"),d(3),F(4,"number"),s(),d(5," (reverso) "),s()),i&2){let e=_(3);c(3),R("-$",Y(4,1,e.venta.monederoReverso,"1.2-2"),"")}}function B2(i,t){if(i&1&&(l(0,"div",6),d(1," Saldo antes: "),l(2,"strong"),d(3),F(4,"number"),s(),d(5," \xA0|\xA0 Saldo final: "),l(6,"strong"),d(7),F(8,"number"),s()()),i&2){let e=_(3);c(3),R("$",Y(4,2,e.venta.monederoSaldoAntes,"1.2-2"),""),c(4),R("$",Y(8,5,e.venta.monederoSaldoDespues,"1.2-2"),"")}}function L2(i,t){if(i&1&&(at(0),l(1,"div",6),d(2," Monedero: "),N(3,R2,3,4,"strong",9)(4,N2,6,4,"span",9),s(),N(5,B2,9,8,"div",14),ot()),i&2){let e=_(2);c(3),p("ngIf",e.venta.monederoIngreso),c(),p("ngIf",e.venta.monederoReverso&&e.venta.monederoReverso>0),c(),p("ngIf",e.venta.monederoSaldoAntes!==void 0)}}function V2(i,t){if(i&1&&(l(0,"div",15),d(1," Devoluci\xF3n de efectivo: "),l(2,"strong"),d(3),F(4,"number"),s()()),i&2){let e=_(2);c(3),R("$",Y(4,1,e.venta.totalDevolverEfectivo,"1.2-2"),"")}}function U2(i,t){if(i&1&&(l(0,"div",1),y(1,"app-ticket-header",2)(2,"hr"),l(3,"table",3)(4,"thead")(5,"tr")(6,"th",4),d(7,"PRODUCTO DEVUELTO"),s()(),l(8,"tr",5)(9,"th"),d(10,"P.UNIT"),s(),l(11,"th"),d(12,"CANT"),s(),l(13,"th",6),d(14,"IMPORTE"),s()()(),l(15,"tbody"),N(16,D2,17,11,"ng-container",7),s()(),y(17,"hr"),l(18,"div",8)(19,"div",6),d(20," Total: "),l(21,"strong"),d(22),F(23,"number"),s()(),N(24,L2,6,3,"ng-container",9)(25,V2,5,4,"div",10),s(),y(26,"hr"),l(27,"div",11)(28,"div",12),d(29),s(),d(30),F(31,"date"),y(32,"br"),d(33),y(34,"br"),d(35),s(),y(36,"hr")(37,"app-ticket-footer"),s()),i&2){let e=_();c(),p("nombreFarmacia",e.venta.farmacia.nombre)("direccion",e.venta.farmacia.direccion)("telefono",e.venta.farmacia.telefono),c(15),p("ngForOf",e.venta.devolucion.productosDevueltos),c(6),R("$",Y(23,11,e.venta.totalADevolver,"1.2-2"),""),c(2),p("ngIf",e.venta.monederoIngreso||e.venta.monederoReverso),c(),p("ngIf",e.venta.totalDevolverEfectivo>0),c(4),R("Folio venta: ",e.venta.devolucion.folioVenta,""),c(),R(" Fecha devoluci\xF3n: ",Y(31,14,e.fechaActual,"dd/MM/yyyy HH:mm")," hrs."),c(3),R(" Atendi\xF3: ",e.venta.usuario,""),c(2),R(" Cliente: ",e.venta.cliente||"P\xFAblico general"," ")}}var fl=class i{venta;fechaActual=new Date;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-devolucion-ticket"]],inputs:{venta:"venta"},decls:1,vars:1,consts:[["class","ticket-impresion",4,"ngIf"],[1,"ticket-impresion"],[3,"nombreFarmacia","direccion","telefono"],[1,"productos"],["colspan","3"],[1,"productos-header-bottom"],[2,"text-align","right"],[4,"ngFor","ngForOf"],[1,"totales"],[4,"ngIf"],["style","text-align: right; font-size: larger;",4,"ngIf"],[1,"info-general"],[2,"font-size","15px"],[1,"producto-nombre"],["style","text-align: right;",4,"ngIf"],[2,"text-align","right","font-size","larger"]],template:function(e,n){e&1&&N(0,U2,38,17,"div",0),e&2&&p("ngIf",n.venta)},dependencies:[Ae,We,Be,Ct,Rt,tr,er],styles:[".info-general[_ngcontent-%COMP%], .totales[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}.productos-header-bottom[_ngcontent-%COMP%]{border-bottom:1px solid black}hr[_ngcontent-%COMP%]{border:none;border-top:1px dashed #000;margin:8px 0}.producto-nombre[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:100%;max-width:100%;box-sizing:border-box;padding:0 2px}"]})};var pl=class i{constructor(t){this.http=t}apiUrl=`${Ge.apiUrl}`;buscarVentaPorCodigo(t){return this.http.get(`${this.apiUrl}/devoluciones/buscarVenta/${t}`)}registrarDevolucion(t){return this.http.post(`${this.apiUrl}/devoluciones/registrar`,t)}obtenerVentasRecientes(t,e){let n=new Ht;return e&&/^[A-Za-z0-9]{6}$/.test(e)&&(n=n.set("folio",e)),this.http.get(`${this.apiUrl}/ventasRecientes/${t}`,{params:n})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var W2=["contenedorTicket"],H2=i=>({"checkbox-disabled":i});function z2(i,t){if(i&1){let e=ie();l(0,"button",15),E("click",function(){T(e);let r=_();return P(r.limpiarFolio())}),y(1,"fa-icon",16),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function $2(i,t){i&1&&(l(0,"h2",17),d(1,"Datos de la venta"),s())}function G2(i,t){if(i&1&&(l(0,"option",32),d(1),s()),i&2){let e=t.$implicit,n=t.index;p("ngValue",n),c(),k(e)}}function q2(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td")(2,"input",27),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.seleccionado,r)||(a.seleccionado=r),P(r)}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"currency"),s(),l(10,"td"),d(11),s(),l(12,"td")(13,"input",28),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.cantidadDevuelta,r)||(a.cantidadDevuelta=r),P(r)}),s()(),l(14,"td")(15,"select",29),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.motivoIndex,r)||(a.motivoIndex=r),P(r)}),l(16,"option",30),d(17,"Seleccione motivo"),s(),N(18,G2,2,2,"option",31),s()()()}if(i&2){let e=t.$implicit,n=_(4);c(2),Q("ngModel",e.seleccionado),p("disabled",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("ngClass",gi(19,H2,n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Editar cant. a devolver y motivo"),c(2),k(e.producto.nombre),c(2),k(e.cantidad),c(2),k(oe(9,17,e.precio)),c(3),k(e.tipoDescuento),c(2),p("max",e.cantidad),Q("ngModel",e.cantidadDevuelta),p("disabled",!e.seleccionado||n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Modificar cantidad"),c(2),Q("ngModel",e.motivoIndex),p("disabled",!e.seleccionado||n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria))("title",n.esPromocionNoReembolsable(e.tipoDescuento,e.producto.categoria)?"No se permite devoluci\xF3n en promo 2x1, 3x2 \xF3 4x3":"Elegir motivo"),c(),p("ngValue",null),c(2),p("ngForOf",n.motivosDevolucion)}}function X2(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td",23)(2,"div",24)(3,"h5"),d(4,"Selecciona productos a devolver"),s(),l(5,"table",25)(6,"thead")(7,"tr"),y(8,"th"),l(9,"th"),d(10,"Producto"),s(),l(11,"th"),d(12,"Cant."),s(),l(13,"th"),d(14,"P. U. c/dcto"),s(),l(15,"th"),d(16,"Promo"),s(),l(17,"th"),d(18,"Devolver"),s(),l(19,"th"),d(20,"Motivo de devoluci\xF3n"),s()()(),l(21,"tbody"),N(22,q2,19,21,"tr",19),s()(),l(23,"button",26),E("click",function(){T(e);let r=_().$implicit,a=_(2);return P(a.confirmarDevolucion(r))}),d(24," Confirmar devoluci\xF3n "),s()()()()}if(i&2){let e=_().$implicit;c(22),p("ngForOf",e.productos)}}function K2(i,t){if(i&1){let e=ie();at(0),l(1,"tr")(2,"td")(3,"button",20),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.ventaDetalleAbiertoId===r._id?a.cerrarDetalleVenta(r):a.abrirDetalleVenta(r))}),y(4,"fa-icon",21),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),F(11,"currency"),s(),l(12,"td"),d(13),F(14,"currency"),s(),l(15,"td"),d(16),s(),l(17,"td"),d(18),F(19,"date"),s()(),N(20,X2,25,1,"tr",22),ot()}if(i&2){let e=t.$implicit,n=_(2);c(3),p("matTooltip",n.ventaDetalleAbiertoId===e._id?"Ocultar detalle":"Ver detalle"),c(),p("icon",n.ventaDetalleAbiertoId===e._id?"minus":"plus")("ngClass",n.ventaDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),k(e.folio),c(2),k((e.cliente==null?null:e.cliente.nombre)||"Mostrador"),c(2),k(oe(11,10,e.total)),c(3),k(oe(14,12,e.totalDescuento)),c(3),k(e.cantidadProductos),c(2),k(Ni(19,14,e.fecha,"dd/MM/yyyy","America/Mexico_City")),c(2),p("ngIf",n.ventaDetalleAbiertoId===e._id)}}function Y2(i,t){if(i&1&&(l(0,"table",18)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th"),d(7,"Cliente"),s(),l(8,"th"),d(9,"Total"),s(),l(10,"th"),d(11,"Total Descuento"),s(),l(12,"th"),d(13,"# Art."),s(),l(14,"th"),d(15,"Fecha"),s()()(),l(16,"tbody"),N(17,K2,21,18,"ng-container",19),s()()),i&2){let e=_();c(17),p("ngForOf",e.ventas)}}function Q2(i,t){i&1&&(l(0,"p",33),d(1," No se encontr\xF3 ninguna venta con ese folio en los \xFAltimos 7 d\xEDas. "),s())}function J2(i,t){if(i&1&&y(0,"app-devolucion-ticket",34),i&2){let e=_();p("venta",e.paraImpresion)}}var hl=class i{constructor(t,e,n,r,a){this.devolucionService=t;this.clienteService=e;this.FarmaciaService=n;this.library=r;this.authService=a;this.library.addIcons(Sn,Fa,_i)}contenedorTicket;ventas=[];esCliente=!1;pagoVentaEnEfectivo=0;pagoVentaEnElectronico=0;filtroFolio="";farmaciaId="";farmaciaNombre="";farmaciaDireccion="";farmaciaTelefono="";usuarioId="";usuarioRol="";usuarioNombre="";ventaDetalleAbiertoId=null;idCliente=null;nombreCliente=null;motivosDevolucion=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];firmaAutorizada="";mostrarTicket=!1;paraImpresion=null;paraGuardar=null;faTimes=_i;ngOnInit(){let t=localStorage.getItem("user_farmacia"),e=t?JSON.parse(t):null;if(!e){ui.default.fire("Error","No se ha seleccionado una farmacia activa","error");return}this.farmaciaId=e._id,this.farmaciaNombre=e.nombre,this.farmaciaDireccion=e.direccion,this.farmaciaTelefono=e.telefono;let n=this.authService.getUserData(),r=n?.rol,a=n?.nombre,o=n?.id;this.usuarioId=o,this.usuarioRol=r,this.usuarioNombre=a,this.authService.obtenerFirma(e._id).subscribe({next:u=>{this.firmaAutorizada=u.firma},error:u=>{console.error("\u274C Error al obtener firma de farmacia:",u),ui.default.fire("Error","No se pudo obtener la firma de la farmacia","error")}})}onFolioChange(t){this.filtroFolio=t.trim(),this.idCliente=null,/^[A-Za-z0-9]{6}$/.test(this.filtroFolio)?this.devolucionService.obtenerVentasRecientes(this.farmaciaId,this.filtroFolio).subscribe({next:e=>{if(e.length===0){this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1;return}let n=e[0];this.ventas=[n],this.pagoVentaEnEfectivo=n.formaPago.efectivo||0,this.pagoVentaEnElectronico=(n.formaPago.tarjeta||0)+(n.formaPago.transferencia||0)+(n.formaPago.vale||0),this.esCliente=!!n.cliente,this.esCliente&&(this.idCliente=n.cliente._id)},error:e=>{console.error("Error al buscar por folio:",e),this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1}}):(this.ventas=[],this.pagoVentaEnEfectivo=0,this.pagoVentaEnElectronico=0,this.esCliente=!1)}toNum=t=>Number(t??0)||0;round2=t=>Math.round((t+Number.EPSILON)*100)/100;calcularProporcionVale(t){let e=this.toNum(t?.formaPago.vale),n=this.toNum(t?.formaPago.efectivo),r=this.toNum(t?.formaPago.tarjeta),a=this.toNum(t?.formaPago.transferencia),o=this.round2(e+n+r+a),u=0;return o>0&&e>0&&(u=Math.max(0,Math.min(1,e/o))),{pagoMonedero:e,pagoEfectivo:n,pagoTarjeta:r,pagoTransferencia:a,totalPagado:o,proporcionVale:u}}calcReversoMonedero(t,e){let n=0;for(let r of e){let a=r.producto?._id??r.producto,o=(t.productos||[]).find(h=>String(h.producto?._id??h.producto)===String(a));if(!o)continue;let u=this.toNum(o.monederoCliente),m=this.toNum(o.cantidad),f=this.toNum(r.cantidadDevuelta);u>0&&m>0&&f>0&&(n+=u*(f/m))}return this.round2(n)}confirmarDevolucion(t){return Le(this,null,function*(){let e=(t.productos||[]).filter(C=>C.seleccionado&&this.toNum(C.cantidadDevuelta)>0);if(e.length===0){yield ui.default.fire("Aviso","Selecciona al menos un producto con cantidad v\xE1lida","info");return}let n=e.filter(C=>C.motivoIndex==null||typeof C.motivoIndex!="number"||C.motivoIndex<0||!this.motivosDevolucion?.[C.motivoIndex]);if(n.length>0){let C=n.map(U=>U.producto.nombre).join(", ");yield ui.default.fire("Aviso",`Debes indicar un motivo de devoluci\xF3n para: ${C}`,"warning");return}let r=this.round2(e.reduce((C,U)=>C+this.toNum(U.cantidadDevuelta)*this.toNum(U.precio),0)),{proporcionVale:a}=this.calcularProporcionVale(t),o=this.round2(r*a),u=this.round2(r-o);if(this.esCliente=!!t?.cliente,this.esCliente?(this.idCliente=t.cliente._id,this.nombreCliente=t.cliente.nombre):(this.idCliente=null,this.nombreCliente=""),!this.esCliente&&o>0){let C=yield this.capturarTelefono();if(!C)return;this.esCliente=!0,this.idCliente=C._id,this.nombreCliente=C.nombre}let m=0;if(this.esCliente&&this.idCliente)try{let C=yield Ti(this.clienteService.getClienteById(this.idCliente));m=this.toNum(C?.totalMonedero)}catch{m=0}let f=this.calcReversoMonedero(t,e),h=this.round2(Math.min(f,m+o)),g=o,v=h,b=this.round2(g-v),w=this.round2(m+b);(yield ui.default.fire({title:"Autorizaci\xF3n requerida",html:`
      <p style="color: blue"><strong>Cliente: </strong>${this.nombreCliente||"\u2014"}</p>
      <h4>Debes devolver en total: <strong>$${r.toFixed(2)}</strong></h4>
      <h2>Monedero: <strong>$${o.toFixed(2)}</strong></h2>
      <h2 style="color: red">Efectivo: <strong>$${u.toFixed(2)}</strong></h2>
      <div id="firma-container"></div>
    `,didOpen:()=>{let C=document.createElement("input");C.type="text",C.id="firma-autorizada",C.placeholder="Ingrese la firma",C.autocomplete="off",C.autocapitalize="off",C.spellcheck=!1,C.className="swal2-input",C.style.fontFamily="text-security-disc, sans-serif",C.style.webkitTextSecurity="disc",C.name="firma_"+Date.now(),C.focus(),document.getElementById("firma-container")?.appendChild(C)},focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>Le(this,null,function*(){let C=ui.default.getConfirmButton();C&&(C.disabled=!0);let U=document.getElementById("firma-autorizada")?.value?.trim();if(yield new Promise(j=>setTimeout(j,200)),!U)return ui.default.showValidationMessage("Debes ingresar la firma para continuar."),C&&(C.disabled=!1),!1;try{return(yield Ti(this.FarmaciaService.verificarFirma(this.farmaciaId,U))).autenticado?!0:(ui.default.showValidationMessage("Firma incorrecta. Verifica con el encargado."),C&&(C.disabled=!1),!1)}catch(j){return console.error("\u274C Error al verificar firma:",j),ui.default.showValidationMessage("Error al verificar la firma. Intenta m\xE1s tarde."),C&&(C.disabled=!1),!1}})})).isConfirmed&&(this.paraGuardar={folioVenta:t.folio,farmaciaQueDevuelve:this.farmaciaId,idCliente:this.idCliente,productosDevueltos:e.map(C=>{let U=this.motivosDevolucion[C.motivoIndex];return{producto:C.producto._id??C.producto,cantidad:this.toNum(C.cantidadDevuelta),motivoIndex:C.motivoIndex,motivo:U,precioXCantidad:this.round2(this.toNum(C.cantidadDevuelta)*this.toNum(C.precio))}})},this.paraImpresion={devolucion:{folioVenta:t.folio,fecha:new Date,productos:e.map(C=>({productoNombre:C.producto?.nombre,barrasYNombre:`${(C.producto?.codigoBarras||"").slice(-3)} ${C.producto?.nombre||""}`,cantidad:this.toNum(C.cantidadDevuelta),precio:this.toNum(C.precio),importe:this.round2(this.toNum(C.cantidadDevuelta)*this.toNum(C.precio)),motivo:this.motivosDevolucion[C.motivoIndex]}))},cliente:this.nombreCliente||"\u2014",totalADevolver:r,totalDevolverEfectivo:u,totalDevolverVales:o,monederoIngreso:g,monederoReverso:v,monederoSaldoAntes:m,monederoSaldoDespues:w,monederoCambioNeto:b,usuario:this.usuarioNombre,farmacia:{nombre:this.farmaciaNombre,direccion:this.farmaciaDireccion,telefono:this.farmaciaTelefono}},this.mostrarTicket=!0,setTimeout(()=>{this.contenedorTicket&&this.imprimirTicketReal()},200))})}imprimirTicketReal(){window.print(),this.mostrarTicket=!1,ui.default.fire({icon:"question",title:"\xBFSe imprimi\xF3 correctamente el ticket?",showCancelButton:!0,confirmButtonText:"S\xED, guardar devoluci\xF3n",cancelButtonText:"No, reintentar"}).then(t=>{t.isConfirmed?this.guardarDespuesDeImpresion():ui.default.fire("Atenci\xF3n","La devoluci\xF3n no ha sido registrada. Puedes reintentar la impresi\xF3n.","info")})}guardarDespuesDeImpresion(){this.devolucionService.registrarDevolucion(this.paraGuardar).subscribe({next:t=>{ui.default.fire("\xC9xito",t.mensaje||"Devoluci\xF3n registrada correctamente","success"),this.ventaDetalleAbiertoId=null,this.limpiarFolio()},error:t=>{ui.default.fire("Error",t.error?.mensaje||"No se pudo registrar la devoluci\xF3n","error")}})}capturarTelefono(){return Le(this,null,function*(){for(;;){let t=yield ui.default.fire({title:"Buscar al cliente que nos compr\xF3",input:"text",inputLabel:"Tel\xE9fono del cliente",inputPlaceholder:"Ej. 5544332211",showCancelButton:!0,confirmButtonText:"Buscar cliente",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,inputValidator:r=>{let a=r?.trim();return a?/^\d{10}$/.test(a)?null:"El tel\xE9fono debe contener exactamente 10 d\xEDgitos num\xE9ricos.":"El tel\xE9fono es obligatorio"}});if(t.isDismissed)return null;let e=t.value?.trim();if(!e)continue;let n=yield this.buscarClientePorTelefono(e);if(n){if((yield ui.default.fire({title:"Cliente encontrado",html:`<p><strong>${n.nombre}</strong></p>
          <p>\xBFEs el cliente que esta haciendo la devoluci\xF3n?</p>`,icon:"info",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"S\xED, continuar",cancelButtonText:"Volver a capturar"})).isConfirmed)return n}else{let r=yield this.altaCliente(e);if(r)return r}}})}buscarClientePorTelefono(t){return Le(this,null,function*(){try{return yield Ti(this.clienteService.buscarClientePorTelefono(t))}catch{return null}})}altaCliente(t){return Le(this,null,function*(){let{value:e}=yield ui.default.fire({title:"Nuevo cliente",html:`<label><strong>Tel\xE9fono: </strong>${t}</label><input id="swal-input-nombre" class="swal2-input" placeholder="Paterno Materno Nombre"><input id="swal-input-domicilio" class="swal2-input" placeholder="Domicilio">`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Registrar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{let r=document.getElementById("swal-input-nombre").value.trim(),a=document.getElementById("swal-input-domicilio").value.trim();if(!r){ui.default.showValidationMessage("El nombre es obligatorio");return}return{nombre:r,domicilio:a}}});if(!e)return null;let n={nombre:e.nombre,telefono:t,domicilio:e.domicilio};try{let r=yield Ti(this.clienteService.crearCliente(n));return ui.default.fire("\xC9xito","Cliente registrado correctamente","success"),r}catch{return ui.default.fire("Error","No se pudo registrar el cliente","error"),null}})}abrirDetalleVenta(t){this.ventaDetalleAbiertoId=t._id,t.productos.forEach(e=>{e.seleccionado=!1,e.cantidadDevuelta=1,e.motivo=null})}cerrarDetalleVenta(t){this.ventaDetalleAbiertoId=null}esPromocionNoReembolsable(t,e){return t?.includes("2x1")||t?.includes("3x2")||t?.includes("4x3")||e==="Recargas"||e==="Servicio M\xE9dico"}limpiarFolio(){this.filtroFolio="",this.ventas=[],this.mostrarTicket=!1}static \u0275fac=function(e){return new(e||i)(te(pl),te(wn),te(Zt),te(bi),te(qt))};static \u0275cmp=Te({type:i,selectors:[["app-devoluciones"]],viewQuery:function(e,n){if(e&1&&Ot(W2,5),e&2){let r;St(r=wt())&&(n.contenedorTicket=r.first)}},decls:18,vars:6,consts:[["contenedorTicket",""],[1,"container","mt-4"],[1,"titulo-container"],[1,"titulo"],[1,"row","filter-container"],[1,"col-1"],[1,"col-2"],["for","filtroFolio",1,"lbl-folio-venta"],[1,"position-relative"],["id","filtroFolio","placeholder","\xDAltimos 6 caracteres","maxlength","6","pattern","[A-Za-z0-9]{6}",1,"form-control","pr-4",3,"ngModelChange","ngModel"],["matTooltip","Limpiar folio de la venta","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["class","subtitulo",4,"ngIf"],["class","tabla",4,"ngIf"],["class","no-found-error",4,"ngIf"],["class","ticket-impresion",3,"venta",4,"ngIf"],["matTooltip","Limpiar folio de la venta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"subtitulo"],[1,"tabla"],[4,"ngFor","ngForOf"],[1,"btn-gris","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],[4,"ngIf"],["colspan","9"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"btn-rojo","mt-2",3,"click"],["type","checkbox",3,"ngModelChange","ngModel","disabled","ngClass","title"],["type","number","min","1",1,"form-control",3,"ngModelChange","max","ngModel","disabled","title"],[1,"form-select",3,"ngModelChange","ngModel","disabled","title"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"no-found-error"],[1,"ticket-impresion",3,"venta"]],template:function(e,n){if(e&1){let r=ie();l(0,"div",1)(1,"div",2)(2,"h1",3),d(3,"Devoluciones"),s()(),l(4,"div",4),y(5,"div",5),l(6,"div",6)(7,"label",7),d(8,"Folio de la venta:"),s(),l(9,"div",8)(10,"input",9),Z("ngModelChange",function(o){return T(r),J(n.filtroFolio,o)||(n.filtroFolio=o),P(o)}),E("ngModelChange",function(o){return T(r),P(n.onFolioChange(o))}),s(),N(11,z2,2,1,"button",10),s()()(),N(12,$2,2,0,"h2",11)(13,Y2,18,1,"table",12)(14,Q2,2,0,"p",13),s(),l(15,"div",null,0),N(17,J2,1,1,"app-devolucion-ticket",14),s()}e&2&&(c(10),Q("ngModel",n.filtroFolio),c(),p("ngIf",n.filtroFolio.length>0),c(),p("ngIf",n.ventas.length>0),c(),p("ngIf",n.ventas.length>0),c(),p("ngIf",n.filtroFolio.length===6&&n.ventas.length===0),c(3),p("ngIf",n.paraImpresion&&n.mostrarTicket))},dependencies:[Ae,si,We,Be,Nt,Rt,rt,it,nt,Xe,Gt,li,tt,ze,Ia,zs,Bi,Kn,_t,ti,ei,fl,ut],styles:[".icono-normal[_ngcontent-%COMP%], .icono-rotado[_ngcontent-%COMP%]{display:inline-block;transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0)}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg)}.checkbox-disabled[_ngcontent-%COMP%], input[disabled][_ngcontent-%COMP%], select[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.folio-venta[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.lbl-folio-venta[_ngcontent-%COMP%]{font-size:large;margin-right:10px}.filter-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}"],data:{animation:[Zr("expandCollapse",[nr("true",pn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",pn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),ta("true <=> false",ea("300ms ease-in-out"))])]}})};var hn=hi(ki());var gl=class i{datosCorte;fechaActual=new Date;ngOnChanges(t){t.datosCorte&&console.log("\u{1F7E2} datosCorte recibidos en ticket:",this.datosCorte)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Te({type:i,selectors:[["app-corte-caja-ticket"]],inputs:{datosCorte:"datosCorte"},features:[ya],decls:54,vars:19,consts:[[1,"ticket-corteCaja"],[3,"nombreFarmacia","direccion","telefono"],[1,"corte-caja-encabezado"],[2,"text-align","center","font-size","large"],[1,"corte-caja-datos"],[2,"font-style","italic"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,"app-ticket-header",1),l(2,"div",2)(3,"div",3),d(4,"Corte de Caja"),s(),l(5,"strong"),d(6),s(),y(7,"br"),d(8," Inicio: "),l(9,"strong"),d(10),F(11,"date"),s(),y(12,"br"),d(13," Fin: "),l(14,"strong"),d(15),F(16,"date"),s(),y(17,"br"),s(),y(18,"hr"),l(19,"div",4)(20,"p",5),d(21,"Movimientos"),s(),d(22," Ventas: "),l(23,"strong"),d(24),s(),y(25,"br"),d(26," Devoluciones: "),l(27,"strong"),d(28),s(),y(29,"br"),d(30," Pedidos levantados: "),l(31,"strong"),d(32),s(),y(33,"br"),d(34," Pedidos entregados: "),l(35,"strong"),d(36),s(),y(37,"br"),d(38," Pedidos cancelados: "),l(39,"strong"),d(40),s(),y(41,"br")(42,"br"),l(43,"p",5),d(44,"Recargas telef\xF3nicas"),s(),d(45," Saldo inicial: "),l(46,"strong"),d(47),s(),y(48,"br"),d(49," Saldo final: "),l(50,"strong"),d(51),s()(),y(52,"hr")(53,"app-ticket-footer"),s()),e&2&&(c(),p("nombreFarmacia",n.datosCorte.nomFarm)("direccion",n.datosCorte.dirFarm)("telefono",n.datosCorte.telFarm),c(5),k(n.datosCorte.responsable),c(4),k(Y(11,13,n.datosCorte.fechaInicio,"dd/MM/yyyy HH:mm")),c(5),k(Y(16,16,n.datosCorte.fechaFin,"dd/MM/yyyy HH:mm")),c(9),k(n.datosCorte.ventasRealizadas),c(4),k(n.datosCorte.devolucionesRealizadas),c(4),k(n.datosCorte.pedidosLevantados),c(4),k(n.datosCorte.pedidosEntregados),c(4),k(n.datosCorte.pedidosCancelados),c(7),R("$",n.datosCorte.saldoInicialRecargas," "),c(4),R("$",n.datosCorte.saldoInicialRecargas-n.datosCorte.totalRecargas," "))},dependencies:[Ae,Rt,tr,er],styles:[`.corte-caja-encabezado,.corte-caja-datos{font-size:16px!important;line-height:1.4!important;box-sizing:border-box}.corte-caja-datos{text-align:center}@media print{@page{margin-left:10pt!important;size:95mm auto}html,body{margin:0!important;padding:0!important}body *{visibility:hidden!important}.ticket-corteCaja,.ticket-corteCaja *{visibility:visible!important}.ticket-corteCaja{width:95mm!important;margin-left:10pt!important;padding:0!important;box-sizing:border-box!important;font-size:12px!important;line-height:1.4!important;position:absolute!important;left:0!important;top:0!important}}
`],encapsulation:2})};function Z2(i,t){i&1&&(at(0),d(1,"Iniciar turno de caja"),ot())}function eb(i,t){i&1&&(at(0),y(1,"span",13),d(2," Iniciando... "),ot())}function tb(i,t){if(i&1){let e=ie();l(0,"div",3)(1,"h2",4),d(2,"Inicio de Turno"),s(),l(3,"div",5)(4,"label",6),d(5,"Efectivo inicial recibido:"),s(),l(6,"input",7),Z("ngModelChange",function(r){T(e);let a=_();return J(a.efectivoInicial,r)||(a.efectivoInicial=r),P(r)}),s()(),l(7,"div",5)(8,"label",8),d(9,"Saldo inicial de recargas:"),s(),l(10,"input",9),Z("ngModelChange",function(r){T(e);let a=_();return J(a.saldoInicialRecargas,r)||(a.saldoInicialRecargas=r),P(r)}),s(),l(11,"small",10),d(12,"Coloca 0.00 si no tienes recargas al inicio."),s()(),l(13,"button",11),E("click",function(){T(e);let r=_();return P(r.iniciarTurno())}),N(14,Z2,2,0,"ng-container",12)(15,eb,3,0,"ng-container",12),s()()}if(i&2){let e=_();c(6),Q("ngModel",e.efectivoInicial),c(4),Q("ngModel",e.saldoInicialRecargas),c(3),p("disabled",e.procesando),c(),p("ngIf",!e.procesando),c(),p("ngIf",e.procesando)}}function ib(i,t){if(i&1){let e=ie();l(0,"div",3)(1,"h2",14),d(2,"Turno activo"),s(),l(3,"p",15)(4,"strong"),d(5,"Fecha de inicio:"),s(),d(6),F(7,"date"),s(),l(8,"p",15)(9,"strong"),d(10,"Efectivo inicial:"),s(),d(11),F(12,"number"),s(),l(13,"p",15)(14,"strong"),d(15,"Recargas inicial:"),s(),d(16),F(17,"number"),s(),l(18,"button",16),E("click",function(){T(e);let r=_();return P(r.finalizarTurno())}),d(19," Finalizar turno de caja "),s()()}if(i&2){let e=_();c(6),R(" ",Ni(7,3,e.corteActivo.fechaInicio,"dd/MM/yyyy HH:mm","America/Mexico_City")," hrs."),c(5),R(" $",Y(12,7,e.corteActivo.efectivoInicial,"1.2-2"),""),c(5),R(" $",Y(17,10,e.corteActivo.saldoInicialRecargas,"1.2-2"),"")}}function nb(i,t){if(i&1&&y(0,"app-corte-caja-ticket",17),i&2){let e=_();p("datosCorte",e.datosCorteParaImpresion)}}var _l=class i{constructor(t,e,n,r){this.authService=t;this.http=e;this.router=n;this.cdr=r}efectivoInicial=0;saldoInicialRecargas=0;corteActivo=null;usuarioId=null;usuarioNombre=null;farmaciaId=null;farmaciaNombre=null;farmaciaDireccion=null;farmaciaTelefono=null;mostrarFormulario=!1;procesando=!1;mostrarTicketCorte=!1;datosCorteParaImpresion=null;ngOnInit(){let t=localStorage.getItem("usuario"),e=localStorage.getItem("user_farmacia");if(t&&(this.usuarioId=JSON.parse(t)?.id,this.usuarioNombre=JSON.parse(t)?.nombre),e&&(this.farmaciaId=JSON.parse(e)._id,this.farmaciaNombre=JSON.parse(e).nombre,this.farmaciaDireccion=JSON.parse(e).direccion,this.farmaciaTelefono=JSON.parse(e).telefono),!this.usuarioId||!this.farmaciaId){hn.default.fire("Error","Faltan datos de sesi\xF3n o farmacia activa.","error");return}this.verificarCorteActivo()}verificarCorteActivo(){let t=localStorage.getItem("auth_token"),e=new qe({"x-auth-token":t||""});this.http.get(`${Ge.apiUrl}/cortes/activo/${this.usuarioId}/${this.farmaciaId}`,{headers:e}).subscribe({next:n=>{n.corte?this.corteActivo=n.corte:(this.mostrarFormulario=!0,this.cdr.detectChanges())},error:n=>{n.status===409?hn.default.fire({icon:"error",title:"Corte duplicado detectado",text:n.error?.mensaje||"Conflicto en cortes activos"}):hn.default.fire("Error","No se pudo verificar el corte activo.","error")}})}iniciarTurno(){if(this.efectivoInicial<=0){hn.default.fire({icon:"warning",title:"Error",text:"El efectivo inicial debe ser mayor a cero.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}if(this.saldoInicialRecargas===null||this.saldoInicialRecargas===void 0||this.saldoInicialRecargas<0){hn.default.fire({icon:"warning",title:"Error",text:"El saldo inicial de recargas debe ser 0 o mayor.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}this.procesando=!0;let t=localStorage.getItem("auth_token"),e=new qe({"x-auth-token":t||"","Content-Type":"application/json"}),n={efectivoInicial:this.efectivoInicial,saldoInicialRecargas:this.saldoInicialRecargas,farmaciaId:this.farmaciaId};this.http.post(`${Ge.apiUrl}/cortes`,n,{headers:e}).subscribe({next:r=>{let a=r.corte;localStorage.setItem("corte_activo",a._id),hn.default.fire({icon:"success",title:"Turno iniciado",html:`
          <div style="text-align:left">
            <p><strong>Efectivo inicial:</strong> $${this.efectivoInicial.toFixed(2)}</p>
            <p><strong>Saldo inicial de recargas:</strong> $${this.saldoInicialRecargas.toFixed(2)}</p>
          </div>`,timer:2200,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{this.router.navigate(["/home"])})},error:r=>{console.error("Error al iniciar turno:",r),hn.default.fire("Error",r.error?.mensaje||"No se pudo iniciar el turno.","error")}}).add(()=>{this.procesando=!1})}finalizarTurno(){hn.default.fire({title:"\xBFFinalizar turno de caja?",text:"Se generar\xE1 el corte con los balances actuales.",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, finalizar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(t=>{if(!t.isConfirmed)return;let e=localStorage.getItem("auth_token"),n=new qe({"x-auth-token":e||""});this.http.put(`${Ge.apiUrl}/cortes/${this.corteActivo._id}/finalizar/false`,{},{headers:n}).subscribe({next:r=>{this.datosCorteParaImpresion=Qe({responsable:this.usuarioNombre,fechaInicio:this.corteActivo.fechaInicio,fechaFin:new Date().toISOString(),nomFarm:this.farmaciaNombre,dirFarm:this.farmaciaDireccion,telFarm:this.farmaciaTelefono},r.corte),this.mostrarTicketCorte=!0,setTimeout(()=>{requestAnimationFrame(()=>{window.print(),setTimeout(()=>{this.mostrarTicketCorte=!1,hn.default.fire({title:"\xBFLa impresi\xF3n fue exitosa?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(a=>{a.isConfirmed?this.http.put(`${Ge.apiUrl}/cortes/${this.corteActivo._id}/finalizar/true`,{},{headers:n}).subscribe({next:()=>{localStorage.removeItem("corte_activo"),this.authService.logout(),this.router.navigate(["/home"])},error:o=>{console.error("Error al guardar corte:",o),hn.default.fire("Error","No se pudo guardar el corte.","error")}}):hn.default.fire("Aviso","La impresi\xF3n no fue confirmada. El corte sigue activo.","info")})},300)})},300)},error:r=>{console.error("Error al cerrar turno:",r),hn.default.fire("Error","No se pudo generar el corte.","error")}})})}static \u0275fac=function(e){return new(e||i)(te(qt),te(dt),te(Qi),te(Wt))};static \u0275cmp=Te({type:i,selectors:[["app-inicio-turno"]],decls:4,vars:3,consts:[[1,"container","mt-5"],["class","card p-4 shadow",4,"ngIf"],[3,"datosCorte",4,"ngIf"],[1,"card","p-4","shadow"],[1,"mb-4"],[1,"form-group","mb-3"],["for","efectivoInicial",1,"form-label"],["type","number","id","efectivoInicial","placeholder","Ej. 500.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],["for","saldoInicialRecargas",1,"form-label"],["type","number","id","saldoInicialRecargas","placeholder","Ej. 0.00","min","0","step","1",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-muted"],[1,"btn-verde","w-100","d-flex","align-items-center","justify-content-center",3,"click","disabled"],[4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"titulo","mb-4"],[1,"subtitulo"],[1,"btn-gris",3,"click"],[3,"datosCorte"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,tb,16,5,"div",1)(2,ib,20,13,"div",1),s(),N(3,nb,1,1,"app-corte-caja-ticket",2)),e&2&&(c(),p("ngIf",n.mostrarFormulario),c(),p("ngIf",n.corteActivo&&!n.mostrarFormulario),c(),p("ngIf",n.mostrarTicketCorte))},dependencies:[Ae,Be,Ct,Rt,rt,Xe,Gt,ze,Bi,_t,gl],encapsulation:2})};var jn=hi(ki());var $o={};$o.version="0.18.5";var na=1200,Za=1252,rb=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],ab={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},Zp=function(i){rb.indexOf(i)!=-1&&(Za=ab[0]=i)};function ob(){Zp(1252)}var Go=function(i){na=i,Zp(i)};function sb(){Go(1200),ob()}function lb(i){for(var t=[],e=0;e<i.length>>1;++e)t[e]=String.fromCharCode(i.charCodeAt(2*e+1)+(i.charCodeAt(2*e)<<8));return t.join("")}var vl=function(t){return String.fromCharCode(t)},fp=function(t){return String.fromCharCode(t)},Dt;var or=null,Bo=!0,Mr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function qo(i){for(var t="",e=0,n=0,r=0,a=0,o=0,u=0,m=0,f=0;f<i.length;)e=i.charCodeAt(f++),a=e>>2,n=i.charCodeAt(f++),o=(e&3)<<4|n>>4,r=i.charCodeAt(f++),u=(n&15)<<2|r>>6,m=r&63,isNaN(n)?u=m=64:isNaN(r)&&(m=64),t+=Mr.charAt(a)+Mr.charAt(o)+Mr.charAt(u)+Mr.charAt(m);return t}function _r(i){var t="",e=0,n=0,r=0,a=0,o=0,u=0,m=0;i=i.replace(/[^\w\+\/\=]/g,"");for(var f=0;f<i.length;)a=Mr.indexOf(i.charAt(f++)),o=Mr.indexOf(i.charAt(f++)),e=a<<2|o>>4,t+=String.fromCharCode(e),u=Mr.indexOf(i.charAt(f++)),n=(o&15)<<4|u>>2,u!==64&&(t+=String.fromCharCode(n)),m=Mr.indexOf(i.charAt(f++)),r=(u&3)<<6|m,m!==64&&(t+=String.fromCharCode(r));return t}var bt=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),xr=function(){if(typeof Buffer<"u"){var i=!Buffer.from;if(!i)try{Buffer.from("foo","utf8")}catch{i=!0}return i?function(t,e){return e?new Buffer(t,e):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}}();function aa(i){return bt?Buffer.alloc?Buffer.alloc(i):new Buffer(i):typeof Uint8Array<"u"?new Uint8Array(i):new Array(i)}function pp(i){return bt?Buffer.allocUnsafe?Buffer.allocUnsafe(i):new Buffer(i):typeof Uint8Array<"u"?new Uint8Array(i):new Array(i)}var Ln=function(t){return bt?xr(t,"binary"):t.split("").map(function(e){return e.charCodeAt(0)&255})};function Ul(i){if(typeof ArrayBuffer>"u")return Ln(i);for(var t=new ArrayBuffer(i.length),e=new Uint8Array(t),n=0;n!=i.length;++n)e[n]=i.charCodeAt(n)&255;return t}function Jo(i){if(Array.isArray(i))return i.map(function(n){return String.fromCharCode(n)}).join("");for(var t=[],e=0;e<i.length;++e)t[e]=String.fromCharCode(i[e]);return t.join("")}function cb(i){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(i)}var Fi=bt?function(i){return Buffer.concat(i.map(function(t){return Buffer.isBuffer(t)?t:xr(t)}))}:function(i){if(typeof Uint8Array<"u"){var t=0,e=0;for(t=0;t<i.length;++t)e+=i[t].length;var n=new Uint8Array(e),r=0;for(t=0,e=0;t<i.length;e+=r,++t)if(r=i[t].length,i[t]instanceof Uint8Array)n.set(i[t],e);else{if(typeof i[t]=="string")throw"wtf";n.set(new Uint8Array(i[t]),e)}return n}return[].concat.apply([],i.map(function(a){return Array.isArray(a)?a:[].slice.call(a)}))};function db(i){for(var t=[],e=0,n=i.length+250,r=aa(i.length+255),a=0;a<i.length;++a){var o=i.charCodeAt(a);if(o<128)r[e++]=o;else if(o<2048)r[e++]=192|o>>6&31,r[e++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var u=i.charCodeAt(++a)&1023;r[e++]=240|o>>8&7,r[e++]=128|o>>2&63,r[e++]=128|u>>6&15|(o&3)<<4,r[e++]=128|u&63}else r[e++]=224|o>>12&15,r[e++]=128|o>>6&63,r[e++]=128|o&63;e>n&&(t.push(r.slice(0,e)),e=0,r=aa(65535),n=65530)}return t.push(r.slice(0,e)),Fi(t)}var Xa=/\u0000/g,xl=/[\u0001-\u0006]/g;function Ka(i){for(var t="",e=i.length-1;e>=0;)t+=i.charAt(e--);return t}function Vn(i,t){var e=""+i;return e.length>=t?e:ii("0",t-e.length)+e}function R0(i,t){var e=""+i;return e.length>=t?e:ii(" ",t-e.length)+e}function Pl(i,t){var e=""+i;return e.length>=t?e:e+ii(" ",t-e.length)}function ub(i,t){var e=""+Math.round(i);return e.length>=t?e:ii("0",t-e.length)+e}function mb(i,t){var e=""+i;return e.length>=t?e:ii("0",t-e.length)+e}var hp=Math.pow(2,32);function Ha(i,t){if(i>hp||i<-hp)return ub(i,t);var e=Math.round(i);return mb(e,t)}function kl(i,t){return t=t||0,i.length>=7+t&&(i.charCodeAt(t)|32)===103&&(i.charCodeAt(t+1)|32)===101&&(i.charCodeAt(t+2)|32)===110&&(i.charCodeAt(t+3)|32)===101&&(i.charCodeAt(t+4)|32)===114&&(i.charCodeAt(t+5)|32)===97&&(i.charCodeAt(t+6)|32)===108}var gp=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],S0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function fb(i){return i||(i={}),i[0]="General",i[1]="0",i[2]="0.00",i[3]="#,##0",i[4]="#,##0.00",i[9]="0%",i[10]="0.00%",i[11]="0.00E+00",i[12]="# ?/?",i[13]="# ??/??",i[14]="m/d/yy",i[15]="d-mmm-yy",i[16]="d-mmm",i[17]="mmm-yy",i[18]="h:mm AM/PM",i[19]="h:mm:ss AM/PM",i[20]="h:mm",i[21]="h:mm:ss",i[22]="m/d/yy h:mm",i[37]="#,##0 ;(#,##0)",i[38]="#,##0 ;[Red](#,##0)",i[39]="#,##0.00;(#,##0.00)",i[40]="#,##0.00;[Red](#,##0.00)",i[45]="mm:ss",i[46]="[h]:mm:ss",i[47]="mmss.0",i[48]="##0.0E+0",i[49]="@",i[56]='"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "',i}var ni={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "'},_p={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},pb={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Il(i,t,e){for(var n=i<0?-1:1,r=i*n,a=0,o=1,u=0,m=1,f=0,h=0,g=Math.floor(r);f<t&&(g=Math.floor(r),u=g*o+a,h=g*f+m,!(r-g<5e-8));)r=1/(r-g),a=o,o=u,m=f,f=h;if(h>t&&(f>t?(h=m,u=a):(h=f,u=o)),!e)return[0,n*u,h];var v=Math.floor(n*u/h);return[v,n*u-v*h,h]}function bl(i,t,e){if(i>2958465||i<0)return null;var n=i|0,r=Math.floor(86400*(i-n)),a=0,o=[],u={D:n,T:r,u:86400*(i-n)-r,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(u.u)<1e-6&&(u.u=0),t&&t.date1904&&(n+=1462),u.u>.9999&&(u.u=0,++r==86400&&(u.T=r=0,++n,++u.D)),n===60)o=e?[1317,10,29]:[1900,2,29],a=3;else if(n===0)o=e?[1317,8,29]:[1900,1,0],a=6;else{n>60&&--n;var m=new Date(1900,0,1);m.setDate(m.getDate()+n-1),o=[m.getFullYear(),m.getMonth()+1,m.getDate()],a=m.getDay(),n<60&&(a=(a+6)%7),e&&(a=yb(m,o))}return u.y=o[0],u.m=o[1],u.d=o[2],u.S=r%60,r=Math.floor(r/60),u.M=r%60,r=Math.floor(r/60),u.H=r,u.q=a,u}var eh=new Date(1899,11,31,0,0,0),hb=eh.getTime(),gb=new Date(1900,2,1,0,0,0);function th(i,t){var e=i.getTime();return t?e-=1461*24*60*60*1e3:i>=gb&&(e+=24*60*60*1e3),(e-(hb+(i.getTimezoneOffset()-eh.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function N0(i){return i.indexOf(".")==-1?i:i.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function _b(i){return i.indexOf("E")==-1?i:i.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function vb(i){var t=i<0?12:11,e=N0(i.toFixed(12));return e.length<=t||(e=i.toPrecision(10),e.length<=t)?e:i.toExponential(5)}function xb(i){var t=N0(i.toFixed(11));return t.length>(i<0?12:11)||t==="0"||t==="-0"?i.toPrecision(6):t}function bb(i){var t=Math.floor(Math.log(Math.abs(i))*Math.LOG10E),e;return t>=-4&&t<=-1?e=i.toPrecision(10+t):Math.abs(t)<=9?e=vb(i):t===10?e=i.toFixed(10).substr(0,12):e=xb(i),N0(_b(e.toUpperCase()))}function F0(i,t){switch(typeof i){case"string":return i;case"boolean":return i?"TRUE":"FALSE";case"number":return(i|0)===i?i.toString(10):bb(i);case"undefined":return"";case"object":if(i==null)return"";if(i instanceof Date)return Ar(14,th(i,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+i)}function yb(i,t){t[0]-=581;var e=i.getDay();return i<60&&(e=(e+6)%7),e}function Cb(i,t,e,n){var r="",a=0,o=0,u=e.y,m,f=0;switch(i){case 98:u=e.y+543;case 121:switch(t.length){case 1:case 2:m=u%100,f=2;break;default:m=u%1e4,f=4;break}break;case 109:switch(t.length){case 1:case 2:m=e.m,f=t.length;break;case 3:return S0[e.m-1][1];case 5:return S0[e.m-1][0];default:return S0[e.m-1][2]}break;case 100:switch(t.length){case 1:case 2:m=e.d,f=t.length;break;case 3:return gp[e.q][0];default:return gp[e.q][1]}break;case 104:switch(t.length){case 1:case 2:m=1+(e.H+11)%12,f=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:m=e.H,f=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:m=e.M,f=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return e.u===0&&(t=="s"||t=="ss")?Vn(e.S,t.length):(n>=2?o=n===3?1e3:100:o=n===1?10:1,a=Math.round(o*(e.S+e.u)),a>=60*o&&(a=0),t==="s"?a===0?"0":""+a/o:(r=Vn(a,2+n),t==="ss"?r.substr(0,2):"."+r.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":m=e.D*24+e.H;break;case"[m]":case"[mm]":m=(e.D*24+e.H)*60+e.M;break;case"[s]":case"[ss]":m=((e.D*24+e.H)*60+e.M)*60+Math.round(e.S+e.u);break;default:throw"bad abstime format: "+t}f=t.length===3?1:2;break;case 101:m=u,f=1;break}var h=f>0?Vn(m,f):"";return h}function Fr(i){var t=3;if(i.length<=t)return i;for(var e=i.length%t,n=i.substr(0,e);e!=i.length;e+=t)n+=(n.length>0?",":"")+i.substr(e,t);return n}var ih=/%/g;function Sb(i,t,e){var n=t.replace(ih,""),r=t.length-n.length;return pr(i,n,e*Math.pow(10,2*r))+ii("%",r)}function wb(i,t,e){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return pr(i,t.substr(0,n),e/Math.pow(10,3*(t.length-n)))}function nh(i,t){var e,n=i.indexOf("E")-i.indexOf(".")-1;if(i.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+nh(i,-t);var r=i.indexOf(".");r===-1&&(r=i.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%r;if(a<0&&(a+=r),e=(t/Math.pow(10,a)).toPrecision(n+1+(r+a)%r),e.indexOf("e")===-1){var o=Math.floor(Math.log(t)*Math.LOG10E);for(e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+a):e+="E+"+(o-a);e.substr(0,2)==="0.";)e=e.charAt(0)+e.substr(2,r)+"."+e.substr(2+r),e=e.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(u,m,f,h){return m+f+h.substr(0,(r+a)%r)+"."+h.substr(a)+"E"})}else e=t.toExponential(n);return i.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),i.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}var rh=/# (\?+)( ?)\/( ?)(\d+)/;function Eb(i,t,e){var n=parseInt(i[4],10),r=Math.round(t*n),a=Math.floor(r/n),o=r-a*n,u=n;return e+(a===0?"":""+a)+" "+(o===0?ii(" ",i[1].length+1+i[4].length):R0(o,i[1].length)+i[2]+"/"+i[3]+Vn(u,i[4].length))}function Tb(i,t,e){return e+(t===0?"":""+t)+ii(" ",i[1].length+2+i[4].length)}var ah=/^#*0*\.([0#]+)/,oh=/\).*[0#]/,sh=/\(###\) ###\\?-####/;function zi(i){for(var t="",e,n=0;n!=i.length;++n)switch(e=i.charCodeAt(n)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(e)}return t}function vp(i,t){var e=Math.pow(10,t);return""+Math.round(i*e)/e}function xp(i,t){var e=i-Math.floor(i),n=Math.pow(10,t);return t<(""+Math.round(e*n)).length?0:Math.round(e*n)}function Pb(i,t){return t<(""+Math.round((i-Math.floor(i))*Math.pow(10,t))).length?1:0}function kb(i){return i<2147483647&&i>-2147483648?""+(i>=0?i|0:i-1|0):""+Math.floor(i)}function Pn(i,t,e){if(i.charCodeAt(0)===40&&!t.match(oh)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?Pn("n",n,e):"("+Pn("n",n,-e)+")"}if(t.charCodeAt(t.length-1)===44)return wb(i,t,e);if(t.indexOf("%")!==-1)return Sb(i,t,e);if(t.indexOf("E")!==-1)return nh(t,e);if(t.charCodeAt(0)===36)return"$"+Pn(i,t.substr(t.charAt(1)==" "?2:1),e);var r,a,o,u,m=Math.abs(e),f=e<0?"-":"";if(t.match(/^00+$/))return f+Ha(m,t.length);if(t.match(/^[#?]+$/))return r=Ha(e,0),r==="0"&&(r=""),r.length>t.length?r:zi(t.substr(0,t.length-r.length))+r;if(a=t.match(rh))return Eb(a,m,f);if(t.match(/^#+0+$/))return f+Ha(m,t.length-t.indexOf("0"));if(a=t.match(ah))return r=vp(e,a[1].length).replace(/^([^\.]+)$/,"$1."+zi(a[1])).replace(/\.$/,"."+zi(a[1])).replace(/\.(\d*)$/,function(w,x){return"."+x+ii("0",zi(a[1]).length-x.length)}),t.indexOf("0.")!==-1?r:r.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return f+vp(m,a[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return f+Fr(Ha(m,0));if(a=t.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+Pn(i,t,-e):Fr(""+(Math.floor(e)+Pb(e,a[1].length)))+"."+Vn(xp(e,a[1].length),a[1].length);if(a=t.match(/^#,#*,#0/))return Pn(i,t.replace(/^#,#*,/,""),e);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return r=Ka(Pn(i,t.replace(/[\\-]/g,""),e)),o=0,Ka(Ka(t.replace(/\\/g,"")).replace(/[0#]/g,function(w){return o<r.length?r.charAt(o++):w==="0"?"0":""}));if(t.match(sh))return r=Pn(i,"##########",e),"("+r.substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var h="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(a[4].length,7),u=Il(m,Math.pow(10,o)-1,!1),r=""+f,h=pr("n",a[1],u[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),r+=h+a[2]+"/"+a[3],h=Pl(u[2],o),h.length<a[4].length&&(h=zi(a[4].substr(a[4].length-h.length))+h),r+=h,r;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(a[1].length,a[4].length),7),u=Il(m,Math.pow(10,o)-1,!0),f+(u[0]||(u[1]?"":"0"))+" "+(u[1]?R0(u[1],o)+a[2]+"/"+a[3]+Pl(u[2],o):ii(" ",2*o+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return r=Ha(e,0),t.length<=r.length?r:zi(t.substr(0,t.length-r.length))+r;if(a=t.match(/^([#0?]+)\.([#0]+)$/)){r=""+e.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),o=r.indexOf(".");var g=t.indexOf(".")-o,v=t.length-r.length-g;return zi(t.substr(0,g)+r+t.substr(t.length-v))}if(a=t.match(/^00,000\.([#0]*0)$/))return o=xp(e,a[1].length),e<0?"-"+Pn(i,t,-e):Fr(kb(e)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(w){return"00,"+(w.length<3?Vn(0,3-w.length):"")+w})+"."+Vn(o,a[1].length);switch(t){case"###,##0.00":return Pn(i,"#,##0.00",e);case"###,###":case"##,###":case"#,###":var b=Fr(Ha(m,0));return b!=="0"?f+b:"";case"###,###.00":return Pn(i,"###,##0.00",e).replace(/^0\./,".");case"#,###.00":return Pn(i,"#,##0.00",e).replace(/^0\./,".");default:}throw new Error("unsupported format |"+t+"|")}function Ib(i,t,e){for(var n=t.length-1;t.charCodeAt(n-1)===44;)--n;return pr(i,t.substr(0,n),e/Math.pow(10,3*(t.length-n)))}function Mb(i,t,e){var n=t.replace(ih,""),r=t.length-n.length;return pr(i,n,e*Math.pow(10,2*r))+ii("%",r)}function lh(i,t){var e,n=i.indexOf("E")-i.indexOf(".")-1;if(i.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+lh(i,-t);var r=i.indexOf(".");r===-1&&(r=i.indexOf("E"));var a=Math.floor(Math.log(t)*Math.LOG10E)%r;if(a<0&&(a+=r),e=(t/Math.pow(10,a)).toPrecision(n+1+(r+a)%r),!e.match(/[Ee]/)){var o=Math.floor(Math.log(t)*Math.LOG10E);e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+a):e+="E+"+(o-a),e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(u,m,f,h){return m+f+h.substr(0,(r+a)%r)+"."+h.substr(a)+"E"})}else e=t.toExponential(n);return i.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),i.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}function rr(i,t,e){if(i.charCodeAt(0)===40&&!t.match(oh)){var n=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?rr("n",n,e):"("+rr("n",n,-e)+")"}if(t.charCodeAt(t.length-1)===44)return Ib(i,t,e);if(t.indexOf("%")!==-1)return Mb(i,t,e);if(t.indexOf("E")!==-1)return lh(t,e);if(t.charCodeAt(0)===36)return"$"+rr(i,t.substr(t.charAt(1)==" "?2:1),e);var r,a,o,u,m=Math.abs(e),f=e<0?"-":"";if(t.match(/^00+$/))return f+Vn(m,t.length);if(t.match(/^[#?]+$/))return r=""+e,e===0&&(r=""),r.length>t.length?r:zi(t.substr(0,t.length-r.length))+r;if(a=t.match(rh))return Tb(a,m,f);if(t.match(/^#+0+$/))return f+Vn(m,t.length-t.indexOf("0"));if(a=t.match(ah))return r=(""+e).replace(/^([^\.]+)$/,"$1."+zi(a[1])).replace(/\.$/,"."+zi(a[1])),r=r.replace(/\.(\d*)$/,function(w,x){return"."+x+ii("0",zi(a[1]).length-x.length)}),t.indexOf("0.")!==-1?r:r.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),a=t.match(/^(0*)\.(#*)$/))return f+(""+m).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=t.match(/^#{1,3},##0(\.?)$/))return f+Fr(""+m);if(a=t.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+rr(i,t,-e):Fr(""+e)+"."+ii("0",a[1].length);if(a=t.match(/^#,#*,#0/))return rr(i,t.replace(/^#,#*,/,""),e);if(a=t.match(/^([0#]+)(\\?-([0#]+))+$/))return r=Ka(rr(i,t.replace(/[\\-]/g,""),e)),o=0,Ka(Ka(t.replace(/\\/g,"")).replace(/[0#]/g,function(w){return o<r.length?r.charAt(o++):w==="0"?"0":""}));if(t.match(sh))return r=rr(i,"##########",e),"("+r.substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var h="";if(a=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(a[4].length,7),u=Il(m,Math.pow(10,o)-1,!1),r=""+f,h=pr("n",a[1],u[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),r+=h+a[2]+"/"+a[3],h=Pl(u[2],o),h.length<a[4].length&&(h=zi(a[4].substr(a[4].length-h.length))+h),r+=h,r;if(a=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(a[1].length,a[4].length),7),u=Il(m,Math.pow(10,o)-1,!0),f+(u[0]||(u[1]?"":"0"))+" "+(u[1]?R0(u[1],o)+a[2]+"/"+a[3]+Pl(u[2],o):ii(" ",2*o+1+a[2].length+a[3].length));if(a=t.match(/^[#0?]+$/))return r=""+e,t.length<=r.length?r:zi(t.substr(0,t.length-r.length))+r;if(a=t.match(/^([#0]+)\.([#0]+)$/)){r=""+e.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),o=r.indexOf(".");var g=t.indexOf(".")-o,v=t.length-r.length-g;return zi(t.substr(0,g)+r+t.substr(t.length-v))}if(a=t.match(/^00,000\.([#0]*0)$/))return e<0?"-"+rr(i,t,-e):Fr(""+e).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(w){return"00,"+(w.length<3?Vn(0,3-w.length):"")+w})+"."+Vn(0,a[1].length);switch(t){case"###,###":case"##,###":case"#,###":var b=Fr(""+m);return b!=="0"?f+b:"";default:if(t.match(/\.[0#?]*$/))return rr(i,t.slice(0,t.lastIndexOf(".")),e)+zi(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function pr(i,t,e){return(e|0)===e?rr(i,t,e):Pn(i,t,e)}function Fb(i){for(var t=[],e=!1,n=0,r=0;n<i.length;++n)switch(i.charCodeAt(n)){case 34:e=!e;break;case 95:case 42:case 92:++n;break;case 59:t[t.length]=i.substr(r,n-r),r=n+1}if(t[t.length]=i.substr(r),e===!0)throw new Error("Format |"+i+"| unterminated string ");return t}var ch=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function dh(i){for(var t=0,e="",n="";t<i.length;)switch(e=i.charAt(t)){case"G":kl(i,t)&&(t+=6),t++;break;case'"':for(;i.charCodeAt(++t)!==34&&t<i.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(i.charAt(t+1)==="1"||i.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4E0A":if(i.substr(t,3).toUpperCase()==="A/P"||i.substr(t,5).toUpperCase()==="AM/PM"||i.substr(t,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348")return!0;++t;break;case"[":for(n=e;i.charAt(t++)!=="]"&&t<i.length;)n+=i.charAt(t);if(n.match(ch))return!0;break;case".":case"0":case"#":for(;t<i.length&&("0#?.,E+-%".indexOf(e=i.charAt(++t))>-1||e=="\\"&&i.charAt(t+1)=="-"&&"0#".indexOf(i.charAt(t+2))>-1););break;case"?":for(;i.charAt(++t)===e;);break;case"*":++t,(i.charAt(t)==" "||i.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<i.length&&"0123456789".indexOf(i.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function Ab(i,t,e,n){for(var r=[],a="",o=0,u="",m="t",f,h,g,v="H";o<i.length;)switch(u=i.charAt(o)){case"G":if(!kl(i,o))throw new Error("unrecognized character "+u+" in "+i);r[r.length]={t:"G",v:"General"},o+=7;break;case'"':for(a="";(g=i.charCodeAt(++o))!==34&&o<i.length;)a+=String.fromCharCode(g);r[r.length]={t:"t",v:a},++o;break;case"\\":var b=i.charAt(++o),w=b==="("||b===")"?b:"t";r[r.length]={t:w,v:b},++o;break;case"_":r[r.length]={t:"t",v:" "},o+=2;break;case"@":r[r.length]={t:"T",v:t},++o;break;case"B":case"b":if(i.charAt(o+1)==="1"||i.charAt(o+1)==="2"){if(f==null&&(f=bl(t,e,i.charAt(o+1)==="2"),f==null))return"";r[r.length]={t:"X",v:i.substr(o,2)},m=u,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":u=u.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||f==null&&(f=bl(t,e),f==null))return"";for(a=u;++o<i.length&&i.charAt(o).toLowerCase()===u;)a+=u;u==="m"&&m.toLowerCase()==="h"&&(u="M"),u==="h"&&(u=v),r[r.length]={t:u,v:a},m=u;break;case"A":case"a":case"\u4E0A":var x={t:u,v:u};if(f==null&&(f=bl(t,e)),i.substr(o,3).toUpperCase()==="A/P"?(f!=null&&(x.v=f.H>=12?"P":"A"),x.t="T",v="h",o+=3):i.substr(o,5).toUpperCase()==="AM/PM"?(f!=null&&(x.v=f.H>=12?"PM":"AM"),x.t="T",o+=5,v="h"):i.substr(o,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348"?(f!=null&&(x.v=f.H>=12?"\u4E0B\u5348":"\u4E0A\u5348"),x.t="T",o+=5,v="h"):(x.t="t",++o),f==null&&x.t==="T")return"";r[r.length]=x,m=u;break;case"[":for(a=u;i.charAt(o++)!=="]"&&o<i.length;)a+=i.charAt(o);if(a.slice(-1)!=="]")throw'unterminated "[" block: |'+a+"|";if(a.match(ch)){if(f==null&&(f=bl(t,e),f==null))return"";r[r.length]={t:"Z",v:a.toLowerCase()},m=a.charAt(1)}else a.indexOf("$")>-1&&(a=(a.match(/\$([^-\[\]]*)/)||[])[1]||"$",dh(i)||(r[r.length]={t:"t",v:a}));break;case".":if(f!=null){for(a=u;++o<i.length&&(u=i.charAt(o))==="0";)a+=u;r[r.length]={t:"s",v:a};break}case"0":case"#":for(a=u;++o<i.length&&"0#?.,E+-%".indexOf(u=i.charAt(o))>-1;)a+=u;r[r.length]={t:"n",v:a};break;case"?":for(a=u;i.charAt(++o)===u;)a+=u;r[r.length]={t:u,v:a},m=u;break;case"*":++o,(i.charAt(o)==" "||i.charAt(o)=="*")&&++o;break;case"(":case")":r[r.length]={t:n===1?"t":u,v:u},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(a=u;o<i.length&&"0123456789".indexOf(i.charAt(++o))>-1;)a+=i.charAt(o);r[r.length]={t:"D",v:a};break;case" ":r[r.length]={t:u,v:u},++o;break;case"$":r[r.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=\u20ACacfijklopqrtuvwxzP".indexOf(u)===-1)throw new Error("unrecognized character "+u+" in "+i);r[r.length]={t:"t",v:u},++o;break}var C=0,U=0,j;for(o=r.length-1,m="t";o>=0;--o)switch(r[o].t){case"h":case"H":r[o].t=v,m="h",C<1&&(C=1);break;case"s":(j=r[o].v.match(/\.0+$/))&&(U=Math.max(U,j[0].length-1)),C<3&&(C=3);case"d":case"y":case"M":case"e":m=r[o].t;break;case"m":m==="s"&&(r[o].t="M",C<2&&(C=2));break;case"X":break;case"Z":C<1&&r[o].v.match(/[Hh]/)&&(C=1),C<2&&r[o].v.match(/[Mm]/)&&(C=2),C<3&&r[o].v.match(/[Ss]/)&&(C=3)}switch(C){case 0:break;case 1:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M),f.M>=60&&(f.M=0,++f.H);break;case 2:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M);break}var H="",K;for(o=0;o<r.length;++o)switch(r[o].t){case"t":case"T":case" ":case"D":break;case"X":r[o].v="",r[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":r[o].v=Cb(r[o].t.charCodeAt(0),r[o].v,f,U),r[o].t="t";break;case"n":case"?":for(K=o+1;r[K]!=null&&((u=r[K].t)==="?"||u==="D"||(u===" "||u==="t")&&r[K+1]!=null&&(r[K+1].t==="?"||r[K+1].t==="t"&&r[K+1].v==="/")||r[o].t==="("&&(u===" "||u==="n"||u===")")||u==="t"&&(r[K].v==="/"||r[K].v===" "&&r[K+1]!=null&&r[K+1].t=="?"));)r[o].v+=r[K].v,r[K]={v:"",t:";"},++K;H+=r[o].v,o=K-1;break;case"G":r[o].t="t",r[o].v=F0(t,e);break}var ce="",we,W;if(H.length>0){H.charCodeAt(0)==40?(we=t<0&&H.charCodeAt(0)===45?-t:t,W=pr("n",H,we)):(we=t<0&&n>1?-t:t,W=pr("n",H,we),we<0&&r[0]&&r[0].t=="t"&&(W=W.substr(1),r[0].v="-"+r[0].v)),K=W.length-1;var se=r.length;for(o=0;o<r.length;++o)if(r[o]!=null&&r[o].t!="t"&&r[o].v.indexOf(".")>-1){se=o;break}var ee=r.length;if(se===r.length&&W.indexOf("E")===-1){for(o=r.length-1;o>=0;--o)r[o]==null||"n?".indexOf(r[o].t)===-1||(K>=r[o].v.length-1?(K-=r[o].v.length,r[o].v=W.substr(K+1,r[o].v.length)):K<0?r[o].v="":(r[o].v=W.substr(0,K+1),K=-1),r[o].t="t",ee=o);K>=0&&ee<r.length&&(r[ee].v=W.substr(0,K+1)+r[ee].v)}else if(se!==r.length&&W.indexOf("E")===-1){for(K=W.indexOf(".")-1,o=se;o>=0;--o)if(!(r[o]==null||"n?".indexOf(r[o].t)===-1)){for(h=r[o].v.indexOf(".")>-1&&o===se?r[o].v.indexOf(".")-1:r[o].v.length-1,ce=r[o].v.substr(h+1);h>=0;--h)K>=0&&(r[o].v.charAt(h)==="0"||r[o].v.charAt(h)==="#")&&(ce=W.charAt(K--)+ce);r[o].v=ce,r[o].t="t",ee=o}for(K>=0&&ee<r.length&&(r[ee].v=W.substr(0,K+1)+r[ee].v),K=W.indexOf(".")+1,o=se;o<r.length;++o)if(!(r[o]==null||"n?(".indexOf(r[o].t)===-1&&o!==se)){for(h=r[o].v.indexOf(".")>-1&&o===se?r[o].v.indexOf(".")+1:0,ce=r[o].v.substr(0,h);h<r[o].v.length;++h)K<W.length&&(ce+=W.charAt(K++));r[o].v=ce,r[o].t="t",ee=o}}}for(o=0;o<r.length;++o)r[o]!=null&&"n?".indexOf(r[o].t)>-1&&(we=n>1&&t<0&&o>0&&r[o-1].v==="-"?-t:t,r[o].v=pr(r[o].t,r[o].v,we),r[o].t="t");var le="";for(o=0;o!==r.length;++o)r[o]!=null&&(le+=r[o].v);return le}var bp=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function yp(i,t){if(t==null)return!1;var e=parseFloat(t[2]);switch(t[1]){case"=":if(i==e)return!0;break;case">":if(i>e)return!0;break;case"<":if(i<e)return!0;break;case"<>":if(i!=e)return!0;break;case">=":if(i>=e)return!0;break;case"<=":if(i<=e)return!0;break}return!1}function Ob(i,t){var e=Fb(i),n=e.length,r=e[n-1].indexOf("@");if(n<4&&r>-1&&--n,e.length>4)throw new Error("cannot find right format for |"+e.join("|")+"|");if(typeof t!="number")return[4,e.length===4||r>-1?e[e.length-1]:"@"];switch(e.length){case 1:e=r>-1?["General","General","General",e[0]]:[e[0],e[0],e[0],"@"];break;case 2:e=r>-1?[e[0],e[0],e[0],e[1]]:[e[0],e[1],e[0],"@"];break;case 3:e=r>-1?[e[0],e[1],e[0],e[2]]:[e[0],e[1],e[2],"@"];break;case 4:break}var a=t>0?e[0]:t<0?e[1]:e[2];if(e[0].indexOf("[")===-1&&e[1].indexOf("[")===-1)return[n,a];if(e[0].match(/\[[=<>]/)!=null||e[1].match(/\[[=<>]/)!=null){var o=e[0].match(bp),u=e[1].match(bp);return yp(t,o)?[n,e[0]]:yp(t,u)?[n,e[1]]:[n,e[o!=null&&u!=null?2:1]]}return[n,a]}function Ar(i,t,e){e==null&&(e={});var n="";switch(typeof i){case"string":i=="m/d/yy"&&e.dateNF?n=e.dateNF:n=i;break;case"number":i==14&&e.dateNF?n=e.dateNF:n=(e.table!=null?e.table:ni)[i],n==null&&(n=e.table&&e.table[_p[i]]||ni[_p[i]]),n==null&&(n=pb[i]||"General");break}if(kl(n,0))return F0(t,e);t instanceof Date&&(t=th(t,e.date1904));var r=Ob(n,t);if(kl(r[1]))return F0(t,e);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return Ab(r[1],t,e,r[0])}function uh(i,t){if(typeof t!="number"){t=+t||-1;for(var e=0;e<392;++e){if(ni[e]==null){t<0&&(t=e);continue}if(ni[e]==i){t=e;break}}t<0&&(t=391)}return ni[t]=i,t}function jl(i){for(var t=0;t!=392;++t)i[t]!==void 0&&uh(i[t],t)}function Wl(){ni=fb()}var mh=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function Db(i){var t=typeof i=="number"?ni[i]:i;return t=t.replace(mh,"(\\d+)"),new RegExp("^"+t+"$")}function Rb(i,t,e){var n=-1,r=-1,a=-1,o=-1,u=-1,m=-1;(t.match(mh)||[]).forEach(function(g,v){var b=parseInt(e[v+1],10);switch(g.toLowerCase().charAt(0)){case"y":n=b;break;case"d":a=b;break;case"h":o=b;break;case"s":m=b;break;case"m":o>=0?u=b:r=b;break}}),m>=0&&u==-1&&r>=0&&(u=r,r=-1);var f=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(r>=1?r:1)).slice(-2)+"-"+("00"+(a>=1?a:1)).slice(-2);f.length==7&&(f="0"+f),f.length==8&&(f="20"+f);var h=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(u>=0?u:0)).slice(-2)+":"+("00"+(m>=0?m:0)).slice(-2);return o==-1&&u==-1&&m==-1?f:n==-1&&r==-1&&a==-1?h:f+"T"+h}var Nb=function(){var i={};i.version="1.2.0";function t(){for(var W=0,se=new Array(256),ee=0;ee!=256;++ee)W=ee,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,W=W&1?-306674912^W>>>1:W>>>1,se[ee]=W;return typeof Int32Array<"u"?new Int32Array(se):se}var e=t();function n(W){var se=0,ee=0,le=0,ue=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(le=0;le!=256;++le)ue[le]=W[le];for(le=0;le!=256;++le)for(ee=W[le],se=256+le;se<4096;se+=256)ee=ue[se]=ee>>>8^W[ee&255];var me=[];for(le=1;le!=16;++le)me[le-1]=typeof Int32Array<"u"?ue.subarray(le*256,le*256+256):ue.slice(le*256,le*256+256);return me}var r=n(e),a=r[0],o=r[1],u=r[2],m=r[3],f=r[4],h=r[5],g=r[6],v=r[7],b=r[8],w=r[9],x=r[10],C=r[11],U=r[12],j=r[13],H=r[14];function K(W,se){for(var ee=se^-1,le=0,ue=W.length;le<ue;)ee=ee>>>8^e[(ee^W.charCodeAt(le++))&255];return~ee}function ce(W,se){for(var ee=se^-1,le=W.length-15,ue=0;ue<le;)ee=H[W[ue++]^ee&255]^j[W[ue++]^ee>>8&255]^U[W[ue++]^ee>>16&255]^C[W[ue++]^ee>>>24]^x[W[ue++]]^w[W[ue++]]^b[W[ue++]]^v[W[ue++]]^g[W[ue++]]^h[W[ue++]]^f[W[ue++]]^m[W[ue++]]^u[W[ue++]]^o[W[ue++]]^a[W[ue++]]^e[W[ue++]];for(le+=15;ue<le;)ee=ee>>>8^e[(ee^W[ue++])&255];return~ee}function we(W,se){for(var ee=se^-1,le=0,ue=W.length,me=0,Me=0;le<ue;)me=W.charCodeAt(le++),me<128?ee=ee>>>8^e[(ee^me)&255]:me<2048?(ee=ee>>>8^e[(ee^(192|me>>6&31))&255],ee=ee>>>8^e[(ee^(128|me&63))&255]):me>=55296&&me<57344?(me=(me&1023)+64,Me=W.charCodeAt(le++)&1023,ee=ee>>>8^e[(ee^(240|me>>8&7))&255],ee=ee>>>8^e[(ee^(128|me>>2&63))&255],ee=ee>>>8^e[(ee^(128|Me>>6&15|(me&3)<<4))&255],ee=ee>>>8^e[(ee^(128|Me&63))&255]):(ee=ee>>>8^e[(ee^(224|me>>12&15))&255],ee=ee>>>8^e[(ee^(128|me>>6&63))&255],ee=ee>>>8^e[(ee^(128|me&63))&255]);return~ee}return i.table=e,i.bstr=K,i.buf=ce,i.str=we,i}(),At=function(){var t={};t.version="1.2.1";function e(S,A){for(var I=S.split("/"),M=A.split("/"),O=0,D=0,z=Math.min(I.length,M.length);O<z;++O){if(D=I[O].length-M[O].length)return D;if(I[O]!=M[O])return I[O]<M[O]?-1:1}return I.length-M.length}function n(S){if(S.charAt(S.length-1)=="/")return S.slice(0,-1).indexOf("/")===-1?S:n(S.slice(0,-1));var A=S.lastIndexOf("/");return A===-1?S:S.slice(0,A+1)}function r(S){if(S.charAt(S.length-1)=="/")return r(S.slice(0,-1));var A=S.lastIndexOf("/");return A===-1?S:S.slice(A+1)}function a(S,A){typeof A=="string"&&(A=new Date(A));var I=A.getHours();I=I<<6|A.getMinutes(),I=I<<5|A.getSeconds()>>>1,S.write_shift(2,I);var M=A.getFullYear()-1980;M=M<<4|A.getMonth()+1,M=M<<5|A.getDate(),S.write_shift(2,M)}function o(S){var A=S.read_shift(2)&65535,I=S.read_shift(2)&65535,M=new Date,O=I&31;I>>>=5;var D=I&15;I>>>=4,M.setMilliseconds(0),M.setFullYear(I+1980),M.setMonth(D-1),M.setDate(O);var z=A&31;A>>>=5;var ae=A&63;return A>>>=6,M.setHours(A),M.setMinutes(ae),M.setSeconds(z<<1),M}function u(S){_n(S,0);for(var A={},I=0;S.l<=S.length-4;){var M=S.read_shift(2),O=S.read_shift(2),D=S.l+O,z={};switch(M){case 21589:I=S.read_shift(1),I&1&&(z.mtime=S.read_shift(4)),O>5&&(I&2&&(z.atime=S.read_shift(4)),I&4&&(z.ctime=S.read_shift(4))),z.mtime&&(z.mt=new Date(z.mtime*1e3));break}S.l=D,A[M]=z}return A}var m;function f(){return m||(m={})}function h(S,A){if(S[0]==80&&S[1]==75)return fm(S,A);if((S[0]|32)==109&&(S[1]|32)==105)return jv(S,A);if(S.length<512)throw new Error("CFB file size "+S.length+" < 512");var I=3,M=512,O=0,D=0,z=0,ae=0,q=0,G=[],X=S.slice(0,512);_n(X,0);var pe=g(X);switch(I=pe[0],I){case 3:M=512;break;case 4:M=4096;break;case 0:if(pe[1]==0)return fm(S,A);default:throw new Error("Major Version: Expected 3 or 4 saw "+I)}M!==512&&(X=S.slice(0,M),_n(X,28));var ve=S.slice(0,M);v(X,I);var Ie=X.read_shift(4,"i");if(I===3&&Ie!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ie);X.l+=4,z=X.read_shift(4,"i"),X.l+=4,X.chk("00100000","Mini Stream Cutoff Size: "),ae=X.read_shift(4,"i"),O=X.read_shift(4,"i"),q=X.read_shift(4,"i"),D=X.read_shift(4,"i");for(var xe=-1,Ce=0;Ce<109&&(xe=X.read_shift(4,"i"),!(xe<0));++Ce)G[Ce]=xe;var He=b(S,M);C(q,D,He,M,G);var Ut=j(He,z,G,M);Ut[z].name="!Directory",O>0&&ae!==Me&&(Ut[ae].name="!MiniFAT"),Ut[G[0]].name="!FAT",Ut.fat_addrs=G,Ut.ssz=M;var Ki={},oi=[],cn=[],To=[];H(z,Ut,He,oi,O,Ki,cn,ae),w(cn,To,oi),oi.shift();var Po={FileIndex:cn,FullPaths:To};return A&&A.raw&&(Po.raw={header:ve,sectors:He}),Po}function g(S){if(S[S.l]==80&&S[S.l+1]==75)return[0,0];S.chk(mt,"Header Signature: "),S.l+=16;var A=S.read_shift(2,"u");return[S.read_shift(2,"u"),A]}function v(S,A){var I=9;switch(S.l+=2,I=S.read_shift(2)){case 9:if(A!=3)throw new Error("Sector Shift: Expected 9 saw "+I);break;case 12:if(A!=4)throw new Error("Sector Shift: Expected 12 saw "+I);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+I)}S.chk("0600","Mini Sector Shift: "),S.chk("000000000000","Reserved: ")}function b(S,A){for(var I=Math.ceil(S.length/A)-1,M=[],O=1;O<I;++O)M[O-1]=S.slice(O*A,(O+1)*A);return M[I-1]=S.slice(I*A),M}function w(S,A,I){for(var M=0,O=0,D=0,z=0,ae=0,q=I.length,G=[],X=[];M<q;++M)G[M]=X[M]=M,A[M]=I[M];for(;ae<X.length;++ae)M=X[ae],O=S[M].L,D=S[M].R,z=S[M].C,G[M]===M&&(O!==-1&&G[O]!==O&&(G[M]=G[O]),D!==-1&&G[D]!==D&&(G[M]=G[D])),z!==-1&&(G[z]=M),O!==-1&&M!=G[M]&&(G[O]=G[M],X.lastIndexOf(O)<ae&&X.push(O)),D!==-1&&M!=G[M]&&(G[D]=G[M],X.lastIndexOf(D)<ae&&X.push(D));for(M=1;M<q;++M)G[M]===M&&(D!==-1&&G[D]!==D?G[M]=G[D]:O!==-1&&G[O]!==O&&(G[M]=G[O]));for(M=1;M<q;++M)if(S[M].type!==0){if(ae=M,ae!=G[ae])do ae=G[ae],A[M]=A[ae]+"/"+A[M];while(ae!==0&&G[ae]!==-1&&ae!=G[ae]);G[M]=-1}for(A[0]+="/",M=1;M<q;++M)S[M].type!==2&&(A[M]+="/")}function x(S,A,I){for(var M=S.start,O=S.size,D=[],z=M;I&&O>0&&z>=0;)D.push(A.slice(z*me,z*me+me)),O-=me,z=ia(I,z*4);return D.length===0?ne(0):Fi(D).slice(0,S.size)}function C(S,A,I,M,O){var D=Me;if(S===Me){if(A!==0)throw new Error("DIFAT chain shorter than expected")}else if(S!==-1){var z=I[S],ae=(M>>>2)-1;if(!z)return;for(var q=0;q<ae&&(D=ia(z,q*4))!==Me;++q)O.push(D);C(ia(z,M-4),A-1,I,M,O)}}function U(S,A,I,M,O){var D=[],z=[];O||(O=[]);var ae=M-1,q=0,G=0;for(q=A;q>=0;){O[q]=!0,D[D.length]=q,z.push(S[q]);var X=I[Math.floor(q*4/M)];if(G=q*4&ae,M<4+G)throw new Error("FAT boundary crossed: "+q+" 4 "+M);if(!S[X])break;q=ia(S[X],G)}return{nodes:D,data:Ip([z])}}function j(S,A,I,M){var O=S.length,D=[],z=[],ae=[],q=[],G=M-1,X=0,pe=0,ve=0,Ie=0;for(X=0;X<O;++X)if(ae=[],ve=X+A,ve>=O&&(ve-=O),!z[ve]){q=[];var xe=[];for(pe=ve;pe>=0;){xe[pe]=!0,z[pe]=!0,ae[ae.length]=pe,q.push(S[pe]);var Ce=I[Math.floor(pe*4/M)];if(Ie=pe*4&G,M<4+Ie)throw new Error("FAT boundary crossed: "+pe+" 4 "+M);if(!S[Ce]||(pe=ia(S[Ce],Ie),xe[pe]))break}D[ve]={nodes:ae,data:Ip([q])}}return D}function H(S,A,I,M,O,D,z,ae){for(var q=0,G=M.length?2:0,X=A[S].data,pe=0,ve=0,Ie;pe<X.length;pe+=128){var xe=X.slice(pe,pe+128);_n(xe,64),ve=xe.read_shift(2),Ie=$l(xe,0,ve-G),M.push(Ie);var Ce={name:Ie,type:xe.read_shift(1),color:xe.read_shift(1),L:xe.read_shift(4,"i"),R:xe.read_shift(4,"i"),C:xe.read_shift(4,"i"),clsid:xe.read_shift(16),state:xe.read_shift(4,"i"),start:0,size:0},He=xe.read_shift(2)+xe.read_shift(2)+xe.read_shift(2)+xe.read_shift(2);He!==0&&(Ce.ct=K(xe,xe.l-8));var Ut=xe.read_shift(2)+xe.read_shift(2)+xe.read_shift(2)+xe.read_shift(2);Ut!==0&&(Ce.mt=K(xe,xe.l-8)),Ce.start=xe.read_shift(4,"i"),Ce.size=xe.read_shift(4,"i"),Ce.size<0&&Ce.start<0&&(Ce.size=Ce.type=0,Ce.start=Me,Ce.name=""),Ce.type===5?(q=Ce.start,O>0&&q!==Me&&(A[q].name="!StreamData")):Ce.size>=4096?(Ce.storage="fat",A[Ce.start]===void 0&&(A[Ce.start]=U(I,Ce.start,A.fat_addrs,A.ssz)),A[Ce.start].name=Ce.name,Ce.content=A[Ce.start].data.slice(0,Ce.size)):(Ce.storage="minifat",Ce.size<0?Ce.size=0:q!==Me&&Ce.start!==Me&&A[q]&&(Ce.content=x(Ce,A[q].data,(A[ae]||{}).data))),Ce.content&&_n(Ce.content,0),D[Ie]=Ce,z.push(Ce)}}function K(S,A){return new Date((yi(S,A+4)/1e7*Math.pow(2,32)+yi(S,A)/1e7-11644473600)*1e3)}function ce(S,A){return f(),h(m.readFileSync(S),A)}function we(S,A){var I=A&&A.type;switch(I||bt&&Buffer.isBuffer(S)&&(I="buffer"),I||"base64"){case"file":return ce(S,A);case"base64":return h(Ln(_r(S)),A);case"binary":return h(Ln(S),A)}return h(S,A)}function W(S,A){var I=A||{},M=I.root||"Root Entry";if(S.FullPaths||(S.FullPaths=[]),S.FileIndex||(S.FileIndex=[]),S.FullPaths.length!==S.FileIndex.length)throw new Error("inconsistent CFB structure");S.FullPaths.length===0&&(S.FullPaths[0]=M+"/",S.FileIndex[0]={name:M,type:5}),I.CLSID&&(S.FileIndex[0].clsid=I.CLSID),se(S)}function se(S){var A="Sh33tJ5";if(!At.find(S,"/"+A)){var I=ne(4);I[0]=55,I[1]=I[3]=50,I[2]=54,S.FileIndex.push({name:A,type:2,content:I,size:4,L:69,R:69,C:69}),S.FullPaths.push(S.FullPaths[0]+A),ee(S)}}function ee(S,A){W(S);for(var I=!1,M=!1,O=S.FullPaths.length-1;O>=0;--O){var D=S.FileIndex[O];switch(D.type){case 0:M?I=!0:(S.FileIndex.pop(),S.FullPaths.pop());break;case 1:case 2:case 5:M=!0,isNaN(D.R*D.L*D.C)&&(I=!0),D.R>-1&&D.L>-1&&D.R==D.L&&(I=!0);break;default:I=!0;break}}if(!(!I&&!A)){var z=new Date(1987,1,19),ae=0,q=Object.create?Object.create(null):{},G=[];for(O=0;O<S.FullPaths.length;++O)q[S.FullPaths[O]]=!0,S.FileIndex[O].type!==0&&G.push([S.FullPaths[O],S.FileIndex[O]]);for(O=0;O<G.length;++O){var X=n(G[O][0]);M=q[X],M||(G.push([X,{name:r(X).replace("/",""),type:1,clsid:be,ct:z,mt:z,content:null}]),q[X]=!0)}for(G.sort(function(Ie,xe){return e(Ie[0],xe[0])}),S.FullPaths=[],S.FileIndex=[],O=0;O<G.length;++O)S.FullPaths[O]=G[O][0],S.FileIndex[O]=G[O][1];for(O=0;O<G.length;++O){var pe=S.FileIndex[O],ve=S.FullPaths[O];if(pe.name=r(ve).replace("/",""),pe.L=pe.R=pe.C=-(pe.color=1),pe.size=pe.content?pe.content.length:0,pe.start=0,pe.clsid=pe.clsid||be,O===0)pe.C=G.length>1?1:-1,pe.size=0,pe.type=5;else if(ve.slice(-1)=="/"){for(ae=O+1;ae<G.length&&n(S.FullPaths[ae])!=ve;++ae);for(pe.C=ae>=G.length?-1:ae,ae=O+1;ae<G.length&&n(S.FullPaths[ae])!=n(ve);++ae);pe.R=ae>=G.length?-1:ae,pe.type=1}else n(S.FullPaths[O+1]||"")==n(ve)&&(pe.R=O+1),pe.type=2}}}function le(S,A){var I=A||{};if(I.fileType=="mad")return Wv(S,I);switch(ee(S),I.fileType){case"zip":return Rv(S,I)}var M=function(Ie){for(var xe=0,Ce=0,He=0;He<Ie.FileIndex.length;++He){var Ut=Ie.FileIndex[He];if(Ut.content){var Ki=Ut.content.length;Ki>0&&(Ki<4096?xe+=Ki+63>>6:Ce+=Ki+511>>9)}}for(var oi=Ie.FullPaths.length+3>>2,cn=xe+7>>3,To=xe+127>>7,Po=cn+Ce+oi+To,Hr=Po+127>>7,u0=Hr<=109?0:Math.ceil((Hr-109)/127);Po+Hr+u0+127>>7>Hr;)u0=++Hr<=109?0:Math.ceil((Hr-109)/127);var ur=[1,u0,Hr,To,oi,Ce,xe,0];return Ie.FileIndex[0].size=xe<<6,ur[7]=(Ie.FileIndex[0].start=ur[0]+ur[1]+ur[2]+ur[3]+ur[4]+ur[5])+(ur[6]+7>>3),ur}(S),O=ne(M[7]<<9),D=0,z=0;{for(D=0;D<8;++D)O.write_shift(1,De[D]);for(D=0;D<8;++D)O.write_shift(2,0);for(O.write_shift(2,62),O.write_shift(2,3),O.write_shift(2,65534),O.write_shift(2,9),O.write_shift(2,6),D=0;D<3;++D)O.write_shift(2,0);for(O.write_shift(4,0),O.write_shift(4,M[2]),O.write_shift(4,M[0]+M[1]+M[2]+M[3]-1),O.write_shift(4,0),O.write_shift(4,4096),O.write_shift(4,M[3]?M[0]+M[1]+M[2]-1:Me),O.write_shift(4,M[3]),O.write_shift(-4,M[1]?M[0]-1:Me),O.write_shift(4,M[1]),D=0;D<109;++D)O.write_shift(-4,D<M[2]?M[1]+D:-1)}if(M[1])for(z=0;z<M[1];++z){for(;D<236+z*127;++D)O.write_shift(-4,D<M[2]?M[1]+D:-1);O.write_shift(-4,z===M[1]-1?Me:z+1)}var ae=function(Ie){for(z+=Ie;D<z-1;++D)O.write_shift(-4,D+1);Ie&&(++D,O.write_shift(-4,Me))};for(z=D=0,z+=M[1];D<z;++D)O.write_shift(-4,Ee.DIFSECT);for(z+=M[2];D<z;++D)O.write_shift(-4,Ee.FATSECT);ae(M[3]),ae(M[4]);for(var q=0,G=0,X=S.FileIndex[0];q<S.FileIndex.length;++q)X=S.FileIndex[q],X.content&&(G=X.content.length,!(G<4096)&&(X.start=z,ae(G+511>>9)));for(ae(M[6]+7>>3);O.l&511;)O.write_shift(-4,Ee.ENDOFCHAIN);for(z=D=0,q=0;q<S.FileIndex.length;++q)X=S.FileIndex[q],X.content&&(G=X.content.length,!(!G||G>=4096)&&(X.start=z,ae(G+63>>6)));for(;O.l&511;)O.write_shift(-4,Ee.ENDOFCHAIN);for(D=0;D<M[4]<<2;++D){var pe=S.FullPaths[D];if(!pe||pe.length===0){for(q=0;q<17;++q)O.write_shift(4,0);for(q=0;q<3;++q)O.write_shift(4,-1);for(q=0;q<12;++q)O.write_shift(4,0);continue}X=S.FileIndex[D],D===0&&(X.start=X.size?X.start-1:Me);var ve=D===0&&I.root||X.name;if(G=2*(ve.length+1),O.write_shift(64,ve,"utf16le"),O.write_shift(2,G),O.write_shift(1,X.type),O.write_shift(1,X.color),O.write_shift(-4,X.L),O.write_shift(-4,X.R),O.write_shift(-4,X.C),X.clsid)O.write_shift(16,X.clsid,"hex");else for(q=0;q<4;++q)O.write_shift(4,0);O.write_shift(4,X.state||0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,0),O.write_shift(4,X.start),O.write_shift(4,X.size),O.write_shift(4,0)}for(D=1;D<S.FileIndex.length;++D)if(X=S.FileIndex[D],X.size>=4096)if(O.l=X.start+1<<9,bt&&Buffer.isBuffer(X.content))X.content.copy(O,O.l,0,X.size),O.l+=X.size+511&-512;else{for(q=0;q<X.size;++q)O.write_shift(1,X.content[q]);for(;q&511;++q)O.write_shift(1,0)}for(D=1;D<S.FileIndex.length;++D)if(X=S.FileIndex[D],X.size>0&&X.size<4096)if(bt&&Buffer.isBuffer(X.content))X.content.copy(O,O.l,0,X.size),O.l+=X.size+63&-64;else{for(q=0;q<X.size;++q)O.write_shift(1,X.content[q]);for(;q&63;++q)O.write_shift(1,0)}if(bt)O.l=O.length;else for(;O.l<O.length;)O.write_shift(1,0);return O}function ue(S,A){var I=S.FullPaths.map(function(q){return q.toUpperCase()}),M=I.map(function(q){var G=q.split("/");return G[G.length-(q.slice(-1)=="/"?2:1)]}),O=!1;A.charCodeAt(0)===47?(O=!0,A=I[0].slice(0,-1)+A):O=A.indexOf("/")!==-1;var D=A.toUpperCase(),z=O===!0?I.indexOf(D):M.indexOf(D);if(z!==-1)return S.FileIndex[z];var ae=!D.match(xl);for(D=D.replace(Xa,""),ae&&(D=D.replace(xl,"!")),z=0;z<I.length;++z)if((ae?I[z].replace(xl,"!"):I[z]).replace(Xa,"")==D||(ae?M[z].replace(xl,"!"):M[z]).replace(Xa,"")==D)return S.FileIndex[z];return null}var me=64,Me=-2,mt="d0cf11e0a1b11ae1",De=[208,207,17,224,161,177,26,225],be="00000000000000000000000000000000",Ee={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Me,FREESECT:-1,HEADER_SIGNATURE:mt,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:be,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function ke(S,A,I){f();var M=le(S,I);m.writeFileSync(A,M)}function Ue(S){for(var A=new Array(S.length),I=0;I<S.length;++I)A[I]=String.fromCharCode(S[I]);return A.join("")}function et(S,A){var I=le(S,A);switch(A&&A.type||"buffer"){case"file":return f(),m.writeFileSync(A.filename,I),I;case"binary":return typeof I=="string"?I:Ue(I);case"base64":return qo(typeof I=="string"?I:Ue(I));case"buffer":if(bt)return Buffer.isBuffer(I)?I:xr(I);case"array":return typeof I=="string"?Ln(I):I}return I}var Vt;function B(S){try{var A=S.InflateRaw,I=new A;if(I._processChunk(new Uint8Array([3,0]),I._finishFlushFlag),I.bytesRead)Vt=S;else throw new Error("zlib does not expose bytesRead")}catch(M){console.error("cannot use native zlib: "+(M.message||M))}}function re(S,A){if(!Vt)return um(S,A);var I=Vt.InflateRaw,M=new I,O=M._processChunk(S.slice(S.l),M._finishFlushFlag);return S.l+=M.bytesRead,O}function L(S){return Vt?Vt.deflateRawSync(S):am(S)}var V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],ye=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Oe(S){var A=(S<<1|S<<11)&139536|(S<<5|S<<15)&558144;return(A>>16|A>>8|A)&255}for(var Se=typeof Uint8Array<"u",he=Se?new Uint8Array(256):[],ht=0;ht<256;++ht)he[ht]=Oe(ht);function st(S,A){var I=he[S&255];return A<=8?I>>>8-A:(I=I<<8|he[S>>8&255],A<=16?I>>>16-A:(I=I<<8|he[S>>16&255],I>>>24-A))}function Ei(S,A){var I=A&7,M=A>>>3;return(S[M]|(I<=6?0:S[M+1]<<8))>>>I&3}function gt(S,A){var I=A&7,M=A>>>3;return(S[M]|(I<=5?0:S[M+1]<<8))>>>I&7}function Rn(S,A){var I=A&7,M=A>>>3;return(S[M]|(I<=4?0:S[M+1]<<8))>>>I&15}function Kt(S,A){var I=A&7,M=A>>>3;return(S[M]|(I<=3?0:S[M+1]<<8))>>>I&31}function Fe(S,A){var I=A&7,M=A>>>3;return(S[M]|(I<=1?0:S[M+1]<<8))>>>I&127}function yn(S,A,I){var M=A&7,O=A>>>3,D=(1<<I)-1,z=S[O]>>>M;return I<8-M||(z|=S[O+1]<<8-M,I<16-M)||(z|=S[O+2]<<16-M,I<24-M)||(z|=S[O+3]<<24-M),z&D}function dr(S,A,I){var M=A&7,O=A>>>3;return M<=5?S[O]|=(I&7)<<M:(S[O]|=I<<M&255,S[O+1]=(I&7)>>8-M),A+3}function jr(S,A,I){var M=A&7,O=A>>>3;return I=(I&1)<<M,S[O]|=I,A+1}function ba(S,A,I){var M=A&7,O=A>>>3;return I<<=M,S[O]|=I&255,I>>>=8,S[O+1]=I,A+8}function rm(S,A,I){var M=A&7,O=A>>>3;return I<<=M,S[O]|=I&255,I>>>=8,S[O+1]=I&255,S[O+2]=I>>>8,A+16}function s0(S,A){var I=S.length,M=2*I>A?2*I:A+5,O=0;if(I>=A)return S;if(bt){var D=pp(M);if(S.copy)S.copy(D);else for(;O<S.length;++O)D[O]=S[O];return D}else if(Se){var z=new Uint8Array(M);if(z.set)z.set(S);else for(;O<I;++O)z[O]=S[O];return z}return S.length=M,S}function $n(S){for(var A=new Array(S),I=0;I<S;++I)A[I]=0;return A}function Ts(S,A,I){var M=1,O=0,D=0,z=0,ae=0,q=S.length,G=Se?new Uint16Array(32):$n(32);for(D=0;D<32;++D)G[D]=0;for(D=q;D<I;++D)S[D]=0;q=S.length;var X=Se?new Uint16Array(q):$n(q);for(D=0;D<q;++D)G[O=S[D]]++,M<O&&(M=O),X[D]=0;for(G[0]=0,D=1;D<=M;++D)G[D+16]=ae=ae+G[D-1]<<1;for(D=0;D<q;++D)ae=S[D],ae!=0&&(X[D]=G[ae+16]++);var pe=0;for(D=0;D<q;++D)if(pe=S[D],pe!=0)for(ae=st(X[D],M)>>M-pe,z=(1<<M+4-pe)-1;z>=0;--z)A[ae|z<<pe]=pe&15|D<<4;return M}var l0=Se?new Uint16Array(512):$n(512),c0=Se?new Uint16Array(32):$n(32);if(!Se){for(var Wr=0;Wr<512;++Wr)l0[Wr]=0;for(Wr=0;Wr<32;++Wr)c0[Wr]=0}(function(){for(var S=[],A=0;A<32;A++)S.push(5);Ts(S,c0,32);var I=[];for(A=0;A<=143;A++)I.push(8);for(;A<=255;A++)I.push(9);for(;A<=279;A++)I.push(7);for(;A<=287;A++)I.push(8);Ts(I,l0,288)})();var Fv=function(){for(var A=Se?new Uint8Array(32768):[],I=0,M=0;I<ye.length-1;++I)for(;M<ye[I+1];++M)A[M]=I;for(;M<32768;++M)A[M]=29;var O=Se?new Uint8Array(259):[];for(I=0,M=0;I<fe.length-1;++I)for(;M<fe[I+1];++M)O[M]=I;function D(ae,q){for(var G=0;G<ae.length;){var X=Math.min(65535,ae.length-G),pe=G+X==ae.length;for(q.write_shift(1,+pe),q.write_shift(2,X),q.write_shift(2,~X&65535);X-- >0;)q[q.l++]=ae[G++]}return q.l}function z(ae,q){for(var G=0,X=0,pe=Se?new Uint16Array(32768):[];X<ae.length;){var ve=Math.min(65535,ae.length-X);if(ve<10){for(G=dr(q,G,+(X+ve==ae.length)),G&7&&(G+=8-(G&7)),q.l=G/8|0,q.write_shift(2,ve),q.write_shift(2,~ve&65535);ve-- >0;)q[q.l++]=ae[X++];G=q.l*8;continue}G=dr(q,G,+(X+ve==ae.length)+2);for(var Ie=0;ve-- >0;){var xe=ae[X];Ie=(Ie<<5^xe)&32767;var Ce=-1,He=0;if((Ce=pe[Ie])&&(Ce|=X&-32768,Ce>X&&(Ce-=32768),Ce<X))for(;ae[Ce+He]==ae[X+He]&&He<250;)++He;if(He>2){xe=O[He],xe<=22?G=ba(q,G,he[xe+1]>>1)-1:(ba(q,G,3),G+=5,ba(q,G,he[xe-23]>>5),G+=3);var Ut=xe<8?0:xe-4>>2;Ut>0&&(rm(q,G,He-fe[xe]),G+=Ut),xe=A[X-Ce],G=ba(q,G,he[xe]>>3),G-=3;var Ki=xe<4?0:xe-2>>1;Ki>0&&(rm(q,G,X-Ce-ye[xe]),G+=Ki);for(var oi=0;oi<He;++oi)pe[Ie]=X&32767,Ie=(Ie<<5^ae[X])&32767,++X;ve-=He-1}else xe<=143?xe=xe+48:G=jr(q,G,1),G=ba(q,G,he[xe]),pe[Ie]=X&32767,++X}G=ba(q,G,0)-1}return q.l=(G+7)/8|0,q.l}return function(q,G){return q.length<8?D(q,G):z(q,G)}}();function am(S){var A=ne(50+Math.floor(S.length*1.1)),I=Fv(S,A);return A.slice(0,I)}var om=Se?new Uint16Array(32768):$n(32768),sm=Se?new Uint16Array(32768):$n(32768),lm=Se?new Uint16Array(128):$n(128),cm=1,dm=1;function Av(S,A){var I=Kt(S,A)+257;A+=5;var M=Kt(S,A)+1;A+=5;var O=Rn(S,A)+4;A+=4;for(var D=0,z=Se?new Uint8Array(19):$n(19),ae=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=1,G=Se?new Uint8Array(8):$n(8),X=Se?new Uint8Array(8):$n(8),pe=z.length,ve=0;ve<O;++ve)z[V[ve]]=D=gt(S,A),q<D&&(q=D),G[D]++,A+=3;var Ie=0;for(G[0]=0,ve=1;ve<=q;++ve)X[ve]=Ie=Ie+G[ve-1]<<1;for(ve=0;ve<pe;++ve)(Ie=z[ve])!=0&&(ae[ve]=X[Ie]++);var xe=0;for(ve=0;ve<pe;++ve)if(xe=z[ve],xe!=0){Ie=he[ae[ve]]>>8-xe;for(var Ce=(1<<7-xe)-1;Ce>=0;--Ce)lm[Ie|Ce<<xe]=xe&7|ve<<3}var He=[];for(q=1;He.length<I+M;)switch(Ie=lm[Fe(S,A)],A+=Ie&7,Ie>>>=3){case 16:for(D=3+Ei(S,A),A+=2,Ie=He[He.length-1];D-- >0;)He.push(Ie);break;case 17:for(D=3+gt(S,A),A+=3;D-- >0;)He.push(0);break;case 18:for(D=11+Fe(S,A),A+=7;D-- >0;)He.push(0);break;default:He.push(Ie),q<Ie&&(q=Ie);break}var Ut=He.slice(0,I),Ki=He.slice(I);for(ve=I;ve<286;++ve)Ut[ve]=0;for(ve=M;ve<30;++ve)Ki[ve]=0;return cm=Ts(Ut,om,286),dm=Ts(Ki,sm,30),A}function Ov(S,A){if(S[0]==3&&!(S[1]&3))return[aa(A),2];for(var I=0,M=0,O=pp(A||1<<18),D=0,z=O.length>>>0,ae=0,q=0;(M&1)==0;){if(M=gt(S,I),I+=3,M>>>1)M>>1==1?(ae=9,q=5):(I=Av(S,I),ae=cm,q=dm);else{I&7&&(I+=8-(I&7));var G=S[I>>>3]|S[(I>>>3)+1]<<8;if(I+=32,G>0)for(!A&&z<D+G&&(O=s0(O,D+G),z=O.length);G-- >0;)O[D++]=S[I>>>3],I+=8;continue}for(;;){!A&&z<D+32767&&(O=s0(O,D+32767),z=O.length);var X=yn(S,I,ae),pe=M>>>1==1?l0[X]:om[X];if(I+=pe&15,pe>>>=4,(pe>>>8&255)===0)O[D++]=pe;else{if(pe==256)break;pe-=257;var ve=pe<8?0:pe-4>>2;ve>5&&(ve=0);var Ie=D+fe[pe];ve>0&&(Ie+=yn(S,I,ve),I+=ve),X=yn(S,I,q),pe=M>>>1==1?c0[X]:sm[X],I+=pe&15,pe>>>=4;var xe=pe<4?0:pe-2>>1,Ce=ye[pe];for(xe>0&&(Ce+=yn(S,I,xe),I+=xe),!A&&z<Ie&&(O=s0(O,Ie+100),z=O.length);D<Ie;)O[D]=O[D-Ce],++D}}}return A?[O,I+7>>>3]:[O.slice(0,D),I+7>>>3]}function um(S,A){var I=S.slice(S.l||0),M=Ov(I,A);return S.l+=M[1],M[0]}function mm(S,A){if(S)typeof console<"u"&&console.error(A);else throw new Error(A)}function fm(S,A){var I=S;_n(I,0);var M=[],O=[],D={FileIndex:M,FullPaths:O};W(D,{root:A.root});for(var z=I.length-4;(I[z]!=80||I[z+1]!=75||I[z+2]!=5||I[z+3]!=6)&&z>=0;)--z;I.l=z+4,I.l+=4;var ae=I.read_shift(2);I.l+=6;var q=I.read_shift(4);for(I.l=q,z=0;z<ae;++z){I.l+=20;var G=I.read_shift(4),X=I.read_shift(4),pe=I.read_shift(2),ve=I.read_shift(2),Ie=I.read_shift(2);I.l+=8;var xe=I.read_shift(4),Ce=u(I.slice(I.l+pe,I.l+pe+ve));I.l+=pe+ve+Ie;var He=I.l;I.l=xe+4,Dv(I,G,X,D,Ce),I.l=He}return D}function Dv(S,A,I,M,O){S.l+=2;var D=S.read_shift(2),z=S.read_shift(2),ae=o(S);if(D&8257)throw new Error("Unsupported ZIP encryption");for(var q=S.read_shift(4),G=S.read_shift(4),X=S.read_shift(4),pe=S.read_shift(2),ve=S.read_shift(2),Ie="",xe=0;xe<pe;++xe)Ie+=String.fromCharCode(S[S.l++]);if(ve){var Ce=u(S.slice(S.l,S.l+ve));(Ce[21589]||{}).mt&&(ae=Ce[21589].mt),((O||{})[21589]||{}).mt&&(ae=O[21589].mt)}S.l+=ve;var He=S.slice(S.l,S.l+G);switch(z){case 8:He=re(S,X);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+z)}var Ut=!1;D&8&&(q=S.read_shift(4),q==134695760&&(q=S.read_shift(4),Ut=!0),G=S.read_shift(4),X=S.read_shift(4)),G!=A&&mm(Ut,"Bad compressed size: "+A+" != "+G),X!=I&&mm(Ut,"Bad uncompressed size: "+I+" != "+X),d0(M,Ie,He,{unsafe:!0,mt:ae})}function Rv(S,A){var I=A||{},M=[],O=[],D=ne(1),z=I.compression?8:0,ae=0,q=!1;q&&(ae|=8);var G=0,X=0,pe=0,ve=0,Ie=S.FullPaths[0],xe=Ie,Ce=S.FileIndex[0],He=[],Ut=0;for(G=1;G<S.FullPaths.length;++G)if(xe=S.FullPaths[G].slice(Ie.length),Ce=S.FileIndex[G],!(!Ce.size||!Ce.content||xe=="Sh33tJ5")){var Ki=pe,oi=ne(xe.length);for(X=0;X<xe.length;++X)oi.write_shift(1,xe.charCodeAt(X)&127);oi=oi.slice(0,oi.l),He[ve]=Nb.buf(Ce.content,0);var cn=Ce.content;z==8&&(cn=L(cn)),D=ne(30),D.write_shift(4,67324752),D.write_shift(2,20),D.write_shift(2,ae),D.write_shift(2,z),Ce.mt?a(D,Ce.mt):D.write_shift(4,0),D.write_shift(-4,ae&8?0:He[ve]),D.write_shift(4,ae&8?0:cn.length),D.write_shift(4,ae&8?0:Ce.content.length),D.write_shift(2,oi.length),D.write_shift(2,0),pe+=D.length,M.push(D),pe+=oi.length,M.push(oi),pe+=cn.length,M.push(cn),ae&8&&(D=ne(12),D.write_shift(-4,He[ve]),D.write_shift(4,cn.length),D.write_shift(4,Ce.content.length),pe+=D.l,M.push(D)),D=ne(46),D.write_shift(4,33639248),D.write_shift(2,0),D.write_shift(2,20),D.write_shift(2,ae),D.write_shift(2,z),D.write_shift(4,0),D.write_shift(-4,He[ve]),D.write_shift(4,cn.length),D.write_shift(4,Ce.content.length),D.write_shift(2,oi.length),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(4,0),D.write_shift(4,Ki),Ut+=D.l,O.push(D),Ut+=oi.length,O.push(oi),++ve}return D=ne(22),D.write_shift(4,101010256),D.write_shift(2,0),D.write_shift(2,0),D.write_shift(2,ve),D.write_shift(2,ve),D.write_shift(4,Ut),D.write_shift(4,pe),D.write_shift(2,0),Fi([Fi(M),Fi(O),D])}var Ps={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Nv(S,A){if(S.ctype)return S.ctype;var I=S.name||"",M=I.match(/\.([^\.]+)$/);return M&&Ps[M[1]]||A&&(M=(I=A).match(/[\.\\]([^\.\\])+$/),M&&Ps[M[1]])?Ps[M[1]]:"application/octet-stream"}function Bv(S){for(var A=qo(S),I=[],M=0;M<A.length;M+=76)I.push(A.slice(M,M+76));return I.join(`\r
`)+`\r
`}function Lv(S){var A=S.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(G){var X=G.charCodeAt(0).toString(16).toUpperCase();return"="+(X.length==1?"0"+X:X)});A=A.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),A.charAt(0)==`
`&&(A="=0D"+A.slice(1)),A=A.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var I=[],M=A.split(`\r
`),O=0;O<M.length;++O){var D=M[O];if(D.length==0){I.push("");continue}for(var z=0;z<D.length;){var ae=76,q=D.slice(z,z+ae);q.charAt(ae-1)=="="?ae--:q.charAt(ae-2)=="="?ae-=2:q.charAt(ae-3)=="="&&(ae-=3),q=D.slice(z,z+ae),z+=ae,z<D.length&&(q+="="),I.push(q)}}return I.join(`\r
`)}function Vv(S){for(var A=[],I=0;I<S.length;++I){for(var M=S[I];I<=S.length&&M.charAt(M.length-1)=="=";)M=M.slice(0,M.length-1)+S[++I];A.push(M)}for(var O=0;O<A.length;++O)A[O]=A[O].replace(/[=][0-9A-Fa-f]{2}/g,function(D){return String.fromCharCode(parseInt(D.slice(1),16))});return Ln(A.join(`\r
`))}function Uv(S,A,I){for(var M="",O="",D="",z,ae=0;ae<10;++ae){var q=A[ae];if(!q||q.match(/^\s*$/))break;var G=q.match(/^(.*?):\s*([^\s].*)$/);if(G)switch(G[1].toLowerCase()){case"content-location":M=G[2].trim();break;case"content-type":D=G[2].trim();break;case"content-transfer-encoding":O=G[2].trim();break}}switch(++ae,O.toLowerCase()){case"base64":z=Ln(_r(A.slice(ae).join("")));break;case"quoted-printable":z=Vv(A.slice(ae));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+O)}var X=d0(S,M.slice(I.length),z,{unsafe:!0});D&&(X.ctype=D)}function jv(S,A){if(Ue(S.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var I=A&&A.root||"",M=(bt&&Buffer.isBuffer(S)?S.toString("binary"):Ue(S)).split(`\r
`),O=0,D="";for(O=0;O<M.length;++O)if(D=M[O],!!/^Content-Location:/i.test(D)&&(D=D.slice(D.indexOf("file")),I||(I=D.slice(0,D.lastIndexOf("/")+1)),D.slice(0,I.length)!=I))for(;I.length>0&&(I=I.slice(0,I.length-1),I=I.slice(0,I.lastIndexOf("/")+1),D.slice(0,I.length)!=I););var z=(M[1]||"").match(/boundary="(.*?)"/);if(!z)throw new Error("MAD cannot find boundary");var ae="--"+(z[1]||""),q=[],G=[],X={FileIndex:q,FullPaths:G};W(X);var pe,ve=0;for(O=0;O<M.length;++O){var Ie=M[O];Ie!==ae&&Ie!==ae+"--"||(ve++&&Uv(X,M.slice(pe,O),I),pe=O)}return X}function Wv(S,A){var I=A||{},M=I.boundary||"SheetJS";M="------="+M;for(var O=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+M.slice(2)+'"',"","",""],D=S.FullPaths[0],z=D,ae=S.FileIndex[0],q=1;q<S.FullPaths.length;++q)if(z=S.FullPaths[q].slice(D.length),ae=S.FileIndex[q],!(!ae.size||!ae.content||z=="Sh33tJ5")){z=z.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(He){return"_x"+He.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(He){return"_u"+He.charCodeAt(0).toString(16)+"_"});for(var G=ae.content,X=bt&&Buffer.isBuffer(G)?G.toString("binary"):Ue(G),pe=0,ve=Math.min(1024,X.length),Ie=0,xe=0;xe<=ve;++xe)(Ie=X.charCodeAt(xe))>=32&&Ie<128&&++pe;var Ce=pe>=ve*4/5;O.push(M),O.push("Content-Location: "+(I.root||"file:///C:/SheetJS/")+z),O.push("Content-Transfer-Encoding: "+(Ce?"quoted-printable":"base64")),O.push("Content-Type: "+Nv(ae,z)),O.push(""),O.push(Ce?Lv(X):Bv(X))}return O.push(M+`--\r
`),O.join(`\r
`)}function Hv(S){var A={};return W(A,S),A}function d0(S,A,I,M){var O=M&&M.unsafe;O||W(S);var D=!O&&At.find(S,A);if(!D){var z=S.FullPaths[0];A.slice(0,z.length)==z?z=A:(z.slice(-1)!="/"&&(z+="/"),z=(z+A).replace("//","/")),D={name:r(A),type:2},S.FileIndex.push(D),S.FullPaths.push(z),O||At.utils.cfb_gc(S)}return D.content=I,D.size=I?I.length:0,M&&(M.CLSID&&(D.clsid=M.CLSID),M.mt&&(D.mt=M.mt),M.ct&&(D.ct=M.ct)),D}function zv(S,A){W(S);var I=At.find(S,A);if(I){for(var M=0;M<S.FileIndex.length;++M)if(S.FileIndex[M]==I)return S.FileIndex.splice(M,1),S.FullPaths.splice(M,1),!0}return!1}function $v(S,A,I){W(S);var M=At.find(S,A);if(M){for(var O=0;O<S.FileIndex.length;++O)if(S.FileIndex[O]==M)return S.FileIndex[O].name=r(I),S.FullPaths[O]=I,!0}return!1}function Gv(S){ee(S,!0)}return t.find=ue,t.read=we,t.parse=h,t.write=et,t.writeFile=ke,t.utils={cfb_new:Hv,cfb_add:d0,cfb_del:zv,cfb_mov:$v,cfb_gc:Gv,ReadShift:jo,CheckField:Eh,prep_blob:_n,bconcat:Fi,use_zlib:B,_deflateRaw:am,_inflateRaw:um,consts:Ee},t}(),yl;function Bb(i){return typeof i=="string"?Ul(i):Array.isArray(i)?cb(i):i}function Zo(i,t,e){if(typeof yl<"u"&&yl.writeFileSync)return e?yl.writeFileSync(i,t,e):yl.writeFileSync(i,t);if(typeof Deno<"u"){if(e&&typeof t=="string")switch(e){case"utf8":t=new TextEncoder(e).encode(t);break;case"binary":t=Ul(t);break;default:throw new Error("Unsupported encoding "+e)}return Deno.writeFileSync(i,t)}var n=e=="utf8"?fr(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(n,i);if(typeof Blob<"u"){var r=new Blob([Bb(n)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(r,i);if(typeof saveAs<"u")return saveAs(r,i);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var a=URL.createObjectURL(r);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),chrome.downloads.download({url:a,filename:i,saveAs:!0});var o=document.createElement("a");if(o.download!=null)return o.download=i,o.href=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),a}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var u=File(i);return u.open("w"),u.encoding="binary",Array.isArray(t)&&(t=Jo(t)),u.write(t),u.close(),t}catch(m){if(!m.message||!m.message.match(/onstruct/))throw m}throw new Error("cannot save file "+i)}function Di(i){for(var t=Object.keys(i),e=[],n=0;n<t.length;++n)Object.prototype.hasOwnProperty.call(i,t[n])&&e.push(t[n]);return e}function Cp(i,t){for(var e=[],n=Di(i),r=0;r!==n.length;++r)e[i[n[r]][t]]==null&&(e[i[n[r]][t]]=n[r]);return e}function B0(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]=e[n];return t}function Hl(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]=parseInt(e[n],10);return t}function Lb(i){for(var t=[],e=Di(i),n=0;n!==e.length;++n)t[i[e[n]]]==null&&(t[i[e[n]]]=[]),t[i[e[n]]].push(e[n]);return t}var Ml=new Date(1899,11,30,0,0,0);function tn(i,t){var e=i.getTime();t&&(e-=1462*24*60*60*1e3);var n=Ml.getTime()+(i.getTimezoneOffset()-Ml.getTimezoneOffset())*6e4;return(e-n)/(24*60*60*1e3)}var fh=new Date,Vb=Ml.getTime()+(fh.getTimezoneOffset()-Ml.getTimezoneOffset())*6e4,Sp=fh.getTimezoneOffset();function ph(i){var t=new Date;return t.setTime(i*24*60*60*1e3+Vb),t.getTimezoneOffset()!==Sp&&t.setTime(t.getTime()+(t.getTimezoneOffset()-Sp)*6e4),t}var wp=new Date("2017-02-19T19:06:09.000Z"),hh=isNaN(wp.getFullYear())?new Date("2/19/17"):wp,Ub=hh.getFullYear()==2017;function Gi(i,t){var e=new Date(i);if(Ub)return t>0?e.setTime(e.getTime()+e.getTimezoneOffset()*60*1e3):t<0&&e.setTime(e.getTime()-e.getTimezoneOffset()*60*1e3),e;if(i instanceof Date)return i;if(hh.getFullYear()==1917&&!isNaN(e.getFullYear())){var n=e.getFullYear();return i.indexOf(""+n)>-1||e.setFullYear(e.getFullYear()+100),e}var r=i.match(/\d+/g)||["2017","2","19","0","0","0"],a=new Date(+r[0],+r[1]-1,+r[2],+r[3]||0,+r[4]||0,+r[5]||0);return i.indexOf("Z")>-1&&(a=new Date(a.getTime()-a.getTimezoneOffset()*60*1e3)),a}function zl(i,t){if(bt&&Buffer.isBuffer(i)){if(t){if(i[0]==255&&i[1]==254)return fr(i.slice(2).toString("utf16le"));if(i[1]==254&&i[2]==255)return fr(lb(i.slice(2).toString("binary")))}return i.toString("binary")}if(typeof TextDecoder<"u")try{if(t){if(i[0]==255&&i[1]==254)return fr(new TextDecoder("utf-16le").decode(i.slice(2)));if(i[0]==254&&i[1]==255)return fr(new TextDecoder("utf-16be").decode(i.slice(2)))}var e={"\u20AC":"\x80","\u201A":"\x82",\u0192:"\x83","\u201E":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87","\u02C6":"\x88","\u2030":"\x89",\u0160:"\x8A","\u2039":"\x8B",\u0152:"\x8C",\u017D:"\x8E","\u2018":"\x91","\u2019":"\x92","\u201C":"\x93","\u201D":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02DC":"\x98","\u2122":"\x99",\u0161:"\x9A","\u203A":"\x9B",\u0153:"\x9C",\u017E:"\x9E",\u0178:"\x9F"};return Array.isArray(i)&&(i=new Uint8Array(i)),new TextDecoder("latin1").decode(i).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(a){return e[a]||a})}catch{}for(var n=[],r=0;r!=i.length;++r)n.push(String.fromCharCode(i[r]));return n.join("")}function nn(i){if(typeof JSON<"u"&&!Array.isArray(i))return JSON.parse(JSON.stringify(i));if(typeof i!="object"||i==null)return i;if(i instanceof Date)return new Date(i.getTime());var t={};for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=nn(i[e]));return t}function ii(i,t){for(var e="";e.length<t;)e+=i;return e}function hr(i){var t=Number(i);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(i))return t;var e=1,n=i.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return e*=100,""});return!isNaN(t=Number(n))||(n=n.replace(/[(](.*)[)]/,function(r,a){return e=-e,a}),!isNaN(t=Number(n)))?t/e:t}var jb=["january","february","march","april","may","june","july","august","september","october","november","december"];function Xo(i){var t=new Date(i),e=new Date(NaN),n=t.getYear(),r=t.getMonth(),a=t.getDate();if(isNaN(a))return e;var o=i.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&jb.indexOf(o)==-1)return e}else if(o.match(/[a-z]/))return e;return n<0||n>8099?e:(r>0||a>1)&&n!=101?t:i.match(/[^-0-9:,\/\\]/)?e:t}function Ye(i,t,e){if(i.FullPaths){if(typeof e=="string"){var n;return bt?n=xr(e):n=db(e),At.utils.cfb_add(i,t,n)}At.utils.cfb_add(i,t,e)}else i.file(t,e)}function L0(){return At.utils.cfb_new()}var pi=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`;var Wb={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},V0=B0(Wb);var U0=/[&<>'"]/g,Hb=/[\u0000-\u0008\u000b-\u001f]/g;function kt(i){var t=i+"";return t.replace(U0,function(e){return V0[e]}).replace(Hb,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"})}function Ep(i){return kt(i).replace(/ /g,"_x0020_")}var gh=/[\u0000-\u001f]/g;function zb(i){var t=i+"";return t.replace(U0,function(e){return V0[e]}).replace(/\n/g,"<br/>").replace(gh,function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})}function $b(i){var t=i+"";return t.replace(U0,function(e){return V0[e]}).replace(gh,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}function Gb(i){return i.replace(/(\r\n|[\r\n])/g,"&#10;")}function qb(i){switch(i){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function w0(i){for(var t="",e=0,n=0,r=0,a=0,o=0,u=0;e<i.length;){if(n=i.charCodeAt(e++),n<128){t+=String.fromCharCode(n);continue}if(r=i.charCodeAt(e++),n>191&&n<224){o=(n&31)<<6,o|=r&63,t+=String.fromCharCode(o);continue}if(a=i.charCodeAt(e++),n<240){t+=String.fromCharCode((n&15)<<12|(r&63)<<6|a&63);continue}o=i.charCodeAt(e++),u=((n&7)<<18|(r&63)<<12|(a&63)<<6|o&63)-65536,t+=String.fromCharCode(55296+(u>>>10&1023)),t+=String.fromCharCode(56320+(u&1023))}return t}function Tp(i){var t=aa(2*i.length),e,n,r=1,a=0,o=0,u;for(n=0;n<i.length;n+=r)r=1,(u=i.charCodeAt(n))<128?e=u:u<224?(e=(u&31)*64+(i.charCodeAt(n+1)&63),r=2):u<240?(e=(u&15)*4096+(i.charCodeAt(n+1)&63)*64+(i.charCodeAt(n+2)&63),r=3):(r=4,e=(u&7)*262144+(i.charCodeAt(n+1)&63)*4096+(i.charCodeAt(n+2)&63)*64+(i.charCodeAt(n+3)&63),e-=65536,o=55296+(e>>>10&1023),e=56320+(e&1023)),o!==0&&(t[a++]=o&255,t[a++]=o>>>8,o=0),t[a++]=e%256,t[a++]=e>>>8;return t.slice(0,a).toString("ucs2")}function Pp(i){return xr(i,"binary").toString("utf8")}var Cl="foo bar baz\xE2\x98\x83\xF0\x9F\x8D\xA3",Uo=bt&&(Pp(Cl)==w0(Cl)&&Pp||Tp(Cl)==w0(Cl)&&Tp)||w0,fr=bt?function(i){return xr(i,"utf8").toString("binary")}:function(i){for(var t=[],e=0,n=0,r=0;e<i.length;)switch(n=i.charCodeAt(e++),!0){case n<128:t.push(String.fromCharCode(n));break;case n<2048:t.push(String.fromCharCode(192+(n>>6))),t.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,r=i.charCodeAt(e++)-56320+(n<<10),t.push(String.fromCharCode(240+(r>>18&7))),t.push(String.fromCharCode(144+(r>>12&63))),t.push(String.fromCharCode(128+(r>>6&63))),t.push(String.fromCharCode(128+(r&63)));break;default:t.push(String.fromCharCode(224+(n>>12))),t.push(String.fromCharCode(128+(n>>6&63))),t.push(String.fromCharCode(128+(n&63)))}return t.join("")};var Xb=function(){var i=[["nbsp"," "],["middot","\xB7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(e){for(var n=e.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),r=0;r<i.length;++r)n=n.replace(i[r][0],i[r][1]);return n}}();var _h=/(^\s|\s$|\n)/;function Ai(i,t){return"<"+i+(t.match(_h)?' xml:space="preserve"':"")+">"+t+"</"+i+">"}function Ko(i){return Di(i).map(function(t){return" "+t+'="'+i[t]+'"'}).join("")}function ge(i,t,e){return"<"+i+(e!=null?Ko(e):"")+(t!=null?(t.match(_h)?' xml:space="preserve"':"")+">"+t+"</"+i:"/")+">"}function A0(i,t){try{return i.toISOString().replace(/\.\d*/,"")}catch(e){if(t)throw e}return""}function Kb(i,t){switch(typeof i){case"string":var e=ge("vt:lpwstr",kt(i));return t&&(e=e.replace(/&quot;/g,"_x0022_")),e;case"number":return ge((i|0)==i?"vt:i4":"vt:r8",kt(String(i)));case"boolean":return ge("vt:bool",i?"true":"false")}if(i instanceof Date)return ge("vt:filetime",A0(i));throw new Error("Unable to serialize "+i)}var Ci={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},to=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],vn={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function Yb(i,t){for(var e=1-2*(i[t+7]>>>7),n=((i[t+7]&127)<<4)+(i[t+6]>>>4&15),r=i[t+6]&15,a=5;a>=0;--a)r=r*256+i[t+a];return n==2047?r==0?e*(1/0):NaN:(n==0?n=-1022:(n-=1023,r+=Math.pow(2,52)),e*Math.pow(2,n-52)*r)}function Qb(i,t,e){var n=(t<0||1/t==-1/0?1:0)<<7,r=0,a=0,o=n?-t:t;isFinite(o)?o==0?r=a=0:(r=Math.floor(Math.log(o)/Math.LN2),a=o*Math.pow(2,52-r),r<=-1023&&(!isFinite(a)||a<Math.pow(2,52))?r=-1022:(a-=Math.pow(2,52),r+=1023)):(r=2047,a=isNaN(t)?26985:0);for(var u=0;u<=5;++u,a/=256)i[e+u]=a&255;i[e+6]=(r&15)<<4|a&15,i[e+7]=r>>4|n}var kp=function(i){for(var t=[],e=10240,n=0;n<i[0].length;++n)if(i[0][n])for(var r=0,a=i[0][n].length;r<a;r+=e)t.push.apply(t,i[0][n].slice(r,r+e));return t},Ip=bt?function(i){return i[0].length>0&&Buffer.isBuffer(i[0][0])?Buffer.concat(i[0].map(function(t){return Buffer.isBuffer(t)?t:xr(t)})):kp(i)}:kp,Mp=function(i,t,e){for(var n=[],r=t;r<e;r+=2)n.push(String.fromCharCode(Vo(i,r)));return n.join("").replace(Xa,"")},$l=bt?function(i,t,e){return Buffer.isBuffer(i)?i.toString("utf16le",t,e).replace(Xa,""):Mp(i,t,e)}:Mp,Fp=function(i,t,e){for(var n=[],r=t;r<t+e;++r)n.push(("0"+i[r].toString(16)).slice(-2));return n.join("")},vh=bt?function(i,t,e){return Buffer.isBuffer(i)?i.toString("hex",t,t+e):Fp(i,t,e)}:Fp,Ap=function(i,t,e){for(var n=[],r=t;r<e;r++)n.push(String.fromCharCode(Ga(i,r)));return n.join("")},io=bt?function(t,e,n){return Buffer.isBuffer(t)?t.toString("utf8",e,n):Ap(t,e,n)}:Ap,xh=function(i,t){var e=yi(i,t);return e>0?io(i,t+4,t+4+e-1):""},j0=xh,bh=function(i,t){var e=yi(i,t);return e>0?io(i,t+4,t+4+e-1):""},W0=bh,yh=function(i,t){var e=2*yi(i,t);return e>0?io(i,t+4,t+4+e-1):""},H0=yh,Ch=function(t,e){var n=yi(t,e);return n>0?$l(t,e+4,e+4+n):""},z0=Ch,Sh=function(i,t){var e=yi(i,t);return e>0?io(i,t+4,t+4+e):""},$0=Sh,wh=function(i,t){return Yb(i,t)},Fl=wh,G0=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};bt&&(j0=function(t,e){if(!Buffer.isBuffer(t))return xh(t,e);var n=t.readUInt32LE(e);return n>0?t.toString("utf8",e+4,e+4+n-1):""},W0=function(t,e){if(!Buffer.isBuffer(t))return bh(t,e);var n=t.readUInt32LE(e);return n>0?t.toString("utf8",e+4,e+4+n-1):""},H0=function(t,e){if(!Buffer.isBuffer(t))return yh(t,e);var n=2*t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+n-1)},z0=function(t,e){if(!Buffer.isBuffer(t))return Ch(t,e);var n=t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+n)},$0=function(t,e){if(!Buffer.isBuffer(t))return Sh(t,e);var n=t.readUInt32LE(e);return t.toString("utf8",e+4,e+4+n)},Fl=function(t,e){return Buffer.isBuffer(t)?t.readDoubleLE(e):wh(t,e)},G0=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});function Jb(){$l=function(i,t,e){return Dt.utils.decode(1200,i.slice(t,e)).replace(Xa,"")},io=function(i,t,e){return Dt.utils.decode(65001,i.slice(t,e))},j0=function(i,t){var e=yi(i,t);return e>0?Dt.utils.decode(Za,i.slice(t+4,t+4+e-1)):""},W0=function(i,t){var e=yi(i,t);return e>0?Dt.utils.decode(na,i.slice(t+4,t+4+e-1)):""},H0=function(i,t){var e=2*yi(i,t);return e>0?Dt.utils.decode(1200,i.slice(t+4,t+4+e-1)):""},z0=function(i,t){var e=yi(i,t);return e>0?Dt.utils.decode(1200,i.slice(t+4,t+4+e)):""},$0=function(i,t){var e=yi(i,t);return e>0?Dt.utils.decode(65001,i.slice(t+4,t+4+e)):""}}typeof Dt<"u"&&Jb();var Ga=function(i,t){return i[t]},Vo=function(i,t){return i[t+1]*256+i[t]},Zb=function(i,t){var e=i[t+1]*256+i[t];return e<32768?e:(65535-e+1)*-1},yi=function(i,t){return i[t+3]*(1<<24)+(i[t+2]<<16)+(i[t+1]<<8)+i[t]},ia=function(i,t){return i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t]},ey=function(i,t){return i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3]};function jo(i,t){var e="",n,r,a=[],o,u,m,f;switch(t){case"dbcs":if(f=this.l,bt&&Buffer.isBuffer(this))e=this.slice(this.l,this.l+2*i).toString("utf16le");else for(m=0;m<i;++m)e+=String.fromCharCode(Vo(this,f)),f+=2;i*=2;break;case"utf8":e=io(this,this.l,this.l+i);break;case"utf16le":i*=2,e=$l(this,this.l,this.l+i);break;case"wstr":if(typeof Dt<"u")e=Dt.utils.decode(na,this.slice(this.l,this.l+2*i));else return jo.call(this,i,"dbcs");i=2*i;break;case"lpstr-ansi":e=j0(this,this.l),i=4+yi(this,this.l);break;case"lpstr-cp":e=W0(this,this.l),i=4+yi(this,this.l);break;case"lpwstr":e=H0(this,this.l),i=4+2*yi(this,this.l);break;case"lpp4":i=4+yi(this,this.l),e=z0(this,this.l),i&2&&(i+=2);break;case"8lpp4":i=4+yi(this,this.l),e=$0(this,this.l),i&3&&(i+=4-(i&3));break;case"cstr":for(i=0,e="";(o=Ga(this,this.l+i++))!==0;)a.push(vl(o));e=a.join("");break;case"_wstr":for(i=0,e="";(o=Vo(this,this.l+i))!==0;)a.push(vl(o)),i+=2;i+=2,e=a.join("");break;case"dbcs-cont":for(e="",f=this.l,m=0;m<i;++m){if(this.lens&&this.lens.indexOf(f)!==-1)return o=Ga(this,f),this.l=f+1,u=jo.call(this,i-m,o?"dbcs-cont":"sbcs-cont"),a.join("")+u;a.push(vl(Vo(this,f))),f+=2}e=a.join(""),i*=2;break;case"cpstr":if(typeof Dt<"u"){e=Dt.utils.decode(na,this.slice(this.l,this.l+i));break}case"sbcs-cont":for(e="",f=this.l,m=0;m!=i;++m){if(this.lens&&this.lens.indexOf(f)!==-1)return o=Ga(this,f),this.l=f+1,u=jo.call(this,i-m,o?"dbcs-cont":"sbcs-cont"),a.join("")+u;a.push(vl(Ga(this,f))),f+=1}e=a.join("");break;default:switch(i){case 1:return n=Ga(this,this.l),this.l++,n;case 2:return n=(t==="i"?Zb:Vo)(this,this.l),this.l+=2,n;case 4:case-4:return t==="i"||(this[this.l+3]&128)===0?(n=(i>0?ia:ey)(this,this.l),this.l+=4,n):(r=yi(this,this.l),this.l+=4,r);case 8:case-8:if(t==="f")return i==8?r=Fl(this,this.l):r=Fl([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;i=8;case 16:e=vh(this,this.l,i);break}}return this.l+=i,e}var ty=function(i,t,e){i[e]=t&255,i[e+1]=t>>>8&255,i[e+2]=t>>>16&255,i[e+3]=t>>>24&255},iy=function(i,t,e){i[e]=t&255,i[e+1]=t>>8&255,i[e+2]=t>>16&255,i[e+3]=t>>24&255},ny=function(i,t,e){i[e]=t&255,i[e+1]=t>>>8&255};function ry(i,t,e){var n=0,r=0;if(e==="dbcs"){for(r=0;r!=t.length;++r)ny(this,t.charCodeAt(r),this.l+2*r);n=2*t.length}else if(e==="sbcs"){if(typeof Dt<"u"&&Za==874)for(r=0;r!=t.length;++r){var a=Dt.utils.encode(Za,t.charAt(r));this[this.l+r]=a[0]}else for(t=t.replace(/[^\x00-\x7F]/g,"_"),r=0;r!=t.length;++r)this[this.l+r]=t.charCodeAt(r)&255;n=t.length}else if(e==="hex"){for(;r<i;++r)this[this.l++]=parseInt(t.slice(2*r,2*r+2),16)||0;return this}else if(e==="utf16le"){var o=Math.min(this.l+i,this.length);for(r=0;r<Math.min(t.length,i);++r){var u=t.charCodeAt(r);this[this.l++]=u&255,this[this.l++]=u>>8}for(;this.l<o;)this[this.l++]=0;return this}else switch(i){case 1:n=1,this[this.l]=t&255;break;case 2:n=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:n=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:n=4,ty(this,t,this.l);break;case 8:if(n=8,e==="f"){Qb(this,t,this.l);break}case 16:break;case-4:n=4,iy(this,t,this.l);break}return this.l+=n,this}function Eh(i,t){var e=vh(this,this.l,i.length>>1);if(e!==i)throw new Error(t+"Expected "+i+" saw "+e);this.l+=i.length>>1}function _n(i,t){i.l=t,i.read_shift=jo,i.chk=Eh,i.write_shift=ry}function sr(i,t){i.l+=t}function ne(i){var t=aa(i);return _n(t,0),t}function en(){var i=[],t=bt?256:2048,e=function(f){var h=ne(f);return _n(h,0),h},n=e(t),r=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&i.push(n),n=null)},a=function(f){return n&&f<n.length-n.l?n:(r(),n=e(Math.max(f+1,t)))},o=function(){return r(),Fi(i)},u=function(f){r(),n=f,n.l==null&&(n.l=n.length),a(t)};return{next:a,push:u,end:o,_bufs:i}}function de(i,t,e,n){var r=+t,a;if(!isNaN(r)){n||(n=Q3[r].p||(e||[]).length||0),a=1+(r>=128?1:0)+1,n>=128&&++a,n>=16384&&++a,n>=2097152&&++a;var o=i.next(a);r<=127?o.write_shift(1,r):(o.write_shift(1,(r&127)+128),o.write_shift(1,r>>7));for(var u=0;u!=4;++u)if(n>=128)o.write_shift(1,(n&127)+128),n>>=7;else{o.write_shift(1,n);break}n>0&&G0(e)&&i.push(e)}}function Wo(i,t,e){var n=nn(i);if(t.s?(n.cRel&&(n.c+=t.s.c),n.rRel&&(n.r+=t.s.r)):(n.cRel&&(n.c+=t.c),n.rRel&&(n.r+=t.r)),!e||e.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function Op(i,t,e){var n=nn(i);return n.s=Wo(n.s,t.s,e),n.e=Wo(n.e,t.s,e),n}function Ho(i,t){if(i.cRel&&i.c<0)for(i=nn(i);i.c<0;)i.c+=t>8?16384:256;if(i.rRel&&i.r<0)for(i=nn(i);i.r<0;)i.r+=t>8?1048576:t>5?65536:16384;var e=It(i);return!i.cRel&&i.cRel!=null&&(e=sy(e)),!i.rRel&&i.rRel!=null&&(e=ay(e)),e}function E0(i,t){return i.s.r==0&&!i.s.rRel&&i.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!i.e.rRel?(i.s.cRel?"":"$")+Li(i.s.c)+":"+(i.e.cRel?"":"$")+Li(i.e.c):i.s.c==0&&!i.s.cRel&&i.e.c==(t.biff>=12?16383:255)&&!i.e.cRel?(i.s.rRel?"":"$")+Oi(i.s.r)+":"+(i.e.rRel?"":"$")+Oi(i.e.r):Ho(i.s,t.biff)+":"+Ho(i.e,t.biff)}function q0(i){return parseInt(oy(i),10)-1}function Oi(i){return""+(i+1)}function ay(i){return i.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function oy(i){return i.replace(/\$(\d+)$/,"$1")}function X0(i){for(var t=ly(i),e=0,n=0;n!==t.length;++n)e=26*e+t.charCodeAt(n)-64;return e-1}function Li(i){if(i<0)throw new Error("invalid column "+i);var t="";for(++i;i;i=Math.floor((i-1)/26))t=String.fromCharCode((i-1)%26+65)+t;return t}function sy(i){return i.replace(/^([A-Z])/,"$$$1")}function ly(i){return i.replace(/^\$([A-Z])/,"$1")}function cy(i){return i.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Si(i){for(var t=0,e=0,n=0;n<i.length;++n){var r=i.charCodeAt(n);r>=48&&r<=57?t=10*t+(r-48):r>=65&&r<=90&&(e=26*e+(r-64))}return{c:e-1,r:t-1}}function It(i){for(var t=i.c+1,e="";t;t=(t-1)/26|0)e=String.fromCharCode((t-1)%26+65)+e;return e+(i.r+1)}function xn(i){var t=i.indexOf(":");return t==-1?{s:Si(i),e:Si(i)}:{s:Si(i.slice(0,t)),e:Si(i.slice(t+1))}}function fi(i,t){return typeof t>"u"||typeof t=="number"?fi(i.s,i.e):(typeof i!="string"&&(i=It(i)),typeof t!="string"&&(t=It(t)),i==t?i:i+":"+t)}function zt(i){var t={s:{c:0,r:0},e:{c:0,r:0}},e=0,n=0,r=0,a=i.length;for(e=0;n<a&&!((r=i.charCodeAt(n)-64)<1||r>26);++n)e=26*e+r;for(t.s.c=--e,e=0;n<a&&!((r=i.charCodeAt(n)-48)<0||r>9);++n)e=10*e+r;if(t.s.r=--e,n===a||r!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++n,e=0;n!=a&&!((r=i.charCodeAt(n)-64)<1||r>26);++n)e=26*e+r;for(t.e.c=--e,e=0;n!=a&&!((r=i.charCodeAt(n)-48)<0||r>9);++n)e=10*e+r;return t.e.r=--e,t}function Dp(i,t){var e=i.t=="d"&&t instanceof Date;if(i.z!=null)try{return i.w=Ar(i.z,e?tn(t):t)}catch{}try{return i.w=Ar((i.XF||{}).numFmtId||(e?14:0),e?tn(t):t)}catch{return""+t}}function vr(i,t,e){return i==null||i.t==null||i.t=="z"?"":i.w!==void 0?i.w:(i.t=="d"&&!i.z&&e&&e.dateNF&&(i.z=e.dateNF),i.t=="e"?es[i.v]||i.v:t==null?Dp(i,i.v):Dp(i,t))}function la(i,t){var e=t&&t.sheet?t.sheet:"Sheet1",n={};return n[e]=i,{SheetNames:[e],Sheets:n}}function Th(i,t,e){var n=e||{},r=i?Array.isArray(i):n.dense;or!=null&&r==null&&(r=or);var a=i||(r?[]:{}),o=0,u=0;if(a&&n.origin!=null){if(typeof n.origin=="number")o=n.origin;else{var m=typeof n.origin=="string"?Si(n.origin):n.origin;o=m.r,u=m.c}a["!ref"]||(a["!ref"]="A1:A1")}var f={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(a["!ref"]){var h=zt(a["!ref"]);f.s.c=h.s.c,f.s.r=h.s.r,f.e.c=Math.max(f.e.c,h.e.c),f.e.r=Math.max(f.e.r,h.e.r),o==-1&&(f.e.r=o=h.e.r+1)}for(var g=0;g!=t.length;++g)if(t[g]){if(!Array.isArray(t[g]))throw new Error("aoa_to_sheet expects an array of arrays");for(var v=0;v!=t[g].length;++v)if(!(typeof t[g][v]>"u")){var b={v:t[g][v]},w=o+g,x=u+v;if(f.s.r>w&&(f.s.r=w),f.s.c>x&&(f.s.c=x),f.e.r<w&&(f.e.r=w),f.e.c<x&&(f.e.c=x),t[g][v]&&typeof t[g][v]=="object"&&!Array.isArray(t[g][v])&&!(t[g][v]instanceof Date))b=t[g][v];else if(Array.isArray(b.v)&&(b.f=t[g][v][1],b.v=b.v[0]),b.v===null)if(b.f)b.t="n";else if(n.nullError)b.t="e",b.v=0;else if(n.sheetStubs)b.t="z";else continue;else typeof b.v=="number"?b.t="n":typeof b.v=="boolean"?b.t="b":b.v instanceof Date?(b.z=n.dateNF||ni[14],n.cellDates?(b.t="d",b.w=Ar(b.z,tn(b.v))):(b.t="n",b.v=tn(b.v),b.w=Ar(b.z,b.v))):b.t="s";if(r)a[w]||(a[w]=[]),a[w][x]&&a[w][x].z&&(b.z=a[w][x].z),a[w][x]=b;else{var C=It({c:x,r:w});a[C]&&a[C].z&&(b.z=a[C].z),a[C]=b}}}return f.s.c<1e7&&(a["!ref"]=fi(f)),a}function no(i,t){return Th(null,i,t)}function dy(i){return i.read_shift(4,"i")}function Un(i,t){return t||(t=ne(4)),t.write_shift(4,i),t}function Vi(i){var t=i.read_shift(4);return t===0?"":i.read_shift(t,"dbcs")}function wi(i,t){var e=!1;return t==null&&(e=!0,t=ne(4+2*i.length)),t.write_shift(4,i.length),i.length>0&&t.write_shift(0,i,"dbcs"),e?t.slice(0,t.l):t}function uy(i){return{ich:i.read_shift(2),ifnt:i.read_shift(2)}}function my(i,t){return t||(t=ne(4)),t.write_shift(2,i.ich||0),t.write_shift(2,i.ifnt||0),t}function K0(i,t){var e=i.l,n=i.read_shift(1),r=Vi(i),a=[],o={t:r,h:r};if((n&1)!==0){for(var u=i.read_shift(4),m=0;m!=u;++m)a.push(uy(i));o.r=a}else o.r=[{ich:0,ifnt:0}];return i.l=e+t,o}function fy(i,t){var e=!1;return t==null&&(e=!0,t=ne(15+4*i.t.length)),t.write_shift(1,0),wi(i.t,t),e?t.slice(0,t.l):t}var py=K0;function hy(i,t){var e=!1;return t==null&&(e=!0,t=ne(23+4*i.t.length)),t.write_shift(1,1),wi(i.t,t),t.write_shift(4,1),my({ich:0,ifnt:0},t),e?t.slice(0,t.l):t}function In(i){var t=i.read_shift(4),e=i.read_shift(2);return e+=i.read_shift(1)<<16,i.l++,{c:t,iStyleRef:e}}function ca(i,t){return t==null&&(t=ne(8)),t.write_shift(-4,i.c),t.write_shift(3,i.iStyleRef||i.s),t.write_shift(1,0),t}function da(i){var t=i.read_shift(2);return t+=i.read_shift(1)<<16,i.l++,{c:-1,iStyleRef:t}}function ua(i,t){return t==null&&(t=ne(4)),t.write_shift(3,i.iStyleRef||i.s),t.write_shift(1,0),t}var gy=Vi,Ph=wi;function Y0(i){var t=i.read_shift(4);return t===0||t===4294967295?"":i.read_shift(t,"dbcs")}function Al(i,t){var e=!1;return t==null&&(e=!0,t=ne(127)),t.write_shift(4,i.length>0?i.length:4294967295),i.length>0&&t.write_shift(0,i,"dbcs"),e?t.slice(0,t.l):t}var _y=Vi,O0=Y0,Q0=Al;function kh(i){var t=i.slice(i.l,i.l+4),e=t[0]&1,n=t[0]&2;i.l+=4;var r=n===0?Fl([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):ia(t,0)>>2;return e?r/100:r}function Ih(i,t){t==null&&(t=ne(4));var e=0,n=0,r=i*100;if(i==(i|0)&&i>=-(1<<29)&&i<1<<29?n=1:r==(r|0)&&r>=-(1<<29)&&r<1<<29&&(n=1,e=1),n)t.write_shift(-4,((e?r:i)<<2)+(e+2));else throw new Error("unsupported RkNumber "+i)}function Mh(i){var t={s:{},e:{}};return t.s.r=i.read_shift(4),t.e.r=i.read_shift(4),t.s.c=i.read_shift(4),t.e.c=i.read_shift(4),t}function vy(i,t){return t||(t=ne(16)),t.write_shift(4,i.s.r),t.write_shift(4,i.e.r),t.write_shift(4,i.s.c),t.write_shift(4,i.e.c),t}var ma=Mh,ro=vy;function ao(i){if(i.length-i.l<8)throw"XLS Xnum Buffer underflow";return i.read_shift(8,"f")}function oa(i,t){return(t||ne(8)).write_shift(8,i,"f")}function xy(i){var t={},e=i.read_shift(1),n=e>>>1,r=i.read_shift(1),a=i.read_shift(2,"i"),o=i.read_shift(1),u=i.read_shift(1),m=i.read_shift(1);switch(i.l++,n){case 0:t.auto=1;break;case 1:t.index=r;var f=ky[r];f&&(t.rgb=$p(f));break;case 2:t.rgb=$p([o,u,m]);break;case 3:t.theme=r;break}return a!=0&&(t.tint=a>0?a/32767:a/32768),t}function Ol(i,t){if(t||(t=ne(8)),!i||i.auto)return t.write_shift(4,0),t.write_shift(4,0),t;i.index!=null?(t.write_shift(1,2),t.write_shift(1,i.index)):i.theme!=null?(t.write_shift(1,6),t.write_shift(1,i.theme)):(t.write_shift(1,5),t.write_shift(1,0));var e=i.tint||0;if(e>0?e*=32767:e<0&&(e*=32768),t.write_shift(2,e),!i.rgb||i.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var n=i.rgb||"FFFFFF";typeof n=="number"&&(n=("000000"+n.toString(16)).slice(-6)),t.write_shift(1,parseInt(n.slice(0,2),16)),t.write_shift(1,parseInt(n.slice(2,4),16)),t.write_shift(1,parseInt(n.slice(4,6),16)),t.write_shift(1,255)}return t}function by(i){var t=i.read_shift(1);i.l++;var e={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return e}function yy(i,t){t||(t=ne(2));var e=(i.italic?2:0)|(i.strike?8:0)|(i.outline?16:0)|(i.shadow?32:0)|(i.condense?64:0)|(i.extend?128:0);return t.write_shift(1,e),t.write_shift(1,0),t}var Fh=2,gn=3,Sl=11;var Dl=19;var wl=64,Cy=65,Sy=71;var wy=4108,Ey=4126,Mi=80;var Rp={1:{n:"CodePage",t:Fh},2:{n:"Category",t:Mi},3:{n:"PresentationFormat",t:Mi},4:{n:"ByteCount",t:gn},5:{n:"LineCount",t:gn},6:{n:"ParagraphCount",t:gn},7:{n:"SlideCount",t:gn},8:{n:"NoteCount",t:gn},9:{n:"HiddenCount",t:gn},10:{n:"MultimediaClipCount",t:gn},11:{n:"ScaleCrop",t:Sl},12:{n:"HeadingPairs",t:wy},13:{n:"TitlesOfParts",t:Ey},14:{n:"Manager",t:Mi},15:{n:"Company",t:Mi},16:{n:"LinksUpToDate",t:Sl},17:{n:"CharacterCount",t:gn},19:{n:"SharedDoc",t:Sl},22:{n:"HyperlinksChanged",t:Sl},23:{n:"AppVersion",t:gn,p:"version"},24:{n:"DigSig",t:Cy},26:{n:"ContentType",t:Mi},27:{n:"ContentStatus",t:Mi},28:{n:"Language",t:Mi},29:{n:"Version",t:Mi},255:{},2147483648:{n:"Locale",t:Dl},2147483651:{n:"Behavior",t:Dl},1919054434:{}},Np={1:{n:"CodePage",t:Fh},2:{n:"Title",t:Mi},3:{n:"Subject",t:Mi},4:{n:"Author",t:Mi},5:{n:"Keywords",t:Mi},6:{n:"Comments",t:Mi},7:{n:"Template",t:Mi},8:{n:"LastAuthor",t:Mi},9:{n:"RevNumber",t:Mi},10:{n:"EditTime",t:wl},11:{n:"LastPrinted",t:wl},12:{n:"CreatedDate",t:wl},13:{n:"ModifiedDate",t:wl},14:{n:"PageCount",t:gn},15:{n:"WordCount",t:gn},16:{n:"CharCount",t:gn},17:{n:"Thumbnail",t:Sy},18:{n:"Application",t:Mi},19:{n:"DocSecurity",t:gn},255:{},2147483648:{n:"Locale",t:Dl},2147483651:{n:"Behavior",t:Dl},1919054434:{}};function Ty(i){return i.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var Py=Ty([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ky=nn(Py),es={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"};var Iy={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},El={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function Ah(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function Oh(i,t){var e=Lb(Iy),n=[],r;n[n.length]=pi,n[n.length]=ge("Types",null,{xmlns:Ci.CT,"xmlns:xsd":Ci.xsd,"xmlns:xsi":Ci.xsi}),n=n.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(m){return ge("Default",null,{Extension:m[0],ContentType:m[1]})}));var a=function(m){i[m]&&i[m].length>0&&(r=i[m][0],n[n.length]=ge("Override",null,{PartName:(r[0]=="/"?"":"/")+r,ContentType:El[m][t.bookType]||El[m].xlsx}))},o=function(m){(i[m]||[]).forEach(function(f){n[n.length]=ge("Override",null,{PartName:(f[0]=="/"?"":"/")+f,ContentType:El[m][t.bookType]||El[m].xlsx})})},u=function(m){(i[m]||[]).forEach(function(f){n[n.length]=ge("Override",null,{PartName:(f[0]=="/"?"":"/")+f,ContentType:e[m][0]})})};return a("workbooks"),o("sheets"),o("charts"),u("themes"),["strs","styles"].forEach(a),["coreprops","extprops","custprops"].forEach(u),u("vba"),u("comments"),u("threadedcomments"),u("drawings"),o("metadata"),u("people"),n.length>2&&(n[n.length]="</Types>",n[1]=n[1].replace("/>",">")),n.join("")}var vt={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Dh(i){var t=i.lastIndexOf("/");return i.slice(0,t+1)+"_rels/"+i.slice(t+1)+".rels"}function Ya(i){var t=[pi,ge("Relationships",null,{xmlns:Ci.RELS})];return Di(i["!id"]).forEach(function(e){t[t.length]=ge("Relationship",null,i["!id"][e])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function Pt(i,t,e,n,r,a){if(r||(r={}),i["!id"]||(i["!id"]={}),i["!idx"]||(i["!idx"]=1),t<0)for(t=i["!idx"];i["!id"]["rId"+t];++t);if(i["!idx"]=t+1,r.Id="rId"+t,r.Type=n,r.Target=e,a?r.TargetMode=a:[vt.HLINK,vt.XPATH,vt.XMISS].indexOf(r.Type)>-1&&(r.TargetMode="External"),i["!id"][r.Id])throw new Error("Cannot rewrite rId "+t);return i["!id"][r.Id]=r,i[("/"+r.Target).replace("//","/")]=r,t}function My(i){var t=[pi];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var e=0;e<i.length;++e)t.push('  <manifest:file-entry manifest:full-path="'+i[e][0]+'" manifest:media-type="'+i[e][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function Bp(i,t,e){return['  <rdf:Description rdf:about="'+i+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(e||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function Fy(i,t){return['  <rdf:Description rdf:about="'+i+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function Ay(i){var t=[pi];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var e=0;e!=i.length;++e)t.push(Bp(i[e][0],i[e][1])),t.push(Fy("",i[e][0]));return t.push(Bp("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function Rh(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+$o.version+"</meta:generator></office:meta></office:document-meta>"}var ra=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function T0(i,t,e,n,r){r[i]!=null||t==null||t===""||(r[i]=t,t=kt(t),n[n.length]=e?ge(i,t,e):Ai(i,t))}function Nh(i,t){var e=t||{},n=[pi,ge("cp:coreProperties",null,{"xmlns:cp":Ci.CORE_PROPS,"xmlns:dc":Ci.dc,"xmlns:dcterms":Ci.dcterms,"xmlns:dcmitype":Ci.dcmitype,"xmlns:xsi":Ci.xsi})],r={};if(!i&&!e.Props)return n.join("");i&&(i.CreatedDate!=null&&T0("dcterms:created",typeof i.CreatedDate=="string"?i.CreatedDate:A0(i.CreatedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},n,r),i.ModifiedDate!=null&&T0("dcterms:modified",typeof i.ModifiedDate=="string"?i.ModifiedDate:A0(i.ModifiedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},n,r));for(var a=0;a!=ra.length;++a){var o=ra[a],u=e.Props&&e.Props[o[1]]!=null?e.Props[o[1]]:i?i[o[1]]:null;u===!0?u="1":u===!1?u="0":typeof u=="number"&&(u=String(u)),u!=null&&T0(o[0],u,null,n,r)}return n.length>2&&(n[n.length]="</cp:coreProperties>",n[1]=n[1].replace("/>",">")),n.join("")}var Qa=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],Bh=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Lh(i){var t=[],e=ge;return i||(i={}),i.Application="SheetJS",t[t.length]=pi,t[t.length]=ge("Properties",null,{xmlns:Ci.EXT_PROPS,"xmlns:vt":Ci.vt}),Qa.forEach(function(n){if(i[n[1]]!==void 0){var r;switch(n[2]){case"string":r=kt(String(i[n[1]]));break;case"bool":r=i[n[1]]?"true":"false";break}r!==void 0&&(t[t.length]=e(n[0],r))}}),t[t.length]=e("HeadingPairs",e("vt:vector",e("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+e("vt:variant",e("vt:i4",String(i.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=e("TitlesOfParts",e("vt:vector",i.SheetNames.map(function(n){return"<vt:lpstr>"+kt(n)+"</vt:lpstr>"}).join(""),{size:i.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function Vh(i){var t=[pi,ge("Properties",null,{xmlns:Ci.CUST_PROPS,"xmlns:vt":Ci.vt})];if(!i)return t.join("");var e=1;return Di(i).forEach(function(r){++e,t[t.length]=ge("property",Kb(i[r],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:e,name:kt(r)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var Lp={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Oy(i,t){var e=[];return Di(Lp).map(function(n){for(var r=0;r<ra.length;++r)if(ra[r][1]==n)return ra[r];for(r=0;r<Qa.length;++r)if(Qa[r][1]==n)return Qa[r];throw n}).forEach(function(n){if(i[n[1]]!=null){var r=t&&t.Props&&t.Props[n[1]]!=null?t.Props[n[1]]:i[n[1]];switch(n[2]){case"date":r=new Date(r).toISOString().replace(/\.\d*Z/,"Z");break}typeof r=="number"?r=String(r):r===!0||r===!1?r=r?"1":"0":r instanceof Date&&(r=new Date(r).toISOString().replace(/\.\d*Z/,"")),e.push(Ai(Lp[n[1]]||n[1],r))}}),ge("DocumentProperties",e.join(""),{xmlns:vn.o})}function Dy(i,t){var e=["Worksheets","SheetNames"],n="CustomDocumentProperties",r=[];return i&&Di(i).forEach(function(a){if(Object.prototype.hasOwnProperty.call(i,a)){for(var o=0;o<ra.length;++o)if(a==ra[o][1])return;for(o=0;o<Qa.length;++o)if(a==Qa[o][1])return;for(o=0;o<e.length;++o)if(a==e[o])return;var u=i[a],m="string";typeof u=="number"?(m="float",u=String(u)):u===!0||u===!1?(m="boolean",u=u?"1":"0"):u=String(u),r.push(ge(Ep(a),u,{"dt:dt":m}))}}),t&&Di(t).forEach(function(a){if(Object.prototype.hasOwnProperty.call(t,a)&&!(i&&Object.prototype.hasOwnProperty.call(i,a))){var o=t[a],u="string";typeof o=="number"?(u="float",o=String(o)):o===!0||o===!1?(u="boolean",o=o?"1":"0"):o instanceof Date?(u="dateTime.tz",o=o.toISOString()):o=String(o),r.push(ge(Ep(a),o,{"dt:dt":u}))}}),"<"+n+' xmlns="'+vn.o+'">'+r.join("")+"</"+n+">"}function Ry(i){var t=typeof i=="string"?new Date(Date.parse(i)):i,e=t.getTime()/1e3+11644473600,n=e%Math.pow(2,32),r=(e-n)/Math.pow(2,32);n*=1e7,r*=1e7;var a=n/Math.pow(2,32)|0;a>0&&(n=n%Math.pow(2,32),r+=a);var o=ne(8);return o.write_shift(4,n),o.write_shift(4,r),o}function Vp(i,t){var e=ne(4),n=ne(4);switch(e.write_shift(4,i==80?31:i),i){case 3:n.write_shift(-4,t);break;case 5:n=ne(8),n.write_shift(8,t,"f");break;case 11:n.write_shift(4,t?1:0);break;case 64:n=Ry(t);break;case 31:case 80:for(n=ne(4+2*(t.length+1)+(t.length%2?0:2)),n.write_shift(4,t.length+1),n.write_shift(0,t,"dbcs");n.l!=n.length;)n.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+i+" "+t)}return Fi([e,n])}var Uh=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function Ny(i){switch(typeof i){case"boolean":return 11;case"number":return(i|0)==i?3:5;case"string":return 31;case"object":if(i instanceof Date)return 64;break}return-1}function Up(i,t,e){var n=ne(8),r=[],a=[],o=8,u=0,m=ne(8),f=ne(8);if(m.write_shift(4,2),m.write_shift(4,1200),f.write_shift(4,1),a.push(m),r.push(f),o+=8+m.length,!t){f=ne(8),f.write_shift(4,0),r.unshift(f);var h=[ne(4)];for(h[0].write_shift(4,i.length),u=0;u<i.length;++u){var g=i[u][0];for(m=ne(8+2*(g.length+1)+(g.length%2?0:2)),m.write_shift(4,u+2),m.write_shift(4,g.length+1),m.write_shift(0,g,"dbcs");m.l!=m.length;)m.write_shift(1,0);h.push(m)}m=Fi(h),a.unshift(m),o+=8+m.length}for(u=0;u<i.length;++u)if(!(t&&!t[i[u][0]])&&!(Uh.indexOf(i[u][0])>-1||Bh.indexOf(i[u][0])>-1)&&i[u][1]!=null){var v=i[u][1],b=0;if(t){b=+t[i[u][0]];var w=e[b];if(w.p=="version"&&typeof v=="string"){var x=v.split(".");v=(+x[0]<<16)+(+x[1]||0)}m=Vp(w.t,v)}else{var C=Ny(v);C==-1&&(C=31,v=String(v)),m=Vp(C,v)}a.push(m),f=ne(8),f.write_shift(4,t?b:2+u),r.push(f),o+=8+m.length}var U=8*(a.length+1);for(u=0;u<a.length;++u)r[u].write_shift(4,U),U+=a[u].length;return n.write_shift(4,o),n.write_shift(4,a.length),Fi([n].concat(r).concat(a))}function jp(i,t,e,n,r,a){var o=ne(r?68:48),u=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,At.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,r?2:1),o.write_shift(16,t,"hex"),o.write_shift(4,r?68:48);var m=Up(i,e,n);if(u.push(m),r){var f=Up(r,null,null);o.write_shift(16,a,"hex"),o.write_shift(4,68+m.length),u.push(f)}return Fi(u)}function By(i,t){t||(t=ne(i));for(var e=0;e<i;++e)t.write_shift(1,0);return t}function Ly(i,t){return i.read_shift(t)===1}function $i(i,t){return t||(t=ne(2)),t.write_shift(2,+!!i),t}function jh(i){return i.read_shift(2,"u")}function kn(i,t){return t||(t=ne(2)),t.write_shift(2,i),t}function Wh(i,t,e){return e||(e=ne(2)),e.write_shift(1,t=="e"?+i:+!!i),e.write_shift(1,t=="e"?1:0),e}function Hh(i,t,e){var n=i.read_shift(e&&e.biff>=12?2:1),r="sbcs-cont",a=na;if(e&&e.biff>=8&&(na=1200),!e||e.biff==8){var o=i.read_shift(1);o&&(r="dbcs-cont")}else e.biff==12&&(r="wstr");e.biff>=2&&e.biff<=5&&(r="cpstr");var u=n?i.read_shift(n,r):"";return na=a,u}function Vy(i){var t=i.t||"",e=1,n=ne(3+(e>1?2:0));n.write_shift(2,t.length),n.write_shift(1,(e>1?8:0)|1),e>1&&n.write_shift(2,e);var r=ne(2*t.length);r.write_shift(2*t.length,t,"utf16le");var a=[n,r];return Fi(a)}function Uy(i,t,e){var n;if(e){if(e.biff>=2&&e.biff<=5)return i.read_shift(t,"cpstr");if(e.biff>=12)return i.read_shift(t,"dbcs-cont")}var r=i.read_shift(1);return r===0?n=i.read_shift(t,"sbcs-cont"):n=i.read_shift(t,"dbcs-cont"),n}function jy(i,t,e){var n=i.read_shift(e&&e.biff==2?1:2);return n===0?(i.l++,""):Uy(i,n,e)}function Wy(i,t,e){if(e.biff>5)return jy(i,t,e);var n=i.read_shift(1);return n===0?(i.l++,""):i.read_shift(n,e.biff<=4||!i.lens?"cpstr":"sbcs-cont")}function zh(i,t,e){return e||(e=ne(3+2*i.length)),e.write_shift(2,i.length),e.write_shift(1,1),e.write_shift(31,i,"utf16le"),e}function Wp(i,t){t||(t=ne(6+i.length*2)),t.write_shift(4,1+i.length);for(var e=0;e<i.length;++e)t.write_shift(2,i.charCodeAt(e));return t.write_shift(2,0),t}function Hy(i){var t=ne(512),e=0,n=i.Target;n.slice(0,7)=="file://"&&(n=n.slice(7));var r=n.indexOf("#"),a=r>-1?31:23;switch(n.charAt(0)){case"#":a=28;break;case".":a&=-3;break}t.write_shift(4,2),t.write_shift(4,a);var o=[8,6815827,6619237,4849780,83];for(e=0;e<o.length;++e)t.write_shift(4,o[e]);if(a==28)n=n.slice(1),Wp(n,t);else if(a&2){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),e=0;e<o.length;++e)t.write_shift(1,parseInt(o[e],16));var u=r>-1?n.slice(0,r):n;for(t.write_shift(4,2*(u.length+1)),e=0;e<u.length;++e)t.write_shift(2,u.charCodeAt(e));t.write_shift(2,0),a&8&&Wp(r>-1?n.slice(r+1):"",t)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),e=0;e<o.length;++e)t.write_shift(1,parseInt(o[e],16));for(var m=0;n.slice(m*3,m*3+3)=="../"||n.slice(m*3,m*3+3)=="..\\";)++m;for(t.write_shift(2,m),t.write_shift(4,n.length-3*m+1),e=0;e<n.length-3*m;++e)t.write_shift(1,n.charCodeAt(e+3*m)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),e=0;e<6;++e)t.write_shift(4,0)}return t.slice(0,t.l)}function sa(i,t,e,n){return n||(n=ne(6)),n.write_shift(2,i),n.write_shift(2,t),n.write_shift(2,e||0),n}function zy(i,t,e){var n=e.biff>8?4:2,r=i.read_shift(n),a=i.read_shift(n,"i"),o=i.read_shift(n,"i");return[r,a,o]}function $y(i){var t=i.read_shift(2),e=i.read_shift(2),n=i.read_shift(2),r=i.read_shift(2);return{s:{c:n,r:t},e:{c:r,r:e}}}function $h(i,t){return t||(t=ne(8)),t.write_shift(2,i.s.r),t.write_shift(2,i.e.r),t.write_shift(2,i.s.c),t.write_shift(2,i.e.c),t}function J0(i,t,e){var n=1536,r=16;switch(e.bookType){case"biff8":break;case"biff5":n=1280,r=8;break;case"biff4":n=4,r=6;break;case"biff3":n=3,r=6;break;case"biff2":n=2,r=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var a=ne(r);return a.write_shift(2,n),a.write_shift(2,t),r>4&&a.write_shift(2,29282),r>6&&a.write_shift(2,1997),r>8&&(a.write_shift(2,49161),a.write_shift(2,1),a.write_shift(2,1798),a.write_shift(2,0)),a}function Gy(i,t){var e=!t||t.biff==8,n=ne(e?112:54);for(n.write_shift(t.biff==8?2:1,7),e&&n.write_shift(1,0),n.write_shift(4,859007059),n.write_shift(4,5458548|(e?0:536870912));n.l<n.length;)n.write_shift(1,e?0:32);return n}function qy(i,t){var e=!t||t.biff>=8?2:1,n=ne(8+e*i.name.length);n.write_shift(4,i.pos),n.write_shift(1,i.hs||0),n.write_shift(1,i.dt),n.write_shift(1,i.name.length),t.biff>=8&&n.write_shift(1,1),n.write_shift(e*i.name.length,i.name,t.biff<8?"sbcs":"utf16le");var r=n.slice(0,n.l);return r.l=n.l,r}function Xy(i,t){var e=ne(8);e.write_shift(4,i.Count),e.write_shift(4,i.Unique);for(var n=[],r=0;r<i.length;++r)n[r]=Vy(i[r],t);var a=Fi([e].concat(n));return a.parts=[e.length].concat(n.map(function(o){return o.length})),a}function Ky(){var i=ne(18);return i.write_shift(2,0),i.write_shift(2,0),i.write_shift(2,29280),i.write_shift(2,17600),i.write_shift(2,56),i.write_shift(2,0),i.write_shift(2,0),i.write_shift(2,1),i.write_shift(2,500),i}function Yy(i){var t=ne(18),e=1718;return i&&i.RTL&&(e|=64),t.write_shift(2,e),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function Qy(i,t){var e=i.name||"Arial",n=t&&t.biff==5,r=n?15+e.length:16+2*e.length,a=ne(r);return a.write_shift(2,(i.sz||12)*20),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,e.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*e.length,e,n?"sbcs":"utf16le"),a}function Jy(i,t,e,n){var r=ne(10);return sa(i,t,n,r),r.write_shift(4,e),r}function Zy(i,t,e,n,r){var a=!r||r.biff==8,o=ne(8+ +a+(1+a)*e.length);return sa(i,t,n,o),o.write_shift(2,e.length),a&&o.write_shift(1,1),o.write_shift((1+a)*e.length,e,a?"utf16le":"sbcs"),o}function eC(i,t,e,n){var r=e&&e.biff==5;n||(n=ne(r?3+t.length:5+2*t.length)),n.write_shift(2,i),n.write_shift(r?1:2,t.length),r||n.write_shift(1,1),n.write_shift((r?1:2)*t.length,t,r?"sbcs":"utf16le");var a=n.length>n.l?n.slice(0,n.l):n;return a.l==null&&(a.l=a.length),a}function tC(i,t){var e=t.biff==8||!t.biff?4:2,n=ne(2*e+6);return n.write_shift(e,i.s.r),n.write_shift(e,i.e.r+1),n.write_shift(2,i.s.c),n.write_shift(2,i.e.c+1),n.write_shift(2,0),n}function Hp(i,t,e,n){var r=e&&e.biff==5;n||(n=ne(r?16:20)),n.write_shift(2,0),i.style?(n.write_shift(2,i.numFmtId||0),n.write_shift(2,65524)):(n.write_shift(2,i.numFmtId||0),n.write_shift(2,t<<4));var a=0;return i.numFmtId>0&&r&&(a|=1024),n.write_shift(4,a),n.write_shift(4,0),r||n.write_shift(4,0),n.write_shift(2,0),n}function iC(i){var t=ne(8);return t.write_shift(4,0),t.write_shift(2,i[0]?i[0]+1:0),t.write_shift(2,i[1]?i[1]+1:0),t}function nC(i,t,e,n,r,a){var o=ne(8);return sa(i,t,n,o),Wh(e,a,o),o}function rC(i,t,e,n){var r=ne(14);return sa(i,t,n,r),oa(e,r),r}function aC(i,t,e){if(e.biff<8)return oC(i,t,e);for(var n=[],r=i.l+t,a=i.read_shift(e.biff>8?4:2);a--!==0;)n.push(zy(i,e.biff>8?12:6,e));if(i.l!=r)throw new Error("Bad ExternSheet: "+i.l+" != "+r);return n}function oC(i,t,e){i[i.l+1]==3&&i[i.l]++;var n=Hh(i,t,e);return n.charCodeAt(0)==3?n.slice(1):n}function sC(i){var t=ne(2+i.length*8);t.write_shift(2,i.length);for(var e=0;e<i.length;++e)$h(i[e],t);return t}function lC(i){var t=ne(24),e=Si(i[0]);t.write_shift(2,e.r),t.write_shift(2,e.r),t.write_shift(2,e.c),t.write_shift(2,e.c);for(var n="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<16;++r)t.write_shift(1,parseInt(n[r],16));return Fi([t,Hy(i[1])])}function cC(i){var t=i[1].Tooltip,e=ne(10+2*(t.length+1));e.write_shift(2,2048);var n=Si(i[0]);e.write_shift(2,n.r),e.write_shift(2,n.r),e.write_shift(2,n.c),e.write_shift(2,n.c);for(var r=0;r<t.length;++r)e.write_shift(2,t.charCodeAt(r));return e.write_shift(2,0),e}function dC(i){return i||(i=ne(4)),i.write_shift(2,1),i.write_shift(2,1),i}function uC(i,t,e){if(!e.cellStyles)return sr(i,t);var n=e&&e.biff>=12?4:2,r=i.read_shift(n),a=i.read_shift(n),o=i.read_shift(n),u=i.read_shift(n),m=i.read_shift(2);n==2&&(i.l+=2);var f={s:r,e:a,w:o,ixfe:u,flags:m};return(e.biff>=5||!e.biff)&&(f.level=m>>8&7),f}function mC(i,t){var e=ne(12);e.write_shift(2,t),e.write_shift(2,t),e.write_shift(2,i.width*256),e.write_shift(2,0);var n=0;return i.hidden&&(n|=1),e.write_shift(1,n),n=i.level||0,e.write_shift(1,n),e.write_shift(2,0),e}function fC(i){for(var t=ne(2*i),e=0;e<i;++e)t.write_shift(2,e+1);return t}function pC(i,t,e){var n=ne(15);return is(n,i,t),n.write_shift(8,e,"f"),n}function hC(i,t,e){var n=ne(9);return is(n,i,t),n.write_shift(2,e),n}var gC=function(){var i={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=B0({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function e(u,m){var f=[],h=aa(1);switch(m.type){case"base64":h=Ln(_r(u));break;case"binary":h=Ln(u);break;case"buffer":case"array":h=u;break}_n(h,0);var g=h.read_shift(1),v=!!(g&136),b=!1,w=!1;switch(g){case 2:break;case 3:break;case 48:b=!0,v=!0;break;case 49:b=!0,v=!0;break;case 131:break;case 139:break;case 140:w=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+g.toString(16))}var x=0,C=521;g==2&&(x=h.read_shift(2)),h.l+=3,g!=2&&(x=h.read_shift(4)),x>1048576&&(x=1e6),g!=2&&(C=h.read_shift(2));var U=h.read_shift(2),j=m.codepage||1252;g!=2&&(h.l+=16,h.read_shift(1),h[h.l]!==0&&(j=i[h[h.l]]),h.l+=1,h.l+=2),w&&(h.l+=36);for(var H=[],K={},ce=Math.min(h.length,g==2?521:C-10-(b?264:0)),we=w?32:11;h.l<ce&&h[h.l]!=13;)switch(K={},K.name=Dt.utils.decode(j,h.slice(h.l,h.l+we)).replace(/[\u0000\r\n].*$/g,""),h.l+=we,K.type=String.fromCharCode(h.read_shift(1)),g!=2&&!w&&(K.offset=h.read_shift(4)),K.len=h.read_shift(1),g==2&&(K.offset=h.read_shift(2)),K.dec=h.read_shift(1),K.name.length&&H.push(K),g!=2&&(h.l+=w?13:14),K.type){case"B":(!b||K.len!=8)&&m.WTF&&console.log("Skipping "+K.name+":"+K.type);break;case"G":case"P":m.WTF&&console.log("Skipping "+K.name+":"+K.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+K.type)}if(h[h.l]!==13&&(h.l=C-1),h.read_shift(1)!==13)throw new Error("DBF Terminator not found "+h.l+" "+h[h.l]);h.l=C;var W=0,se=0;for(f[0]=[],se=0;se!=H.length;++se)f[0][se]=H[se].name;for(;x-- >0;){if(h[h.l]===42){h.l+=U;continue}for(++h.l,f[++W]=[],se=0,se=0;se!=H.length;++se){var ee=h.slice(h.l,h.l+H[se].len);h.l+=H[se].len,_n(ee,0);var le=Dt.utils.decode(j,ee);switch(H[se].type){case"C":le.trim().length&&(f[W][se]=le.replace(/\s+$/,""));break;case"D":le.length===8?f[W][se]=new Date(+le.slice(0,4),+le.slice(4,6)-1,+le.slice(6,8)):f[W][se]=le;break;case"F":f[W][se]=parseFloat(le.trim());break;case"+":case"I":f[W][se]=w?ee.read_shift(-4,"i")^2147483648:ee.read_shift(4,"i");break;case"L":switch(le.trim().toUpperCase()){case"Y":case"T":f[W][se]=!0;break;case"N":case"F":f[W][se]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+le+"|")}break;case"M":if(!v)throw new Error("DBF Unexpected MEMO for type "+g.toString(16));f[W][se]="##MEMO##"+(w?parseInt(le.trim(),10):ee.read_shift(4));break;case"N":le=le.replace(/\u0000/g,"").trim(),le&&le!="."&&(f[W][se]=+le||0);break;case"@":f[W][se]=new Date(ee.read_shift(-8,"f")-621356832e5);break;case"T":f[W][se]=new Date((ee.read_shift(4)-2440588)*864e5+ee.read_shift(4));break;case"Y":f[W][se]=ee.read_shift(4,"i")/1e4+ee.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":f[W][se]=-ee.read_shift(-8,"f");break;case"B":if(b&&H[se].len==8){f[W][se]=ee.read_shift(8,"f");break}case"G":case"P":ee.l+=H[se].len;break;case"0":if(H[se].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+H[se].type)}}}if(g!=2&&h.l<h.length&&h[h.l++]!=26)throw new Error("DBF EOF Marker missing "+(h.l-1)+" of "+h.length+" "+h[h.l-1].toString(16));return m&&m.sheetRows&&(f=f.slice(0,m.sheetRows)),m.DBF=H,f}function n(u,m){var f=m||{};f.dateNF||(f.dateNF="yyyymmdd");var h=no(e(u,f),f);return h["!cols"]=f.DBF.map(function(g){return{wch:g.len,DBF:g}}),delete f.DBF,h}function r(u,m){try{return la(n(u,m),m)}catch(f){if(m&&m.WTF)throw f}return{SheetNames:[],Sheets:{}}}var a={B:8,C:250,L:1,D:8,"?":0,"":0};function o(u,m){var f=m||{};if(+f.codepage>=0&&Go(+f.codepage),f.type=="string")throw new Error("Cannot write DBF to JS string");var h=en(),g=Vl(u,{header:1,raw:!0,cellDates:!0}),v=g[0],b=g.slice(1),w=u["!cols"]||[],x=0,C=0,U=0,j=1;for(x=0;x<v.length;++x){if(((w[x]||{}).DBF||{}).name){v[x]=w[x].DBF.name,++U;continue}if(v[x]!=null){if(++U,typeof v[x]=="number"&&(v[x]=v[x].toString(10)),typeof v[x]!="string")throw new Error("DBF Invalid column name "+v[x]+" |"+typeof v[x]+"|");if(v.indexOf(v[x])!==x){for(C=0;C<1024;++C)if(v.indexOf(v[x]+"_"+C)==-1){v[x]+="_"+C;break}}}}var H=zt(u["!ref"]),K=[],ce=[],we=[];for(x=0;x<=H.e.c-H.s.c;++x){var W="",se="",ee=0,le=[];for(C=0;C<b.length;++C)b[C][x]!=null&&le.push(b[C][x]);if(le.length==0||v[x]==null){K[x]="?";continue}for(C=0;C<le.length;++C){switch(typeof le[C]){case"number":se="B";break;case"string":se="C";break;case"boolean":se="L";break;case"object":se=le[C]instanceof Date?"D":"C";break;default:se="C"}ee=Math.max(ee,String(le[C]).length),W=W&&W!=se?"C":se}ee>250&&(ee=250),se=((w[x]||{}).DBF||{}).type,se=="C"&&w[x].DBF.len>ee&&(ee=w[x].DBF.len),W=="B"&&se=="N"&&(W="N",we[x]=w[x].DBF.dec,ee=w[x].DBF.len),ce[x]=W=="C"||se=="N"?ee:a[W]||0,j+=ce[x],K[x]=W}var ue=h.next(32);for(ue.write_shift(4,318902576),ue.write_shift(4,b.length),ue.write_shift(2,296+32*U),ue.write_shift(2,j),x=0;x<4;++x)ue.write_shift(4,0);for(ue.write_shift(4,0|(+t[Za]||3)<<8),x=0,C=0;x<v.length;++x)if(v[x]!=null){var me=h.next(32),Me=(v[x].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);me.write_shift(1,Me,"sbcs"),me.write_shift(1,K[x]=="?"?"C":K[x],"sbcs"),me.write_shift(4,C),me.write_shift(1,ce[x]||a[K[x]]||0),me.write_shift(1,we[x]||0),me.write_shift(1,2),me.write_shift(4,0),me.write_shift(1,0),me.write_shift(4,0),me.write_shift(4,0),C+=ce[x]||a[K[x]]||0}var mt=h.next(264);for(mt.write_shift(4,13),x=0;x<65;++x)mt.write_shift(4,0);for(x=0;x<b.length;++x){var De=h.next(j);for(De.write_shift(1,0),C=0;C<v.length;++C)if(v[C]!=null)switch(K[C]){case"L":De.write_shift(1,b[x][C]==null?63:b[x][C]?84:70);break;case"B":De.write_shift(8,b[x][C]||0,"f");break;case"N":var be="0";for(typeof b[x][C]=="number"&&(be=b[x][C].toFixed(we[C]||0)),U=0;U<ce[C]-be.length;++U)De.write_shift(1,32);De.write_shift(1,be,"sbcs");break;case"D":b[x][C]?(De.write_shift(4,("0000"+b[x][C].getFullYear()).slice(-4),"sbcs"),De.write_shift(2,("00"+(b[x][C].getMonth()+1)).slice(-2),"sbcs"),De.write_shift(2,("00"+b[x][C].getDate()).slice(-2),"sbcs")):De.write_shift(8,"00000000","sbcs");break;case"C":var Ee=String(b[x][C]!=null?b[x][C]:"").slice(0,ce[C]);for(De.write_shift(1,Ee,"sbcs"),U=0;U<ce[C]-Ee.length;++U)De.write_shift(1,32);break}}return h.next(1).write_shift(1,26),h.end()}return{to_workbook:r,to_sheet:n,from_sheet:o}}(),_C=function(){var i={AA:"\xC0",BA:"\xC1",CA:"\xC2",DA:195,HA:"\xC4",JA:197,AE:"\xC8",BE:"\xC9",CE:"\xCA",HE:"\xCB",AI:"\xCC",BI:"\xCD",CI:"\xCE",HI:"\xCF",AO:"\xD2",BO:"\xD3",CO:"\xD4",DO:213,HO:"\xD6",AU:"\xD9",BU:"\xDA",CU:"\xDB",HU:"\xDC",Aa:"\xE0",Ba:"\xE1",Ca:"\xE2",Da:227,Ha:"\xE4",Ja:229,Ae:"\xE8",Be:"\xE9",Ce:"\xEA",He:"\xEB",Ai:"\xEC",Bi:"\xED",Ci:"\xEE",Hi:"\xEF",Ao:"\xF2",Bo:"\xF3",Co:"\xF4",Do:245,Ho:"\xF6",Au:"\xF9",Bu:"\xFA",Cu:"\xFB",Hu:"\xFC",KC:"\xC7",Kc:"\xE7",q:"\xE6",z:"\u0153",a:"\xC6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+Di(i).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),e=function(v,b){var w=i[b];return typeof w=="number"?fp(w):w},n=function(v,b,w){var x=b.charCodeAt(0)-32<<4|w.charCodeAt(0)-48;return x==59?v:fp(x)};i["|"]=254;function r(v,b){switch(b.type){case"base64":return a(_r(v),b);case"binary":return a(v,b);case"buffer":return a(bt&&Buffer.isBuffer(v)?v.toString("binary"):Jo(v),b);case"array":return a(zl(v),b)}throw new Error("Unrecognized type "+b.type)}function a(v,b){var w=v.split(/[\n\r]+/),x=-1,C=-1,U=0,j=0,H=[],K=[],ce=null,we={},W=[],se=[],ee=[],le=0,ue;for(+b.codepage>=0&&Go(+b.codepage);U!==w.length;++U){le=0;var me=w[U].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(t,e),Me=me.replace(/;;/g,"\0").split(";").map(function(V){return V.replace(/\u0000/g,";")}),mt=Me[0],De;if(me.length>0)switch(mt){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Me[1].charAt(0)=="P"&&K.push(me.slice(3).replace(/;;/g,";"));break;case"C":var be=!1,Ee=!1,ke=!1,Ue=!1,et=-1,Vt=-1;for(j=1;j<Me.length;++j)switch(Me[j].charAt(0)){case"A":break;case"X":C=parseInt(Me[j].slice(1))-1,Ee=!0;break;case"Y":for(x=parseInt(Me[j].slice(1))-1,Ee||(C=0),ue=H.length;ue<=x;++ue)H[ue]=[];break;case"K":De=Me[j].slice(1),De.charAt(0)==='"'?De=De.slice(1,De.length-1):De==="TRUE"?De=!0:De==="FALSE"?De=!1:isNaN(hr(De))?isNaN(Xo(De).getDate())||(De=Gi(De)):(De=hr(De),ce!==null&&dh(ce)&&(De=ph(De))),typeof Dt<"u"&&typeof De=="string"&&(b||{}).type!="string"&&(b||{}).codepage&&(De=Dt.utils.decode(b.codepage,De)),be=!0;break;case"E":Ue=!0;var B=hS(Me[j].slice(1),{r:x,c:C});H[x][C]=[H[x][C],B];break;case"S":ke=!0,H[x][C]=[H[x][C],"S5S"];break;case"G":break;case"R":et=parseInt(Me[j].slice(1))-1;break;case"C":Vt=parseInt(Me[j].slice(1))-1;break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}if(be&&(H[x][C]&&H[x][C].length==2?H[x][C][0]=De:H[x][C]=De,ce=null),ke){if(Ue)throw new Error("SYLK shared formula cannot have own formula");var re=et>-1&&H[et][Vt];if(!re||!re[1])throw new Error("SYLK shared formula cannot find base");H[x][C][1]=gS(re[1],{r:x-et,c:C-Vt})}break;case"F":var L=0;for(j=1;j<Me.length;++j)switch(Me[j].charAt(0)){case"X":C=parseInt(Me[j].slice(1))-1,++L;break;case"Y":for(x=parseInt(Me[j].slice(1))-1,ue=H.length;ue<=x;++ue)H[ue]=[];break;case"M":le=parseInt(Me[j].slice(1))/20;break;case"F":break;case"G":break;case"P":ce=K[parseInt(Me[j].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(ee=Me[j].slice(1).split(" "),ue=parseInt(ee[0],10);ue<=parseInt(ee[1],10);++ue)le=parseInt(ee[2],10),se[ue-1]=le===0?{hidden:!0}:{wch:le},Z0(se[ue-1]);break;case"C":C=parseInt(Me[j].slice(1))-1,se[C]||(se[C]={});break;case"R":x=parseInt(Me[j].slice(1))-1,W[x]||(W[x]={}),le>0?(W[x].hpt=le,W[x].hpx=Yh(le)):le===0&&(W[x].hidden=!0);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}L<1&&(ce=null);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+me)}}return W.length>0&&(we["!rows"]=W),se.length>0&&(we["!cols"]=se),b&&b.sheetRows&&(H=H.slice(0,b.sheetRows)),[H,we]}function o(v,b){var w=r(v,b),x=w[0],C=w[1],U=no(x,b);return Di(C).forEach(function(j){U[j]=C[j]}),U}function u(v,b){return la(o(v,b),b)}function m(v,b,w,x){var C="C;Y"+(w+1)+";X"+(x+1)+";K";switch(v.t){case"n":C+=v.v||0,v.f&&!v.F&&(C+=";E"+td(v.f,{r:w,c:x}));break;case"b":C+=v.v?"TRUE":"FALSE";break;case"e":C+=v.w||v.v;break;case"d":C+='"'+(v.w||v.v)+'"';break;case"s":C+='"'+v.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return C}function f(v,b){b.forEach(function(w,x){var C="F;W"+(x+1)+" "+(x+1)+" ";w.hidden?C+="0":(typeof w.width=="number"&&!w.wpx&&(w.wpx=Rl(w.width)),typeof w.wpx=="number"&&!w.wch&&(w.wch=Nl(w.wpx)),typeof w.wch=="number"&&(C+=Math.round(w.wch))),C.charAt(C.length-1)!=" "&&v.push(C)})}function h(v,b){b.forEach(function(w,x){var C="F;";w.hidden?C+="M0;":w.hpt?C+="M"+20*w.hpt+";":w.hpx&&(C+="M"+20*Bl(w.hpx)+";"),C.length>2&&v.push(C+"R"+(x+1))})}function g(v,b){var w=["ID;PWXL;N;E"],x=[],C=zt(v["!ref"]),U,j=Array.isArray(v),H=`\r
`;w.push("P;PGeneral"),w.push("F;P0;DG0G8;M255"),v["!cols"]&&f(w,v["!cols"]),v["!rows"]&&h(w,v["!rows"]),w.push("B;Y"+(C.e.r-C.s.r+1)+";X"+(C.e.c-C.s.c+1)+";D"+[C.s.c,C.s.r,C.e.c,C.e.r].join(" "));for(var K=C.s.r;K<=C.e.r;++K)for(var ce=C.s.c;ce<=C.e.c;++ce){var we=It({r:K,c:ce});U=j?(v[K]||[])[ce]:v[we],!(!U||U.v==null&&(!U.f||U.F))&&x.push(m(U,v,K,ce,b))}return w.join(H)+H+x.join(H)+H+"E"+H}return{to_workbook:u,to_sheet:o,from_sheet:g}}(),vC=function(){function i(a,o){switch(o.type){case"base64":return t(_r(a),o);case"binary":return t(a,o);case"buffer":return t(bt&&Buffer.isBuffer(a)?a.toString("binary"):Jo(a),o);case"array":return t(zl(a),o)}throw new Error("Unrecognized type "+o.type)}function t(a,o){for(var u=a.split(`
`),m=-1,f=-1,h=0,g=[];h!==u.length;++h){if(u[h].trim()==="BOT"){g[++m]=[],f=0;continue}if(!(m<0)){var v=u[h].trim().split(","),b=v[0],w=v[1];++h;for(var x=u[h]||"";(x.match(/["]/g)||[]).length&1&&h<u.length-1;)x+=`
`+u[++h];switch(x=x.trim(),+b){case-1:if(x==="BOT"){g[++m]=[],f=0;continue}else if(x!=="EOD")throw new Error("Unrecognized DIF special command "+x);break;case 0:x==="TRUE"?g[m][f]=!0:x==="FALSE"?g[m][f]=!1:isNaN(hr(w))?isNaN(Xo(w).getDate())?g[m][f]=w:g[m][f]=Gi(w):g[m][f]=hr(w),++f;break;case 1:x=x.slice(1,x.length-1),x=x.replace(/""/g,'"'),Bo&&x&&x.match(/^=".*"$/)&&(x=x.slice(2,-1)),g[m][f++]=x!==""?x:null;break}if(x==="EOD")break}}return o&&o.sheetRows&&(g=g.slice(0,o.sheetRows)),g}function e(a,o){return no(i(a,o),o)}function n(a,o){return la(e(a,o),o)}var r=function(){var a=function(m,f,h,g,v){m.push(f),m.push(h+","+g),m.push('"'+v.replace(/"/g,'""')+'"')},o=function(m,f,h,g){m.push(f+","+h),m.push(f==1?'"'+g.replace(/"/g,'""')+'"':g)};return function(m){var f=[],h=zt(m["!ref"]),g,v=Array.isArray(m);a(f,"TABLE",0,1,"sheetjs"),a(f,"VECTORS",0,h.e.r-h.s.r+1,""),a(f,"TUPLES",0,h.e.c-h.s.c+1,""),a(f,"DATA",0,0,"");for(var b=h.s.r;b<=h.e.r;++b){o(f,-1,0,"BOT");for(var w=h.s.c;w<=h.e.c;++w){var x=It({r:b,c:w});if(g=v?(m[b]||[])[w]:m[x],!g){o(f,1,0,"");continue}switch(g.t){case"n":var C=Bo?g.w:g.v;!C&&g.v!=null&&(C=g.v),C==null?Bo&&g.f&&!g.F?o(f,1,0,"="+g.f):o(f,1,0,""):o(f,0,C,"V");break;case"b":o(f,0,g.v?1:0,g.v?"TRUE":"FALSE");break;case"s":o(f,1,0,!Bo||isNaN(g.v)?g.v:'="'+g.v+'"');break;case"d":g.w||(g.w=Ar(g.z||ni[14],tn(Gi(g.v)))),Bo?o(f,0,g.w,"V"):o(f,1,0,g.w);break;default:o(f,1,0,"")}}}o(f,-1,0,"EOD");var U=`\r
`,j=f.join(U);return j}}();return{to_workbook:n,to_sheet:e,from_sheet:r}}(),Gh=function(){function i(g){return g.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(g){return g.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function e(g,v){for(var b=g.split(`
`),w=-1,x=-1,C=0,U=[];C!==b.length;++C){var j=b[C].trim().split(":");if(j[0]==="cell"){var H=Si(j[1]);if(U.length<=H.r)for(w=U.length;w<=H.r;++w)U[w]||(U[w]=[]);switch(w=H.r,x=H.c,j[2]){case"t":U[w][x]=i(j[3]);break;case"v":U[w][x]=+j[3];break;case"vtf":var K=j[j.length-1];case"vtc":switch(j[3]){case"nl":U[w][x]=!!+j[4];break;default:U[w][x]=+j[4];break}j[2]=="vtf"&&(U[w][x]=[U[w][x],K])}}}return v&&v.sheetRows&&(U=U.slice(0,v.sheetRows)),U}function n(g,v){return no(e(g,v),v)}function r(g,v){return la(n(g,v),v)}var a=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,u=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),m="--SocialCalcSpreadsheetControlSave--";function f(g){if(!g||!g["!ref"])return"";for(var v=[],b=[],w,x="",C=xn(g["!ref"]),U=Array.isArray(g),j=C.s.r;j<=C.e.r;++j)for(var H=C.s.c;H<=C.e.c;++H)if(x=It({r:j,c:H}),w=U?(g[j]||[])[H]:g[x],!(!w||w.v==null||w.t==="z")){switch(b=["cell",x,"t"],w.t){case"s":case"str":b.push(t(w.v));break;case"n":w.f?(b[2]="vtf",b[3]="n",b[4]=w.v,b[5]=t(w.f)):(b[2]="v",b[3]=w.v);break;case"b":b[2]="vt"+(w.f?"f":"c"),b[3]="nl",b[4]=w.v?"1":"0",b[5]=t(w.f||(w.v?"TRUE":"FALSE"));break;case"d":var K=tn(Gi(w.v));b[2]="vtc",b[3]="nd",b[4]=""+K,b[5]=w.w||Ar(w.z||ni[14],K);break;case"e":continue}v.push(b.join(":"))}return v.push("sheet:c:"+(C.e.c-C.s.c+1)+":r:"+(C.e.r-C.s.r+1)+":tvf:1"),v.push("valueformat:1:text-wiki"),v.join(`
`)}function h(g){return[a,o,u,o,f(g),m].join(`
`)}return{to_workbook:r,to_sheet:n,from_sheet:h}}(),xC=function(){function i(h,g,v,b,w){w.raw?g[v][b]=h:h===""||(h==="TRUE"?g[v][b]=!0:h==="FALSE"?g[v][b]=!1:isNaN(hr(h))?isNaN(Xo(h).getDate())?g[v][b]=h:g[v][b]=Gi(h):g[v][b]=hr(h))}function t(h,g){var v=g||{},b=[];if(!h||h.length===0)return b;for(var w=h.split(/[\r\n]/),x=w.length-1;x>=0&&w[x].length===0;)--x;for(var C=10,U=0,j=0;j<=x;++j)U=w[j].indexOf(" "),U==-1?U=w[j].length:U++,C=Math.max(C,U);for(j=0;j<=x;++j){b[j]=[];var H=0;for(i(w[j].slice(0,C).trim(),b,j,H,v),H=1;H<=(w[j].length-C)/10+1;++H)i(w[j].slice(C+(H-1)*10,C+H*10).trim(),b,j,H,v)}return v.sheetRows&&(b=b.slice(0,v.sheetRows)),b}var e={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function r(h){for(var g={},v=!1,b=0,w=0;b<h.length;++b)(w=h.charCodeAt(b))==34?v=!v:!v&&w in e&&(g[w]=(g[w]||0)+1);w=[];for(b in g)Object.prototype.hasOwnProperty.call(g,b)&&w.push([g[b],b]);if(!w.length){g=n;for(b in g)Object.prototype.hasOwnProperty.call(g,b)&&w.push([g[b],b])}return w.sort(function(x,C){return x[0]-C[0]||n[x[1]]-n[C[1]]}),e[w.pop()[1]]||44}function a(h,g){var v=g||{},b="";or!=null&&v.dense==null&&(v.dense=or);var w=v.dense?[]:{},x={s:{c:0,r:0},e:{c:0,r:0}};h.slice(0,4)=="sep="?h.charCodeAt(5)==13&&h.charCodeAt(6)==10?(b=h.charAt(4),h=h.slice(7)):h.charCodeAt(5)==13||h.charCodeAt(5)==10?(b=h.charAt(4),h=h.slice(6)):b=r(h.slice(0,1024)):v&&v.FS?b=v.FS:b=r(h.slice(0,1024));var C=0,U=0,j=0,H=0,K=0,ce=b.charCodeAt(0),we=!1,W=0,se=h.charCodeAt(0);h=h.replace(/\r\n/mg,`
`);var ee=v.dateNF!=null?Db(v.dateNF):null;function le(){var ue=h.slice(H,K),me={};if(ue.charAt(0)=='"'&&ue.charAt(ue.length-1)=='"'&&(ue=ue.slice(1,-1).replace(/""/g,'"')),ue.length===0)me.t="z";else if(v.raw)me.t="s",me.v=ue;else if(ue.trim().length===0)me.t="s",me.v=ue;else if(ue.charCodeAt(0)==61)ue.charCodeAt(1)==34&&ue.charCodeAt(ue.length-1)==34?(me.t="s",me.v=ue.slice(2,-1).replace(/""/g,'"')):_S(ue)?(me.t="n",me.f=ue.slice(1)):(me.t="s",me.v=ue);else if(ue=="TRUE")me.t="b",me.v=!0;else if(ue=="FALSE")me.t="b",me.v=!1;else if(!isNaN(j=hr(ue)))me.t="n",v.cellText!==!1&&(me.w=ue),me.v=j;else if(!isNaN(Xo(ue).getDate())||ee&&ue.match(ee)){me.z=v.dateNF||ni[14];var Me=0;ee&&ue.match(ee)&&(ue=Rb(ue,v.dateNF,ue.match(ee)||[]),Me=1),v.cellDates?(me.t="d",me.v=Gi(ue,Me)):(me.t="n",me.v=tn(Gi(ue,Me))),v.cellText!==!1&&(me.w=Ar(me.z,me.v instanceof Date?tn(me.v):me.v)),v.cellNF||delete me.z}else me.t="s",me.v=ue;if(me.t=="z"||(v.dense?(w[C]||(w[C]=[]),w[C][U]=me):w[It({c:U,r:C})]=me),H=K+1,se=h.charCodeAt(H),x.e.c<U&&(x.e.c=U),x.e.r<C&&(x.e.r=C),W==ce)++U;else if(U=0,++C,v.sheetRows&&v.sheetRows<=C)return!0}e:for(;K<h.length;++K)switch(W=h.charCodeAt(K)){case 34:se===34&&(we=!we);break;case ce:case 10:case 13:if(!we&&le())break e;break;default:break}return K-H>0&&le(),w["!ref"]=fi(x),w}function o(h,g){return!(g&&g.PRN)||g.FS||h.slice(0,4)=="sep="||h.indexOf("	")>=0||h.indexOf(",")>=0||h.indexOf(";")>=0?a(h,g):no(t(h,g),g)}function u(h,g){var v="",b=g.type=="string"?[0,0,0,0]:FT(h,g);switch(g.type){case"base64":v=_r(h);break;case"binary":v=h;break;case"buffer":g.codepage==65001?v=h.toString("utf8"):g.codepage&&typeof Dt<"u"?v=Dt.utils.decode(g.codepage,h):v=bt&&Buffer.isBuffer(h)?h.toString("binary"):Jo(h);break;case"array":v=zl(h);break;case"string":v=h;break;default:throw new Error("Unrecognized type "+g.type)}return b[0]==239&&b[1]==187&&b[2]==191?v=Uo(v.slice(3)):g.type!="string"&&g.type!="buffer"&&g.codepage==65001?v=Uo(v):g.type=="binary"&&typeof Dt<"u"&&g.codepage&&(v=Dt.utils.decode(g.codepage,Dt.utils.encode(28591,v))),v.slice(0,19)=="socialcalc:version:"?Gh.to_sheet(g.type=="string"?v:Uo(v),g):o(v,g)}function m(h,g){return la(u(h,g),g)}function f(h){for(var g=[],v=zt(h["!ref"]),b,w=Array.isArray(h),x=v.s.r;x<=v.e.r;++x){for(var C=[],U=v.s.c;U<=v.e.c;++U){var j=It({r:x,c:U});if(b=w?(h[x]||[])[U]:h[j],!b||b.v==null){C.push("          ");continue}for(var H=(b.w||(vr(b),b.w)||"").slice(0,10);H.length<10;)H+=" ";C.push(H+(U===0?" ":""))}g.push(C.join(""))}return g.join(`
`)}return{to_workbook:m,to_sheet:u,from_sheet:f}}();var zp=function(){function i(B,re,L){if(B){_n(B,B.l||0);for(var V=L.Enum||et;B.l<B.length;){var fe=B.read_shift(2),ye=V[fe]||V[65535],Oe=B.read_shift(2),Se=B.l+Oe,he=ye.f&&ye.f(B,Oe,L);if(B.l=Se,re(he,ye,fe))return}}}function t(B,re){switch(re.type){case"base64":return e(Ln(_r(B)),re);case"binary":return e(Ln(B),re);case"buffer":case"array":return e(B,re)}throw"Unsupported type "+re.type}function e(B,re){if(!B)return B;var L=re||{};or!=null&&L.dense==null&&(L.dense=or);var V=L.dense?[]:{},fe="Sheet1",ye="",Oe=0,Se={},he=[],ht=[],st={s:{r:0,c:0},e:{r:0,c:0}},Ei=L.sheetRows||0;if(B[2]==0&&(B[3]==8||B[3]==9)&&B.length>=16&&B[14]==5&&B[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(B[2]==2)L.Enum=et,i(B,function(Fe,yn,dr){switch(dr){case 0:L.vers=Fe,Fe>=4096&&(L.qpro=!0);break;case 6:st=Fe;break;case 204:Fe&&(ye=Fe);break;case 222:ye=Fe;break;case 15:case 51:L.qpro||(Fe[1].v=Fe[1].v.slice(1));case 13:case 14:case 16:dr==14&&(Fe[2]&112)==112&&(Fe[2]&15)>1&&(Fe[2]&15)<15&&(Fe[1].z=L.dateNF||ni[14],L.cellDates&&(Fe[1].t="d",Fe[1].v=ph(Fe[1].v))),L.qpro&&Fe[3]>Oe&&(V["!ref"]=fi(st),Se[fe]=V,he.push(fe),V=L.dense?[]:{},st={s:{r:0,c:0},e:{r:0,c:0}},Oe=Fe[3],fe=ye||"Sheet"+(Oe+1),ye="");var jr=L.dense?(V[Fe[0].r]||[])[Fe[0].c]:V[It(Fe[0])];if(jr){jr.t=Fe[1].t,jr.v=Fe[1].v,Fe[1].z!=null&&(jr.z=Fe[1].z),Fe[1].f!=null&&(jr.f=Fe[1].f);break}L.dense?(V[Fe[0].r]||(V[Fe[0].r]=[]),V[Fe[0].r][Fe[0].c]=Fe[1]):V[It(Fe[0])]=Fe[1];break;default:}},L);else if(B[2]==26||B[2]==14)L.Enum=Vt,B[2]==14&&(L.qpro=!0,B.l=0),i(B,function(Fe,yn,dr){switch(dr){case 204:fe=Fe;break;case 22:Fe[1].v=Fe[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Fe[3]>Oe&&(V["!ref"]=fi(st),Se[fe]=V,he.push(fe),V=L.dense?[]:{},st={s:{r:0,c:0},e:{r:0,c:0}},Oe=Fe[3],fe="Sheet"+(Oe+1)),Ei>0&&Fe[0].r>=Ei)break;L.dense?(V[Fe[0].r]||(V[Fe[0].r]=[]),V[Fe[0].r][Fe[0].c]=Fe[1]):V[It(Fe[0])]=Fe[1],st.e.c<Fe[0].c&&(st.e.c=Fe[0].c),st.e.r<Fe[0].r&&(st.e.r=Fe[0].r);break;case 27:Fe[14e3]&&(ht[Fe[14e3][0]]=Fe[14e3][1]);break;case 1537:ht[Fe[0]]=Fe[1],Fe[0]==Oe&&(fe=Fe[1]);break;default:break}},L);else throw new Error("Unrecognized LOTUS BOF "+B[2]);if(V["!ref"]=fi(st),Se[ye||fe]=V,he.push(ye||fe),!ht.length)return{SheetNames:he,Sheets:Se};for(var gt={},Rn=[],Kt=0;Kt<ht.length;++Kt)Se[he[Kt]]?(Rn.push(ht[Kt]||he[Kt]),gt[ht[Kt]]=Se[ht[Kt]]||Se[he[Kt]]):(Rn.push(ht[Kt]),gt[ht[Kt]]={"!ref":"A1"});return{SheetNames:Rn,Sheets:gt}}function n(B,re){var L=re||{};if(+L.codepage>=0&&Go(+L.codepage),L.type=="string")throw new Error("Cannot write WK1 to JS string");var V=en(),fe=zt(B["!ref"]),ye=Array.isArray(B),Oe=[];_e(V,0,a(1030)),_e(V,6,m(fe));for(var Se=Math.min(fe.e.r,8191),he=fe.s.r;he<=Se;++he)for(var ht=Oi(he),st=fe.s.c;st<=fe.e.c;++st){he===fe.s.r&&(Oe[st]=Li(st));var Ei=Oe[st]+ht,gt=ye?(B[he]||[])[st]:B[Ei];if(!(!gt||gt.t=="z"))if(gt.t=="n")(gt.v|0)==gt.v&&gt.v>=-32768&&gt.v<=32767?_e(V,13,b(he,st,gt.v)):_e(V,14,x(he,st,gt.v));else{var Rn=vr(gt);_e(V,15,g(he,st,Rn.slice(0,239)))}}return _e(V,1),V.end()}function r(B,re){var L=re||{};if(+L.codepage>=0&&Go(+L.codepage),L.type=="string")throw new Error("Cannot write WK3 to JS string");var V=en();_e(V,0,o(B));for(var fe=0,ye=0;fe<B.SheetNames.length;++fe)(B.Sheets[B.SheetNames[fe]]||{})["!ref"]&&_e(V,27,Ue(B.SheetNames[fe],ye++));var Oe=0;for(fe=0;fe<B.SheetNames.length;++fe){var Se=B.Sheets[B.SheetNames[fe]];if(!(!Se||!Se["!ref"])){for(var he=zt(Se["!ref"]),ht=Array.isArray(Se),st=[],Ei=Math.min(he.e.r,8191),gt=he.s.r;gt<=Ei;++gt)for(var Rn=Oi(gt),Kt=he.s.c;Kt<=he.e.c;++Kt){gt===he.s.r&&(st[Kt]=Li(Kt));var Fe=st[Kt]+Rn,yn=ht?(Se[gt]||[])[Kt]:Se[Fe];if(!(!yn||yn.t=="z"))if(yn.t=="n")_e(V,23,le(gt,Kt,Oe,yn.v));else{var dr=vr(yn);_e(V,22,W(gt,Kt,Oe,dr.slice(0,239)))}}++Oe}}return _e(V,1),V.end()}function a(B){var re=ne(2);return re.write_shift(2,B),re}function o(B){var re=ne(26);re.write_shift(2,4096),re.write_shift(2,4),re.write_shift(4,0);for(var L=0,V=0,fe=0,ye=0;ye<B.SheetNames.length;++ye){var Oe=B.SheetNames[ye],Se=B.Sheets[Oe];if(!(!Se||!Se["!ref"])){++fe;var he=xn(Se["!ref"]);L<he.e.r&&(L=he.e.r),V<he.e.c&&(V=he.e.c)}}return L>8191&&(L=8191),re.write_shift(2,L),re.write_shift(1,fe),re.write_shift(1,V),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(1,1),re.write_shift(1,2),re.write_shift(4,0),re.write_shift(4,0),re}function u(B,re,L){var V={s:{c:0,r:0},e:{c:0,r:0}};return re==8&&L.qpro?(V.s.c=B.read_shift(1),B.l++,V.s.r=B.read_shift(2),V.e.c=B.read_shift(1),B.l++,V.e.r=B.read_shift(2),V):(V.s.c=B.read_shift(2),V.s.r=B.read_shift(2),re==12&&L.qpro&&(B.l+=2),V.e.c=B.read_shift(2),V.e.r=B.read_shift(2),re==12&&L.qpro&&(B.l+=2),V.s.c==65535&&(V.s.c=V.e.c=V.s.r=V.e.r=0),V)}function m(B){var re=ne(8);return re.write_shift(2,B.s.c),re.write_shift(2,B.s.r),re.write_shift(2,B.e.c),re.write_shift(2,B.e.r),re}function f(B,re,L){var V=[{c:0,r:0},{t:"n",v:0},0,0];return L.qpro&&L.vers!=20768?(V[0].c=B.read_shift(1),V[3]=B.read_shift(1),V[0].r=B.read_shift(2),B.l+=2):(V[2]=B.read_shift(1),V[0].c=B.read_shift(2),V[0].r=B.read_shift(2)),V}function h(B,re,L){var V=B.l+re,fe=f(B,re,L);if(fe[1].t="s",L.vers==20768){B.l++;var ye=B.read_shift(1);return fe[1].v=B.read_shift(ye,"utf8"),fe}return L.qpro&&B.l++,fe[1].v=B.read_shift(V-B.l,"cstr"),fe}function g(B,re,L){var V=ne(7+L.length);V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(1,39);for(var fe=0;fe<V.length;++fe){var ye=L.charCodeAt(fe);V.write_shift(1,ye>=128?95:ye)}return V.write_shift(1,0),V}function v(B,re,L){var V=f(B,re,L);return V[1].v=B.read_shift(2,"i"),V}function b(B,re,L){var V=ne(7);return V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(2,L,"i"),V}function w(B,re,L){var V=f(B,re,L);return V[1].v=B.read_shift(8,"f"),V}function x(B,re,L){var V=ne(13);return V.write_shift(1,255),V.write_shift(2,re),V.write_shift(2,B),V.write_shift(8,L,"f"),V}function C(B,re,L){var V=B.l+re,fe=f(B,re,L);if(fe[1].v=B.read_shift(8,"f"),L.qpro)B.l=V;else{var ye=B.read_shift(2);K(B.slice(B.l,B.l+ye),fe),B.l+=ye}return fe}function U(B,re,L){var V=re&32768;return re&=-32769,re=(V?B:0)+(re>=8192?re-16384:re),(V?"":"$")+(L?Li(re):Oi(re))}var j={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},H=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function K(B,re){_n(B,0);for(var L=[],V=0,fe="",ye="",Oe="",Se="";B.l<B.length;){var he=B[B.l++];switch(he){case 0:L.push(B.read_shift(8,"f"));break;case 1:ye=U(re[0].c,B.read_shift(2),!0),fe=U(re[0].r,B.read_shift(2),!1),L.push(ye+fe);break;case 2:{var ht=U(re[0].c,B.read_shift(2),!0),st=U(re[0].r,B.read_shift(2),!1);ye=U(re[0].c,B.read_shift(2),!0),fe=U(re[0].r,B.read_shift(2),!1),L.push(ht+st+":"+ye+fe)}break;case 3:if(B.l<B.length){console.error("WK1 premature formula end");return}break;case 4:L.push("("+L.pop()+")");break;case 5:L.push(B.read_shift(2));break;case 6:{for(var Ei="";he=B[B.l++];)Ei+=String.fromCharCode(he);L.push('"'+Ei.replace(/"/g,'""')+'"')}break;case 8:L.push("-"+L.pop());break;case 23:L.push("+"+L.pop());break;case 22:L.push("NOT("+L.pop()+")");break;case 20:case 21:Se=L.pop(),Oe=L.pop(),L.push(["AND","OR"][he-20]+"("+Oe+","+Se+")");break;default:if(he<32&&H[he])Se=L.pop(),Oe=L.pop(),L.push(Oe+H[he]+Se);else if(j[he]){if(V=j[he][1],V==69&&(V=B[B.l++]),V>L.length){console.error("WK1 bad formula parse 0x"+he.toString(16)+":|"+L.join("|")+"|");return}var gt=L.slice(-V);L.length-=V,L.push(j[he][0]+"("+gt.join(",")+")")}else return he<=7?console.error("WK1 invalid opcode "+he.toString(16)):he<=24?console.error("WK1 unsupported op "+he.toString(16)):he<=30?console.error("WK1 invalid opcode "+he.toString(16)):he<=115?console.error("WK1 unsupported function opcode "+he.toString(16)):console.error("WK1 unrecognized opcode "+he.toString(16))}}L.length==1?re[1].f=""+L[0]:console.error("WK1 bad formula parse |"+L.join("|")+"|")}function ce(B){var re=[{c:0,r:0},{t:"n",v:0},0];return re[0].r=B.read_shift(2),re[3]=B[B.l++],re[0].c=B[B.l++],re}function we(B,re){var L=ce(B,re);return L[1].t="s",L[1].v=B.read_shift(re-4,"cstr"),L}function W(B,re,L,V){var fe=ne(6+V.length);fe.write_shift(2,B),fe.write_shift(1,L),fe.write_shift(1,re),fe.write_shift(1,39);for(var ye=0;ye<V.length;++ye){var Oe=V.charCodeAt(ye);fe.write_shift(1,Oe>=128?95:Oe)}return fe.write_shift(1,0),fe}function se(B,re){var L=ce(B,re);L[1].v=B.read_shift(2);var V=L[1].v>>1;if(L[1].v&1)switch(V&7){case 0:V=(V>>3)*5e3;break;case 1:V=(V>>3)*500;break;case 2:V=(V>>3)/20;break;case 3:V=(V>>3)/200;break;case 4:V=(V>>3)/2e3;break;case 5:V=(V>>3)/2e4;break;case 6:V=(V>>3)/16;break;case 7:V=(V>>3)/64;break}return L[1].v=V,L}function ee(B,re){var L=ce(B,re),V=B.read_shift(4),fe=B.read_shift(4),ye=B.read_shift(2);if(ye==65535)return V===0&&fe===3221225472?(L[1].t="e",L[1].v=15):V===0&&fe===3489660928?(L[1].t="e",L[1].v=42):L[1].v=0,L;var Oe=ye&32768;return ye=(ye&32767)-16446,L[1].v=(1-Oe*2)*(fe*Math.pow(2,ye+32)+V*Math.pow(2,ye)),L}function le(B,re,L,V){var fe=ne(14);if(fe.write_shift(2,B),fe.write_shift(1,L),fe.write_shift(1,re),V==0)return fe.write_shift(4,0),fe.write_shift(4,0),fe.write_shift(2,65535),fe;var ye=0,Oe=0,Se=0,he=0;return V<0&&(ye=1,V=-V),Oe=Math.log2(V)|0,V/=Math.pow(2,Oe-31),he=V>>>0,(he&2147483648)==0&&(V/=2,++Oe,he=V>>>0),V-=he,he|=2147483648,he>>>=0,V*=Math.pow(2,32),Se=V>>>0,fe.write_shift(4,Se),fe.write_shift(4,he),Oe+=16383+(ye?32768:0),fe.write_shift(2,Oe),fe}function ue(B,re){var L=ee(B,14);return B.l+=re-14,L}function me(B,re){var L=ce(B,re),V=B.read_shift(4);return L[1].v=V>>6,L}function Me(B,re){var L=ce(B,re),V=B.read_shift(8,"f");return L[1].v=V,L}function mt(B,re){var L=Me(B,14);return B.l+=re-10,L}function De(B,re){return B[B.l+re-1]==0?B.read_shift(re,"cstr"):""}function be(B,re){var L=B[B.l++];L>re-1&&(L=re-1);for(var V="";V.length<L;)V+=String.fromCharCode(B[B.l++]);return V}function Ee(B,re,L){if(!(!L.qpro||re<21)){var V=B.read_shift(1);B.l+=17,B.l+=1,B.l+=2;var fe=B.read_shift(re-21,"cstr");return[V,fe]}}function ke(B,re){for(var L={},V=B.l+re;B.l<V;){var fe=B.read_shift(2);if(fe==14e3){for(L[fe]=[0,""],L[fe][0]=B.read_shift(2);B[B.l];)L[fe][1]+=String.fromCharCode(B[B.l]),B.l++;B.l++}}return L}function Ue(B,re){var L=ne(5+B.length);L.write_shift(2,14e3),L.write_shift(2,re);for(var V=0;V<B.length;++V){var fe=B.charCodeAt(V);L[L.l++]=fe>127?95:fe}return L[L.l++]=0,L}var et={0:{n:"BOF",f:jh},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:u},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:v},14:{n:"NUMBER",f:w},15:{n:"LABEL",f:h},16:{n:"FORMULA",f:C},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:h},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:De},222:{n:"SHEETNAMELP",f:be},65535:{n:""}},Vt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:we},23:{n:"NUMBER17",f:ee},24:{n:"NUMBER18",f:se},25:{n:"FORMULA19",f:ue},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:ke},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:me},38:{n:"??"},39:{n:"NUMBER27",f:Me},40:{n:"FORMULA28",f:mt},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:De},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Ee},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:r,to_workbook:t}}();var bC=/^\s|\s$|[\t\n\r]/;function qh(i,t){if(!t.bookSST)return"";var e=[pi];e[e.length]=ge("sst",null,{xmlns:to[0],count:i.Count,uniqueCount:i.Unique});for(var n=0;n!=i.length;++n)if(i[n]!=null){var r=i[n],a="<si>";r.r?a+=r.r:(a+="<t",r.t||(r.t=""),r.t.match(bC)&&(a+=' xml:space="preserve"'),a+=">"+kt(r.t)+"</t>"),a+="</si>",e[e.length]=a}return e.length>2&&(e[e.length]="</sst>",e[1]=e[1].replace("/>",">")),e.join("")}function yC(i){return[i.read_shift(4),i.read_shift(4)]}function CC(i,t){return t||(t=ne(8)),t.write_shift(4,i.Count),t.write_shift(4,i.Unique),t}var SC=fy;function wC(i){var t=en();de(t,159,CC(i));for(var e=0;e<i.length;++e)de(t,19,SC(i[e]));return de(t,160),t.end()}function EC(i){if(typeof Dt<"u")return Dt.utils.encode(Za,i);for(var t=[],e=i.split(""),n=0;n<e.length;++n)t[n]=e[n].charCodeAt(0);return t}function Xh(i){var t=0,e,n=EC(i),r=n.length+1,a,o,u,m,f;for(e=aa(r),e[0]=n.length,a=1;a!=r;++a)e[a]=n[a-1];for(a=r-1;a>=0;--a)o=e[a],u=(t&16384)===0?0:1,m=t<<1&32767,f=u|m,t=f^o;return t^52811}var TC=function(){function i(r,a){switch(a.type){case"base64":return t(_r(r),a);case"binary":return t(r,a);case"buffer":return t(bt&&Buffer.isBuffer(r)?r.toString("binary"):Jo(r),a);case"array":return t(zl(r),a)}throw new Error("Unrecognized type "+a.type)}function t(r,a){var o=a||{},u=o.dense?[]:{},m=r.match(/\\trowd.*?\\row\b/g);if(!m.length)throw new Error("RTF missing table");var f={s:{c:0,r:0},e:{c:0,r:m.length-1}};return m.forEach(function(h,g){Array.isArray(u)&&(u[g]=[]);for(var v=/\\\w+\b/g,b=0,w,x=-1;w=v.exec(h);){switch(w[0]){case"\\cell":var C=h.slice(b,v.lastIndex-w[0].length);if(C[0]==" "&&(C=C.slice(1)),++x,C.length){var U={v:C,t:"s"};Array.isArray(u)?u[g][x]=U:u[It({r:g,c:x})]=U}break}b=v.lastIndex}x>f.e.c&&(f.e.c=x)}),u["!ref"]=fi(f),u}function e(r,a){return la(i(r,a),a)}function n(r){for(var a=["{\\rtf1\\ansi"],o=zt(r["!ref"]),u,m=Array.isArray(r),f=o.s.r;f<=o.e.r;++f){a.push("\\trowd\\trautofit1");for(var h=o.s.c;h<=o.e.c;++h)a.push("\\cellx"+(h+1));for(a.push("\\pard\\intbl"),h=o.s.c;h<=o.e.c;++h){var g=It({r:f,c:h});u=m?(r[f]||[])[h]:r[g],!(!u||u.v==null&&(!u.f||u.F))&&(a.push(" "+(u.w||(vr(u),u.w))),a.push("\\cell"))}a.push("\\pard\\intbl\\row")}return a.join("")+"}"}return{to_workbook:e,to_sheet:i,from_sheet:n}}();function $p(i){for(var t=0,e=1;t!=3;++t)e=e*256+(i[t]>255?255:i[t]<0?0:i[t]);return e.toString(16).toUpperCase().slice(1)}var PC=6;var gr=PC;function Rl(i){return Math.floor((i+Math.round(128/gr)/256)*gr)}function Nl(i){return Math.floor((i-5)/gr*100+.5)/100}function D0(i){return Math.round((i*gr+5)/gr*256)/256}function Z0(i){i.width?(i.wpx=Rl(i.width),i.wch=Nl(i.wpx),i.MDW=gr):i.wpx?(i.wch=Nl(i.wpx),i.width=D0(i.wch),i.MDW=gr):typeof i.wch=="number"&&(i.width=D0(i.wch),i.wpx=Rl(i.width),i.MDW=gr),i.customWidth&&delete i.customWidth}var kC=96,Kh=kC;function Bl(i){return i*96/Kh}function Yh(i){return i*Kh/96}function IC(i){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(e){for(var n=e[0];n<=e[1];++n)i[n]!=null&&(t[t.length]=ge("numFmt",null,{numFmtId:n,formatCode:kt(i[n])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=ge("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function MC(i){var t=[];return t[t.length]=ge("cellXfs",null),i.forEach(function(e){t[t.length]=ge("xf",null,e)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=ge("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function Qh(i,t){var e=[pi,ge("styleSheet",null,{xmlns:to[0],"xmlns:vt":Ci.vt})],n;return i.SSF&&(n=IC(i.SSF))!=null&&(e[e.length]=n),e[e.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',e[e.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',e[e.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',e[e.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=MC(t.cellXfs))&&(e[e.length]=n),e[e.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',e[e.length]='<dxfs count="0"/>',e[e.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',e.length>2&&(e[e.length]="</styleSheet>",e[1]=e[1].replace("/>",">")),e.join("")}function FC(i,t){var e=i.read_shift(2),n=Vi(i,t-2);return[e,n]}function AC(i,t,e){e||(e=ne(6+4*t.length)),e.write_shift(2,i),wi(t,e);var n=e.length>e.l?e.slice(0,e.l):e;return e.l==null&&(e.l=e.length),n}function OC(i,t,e){var n={};n.sz=i.read_shift(2)/20;var r=by(i,2,e);r.fItalic&&(n.italic=1),r.fCondense&&(n.condense=1),r.fExtend&&(n.extend=1),r.fShadow&&(n.shadow=1),r.fOutline&&(n.outline=1),r.fStrikeout&&(n.strike=1);var a=i.read_shift(2);switch(a===700&&(n.bold=1),i.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var o=i.read_shift(1);o!=0&&(n.underline=o);var u=i.read_shift(1);u>0&&(n.family=u);var m=i.read_shift(1);switch(m>0&&(n.charset=m),i.l++,n.color=xy(i,8),i.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=Vi(i,t-21),n}function DC(i,t){t||(t=ne(25+4*32)),t.write_shift(2,i.sz*20),yy(i,t),t.write_shift(2,i.bold?700:400);var e=0;i.vertAlign=="superscript"?e=1:i.vertAlign=="subscript"&&(e=2),t.write_shift(2,e),t.write_shift(1,i.underline||0),t.write_shift(1,i.family||0),t.write_shift(1,i.charset||0),t.write_shift(1,0),Ol(i.color,t);var n=0;return i.scheme=="major"&&(n=1),i.scheme=="minor"&&(n=2),t.write_shift(1,n),wi(i.name,t),t.length>t.l?t.slice(0,t.l):t}var RC=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],P0,NC=sr;function Gp(i,t){t||(t=ne(4*3+8*7+16*1)),P0||(P0=B0(RC));var e=P0[i.patternType];e==null&&(e=40),t.write_shift(4,e);var n=0;if(e!=40)for(Ol({auto:1},t),Ol({auto:1},t);n<12;++n)t.write_shift(4,0);else{for(;n<4;++n)t.write_shift(4,0);for(;n<12;++n)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function BC(i,t){var e=i.l+t,n=i.read_shift(2),r=i.read_shift(2);return i.l=e,{ixfe:n,numFmtId:r}}function Jh(i,t,e){e||(e=ne(16)),e.write_shift(2,t||0),e.write_shift(2,i.numFmtId||0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);var n=0;return e.write_shift(1,n),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(1,0),e}function Lo(i,t){return t||(t=ne(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var LC=sr;function VC(i,t){return t||(t=ne(51)),t.write_shift(1,0),Lo(null,t),Lo(null,t),Lo(null,t),Lo(null,t),Lo(null,t),t.length>t.l?t.slice(0,t.l):t}function UC(i,t){return t||(t=ne(12+4*10)),t.write_shift(4,i.xfId),t.write_shift(2,1),t.write_shift(1,+i.builtinId),t.write_shift(1,0),Al(i.name||"",t),t.length>t.l?t.slice(0,t.l):t}function jC(i,t,e){var n=ne(2052);return n.write_shift(4,i),Al(t,n),Al(e,n),n.length>n.l?n.slice(0,n.l):n}function WC(i,t){if(t){var e=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&++e}),e!=0&&(de(i,615,Un(e)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&de(i,44,AC(r,t[r]))}),de(i,616))}}function HC(i){var t=1;t!=0&&(de(i,611,Un(t)),de(i,43,DC({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),de(i,612))}function zC(i){var t=2;t!=0&&(de(i,603,Un(t)),de(i,45,Gp({patternType:"none"})),de(i,45,Gp({patternType:"gray125"})),de(i,604))}function $C(i){var t=1;t!=0&&(de(i,613,Un(t)),de(i,46,VC({})),de(i,614))}function GC(i){var t=1;de(i,626,Un(t)),de(i,47,Jh({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),de(i,627)}function qC(i,t){de(i,617,Un(t.length)),t.forEach(function(e){de(i,47,Jh(e,0))}),de(i,618)}function XC(i){var t=1;de(i,619,Un(t)),de(i,48,UC({xfId:0,builtinId:0,name:"Normal"})),de(i,620)}function KC(i){var t=0;de(i,505,Un(t)),de(i,506)}function YC(i){var t=0;de(i,508,jC(t,"TableStyleMedium9","PivotStyleMedium4")),de(i,509)}function QC(i,t){var e=en();return de(e,278),WC(e,i.SSF),HC(e,i),zC(e,i),$C(e,i),GC(e,i),qC(e,t.cellXfs),XC(e,i),KC(e,i),YC(e,i),de(e,279),e.end()}function Zh(i,t){if(t&&t.themeXLSX)return t.themeXLSX;if(i&&typeof i.raw=="string")return i.raw;var e=[pi];return e[e.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',e[e.length]="<a:themeElements>",e[e.length]='<a:clrScheme name="Office">',e[e.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',e[e.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',e[e.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',e[e.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',e[e.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',e[e.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',e[e.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',e[e.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',e[e.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',e[e.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',e[e.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',e[e.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',e[e.length]="</a:clrScheme>",e[e.length]='<a:fontScheme name="Office">',e[e.length]="<a:majorFont>",e[e.length]='<a:latin typeface="Cambria"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',e[e.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',e[e.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',e[e.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',e[e.length]='<a:font script="Arab" typeface="Times New Roman"/>',e[e.length]='<a:font script="Hebr" typeface="Times New Roman"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="MoolBoran"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Times New Roman"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:majorFont>",e[e.length]="<a:minorFont>",e[e.length]='<a:latin typeface="Calibri"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',e[e.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',e[e.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',e[e.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',e[e.length]='<a:font script="Arab" typeface="Arial"/>',e[e.length]='<a:font script="Hebr" typeface="Arial"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="DaunPenh"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Arial"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:minorFont>",e[e.length]="</a:fontScheme>",e[e.length]='<a:fmtScheme name="Office">',e[e.length]="<a:fillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="1"/>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="0"/>',e[e.length]="</a:gradFill>",e[e.length]="</a:fillStyleLst>",e[e.length]="<a:lnStyleLst>",e[e.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]="</a:lnStyleLst>",e[e.length]="<a:effectStyleLst>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',e[e.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',e[e.length]="</a:effectStyle>",e[e.length]="</a:effectStyleLst>",e[e.length]="<a:bgFillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]="</a:bgFillStyleLst>",e[e.length]="</a:fmtScheme>",e[e.length]="</a:themeElements>",e[e.length]="<a:objectDefaults>",e[e.length]="<a:spDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',e[e.length]="</a:spDef>",e[e.length]="<a:lnDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',e[e.length]="</a:lnDef>",e[e.length]="</a:objectDefaults>",e[e.length]="<a:extraClrSchemeLst/>",e[e.length]="</a:theme>",e.join("")}function JC(i,t){return{flags:i.read_shift(4),version:i.read_shift(4),name:Vi(i,t-8)}}function ZC(i){var t=ne(12+2*i.name.length);return t.write_shift(4,i.flags),t.write_shift(4,i.version),wi(i.name,t),t.slice(0,t.l)}function eS(i){for(var t=[],e=i.read_shift(4);e-- >0;)t.push([i.read_shift(4),i.read_shift(4)]);return t}function tS(i){var t=ne(4+8*i.length);t.write_shift(4,i.length);for(var e=0;e<i.length;++e)t.write_shift(4,i[e][0]),t.write_shift(4,i[e][1]);return t}function iS(i,t){var e=ne(8+2*t.length);return e.write_shift(4,i),wi(t,e),e.slice(0,e.l)}function nS(i){return i.l+=4,i.read_shift(4)!=0}function rS(i,t){var e=ne(8);return e.write_shift(4,i),e.write_shift(4,t?1:0),e}function aS(){var i=en();return de(i,332),de(i,334,Un(1)),de(i,335,ZC({name:"XLDAPR",version:12e4,flags:3496657072})),de(i,336),de(i,339,iS(1,"XLDAPR")),de(i,52),de(i,35,Un(514)),de(i,4096,Un(0)),de(i,4097,kn(1)),de(i,36),de(i,53),de(i,340),de(i,337,rS(1,!0)),de(i,51,tS([[1,0]])),de(i,338),de(i,333),i.end()}function eg(){var i=[pi];return i.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),i.join("")}function oS(i){var t={};t.i=i.read_shift(4);var e={};e.r=i.read_shift(4),e.c=i.read_shift(4),t.r=It(e);var n=i.read_shift(1);return n&2&&(t.l="1"),n&8&&(t.a="1"),t}var qa=1024;function tg(i,t){for(var e=[21600,21600],n=["m0,0l0",e[1],e[0],e[1],e[0],"0xe"].join(","),r=[ge("xml",null,{"xmlns:v":vn.v,"xmlns:o":vn.o,"xmlns:x":vn.x,"xmlns:mv":vn.mv}).replace(/\/>/,">"),ge("o:shapelayout",ge("o:idmap",null,{"v:ext":"edit",data:i}),{"v:ext":"edit"}),ge("v:shapetype",[ge("v:stroke",null,{joinstyle:"miter"}),ge("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:e.join(","),path:n})];qa<i*1e3;)qa+=1e3;return t.forEach(function(a){var o=Si(a[0]),u={color2:"#BEFF82",type:"gradient"};u.type=="gradient"&&(u.angle="-180");var m=u.type=="gradient"?ge("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,f=ge("v:fill",m,u),h={on:"t",obscured:"t"};++qa,r=r.concat(["<v:shape"+Ko({id:"_x0000_s"+qa,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(a[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",f,ge("v:shadow",null,h),ge("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Ai("x:Anchor",[o.c+1,0,o.r+1,0,o.c+3,20,o.r+5,20].join(",")),Ai("x:AutoFill","False"),Ai("x:Row",String(o.r)),Ai("x:Column",String(o.c)),a[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),r.push("</xml>"),r.join("")}function ig(i){var t=[pi,ge("comments",null,{xmlns:to[0]})],e=[];return t.push("<authors>"),i.forEach(function(n){n[1].forEach(function(r){var a=kt(r.a);e.indexOf(a)==-1&&(e.push(a),t.push("<author>"+a+"</author>")),r.T&&r.ID&&e.indexOf("tc="+r.ID)==-1&&(e.push("tc="+r.ID),t.push("<author>tc="+r.ID+"</author>"))})}),e.length==0&&(e.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),i.forEach(function(n){var r=0,a=[];if(n[1][0]&&n[1][0].T&&n[1][0].ID?r=e.indexOf("tc="+n[1][0].ID):n[1].forEach(function(m){m.a&&(r=e.indexOf(kt(m.a))),a.push(m.t||"")}),t.push('<comment ref="'+n[0]+'" authorId="'+r+'"><text>'),a.length<=1)t.push(Ai("t",kt(a[0]||"")));else{for(var o=`Comment:
    `+a[0]+`
`,u=1;u<a.length;++u)o+=`Reply:
    `+a[u]+`
`;t.push(Ai("t",kt(o)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function sS(i,t,e){var n=[pi,ge("ThreadedComments",null,{xmlns:Ci.TCMNT}).replace(/[\/]>/,">")];return i.forEach(function(r){var a="";(r[1]||[]).forEach(function(o,u){if(!o.T){delete o.ID;return}o.a&&t.indexOf(o.a)==-1&&t.push(o.a);var m={ref:r[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+e.tcid++).slice(-12)+"}"};u==0?a=m.id:m.parentId=a,o.ID=m.id,o.a&&(m.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(o.a)).slice(-12)+"}"),n.push(ge("threadedComment",Ai("text",o.t||""),m))})}),n.push("</ThreadedComments>"),n.join("")}function lS(i){var t=[pi,ge("personList",null,{xmlns:Ci.TCMNT,"xmlns:x":to[0]}).replace(/[\/]>/,">")];return i.forEach(function(e,n){t.push(ge("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:e,providerId:"None"}))}),t.push("</personList>"),t.join("")}function cS(i){var t={};t.iauthor=i.read_shift(4);var e=ma(i,16);return t.rfx=e.s,t.ref=It(e.s),i.l+=16,t}function dS(i,t){return t==null&&(t=ne(36)),t.write_shift(4,i[1].iauthor),ro(i[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var uS=Vi;function mS(i){return wi(i.slice(0,54))}function fS(i){var t=en(),e=[];return de(t,628),de(t,630),i.forEach(function(n){n[1].forEach(function(r){e.indexOf(r.a)>-1||(e.push(r.a.slice(0,54)),de(t,632,mS(r.a)))})}),de(t,631),de(t,633),i.forEach(function(n){n[1].forEach(function(r){r.iauthor=e.indexOf(r.a);var a={s:Si(n[0]),e:Si(n[0])};de(t,635,dS([a,r])),r.t&&r.t.length>0&&de(t,637,hy(r)),de(t,636),delete r.iauthor})}),de(t,634),de(t,629),t.end()}function pS(i,t){t.FullPaths.forEach(function(e,n){if(n!=0){var r=e.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");r.slice(-1)!=="/"&&At.utils.cfb_add(i,r,t.FileIndex[n].content)}})}var ng=["xlsb","xlsm","xlam","biff8","xla"];var hS=function(){var i=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function e(n,r,a,o){var u=!1,m=!1;a.length==0?m=!0:a.charAt(0)=="["&&(m=!0,a=a.slice(1,-1)),o.length==0?u=!0:o.charAt(0)=="["&&(u=!0,o=o.slice(1,-1));var f=a.length>0?parseInt(a,10)|0:0,h=o.length>0?parseInt(o,10)|0:0;return u?h+=t.c:--h,m?f+=t.r:--f,r+(u?"":"$")+Li(h)+(m?"":"$")+Oi(f)}return function(r,a){return t=a,r.replace(i,e)}}(),ed=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,td=function(){return function(t,e){return t.replace(ed,function(n,r,a,o,u,m){var f=X0(o)-(a?0:e.c),h=q0(m)-(u?0:e.r),g=h==0?"":u?h+1:"["+h+"]",v=f==0?"":a?f+1:"["+f+"]";return r+"R"+g+"C"+v})}}();function gS(i,t){return i.replace(ed,function(e,n,r,a,o,u){return n+(r=="$"?r+a:Li(X0(a)+t.c))+(o=="$"?o+u:Oi(q0(u)+t.r))})}function _S(i){return i.length!=1}function mi(i){i.l+=1}function Or(i,t){var e=i.read_shift(t==1?1:2);return[e&16383,e>>14&1,e>>15&1]}function rg(i,t,e){var n=2;if(e){if(e.biff>=2&&e.biff<=5)return ag(i,t,e);e.biff==12&&(n=4)}var r=i.read_shift(n),a=i.read_shift(n),o=Or(i,2),u=Or(i,2);return{s:{r,c:o[0],cRel:o[1],rRel:o[2]},e:{r:a,c:u[0],cRel:u[1],rRel:u[2]}}}function ag(i){var t=Or(i,2),e=Or(i,2),n=i.read_shift(1),r=i.read_shift(1);return{s:{r:t[0],c:n,cRel:t[1],rRel:t[2]},e:{r:e[0],c:r,cRel:e[1],rRel:e[2]}}}function vS(i,t,e){if(e.biff<8)return ag(i,t,e);var n=i.read_shift(e.biff==12?4:2),r=i.read_shift(e.biff==12?4:2),a=Or(i,2),o=Or(i,2);return{s:{r:n,c:a[0],cRel:a[1],rRel:a[2]},e:{r,c:o[0],cRel:o[1],rRel:o[2]}}}function og(i,t,e){if(e&&e.biff>=2&&e.biff<=5)return xS(i,t,e);var n=i.read_shift(e&&e.biff==12?4:2),r=Or(i,2);return{r:n,c:r[0],cRel:r[1],rRel:r[2]}}function xS(i){var t=Or(i,2),e=i.read_shift(1);return{r:t[0],c:e,cRel:t[1],rRel:t[2]}}function bS(i){var t=i.read_shift(2),e=i.read_shift(2);return{r:t,c:e&255,fQuoted:!!(e&16384),cRel:e>>15,rRel:e>>15}}function yS(i,t,e){var n=e&&e.biff?e.biff:8;if(n>=2&&n<=5)return CS(i,t,e);var r=i.read_shift(n>=12?4:2),a=i.read_shift(2),o=(a&16384)>>14,u=(a&32768)>>15;if(a&=16383,u==1)for(;r>524287;)r-=1048576;if(o==1)for(;a>8191;)a=a-16384;return{r,c:a,cRel:o,rRel:u}}function CS(i){var t=i.read_shift(2),e=i.read_shift(1),n=(t&32768)>>15,r=(t&16384)>>14;return t&=16383,n==1&&t>=8192&&(t=t-16384),r==1&&e>=128&&(e=e-256),{r:t,c:e,cRel:r,rRel:n}}function SS(i,t,e){var n=(i[i.l++]&96)>>5,r=rg(i,e.biff>=2&&e.biff<=5?6:8,e);return[n,r]}function wS(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2,"i"),a=8;if(e)switch(e.biff){case 5:i.l+=12,a=6;break;case 12:a=12;break}var o=rg(i,a,e);return[n,r,o]}function ES(i,t,e){var n=(i[i.l++]&96)>>5;return i.l+=e&&e.biff>8?12:e.biff<8?6:8,[n]}function TS(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2),a=8;if(e)switch(e.biff){case 5:i.l+=12,a=6;break;case 12:a=12;break}return i.l+=a,[n,r]}function PS(i,t,e){var n=(i[i.l++]&96)>>5,r=vS(i,t-1,e);return[n,r]}function kS(i,t,e){var n=(i[i.l++]&96)>>5;return i.l+=e.biff==2?6:e.biff==12?14:7,[n]}function qp(i){var t=i[i.l+1]&1,e=1;return i.l+=4,[t,e]}function IS(i,t,e){i.l+=2;for(var n=i.read_shift(e&&e.biff==2?1:2),r=[],a=0;a<=n;++a)r.push(i.read_shift(e&&e.biff==2?1:2));return r}function MS(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=2,[n,i.read_shift(e&&e.biff==2?1:2)]}function FS(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=2,[n,i.read_shift(e&&e.biff==2?1:2)]}function AS(i){var t=i[i.l+1]&255?1:0;return i.l+=2,[t,i.read_shift(2)]}function OS(i,t,e){var n=i[i.l+1]&255?1:0;return i.l+=e&&e.biff==2?3:4,[n]}function sg(i){var t=i.read_shift(1),e=i.read_shift(1);return[t,e]}function DS(i){return i.read_shift(2),sg(i,2)}function RS(i){return i.read_shift(2),sg(i,2)}function NS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=og(i,0,e);return[n,r]}function BS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=yS(i,0,e);return[n,r]}function LS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=i.read_shift(2);e&&e.biff==5&&(i.l+=12);var a=og(i,0,e);return[n,r,a]}function VS(i,t,e){var n=(i[i.l]&96)>>5;i.l+=1;var r=i.read_shift(e&&e.biff<=3?1:2);return[Vw[r],dg[r],n]}function US(i,t,e){var n=i[i.l++],r=i.read_shift(1),a=e&&e.biff<=3?[n==88?-1:0,i.read_shift(1)]:jS(i);return[r,(a[0]===0?dg:Lw)[a[1]]]}function jS(i){return[i[i.l+1]>>7,i.read_shift(2)&32767]}function WS(i,t,e){i.l+=e&&e.biff==2?3:4}function HS(i,t,e){if(i.l++,e&&e.biff==12)return[i.read_shift(4,"i"),0];var n=i.read_shift(2),r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function zS(i){return i.l++,es[i.read_shift(1)]}function $S(i){return i.l++,i.read_shift(2)}function GS(i){return i.l++,i.read_shift(1)!==0}function qS(i){return i.l++,ao(i,8)}function XS(i,t,e){return i.l++,Hh(i,t-1,e)}function KS(i,t){var e=[i.read_shift(1)];if(t==12)switch(e[0]){case 2:e[0]=4;break;case 4:e[0]=16;break;case 0:e[0]=1;break;case 1:e[0]=2;break}switch(e[0]){case 4:e[1]=Ly(i,1)?"TRUE":"FALSE",t!=12&&(i.l+=7);break;case 37:case 16:e[1]=es[i[i.l]],i.l+=t==12?4:8;break;case 0:i.l+=8;break;case 1:e[1]=ao(i,8);break;case 2:e[1]=Wy(i,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+e[0])}return e}function YS(i,t,e){for(var n=i.read_shift(e.biff==12?4:2),r=[],a=0;a!=n;++a)r.push((e.biff==12?ma:$y)(i,8));return r}function QS(i,t,e){var n=0,r=0;e.biff==12?(n=i.read_shift(4),r=i.read_shift(4)):(r=1+i.read_shift(1),n=1+i.read_shift(2)),e.biff>=2&&e.biff<8&&(--n,--r==0&&(r=256));for(var a=0,o=[];a!=n&&(o[a]=[]);++a)for(var u=0;u!=r;++u)o[a][u]=KS(i,e.biff);return o}function JS(i,t,e){var n=i.read_shift(1)>>>5&3,r=!e||e.biff>=8?4:2,a=i.read_shift(r);switch(e.biff){case 2:i.l+=5;break;case 3:case 4:i.l+=8;break;case 5:i.l+=12;break}return[n,0,a]}function ZS(i,t,e){if(e.biff==5)return ew(i,t,e);var n=i.read_shift(1)>>>5&3,r=i.read_shift(2),a=i.read_shift(4);return[n,r,a]}function ew(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2,"i");i.l+=8;var n=i.read_shift(2);return i.l+=12,[t,e,n]}function tw(i,t,e){var n=i.read_shift(1)>>>5&3;i.l+=e&&e.biff==2?3:4;var r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function iw(i,t,e){var n=i.read_shift(1)>>>5&3,r=i.read_shift(e&&e.biff==2?1:2);return[n,r]}function nw(i,t,e){var n=i.read_shift(1)>>>5&3;return i.l+=4,e.biff<8&&i.l--,e.biff==12&&(i.l+=2),[n]}function rw(i,t,e){var n=(i[i.l++]&96)>>5,r=i.read_shift(2),a=4;if(e)switch(e.biff){case 5:a=15;break;case 12:a=6;break}return i.l+=a,[n,r]}var aw=sr,ow=sr,sw=sr;function ts(i,t,e){return i.l+=2,[bS(i,4,e)]}function id(i){return i.l+=6,[]}var lw=ts,cw=id,dw=id,uw=ts;function lg(i){return i.l+=2,[jh(i),i.read_shift(2)&1]}var mw=ts,fw=lg,pw=id,hw=ts,gw=ts,_w=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function vw(i){i.l+=2;var t=i.read_shift(2),e=i.read_shift(2),n=i.read_shift(4),r=i.read_shift(2),a=i.read_shift(2),o=_w[e>>2&31];return{ixti:t,coltype:e&3,rt:o,idx:n,c:r,C:a}}function xw(i){return i.l+=2,[i.read_shift(4)]}function bw(i,t,e){return i.l+=5,i.l+=2,i.l+=e.biff==2?1:4,["PTGSHEET"]}function yw(i,t,e){return i.l+=e.biff==2?4:5,["PTGENDSHEET"]}function Cw(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2);return[t,e]}function Sw(i){var t=i.read_shift(1)>>>5&3,e=i.read_shift(2);return[t,e]}function ww(i){return i.l+=4,[0,0]}var Xp={1:{n:"PtgExp",f:HS},2:{n:"PtgTbl",f:sw},3:{n:"PtgAdd",f:mi},4:{n:"PtgSub",f:mi},5:{n:"PtgMul",f:mi},6:{n:"PtgDiv",f:mi},7:{n:"PtgPower",f:mi},8:{n:"PtgConcat",f:mi},9:{n:"PtgLt",f:mi},10:{n:"PtgLe",f:mi},11:{n:"PtgEq",f:mi},12:{n:"PtgGe",f:mi},13:{n:"PtgGt",f:mi},14:{n:"PtgNe",f:mi},15:{n:"PtgIsect",f:mi},16:{n:"PtgUnion",f:mi},17:{n:"PtgRange",f:mi},18:{n:"PtgUplus",f:mi},19:{n:"PtgUminus",f:mi},20:{n:"PtgPercent",f:mi},21:{n:"PtgParen",f:mi},22:{n:"PtgMissArg",f:mi},23:{n:"PtgStr",f:XS},26:{n:"PtgSheet",f:bw},27:{n:"PtgEndSheet",f:yw},28:{n:"PtgErr",f:zS},29:{n:"PtgBool",f:GS},30:{n:"PtgInt",f:$S},31:{n:"PtgNum",f:qS},32:{n:"PtgArray",f:kS},33:{n:"PtgFunc",f:VS},34:{n:"PtgFuncVar",f:US},35:{n:"PtgName",f:JS},36:{n:"PtgRef",f:NS},37:{n:"PtgArea",f:SS},38:{n:"PtgMemArea",f:tw},39:{n:"PtgMemErr",f:aw},40:{n:"PtgMemNoMem",f:ow},41:{n:"PtgMemFunc",f:iw},42:{n:"PtgRefErr",f:nw},43:{n:"PtgAreaErr",f:ES},44:{n:"PtgRefN",f:BS},45:{n:"PtgAreaN",f:PS},46:{n:"PtgMemAreaN",f:Cw},47:{n:"PtgMemNoMemN",f:Sw},57:{n:"PtgNameX",f:ZS},58:{n:"PtgRef3d",f:LS},59:{n:"PtgArea3d",f:wS},60:{n:"PtgRefErr3d",f:rw},61:{n:"PtgAreaErr3d",f:TS},255:{}},Ew={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Tw={1:{n:"PtgElfLel",f:lg},2:{n:"PtgElfRw",f:hw},3:{n:"PtgElfCol",f:lw},6:{n:"PtgElfRwV",f:gw},7:{n:"PtgElfColV",f:uw},10:{n:"PtgElfRadical",f:mw},11:{n:"PtgElfRadicalS",f:pw},13:{n:"PtgElfColS",f:cw},15:{n:"PtgElfColSV",f:dw},16:{n:"PtgElfRadicalLel",f:fw},25:{n:"PtgList",f:vw},29:{n:"PtgSxName",f:xw},255:{}},Pw={0:{n:"PtgAttrNoop",f:ww},1:{n:"PtgAttrSemi",f:OS},2:{n:"PtgAttrIf",f:FS},4:{n:"PtgAttrChoose",f:IS},8:{n:"PtgAttrGoto",f:MS},16:{n:"PtgAttrSum",f:WS},32:{n:"PtgAttrBaxcel",f:qp},33:{n:"PtgAttrBaxcel",f:qp},64:{n:"PtgAttrSpace",f:DS},65:{n:"PtgAttrSpaceSemi",f:RS},128:{n:"PtgAttrIfError",f:AS},255:{}};function kw(i,t,e,n){if(n.biff<8)return sr(i,t);for(var r=i.l+t,a=[],o=0;o!==e.length;++o)switch(e[o][0]){case"PtgArray":e[o][1]=QS(i,0,n),a.push(e[o][1]);break;case"PtgMemArea":e[o][2]=YS(i,e[o][1],n),a.push(e[o][2]);break;case"PtgExp":n&&n.biff==12&&(e[o][1][1]=i.read_shift(4),a.push(e[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+e[o][0];default:break}return t=r-i.l,t!==0&&a.push(sr(i,t)),a}function Iw(i,t,e){for(var n=i.l+t,r,a,o=[];n!=i.l;)t=n-i.l,a=i[i.l],r=Xp[a]||Xp[Ew[a]],(a===24||a===25)&&(r=(a===24?Tw:Pw)[i[i.l+1]]),!r||!r.f?sr(i,t):o.push([r.n,r.f(i,t,e)]);return o}function Mw(i){for(var t=[],e=0;e<i.length;++e){for(var n=i[e],r=[],a=0;a<n.length;++a){var o=n[a];if(o)switch(o[0]){case 2:r.push('"'+o[1].replace(/"/g,'""')+'"');break;default:r.push(o[1])}else r.push("")}t.push(r.join(","))}return t.join(";")}var Fw={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function Aw(i,t){if(!i&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(i)?"'"+i+"'":i}function cg(i,t,e){if(!i)return"SH33TJSERR0";if(e.biff>8&&(!i.XTI||!i.XTI[t]))return i.SheetNames[t];if(!i.XTI)return"SH33TJSERR6";var n=i.XTI[t];if(e.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":i.XTI[t-1];if(!n)return"SH33TJSERR1";var r="";if(e.biff>8)switch(i[n[0]][0]){case 357:return r=n[1]==-1?"#REF":i.SheetNames[n[1]],n[1]==n[2]?r:r+":"+i.SheetNames[n[2]];case 358:return e.SID!=null?i.SheetNames[e.SID]:"SH33TJSSAME"+i[n[0]][0];case 355:default:return"SH33TJSSRC"+i[n[0]][0]}switch(i[n[0]][0][0]){case 1025:return r=n[1]==-1?"#REF":i.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?r:r+":"+i.SheetNames[n[2]];case 14849:return i[n[0]].slice(1).map(function(a){return a.Name}).join(";;");default:return i[n[0]][0][3]?(r=n[1]==-1?"#REF":i[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?r:r+":"+i[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function Kp(i,t,e){var n=cg(i,t,e);return n=="#REF"?n:Aw(n,e)}function eo(i,t,e,n,r){var a=r&&r.biff||8,o={s:{c:0,r:0},e:{c:0,r:0}},u=[],m,f,h,g=0,v=0,b,w="";if(!i[0]||!i[0][0])return"";for(var x=-1,C="",U=0,j=i[0].length;U<j;++U){var H=i[0][U];switch(H[0]){case"PtgUminus":u.push("-"+u.pop());break;case"PtgUplus":u.push("+"+u.pop());break;case"PtgPercent":u.push(u.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(m=u.pop(),f=u.pop(),x>=0){switch(i[0][x][1][0]){case 0:C=ii(" ",i[0][x][1][1]);break;case 1:C=ii("\r",i[0][x][1][1]);break;default:if(C="",r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+i[0][x][1][0])}f=f+C,x=-1}u.push(f+Fw[H[0]]+m);break;case"PtgIsect":m=u.pop(),f=u.pop(),u.push(f+" "+m);break;case"PtgUnion":m=u.pop(),f=u.pop(),u.push(f+","+m);break;case"PtgRange":m=u.pop(),f=u.pop(),u.push(f+":"+m);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":h=Wo(H[1][1],o,r),u.push(Ho(h,a));break;case"PtgRefN":h=e?Wo(H[1][1],e,r):H[1][1],u.push(Ho(h,a));break;case"PtgRef3d":g=H[1][1],h=Wo(H[1][2],o,r),w=Kp(n,g,r);var K=w;u.push(w+"!"+Ho(h,a));break;case"PtgFunc":case"PtgFuncVar":var ce=H[1][0],we=H[1][1];ce||(ce=0),ce&=127;var W=ce==0?[]:u.slice(-ce);u.length-=ce,we==="User"&&(we=W.shift()),u.push(we+"("+W.join(",")+")");break;case"PtgBool":u.push(H[1]?"TRUE":"FALSE");break;case"PtgInt":u.push(H[1]);break;case"PtgNum":u.push(String(H[1]));break;case"PtgStr":u.push('"'+H[1].replace(/"/g,'""')+'"');break;case"PtgErr":u.push(H[1]);break;case"PtgAreaN":b=Op(H[1][1],e?{s:e}:o,r),u.push(E0(b,r));break;case"PtgArea":b=Op(H[1][1],o,r),u.push(E0(b,r));break;case"PtgArea3d":g=H[1][1],b=H[1][2],w=Kp(n,g,r),u.push(w+"!"+E0(b,r));break;case"PtgAttrSum":u.push("SUM("+u.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":v=H[1][2];var se=(n.names||[])[v-1]||(n[0]||[])[v],ee=se?se.Name:"SH33TJSNAME"+String(v);ee&&ee.slice(0,6)=="_xlfn."&&!r.xlfn&&(ee=ee.slice(6)),u.push(ee);break;case"PtgNameX":var le=H[1][1];v=H[1][2];var ue;if(r.biff<=5)le<0&&(le=-le),n[le]&&(ue=n[le][v]);else{var me="";if(((n[le]||[])[0]||[])[0]==14849||(((n[le]||[])[0]||[])[0]==1025?n[le][v]&&n[le][v].itab>0&&(me=n.SheetNames[n[le][v].itab-1]+"!"):me=n.SheetNames[v-1]+"!"),n[le]&&n[le][v])me+=n[le][v].Name;else if(n[0]&&n[0][v])me+=n[0][v].Name;else{var Me=(cg(n,le,r)||"").split(";;");Me[v-1]?me=Me[v-1]:me+="SH33TJSERRX"}u.push(me);break}ue||(ue={Name:"SH33TJSERRY"}),u.push(ue.Name);break;case"PtgParen":var mt="(",De=")";if(x>=0){switch(C="",i[0][x][1][0]){case 2:mt=ii(" ",i[0][x][1][1])+mt;break;case 3:mt=ii("\r",i[0][x][1][1])+mt;break;case 4:De=ii(" ",i[0][x][1][1])+De;break;case 5:De=ii("\r",i[0][x][1][1])+De;break;default:if(r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+i[0][x][1][0])}x=-1}u.push(mt+u.pop()+De);break;case"PtgRefErr":u.push("#REF!");break;case"PtgRefErr3d":u.push("#REF!");break;case"PtgExp":h={c:H[1][1],r:H[1][0]};var be={c:e.c,r:e.r};if(n.sharedf[It(h)]){var Ee=n.sharedf[It(h)];u.push(eo(Ee,o,be,n,r))}else{var ke=!1;for(m=0;m!=n.arrayf.length;++m)if(f=n.arrayf[m],!(h.c<f[0].s.c||h.c>f[0].e.c)&&!(h.r<f[0].s.r||h.r>f[0].e.r)){u.push(eo(f[1],o,be,n,r)),ke=!0;break}ke||u.push(H[1])}break;case"PtgArray":u.push("{"+Mw(H[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":x=U;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":u.push("");break;case"PtgAreaErr":u.push("#REF!");break;case"PtgAreaErr3d":u.push("#REF!");break;case"PtgList":u.push("Table"+H[1].idx+"[#"+H[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(H));default:throw new Error("Unrecognized Formula Token: "+String(H))}var Ue=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(r.biff!=3&&x>=0&&Ue.indexOf(i[0][U][0])==-1){H=i[0][x];var et=!0;switch(H[1][0]){case 4:et=!1;case 0:C=ii(" ",H[1][1]);break;case 5:et=!1;case 1:C=ii("\r",H[1][1]);break;default:if(C="",r.WTF)throw new Error("Unexpected PtgAttrSpaceType "+H[1][0])}u.push((et?C:"")+u.pop()+(et?"":C)),x=-1}}if(u.length>1&&r.WTF)throw new Error("bad formula stack");return u[0]}function Ow(i){if(i==null){var t=ne(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof i=="number")return oa(i);return oa(0)}function Dw(i,t,e,n,r){var a=sa(t,e,r),o=Ow(i.v),u=ne(6),m=33;u.write_shift(2,m),u.write_shift(4,0);for(var f=ne(i.bf.length),h=0;h<i.bf.length;++h)f[h]=i.bf[h];var g=Fi([a,o,u,f]);return g}function Gl(i,t,e){var n=i.read_shift(4),r=Iw(i,n,e),a=i.read_shift(4),o=a>0?kw(i,a,r,e):null;return[r,o]}var Rw=Gl,ql=Gl,Nw=Gl,Bw=Gl,Lw={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},dg={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Vw={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Uw(i){var t="of:="+i.replace(ed,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function jw(i){return i.replace(/\./,"!")}var zo=typeof Map<"u";function nd(i,t,e){var n=0,r=i.length;if(e){if(zo?e.has(t):Object.prototype.hasOwnProperty.call(e,t)){for(var a=zo?e.get(t):e[t];n<a.length;++n)if(i[a[n]].t===t)return i.Count++,a[n]}}else for(;n<r;++n)if(i[n].t===t)return i.Count++,n;return i[r]={t},i.Count++,i.Unique++,e&&(zo?(e.has(t)||e.set(t,[]),e.get(t).push(r)):(Object.prototype.hasOwnProperty.call(e,t)||(e[t]=[]),e[t].push(r))),r}function Xl(i,t){var e={min:i+1,max:i+1},n=-1;return t.MDW&&(gr=t.MDW),t.width!=null?e.customWidth=1:t.wpx!=null?n=Nl(t.wpx):t.wch!=null&&(n=t.wch),n>-1?(e.width=D0(n),e.customWidth=1):t.width!=null&&(e.width=t.width),t.hidden&&(e.hidden=!0),t.level!=null&&(e.outlineLevel=e.level=t.level),e}function ug(i,t){if(i){var e=[.7,.7,.75,.75,.3,.3];t=="xlml"&&(e=[1,1,1,1,.5,.5]),i.left==null&&(i.left=e[0]),i.right==null&&(i.right=e[1]),i.top==null&&(i.top=e[2]),i.bottom==null&&(i.bottom=e[3]),i.header==null&&(i.header=e[4]),i.footer==null&&(i.footer=e[5])}}function Rr(i,t,e){var n=e.revssf[t.z!=null?t.z:"General"],r=60,a=i.length;if(n==null&&e.ssf){for(;r<392;++r)if(e.ssf[r]==null){uh(t.z,r),e.ssf[r]=t.z,e.revssf[t.z]=n=r;break}}for(r=0;r!=a;++r)if(i[r].numFmtId===n)return r;return i[a]={numFmtId:n,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},a}function Ww(i,t,e){if(i&&i["!ref"]){var n=zt(i["!ref"]);if(n.e.c<n.s.c||n.e.r<n.s.r)throw new Error("Bad range ("+e+"): "+i["!ref"])}}function Hw(i){if(i.length===0)return"";for(var t='<mergeCells count="'+i.length+'">',e=0;e!=i.length;++e)t+='<mergeCell ref="'+fi(i[e])+'"/>';return t+"</mergeCells>"}function zw(i,t,e,n,r){var a=!1,o={},u=null;if(n.bookType!=="xlsx"&&t.vbaraw){var m=t.SheetNames[e];try{t.Workbook&&(m=t.Workbook.Sheets[e].CodeName||m)}catch{}a=!0,o.codeName=fr(kt(m))}if(i&&i["!outline"]){var f={summaryBelow:1,summaryRight:1};i["!outline"].above&&(f.summaryBelow=0),i["!outline"].left&&(f.summaryRight=0),u=(u||"")+ge("outlinePr",null,f)}!a&&!u||(r[r.length]=ge("sheetPr",u,o))}var $w=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Gw=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function qw(i){var t={sheet:1};return $w.forEach(function(e){i[e]!=null&&i[e]&&(t[e]="1")}),Gw.forEach(function(e){i[e]!=null&&!i[e]&&(t[e]="0")}),i.password&&(t.password=Xh(i.password).toString(16).toUpperCase()),ge("sheetProtection",null,t)}function Xw(i){return ug(i),ge("pageMargins",null,i)}function Kw(i,t){for(var e=["<cols>"],n,r=0;r!=t.length;++r)(n=t[r])&&(e[e.length]=ge("col",null,Xl(r,n)));return e[e.length]="</cols>",e.join("")}function Yw(i,t,e,n){var r=typeof i.ref=="string"?i.ref:fi(i.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var a=e.Workbook.Names,o=xn(r);o.s.r==o.e.r&&(o.e.r=xn(t["!ref"]).e.r,r=fi(o));for(var u=0;u<a.length;++u){var m=a[u];if(m.Name=="_xlnm._FilterDatabase"&&m.Sheet==n){m.Ref="'"+e.SheetNames[n]+"'!"+r;break}}return u==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+e.SheetNames[n]+"'!"+r}),ge("autoFilter",null,{ref:r})}function Qw(i,t,e,n){var r={workbookViewId:"0"};return(((n||{}).Workbook||{}).Views||[])[0]&&(r.rightToLeft=n.Workbook.Views[0].RTL?"1":"0"),ge("sheetViews",ge("sheetView",null,r),{})}function Jw(i,t,e,n){if(i.c&&e["!comments"].push([t,i.c]),i.v===void 0&&typeof i.f!="string"||i.t==="z"&&!i.f)return"";var r="",a=i.t,o=i.v;if(i.t!=="z")switch(i.t){case"b":r=i.v?"1":"0";break;case"n":r=""+i.v;break;case"e":r=es[i.v];break;case"d":n&&n.cellDates?r=Gi(i.v,-1).toISOString():(i=nn(i),i.t="n",r=""+(i.v=tn(Gi(i.v)))),typeof i.z>"u"&&(i.z=ni[14]);break;default:r=i.v;break}var u=Ai("v",kt(r)),m={r:t},f=Rr(n.cellXfs,i,n);switch(f!==0&&(m.s=f),i.t){case"n":break;case"d":m.t="d";break;case"b":m.t="b";break;case"e":m.t="e";break;case"z":break;default:if(i.v==null){delete i.t;break}if(i.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(n&&n.bookSST){u=Ai("v",""+nd(n.Strings,i.v,n.revStrings)),m.t="s";break}m.t="str";break}if(i.t!=a&&(i.t=a,i.v=o),typeof i.f=="string"&&i.f){var h=i.F&&i.F.slice(0,t.length)==t?{t:"array",ref:i.F}:null;u=ge("f",kt(i.f),h)+(i.v!=null?u:"")}return i.l&&e["!links"].push([t,i.l]),i.D&&(m.cm=1),ge("c",u,m)}function Zw(i,t,e,n){var r=[],a=[],o=zt(i["!ref"]),u="",m,f="",h=[],g=0,v=0,b=i["!rows"],w=Array.isArray(i),x={r:f},C,U=-1;for(v=o.s.c;v<=o.e.c;++v)h[v]=Li(v);for(g=o.s.r;g<=o.e.r;++g){for(a=[],f=Oi(g),v=o.s.c;v<=o.e.c;++v){m=h[v]+f;var j=w?(i[g]||[])[v]:i[m];j!==void 0&&(u=Jw(j,m,i,t,e,n))!=null&&a.push(u)}(a.length>0||b&&b[g])&&(x={r:f},b&&b[g]&&(C=b[g],C.hidden&&(x.hidden=1),U=-1,C.hpx?U=Bl(C.hpx):C.hpt&&(U=C.hpt),U>-1&&(x.ht=U,x.customHeight=1),C.level&&(x.outlineLevel=C.level)),r[r.length]=ge("row",a.join(""),x))}if(b)for(;g<b.length;++g)b&&b[g]&&(x={r:g+1},C=b[g],C.hidden&&(x.hidden=1),U=-1,C.hpx?U=Bl(C.hpx):C.hpt&&(U=C.hpt),U>-1&&(x.ht=U,x.customHeight=1),C.level&&(x.outlineLevel=C.level),r[r.length]=ge("row","",x));return r.join("")}function mg(i,t,e,n){var r=[pi,ge("worksheet",null,{xmlns:to[0],"xmlns:r":Ci.r})],a=e.SheetNames[i],o=0,u="",m=e.Sheets[a];m==null&&(m={});var f=m["!ref"]||"A1",h=zt(f);if(h.e.c>16383||h.e.r>1048575){if(t.WTF)throw new Error("Range "+f+" exceeds format limit A1:XFD1048576");h.e.c=Math.min(h.e.c,16383),h.e.r=Math.min(h.e.c,1048575),f=fi(h)}n||(n={}),m["!comments"]=[];var g=[];zw(m,e,i,t,r),r[r.length]=ge("dimension",null,{ref:f}),r[r.length]=Qw(m,t,i,e),t.sheetFormat&&(r[r.length]=ge("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),m["!cols"]!=null&&m["!cols"].length>0&&(r[r.length]=Kw(m,m["!cols"])),r[o=r.length]="<sheetData/>",m["!links"]=[],m["!ref"]!=null&&(u=Zw(m,t,i,e,n),u.length>0&&(r[r.length]=u)),r.length>o+1&&(r[r.length]="</sheetData>",r[o]=r[o].replace("/>",">")),m["!protect"]&&(r[r.length]=qw(m["!protect"])),m["!autofilter"]!=null&&(r[r.length]=Yw(m["!autofilter"],m,e,i)),m["!merges"]!=null&&m["!merges"].length>0&&(r[r.length]=Hw(m["!merges"]));var v=-1,b,w=-1;return m["!links"].length>0&&(r[r.length]="<hyperlinks>",m["!links"].forEach(function(x){x[1].Target&&(b={ref:x[0]},x[1].Target.charAt(0)!="#"&&(w=Pt(n,-1,kt(x[1].Target).replace(/#.*$/,""),vt.HLINK),b["r:id"]="rId"+w),(v=x[1].Target.indexOf("#"))>-1&&(b.location=kt(x[1].Target.slice(v+1))),x[1].Tooltip&&(b.tooltip=kt(x[1].Tooltip)),r[r.length]=ge("hyperlink",null,b))}),r[r.length]="</hyperlinks>"),delete m["!links"],m["!margins"]!=null&&(r[r.length]=Xw(m["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(r[r.length]=Ai("ignoredErrors",ge("ignoredError",null,{numberStoredAsText:1,sqref:f}))),g.length>0&&(w=Pt(n,-1,"../drawings/drawing"+(i+1)+".xml",vt.DRAW),r[r.length]=ge("drawing",null,{"r:id":"rId"+w}),m["!drawing"]=g),m["!comments"].length>0&&(w=Pt(n,-1,"../drawings/vmlDrawing"+(i+1)+".vml",vt.VML),r[r.length]=ge("legacyDrawing",null,{"r:id":"rId"+w}),m["!legacy"]=w),r.length>1&&(r[r.length]="</worksheet>",r[1]=r[1].replace("/>",">")),r.join("")}function eE(i,t){var e={},n=i.l+t;e.r=i.read_shift(4),i.l+=4;var r=i.read_shift(2);i.l+=1;var a=i.read_shift(1);return i.l=n,a&7&&(e.level=a&7),a&16&&(e.hidden=!0),a&32&&(e.hpt=r/20),e}function tE(i,t,e){var n=ne(145),r=(e["!rows"]||[])[i]||{};n.write_shift(4,i),n.write_shift(4,0);var a=320;r.hpx?a=Bl(r.hpx)*20:r.hpt&&(a=r.hpt*20),n.write_shift(2,a),n.write_shift(1,0);var o=0;r.level&&(o|=r.level),r.hidden&&(o|=16),(r.hpx||r.hpt)&&(o|=32),n.write_shift(1,o),n.write_shift(1,0);var u=0,m=n.l;n.l+=4;for(var f={r:i,c:0},h=0;h<16;++h)if(!(t.s.c>h+1<<10||t.e.c<h<<10)){for(var g=-1,v=-1,b=h<<10;b<h+1<<10;++b){f.c=b;var w=Array.isArray(e)?(e[f.r]||[])[f.c]:e[It(f)];w&&(g<0&&(g=b),v=b)}g<0||(++u,n.write_shift(4,g),n.write_shift(4,v))}var x=n.l;return n.l=m,n.write_shift(4,u),n.l=x,n.length>n.l?n.slice(0,n.l):n}function iE(i,t,e,n){var r=tE(n,e,t);(r.length>17||(t["!rows"]||[])[n])&&de(i,0,r)}var nE=ma,rE=ro;function aE(){}function oE(i,t){var e={},n=i[i.l];return++i.l,e.above=!(n&64),e.left=!(n&128),i.l+=18,e.name=gy(i,t-19),e}function sE(i,t,e){e==null&&(e=ne(84+4*i.length));var n=192;t&&(t.above&&(n&=-65),t.left&&(n&=-129)),e.write_shift(1,n);for(var r=1;r<3;++r)e.write_shift(1,0);return Ol({auto:1},e),e.write_shift(-4,-1),e.write_shift(-4,-1),Ph(i,e),e.slice(0,e.l)}function lE(i){var t=In(i);return[t]}function cE(i,t,e){return e==null&&(e=ne(8)),ca(t,e)}function dE(i){var t=da(i);return[t]}function uE(i,t,e){return e==null&&(e=ne(4)),ua(t,e)}function mE(i){var t=In(i),e=i.read_shift(1);return[t,e,"b"]}function fE(i,t,e){return e==null&&(e=ne(9)),ca(t,e),e.write_shift(1,i.v?1:0),e}function pE(i){var t=da(i),e=i.read_shift(1);return[t,e,"b"]}function hE(i,t,e){return e==null&&(e=ne(5)),ua(t,e),e.write_shift(1,i.v?1:0),e}function gE(i){var t=In(i),e=i.read_shift(1);return[t,e,"e"]}function _E(i,t,e){return e==null&&(e=ne(9)),ca(t,e),e.write_shift(1,i.v),e}function vE(i){var t=da(i),e=i.read_shift(1);return[t,e,"e"]}function xE(i,t,e){return e==null&&(e=ne(8)),ua(t,e),e.write_shift(1,i.v),e.write_shift(2,0),e.write_shift(1,0),e}function bE(i){var t=In(i),e=i.read_shift(4);return[t,e,"s"]}function yE(i,t,e){return e==null&&(e=ne(12)),ca(t,e),e.write_shift(4,t.v),e}function CE(i){var t=da(i),e=i.read_shift(4);return[t,e,"s"]}function SE(i,t,e){return e==null&&(e=ne(8)),ua(t,e),e.write_shift(4,t.v),e}function wE(i){var t=In(i),e=ao(i);return[t,e,"n"]}function EE(i,t,e){return e==null&&(e=ne(16)),ca(t,e),oa(i.v,e),e}function TE(i){var t=da(i),e=ao(i);return[t,e,"n"]}function PE(i,t,e){return e==null&&(e=ne(12)),ua(t,e),oa(i.v,e),e}function kE(i){var t=In(i),e=kh(i);return[t,e,"n"]}function IE(i,t,e){return e==null&&(e=ne(12)),ca(t,e),Ih(i.v,e),e}function ME(i){var t=da(i),e=kh(i);return[t,e,"n"]}function FE(i,t,e){return e==null&&(e=ne(8)),ua(t,e),Ih(i.v,e),e}function AE(i){var t=In(i),e=K0(i);return[t,e,"is"]}function OE(i){var t=In(i),e=Vi(i);return[t,e,"str"]}function DE(i,t,e){return e==null&&(e=ne(12+4*i.v.length)),ca(t,e),wi(i.v,e),e.length>e.l?e.slice(0,e.l):e}function RE(i){var t=da(i),e=Vi(i);return[t,e,"str"]}function NE(i,t,e){return e==null&&(e=ne(8+4*i.v.length)),ua(t,e),wi(i.v,e),e.length>e.l?e.slice(0,e.l):e}function BE(i,t,e){var n=i.l+t,r=In(i);r.r=e["!row"];var a=i.read_shift(1),o=[r,a,"b"];if(e.cellFormula){i.l+=2;var u=ql(i,n-i.l,e);o[3]=eo(u,null,r,e.supbooks,e)}else i.l=n;return o}function LE(i,t,e){var n=i.l+t,r=In(i);r.r=e["!row"];var a=i.read_shift(1),o=[r,a,"e"];if(e.cellFormula){i.l+=2;var u=ql(i,n-i.l,e);o[3]=eo(u,null,r,e.supbooks,e)}else i.l=n;return o}function VE(i,t,e){var n=i.l+t,r=In(i);r.r=e["!row"];var a=ao(i),o=[r,a,"n"];if(e.cellFormula){i.l+=2;var u=ql(i,n-i.l,e);o[3]=eo(u,null,r,e.supbooks,e)}else i.l=n;return o}function UE(i,t,e){var n=i.l+t,r=In(i);r.r=e["!row"];var a=Vi(i),o=[r,a,"str"];if(e.cellFormula){i.l+=2;var u=ql(i,n-i.l,e);o[3]=eo(u,null,r,e.supbooks,e)}else i.l=n;return o}var jE=ma,WE=ro;function HE(i,t){return t==null&&(t=ne(4)),t.write_shift(4,i),t}function zE(i,t){var e=i.l+t,n=ma(i,16),r=Y0(i),a=Vi(i),o=Vi(i),u=Vi(i);i.l=e;var m={rfx:n,relId:r,loc:a,display:u};return o&&(m.Tooltip=o),m}function $E(i,t){var e=ne(50+4*(i[1].Target.length+(i[1].Tooltip||"").length));ro({s:Si(i[0]),e:Si(i[0])},e),Q0("rId"+t,e);var n=i[1].Target.indexOf("#"),r=n==-1?"":i[1].Target.slice(n+1);return wi(r||"",e),wi(i[1].Tooltip||"",e),wi("",e),e.slice(0,e.l)}function GE(){}function qE(i,t,e){var n=i.l+t,r=Mh(i,16),a=i.read_shift(1),o=[r];if(o[2]=a,e.cellFormula){var u=Rw(i,n-i.l,e);o[1]=u}else i.l=n;return o}function XE(i,t,e){var n=i.l+t,r=ma(i,16),a=[r];if(e.cellFormula){var o=Bw(i,n-i.l,e);a[1]=o,i.l=n}else i.l=n;return a}function KE(i,t,e){e==null&&(e=ne(18));var n=Xl(i,t);e.write_shift(-4,i),e.write_shift(-4,i),e.write_shift(4,(n.width||10)*256),e.write_shift(4,0);var r=0;return t.hidden&&(r|=1),typeof n.width=="number"&&(r|=2),t.level&&(r|=t.level<<8),e.write_shift(2,r),e}var fg=["left","right","top","bottom","header","footer"];function YE(i){var t={};return fg.forEach(function(e){t[e]=ao(i,8)}),t}function QE(i,t){return t==null&&(t=ne(6*8)),ug(i),fg.forEach(function(e){oa(i[e],t)}),t}function JE(i){var t=i.read_shift(2);return i.l+=28,{RTL:t&32}}function ZE(i,t,e){e==null&&(e=ne(30));var n=924;return(((t||{}).Views||[])[0]||{}).RTL&&(n|=32),e.write_shift(2,n),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,100),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(4,0),e}function e3(i){var t=ne(24);return t.write_shift(4,4),t.write_shift(4,1),ro(i,t),t}function t3(i,t){return t==null&&(t=ne(16*4+2)),t.write_shift(2,i.password?Xh(i.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(e){e[1]?t.write_shift(4,i[e[0]]!=null&&!i[e[0]]?1:0):t.write_shift(4,i[e[0]]!=null&&i[e[0]]?0:1)}),t}function i3(){}function n3(){}function r3(i,t,e,n,r,a,o){if(t.v===void 0)return!1;var u="";switch(t.t){case"b":u=t.v?"1":"0";break;case"d":t=nn(t),t.z=t.z||ni[14],t.v=tn(Gi(t.v)),t.t="n";break;case"n":case"e":u=""+t.v;break;default:u=t.v;break}var m={r:e,c:n};switch(m.s=Rr(r.cellXfs,t,r),t.l&&a["!links"].push([It(m),t.l]),t.c&&a["!comments"].push([It(m),t.c]),t.t){case"s":case"str":return r.bookSST?(u=nd(r.Strings,t.v,r.revStrings),m.t="s",m.v=u,o?de(i,18,SE(t,m)):de(i,7,yE(t,m))):(m.t="str",o?de(i,17,NE(t,m)):de(i,6,DE(t,m))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?o?de(i,13,FE(t,m)):de(i,2,IE(t,m)):o?de(i,16,PE(t,m)):de(i,5,EE(t,m)),!0;case"b":return m.t="b",o?de(i,15,hE(t,m)):de(i,4,fE(t,m)),!0;case"e":return m.t="e",o?de(i,14,xE(t,m)):de(i,3,_E(t,m)),!0}return o?de(i,12,uE(t,m)):de(i,1,cE(t,m)),!0}function a3(i,t,e,n){var r=zt(t["!ref"]||"A1"),a,o="",u=[];de(i,145);var m=Array.isArray(t),f=r.e.r;t["!rows"]&&(f=Math.max(r.e.r,t["!rows"].length-1));for(var h=r.s.r;h<=f;++h){o=Oi(h),iE(i,t,r,h);var g=!1;if(h<=r.e.r)for(var v=r.s.c;v<=r.e.c;++v){h===r.s.r&&(u[v]=Li(v)),a=u[v]+o;var b=m?(t[h]||[])[v]:t[a];if(!b){g=!1;continue}g=r3(i,b,h,v,n,t,g)}}de(i,146)}function o3(i,t){!t||!t["!merges"]||(de(i,177,HE(t["!merges"].length)),t["!merges"].forEach(function(e){de(i,176,WE(e))}),de(i,178))}function s3(i,t){!t||!t["!cols"]||(de(i,390),t["!cols"].forEach(function(e,n){e&&de(i,60,KE(n,e))}),de(i,391))}function l3(i,t){!t||!t["!ref"]||(de(i,648),de(i,649,e3(zt(t["!ref"]))),de(i,650))}function c3(i,t,e){t["!links"].forEach(function(n){if(n[1].Target){var r=Pt(e,-1,n[1].Target.replace(/#.*$/,""),vt.HLINK);de(i,494,$E(n,r))}}),delete t["!links"]}function d3(i,t,e,n){if(t["!comments"].length>0){var r=Pt(n,-1,"../drawings/vmlDrawing"+(e+1)+".vml",vt.VML);de(i,551,Q0("rId"+r)),t["!legacy"]=r}}function u3(i,t,e,n){if(t["!autofilter"]){var r=t["!autofilter"],a=typeof r.ref=="string"?r.ref:fi(r.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var o=e.Workbook.Names,u=xn(a);u.s.r==u.e.r&&(u.e.r=xn(t["!ref"]).e.r,a=fi(u));for(var m=0;m<o.length;++m){var f=o[m];if(f.Name=="_xlnm._FilterDatabase"&&f.Sheet==n){f.Ref="'"+e.SheetNames[n]+"'!"+a;break}}m==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+e.SheetNames[n]+"'!"+a}),de(i,161,ro(zt(a))),de(i,162)}}function m3(i,t,e){de(i,133),de(i,137,ZE(t,e)),de(i,138),de(i,134)}function f3(i,t){t["!protect"]&&de(i,535,t3(t["!protect"]))}function p3(i,t,e,n){var r=en(),a=e.SheetNames[i],o=e.Sheets[a]||{},u=a;try{e&&e.Workbook&&(u=e.Workbook.Sheets[i].CodeName||u)}catch{}var m=zt(o["!ref"]||"A1");if(m.e.c>16383||m.e.r>1048575){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");m.e.c=Math.min(m.e.c,16383),m.e.r=Math.min(m.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],de(r,129),(e.vbaraw||o["!outline"])&&de(r,147,sE(u,o["!outline"])),de(r,148,rE(m)),m3(r,o,e.Workbook),s3(r,o,i,t,e),a3(r,o,i,t,e),f3(r,o),u3(r,o,e,i),o3(r,o),c3(r,o,n),o["!margins"]&&de(r,476,QE(o["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&l3(r,o),d3(r,o,i,n),de(r,130),r.end()}function h3(i,t){i.l+=10;var e=Vi(i,t-10);return{name:e}}var g3=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function _3(i){return!i.Workbook||!i.Workbook.WBProps?"false":qb(i.Workbook.WBProps.date1904)?"true":"false"}var v3="][*?/\\".split("");function pg(i,t){if(i.length>31){if(t)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var e=!0;return v3.forEach(function(n){if(i.indexOf(n)!=-1){if(!t)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");e=!1}}),e}function x3(i,t,e){i.forEach(function(n,r){pg(n);for(var a=0;a<r;++a)if(n==i[a])throw new Error("Duplicate Sheet Name: "+n);if(e){var o=t&&t[r]&&t[r].CodeName||n;if(o.charCodeAt(0)==95&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}function b3(i){if(!i||!i.SheetNames||!i.Sheets)throw new Error("Invalid Workbook");if(!i.SheetNames.length)throw new Error("Workbook is empty");var t=i.Workbook&&i.Workbook.Sheets||[];x3(i.SheetNames,t,!!i.vbaraw);for(var e=0;e<i.SheetNames.length;++e)Ww(i.Sheets[i.SheetNames[e]],i.SheetNames[e],e)}function hg(i){var t=[pi];t[t.length]=ge("workbook",null,{xmlns:to[0],"xmlns:r":Ci.r});var e=i.Workbook&&(i.Workbook.Names||[]).length>0,n={codeName:"ThisWorkbook"};i.Workbook&&i.Workbook.WBProps&&(g3.forEach(function(u){i.Workbook.WBProps[u[0]]!=null&&i.Workbook.WBProps[u[0]]!=u[1]&&(n[u[0]]=i.Workbook.WBProps[u[0]])}),i.Workbook.WBProps.CodeName&&(n.codeName=i.Workbook.WBProps.CodeName,delete n.CodeName)),t[t.length]=ge("workbookPr",null,n);var r=i.Workbook&&i.Workbook.Sheets||[],a=0;if(r&&r[0]&&r[0].Hidden){for(t[t.length]="<bookViews>",a=0;a!=i.SheetNames.length&&!(!r[a]||!r[a].Hidden);++a);a==i.SheetNames.length&&(a=0),t[t.length]='<workbookView firstSheet="'+a+'" activeTab="'+a+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",a=0;a!=i.SheetNames.length;++a){var o={name:kt(i.SheetNames[a].slice(0,31))};if(o.sheetId=""+(a+1),o["r:id"]="rId"+(a+1),r[a])switch(r[a].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden";break}t[t.length]=ge("sheet",null,o)}return t[t.length]="</sheets>",e&&(t[t.length]="<definedNames>",i.Workbook&&i.Workbook.Names&&i.Workbook.Names.forEach(function(u){var m={name:u.Name};u.Comment&&(m.comment=u.Comment),u.Sheet!=null&&(m.localSheetId=""+u.Sheet),u.Hidden&&(m.hidden="1"),u.Ref&&(t[t.length]=ge("definedName",kt(u.Ref),m))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function y3(i,t){var e={};return e.Hidden=i.read_shift(4),e.iTabID=i.read_shift(4),e.strRelID=O0(i,t-8),e.name=Vi(i),e}function C3(i,t){return t||(t=ne(127)),t.write_shift(4,i.Hidden),t.write_shift(4,i.iTabID),Q0(i.strRelID,t),wi(i.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function S3(i,t){var e={},n=i.read_shift(4);e.defaultThemeVersion=i.read_shift(4);var r=t>8?Vi(i):"";return r.length>0&&(e.CodeName=r),e.autoCompressPictures=!!(n&65536),e.backupFile=!!(n&64),e.checkCompatibility=!!(n&4096),e.date1904=!!(n&1),e.filterPrivacy=!!(n&8),e.hidePivotFieldList=!!(n&1024),e.promptedSolutions=!!(n&16),e.publishItems=!!(n&2048),e.refreshAllConnections=!!(n&262144),e.saveExternalLinkValues=!!(n&128),e.showBorderUnselectedTables=!!(n&4),e.showInkAnnotation=!!(n&32),e.showObjects=["all","placeholders","none"][n>>13&3],e.showPivotChartFilter=!!(n&32768),e.updateLinks=["userSet","never","always"][n>>8&3],e}function w3(i,t){t||(t=ne(72));var e=0;return i&&i.filterPrivacy&&(e|=8),t.write_shift(4,e),t.write_shift(4,0),Ph(i&&i.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function E3(i,t,e){var n=i.l+t;i.l+=4,i.l+=1;var r=i.read_shift(4),a=_y(i),o=Nw(i,0,e),u=Y0(i);i.l=n;var m={Name:a,Ptg:o};return r<268435455&&(m.Sheet=r),u&&(m.Comment=u),m}function T3(i,t){de(i,143);for(var e=0;e!=t.SheetNames.length;++e){var n=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[e]&&t.Workbook.Sheets[e].Hidden||0,r={Hidden:n,iTabID:e+1,strRelID:"rId"+(e+1),name:t.SheetNames[e]};de(i,156,C3(r))}de(i,144)}function P3(i,t){t||(t=ne(127));for(var e=0;e!=4;++e)t.write_shift(4,0);return wi("SheetJS",t),wi($o.version,t),wi($o.version,t),wi("7262",t),t.length>t.l?t.slice(0,t.l):t}function k3(i,t){t||(t=ne(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,i),t.write_shift(4,i);var e=120;return t.write_shift(1,e),t.length>t.l?t.slice(0,t.l):t}function I3(i,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var e=t.Workbook.Sheets,n=0,r=-1,a=-1;n<e.length;++n)!e[n]||!e[n].Hidden&&r==-1?r=n:e[n].Hidden==1&&a==-1&&(a=n);a>r||(de(i,135),de(i,158,k3(r)),de(i,136))}}function M3(i,t){var e=en();return de(e,131),de(e,128,P3()),de(e,153,w3(i.Workbook&&i.Workbook.WBProps||null)),I3(e,i,t),T3(e,i,t),de(e,132),e.end()}function F3(i,t,e){return(t.slice(-4)===".bin"?M3:hg)(i,e)}function A3(i,t,e,n,r){return(t.slice(-4)===".bin"?p3:mg)(i,e,n,r)}function O3(i,t,e){return(t.slice(-4)===".bin"?QC:Qh)(i,e)}function D3(i,t,e){return(t.slice(-4)===".bin"?wC:qh)(i,e)}function R3(i,t,e){return(t.slice(-4)===".bin"?fS:ig)(i,e)}function N3(i){return(i.slice(-4)===".bin"?aS:eg)()}function B3(i,t){var e=[];return i.Props&&e.push(Oy(i.Props,t)),i.Custprops&&e.push(Dy(i.Props,i.Custprops,t)),e.join("")}function L3(){return""}function V3(i,t){var e=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(n,r){var a=[];a.push(ge("NumberFormat",null,{"ss:Format":kt(ni[n.numFmtId])}));var o={"ss:ID":"s"+(21+r)};e.push(ge("Style",a.join(""),o))}),ge("Styles",e.join(""))}function gg(i){return ge("NamedRange",null,{"ss:Name":i.Name,"ss:RefersTo":"="+td(i.Ref,{r:0,c:0})})}function U3(i){if(!((i||{}).Workbook||{}).Names)return"";for(var t=i.Workbook.Names,e=[],n=0;n<t.length;++n){var r=t[n];r.Sheet==null&&(r.Name.match(/^_xlfn\./)||e.push(gg(r)))}return ge("Names",e.join(""))}function j3(i,t,e,n){if(!i||!((n||{}).Workbook||{}).Names)return"";for(var r=n.Workbook.Names,a=[],o=0;o<r.length;++o){var u=r[o];u.Sheet==e&&(u.Name.match(/^_xlfn\./)||a.push(gg(u)))}return a.join("")}function W3(i,t,e,n){if(!i)return"";var r=[];if(i["!margins"]&&(r.push("<PageSetup>"),i["!margins"].header&&r.push(ge("Header",null,{"x:Margin":i["!margins"].header})),i["!margins"].footer&&r.push(ge("Footer",null,{"x:Margin":i["!margins"].footer})),r.push(ge("PageMargins",null,{"x:Bottom":i["!margins"].bottom||"0.75","x:Left":i["!margins"].left||"0.7","x:Right":i["!margins"].right||"0.7","x:Top":i["!margins"].top||"0.75"})),r.push("</PageSetup>")),n&&n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[e])if(n.Workbook.Sheets[e].Hidden)r.push(ge("Visible",n.Workbook.Sheets[e].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var a=0;a<e&&!(n.Workbook.Sheets[a]&&!n.Workbook.Sheets[a].Hidden);++a);a==e&&r.push("<Selected/>")}return((((n||{}).Workbook||{}).Views||[])[0]||{}).RTL&&r.push("<DisplayRightToLeft/>"),i["!protect"]&&(r.push(Ai("ProtectContents","True")),i["!protect"].objects&&r.push(Ai("ProtectObjects","True")),i["!protect"].scenarios&&r.push(Ai("ProtectScenarios","True")),i["!protect"].selectLockedCells!=null&&!i["!protect"].selectLockedCells?r.push(Ai("EnableSelection","NoSelection")):i["!protect"].selectUnlockedCells!=null&&!i["!protect"].selectUnlockedCells&&r.push(Ai("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(o){i["!protect"][o[0]]&&r.push("<"+o[1]+"/>")})),r.length==0?"":ge("WorksheetOptions",r.join(""),{xmlns:vn.x})}function H3(i){return i.map(function(t){var e=Gb(t.t||""),n=ge("ss:Data",e,{xmlns:"http://www.w3.org/TR/REC-html40"});return ge("Comment",n,{"ss:Author":t.a})}).join("")}function z3(i,t,e,n,r,a,o){if(!i||i.v==null&&i.f==null)return"";var u={};if(i.f&&(u["ss:Formula"]="="+kt(td(i.f,o))),i.F&&i.F.slice(0,t.length)==t){var m=Si(i.F.slice(t.length+1));u["ss:ArrayRange"]="RC:R"+(m.r==o.r?"":"["+(m.r-o.r)+"]")+"C"+(m.c==o.c?"":"["+(m.c-o.c)+"]")}if(i.l&&i.l.Target&&(u["ss:HRef"]=kt(i.l.Target),i.l.Tooltip&&(u["x:HRefScreenTip"]=kt(i.l.Tooltip))),e["!merges"])for(var f=e["!merges"],h=0;h!=f.length;++h)f[h].s.c!=o.c||f[h].s.r!=o.r||(f[h].e.c>f[h].s.c&&(u["ss:MergeAcross"]=f[h].e.c-f[h].s.c),f[h].e.r>f[h].s.r&&(u["ss:MergeDown"]=f[h].e.r-f[h].s.r));var g="",v="";switch(i.t){case"z":if(!n.sheetStubs)return"";break;case"n":g="Number",v=String(i.v);break;case"b":g="Boolean",v=i.v?"1":"0";break;case"e":g="Error",v=es[i.v];break;case"d":g="DateTime",v=new Date(i.v).toISOString(),i.z==null&&(i.z=i.z||ni[14]);break;case"s":g="String",v=$b(i.v||"");break}var b=Rr(n.cellXfs,i,n);u["ss:StyleID"]="s"+(21+b),u["ss:Index"]=o.c+1;var w=i.v!=null?v:"",x=i.t=="z"?"":'<Data ss:Type="'+g+'">'+w+"</Data>";return(i.c||[]).length>0&&(x+=H3(i.c)),ge("Cell",x,u)}function $3(i,t){var e='<Row ss:Index="'+(i+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=Yh(t.hpt)),t.hpx&&(e+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(e+=' ss:Hidden="1"')),e+">"}function G3(i,t,e,n){if(!i["!ref"])return"";var r=zt(i["!ref"]),a=i["!merges"]||[],o=0,u=[];i["!cols"]&&i["!cols"].forEach(function(C,U){Z0(C);var j=!!C.width,H=Xl(U,C),K={"ss:Index":U+1};j&&(K["ss:Width"]=Rl(H.width)),C.hidden&&(K["ss:Hidden"]="1"),u.push(ge("Column",null,K))});for(var m=Array.isArray(i),f=r.s.r;f<=r.e.r;++f){for(var h=[$3(f,(i["!rows"]||[])[f])],g=r.s.c;g<=r.e.c;++g){var v=!1;for(o=0;o!=a.length;++o)if(!(a[o].s.c>g)&&!(a[o].s.r>f)&&!(a[o].e.c<g)&&!(a[o].e.r<f)){(a[o].s.c!=g||a[o].s.r!=f)&&(v=!0);break}if(!v){var b={r:f,c:g},w=It(b),x=m?(i[f]||[])[g]:i[w];h.push(z3(x,w,i,t,e,n,b))}}h.push("</Row>"),h.length>2&&u.push(h.join(""))}return u.join("")}function q3(i,t,e){var n=[],r=e.SheetNames[i],a=e.Sheets[r],o=a?j3(a,t,i,e):"";return o.length>0&&n.push("<Names>"+o+"</Names>"),o=a?G3(a,t,i,e):"",o.length>0&&n.push("<Table>"+o+"</Table>"),n.push(W3(a,t,i,e)),n.join("")}function X3(i,t){t||(t={}),i.SSF||(i.SSF=nn(ni)),i.SSF&&(Wl(),jl(i.SSF),t.revssf=Hl(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF,t.cellXfs=[],Rr(t.cellXfs,{},{revssf:{General:0}}));var e=[];e.push(B3(i,t)),e.push(L3(i,t)),e.push(""),e.push("");for(var n=0;n<i.SheetNames.length;++n)e.push(ge("Worksheet",q3(n,t,i),{"ss:Name":kt(i.SheetNames[n])}));return e[2]=V3(i,t),e[3]=U3(i,t),pi+ge("Workbook",e.join(""),{xmlns:vn.ss,"xmlns:o":vn.o,"xmlns:x":vn.x,"xmlns:ss":vn.ss,"xmlns:dt":vn.dt,"xmlns:html":vn.html})}var k0={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function K3(i,t){var e=[],n=[],r=[],a=0,o,u=Cp(Rp,"n"),m=Cp(Np,"n");if(i.Props)for(o=Di(i.Props),a=0;a<o.length;++a)(Object.prototype.hasOwnProperty.call(u,o[a])?e:Object.prototype.hasOwnProperty.call(m,o[a])?n:r).push([o[a],i.Props[o[a]]]);if(i.Custprops)for(o=Di(i.Custprops),a=0;a<o.length;++a)Object.prototype.hasOwnProperty.call(i.Props||{},o[a])||(Object.prototype.hasOwnProperty.call(u,o[a])?e:Object.prototype.hasOwnProperty.call(m,o[a])?n:r).push([o[a],i.Custprops[o[a]]]);var f=[];for(a=0;a<r.length;++a)Uh.indexOf(r[a][0])>-1||Bh.indexOf(r[a][0])>-1||r[a][1]!=null&&f.push(r[a]);n.length&&At.utils.cfb_add(t,"/SummaryInformation",jp(n,k0.SI,m,Np)),(e.length||f.length)&&At.utils.cfb_add(t,"/DocumentSummaryInformation",jp(e,k0.DSI,u,Rp,f.length?f:null,k0.UDI))}function Y3(i,t){var e=t||{},n=At.utils.cfb_new({root:"R"}),r="/Workbook";switch(e.bookType||"xls"){case"xls":e.bookType="biff8";case"xla":e.bookType||(e.bookType="xla");case"biff8":r="/Workbook",e.biff=8;break;case"biff5":r="/Book",e.biff=5;break;default:throw new Error("invalid type "+e.bookType+" for XLS CFB")}return At.utils.cfb_add(n,r,_g(i,e)),e.biff==8&&(i.Props||i.Custprops)&&K3(i,n),e.biff==8&&i.vbaraw&&pS(n,At.read(i.vbaraw,{type:typeof i.vbaraw=="string"?"binary":"buffer"})),n}var Q3={0:{f:eE},1:{f:lE},2:{f:kE},3:{f:gE},4:{f:mE},5:{f:wE},6:{f:OE},7:{f:bE},8:{f:UE},9:{f:VE},10:{f:BE},11:{f:LE},12:{f:dE},13:{f:ME},14:{f:vE},15:{f:pE},16:{f:TE},17:{f:RE},18:{f:CE},19:{f:K0},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:E3},40:{},42:{},43:{f:OC},44:{f:FC},45:{f:NC},46:{f:LC},47:{f:BC},48:{},49:{f:dy},50:{},51:{f:eS},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:uC},62:{f:AE},63:{f:oS},64:{f:i3},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:sr,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:JE},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:oE},148:{f:nE,p:16},151:{f:GE},152:{},153:{f:S3},154:{},155:{},156:{f:y3},157:{},158:{},159:{T:1,f:yC},160:{T:-1},161:{T:1,f:ma},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:jE},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:JC},336:{T:-1},337:{f:nS,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:O0},357:{},358:{},359:{},360:{T:1},361:{},362:{f:aC},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:qE},427:{f:XE},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:YE},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:aE},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:zE},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:O0},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:uS},633:{T:1},634:{T:-1},635:{T:1,f:cS},636:{T:-1},637:{f:py},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:h3},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:n3},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function _e(i,t,e,n){var r=t;if(!isNaN(r)){var a=n||(e||[]).length||0,o=i.next(4);o.write_shift(2,r),o.write_shift(2,a),a>0&&G0(e)&&i.push(e)}}function J3(i,t,e,n){var r=n||(e||[]).length||0;if(r<=8224)return _e(i,t,e,r);var a=t;if(!isNaN(a)){for(var o=e.parts||[],u=0,m=0,f=0;f+(o[u]||8224)<=8224;)f+=o[u]||8224,u++;var h=i.next(4);for(h.write_shift(2,a),h.write_shift(2,f),i.push(e.slice(m,m+f)),m+=f;m<r;){for(h=i.next(4),h.write_shift(2,60),f=0;f+(o[u]||8224)<=8224;)f+=o[u]||8224,u++;h.write_shift(2,f),i.push(e.slice(m,m+f)),m+=f}}}function is(i,t,e){return i||(i=ne(7)),i.write_shift(2,t),i.write_shift(2,e),i.write_shift(2,0),i.write_shift(1,0),i}function Z3(i,t,e,n){var r=ne(9);return is(r,i,t),Wh(e,n||"b",r),r}function eT(i,t,e){var n=ne(8+2*e.length);return is(n,i,t),n.write_shift(1,e.length),n.write_shift(e.length,e,"sbcs"),n.l<n.length?n.slice(0,n.l):n}function tT(i,t,e,n){if(t.v!=null)switch(t.t){case"d":case"n":var r=t.t=="d"?tn(Gi(t.v)):t.v;r==(r|0)&&r>=0&&r<65536?_e(i,2,hC(e,n,r)):_e(i,3,pC(e,n,r));return;case"b":case"e":_e(i,5,Z3(e,n,t.v,t.t));return;case"s":case"str":_e(i,4,eT(e,n,(t.v||"").slice(0,255)));return}_e(i,1,is(null,e,n))}function iT(i,t,e,n){var r=Array.isArray(t),a=zt(t["!ref"]||"A1"),o,u="",m=[];if(a.e.c>255||a.e.r>16383){if(n.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),o=fi(a)}for(var f=a.s.r;f<=a.e.r;++f){u=Oi(f);for(var h=a.s.c;h<=a.e.c;++h){f===a.s.r&&(m[h]=Li(h)),o=m[h]+u;var g=r?(t[f]||[])[h]:t[o];g&&tT(i,g,f,h,n)}}}function nT(i,t){var e=t||{};or!=null&&e.dense==null&&(e.dense=or);for(var n=en(),r=0,a=0;a<i.SheetNames.length;++a)i.SheetNames[a]==e.sheet&&(r=a);if(r==0&&e.sheet&&i.SheetNames[0]!=e.sheet)throw new Error("Sheet not found: "+e.sheet);return _e(n,e.biff==4?1033:e.biff==3?521:9,J0(i,16,e)),iT(n,i.Sheets[i.SheetNames[r]],r,e,i),_e(n,10),n.end()}function rT(i,t,e){_e(i,49,Qy({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},e))}function aT(i,t,e){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)t[r]!=null&&_e(i,1054,eC(r,t[r],e))})}function oT(i,t){var e=ne(19);e.write_shift(4,2151),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,1),e.write_shift(4,0),_e(i,2151,e),e=ne(39),e.write_shift(4,2152),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(2,1),e.write_shift(4,4),e.write_shift(2,0),$h(zt(t["!ref"]||"A1"),e),e.write_shift(4,4),_e(i,2152,e)}function sT(i,t){for(var e=0;e<16;++e)_e(i,224,Hp({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(n){_e(i,224,Hp(n,0,t))})}function lT(i,t){for(var e=0;e<t["!links"].length;++e){var n=t["!links"][e];_e(i,440,lC(n)),n[1].Tooltip&&_e(i,2048,cC(n))}delete t["!links"]}function cT(i,t){if(t){var e=0;t.forEach(function(n,r){++e<=256&&n&&_e(i,125,mC(Xl(r,n),r))})}}function dT(i,t,e,n,r){var a=16+Rr(r.cellXfs,t,r);if(t.v==null&&!t.bf){_e(i,513,sa(e,n,a));return}if(t.bf)_e(i,6,Dw(t,e,n,r,a));else switch(t.t){case"d":case"n":var o=t.t=="d"?tn(Gi(t.v)):t.v;_e(i,515,rC(e,n,o,a,r));break;case"b":case"e":_e(i,517,nC(e,n,t.v,a,r,t.t));break;case"s":case"str":if(r.bookSST){var u=nd(r.Strings,t.v,r.revStrings);_e(i,253,Jy(e,n,u,a,r))}else _e(i,516,Zy(e,n,(t.v||"").slice(0,255),a,r));break;default:_e(i,513,sa(e,n,a))}}function uT(i,t,e){var n=en(),r=e.SheetNames[i],a=e.Sheets[r]||{},o=(e||{}).Workbook||{},u=(o.Sheets||[])[i]||{},m=Array.isArray(a),f=t.biff==8,h,g="",v=[],b=zt(a["!ref"]||"A1"),w=f?65536:16384;if(b.e.c>255||b.e.r>=w){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");b.e.c=Math.min(b.e.c,255),b.e.r=Math.min(b.e.c,w-1)}_e(n,2057,J0(e,16,t)),_e(n,13,kn(1)),_e(n,12,kn(100)),_e(n,15,$i(!0)),_e(n,17,$i(!1)),_e(n,16,oa(.001)),_e(n,95,$i(!0)),_e(n,42,$i(!1)),_e(n,43,$i(!1)),_e(n,130,kn(1)),_e(n,128,iC([0,0])),_e(n,131,$i(!1)),_e(n,132,$i(!1)),f&&cT(n,a["!cols"]),_e(n,512,tC(b,t)),f&&(a["!links"]=[]);for(var x=b.s.r;x<=b.e.r;++x){g=Oi(x);for(var C=b.s.c;C<=b.e.c;++C){x===b.s.r&&(v[C]=Li(C)),h=v[C]+g;var U=m?(a[x]||[])[C]:a[h];U&&(dT(n,U,x,C,t),f&&U.l&&a["!links"].push([h,U.l]))}}var j=u.CodeName||u.name||r;return f&&_e(n,574,Yy((o.Views||[])[0])),f&&(a["!merges"]||[]).length&&_e(n,229,sC(a["!merges"])),f&&lT(n,a),_e(n,442,zh(j,t)),f&&oT(n,a),_e(n,10),n.end()}function mT(i,t,e){var n=en(),r=(i||{}).Workbook||{},a=r.Sheets||[],o=r.WBProps||{},u=e.biff==8,m=e.biff==5;if(_e(n,2057,J0(i,5,e)),e.bookType=="xla"&&_e(n,135),_e(n,225,u?kn(1200):null),_e(n,193,By(2)),m&&_e(n,191),m&&_e(n,192),_e(n,226),_e(n,92,Gy("SheetJS",e)),_e(n,66,kn(u?1200:1252)),u&&_e(n,353,kn(0)),u&&_e(n,448),_e(n,317,fC(i.SheetNames.length)),u&&i.vbaraw&&_e(n,211),u&&i.vbaraw){var f=o.CodeName||"ThisWorkbook";_e(n,442,zh(f,e))}_e(n,156,kn(17)),_e(n,25,$i(!1)),_e(n,18,$i(!1)),_e(n,19,kn(0)),u&&_e(n,431,$i(!1)),u&&_e(n,444,kn(0)),_e(n,61,Ky(e)),_e(n,64,$i(!1)),_e(n,141,kn(0)),_e(n,34,$i(_3(i)=="true")),_e(n,14,$i(!0)),u&&_e(n,439,$i(!1)),_e(n,218,kn(0)),rT(n,i,e),aT(n,i.SSF,e),sT(n,e),u&&_e(n,352,$i(!1));var h=n.end(),g=en();u&&_e(g,140,dC()),u&&e.Strings&&J3(g,252,Xy(e.Strings,e)),_e(g,10);var v=g.end(),b=en(),w=0,x=0;for(x=0;x<i.SheetNames.length;++x)w+=(u?12:11)+(u?2:1)*i.SheetNames[x].length;var C=h.length+w+v.length;for(x=0;x<i.SheetNames.length;++x){var U=a[x]||{};_e(b,133,qy({pos:C,hs:U.Hidden||0,dt:0,name:i.SheetNames[x]},e)),C+=t[x].length}var j=b.end();if(w!=j.length)throw new Error("BS8 "+w+" != "+j.length);var H=[];return h.length&&H.push(h),j.length&&H.push(j),v.length&&H.push(v),Fi(H)}function fT(i,t){var e=t||{},n=[];i&&!i.SSF&&(i.SSF=nn(ni)),i&&i.SSF&&(Wl(),jl(i.SSF),e.revssf=Hl(i.SSF),e.revssf[i.SSF[65535]]=0,e.ssf=i.SSF),e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,rd(e),e.cellXfs=[],Rr(e.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={});for(var r=0;r<i.SheetNames.length;++r)n[n.length]=uT(r,e,i);return n.unshift(mT(i,n,e)),Fi(n)}function _g(i,t){for(var e=0;e<=i.SheetNames.length;++e){var n=i.Sheets[i.SheetNames[e]];if(!(!n||!n["!ref"])){var r=xn(n["!ref"]);r.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+i.SheetNames[e]+"' extends beyond column IV (255).  Data may be lost.")}}var a=t||{};switch(a.biff||2){case 8:case 5:return fT(i,t);case 4:case 3:case 2:return nT(i,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function pT(i,t,e,n){for(var r=i["!merges"]||[],a=[],o=t.s.c;o<=t.e.c;++o){for(var u=0,m=0,f=0;f<r.length;++f)if(!(r[f].s.r>e||r[f].s.c>o)&&!(r[f].e.r<e||r[f].e.c<o)){if(r[f].s.r<e||r[f].s.c<o){u=-1;break}u=r[f].e.r-r[f].s.r+1,m=r[f].e.c-r[f].s.c+1;break}if(!(u<0)){var h=It({r:e,c:o}),g=n.dense?(i[e]||[])[o]:i[h],v=g&&g.v!=null&&(g.h||zb(g.w||(vr(g),g.w)||""))||"",b={};u>1&&(b.rowspan=u),m>1&&(b.colspan=m),n.editable?v='<span contenteditable="true">'+v+"</span>":g&&(b["data-t"]=g&&g.t||"z",g.v!=null&&(b["data-v"]=g.v),g.z!=null&&(b["data-z"]=g.z),g.l&&(g.l.Target||"#").charAt(0)!="#"&&(v='<a href="'+g.l.Target+'">'+v+"</a>")),b.id=(n.id||"sjs")+"-"+h,a.push(ge("td",v,b))}}var w="<tr>";return w+a.join("")+"</tr>"}var hT='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',gT="</body></html>";function _T(i,t,e){var n=[];return n.join("")+"<table"+(e&&e.id?' id="'+e.id+'"':"")+">"}function vg(i,t){var e=t||{},n=e.header!=null?e.header:hT,r=e.footer!=null?e.footer:gT,a=[n],o=xn(i["!ref"]);e.dense=Array.isArray(i),a.push(_T(i,o,e));for(var u=o.s.r;u<=o.e.r;++u)a.push(pT(i,o,u,e));return a.push("</table>"+r),a.join("")}function xg(i,t,e){var n=e||{};or!=null&&(n.dense=or);var r=0,a=0;if(n.origin!=null)if(typeof n.origin=="number")r=n.origin;else{var o=typeof n.origin=="string"?Si(n.origin):n.origin;r=o.r,a=o.c}var u=t.getElementsByTagName("tr"),m=Math.min(n.sheetRows||1e7,u.length),f={s:{r:0,c:0},e:{r,c:a}};if(i["!ref"]){var h=xn(i["!ref"]);f.s.r=Math.min(f.s.r,h.s.r),f.s.c=Math.min(f.s.c,h.s.c),f.e.r=Math.max(f.e.r,h.e.r),f.e.c=Math.max(f.e.c,h.e.c),r==-1&&(f.e.r=r=h.e.r+1)}var g=[],v=0,b=i["!rows"]||(i["!rows"]=[]),w=0,x=0,C=0,U=0,j=0,H=0;for(i["!cols"]||(i["!cols"]=[]);w<u.length&&x<m;++w){var K=u[w];if(Yp(K)){if(n.display)continue;b[x]={hidden:!0}}var ce=K.children;for(C=U=0;C<ce.length;++C){var we=ce[C];if(!(n.display&&Yp(we))){var W=we.hasAttribute("data-v")?we.getAttribute("data-v"):we.hasAttribute("v")?we.getAttribute("v"):Xb(we.innerHTML),se=we.getAttribute("data-z")||we.getAttribute("z");for(v=0;v<g.length;++v){var ee=g[v];ee.s.c==U+a&&ee.s.r<x+r&&x+r<=ee.e.r&&(U=ee.e.c+1-a,v=-1)}H=+we.getAttribute("colspan")||1,((j=+we.getAttribute("rowspan")||1)>1||H>1)&&g.push({s:{r:x+r,c:U+a},e:{r:x+r+(j||1)-1,c:U+a+(H||1)-1}});var le={t:"s",v:W},ue=we.getAttribute("data-t")||we.getAttribute("t")||"";W!=null&&(W.length==0?le.t=ue||"z":n.raw||W.trim().length==0||ue=="s"||(W==="TRUE"?le={t:"b",v:!0}:W==="FALSE"?le={t:"b",v:!1}:isNaN(hr(W))?isNaN(Xo(W).getDate())||(le={t:"d",v:Gi(W)},n.cellDates||(le={t:"n",v:tn(le.v)}),le.z=n.dateNF||ni[14]):le={t:"n",v:hr(W)})),le.z===void 0&&se!=null&&(le.z=se);var me="",Me=we.getElementsByTagName("A");if(Me&&Me.length)for(var mt=0;mt<Me.length&&!(Me[mt].hasAttribute("href")&&(me=Me[mt].getAttribute("href"),me.charAt(0)!="#"));++mt);me&&me.charAt(0)!="#"&&(le.l={Target:me}),n.dense?(i[x+r]||(i[x+r]=[]),i[x+r][U+a]=le):i[It({c:U+a,r:x+r})]=le,f.e.c<U+a&&(f.e.c=U+a),U+=H}}++x}return g.length&&(i["!merges"]=(i["!merges"]||[]).concat(g)),f.e.r=Math.max(f.e.r,x-1+r),i["!ref"]=fi(f),x>=m&&(i["!fullref"]=fi((f.e.r=u.length-w+x-1+r,f))),i}function bg(i,t){var e=t||{},n=e.dense?[]:{};return xg(n,i,t)}function vT(i,t){return la(bg(i,t),t)}function Yp(i){var t="",e=xT(i);return e&&(t=e(i).getPropertyValue("display")),t||(t=i.style&&i.style.display),t==="none"}function xT(i){return i.ownerDocument.defaultView&&typeof i.ownerDocument.defaultView.getComputedStyle=="function"?i.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var bT=function(){var i=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+Ko({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+i+"</office:document-styles>";return function(){return pi+t}}(),Qp=function(){var i=function(a){return kt(a).replace(/  +/g,function(o){return'<text:s text:c="'+o.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,e=`          <table:covered-table-cell/>
`,n=function(a,o,u){var m=[];m.push('      <table:table table:name="'+kt(o.SheetNames[u])+`" table:style-name="ta1">
`);var f=0,h=0,g=xn(a["!ref"]||"A1"),v=a["!merges"]||[],b=0,w=Array.isArray(a);if(a["!cols"])for(h=0;h<=g.e.c;++h)m.push("        <table:table-column"+(a["!cols"][h]?' table:style-name="co'+a["!cols"][h].ods+'"':"")+`></table:table-column>
`);var x="",C=a["!rows"]||[];for(f=0;f<g.s.r;++f)x=C[f]?' table:style-name="ro'+C[f].ods+'"':"",m.push("        <table:table-row"+x+`></table:table-row>
`);for(;f<=g.e.r;++f){for(x=C[f]?' table:style-name="ro'+C[f].ods+'"':"",m.push("        <table:table-row"+x+`>
`),h=0;h<g.s.c;++h)m.push(t);for(;h<=g.e.c;++h){var U=!1,j={},H="";for(b=0;b!=v.length;++b)if(!(v[b].s.c>h)&&!(v[b].s.r>f)&&!(v[b].e.c<h)&&!(v[b].e.r<f)){(v[b].s.c!=h||v[b].s.r!=f)&&(U=!0),j["table:number-columns-spanned"]=v[b].e.c-v[b].s.c+1,j["table:number-rows-spanned"]=v[b].e.r-v[b].s.r+1;break}if(U){m.push(e);continue}var K=It({r:f,c:h}),ce=w?(a[f]||[])[h]:a[K];if(ce&&ce.f&&(j["table:formula"]=kt(Uw(ce.f)),ce.F&&ce.F.slice(0,K.length)==K)){var we=xn(ce.F);j["table:number-matrix-columns-spanned"]=we.e.c-we.s.c+1,j["table:number-matrix-rows-spanned"]=we.e.r-we.s.r+1}if(!ce){m.push(t);continue}switch(ce.t){case"b":H=ce.v?"TRUE":"FALSE",j["office:value-type"]="boolean",j["office:boolean-value"]=ce.v?"true":"false";break;case"n":H=ce.w||String(ce.v||0),j["office:value-type"]="float",j["office:value"]=ce.v||0;break;case"s":case"str":H=ce.v==null?"":ce.v,j["office:value-type"]="string";break;case"d":H=ce.w||Gi(ce.v).toISOString(),j["office:value-type"]="date",j["office:date-value"]=Gi(ce.v).toISOString(),j["table:style-name"]="ce1";break;default:m.push(t);continue}var W=i(H);if(ce.l&&ce.l.Target){var se=ce.l.Target;se=se.charAt(0)=="#"?"#"+jw(se.slice(1)):se,se.charAt(0)!="#"&&!se.match(/^\w+:/)&&(se="../"+se),W=ge("text:a",W,{"xlink:href":se.replace(/&/g,"&amp;")})}m.push("          "+ge("table:table-cell",ge("text:p",W,{}),j)+`
`)}m.push(`        </table:table-row>
`)}return m.push(`      </table:table>
`),m.join("")},r=function(a,o){a.push(` <office:automatic-styles>
`),a.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),a.push(`   <number:month number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:day number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:year/>
`),a.push(`  </number:date-style>
`);var u=0;o.SheetNames.map(function(f){return o.Sheets[f]}).forEach(function(f){if(f&&f["!cols"]){for(var h=0;h<f["!cols"].length;++h)if(f["!cols"][h]){var g=f["!cols"][h];if(g.width==null&&g.wpx==null&&g.wch==null)continue;Z0(g),g.ods=u;var v=f["!cols"][h].wpx+"px";a.push('  <style:style style:name="co'+u+`" style:family="table-column">
`),a.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+v+`"/>
`),a.push(`  </style:style>
`),++u}}});var m=0;o.SheetNames.map(function(f){return o.Sheets[f]}).forEach(function(f){if(f&&f["!rows"]){for(var h=0;h<f["!rows"].length;++h)if(f["!rows"][h]){f["!rows"][h].ods=m;var g=f["!rows"][h].hpx+"px";a.push('  <style:style style:name="ro'+m+`" style:family="table-row">
`),a.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+g+`"/>
`),a.push(`  </style:style>
`),++m}}}),a.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),a.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),a.push(`  </style:style>
`),a.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),a.push(` </office:automatic-styles>
`)};return function(o,u){var m=[pi],f=Ko({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),h=Ko({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});u.bookType=="fods"?(m.push("<office:document"+f+h+`>
`),m.push(Rh().replace(/office:document-meta/g,"office:meta"))):m.push("<office:document-content"+f+`>
`),r(m,o),m.push(`  <office:body>
`),m.push(`    <office:spreadsheet>
`);for(var g=0;g!=o.SheetNames.length;++g)m.push(n(o.Sheets[o.SheetNames[g]],o,g,u));return m.push(`    </office:spreadsheet>
`),m.push(`  </office:body>
`),u.bookType=="fods"?m.push("</office:document>"):m.push("</office:document-content>"),m.join("")}}();function yg(i,t){if(t.bookType=="fods")return Qp(i,t);var e=L0(),n="",r=[],a=[];return n="mimetype",Ye(e,n,"application/vnd.oasis.opendocument.spreadsheet"),n="content.xml",Ye(e,n,Qp(i,t)),r.push([n,"text/xml"]),a.push([n,"ContentFile"]),n="styles.xml",Ye(e,n,bT(i,t)),r.push([n,"text/xml"]),a.push([n,"StylesFile"]),n="meta.xml",Ye(e,n,pi+Rh()),r.push([n,"text/xml"]),a.push([n,"MetadataFile"]),n="manifest.rdf",Ye(e,n,Ay(a)),r.push([n,"application/rdf+xml"]),n="META-INF/manifest.xml",Ye(e,n,My(r)),e}function Ll(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function yT(i){return typeof TextEncoder<"u"?new TextEncoder().encode(i):Ln(fr(i))}function CT(i,t){e:for(var e=0;e<=i.length-t.length;++e){for(var n=0;n<t.length;++n)if(i[e+n]!=t[n])continue e;return!0}return!1}function Dr(i){var t=i.reduce(function(r,a){return r+a.length},0),e=new Uint8Array(t),n=0;return i.forEach(function(r){e.set(r,n),n+=r.length}),e}function ST(i,t,e){var n=Math.floor(e==0?0:Math.LOG10E*Math.log(Math.abs(e)))+6176-20,r=e/Math.pow(10,n-6176);i[t+15]|=n>>7,i[t+14]|=(n&127)<<1;for(var a=0;r>=1;++a,r/=256)i[t+a]=r&255;i[t+15]|=e>=0?0:128}function Yo(i,t){var e=t?t[0]:0,n=i[e]&127;e:if(i[e++]>=128&&(n|=(i[e]&127)<<7,i[e++]<128||(n|=(i[e]&127)<<14,i[e++]<128)||(n|=(i[e]&127)<<21,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,28),++e,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,35),++e,i[e++]<128)||(n+=(i[e]&127)*Math.pow(2,42),++e,i[e++]<128)))break e;return t&&(t[0]=e),n}function Tt(i){var t=new Uint8Array(7);t[0]=i&127;var e=1;e:if(i>127){if(t[e-1]|=128,t[e]=i>>7&127,++e,i<=16383||(t[e-1]|=128,t[e]=i>>14&127,++e,i<=2097151)||(t[e-1]|=128,t[e]=i>>21&127,++e,i<=268435455)||(t[e-1]|=128,t[e]=i/256>>>21&127,++e,i<=34359738367)||(t[e-1]|=128,t[e]=i/65536>>>21&127,++e,i<=4398046511103))break e;t[e-1]|=128,t[e]=i/16777216>>>21&127,++e}return t.slice(0,e)}function Ja(i){var t=0,e=i[t]&127;e:if(i[t++]>=128){if(e|=(i[t]&127)<<7,i[t++]<128||(e|=(i[t]&127)<<14,i[t++]<128)||(e|=(i[t]&127)<<21,i[t++]<128))break e;e|=(i[t]&127)<<28}return e}function xi(i){for(var t=[],e=[0];e[0]<i.length;){var n=e[0],r=Yo(i,e),a=r&7;r=Math.floor(r/8);var o=0,u;if(r==0)break;switch(a){case 0:{for(var m=e[0];i[e[0]++]>=128;);u=i.slice(m,e[0])}break;case 5:o=4,u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 1:o=8,u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 2:o=Yo(i,e),u=i.slice(e[0],e[0]+o),e[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(a," for Field ").concat(r," at offset ").concat(n))}var f={data:u,type:a};t[r]==null?t[r]=[f]:t[r].push(f)}return t}function Ii(i){var t=[];return i.forEach(function(e,n){e.forEach(function(r){r.data&&(t.push(Tt(n*8+r.type)),r.type==2&&t.push(Tt(r.data.length)),t.push(r.data))})}),Dr(t)}function Nn(i){for(var t,e=[],n=[0];n[0]<i.length;){var r=Yo(i,n),a=xi(i.slice(n[0],n[0]+r));n[0]+=r;var o={id:Ja(a[1][0].data),messages:[]};a[2].forEach(function(u){var m=xi(u.data),f=Ja(m[3][0].data);o.messages.push({meta:m,data:i.slice(n[0],n[0]+f)}),n[0]+=f}),(t=a[3])!=null&&t[0]&&(o.merge=Ja(a[3][0].data)>>>0>0),e.push(o)}return e}function za(i){var t=[];return i.forEach(function(e){var n=[];n[1]=[{data:Tt(e.id),type:0}],n[2]=[],e.merge!=null&&(n[3]=[{data:Tt(+!!e.merge),type:0}]);var r=[];e.messages.forEach(function(o){r.push(o.data),o.meta[3]=[{type:0,data:Tt(o.data.length)}],n[2].push({data:Ii(o.meta),type:2})});var a=Ii(n);t.push(Tt(a.length)),t.push(a),r.forEach(function(o){return t.push(o)})}),Dr(t)}function wT(i,t){if(i!=0)throw new Error("Unexpected Snappy chunk type ".concat(i));for(var e=[0],n=Yo(t,e),r=[];e[0]<t.length;){var a=t[e[0]]&3;if(a==0){var o=t[e[0]++]>>2;if(o<60)++o;else{var u=o-59;o=t[e[0]],u>1&&(o|=t[e[0]+1]<<8),u>2&&(o|=t[e[0]+2]<<16),u>3&&(o|=t[e[0]+3]<<24),o>>>=0,o++,e[0]+=u}r.push(t.slice(e[0],e[0]+o)),e[0]+=o;continue}else{var m=0,f=0;if(a==1?(f=(t[e[0]]>>2&7)+4,m=(t[e[0]++]&224)<<3,m|=t[e[0]++]):(f=(t[e[0]++]>>2)+1,a==2?(m=t[e[0]]|t[e[0]+1]<<8,e[0]+=2):(m=(t[e[0]]|t[e[0]+1]<<8|t[e[0]+2]<<16|t[e[0]+3]<<24)>>>0,e[0]+=4)),r=[Dr(r)],m==0)throw new Error("Invalid offset 0");if(m>r[0].length)throw new Error("Invalid offset beyond length");if(f>=m)for(r.push(r[0].slice(-m)),f-=m;f>=r[r.length-1].length;)r.push(r[r.length-1]),f-=r[r.length-1].length;r.push(r[0].slice(-m,-m+f))}}var h=Dr(r);if(h.length!=n)throw new Error("Unexpected length: ".concat(h.length," != ").concat(n));return h}function Bn(i){for(var t=[],e=0;e<i.length;){var n=i[e++],r=i[e]|i[e+1]<<8|i[e+2]<<16;e+=3,t.push(wT(n,i.slice(e,e+r))),e+=r}if(e!==i.length)throw new Error("data is not a valid framed stream!");return Dr(t)}function $a(i){for(var t=[],e=0;e<i.length;){var n=Math.min(i.length-e,268435455),r=new Uint8Array(4);t.push(r);var a=Tt(n),o=a.length;t.push(a),n<=60?(o++,t.push(new Uint8Array([n-1<<2]))):n<=256?(o+=2,t.push(new Uint8Array([240,n-1&255]))):n<=65536?(o+=3,t.push(new Uint8Array([244,n-1&255,n-1>>8&255]))):n<=16777216?(o+=4,t.push(new Uint8Array([248,n-1&255,n-1>>8&255,n-1>>16&255]))):n<=4294967296&&(o+=5,t.push(new Uint8Array([252,n-1&255,n-1>>8&255,n-1>>16&255,n-1>>>24&255]))),t.push(i.slice(e,e+n)),o+=n,r[0]=0,r[1]=o&255,r[2]=o>>8&255,r[3]=o>>16&255,e+=n}return Dr(t)}function I0(i,t){var e=new Uint8Array(32),n=Ll(e),r=12,a=0;switch(e[0]=5,i.t){case"n":e[1]=2,ST(e,r,i.v),a|=1,r+=16;break;case"b":e[1]=6,n.setFloat64(r,i.v?1:0,!0),a|=2,r+=8;break;case"s":if(t.indexOf(i.v)==-1)throw new Error("Value ".concat(i.v," missing from SST!"));e[1]=3,n.setUint32(r,t.indexOf(i.v),!0),a|=8,r+=4;break;default:throw"unsupported cell type "+i.t}return n.setUint32(8,a,!0),e.slice(0,r)}function M0(i,t){var e=new Uint8Array(32),n=Ll(e),r=12,a=0;switch(e[0]=3,i.t){case"n":e[2]=2,n.setFloat64(r,i.v,!0),a|=32,r+=8;break;case"b":e[2]=6,n.setFloat64(r,i.v?1:0,!0),a|=32,r+=8;break;case"s":if(t.indexOf(i.v)==-1)throw new Error("Value ".concat(i.v," missing from SST!"));e[2]=3,n.setUint32(r,t.indexOf(i.v),!0),a|=16,r+=4;break;default:throw"unsupported cell type "+i.t}return n.setUint32(4,a,!0),e.slice(0,r)}function Ir(i){var t=xi(i);return Yo(t[1][0].data)}function ET(i,t,e){var n,r,a,o;if(!((n=i[6])!=null&&n[0])||!((r=i[7])!=null&&r[0]))throw"Mutation only works on post-BNC storages!";var u=((o=(a=i[8])==null?void 0:a[0])==null?void 0:o.data)&&Ja(i[8][0].data)>0||!1;if(u)throw"Math only works with normal offsets";for(var m=0,f=Ll(i[7][0].data),h=0,g=[],v=Ll(i[4][0].data),b=0,w=[],x=0;x<t.length;++x){if(t[x]==null){f.setUint16(x*2,65535,!0),v.setUint16(x*2,65535);continue}f.setUint16(x*2,h,!0),v.setUint16(x*2,b,!0);var C,U;switch(typeof t[x]){case"string":C=I0({t:"s",v:t[x]},e),U=M0({t:"s",v:t[x]},e);break;case"number":C=I0({t:"n",v:t[x]},e),U=M0({t:"n",v:t[x]},e);break;case"boolean":C=I0({t:"b",v:t[x]},e),U=M0({t:"b",v:t[x]},e);break;default:throw new Error("Unsupported value "+t[x])}g.push(C),h+=C.length,w.push(U),b+=U.length,++m}for(i[2][0].data=Tt(m);x<i[7][0].data.length/2;++x)f.setUint16(x*2,65535,!0),v.setUint16(x*2,65535,!0);return i[6][0].data=Dr(g),i[3][0].data=Dr(w),m}function TT(i,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var e=i.Sheets[i.SheetNames[0]];i.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var n=xn(e["!ref"]);n.s.r=n.s.c=0;var r=!1;n.e.c>9&&(r=!0,n.e.c=9),n.e.r>49&&(r=!0,n.e.r=49),r&&console.error("The Numbers writer is currently limited to ".concat(fi(n)));var a=Vl(e,{range:n,header:1}),o=["~Sh33tJ5~"];a.forEach(function(L){return L.forEach(function(V){typeof V=="string"&&o.push(V)})});var u={},m=[],f=At.read(t.numbers,{type:"base64"});f.FileIndex.map(function(L,V){return[L,f.FullPaths[V]]}).forEach(function(L){var V=L[0],fe=L[1];if(V.type==2&&V.name.match(/\.iwa/)){var ye=V.content,Oe=Bn(ye),Se=Nn(Oe);Se.forEach(function(he){m.push(he.id),u[he.id]={deps:[],location:fe,type:Ja(he.messages[0].meta[1][0].data)}})}}),m.sort(function(L,V){return L-V});var h=m.filter(function(L){return L>1}).map(function(L){return[L,Tt(L)]});f.FileIndex.map(function(L,V){return[L,f.FullPaths[V]]}).forEach(function(L){var V=L[0],fe=L[1];if(V.name.match(/\.iwa/)){var ye=Nn(Bn(V.content));ye.forEach(function(Oe){Oe.messages.forEach(function(Se){h.forEach(function(he){Oe.messages.some(function(ht){return Ja(ht.meta[1][0].data)!=11006&&CT(ht.data,he[1])})&&u[he[0]].deps.push(Oe.id)})})})}});function g(){for(var L=927262;L<2e6;++L)if(!u[L])return L;throw new Error("Too many messages")}for(var v=At.find(f,u[1].location),b=Nn(Bn(v.content)),w,x=0;x<b.length;++x){var C=b[x];C.id==1&&(w=C)}var U=Ir(xi(w.messages[0].data)[1][0].data);for(v=At.find(f,u[U].location),b=Nn(Bn(v.content)),x=0;x<b.length;++x)C=b[x],C.id==U&&(w=C);for(U=Ir(xi(w.messages[0].data)[2][0].data),v=At.find(f,u[U].location),b=Nn(Bn(v.content)),x=0;x<b.length;++x)C=b[x],C.id==U&&(w=C);for(U=Ir(xi(w.messages[0].data)[2][0].data),v=At.find(f,u[U].location),b=Nn(Bn(v.content)),x=0;x<b.length;++x)C=b[x],C.id==U&&(w=C);var j=xi(w.messages[0].data);{j[6][0].data=Tt(n.e.r+1),j[7][0].data=Tt(n.e.c+1);var H=Ir(j[46][0].data),K=At.find(f,u[H].location),ce=Nn(Bn(K.content));{for(var we=0;we<ce.length&&ce[we].id!=H;++we);if(ce[we].id!=H)throw"Bad ColumnRowUIDMapArchive";var W=xi(ce[we].messages[0].data);W[1]=[],W[2]=[],W[3]=[];for(var se=0;se<=n.e.c;++se){var ee=[];ee[1]=ee[2]=[{type:0,data:Tt(se+420690)}],W[1].push({type:2,data:Ii(ee)}),W[2].push({type:0,data:Tt(se)}),W[3].push({type:0,data:Tt(se)})}W[4]=[],W[5]=[],W[6]=[];for(var le=0;le<=n.e.r;++le)ee=[],ee[1]=ee[2]=[{type:0,data:Tt(le+726270)}],W[4].push({type:2,data:Ii(ee)}),W[5].push({type:0,data:Tt(le)}),W[6].push({type:0,data:Tt(le)});ce[we].messages[0].data=Ii(W)}K.content=$a(za(ce)),K.size=K.content.length,delete j[46];var ue=xi(j[4][0].data);{ue[7][0].data=Tt(n.e.r+1);var me=xi(ue[1][0].data),Me=Ir(me[2][0].data);K=At.find(f,u[Me].location),ce=Nn(Bn(K.content));{if(ce[0].id!=Me)throw"Bad HeaderStorageBucket";var mt=xi(ce[0].messages[0].data);for(le=0;le<a.length;++le){var De=xi(mt[2][0].data);De[1][0].data=Tt(le),De[4][0].data=Tt(a[le].length),mt[2][le]={type:mt[2][0].type,data:Ii(De)}}ce[0].messages[0].data=Ii(mt)}K.content=$a(za(ce)),K.size=K.content.length;var be=Ir(ue[2][0].data);K=At.find(f,u[be].location),ce=Nn(Bn(K.content));{if(ce[0].id!=be)throw"Bad HeaderStorageBucket";for(mt=xi(ce[0].messages[0].data),se=0;se<=n.e.c;++se)De=xi(mt[2][0].data),De[1][0].data=Tt(se),De[4][0].data=Tt(n.e.r+1),mt[2][se]={type:mt[2][0].type,data:Ii(De)};ce[0].messages[0].data=Ii(mt)}K.content=$a(za(ce)),K.size=K.content.length;var Ee=Ir(ue[4][0].data);(function(){for(var L=At.find(f,u[Ee].location),V=Nn(Bn(L.content)),fe,ye=0;ye<V.length;++ye){var Oe=V[ye];Oe.id==Ee&&(fe=Oe)}var Se=xi(fe.messages[0].data);{Se[3]=[];var he=[];o.forEach(function(Ei,gt){he[1]=[{type:0,data:Tt(gt)}],he[2]=[{type:0,data:Tt(1)}],he[3]=[{type:2,data:yT(Ei)}],Se[3].push({type:2,data:Ii(he)})})}fe.messages[0].data=Ii(Se);var ht=za(V),st=$a(ht);L.content=st,L.size=L.content.length})();var ke=xi(ue[3][0].data);{var Ue=ke[1][0];delete ke[2];var et=xi(Ue.data);{var Vt=Ir(et[2][0].data);(function(){for(var L=At.find(f,u[Vt].location),V=Nn(Bn(L.content)),fe,ye=0;ye<V.length;++ye){var Oe=V[ye];Oe.id==Vt&&(fe=Oe)}var Se=xi(fe.messages[0].data);{delete Se[6],delete ke[7];var he=new Uint8Array(Se[5][0].data);Se[5]=[];for(var ht=0,st=0;st<=n.e.r;++st){var Ei=xi(he);ht+=ET(Ei,a[st],o),Ei[1][0].data=Tt(st),Se[5].push({data:Ii(Ei),type:2})}Se[1]=[{type:0,data:Tt(n.e.c+1)}],Se[2]=[{type:0,data:Tt(n.e.r+1)}],Se[3]=[{type:0,data:Tt(ht)}],Se[4]=[{type:0,data:Tt(n.e.r+1)}]}fe.messages[0].data=Ii(Se);var gt=za(V),Rn=$a(gt);L.content=Rn,L.size=L.content.length})()}Ue.data=Ii(et)}ue[3][0].data=Ii(ke)}j[4][0].data=Ii(ue)}w.messages[0].data=Ii(j);var B=za(b),re=$a(B);return v.content=re,v.size=v.content.length,f}function PT(i){return function(e){for(var n=0;n!=i.length;++n){var r=i[n];e[r[0]]===void 0&&(e[r[0]]=r[1]),r[2]==="n"&&(e[r[0]]=Number(e[r[0]]))}}}function rd(i){PT([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(i)}function kT(i,t){return t.bookType=="ods"?yg(i,t):t.bookType=="numbers"?TT(i,t):t.bookType=="xlsb"?IT(i,t):MT(i,t)}function IT(i,t){qa=1024,i&&!i.SSF&&(i.SSF=nn(ni)),i&&i.SSF&&(Wl(),jl(i.SSF),t.revssf=Hl(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,zo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var e=t.bookType=="xlsb"?"bin":"xml",n=ng.indexOf(t.bookType)>-1,r=Ah();rd(t=t||{});var a=L0(),o="",u=0;if(t.cellXfs=[],Rr(t.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={}),o="docProps/core.xml",Ye(a,o,Nh(i.Props,t)),r.coreprops.push(o),Pt(t.rels,2,o,vt.CORE_PROPS),o="docProps/app.xml",!(i.Props&&i.Props.SheetNames))if(!i.Workbook||!i.Workbook.Sheets)i.Props.SheetNames=i.SheetNames;else{for(var m=[],f=0;f<i.SheetNames.length;++f)(i.Workbook.Sheets[f]||{}).Hidden!=2&&m.push(i.SheetNames[f]);i.Props.SheetNames=m}for(i.Props.Worksheets=i.Props.SheetNames.length,Ye(a,o,Lh(i.Props,t)),r.extprops.push(o),Pt(t.rels,3,o,vt.EXT_PROPS),i.Custprops!==i.Props&&Di(i.Custprops||{}).length>0&&(o="docProps/custom.xml",Ye(a,o,Vh(i.Custprops,t)),r.custprops.push(o),Pt(t.rels,4,o,vt.CUST_PROPS)),u=1;u<=i.SheetNames.length;++u){var h={"!id":{}},g=i.Sheets[i.SheetNames[u-1]],v=(g||{})["!type"]||"sheet";switch(v){case"chart":default:o="xl/worksheets/sheet"+u+"."+e,Ye(a,o,A3(u-1,o,t,i,h)),r.sheets.push(o),Pt(t.wbrels,-1,"worksheets/sheet"+u+"."+e,vt.WS[0])}if(g){var b=g["!comments"],w=!1,x="";b&&b.length>0&&(x="xl/comments"+u+"."+e,Ye(a,x,R3(b,x,t)),r.comments.push(x),Pt(h,-1,"../comments"+u+"."+e,vt.CMNT),w=!0),g["!legacy"]&&w&&Ye(a,"xl/drawings/vmlDrawing"+u+".vml",tg(u,g["!comments"])),delete g["!comments"],delete g["!legacy"]}h["!id"].rId1&&Ye(a,Dh(o),Ya(h))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+e,Ye(a,o,D3(t.Strings,o,t)),r.strs.push(o),Pt(t.wbrels,-1,"sharedStrings."+e,vt.SST)),o="xl/workbook."+e,Ye(a,o,F3(i,o,t)),r.workbooks.push(o),Pt(t.rels,1,o,vt.WB),o="xl/theme/theme1.xml",Ye(a,o,Zh(i.Themes,t)),r.themes.push(o),Pt(t.wbrels,-1,"theme/theme1.xml",vt.THEME),o="xl/styles."+e,Ye(a,o,O3(i,o,t)),r.styles.push(o),Pt(t.wbrels,-1,"styles."+e,vt.STY),i.vbaraw&&n&&(o="xl/vbaProject.bin",Ye(a,o,i.vbaraw),r.vba.push(o),Pt(t.wbrels,-1,"vbaProject.bin",vt.VBA)),o="xl/metadata."+e,Ye(a,o,N3(o)),r.metadata.push(o),Pt(t.wbrels,-1,"metadata."+e,vt.XLMETA),Ye(a,"[Content_Types].xml",Oh(r,t)),Ye(a,"_rels/.rels",Ya(t.rels)),Ye(a,"xl/_rels/workbook."+e+".rels",Ya(t.wbrels)),delete t.revssf,delete t.ssf,a}function MT(i,t){qa=1024,i&&!i.SSF&&(i.SSF=nn(ni)),i&&i.SSF&&(Wl(),jl(i.SSF),t.revssf=Hl(i.SSF),t.revssf[i.SSF[65535]]=0,t.ssf=i.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,zo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var e="xml",n=ng.indexOf(t.bookType)>-1,r=Ah();rd(t=t||{});var a=L0(),o="",u=0;if(t.cellXfs=[],Rr(t.cellXfs,{},{revssf:{General:0}}),i.Props||(i.Props={}),o="docProps/core.xml",Ye(a,o,Nh(i.Props,t)),r.coreprops.push(o),Pt(t.rels,2,o,vt.CORE_PROPS),o="docProps/app.xml",!(i.Props&&i.Props.SheetNames))if(!i.Workbook||!i.Workbook.Sheets)i.Props.SheetNames=i.SheetNames;else{for(var m=[],f=0;f<i.SheetNames.length;++f)(i.Workbook.Sheets[f]||{}).Hidden!=2&&m.push(i.SheetNames[f]);i.Props.SheetNames=m}i.Props.Worksheets=i.Props.SheetNames.length,Ye(a,o,Lh(i.Props,t)),r.extprops.push(o),Pt(t.rels,3,o,vt.EXT_PROPS),i.Custprops!==i.Props&&Di(i.Custprops||{}).length>0&&(o="docProps/custom.xml",Ye(a,o,Vh(i.Custprops,t)),r.custprops.push(o),Pt(t.rels,4,o,vt.CUST_PROPS));var h=["SheetJ5"];for(t.tcid=0,u=1;u<=i.SheetNames.length;++u){var g={"!id":{}},v=i.Sheets[i.SheetNames[u-1]],b=(v||{})["!type"]||"sheet";switch(b){case"chart":default:o="xl/worksheets/sheet"+u+"."+e,Ye(a,o,mg(u-1,t,i,g)),r.sheets.push(o),Pt(t.wbrels,-1,"worksheets/sheet"+u+"."+e,vt.WS[0])}if(v){var w=v["!comments"],x=!1,C="";if(w&&w.length>0){var U=!1;w.forEach(function(j){j[1].forEach(function(H){H.T==!0&&(U=!0)})}),U&&(C="xl/threadedComments/threadedComment"+u+"."+e,Ye(a,C,sS(w,h,t)),r.threadedcomments.push(C),Pt(g,-1,"../threadedComments/threadedComment"+u+"."+e,vt.TCMNT)),C="xl/comments"+u+"."+e,Ye(a,C,ig(w,t)),r.comments.push(C),Pt(g,-1,"../comments"+u+"."+e,vt.CMNT),x=!0}v["!legacy"]&&x&&Ye(a,"xl/drawings/vmlDrawing"+u+".vml",tg(u,v["!comments"])),delete v["!comments"],delete v["!legacy"]}g["!id"].rId1&&Ye(a,Dh(o),Ya(g))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+e,Ye(a,o,qh(t.Strings,t)),r.strs.push(o),Pt(t.wbrels,-1,"sharedStrings."+e,vt.SST)),o="xl/workbook."+e,Ye(a,o,hg(i,t)),r.workbooks.push(o),Pt(t.rels,1,o,vt.WB),o="xl/theme/theme1.xml",Ye(a,o,Zh(i.Themes,t)),r.themes.push(o),Pt(t.wbrels,-1,"theme/theme1.xml",vt.THEME),o="xl/styles."+e,Ye(a,o,Qh(i,t)),r.styles.push(o),Pt(t.wbrels,-1,"styles."+e,vt.STY),i.vbaraw&&n&&(o="xl/vbaProject.bin",Ye(a,o,i.vbaraw),r.vba.push(o),Pt(t.wbrels,-1,"vbaProject.bin",vt.VBA)),o="xl/metadata."+e,Ye(a,o,eg()),r.metadata.push(o),Pt(t.wbrels,-1,"metadata."+e,vt.XLMETA),h.length>1&&(o="xl/persons/person.xml",Ye(a,o,lS(h,t)),r.people.push(o),Pt(t.wbrels,-1,"persons/person.xml",vt.PEOPLE)),Ye(a,"[Content_Types].xml",Oh(r,t)),Ye(a,"_rels/.rels",Ya(t.rels)),Ye(a,"xl/_rels/workbook."+e+".rels",Ya(t.wbrels)),delete t.revssf,delete t.ssf,a}function FT(i,t){var e="";switch((t||{}).type||"base64"){case"buffer":return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]];case"base64":e=_r(i.slice(0,12));break;case"binary":e=i;break;case"array":return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4),e.charCodeAt(5),e.charCodeAt(6),e.charCodeAt(7)]}function Cg(i,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Zo(t.file,At.write(i,{type:bt?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return At.write(i,t)}function AT(i,t){var e=nn(t||{}),n=kT(i,e);return OT(n,e)}function OT(i,t){var e={},n=bt?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(e.compression="DEFLATE"),t.password)e.type=n;else switch(t.type){case"base64":e.type="base64";break;case"binary":e.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":e.type=n;break;default:throw new Error("Unrecognized type "+t.type)}var r=i.FullPaths?At.write(i,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[e.type]||e.type,compression:!!t.compression}):i.generate(e);if(typeof Deno<"u"&&typeof r=="string"){if(t.type=="binary"||t.type=="base64")return r;r=new Uint8Array(Ul(r))}return t.password&&typeof encrypt_agile<"u"?Cg(encrypt_agile(r,t.password),t):t.type==="file"?Zo(t.file,r):t.type=="string"?Uo(r):r}function DT(i,t){var e=t||{},n=Y3(i,e);return Cg(n,e)}function ar(i,t,e){e||(e="");var n=e+i;switch(t.type){case"base64":return qo(fr(n));case"binary":return fr(n);case"string":return i;case"file":return Zo(t.file,n,"utf8");case"buffer":return bt?xr(n,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(n):ar(n,{type:"binary"}).split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function RT(i,t){switch(t.type){case"base64":return qo(i);case"binary":return i;case"string":return i;case"file":return Zo(t.file,i,"binary");case"buffer":return bt?xr(i,"binary"):i.split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Tl(i,t){switch(t.type){case"string":case"base64":case"binary":for(var e="",n=0;n<i.length;++n)e+=String.fromCharCode(i[n]);return t.type=="base64"?qo(e):t.type=="string"?Uo(e):e;case"file":return Zo(t.file,i);case"buffer":return i;default:throw new Error("Unrecognized type "+t.type)}}function Sg(i,t){sb(),b3(i);var e=nn(t||{});if(e.cellStyles&&(e.cellNF=!0,e.sheetStubs=!0),e.type=="array"){e.type="binary";var n=Sg(i,e);return e.type="array",Ul(n)}var r=0;if(e.sheet&&(typeof e.sheet=="number"?r=e.sheet:r=i.SheetNames.indexOf(e.sheet),!i.SheetNames[r]))throw new Error("Sheet not found: "+e.sheet+" : "+typeof e.sheet);switch(e.bookType||"xlsb"){case"xml":case"xlml":return ar(X3(i,e),e);case"slk":case"sylk":return ar(_C.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"htm":case"html":return ar(vg(i.Sheets[i.SheetNames[r]],e),e);case"txt":return RT(wg(i.Sheets[i.SheetNames[r]],e),e);case"csv":return ar(ad(i.Sheets[i.SheetNames[r]],e),e,"\uFEFF");case"dif":return ar(vC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"dbf":return Tl(gC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"prn":return ar(xC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"rtf":return ar(TC.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"eth":return ar(Gh.from_sheet(i.Sheets[i.SheetNames[r]],e),e);case"fods":return ar(yg(i,e),e);case"wk1":return Tl(zp.sheet_to_wk1(i.Sheets[i.SheetNames[r]],e),e);case"wk3":return Tl(zp.book_to_wk3(i,e),e);case"biff2":e.biff||(e.biff=2);case"biff3":e.biff||(e.biff=3);case"biff4":return e.biff||(e.biff=4),Tl(_g(i,e),e);case"biff5":e.biff||(e.biff=5);case"biff8":case"xla":case"xls":return e.biff||(e.biff=8),DT(i,e);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return AT(i,e);default:throw new Error("Unrecognized bookType |"+e.bookType+"|")}}function NT(i){if(!i.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},e=i.file.slice(i.file.lastIndexOf(".")).toLowerCase();e.match(/^\.[a-z]+$/)&&(i.bookType=e.slice(1)),i.bookType=t[i.bookType]||i.bookType}}function Kl(i,t,e){var n=e||{};return n.type="file",n.file=t,NT(n),Sg(i,n)}function BT(i,t,e,n,r,a,o,u){var m=Oi(e),f=u.defval,h=u.raw||!Object.prototype.hasOwnProperty.call(u,"raw"),g=!0,v=r===1?[]:{};if(r!==1)if(Object.defineProperty)try{Object.defineProperty(v,"__rowNum__",{value:e,enumerable:!1})}catch{v.__rowNum__=e}else v.__rowNum__=e;if(!o||i[e])for(var b=t.s.c;b<=t.e.c;++b){var w=o?i[e][b]:i[n[b]+m];if(w===void 0||w.t===void 0){if(f===void 0)continue;a[b]!=null&&(v[a[b]]=f);continue}var x=w.v;switch(w.t){case"z":if(x==null)break;continue;case"e":x=x==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+w.t)}if(a[b]!=null){if(x==null)if(w.t=="e"&&x===null)v[a[b]]=null;else if(f!==void 0)v[a[b]]=f;else if(h&&x===null)v[a[b]]=null;else continue;else v[a[b]]=h&&(w.t!=="n"||w.t==="n"&&u.rawNumbers!==!1)?x:vr(w,x,u);x!=null&&(g=!1)}}return{row:v,isempty:g}}function Vl(i,t){if(i==null||i["!ref"]==null)return[];var e={t:"n",v:0},n=0,r=1,a=[],o=0,u="",m={s:{r:0,c:0},e:{r:0,c:0}},f=t||{},h=f.range!=null?f.range:i["!ref"];switch(f.header===1?n=1:f.header==="A"?n=2:Array.isArray(f.header)?n=3:f.header==null&&(n=0),typeof h){case"string":m=zt(h);break;case"number":m=zt(i["!ref"]),m.s.r=h;break;default:m=h}n>0&&(r=0);var g=Oi(m.s.r),v=[],b=[],w=0,x=0,C=Array.isArray(i),U=m.s.r,j=0,H={};C&&!i[U]&&(i[U]=[]);var K=f.skipHidden&&i["!cols"]||[],ce=f.skipHidden&&i["!rows"]||[];for(j=m.s.c;j<=m.e.c;++j)if(!(K[j]||{}).hidden)switch(v[j]=Li(j),e=C?i[U][j]:i[v[j]+g],n){case 1:a[j]=j-m.s.c;break;case 2:a[j]=v[j];break;case 3:a[j]=f.header[j-m.s.c];break;default:if(e==null&&(e={w:"__EMPTY",t:"s"}),u=o=vr(e,null,f),x=H[o]||0,!x)H[o]=1;else{do u=o+"_"+x++;while(H[u]);H[o]=x,H[u]=1}a[j]=u}for(U=m.s.r+r;U<=m.e.r;++U)if(!(ce[U]||{}).hidden){var we=BT(i,m,U,v,n,a,C,f);(we.isempty===!1||(n===1?f.blankrows!==!1:f.blankrows))&&(b[w++]=we.row)}return b.length=w,b}var Jp=/"/g;function LT(i,t,e,n,r,a,o,u){for(var m=!0,f=[],h="",g=Oi(e),v=t.s.c;v<=t.e.c;++v)if(n[v]){var b=u.dense?(i[e]||[])[v]:i[n[v]+g];if(b==null)h="";else if(b.v!=null){m=!1,h=""+(u.rawNumbers&&b.t=="n"?b.v:vr(b,null,u));for(var w=0,x=0;w!==h.length;++w)if((x=h.charCodeAt(w))===r||x===a||x===34||u.forceQuotes){h='"'+h.replace(Jp,'""')+'"';break}h=="ID"&&(h='"ID"')}else b.f!=null&&!b.F?(m=!1,h="="+b.f,h.indexOf(",")>=0&&(h='"'+h.replace(Jp,'""')+'"')):h="";f.push(h)}return u.blankrows===!1&&m?null:f.join(o)}function ad(i,t){var e=[],n=t??{};if(i==null||i["!ref"]==null)return"";var r=zt(i["!ref"]),a=n.FS!==void 0?n.FS:",",o=a.charCodeAt(0),u=n.RS!==void 0?n.RS:`
`,m=u.charCodeAt(0),f=new RegExp((a=="|"?"\\|":a)+"+$"),h="",g=[];n.dense=Array.isArray(i);for(var v=n.skipHidden&&i["!cols"]||[],b=n.skipHidden&&i["!rows"]||[],w=r.s.c;w<=r.e.c;++w)(v[w]||{}).hidden||(g[w]=Li(w));for(var x=0,C=r.s.r;C<=r.e.r;++C)(b[C]||{}).hidden||(h=LT(i,r,C,g,o,m,a,n),h!=null&&(n.strip&&(h=h.replace(f,"")),(h||n.blankrows!==!1)&&e.push((x++?u:"")+h)));return delete n.dense,e.join("")}function wg(i,t){t||(t={}),t.FS="	",t.RS=`
`;var e=ad(i,t);if(typeof Dt>"u"||t.type=="string")return e;var n=Dt.utils.encode(1200,e,"str");return"\xFF\xFE"+n}function VT(i){var t="",e,n="";if(i==null||i["!ref"]==null)return[];var r=zt(i["!ref"]),a="",o=[],u,m=[],f=Array.isArray(i);for(u=r.s.c;u<=r.e.c;++u)o[u]=Li(u);for(var h=r.s.r;h<=r.e.r;++h)for(a=Oi(h),u=r.s.c;u<=r.e.c;++u)if(t=o[u]+a,e=f?(i[h]||[])[u]:i[t],n="",e!==void 0){if(e.F!=null){if(t=e.F,!e.f)continue;n=e.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(e.f!=null)n=e.f;else{if(e.t=="z")continue;if(e.t=="n"&&e.v!=null)n=""+e.v;else if(e.t=="b")n=e.v?"TRUE":"FALSE";else if(e.w!==void 0)n="'"+e.w;else{if(e.v===void 0)continue;e.t=="s"?n="'"+e.v:n=""+e.v}}m[m.length]=t+"="+n}return m}function Eg(i,t,e){var n=e||{},r=+!n.skipHeader,a=i||{},o=0,u=0;if(a&&n.origin!=null)if(typeof n.origin=="number")o=n.origin;else{var m=typeof n.origin=="string"?Si(n.origin):n.origin;o=m.r,u=m.c}var f,h={s:{c:0,r:0},e:{c:u,r:o+t.length-1+r}};if(a["!ref"]){var g=zt(a["!ref"]);h.e.c=Math.max(h.e.c,g.e.c),h.e.r=Math.max(h.e.r,g.e.r),o==-1&&(o=g.e.r+1,h.e.r=o+t.length-1+r)}else o==-1&&(o=0,h.e.r=t.length-1+r);var v=n.header||[],b=0;t.forEach(function(x,C){Di(x).forEach(function(U){(b=v.indexOf(U))==-1&&(v[b=v.length]=U);var j=x[U],H="z",K="",ce=It({c:u+b,r:o+C+r});f=Qo(a,ce),j&&typeof j=="object"&&!(j instanceof Date)?a[ce]=j:(typeof j=="number"?H="n":typeof j=="boolean"?H="b":typeof j=="string"?H="s":j instanceof Date?(H="d",n.cellDates||(H="n",j=tn(j)),K=n.dateNF||ni[14]):j===null&&n.nullError&&(H="e",j=0),f?(f.t=H,f.v=j,delete f.w,delete f.R,K&&(f.z=K)):a[ce]=f={t:H,v:j},K&&(f.z=K))})}),h.e.c=Math.max(h.e.c,u+v.length-1);var w=Oi(o);if(r)for(b=0;b<v.length;++b)a[Li(b+u)+w]={t:"s",v:v[b]};return a["!ref"]=fi(h),a}function UT(i,t){return Eg(null,i,t)}function Qo(i,t,e){if(typeof t=="string"){if(Array.isArray(i)){var n=Si(t);return i[n.r]||(i[n.r]=[]),i[n.r][n.c]||(i[n.r][n.c]={t:"z"})}return i[t]||(i[t]={t:"z"})}return typeof t!="number"?Qo(i,It(t)):Qo(i,It({r:t,c:e||0}))}function jT(i,t){if(typeof t=="number"){if(t>=0&&i.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var e=i.SheetNames.indexOf(t);if(e>-1)return e;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function WT(){return{SheetNames:[],Sheets:{}}}function HT(i,t,e,n){var r=1;if(!e)for(;r<=65535&&i.SheetNames.indexOf(e="Sheet"+r)!=-1;++r,e=void 0);if(!e||i.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&i.SheetNames.indexOf(e)>=0){var a=e.match(/(^.*?)(\d+)$/);r=a&&+a[2]||0;var o=a&&a[1]||e;for(++r;r<=65535&&i.SheetNames.indexOf(e=o+r)!=-1;++r);}if(pg(e),i.SheetNames.indexOf(e)>=0)throw new Error("Worksheet with name |"+e+"| already exists!");return i.SheetNames.push(e),i.Sheets[e]=t,e}function zT(i,t,e){i.Workbook||(i.Workbook={}),i.Workbook.Sheets||(i.Workbook.Sheets=[]);var n=jT(i,t);switch(i.Workbook.Sheets[n]||(i.Workbook.Sheets[n]={}),e){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+e)}i.Workbook.Sheets[n].Hidden=e}function $T(i,t){return i.z=t,i}function Tg(i,t,e){return t?(i.l={Target:t},e&&(i.l.Tooltip=e)):delete i.l,i}function GT(i,t,e){return Tg(i,"#"+t,e)}function qT(i,t,e){i.c||(i.c=[]),i.c.push({t,a:e||"SheetJS"})}function XT(i,t,e,n){for(var r=typeof t!="string"?t:zt(t),a=typeof t=="string"?t:fi(t),o=r.s.r;o<=r.e.r;++o)for(var u=r.s.c;u<=r.e.c;++u){var m=Qo(i,o,u);m.t="n",m.F=a,delete m.v,o==r.s.r&&u==r.s.c&&(m.f=e,n&&(m.D=!0))}return i}var rn={encode_col:Li,encode_row:Oi,encode_cell:It,encode_range:fi,decode_col:X0,decode_row:q0,split_cell:cy,decode_cell:Si,decode_range:xn,format_cell:vr,sheet_add_aoa:Th,sheet_add_json:Eg,sheet_add_dom:xg,aoa_to_sheet:no,json_to_sheet:UT,table_to_sheet:bg,table_to_book:vT,sheet_to_csv:ad,sheet_to_txt:wg,sheet_to_json:Vl,sheet_to_html:vg,sheet_to_formulae:VT,sheet_to_row_object_array:Vl,sheet_get_cell:Qo,book_new:WT,book_append_sheet:HT,book_set_sheet_visibility:zT,cell_set_number_format:$T,cell_set_hyperlink:Tg,cell_set_internal_link:GT,cell_add_comment:qT,sheet_set_array_formula:XT,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};var M7=$o.version;var Yl=class i{constructor(t){this.http=t}apiUrl=`${Ge.apiUrl}/surtirFarmacias`;obtenerPendientes(t){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!1})}surtirFarmacia(t,e){return this.http.put(this.apiUrl,{farmaciaId:t,confirm:!0,detalles:e})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};function YT(i,t){if(i&1&&(l(0,"option",6),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function QT(i,t){if(i&1){let e=ie();l(0,"div",13)(1,"button",18),E("click",function(){T(e);let r=_(2);return P(r.imprimirPrevia())}),d(2," Imprimir previa "),s()()}}function JT(i,t){if(i&1){let e=ie();l(0,"div",13)(1,"button",14),E("click",function(){T(e);let r=_();return P(r.omitirTodos())}),d(2,"Omitir todos"),s(),l(3,"button",15),E("click",function(){T(e);let r=_();return P(r.quitarOmisiones())}),d(4,"Quitar omisiones"),s(),l(5,"span",16),d(6," Omitidos: "),l(7,"strong"),d(8),s(),d(9),s(),N(10,QT,3,0,"div",9),l(11,"button",17),E("click",function(){T(e);let r=_();return P(r.exportarExcel())}),d(12," Exportar a Excel "),s()()}if(i&2){let e=_();c(8),k(e.totalOmitidos),c(),R(" / ",e.rows.length," "),c(),p("ngIf",e.pendientes.length),c(),p("disabled",!e.rows.length)}}function ZT(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td",21)(2,"input",22),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.omitir,r)||(a.omitir=r),P(r)}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),s(),l(15,"td",23),d(16),s(),l(17,"td"),d(18),s()()}if(i&2){let e=t.$implicit;Re("omitido",e.omitir),c(2),Xr("name","omitir_",e.producto,""),Q("ngModel",e.omitir),Je("aria-label","Omitir "+e.nombre),c(2),k(e.nombre),c(2),k(e.codigoBarras),c(2),k(e.categoria),c(2),k(e.existenciaActual),c(2),k(e.stockMin),c(2),k(e.stockMax),c(2),k(e.falta),c(2),k(e.disponibleEnAlmacen)}}function eP(i,t){if(i&1&&(l(0,"table",19)(1,"thead")(2,"tr")(3,"th"),d(4,"Omit"),s(),l(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3d. Barras"),s(),l(9,"th"),d(10,"Categor\xEDa"),s(),l(11,"th"),d(12,"Existencia"),s(),l(13,"th"),d(14,"Stock M\xEDnimo"),s(),l(15,"th"),d(16,"Stock M\xE1ximo"),s(),l(17,"th"),d(18,"Cantidad a Surtir"),s(),l(19,"th"),d(20,"Disponible Almac\xE9n"),s()()(),l(21,"tbody"),N(22,ZT,19,14,"tr",20),s()()),i&2){let e=_();c(22),p("ngForOf",e.pagedRows)("ngForTrackBy",e.trackByProd)}}function tP(i,t){if(i&1){let e=ie();l(0,"div",24)(1,"button",25),E("click",function(){T(e);let r=_();return P(r.goFirst())}),y(2,"i",26),s(),l(3,"button",27),E("click",function(){T(e);let r=_();return P(r.goPrev())}),y(4,"i",28),s(),d(5),l(6,"button",29),E("click",function(){T(e);let r=_();return P(r.goNext())}),y(7,"i",30),s(),l(8,"button",31),E("click",function(){T(e);let r=_();return P(r.goLast())}),y(9,"i",32),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),Cn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}function iP(i,t){if(i&1){let e=ie();l(0,"div",33)(1,"button",34),E("click",function(){T(e);let r=_();return P(r.onCancelar())}),d(2,"Cancelar"),s(),l(3,"button",35),E("click",function(){T(e);let r=_();return P(r.onSurtir())}),d(4," Surtir "),s()()}if(i&2){let e=_();c(3),p("disabled",e.rows.length>0&&e.totalOmitidos===e.rows.length)}}var Ql=class i{constructor(t,e,n){this.fb=t;this.farmaciaService=e;this.surtidoService=n;this.form=this.fb.group({farmaciaId:[null,Pe.required]})}form;farmacias=[];pendientes=[];cargando=!1;rows=[];page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}trackByProd=(t,e)=>e.producto||e.codigoBarras;ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe(t=>{this.farmacias=t})}toggleFarmacia(t){let e=this.form.get("farmaciaId");t?e.disable():e.enable()}onAceptar(){if(this.form.invalid)return;this.cargando=!0;let t=this.form.value.farmaciaId;this.surtidoService.obtenerPendientes(t).subscribe({next:({pendientes:e})=>{if(this.pendientes=(e||[]).map(n=>jt(Qe({},n),{omitir:!1})),console.log("Pendientes",e),this.rows=this.pendientes,this.resetPagination(),this.cargando=!1,this.rows.length===0){jn.default.fire({icon:"info",title:"Sin pendientes",html:"No hay productos con existencia <= stock m\xEDnimo",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1});return}this.toggleFarmacia(!0)},error:e=>{console.error(e),jn.default.fire("Error","No se pudieron cargar los productos.","error"),this.cargando=!1}})}get totalOmitidos(){return this.rows.filter(t=>t.omitir).length}omitirTodos(){this.rows.forEach(t=>t.omitir=!0)}quitarOmisiones(){this.rows.forEach(t=>t.omitir=!1)}onSurtir(){let t=this.form.value.farmaciaId,e=this.farmacias.find(r=>r._id===t)?.nombre||"",n=this.rows.map(r=>({producto:r.producto,omitir:!!r.omitir}));jn.default.fire({icon:"question",title:"Confirmar surtido",html:`
      Se surtir\xE1 a la farmacia <strong>${e}</strong> respetando las omisiones marcadas.<br>
      <small>Omitidos: ${this.totalOmitidos} / ${this.rows.length}</small>
    `,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1}).then(r=>{if(!r.isConfirmed){this.toggleFarmacia(!1);return}jn.default.fire({title:"Surtido en progreso...",html:"Generando hoja y actualizando inventarios.",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>jn.default.showLoading()}),this.surtidoService.surtirFarmacia(t,n).pipe(ym(()=>{})).subscribe({next:a=>{jn.default.close(),jn.default.fire({icon:"success",title:"Surtido completado",html:"\xBFDeseas imprimir la hoja de surtido?",showCancelButton:!0,confirmButtonText:"S\xED",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then(o=>{o.isConfirmed&&a?.surtido&&this.imprimirReal(a.surtido),this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)})},error:a=>{console.error(a),jn.default.close();let o=a?.error?.detalle||a?.error?.mensaje||"No se pudo surtir la farmacia.";jn.default.fire("Aviso",o,"warning"),this.toggleFarmacia(!1)}})})}onCancelar(){this.pendientes=[],this.form.reset({farmaciaId:null}),this.toggleFarmacia(!1)}fmtFecha(t=new Date){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())} ${e(t.getHours())}:${e(t.getMinutes())}`}buildHTMLPrevia(){let t=this.form.value.farmaciaId,e=this.farmacias.find(a=>a._id===t)?.nombre||"",n=this.fmtFecha(),r=this.rows.map(a=>{let o=a.omitir?' class="omitida"':"",u=a.omitir?'<span class="chip chip-omit">OMITIDO</span>':"";return`
      <tr${o}>
        <td>${a.codigoBarras||""}</td>
        <td>${a.nombre||""} ${u}</td>
        <td style="text-align:right">${a.existenciaActual??0}</td>
        <td style="text-align:right">${a.stockMin??0}</td>
        <td style="text-align:right">${a.stockMax??0}</td>
        <td style="text-align:right">${a.falta??0}</td>
        <td style="text-align:right">${a.disponibleEnAlmacen??0}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Previa</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  .omitida { color: #777; }
  .chip { display:inline-block; border:1px solid #aaa; padding:1px 5px; border-radius:8px; font-size:10px; margin-left:6px; }
  .chip-omit { border-color:#b55; color:#b55; }
  .leyenda { font-size:10px; color:#555; margin-top:8px; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Previa)</p>
    <p class="sub">${e?`Farmacia: <b>${e}</b>`:""}</p>
  </div>

  <div class="meta">
    Fecha: <b>${n}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:70px; text-align:right">Exist.</th>
        <th style="width:70px; text-align:right">Stock Min</th>
        <th style="width:70px; text-align:right">Stock Max</th>
        <th style="width:90px; text-align:right">Cant. a Surtir</th>
        <th style="width:100px; text-align:right">Disp. Almac\xE9n</th>
      </tr>
    </thead>
    <tbody>
      ${r}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="7">Registros: ${this.rows.length} \u2014 Omitidos: ${this.totalOmitidos}</td>
      </tr>
    </tfoot>
  </table>
  <p class="leyenda">Esta es una previsualizaci\xF3n. La hoja real puede variar seg\xFAn disponibilidad por lotes.</p>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}buildHTMLReal(t){let e=this.form.value.farmaciaId,n=this.farmacias.find(o=>o._id===e)?.nombre||"",r=t?.fechaSurtido?this.fmtFecha(new Date(t.fechaSurtido)):this.fmtFecha(),a=(t?.items||[]).map(o=>{let u=o?.producto?.nombre||"",m=o?.producto?.codigoBarras||"",f=o?.lote||"SIN-LOTE",h=o?.cantidad??0,g=o?.producto?.categoria||"-",v=o?.producto?.ubicacion||"-";return`
      <tr>
        <td>${m}</td>
        <td>${u}</td>
        <td>${f}</td>
        <td style="text-align:right">${h}</td>
        <td>${g}</td>
        <td>${v}</td>
      </tr>`}).join("");return`
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hoja de Surtido - Final</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: Arial, Helvetica, sans-serif; margin: 12px; }
  .encabezado { text-align:center; margin-bottom: 8px; }
  .titulo { font-size: 16px; margin: 0; font-weight: 700; }
  .sub { font-size: 12px; margin: 0; color: #444; }
  .meta { font-size: 11px; margin: 6px 0 12px; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; }
  th { background:#f6f6f6; text-align:left; }
  tfoot td { border-top: 2px solid #000; font-weight: bold; }
  @media print {
    @page { size: Letter portrait; margin: 10mm; }
    body { margin: 0; }
    .no-print { display:none !important; }
  }
</style>
</head>
<body>
  <div class="encabezado">
    <p class="titulo">Hoja de Surtido (Real)</p>
    <p class="sub">${n?`Farmacia: <b>${n}</b>`:""}</p>
  </div>

  <div class="meta">
    Surtido ID: <b>${t?._id||"-"}</b><br>
    Fecha surtido: <b>${r}</b>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:100px">C\xF3digo</th>
        <th>Producto</th>
        <th style="width:90px">Lote</th>
        <th style="width:80px; text-align:right">Cantidad</th>
        <th style="width:100px">Categoria</th>
        <th style="width:100px">Ubicacion</th>
      </tr>
    </thead>
    <tbody>
      ${a||'<tr><td colspan="6">Sin items</td></tr>'}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="6">Productos surtidos: ${(t?.items||[]).length}</td>
      </tr>
    </tfoot>
  </table>

  <div class="no-print" style="margin-top:10px;">
    <button onclick="window.print()">Imprimir</button>
    <button onclick="window.close()">Cerrar</button>
  </div>
</body>
</html>`}printHTML(t){let e=window.open("","_blank","width=900,height=700");e&&(e.document.open(),e.document.write(t),e.document.close(),setTimeout(()=>e.focus(),50))}imprimirPrevia(){if(!this.rows.length)return;let t=this.buildHTMLPrevia();this.printHTML(t)}imprimirReal(t){let e=this.buildHTMLReal(t);this.printHTML(e)}exportarExcel(){if(!this.rows?.length){jn.default.fire("Aviso","No hay datos para exportar","info");return}let t=this.form.value.farmaciaId,e=this.farmacias.find(x=>x._id===t)?.nombre||"",n=new Date().toISOString().slice(0,19).replace("T"," "),r=this.rows.map(x=>({"C\xF3digo de barras":x.codigoBarras||"",Producto:x.nombre||"",Categor\u00EDa:x.categoria||"",Ubicaci\u00F3n:x.ubicacion||"","Existencia actual":x.existenciaActual??0,"Stock M\xEDn":x.stockMin??0,"Stock M\xE1x":x.stockMax??0,Falta:x.falta??0,"Disponible en almac\xE9n":x.disponibleEnAlmacen??0,Omitir:x.omitir?"S\xED":"No"})),a=rn.aoa_to_sheet([]);rn.sheet_add_aoa(a,[["Hoja de Surtido"],[`Farmacia: ${e}`],[`Generado: ${n}`],[""]],{origin:"A1"}),rn.sheet_add_json(a,r,{origin:"A5",skipHeader:!1}),a["!cols"]=[{wch:16},{wch:40},{wch:18},{wch:14},{wch:14},{wch:10},{wch:10},{wch:10},{wch:18},{wch:8}];let o=6,u=o+this.rows.length-1,m=[5,6,7,8,9];for(let x=o;x<=u;x++)for(let C of m){let U=rn.encode_cell({r:x-1,c:C-1}),j=a[U];j&&typeof j.v=="number"&&(j.z="#,##0")}let f=this.rows.reduce((x,C)=>x+(C.falta??0),0),h=this.rows.reduce((x,C)=>x+(C.disponibleEnAlmacen??0),0),g=`A${u+1}`;rn.sheet_add_aoa(a,[["","","","Totales:","","","",f,h,""]],{origin:g});let v=rn.book_new();rn.book_append_sheet(v,a,"Surtido");let w=`surtido_${(e||"sin-farmacia").replace(/[\\/:*?"<>|]/g,"_")}_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.xlsx`;Kl(v,w)}static \u0275fac=function(e){return new(e||i)(te(Jt),te(Zt),te(Yl))};static \u0275cmp=Te({type:i,selectors:[["app-surtir-farmacia"]],decls:18,vars:9,consts:[[1,"surtir-farmacia"],[1,"titulo-container"],[1,"titulo"],[2,"border-bottom","2px solid #0453b3","padding-bottom","1rem",3,"ngSubmit","formGroup"],[1,"subtitulo"],["formControlName","farmaciaId"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","submit","matTooltip","Buscar productos que requieren surtirse",1,"btn-gris",3,"disabled"],["class","toolbar","style","margin: .5rem 0; display:flex; gap:.5rem; align-items:center;",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","botones-accion",4,"ngIf"],[1,"toolbar",2,"margin",".5rem 0","display","flex","gap",".5rem","align-items","center"],["matTooltip","Marca todos como omitidos",1,"btn-gris",3,"click"],["matTooltip","Quita todas las omisiones",1,"btn-gris",3,"click"],[2,"margin-left","auto","font-size",".9rem"],["matTooltip","Exporta todos los registros de la tabla",1,"btn-amarillo",3,"click","disabled"],["matTooltip","Imprime la hoja de surtido con las omisiones",1,"btn-verde",3,"click"],[1,"tabla"],[3,"omitido",4,"ngFor","ngForOf","ngForTrackBy"],[2,"text-align","center"],["type","checkbox","matTooltip","Si est\xE1 activado, este producto no se surtir\xE1",1,"chk-omit",3,"ngModelChange","ngModel","name"],[1,"falta"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"botones-accion"],["matTooltip","Quitar lista sin surtir",1,"btn-rojo",3,"click"],["matTooltip","Surtir los productos de la lista",1,"btn-verde","a-la-derecha",3,"click","disabled"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"p",2),d(3,"Surtir Farmacias"),s()(),l(4,"form",3),E("ngSubmit",function(){return n.onAceptar()}),l(5,"label")(6,"span",4),d(7,"Farmacia:"),s(),l(8,"select",5)(9,"option",6),d(10,"-- Selecciona --"),s(),N(11,YT,2,2,"option",7),s()(),l(12,"button",8),d(13),s()(),N(14,JT,13,4,"div",9)(15,eP,23,2,"table",10)(16,tP,10,7,"div",11)(17,iP,5,1,"div",12),s()),e&2&&(c(4),p("formGroup",n.form),c(5),p("ngValue",null),c(2),p("ngForOf",n.farmacias),c(),p("disabled",n.form.invalid||n.cargando||n.pendientes.length>0),c(),R(" ",n.cargando?"Cargando\u2026":"Aceptar"," "),c(),p("ngIf",n.pendientes.length),c(),p("ngIf",n.pendientes.length),c(),p("ngIf",n.totalItems>0),c(),p("ngIf",n.pendientes.length))},dependencies:[Ae,We,Be,rt,Ft,it,nt,li,tt,ze,Mt,_t,Bt,ci,di,Lt,ut],styles:[".surtir-farmacia[_ngcontent-%COMP%]{max-width:100%;margin:1rem auto;padding:0 1rem}.omitido[_ngcontent-%COMP%]{opacity:.55}.chk-omit[_ngcontent-%COMP%]{appearance:auto;-webkit-appearance:checkbox;-moz-appearance:checkbox;transform:none;zoom:1;width:16px;height:16px;vertical-align:middle;margin:0;padding:0;cursor:pointer}form[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-end;margin-bottom:1rem}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-weight:700;color:#333}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.3rem;font-size:1rem;border-radius:5px;height:41px}input[_ngcontent-%COMP%]{width:150px}select[_ngcontent-%COMP%]{width:320px}select[_ngcontent-%COMP%]:disabled, input[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:1rem;cursor:pointer}button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.botones-accion[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.a-la-derecha[_ngcontent-%COMP%]{margin-left:auto}.falta[_ngcontent-%COMP%]{color:#8b0000;font-weight:500}"]})};var qi=hi(ki());var oo=class i{constructor(t){this.http=t}base=`${Ge.apiUrl}/compras`;headers(){return new qe({"x-auth-token":localStorage.getItem("auth_token")||""})}getCompras(){return this.http.get(this.base)}crearCompra(t){return this.http.post(this.base,t)}listar(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{r!=null&&r!==""&&(e=e.set(n,String(r)))}),this.http.get(`${this.base}/consulta`,{params:e})}searchProductos(t){let e=`${Ge.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(xt(n=>n?.data??n?.rows??n??[]),Pi(()=>lt([])))}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var rP=["backdrop"],aP=["firstInput"],Jl=i=>({"selected-radio":i}),oP=i=>({"selected-checkbox":i});function sP(i,t){if(i&1&&(l(0,"option",7),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function lP(i,t){if(i&1){let e=ie();l(0,"button",29),E("click",function(){T(e);let r=_();return P(r.limpiarProducto())}),y(1,"i",30),s()}}function cP(i,t){if(i&1&&(l(0,"span",31),d(1),s()),i&2){let e=_();c(),k(e.nombreProducto)}}function dP(i,t){if(i&1){let e=ie();l(0,"button",38),E("click",function(){let r=T(e).$implicit,a=_(3);return P(a.selectProd(r))}),l(1,"div",39),d(2),s(),l(3,"div",40),d(4),s()()}if(i&2){let e=t.$implicit;c(2),k(e.nombre||"(sin nombre)"),c(2),k(e.codigoBarras||"\u2014")}}function uP(i,t){if(i&1&&(l(0,"div",35)(1,"div",36),N(2,dP,5,2,"button",37),s()()),i&2){let e=_(2);c(2),p("ngForOf",e.prodOpts)}}function mP(i,t){if(i&1){let e=ie();l(0,"div",18)(1,"label"),d(2," Buscar producto (nombre o c\xF3digo): "),l(3,"div",32)(4,"input",33),E("input",function(r){T(e);let a=_();return P(a.onProdInput((r.target.value||"").trim()))}),s(),N(5,uP,3,1,"div",34),s()()()}if(i&2){let e=_();c(4),p("disabled",e.cargandoProducto),c(),p("ngIf",e.prodOpts.length)}}function fP(i,t){if(i&1&&(l(0,"small",55),d(1),s()),i&2){let e=_(2);c(),R(" Se enviar\xE1: ",e.itemForm.value.fechaCaducidad," ")}}function pP(i,t){i&1&&(l(0,"div",56),d(1," Fecha inv\xE1lida. Escribe "),l(2,"strong"),d(3,"mmAA"),s(),d(4," (p. ej. 0925 \u2192 2025-09-30). "),s())}function hP(i,t){if(i&1){let e=ie();l(0,"div",41)(1,"label",42),d(2,"Cantidad: "),y(3,"input",43),s(),l(4,"label",42),d(5,"Lote: "),y(6,"input",44),s(),l(7,"div",45)(8,"label",46),d(9,"Caducidad:"),s(),l(10,"input",47),E("blur",function(){let r;T(e);let a=_();return P((r=a.itemForm.get("caducidadMMAAAA"))==null?null:r.markAsTouched())}),s(),N(11,fP,2,1,"small",48)(12,pP,5,0,"div",49),s(),l(13,"label",42),d(14,"Costo U.: "),y(15,"input",50),s(),l(16,"label",42),d(17,"Precio U.: "),y(18,"input",51),s(),l(19,"label",42),d(20,"Stock m\xEDnimo.: "),y(21,"input",52),s(),l(22,"label",42),d(23,"Stock m\xE1ximo.: "),y(24,"input",53),s(),l(25,"button",54),E("click",function(){T(e);let r=_();return P(r.onAgregarItem())}),d(26,"Agregar al carrito"),s()()}if(i&2){let e,n=_();c(11),p("ngIf",n.itemForm.value.fechaCaducidad),c(),p("ngIf",((e=n.itemForm.get("caducidadMMAAAA"))==null?null:e.invalid)&&((e=n.itemForm.get("caducidadMMAAAA"))==null?null:e.touched)),c(13),p("disabled",n.itemForm.invalid)}}function gP(i,t){if(i&1){let e=ie();l(0,"div",95)(1,"div",96),d(2),s(),l(3,"div",71)(4,"input",68),Z("ngModelChange",function(r){let a=T(e).$implicit,o=_(5);return J(o.editPromos[a.prop].porcentaje,r)||(o.editPromos[a.prop].porcentaje=r),P(r)}),s()(),l(5,"div",69)(6,"input",72),Z("ngModelChange",function(r){let a=T(e).$implicit,o=_(5);return J(o.editPromos[a.prop].inicio,r)||(o.editPromos[a.prop].inicio=r),P(r)}),s()(),l(7,"div",69)(8,"input",72),Z("ngModelChange",function(r){let a=T(e).$implicit,o=_(5);return J(o.editPromos[a.prop].fin,r)||(o.editPromos[a.prop].fin=r),P(r)}),s()(),l(9,"div",71)(10,"div",97)(11,"input",81),Z("ngModelChange",function(r){let a=T(e).$implicit,o=_(5);return J(o.editPromos[a.prop].monedero,r)||(o.editPromos[a.prop].monedero=r),P(r)}),s()()()()}if(i&2){let e=t.$implicit,n=_(5);c(2),k(e.name),c(2),Q("ngModel",n.editPromos[e.prop].porcentaje),c(2),Q("ngModel",n.editPromos[e.prop].inicio),c(2),Q("ngModel",n.editPromos[e.prop].fin),c(3),Q("ngModel",n.editPromos[e.prop].monedero)}}function _P(i,t){if(i&1&&(l(0,"div",88)(1,"div",89)(2,"div",90),d(3,"D\xEDa"),s(),l(4,"div",91),d(5,"% Desc."),s(),l(6,"div",92),d(7,"Inicia"),s(),l(8,"div",92),d(9,"Termina"),s(),l(10,"div",93),d(11,"Monedero"),s()(),N(12,gP,12,5,"div",94),s()),i&2){let e=_(4);c(12),p("ngForOf",e.diasSemana)}}function vP(i,t){if(i&1){let e=ie();l(0,"div",98)(1,"div",89)(2,"div",91),d(3,"Cantidad"),s(),l(4,"div",99),d(5,"Inicia"),s(),l(6,"div",99),d(7,"Termina"),s()(),l(8,"div",100)(9,"div",71)(10,"select",101),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.promoCantidadRequerida,r)||(a.editPromos.promoCantidadRequerida=r),P(r)}),l(11,"option",7),d(12,"--"),s(),l(13,"option",7),d(14,"2x1"),s(),l(15,"option",7),d(16,"3x2"),s(),l(17,"option",7),d(18,"4x3"),s()()(),l(19,"div",102)(20,"input",72),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.inicioPromoCantidad,r)||(a.editPromos.inicioPromoCantidad=r),P(r)}),s()(),l(21,"div",102)(22,"input",72),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.finPromoCantidad,r)||(a.editPromos.finPromoCantidad=r),P(r)}),s()()()()}if(i&2){let e=_(4);c(10),Q("ngModel",e.editPromos.promoCantidadRequerida),c(),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(3),Q("ngModel",e.editPromos.inicioPromoCantidad),c(2),Q("ngModel",e.editPromos.finPromoCantidad)}}function xP(i,t){if(i&1){let e=ie();l(0,"div",103)(1,"div",89)(2,"div",91),d(3,"% Desc."),s(),l(4,"div",104),d(5,"Inicia"),s(),l(6,"div",104),d(7,"Termina"),s(),l(8,"div",93),d(9,"Monedero"),s()(),l(10,"div",71)(11,"input",68),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.promoDeTemporada.porcentaje,r)||(a.editPromos.promoDeTemporada.porcentaje=r),P(r)}),s()(),l(12,"div",105)(13,"input",72),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.promoDeTemporada.inicio,r)||(a.editPromos.promoDeTemporada.inicio=r),P(r)}),s()(),l(14,"div",105)(15,"input",72),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.promoDeTemporada.fin,r)||(a.editPromos.promoDeTemporada.fin=r),P(r)}),s()(),l(16,"div",71)(17,"div",97)(18,"input",81),Z("ngModelChange",function(r){T(e);let a=_(4);return J(a.editPromos.promoDeTemporada.monedero,r)||(a.editPromos.promoDeTemporada.monedero=r),P(r)}),s()()()()}if(i&2){let e=_(4);c(11),Q("ngModel",e.editPromos.promoDeTemporada.porcentaje),c(2),Q("ngModel",e.editPromos.promoDeTemporada.inicio),c(2),Q("ngModel",e.editPromos.promoDeTemporada.fin),c(3),Q("ngModel",e.editPromos.promoDeTemporada.monedero)}}function bP(i,t){if(i&1){let e=ie();l(0,"tr",64)(1,"td",65)(2,"div",66)(3,"div",67)(4,"label")(5,"strong"),d(6,"Cant.:"),s()(),l(7,"input",68),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.cantidad,r)||(a.cantidad=r),P(r)}),s()(),l(8,"div",69)(9,"label")(10,"strong"),d(11,"Lote:"),s()(),l(12,"input",70),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.lote,r)||(a.lote=r),P(r)}),s()(),l(13,"div",71)(14,"label")(15,"strong"),d(16,"Caducidad:"),s()(),l(17,"input",72),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.fechaCaducidad,r)||(a.fechaCaducidad=r),P(r)}),s()(),l(18,"div",71)(19,"label")(20,"strong"),d(21,"Costo:"),s()(),l(22,"input",73),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.costoUnitario,r)||(a.costoUnitario=r),P(r)}),s()(),l(23,"div",71)(24,"label")(25,"strong"),d(26,"Precio:"),s()(),l(27,"input",68),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.precioUnitario,r)||(a.precioUnitario=r),P(r)}),s()(),l(28,"div",67)(29,"label")(30,"strong"),d(31,"M\xEDn:"),s()(),l(32,"input",68),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.stockMinimo,r)||(a.stockMinimo=r),P(r)}),s()(),l(33,"div",67)(34,"label")(35,"strong"),d(36,"M\xE1x:"),s()(),l(37,"input",68),Z("ngModelChange",function(r){T(e);let a=_().$implicit;return J(a.stockMaximo,r)||(a.stockMaximo=r),P(r)}),s()()(),l(38,"div",74)(39,"div",75)(40,"label"),d(41,"Elige promoci\xF3n:"),s()(),l(42,"div",71)(43,"label",76)(44,"input",77),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),P(r)}),s(),d(45," Ninguna "),s()(),l(46,"div",71)(47,"label",76)(48,"input",78),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),P(r)}),s(),d(49," Por d\xEDa "),s()(),l(50,"div",71)(51,"label",76)(52,"input",79),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),P(r)}),s(),d(53," Cantidad "),s()(),l(54,"div",71)(55,"label",76)(56,"input",80),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.editPromos.tipoPromocion,r)||(a.editPromos.tipoPromocion=r),P(r)}),s(),d(57," Temporada "),s()(),l(58,"div",71)(59,"label",76),d(60," INAPAM(+5%) "),l(61,"input",81),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.editPromos.descuentoINAPAM,r)||(a.editPromos.descuentoINAPAM=r),P(r)}),s()()()(),N(62,_P,13,1,"div",82)(63,vP,23,7,"div",83)(64,xP,19,4,"div",84),l(65,"div",85)(66,"button",86),E("click",function(){T(e);let r=_(3);return P(r.cancelPromos())}),d(67,"Cancelar"),s(),l(68,"button",87),E("click",function(){T(e);let r=_().index,a=_(2);return P(a.savePromos(r))}),d(69,"Guardar"),s()()()()}if(i&2){let e=_(),n=e.$implicit,r=e.index,a=_(2);c(7),Q("ngModel",n.cantidad),c(5),Q("ngModel",n.lote),c(5),Q("ngModel",n.fechaCaducidad),c(5),Q("ngModel",n.costoUnitario),c(5),Q("ngModel",n.precioUnitario),c(5),Q("ngModel",n.stockMinimo),c(5),Q("ngModel",n.stockMaximo),c(6),p("ngClass",gi(28,Jl,a.editPromos.tipoPromocion==="ninguna")),c(),Xr("name","promo-",r,""),Q("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",gi(30,Jl,a.editPromos.tipoPromocion==="dia")),c(),Xr("name","promo-",r,""),Q("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",gi(32,Jl,a.editPromos.tipoPromocion==="cantidad")),c(),Xr("name","promo-",r,""),Q("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",gi(34,Jl,a.editPromos.tipoPromocion==="temporada")),c(),Xr("name","promo-",r,""),Q("ngModel",a.editPromos.tipoPromocion),c(3),p("ngClass",gi(36,oP,a.editPromos.descuentoINAPAM)),c(2),Q("ngModel",a.editPromos.descuentoINAPAM),c(),p("ngIf",a.editPromos.tipoPromocion==="dia"),c(),p("ngIf",a.editPromos.tipoPromocion==="cantidad"),c(),p("ngIf",a.editPromos.tipoPromocion==="temporada")}}function yP(i,t){if(i&1){let e=ie();at(0),l(1,"tr")(2,"td")(3,"button",61),E("click",function(){let r=T(e).index,a=_(2);return P(a.onEliminarItem(r))}),y(4,"i",30),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),F(15,"date"),s(),l(16,"td"),d(17),F(18,"currency"),s(),l(19,"td"),d(20),F(21,"currency"),s(),l(22,"td"),d(23),s(),l(24,"td"),d(25),s(),l(26,"td"),d(27),F(28,"currency"),s(),l(29,"button",62),E("click",function(){let r=T(e).index,a=_(2);return P(a.toggleEditPromo(r))}),l(30,"mat-icon"),d(31),s()()(),N(32,bP,70,38,"tr",63),ot()}if(i&2){let e=t.$implicit,n=t.index,r=_(2);c(6),k(e.nombre),c(2),k(e.codigoBarras),c(2),k(e.cantidad),c(2),k(e.lote),c(2),k(Y(15,15,e.fechaCaducidad,"dd/MM/yyyy")),c(3),k(oe(18,18,e.costoUnitario)),c(3),k(oe(21,20,e.precioUnitario)),c(3),k(e.stockMinimo),c(2),k(e.stockMaximo),c(2),k(oe(28,22,e.costoUnitario*e.cantidad)),c(2),Rs(r.editingPromoIndex===n?"btn-icono btn-rojo":"btn-icono btn-verde"),p("matTooltip",r.editingPromoIndex===n?"Cerrar la edici\xF3n":"Editar promos y cantidades"),c(2),k(r.editingPromoIndex===n?"close":"edit"),c(),p("ngIf",r.editingPromoIndex===n)}}function CP(i,t){if(i&1&&(l(0,"table",57)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Producto"),s(),l(6,"th"),d(7,"Codigo barras"),s(),l(8,"th"),d(9,"Cant."),s(),l(10,"th"),d(11,"Lote"),s(),l(12,"th"),d(13,"Caducidad"),s(),l(14,"th"),d(15,"Costo U."),s(),l(16,"th"),d(17,"Precio U."),s(),l(18,"th"),d(19,"Stock M\xEDn."),s(),l(20,"th"),d(21,"Stock M\xE1x."),s(),l(22,"th"),d(23,"Subtotal"),s(),y(24,"th"),s()(),l(25,"tbody"),N(26,yP,33,24,"ng-container",58),s(),l(27,"tfoot")(28,"tr")(29,"td",59),d(30,"Total:"),s(),l(31,"td",60),d(32),F(33,"currency"),s()()()()),i&2){let e=_();c(26),p("ngForOf",e.carrito),c(6),k(oe(33,2,e.total))}}function SP(i,t){if(i&1){let e=ie();l(0,"div",106,0),E("keydown.escape",function(){T(e);let r=_();return P(r.cerrarNuevoProducto())}),l(2,"div",107),E("mousedown",function(r){return T(e),P(r.stopPropagation())})("click",function(r){return T(e),P(r.stopPropagation())}),l(3,"h3",108),d(4,"Nuevo producto"),s(),l(5,"form",109)(6,"div",110)(7,"div",111)(8,"label"),d(9,"Nombre *"),s(),y(10,"input",112,1),s(),l(12,"div",69)(13,"label"),d(14,"C\xF3digo de barras *"),s(),y(15,"input",113),s(),l(16,"div",69)(17,"label"),d(18,"Categor\xEDa *"),s(),y(19,"input",114),s(),l(20,"div",71)(21,"label"),d(22,"Unidad *"),s(),y(23,"input",115),s(),l(24,"div",71)(25,"label"),d(26,"Precio *"),s(),y(27,"input",116),s(),l(28,"div",71)(29,"label"),d(30,"Costo *"),s(),y(31,"input",117),s(),l(32,"div",71)(33,"label"),d(34,"Stock M\xEDn *"),s(),y(35,"input",118),s(),l(36,"div",71)(37,"label"),d(38,"Stock M\xE1x *"),s(),y(39,"input",119),s(),l(40,"div",120)(41,"label",121),d(42,"IVA"),s(),y(43,"input",122),s(),l(44,"div",120)(45,"label",123),d(46,"Gen\xE9rico"),s(),y(47,"input",124),s(),l(48,"div",120)(49,"label",125),d(50,"INAPAM"),s(),y(51,"input",126),s(),l(52,"div",71)(53,"label"),d(54,"Ubicaci\xF3n"),s(),y(55,"input",127),s()()(),l(56,"div",128)(57,"button",129),E("click",function(){T(e);let r=_();return P(r.cerrarNuevoProducto())}),d(58,"Cancelar"),s(),l(59,"button",130),E("click",function(){T(e);let r=_();return P(r.guardarNuevoProducto())}),d(60),s()()()()}if(i&2){let e=_();c(5),p("formGroup",e.nuevoProductoForm),c(54),p("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),c(),R(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var Zl=class i{constructor(t,e,n,r,a,o){this.fb=t;this.proveedorService=e;this.productoService=n;this.compraService=r;this.renderer=o;a.addIcons(Sn)}backdrop;firstInput;headerForm;itemForm;carrito=[];total=0;nombreProducto="";codBarras="";cargandoProducto=!1;productoEncontrado=!1;cargando=!1;prodInput$=new yt;prodOpts=[];subs=[];prodSel=null;proveedores=[];productos=[];editingPromoIndex=null;editPromos={};diasSemana=[{name:"Lunes",prop:"promoLunes"},{name:"Martes",prop:"promoMartes"},{name:"Mi\xE9rcoles",prop:"promoMiercoles"},{name:"Jueves",prop:"promoJueves"},{name:"Viernes",prop:"promoViernes"},{name:"S\xE1bado",prop:"promoSabado"},{name:"Domingo",prop:"promoDomingo"}];mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;faPlus=Sn;toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}hoyISO=this.toLocalISODate(new Date);ngOnInit(){this.initForms(),this.itemForm.get("lote").valueChanges.subscribe(t=>{let e=(t??"").toUpperCase().replace(/[^A-Z0-9]/g,"");e!==t&&this.itemForm.patchValue({lote:e},{emitEvent:!1})}),this.itemForm.get("caducidadMMAAAA").valueChanges.subscribe(t=>{let e=(t??"").toString().replace(/\D/g,"");if(e!==t&&this.itemForm.patchValue({caducidadMMAAAA:e},{emitEvent:!1}),e.length!==4){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let n=+e.slice(0,2),r=+e.slice(2);if(n<1||n>12){this.itemForm.patchValue({fechaCaducidad:null},{emitEvent:!1});return}let a=2e3+r,o=new Date(a,n,0),u=String(o.getFullYear()),m=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0");this.itemForm.patchValue({fechaCaducidad:`${u}-${m}-${f}`},{emitEvent:!1})}),this.loadProveedores(),this.loadProductos(),this.subs.push(this.prodInput$.pipe(xt(t=>(t||"").trim()),dn(180),un(),Ui(t=>t.length<2?lt([]):this.compraService.searchProductos(t))).subscribe(t=>{this.prodOpts=Array.isArray(t)?t:[]})),this.nuevoProductoForm=this.fb.group({nombre:["",[Pe.required,Pe.minLength(3)]],codigoBarras:["",Pe.required],unidad:["",Pe.required],precio:[null,[Pe.required,Pe.min(0)]],costo:[null,[Pe.required,Pe.min(0)]],iva:[!1],stockMinimo:[50,[Pe.required,Pe.min(0)]],stockMaximo:[100,[Pe.required,Pe.min(0)]],ubicacion:[""],categoria:["",Pe.required],generico:[!1],descuentoINAPAM:[!1]})}mmYyValidator(t){let e=(t.value??"").toString().replace(/\D/g,"");if(e==="")return null;if(!/^\d{4}$/.test(e))return{mmYy:!0};let n=+e.slice(0,2),r=+e.slice(2);return n<1||n>12?{mmYy:!0}:null}initForms(){this.headerForm=this.fb.group({proveedor:[null,Pe.required],fechaCompra:[this.hoyISO],afectarExistencias:[!0]}),this.itemForm=this.fb.group({nombre:["",Pe.required],codigoBarras:["",Pe.required],cantidad:[1,[Pe.required,Pe.min(1)]],lote:["",[Pe.required,Pe.pattern(/^[A-Z0-9]*$/)]],caducidadMMAAAA:["",[this.mmYyValidator]],fechaCaducidad:[null,Pe.required],costoUnitario:[0,[Pe.required,Pe.min(0)]],precioUnitario:[0,[Pe.required,Pe.min(0)]],stockMinimo:[1,[Pe.required,Pe.min(1)]],stockMaximo:[1,[Pe.required,Pe.min(1)]],promociones:this.fb.group(Qe({tipoPromocion:["ninguna"],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporada:this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]}),descuentoINAPAM:[!1]},this.getDiasSemanaForm()))})}getDiasSemanaForm(){let t={};for(let e of this.diasSemana)t[e.prop]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[!1]});return t}loadProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=t.sort((e,n)=>e.nombre.localeCompare(n.nombre,"es",{sensitivity:"base"}))})}loadProductos(){this.productoService.obtenerProductos().subscribe(t=>this.productos=t)}onBuscarProducto(){return Le(this,null,function*(){let t=this.itemForm.get("codigoBarras")?.value?.trim();if(!t)return;this.cargandoProducto=!0,yield new Promise(n=>setTimeout(n,50));let e=this.productos.find(n=>n.codigoBarras===t);if(!e){yield qi.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(e)})}detectarTipoPromocion(t){return t.promoDeTemporada?"temporada":t.promoCantidadRequerida?"cantidad":this.diasSemana.some(e=>t[e.prop]!=null)?"dia":"ninguna"}mapDiasSemana(t){let e={};for(let n of this.diasSemana)e[n.prop]={porcentaje:t[n.prop]?.porcentaje??null,inicio:this.toDate(t[n.prop]?.inicio),fin:this.toDate(t[n.prop]?.fin),monedero:t[n.prop]?.monedero??!1};return e}limpiarProducto(){this.nombreProducto="",this.productoEncontrado=!1,this.itemForm.reset(),this.itemForm.get("codigoBarras")?.enable()}onAgregarItem(){if(this.itemForm.invalid){qi.default.fire("Formulario incompleto","Por favor llena todos los campos.","warning");return}let t=this.itemForm.value,e={nombre:t.nombre,codigoBarras:this.codBarras,cantidad:t.cantidad,lote:t.lote,fechaCaducidad:t.fechaCaducidad,costoUnitario:t.costoUnitario,precioUnitario:t.precioUnitario,stockMinimo:t.stockMinimo,stockMaximo:t.stockMaximo,promociones:t.promociones};this.carrito.push(e),this.calcularTotal(),this.limpiarProducto()}calcularTotal(){this.total=this.carrito.reduce((t,e)=>t+e.costoUnitario*e.cantidad,0)}onEliminarItem(t){this.carrito.splice(t,1),this.calcularTotal()}estaEditandoPromos=!1;toggleEditPromo(t){if(this.estaEditandoPromos=!0,this.calcularTotal(),this.editingPromoIndex===t){this.editingPromoIndex=null,this.estaEditandoPromos=!1;return}let e=this.carrito[t].promociones;if(this.editingPromoIndex=t,this.editPromos=JSON.parse(JSON.stringify(e)),this.editPromos.tipoPromocion==="dia")for(let n of this.diasSemana)this.editPromos[n.prop]??={porcentaje:null,inicio:null,fin:null,monedero:!1}}savePromos(t){this.carrito[t].promociones=JSON.parse(JSON.stringify(this.editPromos)),this.editingPromoIndex=null,this.estaEditandoPromos=!1}cancelPromos(){this.editingPromoIndex=null,this.estaEditandoPromos=!1}onRegistrarCompra(){if(this.headerForm.invalid||this.carrito.length===0){qi.default.fire("Datos incompletos","Selecciona proveedor y agrega productos.","warning");return}let t=this.headerForm.value.fechaCompra;if(t){let u=new Date(this.hoyISO);if(new Date(t)>u){qi.default.fire("Fecha inv\xE1lida","La fecha de compra no puede ser futura.","warning");return}}let e=this.headerForm.value.proveedor,r=this.proveedores.find(u=>u._id===e)?.nombre||"Desconocido",a=t?new Date(`${t}T12:00:00`).toISOString():null,o=!!this.headerForm.value.afectarExistencias;qi.default.fire({icon:"question",title:"Confirmar compra",html:`
      Proveedor: <strong>${r}</strong><hr>
      <div>Fecha compra: <strong>${t||this.hoyISO}</strong></div>
      <div>Afectar existencias: <strong>${o?"S\xED":"No"}</strong></div>
      <h2 style="color: blue">Total: <strong>$${this.total.toFixed(2)}</strong></h2>`,showCancelButton:!0,confirmButtonText:"Registrar"}).then(u=>{if(!u.isConfirmed)return;qi.default.showLoading();let m={proveedor:this.headerForm.value.proveedor,afectarExistencias:o,productos:this.carrito.map(f=>({codigoBarras:f.codigoBarras,cantidad:f.cantidad,lote:f.lote,fechaCaducidad:f.fechaCaducidad,costoUnitario:f.costoUnitario,precioUnitario:f.precioUnitario,stockMinimo:f.stockMinimo,stockMaximo:f.stockMaximo,promociones:f.promociones}))};a&&(m.fechaCompra=a),this.compraService.crearCompra(m).subscribe({next:()=>{qi.default.hideLoading(),qi.default.fire("Compra registrada","Se guard\xF3 correctamente.","success"),this.resetCompras()},error:f=>{qi.default.hideLoading(),console.error(f),qi.default.fire("Error","No se pudo registrar la compra.","error")}})})}resetCompras(){this.headerForm.reset(),this.carrito=[],this.total=0}toDate(t){return t?new Date(t).toISOString().substring(0,10):null}onProdInput(t){this.prodInput$.next(t)}selectProd(t,e){return Le(this,null,function*(){this.prodSel=t,this.prodOpts=[],e&&(e.value=""),this.cargandoProducto=!0,yield new Promise(r=>setTimeout(r,50));let n=this.productos.find(r=>r.codigoBarras===t.codigoBarras);if(!n){yield qi.default.fire({icon:"warning",title:"No encontrado",text:`Producto con c\xF3digo ${t.codigoBarras} no existe.`,confirmButtonText:"Aceptar"}),this.limpiarProducto();return}this.applyProducto(n)})}applyProducto(t){if(!t)return;this.nombreProducto=t.nombre||"",this.codBarras=t.codigoBarras||"",this.productoEncontrado=!!this.nombreProducto,this.cargandoProducto=!1,this.itemForm.get("codigoBarras")?.setValue(this.codBarras),this.itemForm.get("codigoBarras")?.disable();let e=this.detectarTipoPromocion(t);this.itemForm.patchValue({nombre:t.nombre,codBarras:this.codBarras,cantidad:1,lote:"",caducidadMMAAAA:"",fechaCaducidad:null,costoUnitario:t.costo??0,precioUnitario:t.precio??0,stockMinimo:t.stockMinimo??1,stockMaximo:t.stockMaximo??1,promociones:Qe({tipoPromocion:e,promoCantidadRequerida:t.promoCantidadRequerida??null,inicioPromoCantidad:this.toDate(t.inicioPromoCantidad),finPromoCantidad:this.toDate(t.finPromoCantidad),promoDeTemporada:{porcentaje:t.promoDeTemporada?.porcentaje??null,inicio:this.toDate(t.promoDeTemporada?.inicio),fin:this.toDate(t.promoDeTemporada?.fin),monedero:t.promoDeTemporada?.monedero??!1},descuentoINAPAM:t.descuentoINAPAM??!1},this.mapDiasSemana(t))})}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){qi.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,this.loadProductos(),qi.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{this.guardandoNuevo=!1,console.error(e),qi.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let n=e[0],r=e[e.length-1],a=document.activeElement;t.shiftKey&&a===n?(r.focus(),t.preventDefault()):!t.shiftKey&&a===r&&(n.focus(),t.preventDefault())}static \u0275fac=function(e){return new(e||i)(te(Jt),te(el),te(Zi),te(oo),te(bi),te(wa))};static \u0275cmp=Te({type:i,selectors:[["app-compras"]],viewQuery:function(e,n){if(e&1&&(Ot(rP,5),Ot(aP,5)),e&2){let r;St(r=wt())&&(n.backdrop=r.first),St(r=wt())&&(n.firstInput=r.first)}},hostBindings:function(e,n){e&1&&E("keydown",function(a){return n.trapTab(a)},!1,Sa)},decls:39,vars:15,consts:[["backdrop",""],["firstInput",""],[1,"compras-container"],[1,"titulo-container"],[1,"titulo"],[1,"header-form",3,"formGroup"],["formControlName","proveedor",1,"input-text","select",2,"width","max-content"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"margin-left","12px"],["type","date","formControlName","fechaCompra","title","Fecha efectiva de la compra (no futuro)",1,"input-text",2,"width","max-content",3,"max"],["for","chk-afectar-exist",2,"margin","0.5rem 0 0 4rem"],["id","chk-afectar-exist","type","checkbox","formControlName","afectarExistencias","title","Si est\xE1 marcado, se actualizar\xE1n lotes/precios/inventarios; si no, solo se registrar\xE1 la compra."],[2,"margin-top","0.5rem","color","#f6a80c"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"item-form",3,"formGroup"],[1,"buscar"],["type","text","formControlName","codigoBarras","placeholder","Escanea aqu\xED",3,"keydown.enter"],["class","btn-rojo","matTooltip","Borrar c\xF3digo de barras",3,"click",4,"ngIf"],["class","producto-nombre",4,"ngIf"],["class","buscar",4,"ngIf"],["class","detalles-producto",4,"ngIf"],["class","tabla",4,"ngIf"],[1,"acciones"],["matTooltip","Cancelar toda la compra",1,"btn-rojo",3,"click","disabled"],["matTooltip","Registrar la compra completa",1,"btn-gris",3,"click","disabled"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["matTooltip","Borrar c\xF3digo de barras",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"producto-nombre"],[1,"suggest-wrap"],["type","text","placeholder","Escribe al menos 2 caracteres",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],[1,"suggest-panel"],[1,"suggest-grid"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"suggest-title"],[1,"suggest-sub"],[1,"detalles-producto"],[2,"width","10%"],["type","number","formControlName","cantidad","min","1"],["type","text","formControlName","lote","placeholder","Solo A-Z y 0-9"],[1,"field-stack",2,"width","18rem"],["for","caducidadMMYY",2,"width","10%"],["id","caducidadMMYY","type","text","inputmode","numeric","maxlength","4","formControlName","caducidadMMAAAA","placeholder","mmAA","autocomplete","off",3,"blur"],["class","field-help text-muted",4,"ngIf"],["class","field-error",4,"ngIf"],["type","number","formControlName","costoUnitario","step","0.01"],["type","number","formControlName","precioUnitario","step","0.01"],["type","number","formControlName","stockMinimo","step","1"],["type","number","formControlName","stockMaximo","step","1"],["type","button",1,"btn-verde",2,"height","fit-content","margin-top","1rem",3,"click","disabled"],[1,"field-help","text-muted"],[1,"field-error"],[1,"tabla"],[4,"ngFor","ngForOf"],["colspan","10",1,"total-label"],["colspan","2",2,"text-align","start"],["matTooltip","Quitar este producto de la compra",1,"btn-icono","btn-rojo-tache",3,"click"],[2,"margin-top","8px",3,"click","matTooltip"],["class","promo-editor",4,"ngIf"],[1,"promo-editor"],["colspan","12"],[1,"row","mb-3","text-center","align-items-center",2,"background-color","#f5f5f5","padding-bottom","10px"],[1,"col-1"],["type","number",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-3"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-2"],["type","date",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","number","step","0.1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"row","text-center","mb-1"],[1,"col-2","fw-bold"],[3,"ngClass"],["type","radio","value","ninguna",3,"ngModelChange","name","ngModel"],["type","radio","value","dia",3,"ngModelChange","name","ngModel"],["type","radio","value","cantidad",3,"ngModelChange","name","ngModel"],["type","radio","value","temporada",3,"ngModelChange","name","ngModel"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],["class","mb-4",4,"ngIf"],["class","row mb-4 align-items-center",4,"ngIf"],["class","row mb-3",4,"ngIf"],[1,"guardar-cancelar"],["matTooltip","Cancelar edici\xF3n del producto",1,"btn-rojo-chico",2,"margin-left","2rem",3,"click"],["matTooltip","Guardar cambios",1,"btn-verde-chico",2,"margin-right","2rem",3,"click"],[1,"mb-4"],[1,"row","fw-bold","text-center","align-items-center"],[1,"col-2","text-end",2,"padding-top","10px"],[1,"col-2",2,"padding-top","10px"],[1,"col-3",2,"padding-top","10px"],[1,"col-2","text-start",2,"padding-top","10px"],["class","row mb-2 align-items-center",4,"ngFor","ngForOf"],[1,"row","mb-2","align-items-center"],[1,"col-2","text-end","text-primary","fw-bold"],[1,"form-check"],[1,"row","mb-4","align-items-center"],[1,"col-5",2,"padding-top","10px"],[1,"row"],[1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-5"],[1,"row","mb-3"],[1,"col-4",2,"padding-top","10px"],[1,"col-4"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],[1,"modal-actions","mt-3"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,n){e&1&&(l(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"Compras"),s()(),l(4,"form",5)(5,"label"),d(6,"Proveedor:"),s(),l(7,"select",6)(8,"option",7),d(9,"-- Selecciona --"),s(),N(10,sP,2,2,"option",8),s(),l(11,"label",9),d(12,"Fecha de compra:"),s(),y(13,"input",10),l(14,"label",11),d(15,"Afectar existencias:"),s(),y(16,"input",12),l(17,"small",13),d(18),s(),l(19,"button",14),E("click",function(){return n.abrirNuevoProducto()}),y(20,"fa-icon",15),l(21,"span",16),d(22,"Nuevo"),s()()(),l(23,"div",17)(24,"div",18)(25,"label"),d(26," C\xF3digo de barras: "),l(27,"input",19),E("keydown.enter",function(){return n.onBuscarProducto()}),s()(),N(28,lP,2,0,"button",20)(29,cP,2,1,"span",21),s(),N(30,mP,6,2,"div",22)(31,hP,27,3,"div",23),s(),N(32,CP,34,4,"table",24),l(33,"div",25)(34,"button",26),E("click",function(){return n.carrito=[],n.total=0}),d(35,"Cancelar "),s(),l(36,"button",27),E("click",function(){return n.onRegistrarCompra()}),d(37,"Registrar Compra "),s()(),N(38,SP,61,3,"div",28),s()),e&2&&(c(4),p("formGroup",n.headerForm),c(4),p("ngValue",null),c(2),p("ngForOf",n.proveedores),c(3),p("max",n.hoyISO),c(5),R(" ",n.headerForm.value.afectarExistencias?"S\xED (actualiza productos)":"No (solo registra compra)"," "),c(2),p("icon",n.faPlus),c(3),p("formGroup",n.itemForm),c(5),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",!n.productoEncontrado),c(),p("ngIf",n.nombreProducto.length>0),c(),p("ngIf",n.carrito.length),c(2),p("disabled",!n.carrito.length||n.estaEditandoPromos),c(2),p("disabled",!n.carrito.length||n.headerForm.invalid||n.estaEditandoPromos),c(2),p("ngIf",n.mostrarNuevoProducto))},dependencies:[Ae,si,We,Be,Nt,Rt,rt,Ft,it,nt,Xe,Gt,li,tt,Er,ze,Mt,Ia,Bi,_t,Bt,ci,di,Lt,ut,Yn,kr,ti,ei],styles:[".compras-container[_ngcontent-%COMP%]{width:100%}.header-form[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-bottom:1rem;font-size:large}.header-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:.5rem}.item-form[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:large;border-bottom:2px solid #0453b3}.item-form[_ngcontent-%COMP%]   .buscar[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem}.producto-nombre[_ngcontent-%COMP%]{background-color:#02047c;color:#fff;font-weight:500;padding:8px 12px;border-radius:5px}.detalles-producto[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.detalles-producto[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.total-label[_ngcontent-%COMP%]{text-align:right;font-weight:700}.acciones[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;gap:10px;margin-top:20px}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px;padding:10px 20px;font-size:16px}.field-stack[_ngcontent-%COMP%]{display:inline-block;vertical-align:top}.field-stack[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;margin-bottom:4px}.field-help[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:.85rem}.field-error[_ngcontent-%COMP%]{display:block;margin-top:4px;color:#dc3545;font-size:.85rem}@media (max-width: 600px){.acciones[_ngcontent-%COMP%]{justify-content:center}}.guardar-cancelar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-top:1rem;margin-bottom:1rem}.promo-editor[_ngcontent-%COMP%]{background:#f9f9f9;padding:1rem;border-top:2px solid #ddd}.promo-editor[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:.1rem}.selected-radio[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;padding:5px 10px;border-radius:6px}.selected-checkbox[_ngcontent-%COMP%]{background-color:#b7fe88;color:#000;padding:5px 10px;border-radius:6px}.fw-bold[_ngcontent-%COMP%]{font-weight:700;color:#02047c}.suggest-wrap[_ngcontent-%COMP%]{position:relative;display:block}.suggest-panel[_ngcontent-%COMP%]{position:absolute;inset-inline:0;top:calc(100% + .25rem);z-index:40;background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;padding:.5rem;max-height:24rem;overflow:auto}.suggest-grid[_ngcontent-%COMP%]{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.75rem .9rem;border:1px solid #eef0f3;border-radius:.75rem;background:#f9fafb;cursor:pointer;transition:background-color .15s ease,border-color .15s ease,transform .06s ease}.suggest-item[_ngcontent-%COMP%]:hover{background:#f3f4f6;border-color:#e5e7eb}.suggest-item[_ngcontent-%COMP%]:active{transform:scale(.995)}.suggest-title[_ngcontent-%COMP%]{font-weight:600;color:#111827;line-height:1.2}.suggest-sub[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.875rem;color:#6b7280}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#d1d5db;border-radius:8px;border:3px solid transparent;background-clip:content-box}.suggest-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#c0c4cb}@media (prefers-color-scheme: dark){.suggest-panel[_ngcontent-%COMP%]{background:#0b0f15;border-color:#1f2937;box-shadow:0 10px 15px -3px #00000080,0 4px 6px -4px #00000080}.suggest-item[_ngcontent-%COMP%]{background:#0f172a;border-color:#1f2937}.suggest-item[_ngcontent-%COMP%]:hover{background:#111827;border-color:#334155}.suggest-title[_ngcontent-%COMP%]{color:#e5e7eb}.suggest-sub[_ngcontent-%COMP%]{color:#94a3b8}}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}"]})};var Xt=hi(ki());var wP=()=>["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];function EP(i,t){if(i&1&&(l(0,"small"),d(1),F(2,"number"),s()),i&2){let e=_();Ri("color",e.utilColor),c(),R(" Util. ",Y(2,3,e.utilPct,"1.0-2"),"% ")}}function TP(i,t){i&1&&d(0,"\u2014")}function PP(i,t){if(i&1&&(l(0,"small"),d(1),F(2,"currency"),s()),i&2){let e=_();Ri("color",e.utilColor),c(),R(" (",oe(2,3,e.utilAbs),") ")}}function kP(i,t){if(i&1){let e=ie();l(0,"div",43)(1,"label"),d(2,"Lote:"),s(),y(3,"input",44),l(4,"label"),d(5,"Caducidad:"),s(),y(6,"input",45),l(7,"label"),d(8,"Cantidad:"),s(),y(9,"input",46),l(10,"button",47),E("click",function(){let r=T(e).index,a=_();return P(a.eliminarLote(r))}),d(11,"Eliminar"),s()()}if(i&2){let e=t.index;p("formGroupName",e)}}function IP(i,t){if(i&1&&(l(0,"div")(1,"div",48)(2,"div",49)(3,"label",23),d(4),s()(),l(5,"div",49)(6,"label"),d(7,"% desc.:"),s(),y(8,"input",34),s(),l(9,"div",50)(10,"label"),d(11,"Inicio:"),s(),y(12,"input",35),s(),l(13,"div",50)(14,"label"),d(15,"Fin:"),s(),y(16,"input",36),s(),l(17,"div",49)(18,"label"),d(19,"Monedero:"),s(),y(20,"input",37),s()()()),i&2){let e=t.$implicit;c(),p("formGroupName","promo"+e),c(3),k(e)}}var ec=class i{constructor(t,e){this.fb=t;this.producto=e}formulario;guardar=new Yt;cerrar=new Yt;get utilAbs(){let t=Number(this.formulario.get("costo")?.value),e=Number(this.formulario.get("precio")?.value);return!isFinite(t)||!isFinite(e)?null:e-t}get utilPct(){let t=Number(this.formulario.get("costo")?.value),e=Number(this.formulario.get("precio")?.value);return!isFinite(t)||t<=0||!isFinite(e)?null:(e-t)/t*100}get miCategoria(){return this.formulario.get("categoria")?.value}get esGenerico(){return this.formulario.get("generico")?.value}get utilColor(){let t=this.utilPct;return t===null?null:this.miCategoria==="Abarrotes"||this.miCategoria==="ABARROTES"||this.miCategoria==="abarrotes"?t>45?"orange":t>=18?"green":"red":this.esGenerico?t>60?"orange":t>=30?"green":"red":t>20?"orange":t>=10?"green":"red"}ngOnInit(){this.formulario=this.fb.group({nombre:[this.producto.nombre,[Pe.required]],renglon1:[this.producto.renglon1],renglon2:[this.producto.renglon2],codigoBarras:[this.producto.codigoBarras,[Pe.required]],ubicacion:[this.producto.ubicacion],categoria:[this.producto.categoria],precio:[this.producto.precio,[Pe.required,Pe.min(0)]],costo:[this.producto.costo,[Pe.required,Pe.min(0)]],iva:[this.producto.iva],generico:[this.producto.generico],descuentoINAPAM:[this.producto.descuentoINAPAM],stockMinimo:[this.producto.stockMinimo,[Pe.required,Pe.min(0)]],stockMaximo:[this.producto.stockMaximo,[Pe.required,Pe.min(0)]],lotes:this.fb.array(this.producto.lotes.map(e=>this.crearLoteForm(e))),promosPorDia:this.fb.group(this.inicializarPromosPorDia()),promoCantidadRequerida:[this.producto.promoCantidadRequerida],inicioPromoCantidad:[this.formatDate(this.producto.inicioPromoCantidad)],finPromoCantidad:[this.formatDate(this.producto.finPromoCantidad)],promoDeTemporada:this.fb.group({porcentaje:[this.producto.promoDeTemporada?.porcentaje,[Pe.min(0),Pe.max(100)]],inicio:[this.formatDate(this.producto.promoDeTemporada?.inicio)],fin:[this.formatDate(this.producto.promoDeTemporada?.fin)],monedero:[this.producto.promoDeTemporada?.monedero]})},{validators:this.validarFechasGlobales()});let t=this.formulario.get("lotes");t.controls.forEach(e=>{let n=e;Object.values(n.controls).forEach(r=>{r.clearValidators(),r.clearAsyncValidators(),r.setErrors(null),r.updateValueAndValidity({onlySelf:!0})}),n.setErrors(null),n.updateValueAndValidity({onlySelf:!0})}),t.clearValidators(),t.clearAsyncValidators(),t.setErrors(null),t.updateValueAndValidity(),t.controls.forEach(e=>{let n=e,r=n.get("fechaCaducidad");(r.value===""||r.value===void 0)&&r.setValue(null,{emitEvent:!1}),r.valueChanges.subscribe(a=>{a===""&&(r.setValue(null,{emitEvent:!1}),r.updateValueAndValidity({onlySelf:!0}),n.updateValueAndValidity({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0}),this.formulario.updateValueAndValidity())})}),this.formulario.updateValueAndValidity()}formOkSinLotes(){if(!this.formulario)return!1;let t=this.formulario.controls;return Object.keys(t).filter(e=>e!=="lotes").every(e=>t[e]?.valid===!0)}dumpFormErrors(t,e="form"){let n=a=>a.controls&&!a.length,r=a=>Array.isArray(a.controls);n(t)?Object.entries(t.controls).forEach(([a,o])=>{this.dumpFormErrors(o,`${e}.${a}`)}):r(t)?t.controls.forEach((a,o)=>{this.dumpFormErrors(a,`${e}[${o}]`)}):t.errors&&console.log(`\u274C ${e}:`,t.errors)}validarFechasGlobales(){return t=>{let e=t.get("inicioPromoCantidad")?.value,n=t.get("finPromoCantidad")?.value;if(!e||!n)return null;let r=new Date(e),a=new Date(n);return isNaN(r.getTime())||isNaN(a.getTime())||a>=r?null:{rangoPromoCantidad:!0}}}optionalFutureDate(){return t=>{let e=t.value;if(e==null||e==="")return null;let n=new Date(e);if(isNaN(n.getTime()))return{invalidDate:!0};let r=new Date;return r.setHours(0,0,0,0),n>=r?null:{pastDate:!0}}}optionalMin(t){return e=>{let n=e.value;if(n==null||n==="")return null;let r=Number(n);return Number.isFinite(r)&&r>=t?null:{min:{min:t,actual:n}}}}crearLoteForm(t){return this.fb.group({_id:[t?._id??null],lote:[t?.lote??null],fechaCaducidad:[this.formatDate(t?.fechaCaducidad)||null,[this.optionalFutureDate()]],cantidad:[t?.cantidad??null,[this.optionalMin(0)]]})}inicializarPromosPorDia(){let t={};return["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"].forEach(n=>{let r=`promo${n}`,a=this.producto[r];t[r]=this.fb.group({porcentaje:[a?.porcentaje??0],inicio:[this.formatDate(a?.inicio)],fin:[this.formatDate(a?.fin)],monedero:[a?.monedero??!1]})}),t}get lotesFormArray(){return this.formulario.get("lotes")}agregarLote(){let t={lote:"",fechaCaducidad:new Date,cantidad:0};this.lotesFormArray.push(this.crearLoteForm(t))}eliminarLote(t){this.lotesFormArray.removeAt(t)}guardarProducto(){if(this.formulario.invalid){console.log("\u274C Formulario inv\xE1lido:",this.formulario.errors),Object.entries(this.formulario.controls).forEach(([r,a])=>{console.log("Campo:",r,"Estado:",a.status,"Errores:",a.errors)});return}let t=this.formulario.value,e=(t.lotes||[]).map(r=>jt(Qe({},r),{lote:(r?.lote??"").toString().trim()||null,fechaCaducidad:r?.fechaCaducidad?new Date(r.fechaCaducidad):null,cantidad:r?.cantidad===""||r?.cantidad===null||r?.cantidad===void 0?null:Number(r.cantidad)})).filter(r=>r.lote!==null||r.fechaCaducidad!==null||r.cantidad!==null),n=jt(Qe(Qe({},this.producto),t),{lotes:e});this.guardar.emit(n)}cerrarModal(){this.cerrar.emit()}formatDate(t){return t?new Date(t).toISOString().split("T")[0]:""}static \u0275fac=function(e){return new(e||i)(te(Jt),te("PRODUCTO_DATA"))};static \u0275cmp=Te({type:i,selectors:[["app-modal-editar-producto"]],outputs:{guardar:"guardar",cerrar:"cerrar"},decls:103,vars:12,consts:[["sinDato",""],[1,"modal-overlay"],[1,"modal-content"],[1,"titulo"],[3,"formGroup"],[1,"edit-seccion"],["type","text","formControlName","nombre",2,"width","32rem"],["type","text","formControlName","codigoBarras",2,"width","10rem"],["type","text","formControlName","renglon1",2,"width","22rem"],["type","text","formControlName","renglon2",2,"width","22rem"],["type","text","formControlName","categoria",2,"width","11rem"],["type","number","formControlName","stockMinimo",2,"width","4rem"],["type","number","formControlName","stockMaximo",2,"width","4rem"],["type","checkbox","formControlName","iva"],["type","checkbox","formControlName","generico"],["type","checkbox","formControlName","descuentoINAPAM"],["type","number","formControlName","costo","step","0.1",2,"width","5rem"],["type","number","formControlName","precio","step","0.1",2,"width","5rem"],[3,"color",4,"ngIf","ngIfElse"],[3,"color",4,"ngIf"],[2,"margin-left","2rem"],["type","text","formControlName","ubicacion",2,"width","13rem"],["formArrayName","lotes"],[1,"subtitulo-edit"],["class","edit-seccion",3,"formGroupName",4,"ngFor","ngForOf"],[2,"text-align","center"],["type","button",1,"btn-verde-chico",3,"click"],[2,"margin-left","1rem"],["formControlName","promoCantidadRequerida",2,"margin-right","2rem"],[3,"ngValue"],["type","date","formControlName","inicioPromoCantidad"],["type","date","formControlName","finPromoCantidad"],["formGroupName","promoDeTemporada",1,"edit-seccion"],[2,"margin-left","1.5rem"],["type","number","formControlName","porcentaje",2,"width","60px"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["type","checkbox","formControlName","monedero"],["formGroupName","promosPorDia"],[4,"ngFor","ngForOf"],[1,"modal-buttons"],[1,"btn-rojo-chico",3,"click"],[1,"btn-verde-chico","btn-right",3,"click","disabled"],[1,"edit-seccion",3,"formGroupName"],["type","text","formControlName","lote"],["type","date","formControlName","fechaCaducidad"],["type","number","formControlName","cantidad",2,"width","5rem"],["type","button",1,"btn-rojo-chico",3,"click"],[1,"row","promo-dia",3,"formGroupName"],[1,"col-2"],[1,"col-3"]],template:function(e,n){if(e&1){let r=ie();l(0,"div",1)(1,"div",2)(2,"h3",3),d(3,"Almacen editar producto"),s(),l(4,"form",4)(5,"div",5)(6,"label"),d(7,"Nombre:"),s(),y(8,"input",6),l(9,"label"),d(10,"Cod. Barras:"),s(),y(11,"input",7),s(),l(12,"div",5)(13,"label"),d(14,"Rengl\xF3n 1:"),s(),y(15,"input",8),l(16,"label"),d(17,"Rengl\xF3n 2:"),s(),y(18,"input",9),s(),l(19,"div",5)(20,"label"),d(21,"Categor\xEDa:"),s(),y(22,"input",10),l(23,"label"),d(24,"Stock Minimo:"),s(),y(25,"input",11),l(26,"label"),d(27,"Stock Maximo:"),s(),y(28,"input",12),l(29,"label"),d(30,"IVA:"),s(),y(31,"input",13),l(32,"label"),d(33,"Gen\xE9rico:"),s(),y(34,"input",14),s(),l(35,"div",5)(36,"label"),d(37,"INAPAM:"),s(),y(38,"input",15),l(39,"label"),d(40,"Costo:"),s(),y(41,"input",16),l(42,"label"),d(43,"Precio:"),s(),y(44,"input",17),N(45,EP,3,6,"small",18)(46,TP,1,0,"ng-template",null,0,Ea)(48,PP,3,5,"small",19),l(49,"label",20),d(50,"Ubicaci\xF3n:"),s(),y(51,"input",21),s(),l(52,"div",22)(53,"label",23),d(54,"Lotes:"),s(),N(55,kP,12,1,"div",24),l(56,"div",25)(57,"button",26),E("click",function(){return T(r),P(n.agregarLote())}),d(58,"Agregar Lote"),s()()(),l(59,"label",23),d(60,"Promociones:"),s(),l(61,"div",5)(62,"label",23),d(63,"Cantidad Requerida:"),s(),l(64,"label",27),d(65,"Tipo:"),s(),l(66,"select",28)(67,"option",29),d(68,"--"),s(),l(69,"option",29),d(70,"2x1"),s(),l(71,"option",29),d(72,"3x2"),s(),l(73,"option",29),d(74,"4x3"),s()(),l(75,"label"),d(76,"Inicio:"),s(),y(77,"input",30),l(78,"label"),d(79,"Fin:"),s(),y(80,"input",31),s(),l(81,"div",32)(82,"label",23),d(83,"Temporada:"),s(),l(84,"label",33),d(85,"% desc.:"),s(),y(86,"input",34),l(87,"label"),d(88,"Inicio:"),s(),y(89,"input",35),l(90,"label"),d(91,"Fin:"),s(),y(92,"input",36),l(93,"label"),d(94,"Monedero:"),s(),y(95,"input",37),s(),l(96,"div",38),N(97,IP,21,2,"div",39),s()(),l(98,"div",40)(99,"button",41),E("click",function(){return T(r),P(n.cerrarModal())}),d(100,"Cancelar"),s(),l(101,"button",42),E("click",function(){return T(r),P(n.guardarProducto())}),d(102,"Guardar"),s()()()()}if(e&2){let r=$t(47);c(4),p("formGroup",n.formulario),c(41),p("ngIf",n.utilPct!==null)("ngIfElse",r),c(3),p("ngIf",n.utilAbs!==null),c(7),p("ngForOf",n.lotesFormArray.controls),c(12),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(24),p("ngForOf",Qt(11,wP)),c(4),p("disabled",!n.formOkSinLotes())}},dependencies:[Ae,We,Be,Ct,Nt,Bt,Ft,it,nt,Xe,Gt,li,tt,ze,Mt,ci,di,Hs,Vm,rt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#8dfaf7;padding:20px;border-radius:8px;width:1000px;max-height:90vh;overflow-y:auto;box-shadow:0 5px 15px #0000004d;font-size:medium;display:flex;justify-content:space-between}.subtitulo-edit[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.edit-seccion[_ngcontent-%COMP%]{margin-bottom:.5rem}.edit-seccion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.edit-seccion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:2rem}.promo-dia[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.modal-buttons[_ngcontent-%COMP%]{display:flex;margin-left:2rem;margin-right:2rem}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}"]})};var tc=class i{constructor(t,e){this.overlay=t;this.injector=e}overlayRef;abrirModal(t,e){if(this.overlayRef)return;this.overlayRef=this.overlay.create({hasBackdrop:!0,backdropClass:"cdk-overlay-dark-backdrop",positionStrategy:this.overlay.position().global().centerHorizontally().centerVertically()});let n=new Ff(ec,null,this.crearInjector(t,e)),r=this.overlayRef.attach(n);this.overlayRef.backdropClick().subscribe(()=>this.cerrarModal()),r.instance.cerrar.subscribe(()=>this.cerrarModal()),r.instance.guardar.subscribe(a=>{e(a),this.cerrarModal()})}crearInjector(t,e){return Ca.create({providers:[{provide:"PRODUCTO_DATA",useValue:t},{provide:"GUARDAR_CALLBACK",useValue:e}],parent:this.injector})}cerrarModal(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=void 0)}static \u0275fac=function(e){return new(e||i)(ct(Oa),ct(Ca))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var FP=["backdrop"],AP=["firstInput"],Ig=i=>({"selected-radio":i}),ic=(i,t,e)=>({bi:!0,"bi-caret-up-fill":i,"bi-caret-down-fill":t,"bi-caret-up":e});function OP(i,t){if(i&1){let e=ie();l(0,"button",82),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("nombre"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function DP(i,t){if(i&1){let e=ie();l(0,"button",83),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("codigoBarras"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function RP(i,t){if(i&1){let e=ie();l(0,"button",84),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("categoria"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function NP(i,t){if(i&1){let e=ie();l(0,"button",85),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("descuentoINAPAM"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function BP(i,t){if(i&1){let e=ie();l(0,"button",86),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("generico"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function LP(i,t){if(i&1){let e=ie();l(0,"button",87),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("bajoStock"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function VP(i,t){i&1&&y(0,"i",88)}function UP(i,t){if(i&1){let e=ie();l(0,"button",89),E("click",function(){T(e);let r=_();return P(r.limpiarFiltro("duplicadosCB"))}),y(1,"fa-icon",7),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function jP(i,t){if(i&1&&(l(0,"div")(1,"div",90)(2,"div",91)(3,"label",92),d(4),s()(),l(5,"div",91)(6,"label",42),d(7,"% Desc.:"),s(),y(8,"input",93),s(),l(9,"div",94)(10,"label",42),d(11,"Inicia:"),s(),y(12,"input",95),s(),l(13,"div",94)(14,"label",42),d(15,"Termina:"),s(),y(16,"input",96),s(),l(17,"div",91)(18,"label",42),d(19,"Monedero:"),s(),l(20,"select",97)(21,"option",22),d(22,"--"),s(),l(23,"option",22),d(24,"S\xED"),s(),l(25,"option",22),d(26,"No"),s()()()()()),i&2){let e=t.$implicit;c(),p("formGroupName","promo"+e),c(3),R("Promo ",e,":"),c(17),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1)}}function WP(i,t){i&1&&(l(0,"span",115),y(1,"i",116),s())}function HP(i,t){i&1&&(l(0,"span",115),y(1,"i",117),s())}function zP(i,t){if(i&1&&(l(0,"small",118),d(1),s()),i&2){let e=_().$implicit;c(),k(e.ubicacion)}}function $P(i,t){i&1&&y(0,"i",119)}function GP(i,t){i&1&&y(0,"i",117)}function qP(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td")(2,"input",98),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.seleccionado,r)||(a.seleccionado=r),P(r)}),s()(),l(3,"td")(4,"div",99)(5,"button",100),E("click",function(){T(e);let r=$t(12);return P(r.click())}),l(6,"img",101),E("error",function(r){let a=T(e).$implicit,o=_();return P(o.onImgError(r,a))}),s(),N(7,WP,2,0,"span",102)(8,HP,2,0,"span",102),s(),l(9,"button",103),E("click",function(r){let a=T(e).$implicit,o=_();return r.stopPropagation(),P(o.openPreview(a))}),y(10,"i",104),s(),l(11,"input",105,0),E("change",function(r){let a=T(e).$implicit,o=_();return P(o.onFileChange(r,a))}),s()()(),l(13,"td",106)(14,"div",107),d(15),s(),N(16,zP,2,1,"small",108),s(),l(17,"td"),d(18),s(),l(19,"td"),d(20),s(),l(21,"td",109),y(22,"input",110),s(),l(23,"td"),d(24),s(),l(25,"td"),d(26),s(),l(27,"td"),d(28),s(),l(29,"td",109),y(30,"input",110),s(),l(31,"td"),d(32),F(33,"currency"),s(),l(34,"td"),d(35),F(36,"currency"),s(),l(37,"td")(38,"button",111),E("click",function(){let r=T(e).$implicit,a=_();return P(a.editarProducto(r))}),y(39,"fa-icon",7),s(),l(40,"button",112),E("click",function(){let r=T(e).$implicit,a=_();return P(a.confirmarEliminar(r))}),N(41,$P,1,0,"i",113)(42,GP,1,0,"i",114),s()()()}if(i&2){let e=t.$implicit,n=_();Re("fila-modificada",e.modificado),c(2),Q("ngModel",e.seleccionado),c(2),Re("loading",n.subiendoId===e._id),c(),p("disabled",n.subiendoId===e._id),Je("aria-label",e.imagen?"Cambiar imagen":"Agregar imagen"),c(),p("src",e._imgSrc,qr),c(),p("ngIf",n.subiendoId!==e._id),c(),p("ngIf",n.subiendoId===e._id),c(),p("disabled",n.subiendoId===e._id),c(6),k(e.nombre),c(),p("ngIf",e.ubicacion),c(2),k(e.codigoBarras),c(2),k(e.categoria),c(2),p("checked",e.generico),c(2),k(e.stockMinimo),c(2),k(e.stockMaximo),c(),Re("text-danger",n.getExistencia(e)<(e.stockMinimo||0)),c(),R(" ",n.getExistencia(e)," "),c(2),p("checked",e.descuentoINAPAM),c(2),k(oe(33,28,e.costo)),c(3),k(oe(36,30,e.precio)),c(4),p("icon","pen"),c(),p("disabled",n.eliminandoId===e._id),c(),p("ngIf",n.eliminandoId!==e._id),c(),p("ngIf",n.eliminandoId===e._id)}}function XP(i,t){if(i&1){let e=ie();l(0,"div",120,1),E("keydown.escape",function(){T(e);let r=_();return P(r.cerrarNuevoProducto())}),l(2,"div",121),E("mousedown",function(r){return T(e),P(r.stopPropagation())})("click",function(r){return T(e),P(r.stopPropagation())}),l(3,"h3",122),d(4,"Nuevo producto"),s(),l(5,"form",123)(6,"div",124)(7,"div",125)(8,"label"),d(9,"Nombre *"),s(),y(10,"input",126,2),s(),l(12,"div",127)(13,"label"),d(14,"Rengl\xF3n 1"),s(),y(15,"input",128),s(),l(16,"div",127)(17,"label"),d(18,"Rengl\xF3n 2"),s(),y(19,"input",129),s(),l(20,"div",94)(21,"label"),d(22,"C\xF3digo de barras *"),s(),y(23,"input",130),s(),l(24,"div",94)(25,"label"),d(26,"Categor\xEDa *"),s(),y(27,"input",131),s(),l(28,"div",91)(29,"label"),d(30,"Unidad *"),s(),y(31,"input",132),s(),l(32,"div",91)(33,"label"),d(34,"Precio *"),s(),y(35,"input",133),s(),l(36,"div",91)(37,"label"),d(38,"Costo *"),s(),y(39,"input",134),s(),l(40,"div",91)(41,"label"),d(42,"Stock M\xEDn *"),s(),y(43,"input",135),s(),l(44,"div",91)(45,"label"),d(46,"Stock M\xE1x *"),s(),y(47,"input",136),s(),l(48,"div",137)(49,"label",138),d(50,"IVA"),s(),y(51,"input",139),s(),l(52,"div",137)(53,"label",140),d(54,"Gen\xE9rico"),s(),y(55,"input",141),s(),l(56,"div",137)(57,"label",142),d(58,"INAPAM"),s(),y(59,"input",143),s(),l(60,"div",91)(61,"label"),d(62,"Ubicaci\xF3n"),s(),y(63,"input",144),s()()(),l(64,"div",63)(65,"button",145),E("click",function(){T(e);let r=_();return P(r.cerrarNuevoProducto())}),d(66,"Cancelar"),s(),l(67,"button",146),E("click",function(){T(e);let r=_();return P(r.guardarNuevoProducto())}),d(68),s()()()()}if(i&2){let e=_();c(5),p("formGroup",e.nuevoProductoForm),c(62),p("disabled",e.nuevoProductoForm.invalid||e.guardandoNuevo),c(),R(" ",e.guardandoNuevo?"Guardando\u2026":"Guardar"," ")}}var nc=class i{constructor(t,e,n,r,a,o){this.fb=t;this.cdr=e;this.modalService=n;this.productoService=r;this.renderer=o;a.addIcons($s,_i,Sn)}backdrop;firstInput;columnaOrden="";productos=[];productosFiltrados=[];formularioMasivo;filtrando=!1;iniciando=!1;filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1};paginaActual=1;tamanioPagina=15;direccionOrden="asc";diasSemana=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];faTimes=_i;faPlus=Sn;mostrarNuevoProducto=!1;guardandoNuevo=!1;nuevoProductoForm;eliminandoId=null;placeholderSrc="assets/images/farmBienIcon.png";ngOnInit(){this.iniciando=!0,this.inicializarFormulario(),this.cargarProductos(!0),this.iniciando=!1,this.formularioMasivo.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.formularioMasivo.get("promosPorDia")?.valueChanges.subscribe(()=>{this.cdr.detectChanges()}),this.nuevoProductoForm=this.fb.group({nombre:["",[Pe.required,Pe.minLength(3)]],renglon1:[""],renglon2:[""],codigoBarras:["",Pe.required],unidad:["",Pe.required],precio:[null,[Pe.required,Pe.min(0)]],costo:[null,[Pe.required,Pe.min(0)]],iva:[!1],stockMinimo:[50,[Pe.required,Pe.min(0)]],stockMaximo:[100,[Pe.required,Pe.min(0)]],ubicacion:[""],categoria:["",Pe.required],generico:[!1],descuentoINAPAM:[!1]})}inicializarFormulario(){let t={};this.diasSemana.forEach(e=>{t["promo"+e]=this.fb.group({porcentaje:[null],inicio:[null],fin:[null],monedero:[null]})}),this.formularioMasivo=this.fb.group({categoria:[null],descuentoINAPAM:[null],stockMinimo:[null],stockMaximo:[null],ajustePrecioModo:[null],ajustePrecioPorcentaje:[null],ajustePrecioCantidad:[null],promoCantidadRequerida:[null],inicioPromoCantidad:[null],finPromoCantidad:[null],promoDeTemporadaPorcentaje:[null],promoDeTemporadaInicio:[null],promoDeTemporadaFin:[null],promoDeTemporadaMonedero:[null],promosPorDia:this.fb.group(t)})}cargarThumbnailsAuth(t){ks(t).pipe(Is(e=>e?.imagen?this.productoService.getImagenObjectUrl(e._id).pipe(mn(n=>{e._imgSrc=n||this.placeholderSrc}),Pi(()=>(e._imgSrc=this.placeholderSrc,lt(null)))):(e._imgSrc=this.placeholderSrc,lt(null)),6)).subscribe()}cargarProductos(t){this.productoService.obtenerProductos().subscribe({next:e=>{this.productos=(e||[]).map(n=>jt(Qe({},n),{_imgSrc:n?.imagen?this.productoService.obtenerImagenProductoUrl(n._id):this.placeholderSrc})),this.cargarThumbnailsAuth(this.productos),this.cachearNorms(),this.recomputarCBDuplicados(),t&&(this.filtros={nombre:"",codigoBarras:"",categoria:"",descuentoINAPAM:null,generico:null,bajoStock:!1,duplicadosCB:!1}),this.aplicarFiltros()},error:e=>console.error("Error al cargar productos:",e)})}onImgError(t,e){let n=t.target;n&&n.src!==this.placeholderSrc&&(n.src=this.placeholderSrc)}normTxt(t){return String(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}splitWords(t){return this.normTxt(t).split(" ").filter(Boolean)}aplicarFiltros(){this.filtrando||this.iniciando||(this.filtrando=!0,this.cdr.detectChanges(),setTimeout(()=>{let t=this.filtros,e=t?.nombre?this.splitWords(t.nombre):[],n=t?.categoria?this.splitWords(t.categoria):[];this.productosFiltrados=(this.productos||[]).filter(r=>{let a=r._normNombre??this.normTxt(r?.nombre),o=e.length?e.every(w=>a.includes(w)):!0,u=t.codigoBarras?(r.codigoBarras||"").toLowerCase().includes(t.codigoBarras.toLowerCase()):!0,m=r._normCategoria??this.normTxt(r?.categoria),f=n.length?n.every(w=>m.includes(w)):!0,h=t.descuentoINAPAM===null?!0:r.descuentoINAPAM===t.descuentoINAPAM,g=t.generico===null?!0:r.generico===t.generico,v=t.bajoStock?this.getExistencia(r)<(r.stockMinimo??0):!0,b=t.duplicadosCB?this.cbDuplicados.has(this.normCB(r?.codigoBarras)):!0;return o&&u&&f&&h&&g&&v&&b}),this.paginaActual=1,this.filtrando=!1},0))}cbDuplicados=new Set;normCB(t){return String(t??"").trim().toLowerCase()}cachearNorms(){for(let t of this.productos||[])t._normNombre=this.normTxt(t?.nombre),t._normCategoria=this.normTxt(t?.categoria)}recomputarCBDuplicados(){let t=new Map;for(let e of this.productos||[]){let n=this.normCB(e?.codigoBarras);n&&t.set(n,(t.get(n)||0)+1)}this.cbDuplicados=new Set([...t.entries()].filter(([,e])=>e>1).map(([e])=>e))}limpiarFiltro(t){t==="descuentoINAPAM"&&(this.filtros[t]=null),t==="generico"&&(this.filtros[t]=null),t==="bajoStock"&&(this.filtros.bajoStock=!1),t==="duplicadosCB"&&(this.filtros.duplicadosCB=!1),(t==="nombre"||t==="categoria"||t==="codigoBarras")&&(this.filtros[t]=""),this.aplicarFiltros()}get totalPaginas(){return Math.ceil(this.productosFiltrados.length/this.tamanioPagina)}get productosPagina(){let t=(this.paginaActual-1)*this.tamanioPagina;return this.productosFiltrados.slice(t,t+this.tamanioPagina)}limpiarCamposCambioMasivo(){this.formularioMasivo.reset()}aplicarCambiosMasivos(){let t=this.formularioMasivo.value,e=this.productosFiltrados.filter(n=>n.seleccionado);if(e.length===0){Xt.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"Debes seleccionar al menos un producto para aplicar los cambios..",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}e.forEach(n=>{if(Object.keys(t).forEach(a=>{t[a]!==null&&!["ajustePrecioModo","ajustePrecioPorcentaje","ajustePrecioCantidad"].includes(a)&&a!=="promosPorDia"&&(n[a]=t[a])}),t.ajustePrecioModo==="porcentaje"&&t.ajustePrecioPorcentaje!=null){let a=t.ajustePrecioPorcentaje,o=n.precio+n.precio*(a/100);n.precio=parseFloat(o.toFixed(2))}if(t.ajustePrecioModo==="cantidad"&&t.ajustePrecioCantidad!=null){let a=t.ajustePrecioCantidad,o=n.precio+a;n.precio=parseFloat(o.toFixed(2))}(t.promoDeTemporadaPorcentaje!=null||t.promoDeTemporadaInicio!=null||t.promoDeTemporadaFin!=null||t.promoDeTemporadaMonedero!=null)&&(n.promoDeTemporada={porcentaje:t.promoDeTemporadaPorcentaje??0,inicio:new Date(t.promoDeTemporadaInicio),fin:new Date(t.promoDeTemporadaFin),monedero:t.promoDeTemporadaMonedero??!1});let r=t.promosPorDia;this.diasSemana.forEach(a=>{let o=r[`promo${a}`];(o?.porcentaje!=null||o?.inicio!=null||o?.fin!=null||o?.monedero!=null)&&(n["promo"+a]={porcentaje:o.porcentaje??0,inicio:o.inicio?new Date(o.inicio):null,fin:o.fin?new Date(o.fin):null,monedero:o.monedero??!1})}),n.modificado=!0}),this.formularioMasivo.reset(),this.grabarCambios()}get promosPorDiaForm(){return this.formularioMasivo.get("promosPorDia")}get cambiosMasivosValidos(){let t=this.formularioMasivo.value,{categoria:e,stockMinimo:n,stockMaximo:r,descuentoINAPAM:a,ajustePrecioModo:o,ajustePrecioPorcentaje:u,ajustePrecioCantidad:m,promoCantidadRequerida:f,inicioPromoCantidad:h,finPromoCantidad:g,promoDeTemporadaPorcentaje:v,promoDeTemporadaInicio:b,promoDeTemporadaFin:w,promoDeTemporadaMonedero:x}=t;return!(!(e!=null||n!=null||r!=null||a!=null||o!=null||f!=null||h!=null||g!=null||v!=null||b!=null||w!=null||x!=null||this.hayCambiosEnPromosPorDia())||o==="porcentaje"&&(u==null||isNaN(u))||o==="cantidad"&&(m==null||isNaN(m))||f!=null&&(!h||!g||new Date(h)>new Date(g))||(v!=null||b!=null||w!=null||x!=null)&&(v==null||isNaN(v)||v<=0||v>100||!b||!w||new Date(b)>new Date(w))||!this.validarPromosPorDia())}hayCambiosEnPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;return t?this.diasSemana.some(e=>{let n=t["promo"+e];return n?.porcentaje!=null||n?.inicio!=null||n?.fin!=null||n?.monedero!=null}):!1}validarPromosPorDia(){let t=this.formularioMasivo.get("promosPorDia")?.value;if(!t)return!0;for(let e of this.diasSemana){let n=t[`promo${e}`];if(!n)continue;let{porcentaje:r,inicio:a,fin:o}=n;if((r!=null||a!=null||o!=null)&&(!a||!o||new Date(a)>new Date(o)||r==null||isNaN(r)||r<=0||r>100))return!1}return!0}seleccionarTodos(t){let e=t.target.checked;this.productosFiltrados.forEach(n=>n.seleccionado=e)}editarProducto(t){let e=JSON.parse(JSON.stringify(t));this.modalService.abrirModal(e,n=>{this.guardarProductoEditado(n)})}guardarProductoEditado(t){console.log("producto actualizado en ajustes-inventario =====>",t);let e=t._id,n=Qe({},t);delete n._id,delete n.__v,delete n.createdAt,delete n.updatedAt,["precioVenta","costo","existencia","iva","minimo","maximo"].forEach(r=>{n[r]!==void 0&&n[r]!==null&&(n[r]=Number(n[r])||0)}),this.productoService.actualizarProductoIndividual(e,n).subscribe({next:()=>{Xt.default.fire({icon:"success",title:"\xC9xito",text:"Producto actualizado correctamente",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:r=>{let a=r?.error?.mensaje||r?.error?.message||r?.message||"No se pudo actualizar el producto";Xt.default.fire("Error",a,"error"),console.error("[actualizarProducto][ERROR]",r)}})}grabarCambios(){try{let t=this.productos.filter(e=>e.seleccionado);if(!t||t.length===0){Xt.default.fire({icon:"warning",title:"Sin selecci\xF3n",text:"No hay productos seleccionados para actualizar.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}Xt.default.fire({title:"\xBFDeseas guardar los cambios?",html:`Se actualizar\xE1n <b>${t.length}</b> productos.`,icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, guardar",cancelButtonText:"Cancelar",heightAuto:!1}).then(e=>{e.isConfirmed&&(Xt.default.fire({title:"Guardando...",allowOutsideClick:!1,allowEscapeKey:!1,heightAuto:!1,didOpen:()=>Xt.default.showLoading()}),this.productoService.actualizarProductos({productos:t}).subscribe({next:()=>{Xt.default.close(),Xt.default.fire({icon:"success",title:"Actualizaci\xF3n exitosa",text:"Los productos fueron actualizados correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1),this.productos.forEach(n=>n.seleccionado=!1),this.formularioMasivo.reset(),this.aplicarFiltros()},error:n=>{console.error("[grabarCambios] error HTTP:",n),Xt.default.close(),Xt.default.fire({icon:"error",title:"Error",text:n?.error?.mensaje||"Ocurri\xF3 un error inesperado al actualizar los productos."})}}))})}catch(t){console.error("[grabarCambios] excepci\xF3n:",t),Xt.default.fire({icon:"error",title:"Error",text:"Hubo un problema al preparar la actualizaci\xF3n."})}}ordenar(t){this.columnaOrden===t?this.direccionOrden=this.direccionOrden==="asc"?"desc":"asc":(this.columnaOrden=t,this.direccionOrden="asc"),this.productosFiltrados.sort((e,n)=>{let r=t==="existencia"?this.getExistencia(e):e?.[t],a=t==="existencia"?this.getExistencia(n):n?.[t],o=typeof r=="number"&&!isNaN(r),u=typeof a=="number"&&!isNaN(a),m;if(o&&u)m=r-a;else{let f=(r??"").toString().toLowerCase(),h=(a??"").toString().toLowerCase();m=f<h?-1:f>h?1:0}return this.direccionOrden==="asc"?m:-m}),this.paginaActual=1}getExistencia(t){return Array.isArray(t?.lotes)?t.lotes.reduce((e,n)=>e+(Number(n?.cantidad)||0),0):0}abrirNuevoProducto(){this.nuevoProductoForm.reset({nombre:"",codigoBarras:"",renglon1:"",renglon2:"",unidad:"PZA",precio:null,costo:null,iva:!1,stockMinimo:50,stockMaximo:100,ubicacion:"",categoria:"",generico:!1,descuentoINAPAM:!1}),this.mostrarNuevoProducto=!0,this.renderer.addClass(document.body,"no-scroll"),setTimeout(()=>{this.backdrop?.nativeElement.focus(),this.firstInput?.nativeElement.focus()})}cerrarNuevoProducto(){this.mostrarNuevoProducto=!1,this.renderer.removeClass(document.body,"no-scroll")}guardarNuevoProducto(){if(this.nuevoProductoForm.invalid){this.nuevoProductoForm.markAllAsTouched();return}let t=this.nuevoProductoForm.value;if(t.stockMaximo<t.stockMinimo){Xt.default.fire("Validaci\xF3n","El stock m\xE1ximo debe ser mayor o igual al m\xEDnimo.","warning");return}this.guardandoNuevo=!0,this.productoService.crearProducto(t).subscribe({next:e=>{this.guardandoNuevo=!1,this.mostrarNuevoProducto=!1,Xt.default.fire({icon:"success",title:"Listo",html:`Producto creado correctamente.<br>
                  Si deseas agregar promociones<br>
                  busca el producto en la tabla y editalo`,confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1}),this.cargarProductos(!1)},error:e=>{this.guardandoNuevo=!1,console.error(e),Xt.default.fire("Error",e?.error?.mensaje||"No se pudo crear el producto.","error")}})}trapTab(t){if(!this.mostrarNuevoProducto||t.key!=="Tab"||!this.backdrop)return;let e=this.backdrop.nativeElement.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e.length)return;let n=e[0],r=e[e.length-1],a=document.activeElement;t.shiftKey&&a===n?(r.focus(),t.preventDefault()):!t.shiftKey&&a===r&&(n.focus(),t.preventDefault())}confirmarEliminar(t){return Le(this,null,function*(){let{isConfirmed:e}=yield Xt.default.fire({icon:"warning",title:"Eliminar producto",html:`
        <p>Se eliminar\xE1 <strong>${t?.nombre||""}</strong>.</p>
        <p class="text-danger">Tambi\xE9n se eliminar\xE1 de <strong>todas las farmacias</strong>.</p>
        <p>Esta acci\xF3n no se puede deshacer.</p>
      `,showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,focusCancel:!0});if(e)try{this.eliminandoId=t._id;let n=yield Ti(this.productoService.eliminarProducto(t._id));this.productos=(this.productos||[]).filter(r=>r._id!==t._id),typeof this.recomputarCBDuplicados=="function"&&this.recomputarCBDuplicados(),this.aplicarFiltros(),Xt.default.fire("Eliminado",n?.mensaje||"Producto eliminado correctamente","success")}catch(n){let r=n?.error?.mensaje||n?.message||"No se pudo eliminar el producto";Xt.default.fire("Error",r,"error")}finally{this.eliminandoId=null}})}subiendoId=null;imgCacheBuster={};imageUrl(t){if(!t?._id)return"";let e=this.productoService.obtenerImagenProductoUrl(t._id),n=this.imgCacheBuster[t._id]||0;return n?`${e}?t=${n}`:e}onFileChange(t,e){let n=t.target,r=n.files&&n.files[0];n.value="",r&&this.onPickImage(r,e)}onPickImage(t,e){return Le(this,null,function*(){if(!t||!e?._id)return;let n=yield new Promise((a,o)=>{let u=new FileReader;u.onload=()=>a(String(u.result)),u.onerror=o,u.readAsDataURL(t)}),{isConfirmed:r}=yield Xt.default.fire({title:e.imagen?"\xBFReemplazar imagen?":"\xBFSubir imagen?",html:`<img src="${n}" style="max-width:100%;max-height:240px;border-radius:8px;">`,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"});if(r)try{this.subiendoId=e._id,yield Ti(this.productoService.actualizarImagenProducto(e._id,t));let a=this.productoService.obtenerImagenProductoUrl(e._id);e._imgSrc=`${a}?t=${Date.now()}`,e.imagen=!0,Xt.default.fire("Listo","Imagen guardada","success")}catch(a){let o=a?.error?.mensaje||"No se pudo subir la imagen";Xt.default.fire("Error",o,"error")}finally{this.subiendoId=null}})}trackProdBy=(t,e)=>e?._id??e?.codigoBarras??t;openPreview(t){let e=t?.imagen?this.productoService.obtenerImagenProductoUrl(t._id):this.placeholderSrc,n=t?.imagen?`${e}?t=${Date.now()}`:e;Xt.default.fire({width:"auto",showConfirmButton:!1,showCloseButton:!0,background:"#000",padding:0,html:`
      <div style="max-width:90vw;max-height:90vh;display:flex;align-items:center;justify-content:center">
        <img src="${n}" alt="" style="max-width:90vw;max-height:90vh;object-fit:contain" />
      </div>`})}static \u0275fac=function(e){return new(e||i)(te(Jt),te(Wt),te(tc),te(Zi),te(bi),te(wa))};static \u0275cmp=Te({type:i,selectors:[["app-ajuste-inventario"]],viewQuery:function(e,n){if(e&1&&(Ot(FP,5),Ot(AP,5)),e&2){let r;St(r=wt())&&(n.backdrop=r.first),St(r=wt())&&(n.firstInput=r.first)}},hostBindings:function(e,n){e&1&&E("keydown",function(a){return n.trapTab(a)},!1,Sa)},decls:212,vars:83,consts:[["file",""],["backdrop",""],["firstInput",""],[1,"panel"],[1,"titulo-container","d-flex","justify-content-between","align-items-center"],[1,"titulo"],["type","button","matTooltip","Agregar un nuevo producto",1,"btn-amarillo-chico","d-flex","align-items-center",3,"click"],[3,"icon"],[1,"ms-1"],[1,"row","mb-2","filtros-container"],[1,"col-md-3"],[1,"me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","text","name","nombre",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar nombre","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-2"],["type","text","name","codigoBarras",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar c\xF3d. barras","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["type","text","name","categoria",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar categor\xEDa","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-md-1"],["name","descuentoINAPAM",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","button","matTooltip","Limpiar INAPAM","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["name","generico",1,"form-control","pe-4","flex-grow-1",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar gen\xE9rico","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"form-check","mt-2"],["type","checkbox","id","filtroBajoStock","name","bajoStock",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroBajoStock",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro bajo stock",3,"click",4,"ngIf"],[1,"col-md-1","text-end","mt-3"],["matTooltip","Filtrar informaci\xF3n solicitada",1,"btn-gris",3,"click","disabled"],["class","fa fa-spinner fa-spin me-1",4,"ngIf"],[1,"me-2","mb-0","mt-2",2,"white-space","nowrap"],["type","checkbox","id","filtroCBDuplicados","name","duplicadosCB",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","filtroCBDuplicados",1,"form-check-label"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Quitar filtro de duplicados",3,"click",4,"ngIf"],[1,"masivos",3,"formGroup"],[1,"center-content"],[1,"subtitulo",2,"margin-right","10px"],[1,"container-masivos","mb-1"],[1,"tit-promo",2,"margin-right","1rem"],[2,"margin-right","10px"],["type","text","formControlName","categoria",2,"width","100px","margin-right","2rem"],["type","number","formControlName","stockMinimo",2,"width","50px","margin-right","2rem"],["type","number","formControlName","stockMaximo",2,"width","50px","margin-right","2rem"],["formControlName","descuentoINAPAM"],[1,"tit-promo",2,"margin-right","2rem"],[2,"margin-right","1rem",3,"ngClass"],["type","radio","formControlName","ajustePrecioModo","value","porcentaje"],["type","number","formControlName","ajustePrecioPorcentaje",2,"width","50px","margin-right","4rem"],["type","radio","formControlName","ajustePrecioModo","value","cantidad"],["type","number","formControlName","ajustePrecioCantidad",2,"width","50px","margin-right","5rem"],[1,"tit-promo",2,"margin-right","10px"],["formControlName","promoCantidadRequerida",2,"margin-right","1rem"],["type","date","formControlName","inicioPromoCantidad",2,"margin-right","1rem"],["type","date","formControlName","finPromoCantidad"],["type","number","formControlName","promoDeTemporadaPorcentaje",2,"width","50px","margin-right","1rem"],["type","date","formControlName","promoDeTemporadaInicio",2,"margin-right","1rem"],["type","date","formControlName","promoDeTemporadaFin",2,"margin-right","1rem"],["formControlName","promoDeTemporadaMonedero",2,"margin-right","2rem"],[2,"margin-top","10px",3,"formGroup"],[4,"ngFor","ngForOf"],[1,"modal-actions","mt-3"],["type","button","matTooltip","Borrar par\xE1metros del cambio masivo",1,"btn-rojo-chico",2,"margin-left","4rem",3,"click"],["type","button","matTooltip","Aplica cambios a los productos seleccionados en la tabla",1,"btn-verde-chico",2,"margin-right","4rem",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change"],[3,"click"],[1,"icono-orden",3,"ngClass"],[3,"fila-modificada",4,"ngFor","ngForOf","ngForTrackBy"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"total-registros"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","modal-backdrop","tabindex","-1",3,"keydown.escape",4,"ngIf"],["type","button","matTooltip","Limpiar nombre",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar categor\xEDa",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar INAPAM",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar gen\xE9rico",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Quitar filtro bajo stock",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"fa","fa-spinner","fa-spin","me-1"],["type","button","matTooltip","Quitar filtro de duplicados",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[1,"row",2,"margin-bottom","5px",3,"formGroupName"],[1,"col-2"],[1,"tit-promo",2,"margin-left","3rem"],["type","number","formControlName","porcentaje",2,"width","50px","height","20px"],[1,"col-3"],["type","date","formControlName","inicio"],["type","date","formControlName","fin"],["formControlName","monedero"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"img-cell"],["type","button","matTooltip","Cambiar \xF3 Subir imagen",1,"img-button",3,"click","disabled"],["loading","lazy","decoding","async","alt","",3,"error","src"],["class","overlay",4,"ngIf"],["type","button","matTooltip","Ver imagen",1,"zoom-btn",3,"click","disabled"],[1,"fas","fa-search-plus"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"col-producto"],[1,"prod-nombre"],["class","prod-ubicacion",4,"ngIf"],[2,"text-align","center"],["type","checkbox","disabled","",3,"checked"],["matTooltip","Editar producto",1,"btn-icon-chico","btn-gris-chico",3,"click"],["matTooltip","Eliminar producto en TODAS las farmacias",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],["class","fas fa-trash",4,"ngIf"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"overlay"],[1,"fas","fa-upload"],[1,"fa","fa-spinner","fa-spin"],[1,"prod-ubicacion"],[1,"fas","fa-trash"],["tabindex","-1",1,"modal-backdrop",3,"keydown.escape"],["role","dialog","aria-modal","true",1,"modal-dialog",3,"mousedown","click"],[1,"titulo","text-center","mb-3"],["autocomplete","off",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["type","text","formControlName","nombre",1,"form-control"],[1,"col-6"],["type","text","formControlName","renglon1",1,"form-control"],["type","text","formControlName","renglon2",1,"form-control"],["type","text","formControlName","codigoBarras",1,"form-control"],["type","text","formControlName","categoria",1,"form-control"],["type","text","formControlName","unidad",1,"form-control"],["type","number","formControlName","precio",1,"form-control"],["type","number","formControlName","costo",1,"form-control"],["type","number","formControlName","stockMinimo",1,"form-control"],["type","number","formControlName","stockMaximo",1,"form-control"],[1,"col-2","form-check-vertical"],["for","chkIva",1,"form-label"],["type","checkbox","formControlName","iva","id","chkIva",1,"form-check-input"],["for","chkGen",1,"form-label"],["type","checkbox","formControlName","generico","id","chkGen",1,"form-check-input"],["for","chkINA",1,"form-label"],["type","checkbox","formControlName","descuentoINAPAM","id","chkINA",1,"form-check-input"],["type","text","formControlName","ubicacion",1,"form-control"],["type","button",1,"btn-rojo-chico","w-100",3,"click"],["type","button",1,"btn-verde-chico","w-100",3,"click","disabled"]],template:function(e,n){if(e&1&&(l(0,"div",3)(1,"div",4)(2,"h1",5),d(3,"Ajuste de Inventario en Almacen"),s(),l(4,"button",6),E("click",function(){return n.abrirNuevoProducto()}),y(5,"fa-icon",7),l(6,"span",8),d(7,"Nuevo"),s()()(),l(8,"div",9)(9,"div",10)(10,"label",11),d(11,"Nombre"),s(),l(12,"div",12)(13,"input",13),Z("ngModelChange",function(a){return J(n.filtros.nombre,a)||(n.filtros.nombre=a),a}),s(),N(14,OP,2,1,"button",14),s()(),l(15,"div",15)(16,"label",11),d(17,"C\xF3digo de barras"),s(),l(18,"div",12)(19,"input",16),Z("ngModelChange",function(a){return J(n.filtros.codigoBarras,a)||(n.filtros.codigoBarras=a),a}),s(),N(20,DP,2,1,"button",17),s()(),l(21,"div",15)(22,"label",11),d(23,"Categor\xEDa"),s(),l(24,"div",12)(25,"input",18),Z("ngModelChange",function(a){return J(n.filtros.categoria,a)||(n.filtros.categoria=a),a}),s(),N(26,RP,2,1,"button",19),s()(),l(27,"div",20)(28,"label",11),d(29,"INAPAM"),s(),l(30,"div",12)(31,"select",21),Z("ngModelChange",function(a){return J(n.filtros.descuentoINAPAM,a)||(n.filtros.descuentoINAPAM=a),a}),l(32,"option",22),d(33,"--"),s(),l(34,"option",22),d(35,"S\xED"),s(),l(36,"option",22),d(37,"No"),s()(),N(38,NP,2,1,"button",23),s()(),l(39,"div",20)(40,"label",11),d(41,"Gen\xE9rico?"),s(),l(42,"div",12)(43,"select",24),Z("ngModelChange",function(a){return J(n.filtros.generico,a)||(n.filtros.generico=a),a}),l(44,"option",22),d(45,"--"),s(),l(46,"option",22),d(47,"S\xED"),s(),l(48,"option",22),d(49,"No"),s()(),N(50,BP,2,1,"button",25),s()(),l(51,"div",15)(52,"label",11),d(53,"Solo bajo stock"),s(),l(54,"div",12)(55,"div",26)(56,"input",27),Z("ngModelChange",function(a){return J(n.filtros.bajoStock,a)||(n.filtros.bajoStock=a),a}),E("change",function(){return n.aplicarFiltros()}),s(),l(57,"label",28),d(58," Existencia < Stock M\xEDn. "),s()(),N(59,LP,2,1,"button",29),s()(),l(60,"div",30)(61,"button",31),E("click",function(){return n.aplicarFiltros()}),N(62,VP,1,0,"i",32),d(63),s()(),l(64,"div",15)(65,"label",33),d(66,"C\xF3digo Barras"),s(),l(67,"div",12)(68,"div",26)(69,"input",34),Z("ngModelChange",function(a){return J(n.filtros.duplicadosCB,a)||(n.filtros.duplicadosCB=a),a}),E("change",function(){return n.aplicarFiltros()}),s(),l(70,"label",35),d(71," Mostrar duplicados "),s()(),N(72,UP,2,1,"button",36),s()()(),l(73,"form",37)(74,"div",38)(75,"label",39),d(76,"Cambio masivo"),s(),l(77,"label"),d(78,"(aplica a productos seleccionados en la tabla)"),s()(),l(79,"div",40)(80,"div")(81,"label",41),d(82,"Datos b\xE1sicos:"),s(),l(83,"label",42),d(84,"Categor\xEDa:"),s(),y(85,"input",43),l(86,"label",42),d(87,"Stock M\xEDnimo:"),s(),y(88,"input",44),l(89,"label",42),d(90,"Stock M\xE1ximo:"),s(),y(91,"input",45),l(92,"label",42),d(93,"INAPAM:"),s(),l(94,"select",46)(95,"option",22),d(96,"--"),s(),l(97,"option",22),d(98,"S\xED"),s(),l(99,"option",22),d(100,"No"),s()()(),l(101,"div")(102,"label",47),d(103,"Aumentar o disminuir Precios:"),s(),l(104,"label",48),y(105,"input",49),d(106,"Porcentaje "),s(),l(107,"label",42),d(108,"%:"),s(),y(109,"input",50),l(110,"label",48),y(111,"input",51),d(112,"Cantidad "),s(),l(113,"label",42),d(114,"$:"),s(),y(115,"input",52),s()(),l(116,"div")(117,"div",40)(118,"div")(119,"label",53),d(120,"Promo Cantidad Requerida:"),s(),l(121,"select",54)(122,"option",22),d(123,"--"),s(),l(124,"option",22),d(125,"2x1"),s(),l(126,"option",22),d(127,"3x2"),s(),l(128,"option",22),d(129,"4x3"),s()(),l(130,"label",42),d(131,"Inicia:"),s(),y(132,"input",55),l(133,"label",42),d(134,"Termina:"),s(),y(135,"input",56),s(),l(136,"div")(137,"label",53),d(138,"Promo Temporada:"),s(),l(139,"label",42),d(140,"% Desc.:"),s(),y(141,"input",57),l(142,"label",42),d(143,"Inicia:"),s(),y(144,"input",58),l(145,"label",42),d(146,"Termina:"),s(),y(147,"input",59),l(148,"label",42),d(149,"Monedero:"),s(),l(150,"select",60)(151,"option",22),d(152,"--"),s(),l(153,"option",22),d(154,"S\xED"),s(),l(155,"option",22),d(156,"No"),s()()()(),l(157,"div",61),N(158,jP,27,5,"div",62),s()(),l(159,"div",63)(160,"button",64),E("click",function(){return n.limpiarCamposCambioMasivo()}),d(161,"Cancelar "),s(),l(162,"button",65),E("click",function(){return n.aplicarCambiosMasivos()}),d(163," Aplicar Cambios "),s()()(),l(164,"table",66)(165,"thead")(166,"tr")(167,"th")(168,"input",67),E("change",function(a){return n.seleccionarTodos(a)}),s()(),l(169,"th"),d(170,"Imagen"),s(),l(171,"th",68),E("click",function(){return n.ordenar("nombre")}),d(172," Nombre / Ubic. "),y(173,"i",69),s(),l(174,"th",68),E("click",function(){return n.ordenar("codigoBarras")}),d(175," C\xF3digo Barras "),y(176,"i",69),s(),l(177,"th",68),E("click",function(){return n.ordenar("categoria")}),d(178," Categor\xEDa "),y(179,"i",69),s(),l(180,"th"),d(181,"Gen\xE9rico"),s(),l(182,"th"),d(183,"Stock M\xEDn."),s(),l(184,"th"),d(185,"Stock M\xE1x."),s(),l(186,"th",68),E("click",function(){return n.ordenar("existencia")}),d(187," Existencia "),y(188,"i",69),s(),l(189,"th"),d(190,"INAPAM"),s(),l(191,"th"),d(192,"Costo"),s(),l(193,"th"),d(194,"Precio"),s(),l(195,"th"),d(196,"Acciones"),s()()(),l(197,"tbody"),N(198,qP,43,32,"tr",70),s()(),l(199,"div",71)(200,"button",72),E("click",function(){return n.paginaActual=1}),y(201,"i",73),s(),l(202,"button",74),E("click",function(){return n.paginaActual=n.paginaActual-1}),y(203,"i",75),s(),d(204),l(205,"span",76),d(206),s(),l(207,"button",77),E("click",function(){return n.paginaActual=n.paginaActual+1}),y(208,"i",78),s(),l(209,"button",79),E("click",function(){return n.paginaActual=n.totalPaginas}),y(210,"i",80),s()(),N(211,XP,69,3,"div",81),s()),e&2){let r,a,o,u,m,f;c(5),p("icon",n.faPlus),c(8),Q("ngModel",n.filtros.nombre),c(),p("ngIf",n.filtros.nombre),c(5),Q("ngModel",n.filtros.codigoBarras),c(),p("ngIf",n.filtros.codigoBarras),c(5),Q("ngModel",n.filtros.categoria),c(),p("ngIf",n.filtros.categoria),c(5),Q("ngModel",n.filtros.descuentoINAPAM),c(),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("ngIf",n.filtros.descuentoINAPAM!==null),c(5),Q("ngModel",n.filtros.generico),c(),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("ngIf",n.filtros.generico!==null),c(6),Q("ngModel",n.filtros.bajoStock),c(3),p("ngIf",n.filtros.bajoStock),c(2),p("disabled",n.filtrando||n.iniciando),Je("aria-busy",n.filtrando||n.iniciando),c(),p("ngIf",n.filtrando||n.iniciando),c(),R(" ",n.filtrando?"Filtrando\u2026":n.iniciando?"Iniciando\u2026":"Buscar"," "),c(6),Q("ngModel",n.filtros.duplicadosCB),c(3),p("ngIf",n.filtros.duplicadosCB),c(),p("formGroup",n.formularioMasivo),c(22),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(5),p("ngClass",gi(63,Ig,((r=n.formularioMasivo.get("ajustePrecioModo"))==null?null:r.value)==="porcentaje")),c(3),Re("disabled-label",((a=n.formularioMasivo.get("ajustePrecioModo"))==null?null:a.value)!="porcentaje"),c(2),Re("disabled-label",((o=n.formularioMasivo.get("ajustePrecioModo"))==null?null:o.value)!="porcentaje"),c(),p("ngClass",gi(65,Ig,((u=n.formularioMasivo.get("ajustePrecioModo"))==null?null:u.value)==="cantidad")),c(3),Re("disabled-label",((m=n.formularioMasivo.get("ajustePrecioModo"))==null?null:m.value)!="cantidad"),c(2),Re("disabled-label",((f=n.formularioMasivo.get("ajustePrecioModo"))==null?null:f.value)!="cantidad"),c(7),p("ngValue",null),c(2),p("ngValue",2),c(2),p("ngValue",3),c(2),p("ngValue",4),c(23),p("ngValue",null),c(2),p("ngValue",!0),c(2),p("ngValue",!1),c(2),p("formGroup",n.promosPorDiaForm),c(),p("ngForOf",n.diasSemana),c(4),p("disabled",!n.cambiosMasivosValidos),c(11),p("ngClass",Wi(67,ic,n.columnaOrden==="nombre"&&n.direccionOrden==="asc",n.columnaOrden==="nombre"&&n.direccionOrden==="desc",n.columnaOrden!=="nombre")),c(3),p("ngClass",Wi(71,ic,n.columnaOrden==="codigoBarras"&&n.direccionOrden==="asc",n.columnaOrden==="codigoBarras"&&n.direccionOrden==="desc",n.columnaOrden!=="codigoBarras")),c(3),p("ngClass",Wi(75,ic,n.columnaOrden==="categoria"&&n.direccionOrden==="asc",n.columnaOrden==="categoria"&&n.direccionOrden==="desc",n.columnaOrden!=="categoria")),c(9),p("ngClass",Wi(79,ic,n.columnaOrden==="existencia"&&n.direccionOrden==="asc",n.columnaOrden==="existencia"&&n.direccionOrden==="desc",n.columnaOrden!=="existencia")),c(10),p("ngForOf",n.productosPagina)("ngForTrackBy",n.trackProdBy),c(2),p("disabled",n.paginaActual===1),c(2),p("disabled",n.paginaActual===1),c(2),fn(" P\xE1gina ",n.paginaActual," de ",n.totalPaginas," "),c(2),R("(",n.productosFiltrados.length," productos)"),c(),p("disabled",n.paginaActual===n.totalPaginas),c(2),p("disabled",n.paginaActual===n.totalPaginas),c(2),p("ngIf",n.mostrarNuevoProducto)}},dependencies:[Ae,si,We,Be,Nt,rt,Ft,it,nt,Xe,Gt,li,tt,Er,ze,Mt,_t,Bt,ci,di,Hs,ti,ei,Lt,ut],styles:[".panel[_ngcontent-%COMP%]{padding:5px}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.col-producto[_ngcontent-%COMP%]   .prod-nombre[_ngcontent-%COMP%]{line-height:1.2}.col-producto[_ngcontent-%COMP%]   .prod-ubicacion[_ngcontent-%COMP%]{display:block;margin-top:2px;font-size:12px;color:red;line-height:1.1;overflow-wrap:anywhere}.masivos[_ngcontent-%COMP%]{font-size:small;width:100%;background-color:#b7fbe4}.center-content[_ngcontent-%COMP%]{text-align:center}.container-masivos[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.tit-promo[_ngcontent-%COMP%]{color:#02047c;font-weight:500}.btn-right[_ngcontent-%COMP%]{margin-left:auto;margin-right:0!important}.disabled-label[_ngcontent-%COMP%]{color:gray;opacity:.5;pointer-events:none}.selected-radio[_ngcontent-%COMP%]{color:#00f}.selected-checkbox[_ngcontent-%COMP%]{color:#000}.fila-modificada[_ngcontent-%COMP%]{background-color:#e6ffe6!important}.paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#0ff;background-color:#8a2be2}.paginacion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .paginacion[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6;color:gray}.btn-grabar[_ngcontent-%COMP%]{text-align:center}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:grid;place-items:center}.modal-dialog[_ngcontent-%COMP%]{background:azure;color:#222;width:min(900px,96vw);max-height:90vh;overflow:auto;border-radius:12px;padding:16px 18px;box-shadow:0 12px 48px #00000080;pointer-events:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:150px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden!important}.modal-dialog[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#fff;color:#222}.form-check-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.modal-dialog[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:0;margin-top:.5rem;font-weight:600}.form-check-input[_ngcontent-%COMP%]{transform:scale(1.05)}.img-cell[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:30px;height:30px;padding:0;border:1px solid #e5e7eb;border-radius:6px;background:#fbfcf8;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;overflow:hidden}.img-button[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;backface-visibility:hidden;-webkit-font-smoothing:antialiased}.img-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#033996;background:#bcf996}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#00000059;color:#c4fca6;opacity:0;transition:opacity .15s;pointer-events:none}.img-button[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.img-cell[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center}.img-button[_ngcontent-%COMP%]{position:relative;width:48px;height:48px;padding:0;overflow:hidden}.img-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;backface-visibility:hidden}.img-button[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{pointer-events:none}.zoom-btn[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-6px;width:22px;height:22px;border-radius:50%;border:0;background:#0009;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;pointer-events:auto}.zoom-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;line-height:1}.zoom-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})};function KP(i,t){if(i&1&&(l(0,"span",10),d(1),s()),i&2){let e=_();c(),k(e.farmaciaNombre)}}function YP(i,t){if(i&1){let e=ie();l(0,"button",11),E("click",function(){T(e);let r=_();return P(r.router.navigate(["/home"]))}),l(1,"mat-icon"),d(2,"home"),s()()}}function QP(i,t){if(i&1){let e=ie();at(0),l(1,"button",12),E("click",function(){T(e);let r=_();return P(r.authService.showLogin())}),l(2,"mat-icon"),d(3,"login"),s()(),ot()}}function JP(i,t){if(i&1&&(l(0,"span",16),d(1),s()),i&2){let e=_(2);c(),fn(" Bienvenido, ",e.userNombre," (",e.userRol,") ")}}function ZP(i,t){if(i&1){let e=ie();l(0,"div",13),N(1,JP,2,2,"span",14),l(2,"button",15),E("click",function(){T(e);let r=_();return P(r.authService.logout())}),l(3,"mat-icon"),d(4,"logout"),s()()()}if(i&2){let e=_();c(),p("ngIf",e.userNombre)}}var rc=class i{constructor(t,e,n){this.authService=t;this.router=e;this.ventaService=n;this.authService.userNombre$.subscribe(r=>{this.userNombre=r}),this.authService.userRol$.subscribe(r=>{this.userRol=r}),this.authService.isEditProfileVisible.subscribe(r=>{this.isEditProfileVisible=r,r&&(this.menuOpen=!1)})}isSidebarOpen=!1;toggleSidebar=new Yt;usuario=null;userNombre=null;userRol=null;farmaciaId=null;farmaciaNombre="";isEditProfileVisible=!1;menuOpen=!1;searchQuery="";mostrarInicio=!1;userLoggedOut=new Yt;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,this.userNombre=t?.nombre||null,this.userRol=t?.rol||null}),this.authService.farmacia$.subscribe(t=>{t?(this.farmaciaId=t._id,this.farmaciaNombre=t.nombre):(this.farmaciaId=null,this.farmaciaNombre="")}),this.actualizarVisibilidadInicio(),this.router.events.subscribe(()=>{this.actualizarVisibilidadInicio()})}actualizarVisibilidadInicio(){if(this.router.url==="/home"){this.mostrarInicio=!1;return}this.mostrarInicio=this.authService.isLoggedIn}irAInicio(){this.router.navigate(["/home"])}toggleMenu(){this.isEditProfileVisible||(this.menuOpen=!this.menuOpen)}logout(){this.authService.logout(),this.userLoggedOut.emit()}openChangePassword(){this.menuOpen=!1,this.authService.showChangePassword()}openUpdateProfile(){this.menuOpen=!1,this.authService.showEditProfile()}clearSearch(){this.searchQuery=""}static \u0275fac=function(e){return new(e||i)(te(qt),te(Qi),te(Ua))};static \u0275cmp=Te({type:i,selectors:[["app-header"]],inputs:{isSidebarOpen:"isSidebarOpen"},outputs:{toggleSidebar:"toggleSidebar",userLoggedOut:"userLoggedOut"},decls:14,vars:5,consts:[["loggedInTemplate",""],[1,"header"],[1,"header-left"],[1,"toggle-sidebar-button",3,"click"],["src","assets/images/farmBienIcon.png","alt","Logo",1,"header-logo"],[1,"site-title"],["class","site-sucursal",4,"ngIf"],[1,"header-right"],["mat-icon-button","","matTooltip","Ir al inicio","class","icon-button",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"site-sucursal"],["mat-icon-button","","matTooltip","Ir al inicio",1,"icon-button",3,"click"],["mat-icon-button","","matTooltip","Iniciar sesi\xF3n",1,"icon-button",3,"click"],[1,"user-info-container",2,"display","flex","align-items","center","gap","10px"],["class","user-info",4,"ngIf"],["mat-icon-button","","matTooltip","Cerrar sesi\xF3n",1,"icon-button-exit",3,"click"],[1,"user-info"]],template:function(e,n){if(e&1){let r=ie();l(0,"header",1)(1,"div",2)(2,"button",3),E("click",function(){return T(r),P(n.toggleSidebar.emit())}),l(3,"mat-icon"),d(4),s()(),y(5,"img",4),l(6,"span",5),d(7,"Farmacias del Bienestar para Todos"),s(),N(8,KP,2,1,"span",6),s(),l(9,"div",7),N(10,YP,3,0,"button",8)(11,QP,4,0,"ng-container",9)(12,ZP,5,1,"ng-template",null,0,Ea),s()()}if(e&2){let r=$t(13);c(4),k(n.isSidebarOpen?"close":"menu"),c(4),p("ngIf",n.farmaciaNombre),c(2),p("ngIf",n.mostrarInicio),c(),p("ngIf",!n.authService.isLoggedIn)("ngIfElse",r)}},dependencies:[Be,Pa,Yn,kr,rt,Lt,ut],styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 .5rem;background-color:#007bff;color:#fff;height:80px;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.toggle-sidebar-button[_ngcontent-%COMP%]{font-size:24px;margin:0;padding:0;color:#fff;background:none;border:none;cursor:pointer}.header-logo[_ngcontent-%COMP%]{height:30px;margin-right:10px}.site-title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.site-sucursal[_ngcontent-%COMP%]{font-size:20px;font-weight:500;color:#b5b5fc}a[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{padding:.5rem;border-radius:6px;border:none;width:300px}.clear-button[_ngcontent-%COMP%], .search-button[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;margin-left:5px;cursor:pointer;color:#fff}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.user-info[_ngcontent-%COMP%]{font-size:14px}.config-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#fff}.config-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;vertical-align:middle}.relative[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;box-shadow:0 4px 6px #0000001a;border-radius:5px;padding:10px 0;min-width:160px;z-index:1200;display:flex;flex-direction:column}.dropdown-item[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 15px;background:none;border:none;text-align:left;cursor:pointer;font-size:14px;transition:background .3s}.dropdown-item[_ngcontent-%COMP%]:hover{background:#f2f2f2}.dropdown-divider[_ngcontent-%COMP%]{border:0;height:1px;background-color:#ddd;margin:5px 0}.search-container[_ngcontent-%COMP%]{flex:1;max-width:600px;display:flex;align-items:center;justify-content:center}.search-input[_ngcontent-%COMP%]{flex:1;max-width:50%;min-width:200px;padding:6px 12px;border-radius:4px;border:1px solid #ccc}.search-button[_ngcontent-%COMP%], .clear-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:5px;font-size:18px}.clear-button[_ngcontent-%COMP%]{color:#086d86;margin-right:5px}.icon-button[_ngcontent-%COMP%]{color:#9acd32;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,red,#ece6e6);color:#ff0}.icon-button-exit[_ngcontent-%COMP%]{color:#f80404;background:transparent;border:none;padding:4px;margin:0;width:40px;height:40px;line-height:1}.icon-button-exit[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#f80404,#fff);color:#ff0}@media (max-width: 768px){.user-info[_ngcontent-%COMP%]{display:none}}"]})};function e4(i,t){if(i&1){let e=ie();l(0,"li",4)(1,"span",5),E("click",function(){T(e);let r=_();return P(r.toggleMenu("catalogs"))}),d(2),s()()}if(i&2){let e=_();c(2),R(" Cat\xE1logos ",e.expandedMenu==="catalogs"?"\u25B2":"\u25B6"," ")}}function t4(i,t){i&1&&(l(0,"ul",6)(1,"li",11),d(2," Compras "),y(3,"fa-icon",9),s(),l(4,"li",11),d(5," Surtir Farmacia "),y(6,"fa-icon",9),s(),l(7,"li",11),d(8," Ajustes inventario "),y(9,"fa-icon",9),s(),l(10,"li",11),d(11," Presupuesto compras "),y(12,"fa-icon",9),s()()),i&2&&(c(),p("routerLink","/compras"),c(2),p("icon","truck"),c(),p("routerLink","/surtir-farmacia"),c(2),p("icon","shopping-cart"),c(),p("routerLink","/ajustes-inventario"),c(2),p("icon","file-signature"),c(),p("routerLink","/reporte-presupuesto"),c(2),p("icon","file-signature"))}function i4(i,t){if(i&1){let e=ie();l(0,"li",10)(1,"span",5),E("click",function(){T(e);let r=_(2);return P(r.toggleSubMenu("almacen"))}),d(2," Almac\xE9n "),y(3,"fa-icon",9),d(4),s(),N(5,t4,13,8,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","warehouse"),c(),R(" ",e.expandedSubMenu==="almacen"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="almacen")}}function n4(i,t){i&1&&(l(0,"ul",6)(1,"li",11),d(2," Mantenimiento "),y(3,"fa-icon",9),s(),l(4,"li",11),d(5," Inventario "),y(6,"fa-icon",9),s()()),i&2&&(c(),p("routerLink","/farmacias"),c(2),p("icon","truck"),c(),p("routerLink","/inventario-farmacias"),c(2),p("icon","file-signature"))}function r4(i,t){if(i&1){let e=ie();l(0,"ul",6),N(1,i4,6,3,"li",7),l(2,"li",8),d(3,"Proveedores "),y(4,"fa-icon",9),s(),l(5,"li",10)(6,"span",5),E("click",function(){T(e);let r=_();return P(r.toggleSubMenu("farmacias"))}),d(7," Farmacias "),y(8,"fa-icon",9),d(9),s(),N(10,n4,7,4,"ul",3),s(),l(11,"li",8),d(12,"Usuarios "),y(13,"fa-icon",9),s(),l(14,"li",8),d(15,"Clientes - reportes"),y(16,"fa-icon",9),s(),l(17,"li",8),d(18,"Cortes de caja "),y(19,"fa-icon",9),s()()}if(i&2){let e=_();c(),p("ngIf",e.userRol==="admin"),c(),p("routerLink","/proveedores"),c(2),p("icon","truck"),c(4),p("icon","warehouse"),c(),R(" ",e.expandedSubMenu==="farmacias"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="farmacias"),c(),p("routerLink","/usuarios"),c(2),p("icon","user"),c(),p("routerLink","/clientes"),c(2),p("icon","users"),c(),p("routerLink","/cortes-de-caja"),c(2),p("icon","file-signature")}}function a4(i,t){i&1&&(l(0,"li",8),d(1," Ventas "),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/ventas"),c(2),p("icon","cash-register"))}function o4(i,t){i&1&&(l(0,"li",8),d(1," Devoluciones "),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/devoluciones"),c(2),p("icon","undo"))}function s4(i,t){i&1&&(l(0,"li",8),d(1," Pedidos especiales"),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/pedidos"),c(2),p("icon","shopping-cart"))}function l4(i,t){i&1&&(l(0,"li",8),d(1," Corte de caja"),y(2,"fa-icon",9),s()),i&2&&(p("routerLink","/inicio-turno"),c(2),p("icon","file-signature"))}function c4(i,t){i&1&&(l(0,"li"),d(1," Consultas m\xE9dicas "),y(2,"fa-icon",9),s()),i&2&&(c(2),p("icon","stethoscope"))}function d4(i,t){i&1&&(l(0,"li"),d(1," Recetas "),y(2,"fa-icon",9),s()),i&2&&(c(2),p("icon","prescription"))}function u4(i,t){if(i&1&&(l(0,"ul",6),N(1,a4,3,2,"li",12)(2,o4,3,2,"li",12)(3,s4,3,2,"li",12)(4,l4,3,2,"li",12)(5,c4,3,1,"li",13)(6,d4,3,1,"li",13),s()),i&2){let e=_();c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="empleado"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="medico"),c(),p("ngIf",e.userRol==="admin"||e.userRol==="medico")}}function m4(i,t){if(i&1){let e=ie();l(0,"li",4)(1,"span",5),E("click",function(){T(e);let r=_();return P(r.toggleMenu("reports"))}),d(2),s()()}if(i&2){let e=_();c(2),R(" Reportes ",e.expandedMenu==="reports"?"\u25B2":"\u25B6"," ")}}function f4(i,t){if(i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Ventas"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Productos Ventas - Exist "),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Un s\xF3lo producto"),y(12,"fa-icon",9),s()(),l(13,"li",11)(14,"span"),d(15,"Devoluciones ventas"),y(16,"fa-icon",9),s()(),l(17,"li",11)(18,"span"),d(19,"Pedidos"),y(20,"fa-icon",9),s()(),l(21,"li",11)(22,"span"),d(23,"Cancelaciones pedidos"),y(24,"fa-icon",9),s()()()),i&2){let e=_(3);c(),p("routerLink","reporte/ventas"),c(3),p("icon","cash-register"),c(),p("routerLink","/reporte/ventas-por-farmacia"),c(3),p("icon",e.icons.reporteVentas),c(),p("routerLink","reporte/ventas-producto"),c(3),p("icon",e.icons.faReceipt),c(),p("routerLink","reportes/devoluciones"),c(3),p("icon","undo"),c(),p("routerLink","/reporte/pedidos"),c(3),p("icon","shopping-cart"),c(),p("routerLink","reportes/cancelaciones"),c(3),p("icon","undo")}}function p4(i,t){if(i&1){let e=ie();l(0,"li",10)(1,"span",5),E("click",function(){T(e);let r=_(2);return P(r.toggleSubMenu("ventas"))}),d(2," Ventas - Pedidos "),y(3,"fa-icon",9),d(4),s(),N(5,f4,25,12,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","cash-register"),c(),R(" ",e.expandedSubMenu==="ventas"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="ventas")}}function h4(i,t){i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Compras general"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Compras resumen"),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Compras x Producto"),y(12,"fa-icon",9),s()()()),i&2&&(c(),p("routerLink","reporte/compras"),c(3),p("icon","shopping-cart"),c(),p("routerLink","reportes-compras"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reportes/compras-historial-producto"),c(3),p("icon","sack-dollar"))}function g4(i,t){if(i&1){let e=ie();l(0,"li",10)(1,"span",5),E("click",function(){T(e);let r=_(2);return P(r.toggleSubMenu("compras"))}),d(2," Compras "),y(3,"fa-icon",9),d(4),s(),N(5,h4,13,6,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","truck"),c(),R(" ",e.expandedSubMenu==="compras"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="compras")}}function _4(i,t){i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Resumen utilidades"),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"TOP utilidades"),y(8,"fa-icon",9),s()(),l(9,"li",11)(10,"span"),d(11,"Compras vs Ventas"),y(12,"fa-icon",9),s()()()),i&2&&(c(),p("routerLink","reporte/resumen-utilidades"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reporte/utilidades"),c(3),p("icon","sack-dollar"),c(),p("routerLink","reportes/compras-ventas"),c(3),p("icon","sack-dollar"))}function v4(i,t){if(i&1){let e=ie();l(0,"li",10)(1,"span",5),E("click",function(){T(e);let r=_(2);return P(r.toggleSubMenu("balance"))}),d(2," Balance "),y(3,"fa-icon",9),d(4),s(),N(5,_4,13,6,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon","scale-balanced"),c(),R(" ",e.expandedSubMenu==="balance"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="balance")}}function x4(i,t){if(i&1&&(l(0,"ul",6)(1,"li",11)(2,"span"),d(3,"Impresi\xF3n "),y(4,"fa-icon",9),s()(),l(5,"li",11)(6,"span"),d(7,"Dise\xF1o "),y(8,"fa-icon",9),s()()()),i&2){let e=_(3);c(),p("routerLink","etiquetas/print"),c(3),p("icon",e.faPrint),c(),p("routerLink","etiquetas/design"),c(3),p("icon",e.faPenRuler)}}function b4(i,t){if(i&1){let e=ie();l(0,"li",10)(1,"span",5),E("click",function(){T(e);let r=_(2);return P(r.toggleSubMenu("etiquetas"))}),d(2," Etiquetas "),y(3,"fa-icon",9),d(4),s(),N(5,x4,9,4,"ul",3),s()}if(i&2){let e=_(2);c(3),p("icon",e.faTags),c(),R(" ",e.expandedSubMenu==="etiquetas"?"\u25B2":"\u25B6"," "),c(),p("ngIf",e.expandedSubMenu==="etiquetas")}}function y4(i,t){if(i&1&&(l(0,"ul",6),N(1,p4,6,3,"li",7)(2,g4,6,3,"li",7)(3,v4,6,3,"li",7)(4,b4,6,3,"li",7),s()),i&2){let e=_();c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin"),c(),p("ngIf",e.userRol==="admin")}}var ac=class i{constructor(t,e,n){this.authService=t;this.library=e;this.router=n;this.library.addIcons(hf,$m,Km,cf,af,Xm,Gm,of,lf,Jm,sf,Qm,jm,tf,Hm,pf,g0,mf)}open=!1;openChange=new Yt;usuario=null;userRol=null;isSidebarOpen=!1;expandedMenu=null;expandedSubMenu=null;icons={reporteVentas:g0,faReceipt:df};faTags=Zm;faPrint=_f;faPenRuler=zm;ngOnInit(){this.authService.usuario$.subscribe(t=>{this.usuario=t,t&&t.rol&&(this.userRol=t.rol)}),this.router.events.pipe($r(t=>t instanceof Vs)).subscribe(()=>this.close())}closeSidebar(){this.isSidebarOpen=!1}toggleSidebar(){this.open=!this.open,this.openChange.emit(this.open)}toggleMenu(t){this.expandedMenu===t?(this.expandedMenu=null,this.expandedSubMenu=null):(this.expandedMenu=t,this.expandedSubMenu=null)}toggleSubMenu(t){this.expandedSubMenu=this.expandedSubMenu===t?null:t}close(){this.open&&(this.open=!1,this.openChange.emit(this.open))}get isLoggedIn(){return!!this.usuario}get currentRol(){return this.usuario?.rol||null}static \u0275fac=function(e){return new(e||i)(te(qt),te(bi),te(Qi))};static \u0275cmp=Te({type:i,selectors:[["app-sidebar"]],inputs:{open:"open"},outputs:{openChange:"openChange"},decls:11,vars:8,consts:[[1,"sidebar"],["src","assets/images/farmBienLogo.png","alt","Farmacia del Bienestar",1,"sidebar-image"],["class","menu-title",4,"ngIf"],["class","submenu",4,"ngIf"],[1,"menu-title"],[3,"click"],[1,"submenu"],["class","has-submenu",4,"ngIf"],["routerLinkActive","active",3,"routerLink"],[1,"menu-icon",3,"icon"],[1,"has-submenu"],["routerLinkActive","active",1,"submenu-item",3,"routerLink"],["routerLinkActive","active",3,"routerLink",4,"ngIf"],[4,"ngIf"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"ul"),y(2,"img",1),N(3,e4,3,1,"li",2)(4,r4,20,12,"ul",3),l(5,"li",4)(6,"span",5),E("click",function(){return n.toggleMenu("movements")}),d(7),s()(),N(8,u4,7,6,"ul",3)(9,m4,3,1,"li",2)(10,y4,5,4,"ul",3),s()()),e&2&&(Re("open",n.open),c(3),p("ngIf",n.userRol==="admin"),c(),p("ngIf",n.expandedMenu==="catalogs"),c(3),R(" Movimientos ",n.expandedMenu==="movements"?"\u25B2":"\u25B6"," "),c(),p("ngIf",n.expandedMenu==="movements"),c(),p("ngIf",n.userRol==="admin"),c(),p("ngIf",n.expandedMenu==="reports"))},dependencies:[Ae,Be,ti,ei,Pa,Rm,Nm],styles:[".sidebar[_ngcontent-%COMP%]{width:0;transition:width .3s ease-in-out;background:#007bff;overflow-x:hidden;height:100%;padding:0}.sidebar.open[_ngcontent-%COMP%]{width:280px;padding:0}.sidebar[_ngcontent-%COMP%]:not(.open)   ul[_ngcontent-%COMP%]{display:none}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;color:#fff;margin-left:auto}.sidebar-image[_ngcontent-%COMP%]{width:60%;max-width:150px;border-radius:10px;margin-bottom:15px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}li[_ngcontent-%COMP%]{margin:10px 0;cursor:pointer;font-size:14px;font-weight:400;color:#fff;display:flex;justify-content:space-between;align-items:center;padding:5px 10px}li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#f99f18}.menu-icon[_ngcontent-%COMP%]{color:#010e26;font-size:16px;margin-left:10px}.menu-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#d9ef0a;text-align:left;padding:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.2)}.submenu[_ngcontent-%COMP%]{padding:10px;border-radius:5px}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px;font-size:14px;color:#fff}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:#424202;background-color:#ffebcd}.sidebar[_ngcontent-%COMP%]   ul.submenu[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{position:relative}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{margin-left:1.5rem;margin-top:.3rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.2rem 0;padding-left:.5rem;font-size:.95rem}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%]{display:block}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:5px 10px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]{list-style-type:disc;list-style-position:inside;margin:.4rem 0 0 1.5rem;padding:0}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:list-item;padding:4px 10px;margin:0;font-size:14px}.sidebar[_ngcontent-%COMP%]   li.has-submenu[_ngcontent-%COMP%] > ul.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:none}.submenu-item[_ngcontent-%COMP%]{color:#fb8a39!important}.submenu-item[_ngcontent-%COMP%]:hover{color:brown!important;background-color:#f0f8ff!important}"]})};function C4(i,t){if(i&1&&y(0,"app-sidebar",6),i&2){let e=_();p("open",e.isSidebarOpen)}}function S4(i,t){i&1&&y(0,"app-login")}var oc=class i{constructor(t,e){this.authService=t;this.router=e}usuario=null;isLoginVisible;isSidebarOpen=!1;ngOnInit(){this.authService.notifyUserChange(),this.authService.usuario$.subscribe(t=>{this.usuario=t}),this.isLoginVisible=this.authService.isLoginVisible.asObservable(),this.router.events.pipe($r(t=>t instanceof Vs)).subscribe(()=>{this.isSidebarOpen=!1})}onToggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen}static \u0275fac=function(e){return new(e||i)(te(qt),te(Qi))};static \u0275cmp=Te({type:i,selectors:[["app-main-layout"]],decls:8,vars:5,consts:[[1,"layout-container"],[3,"open",4,"ngIf"],[1,"content-area"],[3,"toggleSidebar","isSidebarOpen"],[4,"ngIf"],[1,"main-content"],[3,"open"]],template:function(e,n){e&1&&(l(0,"div",0),N(1,C4,1,1,"app-sidebar",1),l(2,"div",2)(3,"app-header",3),E("toggleSidebar",function(){return n.onToggleSidebar()}),s(),N(4,S4,1,0,"app-login",4),F(5,"async"),l(6,"main",5),y(7,"router-outlet"),s()()()),e&2&&(c(),p("ngIf",n.usuario),c(2),p("isSidebarOpen",n.isSidebarOpen),c(),p("ngIf",oe(5,3,n.isLoginVisible)))},dependencies:[Ae,Be,Ls,Pa,Us,rc,ac,Ba],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;min-height:100vh}.content-area[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:1rem}"]})};var Mn=class i{constructor(t){this.http=t}url=`${Ge.apiUrl}/reportes`;getVentasPorFarmacia(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-por-farmacia`,{params:e})}buildParams(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{if(r==null||r==="")return;let a=r instanceof Date?this.toLocalISODate(r):String(r);e=e.set(n,a)}),e}toLocalISODate(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}getVentasProductoDetalle(t){let e=this.buildParams(t);return this.http.get(`${this.url}/ventas-producto-detalle`,{params:e})}toYmdLocal(t){if(!t)return;if(typeof t=="string"){let o=t.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(o)return`${o[3]}-${o[2]}-${o[1]}`;let u=t.match(/^(\d{4})-(\d{2})-(\d{2})/);return u?`${u[1]}-${u[2]}-${u[3]}`:void 0}let e=t instanceof Date?t:new Date(t);if(isNaN(e.getTime()))return;let n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}getVentas(t){let e=`${this.url}/ventas/consulta`,n=localStorage.getItem("auth_token")||"",r=new qe({"x-auth-token":n}),a={farmaciaId:t.farmaciaId,clienteId:t.clienteId,usuarioId:t.usuarioId,totalDesde:t.totalDesde!=null?String(t.totalDesde):void 0,totalHasta:t.totalHasta!=null?String(t.totalHasta):void 0,fechaInicial:this.toYmdLocal(t.fechaInicial),fechaFinal:this.toYmdLocal(t.fechaFinal),page:t.page!=null?String(t.page):void 0,limit:t.limit!=null?String(t.limit):void 0},o=new Ht;return Object.keys(a).forEach(u=>{let m=a[u];m!==void 0&&m!==""&&(o=o.set(u,m))}),this.http.get(e,{params:o,headers:r})}getResumenUtilidades(t){let e=`${this.url}/resumen-utilidades`,n=localStorage.getItem("auth_token")||"",r=new qe({"x-auth-token":n}),a={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),farmaciaId:t.farmaciaId||void 0},o=new Ht;return Object.keys(a).forEach(u=>{let m=a[u];m!==void 0&&m!==""&&(o=o.set(u,m))}),this.http.get(e,{params:o,headers:r})}getUtilidadPorClientes(t){let e=`${this.url}/utilidad-cliente`,n=new qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),clienteId:t.clienteId||void 0,CantClientes:t.CantClientes||t.cantClientes,orden:t.orden||"utilidad",dir:t.dir||"desc"},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}getUtilidadPorProductos(t){let e=`${this.url}/utilidad-producto`,n=new qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),productoId:t.productoId||void 0,cantProductos:t.cantProductos,orden:t.orden||"utilidad",dir:t.dir||"desc",farmaciaId:t.farmaciaId||void 0},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}getUtilidadPorUsuarios(t){let e=`${this.url}/utilidad-usuario`,n=new qe({"x-auth-token":localStorage.getItem("auth_token")||""}),r={fechaIni:this.toYmdLocal(t.fechaIni),fechaFin:this.toYmdLocal(t.fechaFin),usuarioId:t.usuarioId||void 0,orden:t.orden||"utilidad",dir:t.dir||"desc"},a=new Ht;return Object.keys(r).forEach(o=>{let u=r[o];u!==void 0&&u!==""&&(a=a.set(o,u))}),this.http.get(e,{params:a,headers:n})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var w4=i=>({"text-danger":i});function E4(i,t){if(i&1&&(l(0,"option",30),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function T4(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td",31),d(10),F(11,"number"),s(),l(12,"td",31),d(13),F(14,"currency"),s(),l(15,"td",31),d(16),F(17,"currency"),s(),l(18,"td",32),d(19),F(20,"currency"),s(),l(21,"td",31),d(22),F(23,"number"),s(),l(24,"td",31),d(25),F(26,"number"),s(),l(27,"td",31),d(28),F(29,"number"),s(),l(30,"td",31)(31,"span",33),d(32),F(33,"number"),s()()()),i&2){let e=t.$implicit,n=_();c(2),k(e.farmacia),c(2),k(e.nombre),c(2),k(e.codigoBarras||"\u2014"),c(2),k(e.categoria||"\u2014"),c(2),k(oe(11,14,e.cantidadVendida)),c(3),k(oe(14,16,e.costoTotal)),c(3),k(oe(17,18,e.importeVendido)),c(2),p("ngClass",gi(31,w4,(e.utilidad||0)<0)),c(),R(" ",oe(20,20,e.utilidad)," "),c(3),R(" ",e.margenPct==null?"\u2014":Y(23,22,e.margenPct,"1.0-2")+"%"," "),c(3),k(oe(26,25,e.stockMin)),c(3),k(oe(29,27,e.stockMax)),c(3),p("ngClass",n.semaforoClass(e)),c(),R(" ",oe(33,29,e.existencia)," ")}}function P4(i,t){i&1&&(l(0,"tr")(1,"td",34),d(2,"Sin resultados"),s()())}function k4(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",35)(2,"td",36),d(3,"Totales:"),s(),l(4,"td",31),d(5),F(6,"number"),s(),l(7,"td",31),d(8),F(9,"currency"),s(),l(10,"td",31),d(11),F(12,"currency"),s(),l(13,"td",31),d(14),F(15,"currency"),s(),l(16,"td",31),d(17),F(18,"number"),s(),l(19,"td",37),d(20),F(21,"number"),s()()()),i&2){let e=_();c(5),k(oe(6,6,e.totalCantidad)),c(3),k(oe(9,8,e.totalCosto)),c(3),k(oe(12,10,e.totalImporte)),c(3),k(oe(15,12,e.totalUtilidad)),c(3),R(" ",e.totalMargenPct==null?"\u2014":Y(18,14,e.totalMargenPct,"1.0-2")+"%"," "),c(3),k(oe(21,17,e.totalExistencia))}}function I4(i,t){if(i&1){let e=ie();l(0,"div",38)(1,"button",39),E("click",function(){T(e);let r=_();return P(r.goFirst())}),y(2,"i",40),s(),l(3,"button",41),E("click",function(){T(e);let r=_();return P(r.goPrev())}),y(4,"i",42),s(),d(5),l(6,"button",43),E("click",function(){T(e);let r=_();return P(r.goNext())}),y(7,"i",44),s(),l(8,"button",45),E("click",function(){T(e);let r=_();return P(r.goLast())}),y(9,"i",46),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),Cn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}var sc=class i{constructor(t,e,n){this.reportes=t;this.farmaciaService=e;this.productosSrv=n}semaforoClass(t){let e=Number(t?.existencia??0),n=Number(t?.stockMin??0),r=Number(t?.stockMax??0);return r>0&&e>=r?"sem-green":n>0&&e<=n?"sem-red":r>0||n>0?"sem-yellow":"sem-muted"}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQ="";categoriaQ="";cargando=!1;rows=[];totalImporte=0;totalCantidad=0;totalExistencia=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}sort=null;ngOnInit(){this.cargarFarmacias(),this.buscar()}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]})}buscar(){let t=e=>e?new Date(e).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasPorFarmacia({farmaciaId:this.farmaciaId||void 0,fechaIni:t(this.fechaIni),fechaFin:t(this.fechaFin),productoQ:this.productoQ?.trim()||void 0,categoriaQ:this.categoriaQ?.trim()||void 0}).subscribe({next:e=>{let n=e?.data||[],r=a=>Number.isFinite(Number(a))?Number(a):0;this.rows=n,this.totalImporte=n.reduce((a,o)=>a+r(o.importeVendido),0),this.totalCantidad=n.reduce((a,o)=>a+r(o.cantidadVendida),0),this.totalCosto=n.reduce((a,o)=>a+r(o.costoTotal),0),this.totalUtilidad=n.reduce((a,o)=>a+r(o.utilidad),0),this.totalExistencia=n.reduce((a,o)=>a+r(o.existencia),0),this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination?.(),this.cargando=!1,console.log("productos filtrados =====>",e)},error:e=>{console.error("Error reporte ventas:",e),this.rows=[],this.totalImporte=this.totalCantidad=this.totalExistencia=this.totalCosto=this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}clearProducto(){this.productoQ=""}limpiarFiltros(){this.farmaciaId="",this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.clearProducto(),this.rows=[],this.totalCantidad=0,this.totalExistencia=0,this.totalImporte=0,this.totalItems=0,this.page=1,this.sort=null,this.buscar()}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}exportarCSV(){return Le(this,null,function*(){if(!this.rows.length)return;let t=[{key:"farmacia",label:"C\xF3d. barras"},{key:"nombre",label:"Producto"},{key:"codigoBarras",label:"C\xF3d. barras"},{key:"categoria",label:"Categor\xEDa"},{key:"cantidadVendida",label:"Vendidos"},{key:"costoTotal",label:"Costo total",map:o=>Number(o.costoTotal??0).toFixed(2)},{key:"importeVendido",label:"Importe"},{key:"utilidad",label:"Utilidad",map:o=>Number(o.utilidad??0).toFixed(2)},{key:"margenPct",label:"margenPct",map:o=>Number(o.margenPct??0).toFixed(2)},{key:"stockMin",label:"Stock M\xEDn."},{key:"stockMax",label:"Stock M\xE1x."},{key:"existencia",label:"Existencia"}],{toCSV:e,downloadCSV:n}=yield import("./chunk-SHYHNXMB.js"),r=e(this.rows,t,{separator:",",bom:!0}),a=`ventas_farmacia_${this.fechaIni}_a_${this.fechaFin}.csv`;n(a,r)})}setSort(t){let n={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];!this.sort||this.sort.key!==n?this.sort={key:n,dir:"asc"}:this.sort={key:n,dir:this.sort.dir==="asc"?"desc":"asc"},this.page=1}sortIcon(t){let n={producto:"nombre",existencia:"existencia",cantidad:"cantidadVendida",importe:"importeVendido",costo:"costoTotal",utilidad:"utilidad",margen:"margenPct"}[t];return!this.sort||this.sort.key!==n?"swap_vert":this.sort.dir==="asc"?"arrow_upward":"arrow_downward"}get sortedRows(){if(!this.sort)return this.rows;let{key:t,dir:e}=this.sort;return t==="nombre"?[...this.rows].sort((n,r)=>{let a=(n.nombre||"").localeCompare(r.nombre||"","es",{sensitivity:"base"});return e==="asc"?a:-a}):[...this.rows].sort((n,r)=>{let a=Number(n?.[t]??NaN),o=Number(r?.[t]??NaN),u=Number.isNaN(a),m=Number.isNaN(o);return u&&m?0:u?e==="asc"?1:-1:m||a<o?e==="asc"?-1:1:a>o?e==="asc"?1:-1:(n.nombre||"").localeCompare(r.nombre||"","es",{sensitivity:"base"})})}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.sortedRows.slice(t,t+this.pageSize)}static \u0275fac=function(e){return new(e||i)(te(Mn),te(Zt),te(Zi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas-por-farmacia"]],decls:89,vars:23,consts:[[1,"p-1"],[1,"titulo-container"],[1,"mb-3","titulo"],[1,"row","filtros","align-items-end",3,"ngSubmit"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],["type","text","name","productoQ","placeholder","7501234, ibuprof...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn-rojo-chico",3,"click","disabled"],[1,"fas","fa-times"],["type","text","name","categoriaQ",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"col-md-2","d-flex","gap-2","justify-content-end","align-items-end"],["type","button","matTooltip","Limpiar filtro",1,"btn-rojo",3,"click","disabled"],["type","submit",1,"btn-gris",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"mt-2"],[1,"align-middle","tabla"],[1,"sortable",3,"click"],["inline","",1,"ms-1"],[2,"white-space","nowrap"],[1,"text-end","sortable",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"value"],[1,"text-end"],[1,"text-end",3,"ngClass"],[1,"sem",3,"ngClass"],["colspan","12",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","4",1,"text-end"],["colspan","3",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"h2",2),d(3,"Productos:\xA0 Ventas - Existencia"),s()(),l(4,"form",3),E("ngSubmit",function(){return n.buscar()}),l(5,"div",4)(6,"label",5),d(7,"Farmacia"),s(),l(8,"select",6),Z("ngModelChange",function(a){return J(n.farmaciaId,a)||(n.farmaciaId=a),a}),l(9,"option",7),d(10,"Todas"),s(),N(11,E4,2,2,"option",8),s()(),l(12,"div",4)(13,"label",5),d(14,"Fecha inicial"),s(),l(15,"input",9),Z("ngModelChange",function(a){return J(n.fechaIni,a)||(n.fechaIni=a),a}),s()(),l(16,"div",4)(17,"label",5),d(18,"Fecha final"),s(),l(19,"input",10),Z("ngModelChange",function(a){return J(n.fechaFin,a)||(n.fechaFin=a),a}),s()(),l(20,"div",4)(21,"label",5),d(22,"Producto"),s(),l(23,"div",11)(24,"input",12),Z("ngModelChange",function(a){return J(n.productoQ,a)||(n.productoQ=a),a}),E("keyup.enter",function(){return n.buscar()}),s(),l(25,"button",13),E("click",function(){return n.clearProducto()}),y(26,"i",14),s()()(),l(27,"div",4)(28,"label",5),d(29,"Categ."),s(),l(30,"div",11)(31,"input",15),Z("ngModelChange",function(a){return J(n.categoriaQ,a)||(n.categoriaQ=a),a}),E("keyup.enter",function(){return n.buscar()}),s(),l(32,"button",13),E("click",function(){return n.categoriaQ=""}),y(33,"i",14),s()()(),l(34,"div",16)(35,"button",17),E("click",function(){return n.limpiarFiltros()}),y(36,"i",14),s(),l(37,"button",18),d(38),s()()(),l(39,"div",19)(40,"button",20),E("click",function(){return n.exportarCSV()}),d(41," Exportar CSV "),s()(),l(42,"div",21)(43,"table",22)(44,"thead")(45,"tr")(46,"th"),d(47,"Farmacia"),s(),l(48,"th",23),E("click",function(){return n.setSort("producto")}),d(49," Producto "),l(50,"mat-icon",24),d(51),s()(),l(52,"th",25),d(53,"C\xF3d. barras"),s(),l(54,"th",25),d(55,"Categor\xEDa"),s(),l(56,"th",26),E("click",function(){return n.setSort("cantidad")}),d(57," Vendidos "),l(58,"mat-icon",24),d(59),s()(),l(60,"th",26),E("click",function(){return n.setSort("costo")}),d(61," Costo total "),l(62,"mat-icon",24),d(63),s()(),l(64,"th",26),E("click",function(){return n.setSort("importe")}),d(65," Importe "),l(66,"mat-icon",24),d(67),s()(),l(68,"th",26),E("click",function(){return n.setSort("utilidad")}),d(69," Utilidad "),l(70,"mat-icon",24),d(71),s()(),l(72,"th",26),E("click",function(){return n.setSort("margen")}),d(73," % Gan. "),l(74,"mat-icon",24),d(75),s()(),l(76,"th"),d(77,"Stock M\xEDn."),s(),l(78,"th"),d(79,"Stock M\xE1x."),s(),l(80,"th",26),E("click",function(){return n.setSort("existencia")}),d(81," Existencia "),l(82,"mat-icon",24),d(83),s()()()(),l(84,"tbody"),N(85,T4,34,33,"tr",27)(86,P4,3,0,"tr",28),s(),N(87,k4,22,19,"tfoot",28),s(),N(88,I4,10,7,"div",29),s()()),e&2&&(c(8),Q("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(4),Q("ngModel",n.fechaIni),c(4),Q("ngModel",n.fechaFin),c(5),Q("ngModel",n.productoQ),c(),p("disabled",!n.productoQ),c(6),Q("ngModel",n.categoriaQ),c(),p("disabled",!n.categoriaQ),c(3),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(2),p("disabled",n.cargando||!n.rows.length),c(11),k(n.sortIcon("producto")),c(8),k(n.sortIcon("cantidad")),c(4),k(n.sortIcon("costo")),c(4),k(n.sortIcon("importe")),c(4),k(n.sortIcon("utilidad")),c(4),k(n.sortIcon("margen")),c(8),k(n.sortIcon("existencia")),c(2),p("ngForOf",n.pagedRows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length),c(),p("ngIf",n.totalItems>0))},dependencies:[Ae,si,We,Be,Ct,Nt,rt,Ft,it,nt,Xe,tt,ze,Mt,_t,wr,Bt,Da,Ra,La,Yn,kr,ut],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.compact-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%]{padding:0!important}.compact-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{padding-top:.35rem;padding-bottom:.35rem}.wide-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding:8px 0}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-flex{align-items:center}.compact-field.mb-0[_ngcontent-%COMP%]{margin-bottom:0}.suffix-center[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;padding-right:.35rem}.clear-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;line-height:1}.compact-field[_ngcontent-%COMP%]   .mat-form-field-flex[_ngcontent-%COMP%]{align-items:center}.sem[_ngcontent-%COMP%]{font-weight:600}.sem-green[_ngcontent-%COMP%]{color:#0f9d58}.sem-yellow[_ngcontent-%COMP%]{color:#b8860b}.sem-red[_ngcontent-%COMP%]{color:#dc3545}.sem-muted[_ngcontent-%COMP%]{color:#6c757d}"]})};var Mg=hi(ki());var sd=i=>({"text-danger":i});function M4(i,t){if(i&1&&(l(0,"option",31),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function F4(i,t){if(i&1&&(l(0,"mat-option",32)(1,"div",33)(2,"span"),d(3),s(),l(4,"small",34),d(5),s()()()),i&2){let e=t.$implicit;p("value",e),c(3),k(e.nombre),c(2),k(e.codigoBarras||"\u2014")}}function A4(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),F(3,"date"),s(),l(4,"td"),d(5),s(),l(6,"td"),d(7),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),s(),l(12,"td",27),d(13),s(),l(14,"td",27),d(15),F(16,"currency"),s(),l(17,"td",27),d(18),F(19,"currency"),s(),l(20,"td",35),d(21),F(22,"currency"),s(),l(23,"td",35),d(24),F(25,"number"),s(),l(26,"td"),d(27),s()()),i&2){let e=t.$implicit;c(2),k(Y(3,13,e.fecha,"dd-MM-yyyy")),c(3),k(e.farmaciaNombre),c(2),k(e.usuarioNombre),c(2),k(e.codigoBarras||"\u2014"),c(2),k(e.productoNombre),c(2),k(e.cantidadVendida),c(2),k(oe(16,16,e.importeTotal)),c(3),k(oe(19,18,e.costoTotal)),c(2),p("ngClass",gi(25,sd,(e.utilidad||0)<0)),c(),R(" ",oe(22,20,e.utilidad)," "),c(2),p("ngClass",gi(27,sd,(e.utilidad||0)<0)),c(),R(" ",e.margenRenglonPct==null?"\u2014":Y(25,22,e.margenRenglonPct,"1.0-2")+"%"," "),c(3),k(e.folio)}}function O4(i,t){i&1&&(l(0,"tr")(1,"td",36),d(2,"Sin resultados"),s()())}function D4(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",37)(2,"td",38),d(3,"Totales:"),s(),l(4,"td",27),d(5),s(),l(6,"td",27),d(7),F(8,"currency"),s(),l(9,"td",27),d(10),F(11,"currency"),s(),l(12,"td",35),d(13),F(14,"currency"),s(),l(15,"td",27),d(16),F(17,"number"),s(),y(18,"td"),s()()),i&2){let e=_();c(5),k(e.totalCantidad),c(2),k(oe(8,6,e.totalImporte)),c(3),k(oe(11,8,e.totalCosto)),c(2),p("ngClass",gi(15,sd,e.totalUtilidad<0)),c(),R(" ",oe(14,10,e.totalUtilidad)," "),c(3),R(" ",e.totalMargenPct==null?"\u2014":Y(17,12,e.totalMargenPct,"1.0-2")+"%"," ")}}function R4(i,t){if(i&1){let e=ie();l(0,"div",39)(1,"button",40),E("click",function(){T(e);let r=_();return P(r.goFirst())}),y(2,"i",41),s(),l(3,"button",42),E("click",function(){T(e);let r=_();return P(r.goPrev())}),y(4,"i",43),s(),d(5),l(6,"button",44),E("click",function(){T(e);let r=_();return P(r.goNext())}),y(7,"i",45),s(),l(8,"button",46),E("click",function(){T(e);let r=_();return P(r.goLast())}),y(9,"i",47),s()()}if(i&2){let e=_();c(),p("disabled",e.page===1),c(2),p("disabled",e.page===1),c(2),Cn(" P\xE1gina ",e.page," de ",e.totalPages," \u2014 ",e.totalItems," registros "),c(),p("disabled",e.page===e.totalPages),c(2),p("disabled",e.page===e.totalPages)}}var lc=class i{constructor(t,e,n){this.farmaciaService=t;this.reportes=e;this.productosSrv=n}farmacias=[];farmaciaId="";fechaIni=this.defaultIni();fechaFin=this.defaultFin();productoQuery="";productCtrl=new js("");opcionesProductos=[];productoId=null;codigoBarras="";nombre="";query$=new yt;cargando=!1;rows=[];totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;totalMargenPct=null;page=1;pageSize=15;totalItems=0;get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.pageSize))}get pagedRows(){let t=(this.page-1)*this.pageSize;return this.rows.slice(t,t+this.pageSize)}resetPagination(){this.totalItems=this.rows.length,this.page=1}goFirst(){this.page=1}goPrev(){this.page>1&&this.page--}goNext(){this.page<this.totalPages&&this.page++}goLast(){this.page=this.totalPages}ngOnInit(){this.farmaciaService.obtenerFarmacias().subscribe({next:t=>this.farmacias=t??[],error:()=>this.farmacias=[]}),this.query$.pipe(dn(250),un(),Ui(t=>{let e=(t||"").trim();return e.length<2?(this.opcionesProductos=[],lt([])):this.productosSrv.buscar(e)})).subscribe({next:t=>{this.opcionesProductos=Array.isArray(t)?t:[]},error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}}),this.productCtrl.valueChanges.pipe(dn(250),un(),Ui(t=>{let n=((typeof t=="string"?t:t?.nombre??t?.codigoBarras??"")||"").trim();return n.length<2?(this.opcionesProductos=[],lt([])):this.productosSrv.buscar(n)})).subscribe({next:t=>this.opcionesProductos=t||[],error:t=>{console.error("Error /productos/search:",t),this.opcionesProductos=[]}})}onQueryChange(t){this.query$.next(t),this.productoId=null,this.codigoBarras="",this.nombre=""}displayProducto=t=>typeof t=="string"?t:t?`${t.codigoBarras?t.codigoBarras+" \u2014 ":""}${t.nombre}`:"";onProductoChange(t){this.seleccionarDesdeInput(t)}onProductoBlur(t){this.productoId||this.seleccionarDesdeInput(t)}seleccionarDesdeInput(t){let e=(t||"").trim();if(!e)return;let n=this.opcionesProductos.find(u=>u.codigoBarras&&u.codigoBarras===e),r=this.opcionesProductos.find(u=>u.nombre.toLowerCase()===e.toLowerCase()),a=this.opcionesProductos.find(u=>(u.codigoBarras?`${u.codigoBarras} \u2014 `:"")+u.nombre===e),o=n||r||a;o&&(this.productoId=o._id,this.codigoBarras=o.codigoBarras||"",this.nombre=o.nombre,this.productoQuery=(o.codigoBarras?`${o.codigoBarras} \u2014 `:"")+o.nombre)}buscar(){let t=this.productCtrl.value;if(!this.productoId&&typeof t=="string"&&t.trim()){let n=t.trim();/^\d{5,}$/.test(n)?(this.codigoBarras=n,this.nombre=""):(this.nombre=n,this.codigoBarras="")}if(!this.productoId&&!this.codigoBarras&&!this.nombre){Mg.default.fire({icon:"warning",title:"Aviso",text:"Selecciona un producto o escribe c\xF3digo/nombre.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let e=n=>n?new Date(n).toISOString().slice(0,10):void 0;this.cargando=!0,this.reportes.getVentasProductoDetalle({farmaciaId:this.farmaciaId||void 0,productoId:this.productoId||void 0,codigoBarras:this.productoId?void 0:this.codigoBarras||void 0,nombre:this.productoId?void 0:this.nombre||void 0,fechaIni:e(this.fechaIni),fechaFin:e(this.fechaFin)}).subscribe({next:n=>{let r=o=>{let u=Number(o);return Number.isFinite(u)?u:0};this.rows=n?.items||[];let a=this.rows.reduce((o,u)=>(o.cant+=r(u.cantidadVendida),o.imp+=r(u.importeTotal),o.cost+=r(u.costoTotal),o.util+=r(u.utilidad),o),{cant:0,imp:0,cost:0,util:0});this.totalCantidad=a.cant,this.totalImporte=a.imp,this.totalCosto=a.cost,this.totalUtilidad=a.util,this.totalMargenPct=this.totalImporte>0?this.totalUtilidad/this.totalImporte*100:null,this.resetPagination(),this.cargando=!1},error:n=>{console.error("Error reporte ventas producto:",n),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.cargando=!1}})}limpiar(){this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null,this.totalItems=0,this.page=1,this.farmaciaId="",this.limpiarProducto(),this.fechaIni=this.defaultIni(),this.fechaFin=this.defaultFin(),this.rows=[],this.totalCantidad=0,this.totalImporte=0,this.totalCosto=0,this.totalUtilidad=0,this.totalMargenPct=null}exportarCSV(){if(!this.rows.length)return;let t=[{key:"fecha",label:"Fecha",map:r=>r.fecha?r.fecha.substring(0,10):""},{key:"farmaciaNombre",label:"Farmacia"},{key:"usuarioNombre",label:"Usuario"},{key:"codigoBarras",label:"C\xF3digo"},{key:"productoNombre",label:"Producto"},{key:"cantidadVendida",label:"Cantidad"},{key:"importeTotal",label:"Importe",map:r=>Number(r.importeTotal??0).toFixed(2)},{key:"costoTotal",label:"Costo",map:r=>Number(r.costoTotal??0).toFixed(2)},{key:"utilidad",label:"Utilidad",map:r=>Number(r.utilidad??0).toFixed(2)},{key:"margenRenglonPct",label:"Margen % (ren)",map:r=>r.margenRenglonPct==null?"":Number(r.margenRenglonPct).toFixed(2)},{key:"folio",label:"Folio venta"}],e=Bf(this.rows,t,{separator:",",bom:!0}),n=`ventas_producto_${this.codigoBarras||this.nombre||"producto"}_${this.fechaIni}_a_${this.fechaFin}.csv`;Lf(n,e)}defaultIni(){return this.toLocalISO(new Date)}defaultFin(){return this.toLocalISO(new Date)}toLocalISO(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}onOptionSelected(t){t&&(this.productoId=t._id,this.codigoBarras=t.codigoBarras||"",this.nombre=t.nombre,this.productCtrl.setValue(t))}limpiarProducto(){this.productCtrl.setValue(""),this.opcionesProductos=[],this.productoId=null,this.codigoBarras="",this.nombre=""}static \u0275fac=function(e){return new(e||i)(te(Zt),te(Mn),te(Zi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas-producto"]],decls:69,vars:16,consts:[["auto","matAutocomplete"],[1,"titulo-container","mb-2"],[1,"titulo"],[1,"row","align-items-end",3,"ngSubmit"],[1,"row","filtros"],[1,"col-md-2"],[1,"form-label"],["name","farmaciaId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"form-label","d-block"],["appearance","outline",1,"compact-field","wide-field"],["matInput","","placeholder","Escribe c\xF3digo de barras o nombre",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["type","date","name","fechaIni",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-1","d-flex",2,"margin-top","-10px"],["type","button","matTooltip","Borrar filtro",1,"btn-rojo","compact-btn",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-md-1","d-flex","text-end",2,"margin-top","-10px"],["type","submit",1,"btn-gris","compact-btn",3,"disabled"],[1,"col-12","mt-2"],["type","button",1,"btn-verde",3,"click","disabled"],[1,"table-responsive","mt-3"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","paginacion",4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"d-flex","justify-content-between","w-100"],[1,"text-muted","ms-2"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"fw-bold"],["colspan","5",1,"text-end"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){if(e&1){let r=ie();l(0,"div")(1,"div",1)(2,"h2",2),d(3,"Ventas por producto"),s()(),l(4,"form",3),E("ngSubmit",function(){return T(r),P(n.buscar())}),l(5,"div",4)(6,"div",5)(7,"label",6),d(8,"Farmacia"),s(),l(9,"select",7),Z("ngModelChange",function(o){return T(r),J(n.farmaciaId,o)||(n.farmaciaId=o),P(o)}),l(10,"option",8),d(11,"Todas"),s(),N(12,M4,2,2,"option",9),s()(),l(13,"div",10)(14,"label",11),d(15,"Producto"),s(),l(16,"mat-form-field",12),y(17,"input",13),l(18,"mat-autocomplete",14,0),E("optionSelected",function(o){return T(r),P(n.onOptionSelected(o.option.value))}),N(20,F4,6,3,"mat-option",15),s()()(),l(21,"div",5)(22,"label",6),d(23,"Fecha inicial"),s(),l(24,"input",16),Z("ngModelChange",function(o){return T(r),J(n.fechaIni,o)||(n.fechaIni=o),P(o)}),s()(),l(25,"div",5)(26,"label",6),d(27,"Fecha final"),s(),l(28,"input",17),Z("ngModelChange",function(o){return T(r),J(n.fechaFin,o)||(n.fechaFin=o),P(o)}),s()(),l(29,"div",18)(30,"button",19),E("click",function(){return T(r),P(n.limpiar())}),y(31,"i",20),s()(),l(32,"div",21)(33,"button",22),d(34),s()()(),l(35,"div",23)(36,"button",24),E("click",function(){return T(r),P(n.exportarCSV())}),d(37," Exportar CSV "),s()()(),l(38,"div",25)(39,"table",26)(40,"thead")(41,"tr")(42,"th"),d(43,"Fecha"),s(),l(44,"th"),d(45,"Farmacia"),s(),l(46,"th"),d(47,"Usuario"),s(),l(48,"th"),d(49,"C\xF3d. barras"),s(),l(50,"th"),d(51,"Producto"),s(),l(52,"th",27),d(53,"Cantidad"),s(),l(54,"th",27),d(55,"Importe"),s(),l(56,"th",27),d(57,"Costo"),s(),l(58,"th",27),d(59,"Utilidad"),s(),l(60,"th",27),d(61,"% Gan."),s(),l(62,"th"),d(63,"Folio venta"),s()()(),l(64,"tbody"),N(65,A4,28,29,"tr",28)(66,O4,3,0,"tr",29),s(),N(67,D4,19,17,"tfoot",29),s(),N(68,R4,10,7,"div",30),s()()}if(e&2){let r=$t(19);c(9),Q("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(5),p("formControl",n.productCtrl)("matAutocomplete",r),c(),p("displayWith",n.displayProducto),c(2),p("ngForOf",n.opcionesProductos),c(4),Q("ngModel",n.fechaIni),c(4),Q("ngModel",n.fechaFin),c(2),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(2),p("disabled",n.cargando||!n.rows.length),c(29),p("ngForOf",n.pagedRows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length),c(),p("ngIf",n.totalItems>0)}},dependencies:[Ae,si,We,Be,Ct,Nt,Rt,rt,Ft,it,nt,Xe,tt,ze,Mt,_t,wr,Bt,Ws,Da,Js,Ra,Zs,La,cl,Aa,Qr,Yn,ut],styles:[".wide-field[_ngcontent-%COMP%]{width:360px}[_nghost-%COMP%]     .compact-field .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px;min-height:40px}[_nghost-%COMP%]     .compact-field .mdc-text-field--outlined{height:40px}[_nghost-%COMP%]     .compact-field .mat-mdc-input-element{line-height:26px}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.compact-btn[_ngcontent-%COMP%]{height:40px;padding-top:6px;padding-bottom:6px;min-height:40px;line-height:26px;margin-top:2rem}"]})};var so=hi(ki());var N4=["contenedorTicket"];function B4(i,t){if(i&1&&(l(0,"option",8),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),R(" ",e.nombre," ")}}function L4(i,t){if(i&1){let e=ie();l(0,"button",33),E("click",function(){T(e);let r=_();return P(r.limpiarFechaPedido())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function V4(i,t){if(i&1){let e=ie();l(0,"button",33),E("click",function(){T(e);let r=_();return P(r.limpiarFechaFin())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function U4(i,t){if(i&1){let e=ie();l(0,"button",33),E("click",function(){T(e);let r=_();return P(r.limpiarDescripcion())}),y(1,"fa-icon",34),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function j4(i,t){if(i&1&&(l(0,"option",8),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e),c(),R(" ",e," ")}}function W4(i,t){if(i&1){let e=ie();l(0,"div",35)(1,"button",36),E("click",function(){T(e);let r=_();return P(r.buscarSinFolio())}),d(2,"Buscar"),s()()}}function H4(i,t){if(i&1){let e=ie();l(0,"div",37)(1,"h2",38),d(2,"Pedidos"),s(),l(3,"button",39),E("click",function(){T(e);let r=_();return P(r.limpiarFiltroCompleto())}),y(4,"i",40),s()()}}function z4(i,t){if(i&1&&(l(0,"small",65),d(1),s()),i&2){let e=_().$implicit;c(),R(" Tel.: ",e.cliente==null?null:e.cliente.telefono," ")}}function $4(i,t){if(i&1){let e=ie();at(0),l(1,"input",66),Z("ngModelChange",function(r){T(e);let a=_(3);return J(a.costoEditado,r)||(a.costoEditado=r),P(r)}),s(),ot()}if(i&2){let e=_(3);c(),Q("ngModel",e.costoEditado)}}function G4(i,t){if(i&1&&(d(0),F(1,"currency")),i&2){let e=_().$implicit;R(" ",oe(1,1,e.costo)," ")}}function q4(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Levant\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k(e.usuarioPidio.nombre||"\u2014"),c(2),R(" ",e.fechaPedido?Ni(7,2,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function X4(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Surti\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k((e.usuarioSurtio==null?null:e.usuarioSurtio.nombre)||"\u2014"),c(2),R(" ",e.fechaEntrega?Ni(7,2,e.fechaEntrega,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function K4(i,t){if(i&1&&(l(0,"tr")(1,"td",71),d(2,"Cancel\xF3:"),s(),l(3,"td",70),d(4),s(),l(5,"td",71),d(6),F(7,"date"),s()()),i&2){let e=_(2).$implicit;c(4),k((e.usuarioCancelo==null?null:e.usuarioCancelo.nombre)||"\u2014"),c(2),R(" ",e.fechaCancelacion?Ni(7,2,e.fechaCancelacion,"dd/MM/yyyy","America/Mexico_City"):"\u2014"," ")}}function Y4(i,t){if(i&1&&(l(0,"tr")(1,"td",67)(2,"div",68)(3,"table",69)(4,"thead")(5,"tr")(6,"th",70),d(7),s(),l(8,"th",71),d(9),F(10,"currency"),s(),l(11,"th",71),d(12),F(13,"currency"),s()()(),l(14,"tbody")(15,"tr")(16,"td",72),d(17),F(18,"currency"),s(),l(19,"td",72),d(20),F(21,"currency"),s()(),l(22,"tr")(23,"td"),d(24,"Efectivo:"),s(),l(25,"td"),d(26),F(27,"currency"),s(),l(28,"td"),d(29,"Efectivo:"),s(),l(30,"td"),d(31),F(32,"currency"),s()(),l(33,"tr")(34,"td"),d(35,"Tarjeta:"),s(),l(36,"td"),d(37),F(38,"currency"),s(),l(39,"td"),d(40,"Tarjeta:"),s(),l(41,"td"),d(42),F(43,"currency"),s()(),l(44,"tr")(45,"td"),d(46,"Transferencia:"),s(),l(47,"td"),d(48),F(49,"currency"),s(),l(50,"td"),d(51,"Transferencia:"),s(),l(52,"td"),d(53),F(54,"currency"),s()(),l(55,"tr")(56,"td"),d(57,"Monedero:"),s(),l(58,"td"),d(59),F(60,"currency"),s(),l(61,"td"),d(62,"Monedero"),s(),l(63,"td"),d(64),F(65,"currency"),s()(),N(66,q4,8,6,"tr",64)(67,X4,8,6,"tr",64)(68,K4,8,6,"tr",64),s()()()()()),i&2){let e=_().$implicit,n=_(2);c(7),R("Estado: ",e.estado,""),c(2),R("Costo: ",oe(10,16,e.costo||0),""),c(3),R("Precio: ",oe(13,18,e.total||0),""),c(5),R("Anticipo: ",oe(18,20,e.aCuenta)," "),c(3),R("Resta: ",oe(21,22,e.resta),""),c(6),k(oe(27,24,e.pagoACuenta.efectivo||0)),c(5),k(oe(32,26,e.pagoResta.efectivo||0)),c(6),k(oe(38,28,e.pagoACuenta.tarjeta||0)),c(5),k(oe(43,30,e.pagoResta.tarjeta||0)),c(6),k(oe(49,32,e.pagoACuenta.transferencia||0)),c(5),k(oe(54,34,e.pagoResta.transferencia||0)),c(6),k(oe(60,36,e.pagoACuenta.vale||0)),c(5),k(oe(65,38,e.pagoResta.vale||0)),c(2),p("ngIf",n.esAdmin),c(),p("ngIf",e.estado==="entregado"&&n.esAdmin),c(),p("ngIf",e.estado==="cancelado"&&n.esAdmin)}}function Q4(i,t){if(i&1){let e=ie();at(0),l(1,"tr")(2,"td")(3,"button",55),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.pedidoDetalleAbiertoId===r._id?a.cerrarDetallePedido(r):a.abrirDetallePedido(r))}),y(4,"fa-icon",56),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),F(9,"date"),s(),l(10,"td")(11,"div"),d(12),s(),N(13,z4,2,1,"small",57),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),s(),l(18,"td"),N(19,$4,2,1,"ng-container",58)(20,G4,2,3,"ng-template",null,0,Ea),s(),l(22,"td"),d(23),F(24,"currency"),s(),l(25,"td"),d(26),F(27,"currency"),s(),l(28,"td"),d(29),F(30,"currency"),s(),l(31,"td"),d(32),F(33,"currency"),s(),l(34,"td"),d(35),F(36,"currency"),s(),l(37,"td"),d(38),F(39,"number"),s(),l(40,"td",59)(41,"div",60)(42,"button",61),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.habilitarEdicion(r))}),y(43,"fa-icon",34),s(),l(44,"button",62),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.guardarFila(r))}),y(45,"fa-icon",34),s(),l(46,"button",63),E("click",function(){T(e);let r=_(2);return P(r.cancelarEdicion())}),y(47,"fa-icon",34),s()()()(),N(48,Y4,69,40,"tr",64),ot()}if(i&2){let e=t.$implicit,n=$t(21),r=_(2);c(3),p("matTooltip",r.pedidoDetalleAbiertoId===e._id?"Cerrar detalle":"Ver detalle"),c(),p("icon",r.pedidoDetalleAbiertoId===e._id?"minus":"plus")("ngClass",r.pedidoDetalleAbiertoId===e._id?"icono-rotado":"icono-normal"),c(2),k(e.folio),c(2),k(Ni(9,24,e.fechaPedido,"dd/MM/yyyy","America/Mexico_City")),c(4),k((e.cliente==null?null:e.cliente.nombre)||"sin cliente"),c(),p("ngIf",e.cliente==null?null:e.cliente.telefono),c(2),k(e.descripcion),c(2),k(e.estado),c(2),p("ngIf",r.modoEdicionId===e._id)("ngIfElse",n),c(4),k(oe(24,28,e.total)),c(3),k(oe(27,30,e.aCuenta)),c(3),k(oe(30,32,e.resta)),c(3),k(oe(33,34,(e.total||0)-(e.resta||0))),c(3),k(oe(36,36,(e.total||0)-(e.resta||0)-(e.costo||0))),c(3),R(" ",Y(39,38,e.costo>0?((e.total||0)-(e.resta||0)-(e.costo||0))/e.costo*100:0,"1.1-2"),"% "),c(4),p("disabled",r.modoEdicionId===e._id),c(),p("icon",r.faEdit),c(),p("disabled",r.modoEdicionId!==e._id),c(),p("icon",r.faSave),c(),p("disabled",r.modoEdicionId!==e._id),c(),p("icon",r.faTimes),c(),p("ngIf",r.pedidoDetalleAbiertoId===e._id)}}function J4(i,t){if(i&1){let e=ie();l(0,"table",41)(1,"thead")(2,"tr"),y(3,"th"),l(4,"th"),d(5,"Folio"),s(),l(6,"th",42),E("click",function(){T(e);let r=_();return P(r.ordenarPor("fechaPedido"))}),d(7," F. pedido "),y(8,"fa-icon",43),s(),l(9,"th",44),E("click",function(){T(e);let r=_();return P(r.ordenarPor("cliente.nombre"))}),d(10," Cliente "),y(11,"fa-icon",43),s(),l(12,"th",45),E("click",function(){T(e);let r=_();return P(r.ordenarPor("descripcion"))}),d(13," Descripci\xF3n "),y(14,"fa-icon",46),s(),l(15,"th",47),E("click",function(){T(e);let r=_();return P(r.ordenarPor("estado"))}),d(16," Estado "),y(17,"fa-icon",46),s(),l(18,"th",48),E("click",function(){T(e);let r=_();return P(r.ordenarPor("costo"))}),d(19," Costo "),y(20,"fa-icon",46),s(),l(21,"th",49),E("click",function(){T(e);let r=_();return P(r.ordenarPor("total"))}),d(22," Precio "),y(23,"fa-icon",46),s(),l(24,"th",50),E("click",function(){T(e);let r=_();return P(r.ordenarPor("aCuenta"))}),d(25," A cuenta "),y(26,"fa-icon",46),s(),l(27,"th",51),E("click",function(){T(e);let r=_();return P(r.ordenarPor("resta"))}),d(28," Resta "),y(29,"fa-icon",46),s(),l(30,"th"),d(31,"Tot. Ingreso"),s(),l(32,"th"),d(33,"Utilidad"),s(),l(34,"th"),d(35,"% Gan"),s(),l(36,"th"),d(37,"Acciones"),s()()(),l(38,"tbody"),N(39,Q4,49,41,"ng-container",52),s(),l(40,"tfoot")(41,"tr")(42,"td",53),d(43,"Totales:"),s(),l(44,"td",54),d(45),F(46,"currency"),s(),l(47,"td",54),d(48),F(49,"currency"),s(),l(50,"td",54),d(51),F(52,"currency"),s(),l(53,"td",54),d(54),F(55,"currency"),s(),l(56,"td",54),d(57),F(58,"currency"),s(),l(59,"td",54),d(60),F(61,"currency"),s(),l(62,"td",54),d(63),F(64,"number"),s(),y(65,"td"),s()()()}if(i&2){let e=_();c(6),Je("aria-sort",e.ariaSortFor("fechaPedido")),c(2),p("icon",e.sortBy==="fechaPedido"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("cliente.nombre")),c(2),p("icon",e.sortBy==="cliente.nombre"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("descripcion")),c(2),p("icon",e.sortBy==="descripcion"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("estado")),c(2),p("icon",e.sortBy==="estado"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("costo")),c(2),p("icon",e.sortBy==="costo"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("total")),c(2),p("icon",e.sortBy==="total"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("aCuenta")),c(2),p("icon",e.sortBy==="aCuenta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(),Je("aria-sort",e.ariaSortFor("resta")),c(2),p("icon",e.sortBy==="resta"?e.sortDir==="asc"?e.faSortUp:e.faSortDown:e.faSort),c(10),p("ngForOf",e.pedidos),c(6),k(oe(46,24,e.totalCosto)),c(3),k(oe(49,26,e.totalPrecio)),c(3),k(oe(52,28,e.totalAcuenta)),c(3),k(oe(55,30,e.totalResta)),c(3),k(oe(58,32,e.totalIngreso)),c(3),k(oe(61,34,e.utilidadTotal)),c(3),R("",Y(64,36,e.porcentajeUtilidad,"1.1-2"),"%")}}function Z4(i,t){if(i&1){let e=ie();l(0,"div",73)(1,"button",74),E("click",function(){T(e);let r=_();return P(r.cambiarPagina(1))}),y(2,"i",75),s(),l(3,"button",76),E("click",function(){T(e);let r=_();return P(r.cambiarPagina(r.paginacion.page-1))}),y(4,"i",77),s(),l(5,"span"),d(6),s(),l(7,"button",78),E("click",function(){T(e);let r=_();return P(r.cambiarPagina(r.paginacion.page+1))}),y(8,"i",79),s(),l(9,"button",80),E("click",function(){T(e);let r=_();return P(r.cambiarPagina(r.paginacion.pages))}),y(10,"i",81),s(),l(11,"span",82),d(12,"Filas p\xE1g.:"),s(),l(13,"select",83),Z("ngModelChange",function(r){T(e);let a=_();return J(a.limit,r)||(a.limit=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return r.page=1,P(r.buscarSinFolio())}),l(14,"option",8),d(15,"10"),s(),l(16,"option",8),d(17,"20"),s(),l(18,"option",8),d(19,"50"),s(),l(20,"option",8),d(21,"100"),s()()()}if(i&2){let e=_();c(),p("disabled",e.paginacion.page<=1),c(2),p("disabled",!e.paginacion.hasPrev),c(3),Cn(" P\xE1gina ",e.paginacion.page," de ",e.paginacion.pages," (",e.paginacion.total," registros) "),c(),p("disabled",!e.paginacion.hasNext),c(2),p("disabled",e.paginacion.page>=e.paginacion.pages),c(4),Q("ngModel",e.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100)}}function ek(i,t){i&1&&(l(0,"p",84),d(1," El folio del pedido no existe \xF3 ya no est\xE1 pendiente de entrega. "),s())}function Ag(){return{conteo:0,total:0,aCuenta:0,resta:0,saldo:0,efectivo:0,tarjeta:0,transferencia:0,vale:0,efectivoResta:0,tarjetaResta:0,transferenciaResta:0,valeResta:0,costo:0}}function Fg(){return{generales:Ag(),porEstado:[]}}var cc=class i{constructor(t,e,n,r,a,o,u){this.library=t;this.pedidosService=e;this.authService=n;this.clienteService=r;this.farmaciaService=a;this.cdr=o;this.ngZone=u;this.library.addIcons(Sn,Fa,Ma,_i)}contenedorTicket;filtroFarmaciaId;filtroFolio="";filtroDescripcion="";filtroFechaPedido="";filtroFechaFin="";filtroEstado;estadosPedido=["inicial","entregado","cancelado"];esAdmin=!1;pedidoDetalleAbiertoId=null;nombreCliente="";idCliente="";totalMonedero=0;farmacias=[];farmaciaNombre="";farmaciaTelefono="";farmaciaDireccion="";usuarioId="";usuarioRol="";usuarioNombre="";pedidoEditandoId=null;costoTemporal=0;modoEdicionId=null;costoEditado=null;faSpinner=ff;faCheck=gf;faSave=nf;faEdit=$s;faTimes=_i;filtroClienteNombre="";incluirClienteNull=!1;faSort=Ym;faSortUp=rf;faSortDown=Wm;page=1;limit=20;sortBy="fechaPedido";sortDir="desc";ariaSortFor(t){return this.sortBy===t?this.sortDir==="asc"?"ascending":"descending":"none"}paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1};resumen=Fg();pedidos=[];totalIngreso=0;utilidadTotal=0;porcentajeUtilidad=0;totalCosto=0;totalPrecio=0;totalAcuenta=0;totalResta=0;cambiarPagina(t){this.paginacion.pages&&(t<1||t>this.paginacion.pages||(this.page=t,this.buscarSinFolio()))}ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59);this.filtroFechaPedido=this.toYmd(e),this.filtroFechaFin=this.toYmd(n),this.farmaciaService.obtenerFarmacias().subscribe(a=>{this.farmacias=a||[],this.farmacias.length&&(this.filtroFarmaciaId=this.farmacias[0]._id??this.farmacias[0].id??""),this.buscarSinFolio()});let r=this.authService.getUserData();this.usuarioId=r?.id,this.usuarioRol=r?.rol,this.usuarioNombre=r?.nombre}toYmd(t){let e=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}formatearFecha(t){let e=new Date(t),n=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${n}/${r}/${a}`}get mostrarBotonBuscar(){return!!this.filtroFarmaciaId}ordenarPor(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.page=1,this.buscarSinFolio()}buscarSinFolio(){return Le(this,null,function*(){if(!this.filtroFarmaciaId){so.default.fire({icon:"warning",title:"Aviso",text:"Debes de seleccionar una farmacia.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1});return}let t=b=>b?new Date(b).toISOString().slice(0,10):void 0,e=this.filtroFarmaciaId,n=t(this.filtroFechaPedido),r=t(this.filtroFechaFin),a=(this.filtroDescripcion||"").trim()||void 0,o=this.filtroEstado||void 0,u=(this.filtroClienteNombre||"").trim()||void 0,m=!!this.incluirClienteNull,f=this.page||1,h=this.limit||20,g=this.sortBy||"fechaPedido",v=this.sortDir||"desc";this.pedidosService.obtenerPedidos({farmaciaId:e,fechaIni:n,fechaFin:r,folio:void 0,estado:o,descripcion:a,descripcionMinima:!1,page:f,limit:h,sortBy:g,sortDir:v,clienteNombre:u,clienteNull:m}).subscribe({next:b=>{if(console.log("Pedidos",b),!b?.pedidos||b.pedidos.length===0){so.default.fire({icon:"info",title:"Sin resultados",text:"No existen pedidos con esas caracter\xEDsticas.",timer:1500,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1}),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0,this.totalCosto=0,this.totalPrecio=0,this.totalAcuenta=0,this.totalResta=0;return}this.pedidos=b.pedidos,this.paginacion=b.paginacion,this.resumen=b.resumen;let w=b?.resumen?.generales??Ag(),x=C=>Number.isFinite(Number(C))?Number(C):0;console.log("globales",w),this.totalCosto=w?x(w.costo):0,this.totalPrecio=w?x(w.total):0,this.totalAcuenta=w?x(w.aCuenta):0,this.totalResta=w?x(w.resta):0,this.totalIngreso=(Number(w.total)||0)-(Number(w.resta)||0),this.utilidadTotal=(Number(w.total)||0)-(Number(w.resta)||0)-(Number(w.costo)||0),this.porcentajeUtilidad=this.totalCosto>0?this.utilidadTotal/this.totalCosto*100:0},error:b=>{console.error("Error al buscar sin folio:",b),so.default.fire("Error","Ocurri\xF3 un error al buscar pedidos.","error"),this.pedidos=[],this.paginacion={page:0,limit:0,total:0,pages:0,hasPrev:!1,hasNext:!1},this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.filtroFolio="",this.totalIngreso=0,this.utilidadTotal=0,this.porcentajeUtilidad=0}})})}limpiarDescripcion(){return Le(this,null,function*(){this.filtroDescripcion="",this.buscarSinFolio()})}limpiarFechaPedido(){return Le(this,null,function*(){this.filtroFechaPedido="",this.buscarSinFolio()})}limpiarFechaFin(){return Le(this,null,function*(){this.filtroFechaFin="",this.buscarSinFolio()})}limpiarFiltroCompleto(){return Le(this,null,function*(){this.filtroFolio="",this.filtroFechaPedido="",this.filtroFechaFin="",this.filtroDescripcion="",this.filtroEstado="",this.pedidos=[],this.resumen=Fg()})}abrirDetallePedido(t){this.pedidoDetalleAbiertoId=t._id}cerrarDetallePedido(t){this.pedidoDetalleAbiertoId=null}habilitarEdicion(t){this.modoEdicionId=t._id,this.costoEditado=t.costo}cancelarEdicion(){this.modoEdicionId=null,this.costoEditado=null}guardarFila(t){this.costoEditado!==null&&this.pedidosService.actualizarCostoPedido(t._id,this.costoEditado).subscribe({next:e=>{t.costo=e.pedido.costo,this.buscarSinFolio(),so.default.fire({icon:"success",title:"Actualizado",text:"El costo fue actualizado correctamente.",timer:1600,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1})},error:e=>{console.error("Error al actualizar costo:",e),so.default.fire("Error","No se pudo actualizar el costo.","error")},complete:()=>{this.modoEdicionId=null,this.costoEditado=null}})}static \u0275fac=function(e){return new(e||i)(te(bi),te(Wa),te(qt),te(wn),te(Zt),te(Wt),te(Yi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-pedidos"]],viewQuery:function(e,n){if(e&1&&Ot(N4,5),e&2){let r;St(r=wt())&&(n.contenedorTicket=r.first)}},decls:53,vars:19,consts:[["mostrarCosto",""],[1,"pedidos-container"],[1,"titulo-container"],[1,"titulo"],[1,"row","g-2","align-items-center","mb-3"],[1,"col-auto"],["for","filtroFarmaciaId",1,"form-label","mb-0","lbl-pedido"],["id","filtroFarmaciaId",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-auto",2,"margin-left","3rem"],["for","filtroClienteNombre",1,"form-label","mb-0","lbl-pedido"],["id","filtroClienteNombre","type","text","placeholder","Nombre del cliente",1,"form-control",2,"width","220px",3,"ngModelChange","ngModel"],[1,"col-auto","form-check",2,"margin-left","3rem"],["type","checkbox","id","incluirClienteNull",1,"form-check-input",3,"ngModelChange","ngModel"],["for","incluirClienteNull",1,"form-check-label"],[1,"row","mb-2","filtros-container"],[1,"col-md-2"],["for","filtroFechaPedido",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"position-relative"],["type","date",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["for","filtroFechaFin",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],[1,"col-md-3"],["for","filtroDescripcion",1,"lbl-pedido","me-2","mb-0",2,"white-space","nowrap"],["type","text","placeholder","Descripci\xF3n...",1,"form-control","pe-5",3,"ngModelChange","ngModel"],["for","filtroEstado",1,"lbl-pedido"],["id","filtroEstado",1,"form-select",2,"width","150px",3,"ngModelChange","ngModel"],["class","col-md-1","style","margin-top: 1rem;",4,"ngIf"],["class","d-flex justify-content-between align-items-center w-100 mb-2",4,"ngIf"],["class","tabla",4,"ngIf"],["class","paginacion",4,"ngIf"],["class","no-found-error",4,"ngIf"],["type","button",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],[1,"col-md-1",2,"margin-top","1rem"],[1,"btn-gris",3,"click"],[1,"d-flex","justify-content-between","align-items-center","w-100","mb-2"],[1,"subtitulo","mb-0"],["matTooltip","Cierra la tabla",1,"btn-amarillo-chico","btn-icon-chico",3,"click"],[1,"fas","fa-times"],[1,"tabla"],["role","button","matTooltip","Ordenar por fecha de pedido",1,"sortable",3,"click"],["aria-hidden","true",1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por cliente",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por descripci\xF3n",1,"sortable",3,"click"],[1,"sort-icon",3,"icon"],["role","button","matTooltip","Ordenar por estado",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por costo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por precio",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por anticipo",1,"sortable",3,"click"],["role","button","matTooltip","Ordenar por resto",1,"sortable",3,"click"],[4,"ngFor","ngForOf"],["colspan","6",1,"text-end","fw-bold"],[1,"fw-bold"],[1,"btn-verde","btn-icono",3,"click","matTooltip"],[3,"icon","ngClass"],["class","text-muted",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"d-flex","gap-1","align-items-center"],[1,"d-flex","justify-content-center"],["matTooltip","Editar costo",1,"btn-icon-chico","btn-gris-chico",3,"click","disabled"],["matTooltip","Guardar costo",1,"btn-icon-chico","btn-verde-chico",3,"click","disabled"],["matTooltip","Cancelar",1,"btn-icon-chico","btn-rojo-chico",3,"click","disabled"],[4,"ngIf"],[1,"text-muted"],["type","number",1,"form-control","form-control-sm",2,"width","80px",3,"ngModelChange","ngModel"],["colspan","100"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],["colspan","2"],["colspan","1"],["colspan","2",1,"sub-title-tabla"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"ms-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"ngModelChange","ngModel"],[1,"no-found-error"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"div",2)(2,"h1",3),d(3,"Reporte de Pedidos"),s()(),l(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Farmacia:"),s()(),l(8,"div",5)(9,"select",7),Z("ngModelChange",function(a){return J(n.filtroFarmaciaId,a)||(n.filtroFarmaciaId=a),a}),l(10,"option",8),d(11,"-- Selecciona --"),s(),N(12,B4,2,2,"option",9),s()(),l(13,"div",10)(14,"label",11),d(15,"Cliente:"),s()(),l(16,"div",5)(17,"input",12),Z("ngModelChange",function(a){return J(n.filtroClienteNombre,a)||(n.filtroClienteNombre=a),a}),s()(),l(18,"div",13)(19,"input",14),Z("ngModelChange",function(a){return J(n.incluirClienteNull,a)||(n.incluirClienteNull=a),a}),s(),l(20,"label",15),d(21," Incluir \u201Csin cliente\u201D "),s()()(),l(22,"div",16)(23,"div",17)(24,"label",18),d(25,"Fecha Inicial:"),s(),l(26,"div",19)(27,"input",20),Z("ngModelChange",function(a){return J(n.filtroFechaPedido,a)||(n.filtroFechaPedido=a),a}),s(),N(28,L4,2,1,"button",21),s()(),l(29,"div",17)(30,"label",22),d(31,"Fecha Final:"),s(),l(32,"div",19)(33,"input",20),Z("ngModelChange",function(a){return J(n.filtroFechaFin,a)||(n.filtroFechaFin=a),a}),s(),N(34,V4,2,1,"button",21),s()(),l(35,"div",23)(36,"label",24),d(37,"Descripci\xF3n:"),s(),l(38,"div",19)(39,"input",25),Z("ngModelChange",function(a){return J(n.filtroDescripcion,a)||(n.filtroDescripcion=a),a}),s(),N(40,U4,2,1,"button",21),s()(),l(41,"div",17)(42,"label",26),d(43,"Estado:"),s(),l(44,"select",27),Z("ngModelChange",function(a){return J(n.filtroEstado,a)||(n.filtroEstado=a),a}),l(45,"option",8),d(46,"-- Todos --"),s(),N(47,j4,2,2,"option",9),s()(),N(48,W4,3,0,"div",28),s(),N(49,H4,5,0,"div",29)(50,J4,66,39,"table",30)(51,Z4,22,12,"div",31)(52,ek,2,0,"p",32),s()),e&2&&(c(9),Q("ngModel",n.filtroFarmaciaId),c(),p("ngValue",null),c(2),p("ngForOf",n.farmacias),c(5),Q("ngModel",n.filtroClienteNombre),c(2),Q("ngModel",n.incluirClienteNull),c(8),Q("ngModel",n.filtroFechaPedido),c(),p("ngIf",n.filtroFechaPedido),c(5),Q("ngModel",n.filtroFechaFin),c(),p("ngIf",n.filtroFechaFin),c(5),Q("ngModel",n.filtroDescripcion),c(),p("ngIf",n.filtroDescripcion),c(4),Q("ngModel",n.filtroEstado),c(),p("ngValue",null),c(2),p("ngForOf",n.estadosPedido),c(),p("ngIf",n.mostrarBotonBuscar),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.pedidos.length>0),c(),p("ngIf",n.paginacion==null?null:n.paginacion.pages),c(),p("ngIf",n.filtroFolio.length===6&&n.pedidos.length===0))},dependencies:[ti,ei,rt,it,nt,Xe,Gt,li,tt,ze,_t,Ae,si,We,Be,Ct,Nt,Rt,Lt,ut],styles:[".pedidos-container[_ngcontent-%COMP%]{padding:10px}.pedidos-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.filtros-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;border-bottom:2px solid #0453b3;padding-bottom:1rem}.input-con-icono[_ngcontent-%COMP%]{position:relative;display:inline-block}.input-con-icono[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:24px}.icono-limpiar[_ngcontent-%COMP%]{position:absolute;right:6px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer}.mensaje-error-fecha[_ngcontent-%COMP%]{color:#d9534f;font-size:.7rem;margin-top:4px;font-weight:700}.icono-rotado[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.icono-normal[_ngcontent-%COMP%]{transform:rotate(0);transition:transform .3s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7!important;cursor:not-allowed!important;background-color:#ccc!important;color:#666!important}.lbl-pedido[_ngcontent-%COMP%]{font-size:large}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f9f9f9;border-top:2px solid #ccc;font-weight:700}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.ord[_ngcontent-%COMP%]{font-size:.85em;margin-left:.25rem}"],data:{animation:[Zr("expandCollapse",[nr("true",pn({height:"*",opacity:1,padding:"*",overflow:"hidden"})),nr("false",pn({height:"0px",opacity:0,padding:"0px",overflow:"hidden"})),ta("true <=> false",ea("300ms ease-in-out"))])]}})};var Dg=hi(ki());function tk(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function ik(i,t){if(i&1){let e=ie();l(0,"button",45),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.selectCliente(r))}),l(1,"div",46),d(2),s()()}if(i&2){let e=t.$implicit;c(2),k(e.nombre||"(sin nombre)")}}function nk(i,t){if(i&1&&(l(0,"div",43),N(1,ik,3,1,"button",44),s()),i&2){let e=_();c(),p("ngForOf",e.clienteOpts)}}function rk(i,t){if(i&1){let e=ie();l(0,"div",47)(1,"span",48),d(2),s(),l(3,"button",49),E("click",function(){T(e);let r=_(),a=$t(14);return P(r.clearCliente(a))}),d(4,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.clienteSel.nombre," ")}}function ak(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function ok(i,t){if(i&1&&(l(0,"small",61),d(1),s()),i&2){let e=_().$implicit;c(),R("CB: ",e.producto.codigoBarras,"")}}function sk(i,t){if(i&1&&(l(0,"tr")(1,"td")(2,"div"),d(3),s(),N(4,ok,2,1,"small",60),s(),l(5,"td",30),d(6),F(7,"number"),s(),l(8,"td",30),d(9),F(10,"number"),s(),l(11,"td",30),d(12),F(13,"number"),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),s(),l(18,"td",30),d(19),F(20,"number"),s(),l(21,"td",30),d(22),F(23,"number"),s(),l(24,"td",30),d(25),F(26,"number"),s(),l(27,"td",30),d(28),F(29,"number"),s(),l(30,"td",30),d(31),F(32,"number"),s(),l(33,"td",30),d(34),F(35,"number"),s()()),i&2){let e=t.$implicit,n=_(2).$implicit;c(3),k((e==null||e.producto==null?null:e.producto.nombre)||"\u2014"),c(),p("ngIf",e==null||e.producto==null?null:e.producto.codigoBarras),c(2),k(oe(7,13,e==null?null:e.cantidad)),c(3),R("$",Y(10,15,e==null?null:e.precioOriginal,"1.2-2"),""),c(3),R("$",Y(13,18,(e==null?null:e.precioOriginal)*(e==null?null:e.cantidad),"1.2-2")," "),c(3),k(e==null?null:e.tipoDescuento),c(2),k(e==null?null:e.cadenaDescuento),c(2),R("$",Y(20,21,e==null?null:e.monederoCliente,"1.2-2"),""),c(3),R("$",Y(23,24,e==null?null:e.descuento,"1.2-2"),""),c(3),R("$",Y(26,27,(e==null?null:e.costo)*(e==null?null:e.cantidad),"1.2-2"),""),c(3),R("$",Y(29,30,(e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad)-(n==null||n.formaPago==null?null:n.formaPago.vale),"1.2-2"),""),c(3),R("",Y(32,33,((e==null?null:e.totalRen)-(e==null?null:e.costo)*(e==null?null:e.cantidad))/((e==null?null:e.costo)*(e==null?null:e.cantidad))*100,"1.2-2"),"%"),c(3),R("$",Y(35,36,e==null?null:e.totalRen,"1.2-2"),"")}}function lk(i,t){i&1&&(l(0,"tr")(1,"td",62),d(2,"Sin renglones"),s()())}function ck(i,t){if(i&1&&(l(0,"tr")(1,"td",53)(2,"div",54)(3,"table",55)(4,"thead")(5,"tr")(6,"th"),d(7,"Producto"),s(),l(8,"th",30),d(9,"Cant."),s(),l(10,"th",30),d(11,"P. U."),s(),l(12,"th",30),d(13,"Imp. normal"),s(),l(14,"th"),d(15,"Promo"),s(),l(16,"th"),d(17,"% desc"),s(),l(18,"th",30),d(19,"Monedero"),s(),l(20,"th",30),d(21,"Desc."),s(),l(22,"th",30),d(23,"Costo"),s(),l(24,"th",30),d(25,"Utilidad"),s(),l(26,"th",30),d(27,"% Gan."),s(),l(28,"th",30),d(29,"Total"),s()()(),l(30,"tbody"),N(31,sk,36,39,"tr",31)(32,lk,3,0,"tr",32),s()()(),l(33,"div",56)(34,"div",57)(35,"div",58)(36,"strong"),d(37,"Forma de pago:"),s()(),l(38,"div",59),d(39,"Efectivo: "),l(40,"strong"),d(41),F(42,"number"),s()(),l(43,"div",59),d(44,"Tarjeta: "),l(45,"strong"),d(46),F(47,"number"),s()(),l(48,"div",59),d(49,"Transferencia: "),l(50,"strong"),d(51),F(52,"number"),s()(),l(53,"div",59),d(54,"Monedero: "),l(55,"strong"),d(56),F(57,"number"),s()()()()()()),i&2){let e=_().$implicit;c(31),p("ngForOf",e.productos),c(),p("ngIf",!e.productos||e.productos.length===0),c(9),R(" $",Y(42,6,(e==null||e.formaPago==null?null:e.formaPago.efectivo)||0,"1.2-2"),""),c(5),R(" $",Y(47,9,(e==null||e.formaPago==null?null:e.formaPago.tarjeta)||0,"1.2-2"),""),c(5),R(" $",Y(52,12,(e==null||e.formaPago==null?null:e.formaPago.transferencia)||0,"1.2-2"),""),c(5),R(" $",Y(57,15,(e==null||e.formaPago==null?null:e.formaPago.vale)||0,"1.2-2"),"")}}function dk(i,t){if(i&1){let e=ie();at(0),l(1,"tr")(2,"td",50)(3,"button",51),E("click",function(){let r=T(e).$implicit,a=_();return P(a.toggleDetalle(r))}),y(4,"fa-icon",52),s()(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),F(11,"date"),s(),l(12,"td"),d(13),s(),l(14,"td"),d(15),s(),l(16,"td"),d(17),F(18,"number"),s(),l(19,"td",30),d(20),F(21,"number"),s(),l(22,"td",30),d(23),F(24,"number"),s(),l(25,"td",30),d(26),F(27,"number"),s(),l(28,"td",30),d(29),F(30,"number"),s(),l(31,"td",30),d(32),F(33,"number"),s(),l(34,"td",30),d(35),F(36,"number"),s()(),N(37,ck,58,18,"tr",32),ot()}if(i&2){let e=t.$implicit,n=_();c(3),p("disabled",n.cargando)("matTooltip",n.isExpanded(e)?"Cerrar detalle de venta":"Mostrar detalle de venta"),c(),p("icon",n.isExpanded(e)?"chevron-up":"chevron-down"),c(2),k((e.farmacia==null?null:e.farmacia.nombre)||"\u2014"),c(2),k((e.usuario==null?null:e.usuario.nombre)||"\u2014"),c(2),k(Ni(11,16,e.fecha,"dd/MM/yyyy HH:mm","America/Mexico_City")),c(3),k(e.folio),c(2),k((e.cliente==null?null:e.cliente.nombre)||"\u2014"),c(2),k(oe(18,20,e.cantidadProductos)),c(3),R("$",Y(21,22,e.totalMonederoCliente,"1.2-2"),""),c(3),R("$",Y(24,25,e.totalDescuento,"1.2-2"),""),c(3),R("$",Y(27,28,e._costo,"1.2-2"),""),c(3),R("$",Y(30,31,e._utilidad-(e==null||e.formaPago==null?null:e.formaPago.vale),"1.2-2"),""),c(3),R("",Y(33,34,e._utilidad/e._costo*100,"1.2-2"),"%"),c(3),R("$",Y(36,37,e.total,"1.2-2"),""),c(2),p("ngIf",n.isExpanded(e))}}function uk(i,t){i&1&&(l(0,"tr")(1,"td",63),d(2,"Sin resultados"),s()())}function mk(i,t){if(i&1&&(l(0,"tfoot")(1,"tr")(2,"td",64)(3,"strong"),d(4,"Totales ===>"),s()(),l(5,"td",65),d(6),s(),l(7,"td",65),d(8),F(9,"number"),s(),l(10,"td",65),d(11),F(12,"number"),s(),l(13,"td",65),d(14),F(15,"number"),s(),l(16,"td",65),d(17),F(18,"number"),s(),l(19,"td",65),d(20),F(21,"number"),s(),l(22,"td",30)(23,"strong"),d(24),F(25,"number"),s()()()()),i&2){let e=_();c(6),k(e.sumaCantidadProductos),c(2),R("$",Y(9,7,e.sumaTotalMonederoCliente,"1.2-2"),""),c(3),R("$",Y(12,10,e.sumaTotalDescuento,"1.2-2"),""),c(3),R("$",Y(15,13,e.sumaCosto,"1.2-2"),""),c(3),R("$",Y(18,16,e.sumaUtilidad,"1.2-2"),""),c(3),R("",Y(21,19,e.sumaUtilidad/e.sumaCosto*100,"1.2-2"),"% "),c(4),R("$",Y(25,22,e.sumaTotalFiltro,"1.2-2"),"")}}var dc=class i{constructor(t,e,n,r,a,o){this.fb=t;this.reportes=e;this.farmaciaSrv=n;this.clienteSrv=r;this.usuarioSrv=a;this.faLib=o;this.faLib.addIcons(uf,qm)}clienteSel=null;clienteOpts=[];filtroForm;cargando=!1;rows=[];farmacias=[];clientes=[];usuarios=[];farmaciasCargadas=!1;clientesCargados=!1;usuariosCargados=!1;page=1;limit=20;totalPaginas=0;totalRegistros=0;totalPagina=0;sumaTotalFiltro=0;sumaCantidadProductos=0;sumaTotalDescuento=0;sumaTotalMonederoCliente=0;sumaCosto=0;sumaUtilidad=0;expandedId=null;collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});clientesBase=[];clientesIdx=[];sugerenciasClientes=[];mostrandoSugerencias=!1;focoSugerencia=-1;sortByNombre(t){return[...t||[]].sort((e,n)=>(e.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"}))}ngOnInit(){let t=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaInicial:[t],fechaFinal:[t],clienteId:[""],clienteNombre:[""],usuarioId:[""],totalDesde:[""],totalHasta:[""],limit:[this.limit]}),this.filtroForm.get("clienteNombre").valueChanges.pipe(dn(200),un()).subscribe(e=>this.onClienteNombreChanged(e||"")),this.cargarCatalogos()}onClienteInput(t){let e=(t||"").trim();if(e.length<2){this.clienteOpts=[];return}this.clienteSrv.searchClientes(e).subscribe(n=>this.clienteOpts=n)}selectCliente(t){this.clienteSel=t,this.clienteOpts=[],this.filtroForm.patchValue({clienteId:t._id}),this.buscar(!0)}clearCliente(t){this.clienteSel=null,this.filtroForm.patchValue({clienteId:null}),this.clienteOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0)),this.buscar(!0)}normalizeEs(t){return(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}rankNombre(t,e,n){let r=this.normalizeEs(n).split(" ").filter(Boolean);if(!r.length)return{score:-1,pos:1/0};let a=0,o=1/0;for(let u of r){let m=t.indexOf(u);if(m===-1)return{score:-1,pos:1/0};let f=e.some(h=>h.startsWith(u));a+=f?2:1,m<o&&(o=m)}return{score:a,pos:o}}tokenizeTerm(t){return this.normalizeEs(t).split(/\s+/).filter(Boolean)}scoreMatch(t,e){let n=this.normalizeEs(t),r=this.normalizeEs(e).split(" ").filter(Boolean);if(!r.length)return{score:-1,pos:1/0};let a=0,o=1/0;for(let u of r){let m=n.indexOf(u);if(m===-1)return{score:-1,pos:1/0};let f=m===0||n.charAt(m-1)===" ";a+=f?2:1,o=Math.min(o,m)}return{score:a,pos:o}}onClienteNombreChanged(t){let e=(t||"").trim();if(!e){this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.filtroForm.value.clienteId&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});return}let n=this.filtroForm.value.clienteNombre||"";(this.filtroForm.value.clienteId||"")&&this.normalizeEs(n)!==this.normalizeEs(e)&&this.filtroForm.patchValue({clienteId:""},{emitEvent:!1});let a=this.clientesIdx.map(o=>({c:{_id:o._id,nombre:o.nombre},r:this.rankNombre(o.norm,o.words,e)})).filter(o=>o.r.score>=0).sort((o,u)=>u.r.score-o.r.score||o.r.pos-u.r.pos||this.collator.compare(o.c.nombre,u.c.nombre)).slice(0,100).map(o=>o.c);this.sugerenciasClientes=a,this.mostrandoSugerencias=!0,this.focoSugerencia=-1}seleccionarCliente(t){this.filtroForm.patchValue({clienteId:t._id,clienteNombre:t.nombre},{emitEvent:!1}),this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}limpiarCliente(){this.filtroForm.patchValue({clienteId:"",clienteNombre:""},{emitEvent:!1}),this.sugerenciasClientes=[],this.mostrandoSugerencias=!1,this.focoSugerencia=-1,this.buscar(!0)}onClienteKeyDown(t){if(!(!this.mostrandoSugerencias||!this.sugerenciasClientes.length))if(t.key==="ArrowDown")t.preventDefault(),this.focoSugerencia=Math.min(this.focoSugerencia+1,this.sugerenciasClientes.length-1);else if(t.key==="ArrowUp")t.preventDefault(),this.focoSugerencia=Math.max(this.focoSugerencia-1,0);else if(t.key==="Enter"){t.preventDefault();let e=this.sugerenciasClientes[this.focoSugerencia]??this.sugerenciasClientes[0];e&&this.seleccionarCliente(e)}else t.key==="Escape"&&(this.mostrandoSugerencias=!1)}onClienteFocus(){let t=(this.filtroForm.value.clienteNombre||"").trim();t?this.onClienteNombreChanged(t):this.mostrandoSugerencias=!1}onClienteBlur(){setTimeout(()=>{this.mostrandoSugerencias=!1},150)}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{let e=this.sortByNombre(t||[]);this.farmacias=[{_id:"",nombre:"TODAS"},...e],this.farmaciasCargadas=!0,this.dispararInicialSiListos()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.dispararInicialSiListos()}}),this.clienteSrv.getClientes().subscribe({next:t=>{let n=(Array.isArray(t)?t:t?.rows??[]).map(a=>({_id:a._id?.toString()||"",nombre:a.nombre||""})),r=this.sortByNombre(n);this.clientesBase=r,this.clientesIdx=r.map(a=>{let o=this.normalizeEs(a.nombre),u=o.split(" ").filter(Boolean);return{_id:a._id,nombre:a.nombre,norm:o,words:u}}),this.clientes=[{_id:"",nombre:"TODOS"},...r],this.clientesCargados=!0,this.dispararInicialSiListos()},error:()=>{this.clientesBase=[],this.clientesIdx=[],this.clientes=[{_id:"",nombre:"TODOS"}],this.clientesCargados=!0,this.dispararInicialSiListos()}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{let e=this.sortByNombre(t||[]),n={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[n,...e],this.usuariosCargados=!0,this.dispararInicialSiListos()},error:()=>{let t={_id:"",nombre:"TODOS",usuario:"",telefono:"",rol:"empleado"};this.usuarios=[t],this.usuariosCargados=!0,this.dispararInicialSiListos()}})}dispararInicialSiListos(){this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados&&this.buscar(!0)}resetPaginacion(){this.expandedId=null,this.page=1}limpiar(){let t=this.todayYMD();this.filtroForm.reset({farmaciaId:"",fechaInicial:t,fechaFinal:t,clienteId:"",usuarioId:"",totalDesde:"",totalHasta:"",limit:this.limit}),this.resetPaginacion(),this.buscar(!0)}buscar(t=!1){if(!(this.farmaciasCargadas&&this.clientesCargados&&this.usuariosCargados))return;t&&this.resetPaginacion();let e=this.filtroForm.value;this.limit=Number(e.limit)||20;let n={farmaciaId:e.farmaciaId||void 0,clienteId:e.clienteId||void 0,usuarioId:e.usuarioId||void 0,totalDesde:e.totalDesde!==""&&e.totalDesde!=null?Number(e.totalDesde):void 0,totalHasta:e.totalHasta!==""&&e.totalHasta!=null?Number(e.totalHasta):void 0,fechaInicial:e.fechaInicial,fechaFinal:e.fechaFinal,page:this.page,limit:this.limit};this.cargando=!0,this.reportes.getVentas(n).subscribe({next:r=>{let a=o=>Number.isFinite(Number(o))?Number(o):0;this.rows=(r?.ventas||[]).map(o=>{let m=(Array.isArray(o?.productos)?o.productos:[]).reduce((h,g)=>h+a(g?.costo)*a(g?.cantidad),0),f=a(o?.total)-m;return jt(Qe({},o),{_costo:o._costo??Number(m.toFixed(2)),_utilidad:o._utilidad??Number(f.toFixed(2))})}),this.totalRegistros=r?.paginacion?.totalRegistros||0,this.totalPaginas=r?.paginacion?.totalPaginas||0,this.sumaTotalFiltro=r?.resumen?.sumaTotalFiltro??0,this.sumaCantidadProductos=r?.resumen?.sumaCantidadProductos??0,this.sumaTotalDescuento=r?.resumen?.sumaTotalDescuento??0,this.sumaTotalMonederoCliente=r?.resumen?.sumaTotalMonederoCliente??0,this.sumaCosto=r?.resumen?.sumaCosto??0,this.sumaUtilidad=r?.resumen?.sumaUtilidad??0,this.totalPagina=this.rows.reduce((o,u)=>o+a(u.total),0),this.cargando=!1},error:r=>{this.cargando=!1,this.rows=[],this.totalRegistros=0,this.totalPaginas=0,this.totalPagina=0,this.sumaTotalFiltro=0,this.sumaCantidadProductos=0,this.sumaTotalDescuento=0,this.sumaTotalMonederoCliente=0,this.sumaCosto=0,this.sumaUtilidad=0;let a=r?.error?.mensaje||"No se pudo consultar el reporte.";Dg.default.fire("Error",a,"error")}})}toggleDetalle(t){let e=String(t?._id||"");e&&(this.expandedId=this.expandedId===e?null:e)}isExpanded(t){let e=String(t?._id||"");return!!e&&this.expandedId===e}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}primera(){this.page!==1&&(this.page=1,this.buscar())}anterior(){this.page>1&&(this.page--,this.buscar())}siguiente(){this.page<this.totalPaginas&&(this.page++,this.buscar())}ultima(){this.page!==this.totalPaginas&&(this.page=this.totalPaginas,this.buscar())}static \u0275fac=function(e){return new(e||i)(te(Jt),te(Mn),te(Zt),te(wn),te(Na),te(bi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-ventas"]],decls:93,vars:21,consts:[["cliInput",""],[1,"container-ventas"],[1,"titulo","text-center"],[1,"mb-2","filtros"],[1,"row","g-2","align-items-end",3,"formGroup"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-3","position-relative"],["type","text","placeholder","Escribe nombre (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-md-3",2,"align-items","end"],["formControlName","usuarioId",1,"form-select",3,"change","disabled"],["type","number","formControlName","limit","min","1","max","200",1,"form-control"],[1,"mt-3","row"],[1,"col-md-2"],["type","date","formControlName","fechaInicial",1,"form-control"],["type","date","formControlName","fechaFinal",1,"form-control"],["type","number","formControlName","totalDesde","min","0","step","0.01",1,"form-control"],["type","number","formControlName","totalHasta","min","0","step","0.01",1,"form-control"],[1,"col-2",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-2","text-end",2,"margin-top","1.3rem"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"mt-2"],[1,"tabla"],[2,"width","40px"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[3,"ngValue"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[1,"text-center"],[1,"btn-icon-chico","btn-gris-chico",3,"click","disabled","matTooltip"],[3,"icon"],["colspan","13",2,"background","#fafafa"],[1,"table-responsive"],[1,"detalle-tabla"],[1,"mt-1",2,"background-color","aquamarine"],[1,"row","align-items-end"],[1,"col-4","subtitulo"],[1,"col-2"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","10",1,"text-center","text-muted","py-2"],["colspan","13",1,"text-center","text-muted","py-3"],["colspan","6",1,"text-end"],[1,"text-end",2,"font-weight","600"]],template:function(e,n){if(e&1){let r=ie();l(0,"div",1)(1,"h2",2),d(2,"Reporte de Ventas"),s(),l(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),d(7,"Farmacia"),s(),l(8,"select",7),E("change",function(){return T(r),P(n.buscar(!0))}),N(9,tk,2,2,"option",8),s()(),l(10,"div",9)(11,"label",6),d(12,"Cliente"),s(),l(13,"input",10,0),E("input",function(){T(r);let o=$t(14);return P(n.onClienteInput(o.value))}),s(),N(15,nk,2,1,"div",11)(16,rk,5,1,"div",12),s(),l(17,"div",13)(18,"label",6),d(19,"Vendi\xF3:"),s(),l(20,"select",14),E("change",function(){return T(r),P(n.buscar(!0))}),N(21,ak,2,2,"option",8),s()(),l(22,"div",5)(23,"label",6),d(24,"# de Ventas por p\xE1gina"),s(),y(25,"input",15),s(),l(26,"div",16)(27,"div",17)(28,"label",6),d(29,"Fecha inicial"),s(),y(30,"input",18),s(),l(31,"div",17)(32,"label",6),d(33,"Fecha final"),s(),y(34,"input",19),s(),l(35,"div",17)(36,"label",6),d(37,"Total desde"),s(),y(38,"input",20),s(),l(39,"div",17)(40,"label",6),d(41,"Total hasta"),s(),y(42,"input",21),s(),l(43,"div",22)(44,"button",23),E("click",function(){return T(r),P(n.limpiar())}),y(45,"i",24),s()(),l(46,"div",25)(47,"button",26),E("click",function(){return T(r),P(n.buscar(!0))}),d(48),s()()()()(),l(49,"div",27)(50,"table",28)(51,"thead")(52,"tr")(53,"th",29),d(54,"Det."),s(),l(55,"th"),d(56,"Farmacia"),s(),l(57,"th"),d(58,"Vendi\xF3"),s(),l(59,"th"),d(60,"Fecha"),s(),l(61,"th"),d(62,"Folio"),s(),l(63,"th"),d(64,"Cliente"),s(),l(65,"th",30),d(66,"# Prod."),s(),l(67,"th",30),d(68,"Al moned."),s(),l(69,"th",30),d(70,"Descuento"),s(),l(71,"th",30),d(72,"Costo"),s(),l(73,"th",30),d(74,"Utilidad"),s(),l(75,"th",30),d(76,"% Gan."),s(),l(77,"th",30),d(78,"Total"),s()()(),l(79,"tbody"),N(80,dk,38,40,"ng-container",31)(81,uk,3,0,"tr",32),s(),N(82,mk,26,25,"tfoot",32),s(),l(83,"div",33)(84,"button",34),E("click",function(){return T(r),P(n.primera())}),y(85,"i",35),s(),l(86,"button",36),E("click",function(){return T(r),P(n.anterior())}),y(87,"i",37),s(),d(88),l(89,"button",38),E("click",function(){return T(r),P(n.siguiente())}),y(90,"i",39),s(),l(91,"button",40),E("click",function(){return T(r),P(n.ultima())}),y(92,"i",41),s()()()()}e&2&&(c(4),p("formGroup",n.filtroForm),c(4),p("disabled",!n.farmaciasCargadas||n.cargando),c(),p("ngForOf",n.farmacias),c(4),p("disabled",n.cargando||!!n.clienteSel),c(2),p("ngIf",n.clienteOpts.length&&!n.clienteSel),c(),p("ngIf",n.clienteSel),c(4),p("disabled",n.cargando||!n.usuariosCargados),c(),p("ngForOf",n.usuarios),c(23),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando...":"Buscar"," "),c(32),p("ngForOf",n.rows),c(),p("ngIf",n.rows.length===0),c(),p("ngIf",n.rows.length>0),c(2),p("disabled",n.cargando||n.page===1),c(2),p("disabled",n.cargando||n.page===1),c(2),Cn(" Ventas: ",n.totalRegistros," \xA0 | \xA0 P\xE1gina: ",n.page," / ",n.totalPaginas||1," "),c(),p("disabled",n.cargando||n.page===n.totalPaginas||n.totalPaginas===0),c(2),p("disabled",n.cargando||n.page===n.totalPaginas||n.totalPaginas===0))},dependencies:[Ae,We,Be,Ct,Rt,Bt,Ft,it,nt,Xe,Gt,tt,ze,Mt,Bi,Kn,ci,di,ti,ei,Lt,ut],styles:[".container-ventas[_ngcontent-%COMP%]{width:100%}.filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.sugerencias[_ngcontent-%COMP%]   .list-group-item.active[_ngcontent-%COMP%]{background-color:#f0f0f0;color:inherit}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;margin-top:.25rem;max-height:320px;overflow:auto;box-shadow:0 .25rem .75rem #00000014}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.5rem .75rem;border:0;background:transparent}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8fafc}"]})};var Rg=hi(ki());var fa=(i,t)=>({"text-success":i,"text-negativo":t});function fk(i,t){if(i&1&&(l(0,"option",21),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function pk(i,t){if(i&1&&(l(0,"tr")(1,"td",22),d(2),s(),l(3,"td",19),d(4),F(5,"number"),s(),l(6,"td",20),d(7),F(8,"number"),s(),l(9,"td",19),d(10),F(11,"number"),s(),l(12,"td",20),d(13),F(14,"number"),s(),l(15,"td",20),d(16),F(17,"number"),s()()),i&2){let e=t.$implicit;c(),p("ngClass",ji(24,fa,e.concepto=="Ventas"||e.concepto=="Pedidos",e.concepto=="Devoluciones"||e.concepto=="Cancelaciones")),c(),R(" ",e.concepto," "),c(2),k(oe(5,10,e.cantidad)),c(2),p("ngClass",ji(27,fa,e.importe>=0,e.importe<0)),c(),R(" $",Y(8,12,e.importe,"1.2-2")," "),c(3),R("$",Y(11,15,e.costo,"1.2-2"),""),c(2),p("ngClass",ji(30,fa,e.utilidad>=0,e.utilidad<0)),c(),R(" $",Y(14,18,e.utilidad,"1.2-2")," "),c(2),p("ngClass",ji(33,fa,e.utilidad>=0,e.utilidad<0)),c(),R(" ",e.costo==0?0:Y(17,21,e.utilidad/e.costo*100,"1.2-2"),"% ")}}var uc=class i{constructor(t,e,n){this.fb=t;this.reportes=e;this.farmaciaSrv=n}filtroForm;cargando=!1;rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}];farmacias=[];farmaciasCargadas=!1;totalCantidad=0;totalImporte=0;totalCosto=0;totalUtilidad=0;ngOnInit(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({farmaciaId:[""],fechaIni:[t],fechaFin:[e]}),this.cargarFarmacias(),this.limpiar()}cargarFarmacias(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.farmaciasCargadas=!0,this.buscar()},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.farmaciasCargadas=!0,this.buscar()}})}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}-01`}limpiar(){let t=this.monthStartYMD(),e=this.todayYMD();this.filtroForm.patchValue({farmaciaId:"",fechaIni:t,fechaFin:e}),this.filtroForm.markAsPristine(),this.filtroForm.markAsUntouched(),this.buscar()}buscar(){if(!this.farmaciasCargadas)return;let t=this.filtroForm.value,e={farmaciaId:t.farmaciaId||void 0,fechaIni:t.fechaIni,fechaFin:t.fechaFin};this.cargando=!0,this.reportes.getResumenUtilidades(e).subscribe({next:n=>{let r={};(n.rows||[]).forEach(u=>{r[u.concepto]=u});let a=u=>Number.isFinite(+u)?+u:0,o=u=>{let m=r[u]||{concepto:u,cantidad:0,importe:0,costo:0,utilidad:0};return{concepto:u,cantidad:a(m.cantidad),importe:a(m.importe),costo:a(m.costo),utilidad:a(m.utilidad)}};this.rows=[o("Ventas"),o("Pedidos"),o("Devoluciones"),o("Cancelaciones")],this.totalCantidad=this.rows.reduce((u,m)=>u+m.cantidad,0),this.totalImporte=this.rows.reduce((u,m)=>u+m.importe,0),this.totalCosto=this.rows.reduce((u,m)=>u+m.costo,0),this.totalUtilidad=this.rows.reduce((u,m)=>u+m.utilidad,0),this.cargando=!1},error:n=>{this.cargando=!1,this.rows=[{concepto:"Ventas",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Pedidos",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Devoluciones",cantidad:0,importe:0,costo:0,utilidad:0},{concepto:"Cancelaciones",cantidad:0,importe:0,costo:0,utilidad:0}],this.totalCantidad=this.totalImporte=this.totalCosto=this.totalUtilidad=0;let r=n?.error?.mensaje||n?.message||"No se pudo consultar el resumen de utilidades.";Rg.default.fire("Error",r,"error")}})}static \u0275fac=function(e){return new(e||i)(te(Jt),te(Mn),te(Zt))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-resumen-utilidades"]],decls:60,vars:40,consts:[[1,"container-fluid"],[1,"titulo","text-center"],[1,"row","align-items-end","mb-2",3,"formGroup"],[1,"row","g-2","align-items-end","mb-3","filtros"],[1,"col-md-3"],[1,"form-label"],["formControlName","farmaciaId",1,"form-select",3,"change","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-2"],["type","date","formControlName","fechaIni",1,"form-control",3,"change","disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"change","disabled"],[1,"col-auto","ms-auto"],[1,"btn","btn-amarillo",3,"click","disabled"],[1,"btn","btn-gris","ms-4",3,"click","disabled"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"fw-bold"],[1,"text-end","text-success"],[1,"text-end",3,"ngClass"],[3,"ngValue"],[3,"ngClass"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h3",1),d(2,"Resumen utilidades"),s(),l(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Farmacia"),s(),l(8,"select",6),E("change",function(){return n.buscar()}),N(9,fk,2,2,"option",7),s()(),l(10,"div",8)(11,"label",5),d(12,"Fecha inicial"),s(),l(13,"input",9),E("change",function(){return n.buscar()}),s()(),l(14,"div",8)(15,"label",5),d(16,"Fecha final"),s(),l(17,"input",10),E("change",function(){return n.buscar()}),s()(),l(18,"div",11)(19,"button",12),E("click",function(){return n.limpiar()}),d(20,"Hoy / Mes actual"),s(),l(21,"button",13),E("click",function(){return n.buscar()}),d(22),s()()()(),l(23,"div",14)(24,"table",15)(25,"thead")(26,"tr")(27,"th"),d(28,"Concepto"),s(),l(29,"th",16),d(30,"Cant. Movim."),s(),l(31,"th",16),d(32,"Importe"),s(),l(33,"th",16),d(34,"Costo"),s(),l(35,"th",16),d(36,"Utilidad"),s(),l(37,"th",16),d(38,"% Gan."),s()()(),l(39,"tbody"),N(40,pk,18,36,"tr",17),s(),l(41,"tfoot")(42,"tr",18)(43,"td",16),d(44,"Totales:"),s(),l(45,"td",19),d(46),F(47,"number"),s(),l(48,"td",20),d(49),F(50,"number"),s(),l(51,"td",19),d(52),F(53,"number"),s(),l(54,"td",20),d(55),F(56,"number"),s(),l(57,"td",20),d(58),F(59,"number"),s()()()()()()),e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",!n.farmaciasCargadas||n.cargando),c(),p("ngForOf",n.farmacias),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(2),p("disabled",n.cargando),c(),R(" ",n.cargando?"Consultando\u2026":"Buscar"," "),c(18),p("ngForOf",n.rows),c(6),k(oe(47,17,n.totalCantidad)),c(2),p("ngClass",ji(31,fa,n.totalImporte>=0,n.totalImporte<0)),c(),R(" $",Y(50,19,n.totalImporte,"1.2-2"),""),c(3),R("$",Y(53,22,n.totalCosto,"1.2-2"),""),c(2),p("ngClass",ji(34,fa,n.totalUtilidad>=0,n.totalUtilidad<0)),c(),R(" $",Y(56,25,n.totalUtilidad,"1.2-2")," "),c(2),p("ngClass",ji(37,fa,n.totalUtilidad>=0,n.totalUtilidad<0)),c(),R(" ",n.totalCosto==0?0:Y(59,28,n.totalUtilidad/n.totalCosto*100,"1.2-2"),"% "))},dependencies:[Ae,si,We,Ct,Bt,Ft,it,nt,Xe,tt,ze,Mt,ci,di],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-negativo[_ngcontent-%COMP%]{color:red}"]})};var pa=hi(ki());var ld=()=>({campo:"ventas",dir:"desc"}),cd=()=>({campo:"utilidad",dir:"desc"}),dd=()=>({campo:"ventas",dir:"asc"}),ud=()=>({campo:"utilidad",dir:"asc"}),lo=(i,t)=>({"text-success":i,"text-danger":t});function hk(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function gk(i,t){if(i&1&&(l(0,"div",3)(1,"div",23)(2,"label",5),d(3,"Usuario"),s(),l(4,"select",24)(5,"option",25),d(6,"(Todos)"),s(),N(7,hk,2,2,"option",26),s()(),l(8,"div",23)(9,"label",5),d(10,"Los mejores / peores por:"),s(),l(11,"select",27)(12,"option",28),d(13,"N\xFAm. de ventas las mejores"),s(),l(14,"option",28),d(15,"Utilidad las mejores"),s(),l(16,"option",28),d(17,"N\xFAm. de ventas las peores"),s(),l(18,"option",28),d(19,"Utilidad las peores"),s()()()()),i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.usuarios),c(4),p("disabled",e.cargando),c(),p("ngValue",Qt(7,ld)),c(2),p("ngValue",Qt(8,cd)),c(2),p("ngValue",Qt(9,dd)),c(2),p("ngValue",Qt(10,ud))}}function _k(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function vk(i,t){if(i&1&&(l(0,"div",3)(1,"div",29)(2,"label",5),d(3,"Cliente"),s(),l(4,"select",30)(5,"option",25),d(6,"(Todos)"),s(),N(7,_k,2,2,"option",26),s()(),l(8,"div",4)(9,"label",5),d(10,"\xBFCu\xE1ntos clientes?"),s(),y(11,"input",31),s(),l(12,"div",23)(13,"label",5),d(14,"Los mejores / peores por:"),s(),l(15,"select",32)(16,"option",28),d(17,"N\xFAm. de compras las mejores"),s(),l(18,"option",28),d(19,"Utilidad las mejores"),s(),l(20,"option",28),d(21,"N\xFAm. de compras las peores"),s(),l(22,"option",28),d(23,"Utilidad las peores"),s()()()()),i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.clientes),c(4),p("disabled",e.cargando||!!e.filtroForm.value.clienteId),c(4),p("disabled",e.cargando),c(),p("ngValue",Qt(8,ld)),c(2),p("ngValue",Qt(9,cd)),c(2),p("ngValue",Qt(10,dd)),c(2),p("ngValue",Qt(11,ud))}}function xk(i,t){if(i&1&&(l(0,"option",28),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e._id),c(),k(e.nombre)}}function bk(i,t){if(i&1&&(l(0,"div",40),d(1),s()),i&2){let e=_(2);c(),R(" ",e.errorProductoCB," ")}}function yk(i,t){if(i&1){let e=ie();l(0,"div",3)(1,"div",23)(2,"label",5),d(3,"Farmacia"),s(),l(4,"select",33)(5,"option",25),d(6,"TODAS"),s(),N(7,xk,2,2,"option",26),s()(),l(8,"div",29)(9,"label",5),d(10,"C\xF3digo de barras"),s(),l(11,"input",34),E("keyup.enter",function(){T(e);let r=_();return P(r.resolverProductoPorCB())}),s(),N(12,bk,2,1,"div",35),s(),l(13,"div",36)(14,"label",5),d(15,"Producto"),s(),y(16,"input",37),s(),l(17,"div",4)(18,"label",5),d(19,"\xBFCu\xE1ntos productos?"),s(),y(20,"input",38),s(),l(21,"div",4)(22,"label",5),d(23,"Los mejores / peores por: "),s(),l(24,"select",39)(25,"option",28),d(26,"N\xFAm. de Ventas las mejores"),s(),l(27,"option",28),d(28,"Utilidad las mejores"),s(),l(29,"option",28),d(30,"N\xFAm. de Ventas las peores"),s(),l(31,"option",28),d(32,"Utilidad las peores"),s()()()()}if(i&2){let e=_();c(4),p("disabled",e.cargando),c(3),p("ngForOf",e.farmacias),c(4),p("disabled",e.cargando),c(),p("ngIf",e.errorProductoCB),c(4),p("value",e.productoResueltoNombre),c(4),p("disabled",e.cargando&&!e.filtroForm.value.productoId),c(4),p("disabled",e.cargando),c(),p("ngValue",Qt(11,ld)),c(2),p("ngValue",Qt(12,cd)),c(2),p("ngValue",Qt(13,dd)),c(2),p("ngValue",Qt(14,ud))}}function Ck(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td",43),d(4),F(5,"number"),s(),l(6,"td",45),d(7),F(8,"number"),s(),l(9,"td",46),d(10),F(11,"number"),s(),l(12,"td",43),d(13),F(14,"number"),s(),l(15,"td",45),d(16),F(17,"number"),s(),l(18,"td",46),d(19),F(20,"number"),s(),l(21,"td",45),d(22),F(23,"number"),s(),l(24,"td",46),d(25),F(26,"number"),s(),l(27,"td",47),d(28),F(29,"number"),s(),l(30,"td",43),d(31),F(32,"number"),s()()),i&2){let e=t.$implicit;c(2),k(e.usuario||e.usuarioNombre||e.nombre||"(sin nombre)"),c(2),k(oe(5,12,e.numVentas||e.ventasCount)),c(3),R("$",Y(8,14,e.impVentas,"1.2-2"),""),c(3),R("$",Y(11,17,e.costoVentas,"1.2-2"),""),c(3),k(oe(14,20,e.numPedidos||e.pedidosCount)),c(3),R("$",Y(17,22,e.impPedidos,"1.2-2"),""),c(3),R("$",Y(20,25,e.costoPedidos,"1.2-2"),""),c(3),R("$",Y(23,28,e.ingresos,"1.2-2"),""),c(3),R("$",Y(26,31,e.egresos,"1.2-2"),""),c(2),p("ngClass",ji(40,lo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Y(29,34,e.utilidad,"1.2-2")," "),c(3),k(e.gananciaPct==null?"\u2014":Y(32,37,e.gananciaPct,"1.0-2")+"%")}}function Sk(i,t){i&1&&(l(0,"tr")(1,"td",48),d(2,"Sin resultados"),s()())}function wk(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),d(4,"Totales:"),s()(),l(5,"td",43)(6,"strong"),d(7),F(8,"number"),s()(),l(9,"td",45)(10,"strong"),d(11),F(12,"number"),s()(),l(13,"td",46)(14,"strong"),d(15),F(16,"number"),s()(),l(17,"td",43)(18,"strong"),d(19),F(20,"number"),s()(),l(21,"td",45)(22,"strong"),d(23),F(24,"number"),s()(),l(25,"td",46)(26,"strong"),d(27),F(28,"number"),s()(),l(29,"td",45)(30,"strong"),d(31),F(32,"number"),s()(),l(33,"td",46)(34,"strong"),d(35),F(36,"number"),s()(),l(37,"td",47)(38,"strong"),d(39),F(40,"number"),s()(),l(41,"td",43)(42,"strong"),d(43),F(44,"number"),s()()()()),i&2){let e=_(2);c(7),k(oe(8,11,e.footerUsuarios.totalVentas)),c(4),R("$",Y(12,13,e.footerUsuarios.totalImpVentas,"1.2-2"),""),c(4),R("$",Y(16,16,e.footerUsuarios.totalCostoVentas,"1.2-2"),""),c(4),k(oe(20,19,e.footerUsuarios.totalPedidos)),c(4),R("$",Y(24,21,e.footerUsuarios.totalImpPedidos,"1.2-2"),""),c(4),R("$",Y(28,24,e.footerUsuarios.totalCostoPedidos,"1.2-2"),""),c(4),R("$",Y(32,27,e.footerUsuarios.totalIngresos,"1.2-2"),""),c(4),R("$",Y(36,30,e.footerUsuarios.totalEgresos,"1.2-2"),""),c(2),p("ngClass",ji(39,lo,(e.footerUsuarios.totalUtilidad||0)>=0,(e.footerUsuarios.totalUtilidad||0)<0)),c(2),R("$",Y(40,33,e.footerUsuarios.totalUtilidad,"1.2-2"),""),c(4),k(e.footerUsuarios.gananciaPct==null?"\u2014":Y(44,36,e.footerUsuarios.gananciaPct,"1.0-2")+"%")}}function Ek(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Usuario"),s(),l(7,"th",43),d(8,"#Ventas"),s(),l(9,"th",43),d(10,"Imp. Ventas"),s(),l(11,"th",43),d(12,"Costo Ventas"),s(),l(13,"th",43),d(14,"#Pedidos"),s(),l(15,"th",43),d(16,"Imp. Pedidos"),s(),l(17,"th",43),d(18,"Costo Pedidos"),s(),l(19,"th",43),d(20,"Ingresos"),s(),l(21,"th",43),d(22,"Egresos"),s(),l(23,"th",43),d(24,"Utilidad"),s(),l(25,"th",43),d(26,"%Gan"),s()()(),l(27,"tbody"),N(28,Ck,33,43,"tr",44)(29,Sk,3,0,"tr",22),s(),N(30,wk,45,42,"tfoot",22),s()()()),i&2){let e=_();c(28),p("ngForOf",e.rowsUsuarios),c(),p("ngIf",e.rowsUsuarios.length===0),c(),p("ngIf",e.footerUsuarios)}}function Tk(i,t){if(i&1&&(l(0,"small",51),d(1),s()),i&2){let e=_().$implicit;c(),R("Tel: ",e.telefono,"")}}function Pk(i,t){if(i&1&&(l(0,"tr")(1,"td")(2,"div"),d(3),s(),N(4,Tk,2,1,"small",50),s(),l(5,"td",43),d(6),F(7,"number"),s(),l(8,"td",43),d(9),F(10,"number"),s(),l(11,"td",45),d(12),F(13,"number"),s(),l(14,"td",46),d(15),F(16,"number"),s(),l(17,"td",43),d(18),F(19,"number"),s(),l(20,"td",45),d(21),F(22,"number"),s(),l(23,"td",46),d(24),F(25,"number"),s(),l(26,"td",45),d(27),F(28,"number"),s(),l(29,"td",46),d(30),F(31,"number"),s(),l(32,"td",47),d(33),F(34,"number"),s(),l(35,"td",43),d(36),F(37,"number"),s()()),i&2){let e=t.$implicit;c(3),k(e.cliente),c(),p("ngIf",e.telefono),c(2),R("$",Y(7,14,e.totalMonedero,"1.2-2"),""),c(3),k(oe(10,17,e.numVentas)),c(3),R("$",Y(13,19,e.impVentas,"1.2-2"),""),c(3),R("$",Y(16,22,e.costoVentas,"1.2-2"),""),c(3),k(oe(19,25,e.numPedidos)),c(3),R("$",Y(22,27,e.impPedidos,"1.2-2"),""),c(3),R("$",Y(25,30,e.costoPedidos,"1.2-2"),""),c(3),R("$",Y(28,33,e.ingresos,"1.2-2"),""),c(3),R("$",Y(31,36,e.egresos,"1.2-2"),""),c(2),p("ngClass",ji(45,lo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Y(34,39,e.utilidad,"1.2-2")," "),c(3),k(e.gananciaPct==null?"\u2014":Y(37,42,e.gananciaPct,"1.0-2")+"%")}}function kk(i,t){i&1&&(l(0,"tr")(1,"td",52),d(2,"Sin resultados"),s()())}function Ik(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",49)(2,"td",43)(3,"strong"),d(4,"Totales:"),s()(),l(5,"td",43)(6,"strong"),d(7),F(8,"number"),s()(),l(9,"td",43)(10,"strong"),d(11),F(12,"number"),s()(),l(13,"td",45)(14,"strong"),d(15),F(16,"number"),s()(),l(17,"td",46)(18,"strong"),d(19),F(20,"number"),s()(),l(21,"td",43)(22,"strong"),d(23),F(24,"number"),s()(),l(25,"td",45)(26,"strong"),d(27),F(28,"number"),s()(),l(29,"td",46)(30,"strong"),d(31),F(32,"number"),s()(),l(33,"td",45)(34,"strong"),d(35),F(36,"number"),s()(),l(37,"td",46)(38,"strong"),d(39),F(40,"number"),s()(),l(41,"td",47)(42,"strong"),d(43),F(44,"number"),s()(),l(45,"td",43)(46,"strong"),d(47),F(48,"number"),s()()()()),i&2){let e=_(2);c(7),R("$",Y(8,12,e.footerClientes.totalMonedero,"1.2-2"),""),c(4),k(oe(12,15,e.footerClientes.totalVentas)),c(4),R("$",Y(16,17,e.footerClientes.totalImpVentas,"1.2-2"),""),c(4),R("$",Y(20,20,e.footerClientes.totalCostoVentas,"1.2-2"),""),c(4),k(oe(24,23,e.footerClientes.totalPedidos)),c(4),R("$",Y(28,25,e.footerClientes.totalImpPedidos,"1.2-2"),""),c(4),R("$",Y(32,28,e.footerClientes.totalCostoPedidos,"1.2-2"),""),c(4),R("$",Y(36,31,e.footerClientes.totalIngresos,"1.2-2"),""),c(4),R("$",Y(40,34,e.footerClientes.totalEgresos,"1.2-2"),""),c(2),p("ngClass",ji(43,lo,(e.footerClientes.totalUtilidad||0)>=0,(e.footerClientes.totalUtilidad||0)<0)),c(2),R("$",Y(44,37,e.footerClientes.totalUtilidad,"1.2-2"),""),c(4),k(e.footerClientes.gananciaPct==null?"\u2014":Y(48,40,e.footerClientes.gananciaPct,"1.0-2")+"%")}}function Mk(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Cliente"),s(),l(7,"th",43),d(8,"Monedero"),s(),l(9,"th",43),d(10,"#Compras"),s(),l(11,"th",43),d(12,"Imp. Compras"),s(),l(13,"th",43),d(14,"Costo Compras"),s(),l(15,"th",43),d(16,"#Pedidos"),s(),l(17,"th",43),d(18,"Imp. Pedidos"),s(),l(19,"th",43),d(20,"Costo Pedidos"),s(),l(21,"th",43),d(22,"Ingresos"),s(),l(23,"th",43),d(24,"Egresos"),s(),l(25,"th",43),d(26,"Utilidad"),s(),l(27,"th",43),d(28,"%Gan"),s()()(),l(29,"tbody"),N(30,Pk,38,48,"tr",44)(31,kk,3,0,"tr",22),s(),N(32,Ik,49,46,"tfoot",22),s()()()),i&2){let e=_();c(30),p("ngForOf",e.rowsClientes),c(),p("ngIf",e.rowsClientes.length===0),c(),p("ngIf",e.footerClientes)}}function Fk(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td",43),d(6),F(7,"number"),s(),l(8,"td",45),d(9),F(10,"number"),s(),l(11,"td",46),d(12),F(13,"number"),s(),l(14,"td",47),d(15),F(16,"number"),s(),l(17,"td",43),d(18),F(19,"number"),s()()),i&2){let e=t.$implicit;c(2),k(e.producto),c(2),k(e.codigoBarras),c(2),k(oe(7,8,e.numVentas)),c(3),R("$",Y(10,10,e.importe,"1.2-2"),""),c(3),R("$",Y(13,13,e.costo,"1.2-2"),""),c(2),p("ngClass",ji(22,lo,(e.utilidad||0)>=0,(e.utilidad||0)<0)),c(),R(" $",Y(16,16,e.utilidad,"1.2-2")," "),c(3),k(e.gananciaPct==null?"\u2014":Y(19,19,e.gananciaPct,"1.0-2")+"%")}}function Ak(i,t){i&1&&(l(0,"tr")(1,"td",53),d(2,"Sin resultados"),s()())}function Ok(i,t){if(i&1&&(l(0,"tfoot")(1,"tr")(2,"th",54),d(3,"Totales:"),s(),l(4,"th",43),d(5),F(6,"number"),s(),l(7,"th",45),d(8),F(9,"number"),s(),l(10,"th",46),d(11),F(12,"number"),s(),l(13,"th",47),d(14),F(15,"number"),s(),l(16,"th",43),d(17),F(18,"number"),s()()()),i&2){let e=_(2);c(5),k(oe(6,6,e.footerProductos.numVentas)),c(3),R("$",Y(9,8,e.footerProductos.importe,"1.2-2"),""),c(3),R("$",Y(12,11,e.footerProductos.costo,"1.2-2"),""),c(2),p("ngClass",ji(20,lo,(e.footerProductos.utilidad||0)>=0,(e.footerProductos.utilidad||0)<0)),c(),R(" $",Y(15,14,e.footerProductos.utilidad,"1.2-2")," "),c(3),R(" ",e.footerProductos.gananciaPct==null?"\u2014":Y(18,17,e.footerProductos.gananciaPct,"1.0-2")+"%"," ")}}function Dk(i,t){if(i&1&&(l(0,"div")(1,"div",41)(2,"table",42)(3,"thead")(4,"tr")(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3digo de Barras"),s(),l(9,"th",43),d(10,"#Ventas"),s(),l(11,"th",43),d(12,"Importe"),s(),l(13,"th",43),d(14,"Costo"),s(),l(15,"th",43),d(16,"Utilidad"),s(),l(17,"th",43),d(18,"%Gan"),s()()(),l(19,"tbody"),N(20,Fk,20,25,"tr",44)(21,Ak,3,0,"tr",22),s(),N(22,Ok,19,23,"tfoot",22),s()()()),i&2){let e=_();c(20),p("ngForOf",e.rowsProductos),c(),p("ngIf",e.rowsProductos.length===0),c(),p("ngIf",e.rowsProductos.length>0&&e.footerProductos)}}var mc=class i{constructor(t,e,n,r,a,o,u){this.fb=t;this.reportes=e;this.farmaciaSrv=n;this.usuarioSrv=r;this.clienteSrv=a;this.productoSrv=o;this.cdr=u}filtroForm;cargando=!1;reportType="clientes";farmacias=[];usuarios=[];clientes=[];catCargados={farmacias:!1,usuarios:!1,clientes:!1};rowsClientes=[];rowsProductos=[];rowsUsuarios=[];productoResueltoNombre="";errorProductoCB="";footerProductos=null;footerUsuarios=null;footerClientes=null;ngOnInit(){let t=this.todayYMD(),e=this.todayYMD();this.filtroForm=this.fb.group({fechaIni:[e,Pe.required],fechaFin:[t,Pe.required],tipo:[this.reportType,Pe.required],farmaciaId:[""],clienteId:[""],cantClientes:[""],ordenClientes:["ventas"],codigoBarras:[""],productoId:[""],cantProductos:[""],ordenProductos:["ventas"],usuarioId:[""],ordenUsuarios:["ventas"]}),this.cargarCatalogos(),this.filtroForm.get("tipo").valueChanges.subscribe(n=>{this.reportType=n}),this.filtroForm.get("productoId")?.valueChanges.subscribe(()=>this.syncCantProductosState()),this.syncCantProductosState()}todayYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}monthStartYMD(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}-01`}collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0,numeric:!0});sortByNombre(t){return[...t].sort((e,n)=>this.collator.compare(e.nombre||"",n.nombre||""))}cargarCatalogos(){this.farmaciaSrv.obtenerFarmacias().subscribe({next:t=>{this.farmacias=[{_id:"",nombre:"TODAS"},...t||[]],this.catCargados.farmacias=!0},error:()=>{this.farmacias=[{_id:"",nombre:"TODAS"}],this.catCargados.farmacias=!0}}),this.usuarioSrv.obtenerUsuarios().subscribe({next:t=>{this.usuarios=t||[],this.catCargados.usuarios=!0},error:()=>{this.usuarios=[],this.catCargados.usuarios=!0}}),this.clienteSrv.getClientes().subscribe({next:t=>{let e=(t||[]).map(r=>({_id:r._id,nombre:r.nombre})),n=this.sortByNombre(e);this.clientes=[{_id:"",nombre:"(Todos)"},...n],this.catCargados.clientes=!0},error:()=>{this.clientes=[],this.catCargados.clientes=!0}})}limpiar(){this.filtroForm.patchValue({fechaIni:this.monthStartYMD(),fechaFin:this.monthStartYMD(),farmaciaId:"",codigoBarras:"",productoId:"",cantProductos:null,ordenProductos:"utilidad",clienteId:"",cantClientes:null,ordenClientes:"utilidad",usuarioId:"",cantUsuarios:null,ordenUsuarios:"utilidad"},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="",this.rowsProductos=[],this.rowsClientes=[],this.rowsUsuarios=[],this.footerProductos=null,this.footerUsuarios=null,this.footerClientes=null,this.footerProductos=null,this.footerClientes=null,this.footerUsuarios=null}buscar(){return Le(this,null,function*(){if(this.cargando)return;if(this.reportType==="productos"){this.rowsProductos=[],this.footerProductos=null;let r=String(this.filtroForm.get("codigoBarras")?.value||"").trim(),a=String(this.filtroForm.get("productoId")?.value||"").trim();r&&!a&&(yield this.resolverProductoPorCB()),String(this.filtroForm.get("productoId")?.value||"").trim()&&this.filtroForm.patchValue({cantProductos:null},{emitEvent:!1})}else this.reportType==="clientes"?(this.rowsClientes=[],this.footerClientes=null):this.reportType==="usuarios"&&(this.rowsUsuarios=[],this.footerUsuarios=null);let t=this.filtroForm.getRawValue(),{fechaIni:e,fechaFin:n}=t;if(!e||!n){pa.default.fire("Faltan datos","Selecciona fecha inicial y final.","warning");return}switch(this.cargando=!0,this.reportType){case"clientes":this.buscarClientes(t);break;case"productos":this.buscarProductos(t);break;case"usuarios":this.buscarUsuarios(t);break}})}buscarClientes(t){let e=t.clienteId||void 0,n=t.ordenClientes||{campo:"utilidad",dir:"desc"};if(!e){let a=parseInt(String(t.cantClientes||"").trim(),10);if(!Number.isFinite(a)||a<=0){this.cargando=!1,pa.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos clientes? \xF3 selecciona un cliente.","warning");return}}let r=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,clienteId:e,CantClientes:e?void 0:t.cantClientes,orden:n.campo,dir:n.dir});this.reportes.getUtilidadPorClientes(r).subscribe({next:a=>{this.rowsClientes=a?.rows||[],this.footerClientes=a?.footer??null,this.cargando=!1,console.log("fotter clientes ",this.footerClientes)},error:a=>{console.error("[Utilidad x clientes][ERROR]",a),this.rowsClientes=[],this.cargando=!1;let o=a?.error?.mensaje||a?.message||"No se pudo consultar Utilidad por clientes.";pa.default.fire("Error",o,"error")}})}buscarProductos(t){let e=t??this.filtroForm.getRawValue(),n=(e.productoId??"").toString().trim()||void 0,r=(e.farmaciaId??"").toString().trim()||void 0,a=e.ordenProductos||{campo:"utilidad",dir:"desc"};if(!n){let u=parseInt(String(e.cantProductos||"").trim(),10);if(!Number.isFinite(u)||u<=0){this.cargando=!1,pa.default.fire("Faltan datos","Ingresa \xBFCu\xE1ntos productos? \xF3 selecciona un producto.","warning");return}}let o=this.cleanParams({fechaIni:e.fechaIni,fechaFin:e.fechaFin,productoId:n,cantProductos:n?void 0:e.cantProductos,orden:a.campo,dir:a.dir,farmaciaId:r});this.reportes.getUtilidadPorProductos(o).subscribe({next:u=>{this.rowsProductos=u?.rows||[],this.footerProductos=u?.footer??null,this.cargando=!1},error:u=>{this.rowsProductos=[],this.footerProductos=null,this.cargando=!1;let m=u?.error?.mensaje||u?.message||"No se pudo consultar Utilidad por productos.";pa.default.fire("Error",m,"error")}})}buscarUsuarios(t){let e=t.usuarioId||void 0,n=t.ordenUsuarios||{campo:"utilidad",dir:"desc"},r=this.cleanParams({fechaIni:t.fechaIni,fechaFin:t.fechaFin,usuarioId:e,orden:n.campo,dir:n.dir});this.reportes.getUtilidadPorUsuarios(r).subscribe({next:a=>{this.rowsUsuarios=a?.rows||[],this.footerUsuarios=a?.footer??null,this.cargando=!1},error:a=>{console.error("[Utilidad x usuarios][ERROR]",a),this.rowsUsuarios=[],this.cargando=!1;let o=a?.error?.mensaje||a?.message||"No se pudo consultar Utilidad por usuarios.";pa.default.fire("Error",o,"error")}})}cleanParams(t){let e={};return Object.entries(t).forEach(([n,r])=>{r!=null&&String(r).trim()!==""&&(e[n]=r)}),e}syncCantProductosState(){let t=(this.filtroForm.get("productoId")?.value||"").toString().trim(),e=this.filtroForm.get("cantProductos");e&&(t?(e.disable({emitEvent:!1}),e.setValue("",{emitEvent:!1})):e.enable({emitEvent:!1}))}resolverProductoPorCB(){return Le(this,null,function*(){this.errorProductoCB="";let t=String(this.filtroForm.value.codigoBarras||"").trim();if(!t){this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.rowsProductos=[],this.footerProductos=null;return}try{let n=(yield Ti(this.productoSrv.buscarPorCodigoBarras(t)))?.producto;n&&n._id?(this.filtroForm.patchValue({productoId:n._id,cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre=n.nombre||"",this.rowsProductos=[],this.footerProductos=null):(this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="No se encontr\xF3 un producto con ese c\xF3digo.")}catch{this.filtroForm.patchValue({productoId:"",cantProductos:null},{emitEvent:!1}),this.productoResueltoNombre="",this.errorProductoCB="Error consultando el producto."}})}static \u0275fac=function(e){return new(e||i)(te(Jt),te(Mn),te(Zt),te(Na),te(wn),te(Zi),te(Wt))};static \u0275cmp=Te({type:i,selectors:[["app-reportes-utilidad"]],decls:39,vars:18,consts:[[1,"container-fluid"],[1,"titulo",2,"text-align","center"],[1,"mb-3",3,"formGroup"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-6"],[1,"form-label","d-block","mb-1"],[1,"d-flex","gap-2","flex-wrap"],[1,"report-chip"],["type","radio","formControlName","tipo","value","clientes"],["type","radio","formControlName","tipo","value","usuarios"],["type","radio","formControlName","tipo","value","productos"],[1,"col-1"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],[1,"col-1","text-end"],["type","button",1,"btn-gris",3,"click","disabled"],[1,"my-3"],["class","row g-2 align-items-end",4,"ngIf"],[4,"ngIf"],[1,"col-md-3"],["formControlName","usuarioId",1,"form-select",3,"disabled"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["formControlName","ordenUsuarios",1,"form-select",3,"disabled"],[3,"ngValue"],[1,"col-md-4"],["formControlName","clienteId",1,"form-select",3,"disabled"],["type","number","min","1","formControlName","cantClientes",1,"form-control",3,"disabled"],["formControlName","ordenClientes",1,"form-select",3,"disabled"],["formControlName","farmaciaId",1,"form-select",3,"disabled"],["type","text","formControlName","codigoBarras","placeholder","Escanea o escribe el c\xF3digo",1,"form-control",3,"keyup.enter","disabled"],["class","text-danger small",4,"ngIf"],[1,"col-md-5"],["type","text","placeholder","Se llenar\xE1 al resolver el c\xF3digo","readonly","",1,"form-control",3,"value"],["type","number","min","1","formControlName","cantProductos",1,"form-control",3,"disabled"],["formControlName","ordenProductos",1,"form-select",3,"disabled"],[1,"text-danger","small"],[1,"table-responsive"],[1,"tabla"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"text-end","text-success"],[1,"text-end","text-negativo"],[1,"text-end",3,"ngClass"],["colspan","11",1,"text-center","text-muted"],[1,"table-light"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["colspan","12",1,"text-center","text-muted"],["colspan","7",1,"text-center","text-muted"],["colspan","2",1,"text-end"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h3",1),d(2,"Reportes Tops de utilidades"),s(),l(3,"form",2)(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Fecha inicial"),s(),y(8,"input",6),s(),l(9,"div",4)(10,"label",5),d(11,"Fecha final"),s(),y(12,"input",7),s(),l(13,"div",8)(14,"label",9),d(15,"Reporte:"),s(),l(16,"div",10)(17,"label",11),y(18,"input",12),d(19," Utilidad por clientes "),s(),l(20,"label",11),y(21,"input",13),d(22," Utilidad por usuarios "),s(),l(23,"label",11),y(24,"input",14),d(25," Utilidad por productos "),s()()(),l(26,"div",15)(27,"button",16),E("click",function(){return n.limpiar()}),y(28,"i",17),s()(),l(29,"div",18)(30,"button",19),E("click",function(){return n.buscar()}),d(31),s()()(),y(32,"hr",20),N(33,gk,20,11,"div",21)(34,vk,24,12,"div",21)(35,yk,33,15,"div",21),s(),N(36,Ek,31,3,"div",22)(37,Mk,33,3,"div",22)(38,Dk,23,3,"div",22),s()),e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(5),Re("active",n.filtroForm.value.tipo==="clientes"),c(3),Re("active",n.filtroForm.value.tipo==="usuarios"),c(3),Re("active",n.filtroForm.value.tipo==="productos"),c(4),p("disabled",n.cargando),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Consultando\u2026":"Buscar"," "),c(2),p("ngIf",n.reportType==="usuarios"),c(),p("ngIf",n.reportType==="clientes"),c(),p("ngIf",n.reportType==="productos"),c(),p("ngIf",n.reportType==="usuarios"),c(),p("ngIf",n.reportType==="clientes"),c(),p("ngIf",n.reportType==="productos"))},dependencies:[Ae,si,We,Be,Ct,Bt,Ft,it,nt,Xe,Gt,tt,Er,ze,Mt,Bi,ci,di,Lt,ut],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.text-positivo[_ngcontent-%COMP%]{color:#325301}.text-negativo[_ngcontent-%COMP%]{color:red}.report-chip[_ngcontent-%COMP%]{border:1px solid #d0d7de;border-radius:9999px;padding:.375rem .75rem;cursor:pointer;-webkit-user-select:none;user-select:none;display:inline-flex;align-items:center;gap:.5rem;transition:all .15s ease-in-out}.report-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.report-chip[_ngcontent-%COMP%]:hover{background:#a5d1fa}.report-chip.active[_ngcontent-%COMP%]{border-color:#0d6efd;background:#e7f1ff;color:#0d6efd;font-weight:600;box-shadow:0 0 0 2px #0d6efd26 inset}"]})};var Rk=["paginator"],Nk=()=>["detail"],Bk=()=>[15,30,50,100];function Lk(i,t){if(i&1){let e=ie();l(0,"button",42),E("click",function(){T(e);let r=_();return P(r.limpiarProveedor())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Vk(i,t){if(i&1){let e=ie();l(0,"button",44),E("click",function(){T(e);let r=_();return P(r.limpiarProducto())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Uk(i,t){if(i&1){let e=ie();l(0,"button",45),E("click",function(){T(e);let r=_();return P(r.limpiarCodigo())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function jk(i,t){if(i&1){let e=ie();l(0,"button",46),E("click",function(){T(e);let r=_();return P(r.limpiarDesde())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Wk(i,t){if(i&1){let e=ie();l(0,"button",47),E("click",function(){T(e);let r=_();return P(r.limpiarHasta())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function Hk(i,t){if(i&1){let e=ie();l(0,"button",48),E("click",function(){T(e);let r=_();return P(r.limpiarIni())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function zk(i,t){if(i&1){let e=ie();l(0,"button",49),E("click",function(){T(e);let r=_();return P(r.limpiarFin())}),y(1,"fa-icon",43),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function $k(i,t){i&1&&(l(0,"th",50),d(1,"Det."),s())}function Gk(i,t){if(i&1){let e=ie();l(0,"td",51)(1,"button",52),E("click",function(){let r=T(e).$implicit,a=_();return P(a.toggleDetalle(r))}),l(2,"mat-icon"),d(3),s()()()}if(i&2){let e=t.$implicit,n=_();c(),p("matTooltip",n.expandedId===e.compraId?"Ocultar detalle":"Ver detalle"),c(2),k(n.expandedId===e.compraId?"expand_less":"expand_more")}}function qk(i,t){i&1&&y(0,"td",53)}function Xk(i,t){i&1&&(l(0,"th",50),d(1,"Fecha"),s())}function Kk(i,t){if(i&1&&(l(0,"td",51),d(1),F(2,"date"),s()),i&2){let e=t.$implicit;c(),k(Y(2,1,e.fecha,"dd/MM/yyyy HH:mm"))}}function Yk(i,t){i&1&&y(0,"td",53)}function Qk(i,t){i&1&&(l(0,"th",50),d(1,"Proveedor"),s())}function Jk(i,t){if(i&1&&(l(0,"td",51),d(1),s()),i&2){let e=t.$implicit;c(),k(e.proveedor)}}function Zk(i,t){i&1&&(l(0,"td",54)(1,"strong"),d(2,"Gran Total ==>"),s()())}function eI(i,t){i&1&&(l(0,"th",55),d(1,"Total"),s())}function tI(i,t){if(i&1&&(l(0,"td",56),d(1),F(2,"number"),s()),i&2){let e=t.$implicit;c(),R(" $",Y(2,1,e.total,"1.2-2")," ")}}function iI(i,t){if(i&1&&(l(0,"td",57),d(1),F(2,"currency"),s()),i&2){let e=_();c(),R(" ",Im(2,1,(e.footer==null?null:e.footer.totalCompras)||0,"MXN","symbol-narrow","1.2-2")," ")}}function nI(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),s(),l(3,"td"),d(4),s(),l(5,"td",60),d(6),F(7,"number"),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),F(12,"date"),s(),l(13,"td",60),d(14),F(15,"number"),s(),l(16,"td",60),d(17),F(18,"number"),s()()),i&2){let e=t.$implicit;c(2),k(e.nombre),c(2),k(e.codigoBarras),c(2),k(oe(7,7,e.cantidad)),c(3),k(e.lote),c(2),k(Y(12,9,e.fechaCaducidad,"dd/MM/yyyy")),c(3),R("$",Y(15,12,e.costoUnitario,"1.2-2"),""),c(3),R("$",Y(18,15,e.precioUnitario,"1.2-2"),"")}}function rI(i,t){i&1&&(l(0,"tr")(1,"td",62),d(2,"Sin productos en esta compra."),s()())}function aI(i,t){if(i&1&&(l(0,"td",51)(1,"div",58)(2,"table",59)(3,"thead")(4,"tr")(5,"th"),d(6,"Producto"),s(),l(7,"th"),d(8,"C\xF3digo de Barras"),s(),l(9,"th",60),d(10,"Cantidad"),s(),l(11,"th"),d(12,"Lote"),s(),l(13,"th"),d(14,"Caducidad"),s(),l(15,"th",60),d(16,"Costo U."),s(),l(17,"th",60),d(18,"Precio U."),s()()(),l(19,"tbody"),N(20,nI,19,18,"tr",61)(21,rI,3,0,"tr",40),s()()()()),i&2){let e=t.$implicit,n=_();Je("colspan",n.displayedColumns.length),c(20),p("ngForOf",e.productos)("ngForTrackBy",n.trackByProd),c(),p("ngIf",!e.productos||e.productos.length===0)}}function oI(i,t){i&1&&y(0,"tr",63)}function sI(i,t){i&1&&y(0,"tr",64)}function lI(i,t){i&1&&y(0,"tr",64)}function cI(i,t){if(i&1&&y(0,"tr",65),i&2){let e=_();Ri("display",e.rows.length?"":"none")}}function dI(i,t){if(i&1&&(l(0,"tr")(1,"td",66),d(2," Sin resultados en el rango/criterios seleccionados. "),s()()),i&2){let e=_();c(),Je("colspan",e.displayedColumns.length)}}function uI(){let i=new y0;return i.itemsPerPageLabel="Compras por p\xE1gina:",i.nextPageLabel="Siguiente",i.previousPageLabel="Anterior",i.firstPageLabel="Inicio",i.lastPageLabel="Fin",i.getRangeLabel=(t,e,n)=>{if(n===0||e===0)return`0 de ${n}`;let r=t*e+1,a=Math.min(r+e-1,n);return`${r} \u2013 ${a} de ${n}`},i}var fc=class i{constructor(t,e,n){this.comprasSrv=t;this.cdr=e;this.library=n;n.addIcons(_i)}proveedor="";importeDesde=null;importeHasta=null;fechaIni="";fechaFin="";productoNombre="";codigoBarras="";rows=[];displayedColumns=["acciones","fecha","proveedor","total"];table;isDetailRow=(t,e)=>this.expandedId===e.compraId;page=1;limit=15;paginacion={total:0,page:1,limit:15};cargando=!1;expandedId=null;paginator;faTimes=_i;footer=null;ngOnInit(){this.setFechasPorDefecto(),this.buscar(!0)}toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(t)}getFechaFinExclusiveISO(){let t=new Date(this.fechaFin);return t.setDate(t.getDate()+1),this.toLocalISODate(t)}limpiarFiltros(){this.proveedor="",this.importeDesde=null,this.importeHasta=null,this.setFechasPorDefecto(),this.productoNombre="",this.codigoBarras="",this.page=1,this.buscar(!0)}limpiarCodigo(){this.codigoBarras="",this.buscar(!0)}limpiarIni(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e)}limpiarFin(){let t=new Date;this.fechaFin=this.toLocalISODate(t)}limpiarDesde(){this.importeDesde=null,this.buscar(!0)}limpiarHasta(){this.importeHasta=null,this.buscar(!0)}limpiarProveedor(){this.proveedor="",this.buscar(!0)}limpiarProducto(){this.productoNombre="",this.buscar(!0)}buscar(t=!1){t&&(this.page=1);let e={page:this.page,limit:this.limit};this.fechaIni&&(e.fechaIni=this.fechaIni),this.fechaFin&&(e.fechaFin=this.fechaFin),this.proveedor&&(e.proveedor=this.proveedor.trim()),this.importeDesde!==null&&this.importeDesde!==void 0&&this.importeDesde!==""&&(e.importeDesde=this.importeDesde),this.importeHasta!==null&&this.importeHasta!==void 0&&this.importeHasta!==""&&(e.importeHasta=this.importeHasta),this.productoNombre?.trim()&&(e.productoNombre=this.productoNombre.trim()),this.codigoBarras?.trim()&&(e.codigoBarras=this.codigoBarras.trim()),this.cargando=!0,this.expandedId=null,this.comprasSrv.listar(e).subscribe({next:n=>{let r=n?.rows??[],a=n?.paginacion?.total??r.length,o=n?.paginacion?.page??this.page,u=n?.paginacion?.limit??this.limit;this.rows=r,this.paginacion={total:a,page:o,limit:u},this.limit=u,this.page=o,this.footer=n?.footer??null,this.cargando=!1,this.cdr.detectChanges(),this.table?.renderRows()},error:n=>{this.rows=[],this.paginacion={total:0,page:1,limit:this.limit},this.cargando=!1}})}cambioPagina(t){let e=t.pageSize!==this.limit;this.limit=t.pageSize,this.page=e?1:t.pageIndex+1,this.expandedId=null,this.buscar(!1)}toggleDetalle(t){this.expandedId=this.expandedId===t.compraId?null:t.compraId,this.table?.renderRows()}trackByCompra=(t,e)=>e.compraId;trackByProd=(t,e)=>`${e.codigoBarras}-${e.lote}-${e.fechaCaducidad}`;static \u0275fac=function(e){return new(e||i)(te(oo),te(Wt),te(bi))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-compras"]],viewQuery:function(e,n){if(e&1&&(Ot(tl,5),Ot(Rk,5)),e&2){let r;St(r=wt())&&(n.table=r.first),St(r=wt())&&(n.paginator=r.first)}},features:[Kr([{provide:y0,useFactory:uI}])],decls:83,vars:33,consts:[[1,"filtros"],[1,"titulo","text-center"],[1,"row","mb-3"],[1,"col-3"],[2,"white-space","nowrap"],[1,"position-relative"],["type","text","placeholder","Nombre del proveedor",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar proveedor",3,"click",4,"ngIf"],["type","text","placeholder","Nombre del producto",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar producto",3,"click",4,"ngIf"],[1,"col-2"],["type","text","placeholder","C\xF3digo de barras",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar c\xF3d. barras",3,"click",4,"ngIf"],["type","number",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe desde",3,"click",4,"ngIf"],["type","button","style","margin-right: 2rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar importe hasta",3,"click",4,"ngIf"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha inicial",3,"click",4,"ngIf"],["type","button","style","margin-right: 2.5rem;","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico","matTooltip","Limpiar fecha final",3,"click",4,"ngIf"],[1,"col-4",2,"text-align","start","margin-top","1rem"],[1,"btn-rojo",3,"click","disabled"],[1,"col-4",2,"text-align","end","height","min-content","margin-top","1rem"],[1,"btn-gris",3,"click","disabled"],["mat-table","","multiTemplateDataRows","",1,"tabla",3,"dataSource"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","fecha"],["matColumnDef","proveedor"],["mat-footer-cell","","class","text-end",4,"matFooterCellDef"],["matColumnDef","total"],["mat-header-cell","","class","text-end",4,"matHeaderCellDef"],["mat-cell","","class","text-end fw-600",4,"matCellDef"],["mat-footer-cell","","class","text-end fw-700",4,"matFooterCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefTrackBy"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-footer-row","",3,"display",4,"matFooterRowDef"],[4,"ngIf"],[1,"paginator-custom",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],["type","button","matTooltip","Limpiar proveedor",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],["type","button","matTooltip","Limpiar producto",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar c\xF3d. barras",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","button","matTooltip","Limpiar importe desde",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar importe hasta",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2rem",3,"click"],["type","button","matTooltip","Limpiar fecha inicial",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["type","button","matTooltip","Limpiar fecha final",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",2,"margin-right","2.5rem",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click","matTooltip"],["mat-footer-cell",""],["mat-footer-cell","",1,"text-end"],["mat-header-cell","",1,"text-end"],["mat-cell","",1,"text-end","fw-600"],["mat-footer-cell","",1,"text-end","fw-700"],[1,"detalle-tabla-wrapper"],[1,"detalle-tabla"],[1,"text-end"],[4,"ngFor","ngForOf","ngForTrackBy"],["colspan","7",1,"text-center","text-muted"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],[1,"text-center","text-muted","p-2"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"h2",1),d(2,"Reporte General de Compras"),s(),l(3,"div",2)(4,"div",3)(5,"label",4),d(6,"Proveedor"),s(),l(7,"div",5)(8,"input",6),Z("ngModelChange",function(a){return J(n.proveedor,a)||(n.proveedor=a),a}),E("keyup.enter",function(){return n.buscar(!0)}),s(),N(9,Lk,2,1,"button",7),s()(),l(10,"div",3)(11,"label",4),d(12,"Producto"),s(),l(13,"div",5)(14,"input",8),Z("ngModelChange",function(a){return J(n.productoNombre,a)||(n.productoNombre=a),a}),E("keyup.enter",function(){return n.buscar(!0)}),s(),N(15,Vk,2,1,"button",9),s()(),l(16,"div",10)(17,"label",4),d(18,"C\xF3digo de barras"),s(),l(19,"div",5)(20,"input",11),Z("ngModelChange",function(a){return J(n.codigoBarras,a)||(n.codigoBarras=a),a}),E("keyup.enter",function(){return n.buscar(!0)}),s(),N(21,Uk,2,1,"button",12),s()(),l(22,"div",10)(23,"label",4),d(24,"Importe desde"),s(),l(25,"div",5)(26,"input",13),Z("ngModelChange",function(a){return J(n.importeDesde,a)||(n.importeDesde=a),a}),E("keyup.enter",function(){return n.buscar(!0)}),s(),N(27,jk,2,1,"button",14),s()(),l(28,"div",10)(29,"label",4),d(30,"Importe hasta"),s(),l(31,"div",5)(32,"input",13),Z("ngModelChange",function(a){return J(n.importeHasta,a)||(n.importeHasta=a),a}),E("keyup.enter",function(){return n.buscar(!0)}),s(),N(33,Wk,2,1,"button",15),s()()(),l(34,"div",2)(35,"div",10)(36,"label",4),d(37,"Fecha inicial"),s(),l(38,"div",5)(39,"input",16),Z("ngModelChange",function(a){return J(n.fechaIni,a)||(n.fechaIni=a),a}),E("change",function(){return n.buscar(!0)}),s(),N(40,Hk,2,1,"button",17),s()(),l(41,"div",10)(42,"label",4),d(43,"Fecha final"),s(),l(44,"div",5)(45,"input",16),Z("ngModelChange",function(a){return J(n.fechaFin,a)||(n.fechaFin=a),a}),E("change",function(){return n.buscar(!0)}),s(),N(46,zk,2,1,"button",18),s()(),l(47,"div",19)(48,"button",20),E("click",function(){return n.limpiarFiltros()}),l(49,"mat-icon"),d(50,"clear"),s(),d(51,"\xA0Limpiar "),s()(),l(52,"div",21)(53,"button",22),E("click",function(){return n.buscar(!0)}),l(54,"mat-icon"),d(55,"search"),s(),d(56,"\xA0Buscar "),s()()()(),l(57,"div")(58,"table",23),at(59,24),N(60,$k,2,0,"th",25)(61,Gk,4,2,"td",26)(62,qk,1,0,"td",27),ot(),at(63,28),N(64,Xk,2,0,"th",25)(65,Kk,3,4,"td",26)(66,Yk,1,0,"td",27),ot(),at(67,29),N(68,Qk,2,0,"th",25)(69,Jk,2,1,"td",26)(70,Zk,3,0,"td",30),ot(),at(71,31),N(72,eI,2,0,"th",32)(73,tI,3,4,"td",33)(74,iI,3,6,"td",34),ot(),at(75,35),N(76,aI,22,4,"td",26),ot(),N(77,oI,1,0,"tr",36)(78,sI,1,0,"tr",37)(79,lI,1,0,"tr",38)(80,cI,1,2,"tr",39)(81,dI,3,1,"tr",40),s()(),l(82,"mat-paginator",41),E("page",function(a){return n.cambioPagina(a)}),s()),e&2&&(c(8),Q("ngModel",n.proveedor),c(),p("ngIf",n.proveedor),c(5),Q("ngModel",n.productoNombre),c(),p("ngIf",n.productoNombre),c(5),Q("ngModel",n.codigoBarras),c(),p("ngIf",n.codigoBarras),c(5),Q("ngModel",n.importeDesde),c(),p("ngIf",n.importeDesde),c(5),Q("ngModel",n.importeHasta),c(),p("ngIf",n.importeHasta),c(6),Q("ngModel",n.fechaIni),c(),p("ngIf",n.fechaIni),c(5),Q("ngModel",n.fechaFin),c(),p("ngIf",n.fechaFin),c(2),p("disabled",n.cargando),c(5),p("disabled",n.cargando),c(4),Re("loading",n.cargando),c(),p("dataSource",n.rows),c(19),p("matHeaderRowDef",n.displayedColumns),c(),p("matRowDefColumns",n.displayedColumns)("matRowDefTrackBy",n.trackByCompra),c(),p("matRowDefColumns",Qt(31,Nk))("matRowDefWhen",n.isDetailRow),c(),p("matFooterRowDef",n.displayedColumns),c(),p("ngIf",!n.cargando&&n.rows.length===0),c(),p("length",n.paginacion.total||0)("pageSize",n.limit)("pageIndex",n.page-1)("pageSizeOptions",Qt(32,Bk))("showFirstLastButtons",!0))},dependencies:[Ae,We,Be,Ct,Nt,Rt,rt,Xe,Gt,ze,_t,Jf,tl,Uf,Gf,Wf,Vf,Xf,jf,qf,Hf,$f,zf,Kf,Qf,Yf,ip,tp,ti,ei,ep,Zf,Yn,kr,Lt,ut],styles:["[_nghost-%COMP%]     .mat-mdc-paginator{background:#f5fbff;box-shadow:0 2px 6px #0000000f}[_nghost-%COMP%]     .mat-mdc-icon-button{width:3.25rem;height:3.25rem;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .15s ease,transform .05s}[_nghost-%COMP%]     .mat-mdc-icon-button:hover{background:#8a2be2}[_nghost-%COMP%]     .mat-mdc-paginator-icon{fill:#0ff;width:3.25rem;height:3.25rem}[_nghost-%COMP%]     .mat-mdc-paginator-range-actions .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:#cbd5e1}[_nghost-%COMP%]     .mat-mdc-paginator-page-size .mat-mdc-select-value-text{font-size:1.3rem;color:#8a2be2;line-height:1.1}.paginator-custom[_ngcontent-%COMP%]{background-color:#fbdddd}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-page-size-label{font-size:1.3rem;color:#8a2be2;letter-spacing:.2px;margin-right:.5rem;line-height:1.1}[_nghost-%COMP%]     .paginator-custom .mat-mdc-paginator-range-label{font-size:1.3rem;color:#8a2be2}[_nghost-%COMP%]     .paginator-custom .mat-mdc-select-trigger, [_nghost-%COMP%]     .paginator-custom .mat-mdc-select-value-text{font-size:1.05rem;color:#8a2be2}"]})};var Ng=()=>{let i=je(dt),t=new qe({"x-auth-token":localStorage.getItem("auth_token")||""}),e=Ge.apiUrl,n=["Cliente cambi\xF3 de opini\xF3n","Error en la receta m\xE9dica","Presentaci\xF3n incorrecta","Cantidad err\xF3nea entregada","Producto duplicado en la venta","Precio incorrecto en ticket","Producto caducado","Producto en mal estado","Producto no surtible","Error en producto entregado"];return vm({farmacias:i.get(`${e}/farmacias`,{headers:t}).pipe(xt(r=>r?.data||r||[])),usuarios:i.get(`${e}/usuarios`,{headers:t}).pipe(xt(r=>r?.data||r||[])),motivos:lt(n)})};var pc=class i{constructor(t){this.http=t}base=`${Ge.apiUrl}/reportes`;headers(){return new qe({"x-auth-token":localStorage.getItem("auth_token")||""})}buildParams(t){let e=new Ht;return Object.entries(t).forEach(([n,r])=>{if(r==null)return;let a=String(r).trim();a!==""&&(e=e.set(n,a))}),e}getHistorial(t){return this.http.get(`${this.base}/compras-historial-producto`,{headers:this.headers(),params:this.buildParams(t)})}searchProductos(t){let e=`${Ge.apiUrl}/productos/search?q=${encodeURIComponent(t)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(xt(n=>n?.data??n?.rows??n??[]),Pi(()=>lt([])))}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var fI=()=>({standalone:!0});function pI(i,t){if(i&1){let e=ie();l(0,"button",39),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.selectProd(r))}),l(1,"div",40),d(2),s(),l(3,"small",41),d(4),s()()}if(i&2){let e=t.$implicit;c(2),k(e.nombre||"(sin nombre)"),c(2),R("CB: ",e.codigoBarras||"\u2014","")}}function hI(i,t){if(i&1&&(l(0,"div",37),N(1,pI,5,2,"button",38),s()),i&2){let e=_();c(),p("ngForOf",e.prodOpts)}}function gI(i,t){if(i&1&&(l(0,"span"),d(1),s()),i&2){let e=_(2);c(),R("\xB7 ",e.prodSel.codigoBarras,"")}}function _I(i,t){if(i&1){let e=ie();l(0,"div",42)(1,"span",43),d(2),N(3,gI,2,1,"span",35),s(),l(4,"button",44),E("click",function(){T(e);let r=_(),a=$t(17);return P(r.clearProd(a))}),d(5,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.prodSel.nombre," "),c(),p("ngIf",e.prodSel.codigoBarras)}}function vI(i,t){if(i&1&&(l(0,"option",45),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function xI(i,t){if(i&1&&(l(0,"option",45),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function bI(i,t){i&1&&(l(0,"span"),d(1,"\u25B2"),s())}function yI(i,t){i&1&&(l(0,"span"),d(1,"\u25BC"),s())}function CI(i,t){if(i&1&&(at(0),N(1,bI,2,0,"span",35)(2,yI,2,0,"span",35),ot()),i&2){let e=_(3);c(),p("ngIf",e.dir==="asc"),c(),p("ngIf",e.dir==="desc")}}function SI(i,t){i&1&&(at(0),l(1,"span",41),d(2,"\u21C5"),s(),ot())}function wI(i,t){if(i&1&&(l(0,"span",49),N(1,CI,3,2,"ng-container",35)(2,SI,3,0,"ng-container",35),s()),i&2){let e=_().$implicit,n=_();c(),p("ngIf",n.orden===e.key),c(),p("ngIf",n.orden!==e.key)}}function EI(i,t){if(i&1){let e=ie();l(0,"th",46),E("click",function(){let r=T(e).$implicit,a=_();return P(a.onHeaderClick(r))}),l(1,"div",47)(2,"span"),d(3),s(),N(4,wI,3,2,"span",48),s()()}if(i&2){let e=t.$implicit,n=_();Re("sortable",e.label!=="CB"),Je("aria-sort",n.orden===e.key?n.dir==="asc"?"ascending":"descending":"none"),c(3),k(e.label),c(),p("ngIf",e.label!=="CB")}}function TI(i,t){if(i&1&&(l(0,"td"),d(1),s()),i&2){let e=t.$implicit,n=_().$implicit,r=_();Re("text-end",e.right),c(),R(" ",r.formatCell(e,n)," ")}}function PI(i,t){if(i&1&&(l(0,"tr"),N(1,TI,2,3,"td",50),s()),i&2){let e=_();c(),p("ngForOf",e.headers)}}function kI(i,t){if(i&1&&(l(0,"tr")(1,"td",51),d(2,"Sin datos"),s()()),i&2){let e=_();c(),Je("colspan",e.headers.length)}}function II(i,t){if(i&1&&(l(0,"tfoot")(1,"tr",40)(2,"td",52),d(3),F(4,"number"),s(),l(5,"td",53),d(6),F(7,"currency"),s(),l(8,"td",53),d(9),F(10,"number"),s(),l(11,"td",53),d(12),F(13,"currency"),s(),l(14,"td",53),d(15),F(16,"currency"),s()()()),i&2){let e,n,r,a,o,u=t.ngIf;c(3),R("Num. de Compras: ",Y(4,5,(e=u.compras)!==null&&e!==void 0?e:0,"1.0-0")," "),c(3),R(" Prom. ",oe(7,8,(n=u.costoUnitProm)!==null&&n!==void 0?n:0)," "),c(3),R(" ",Y(10,10,(r=u.piezas)!==null&&r!==void 0?r:0,"1.0-0")," "),c(3),R(" ",oe(13,13,(a=u.costoTotal)!==null&&a!==void 0?a:0)," "),c(3),R(" Prom. ",oe(16,15,(o=u.precioUnitProm)!==null&&o!==void 0?o:0)," ")}}function MI(i,t){if(i&1){let e=ie();l(0,"nav",54)(1,"ul",55)(2,"li")(3,"button",56),E("click",function(){T(e);let r=_();return P(r.goFirst())}),y(4,"i",57),s()(),l(5,"li")(6,"button",58),E("click",function(){T(e);let r=_();return P(r.goPrev())}),y(7,"i",59),s()(),l(8,"li",60)(9,"span"),d(10),s()(),l(11,"li")(12,"button",61),E("click",function(){T(e);let r=_();return P(r.goNext())}),y(13,"i",62),s()(),l(14,"li")(15,"button",63),E("click",function(){T(e);let r=_();return P(r.goLast())}),y(16,"i",64),s()()()()}if(i&2){let e=_();c(2),Re("disabled",!e.canPrev()),c(),p("disabled",!e.canPrev()),c(2),Re("disabled",!e.canPrev()),c(),p("disabled",!e.canPrev()),c(4),fn(" P\xE1gina: ",e.page," de ",e.totalPages,""),c(),Re("disabled",!e.canNext()),c(),p("disabled",!e.canNext()),c(2),Re("disabled",!e.canNext()),c(),p("disabled",!e.canNext())}}var hc=class i{constructor(t,e,n,r){this.fb=t;this.svc=e;this.proveedorService=n;this.usuarioService=r}filtroForm;cargando=!1;resp=null;rows=[];columns=[];footer=null;prodSel=null;prodOpts=[];prodInput$=new yt;subs=[];orden="fecha";dir="desc";page=1;limit=20;proveedores=[];usuarios=[];headers=[{label:"Fecha",key:"fecha",date:!0},{label:"Proveedor",key:"proveedor"},{label:"Producto",key:"producto"},{label:"CB",key:"precioUnitario"},{label:"Lote",key:"lote"},{label:"Caducidad",key:"fechaCaducidad",date:!0},{label:"Costo Unit.",key:"costoUnitario",right:!0,money:!0},{label:"Cantidad",key:"cantidad",right:!0},{label:"Costo Total",key:"costoTotal",right:!0,money:!0},{label:"Precio Unit.",key:"precioUnitario",right:!0,money:!0}];toYmdLocal(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}money=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",maximumFractionDigits:2});num=new Intl.NumberFormat("es-MX",{maximumFractionDigits:2});ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.filtroForm=this.fb.group({fechaIni:[this.toYmdLocal(e)],fechaFin:[this.toYmdLocal(t)],productoId:[""],q:[""],cb:[""],proveedorId:[""],usuarioId:[""],lote:[""],cadIni:[""],cadFin:[""]}),this.subs.push(this.prodInput$.pipe(xt(n=>(n||"").trim()),dn(180),un(),Ui(n=>n.length<2?lt([]):this.svc.searchProductos(n))).subscribe(n=>this.prodOpts=Array.isArray(n)?n:[])),this.cargarProveedores(),this.cargarUsuarios(),this.buscar()}ngOnDestroy(){this.subs.forEach(t=>t.unsubscribe())}cargarProveedores(){this.proveedorService.obtenerProveedores().subscribe(t=>{this.proveedores=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||"(sin nombre)"})).sort((e,n)=>e.nombre.localeCompare(n.nombre,"es",{sensitivity:"base"}))})}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe(t=>{this.usuarios=(t||[]).map(e=>({_id:e._id,nombre:e.nombre||e.usuario||"(sin nombre)"})).sort((e,n)=>(e.nombre||"").localeCompare(n.nombre||"","es",{sensitivity:"base"}))})}formatCell(t,e){let n=t.label==="CB"?e.codigoBarras??"":e[t.key];if(n==null)return"\u2014";if(t.date)try{return new Date(n).toLocaleDateString("es-MX")}catch{return"\u2014"}return t.money?this.money.format(+n||0):typeof n=="number"?this.num.format(n):String(n)}onHeaderClick(t){t.label!=="CB"&&(this.orden===t.key?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t.key,this.dir="desc"),this.buscar(!0))}exportCsv(){let t=this.headers.map(h=>h.label),e=(this.rows||[]).map(h=>this.headers.map(g=>this.formatCell(g,h))),n=[t,...e].map(h=>h.map(f).join(",")).join(`\r
`),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(r);a.href=o;let u=this.filtroForm.value.fechaIni??"",m=this.filtroForm.value.fechaFin??"";a.download=`historial_producto_${u}_${m}.csv`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o);function f(h){let g=(h??"").toString();return/[",\r\n]/.test(g)?`"${g.replace(/"/g,'""')}"`:g}}onProdInput(t){this.prodInput$.next((t||"").trim())}selectProd(t){this.prodSel=t,this.prodOpts=[],this.filtroForm.patchValue({productoId:t?._id||"",q:"",cb:t?.codigoBarras||""})}clearProd(t){this.prodSel=null,this.filtroForm.patchValue({productoId:"",q:"",cb:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}buscar(t=!0){if(this.cargando)return;t&&(this.page=1),this.cargando=!0;let e=this.filtroForm.getRawValue(),n=jt(Qe({},e),{orden:this.orden,dir:this.dir,page:this.page,limit:this.limit});this.svc.getHistorial(n).subscribe({next:r=>{this.resp=r,this.rows=r?.rows||[],this.columns=r?.columns||[],this.page=r?.page??this.page,this.limit=r?.limit??this.limit,console.log("Respuesta: ",this.resp),this.cargando=!1},error:()=>{this.cargando=!1}})}sortBy(t){this.orden===t?this.dir=this.dir==="asc"?"desc":"asc":(this.orden=t,this.dir="desc"),this.buscar(!1)}get totalPages(){let t=this.resp?.pages??0;return t>0?t:0}get totalRows(){return this.resp?.total??this.rows?.length??0}canPrev(){return this.page>1}canNext(){return this.page<this.totalPages}changePage(t){this.cargando||t<1||t>this.totalPages||t===this.page||(this.page=t,this.buscar(!1))}goFirst(){this.canPrev()&&this.changePage(1)}goPrev(){this.canPrev()&&this.changePage(this.page-1)}goNext(){this.canNext()&&this.changePage(this.page+1)}goLast(){this.canNext()&&this.changePage(this.totalPages)}limpiar(t){let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1);this.filtroForm.patchValue({fechaIni:this.toYmdLocal(n),fechaFin:this.toYmdLocal(e),productoId:"",q:"",cb:"",proveedorId:"",usuarioId:"",lote:"",cadIni:"",cadFin:""}),this.columns=[],this.rows=[],this.resp=null,this.footer=null,this.prodSel=null,this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0}))),this.page=1,this.orden="fecha",this.dir="desc",this.buscar()}isMoney(t){return["costoUnitario","costoTotal","precioUnitario"].includes(t)}static \u0275fac=function(e){return new(e||i)(te(Jt),te(pc),te(el),te(Na))};static \u0275cmp=Te({type:i,selectors:[["app-historial-producto-page"]],decls:78,vars:27,consts:[["prodInput",""],[1,"container-fluid"],[1,"titulo","text-center"],[3,"formGroup"],[1,"row","g-2","align-items-end","filtros"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],[1,"col-md-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo de barras",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1 d-flex align-items-center gap-2 flex-wrap",4,"ngIf"],["type","hidden","formControlName","productoId"],[1,"col-md-3"],["formControlName","proveedorId",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuarioId",1,"form-select",3,"disabled"],[1,"row","mt-3"],["formControlName","lote","placeholder","Contiene...",1,"form-control",3,"disabled"],["type","date","formControlName","cadIni",1,"form-control",3,"disabled"],["type","date","formControlName","cadFin",1,"form-control",3,"disabled"],[1,"form-select",3,"ngModelChange","change","ngModel","ngModelOptions","disabled"],[3,"ngValue"],[1,"col-auto","ms-auto",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],["type","button",1,"btn-gris",2,"margin-left","8rem",3,"click"],[1,"d-flex","justify-content-end","mb-2","mt-2"],[1,"btn-amarillo",3,"click","disabled"],[1,"table-responsive"],[1,"tabla","w-100"],[3,"sortable","click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-2 paginacion",4,"ngIf"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1","d-flex","align-items-center","gap-2","flex-wrap"],[1,"badge","bg-success-subtle","text-success","border","mb-0"],["type","button",1,"btn","btn-link","btn-sm","p-0",3,"click"],[3,"value"],[3,"click"],[1,"d-flex","align-items-center","gap-1"],["class","sort-icon",4,"ngIf"],[1,"sort-icon"],[3,"text-end",4,"ngFor","ngForOf"],[1,"text-center","text-muted"],["colspan","6",1,"text-end"],[1,"text-end"],[1,"mt-2","paginacion"],[1,"pagination","pagination-sm","mb-0","justify-content-center"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[2,"margin-top","0.5rem","margin-left","10px","margin-right","10px"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"]],template:function(e,n){if(e&1){let r=ie();l(0,"div",1)(1,"h4",2),d(2,"Historial de compras por producto"),s(),l(3,"form",3)(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Fecha inicio"),s(),y(8,"input",7),s(),l(9,"div",5)(10,"label",6),d(11,"Fecha fin"),s(),y(12,"input",8),s(),l(13,"div",9)(14,"label",6),d(15,"Producto"),s(),l(16,"input",10,0),E("input",function(o){return T(r),P(n.onProdInput(o.target.value))}),s(),N(18,hI,2,1,"div",11)(19,_I,6,2,"div",12),y(20,"input",13),s(),l(21,"div",14)(22,"label",6),d(23,"Proveedor"),s(),l(24,"select",15)(25,"option",16),d(26,"(Todos)"),s(),N(27,vI,2,2,"option",17),s()(),l(28,"div",5)(29,"label",6),d(30,"Usuario"),s(),l(31,"select",18)(32,"option",16),d(33,"(Todos)"),s(),N(34,xI,2,2,"option",17),s()(),l(35,"div",19)(36,"div",5)(37,"label",6),d(38,"Lote"),s(),y(39,"input",20),s(),l(40,"div",5)(41,"label",6),d(42,"Caducidad desde"),s(),y(43,"input",21),s(),l(44,"div",5)(45,"label",6),d(46,"Caducidad hasta"),s(),y(47,"input",22),s(),l(48,"div",5)(49,"label",6),d(50,"Renglones x P\xE1gina"),s(),l(51,"select",23),Z("ngModelChange",function(o){return T(r),J(n.limit,o)||(n.limit=o),P(o)}),E("change",function(){return T(r),P(n.buscar())}),l(52,"option",24),d(53,"25"),s(),l(54,"option",24),d(55,"50"),s(),l(56,"option",24),d(57,"100"),s(),l(58,"option",24),d(59,"200"),s()()(),l(60,"div",25)(61,"button",26),E("click",function(){T(r);let o=$t(17);return P(n.limpiar(o))}),y(62,"i",27),s(),l(63,"button",28),E("click",function(){return T(r),P(n.buscar())}),d(64,"Buscar"),s()()()()(),l(65,"div",29)(66,"button",30),E("click",function(){return T(r),P(n.exportCsv())}),d(67,"Exportar CSV"),s()(),l(68,"div",31)(69,"table",32)(70,"thead")(71,"tr"),N(72,EI,5,5,"th",33),s()(),l(73,"tbody"),N(74,PI,2,1,"tr",34)(75,kI,3,1,"tr",35),s(),N(76,II,17,17,"tfoot",35),s()(),N(77,MI,17,14,"nav",36),s()}e&2&&(c(3),p("formGroup",n.filtroForm),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando||!!n.prodSel),c(2),p("ngIf",n.prodOpts.length&&!n.prodSel),c(),p("ngIf",n.prodSel),c(5),p("disabled",n.cargando),c(3),p("ngForOf",n.proveedores),c(4),p("disabled",n.cargando),c(3),p("ngForOf",n.usuarios),c(5),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),p("disabled",n.cargando),c(4),Q("ngModel",n.limit),p("ngModelOptions",Qt(26,fI))("disabled",n.cargando),c(),p("ngValue",25),c(2),p("ngValue",50),c(2),p("ngValue",100),c(2),p("ngValue",200),c(8),p("disabled",!n.rows.length),c(6),p("ngForOf",n.headers),c(2),p("ngForOf",n.rows),c(),p("ngIf",!n.rows.length),c(),p("ngIf",n.resp==null?null:n.resp.footer),c(),p("ngIf",n.totalPages>1))},dependencies:[Ae,We,Be,Ct,Nt,Bt,Ft,it,nt,Xe,tt,ze,Mt,ci,di,rt,_t,Lt,ut],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;top:calc(100% + 4px);left:0;right:0;max-height:240px;overflow:auto;background:#fff;border:1px solid #dee2e6;border-radius:.375rem;box-shadow:0 6px 24px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;border:0;background:#fff;border-bottom:1px dashed #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap}th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}th[_ngcontent-%COMP%]   .sort-icon[_ngcontent-%COMP%]{font-size:.8rem;line-height:1}.text-end[_ngcontent-%COMP%]{text-align:end}.info-paginacion[_ngcontent-%COMP%]{text-align:center;font-size:large;font-weight:500;color:#8a2be2}"]})};var gc=class i{constructor(t){this.http=t}api=Ge.apiUrl;headers(){return new qe({"Content-Type":"application/json"})}getReporte(t){let e=new Ht;return Object.entries(t||{}).forEach(([n,r])=>{r!=null&&r!==""&&(e=e.set(n,String(r)))}),this.http.get(`${this.api}/reportes/compras-con-ventas`,{headers:this.headers(),params:e}).pipe(Pi(()=>lt({nota:"",filtros:void 0,paginacion:{page:1,limit:20,total:0},rows:[],resumen:{sumCantidad:0,sumExistencia:0,avgVendidosFarmacia:0}})))}searchProductos(t){let e=`${Ge.apiUrl}/productos/buscar`,n=new Ht().set("q",t).set("limit","50");return this.http.get(e,{headers:this.headers(),params:n}).pipe(xt(r=>{if(Array.isArray(r))return r;let a=["rows","data","productos","products","items","docs","result","results","list"];for(let o of a)if(Array.isArray(r?.[o]))return r[o];return[]}),xt(r=>r.map(a=>({_id:String(a?._id??""),nombre:String(a?.nombre??""),codigoBarras:a?.codigoBarras?String(a.codigoBarras):void 0}))),xt(r=>[...r].sort((a,o)=>a.nombre.localeCompare(o.nombre,"es",{sensitivity:"base"}))),Pi(()=>lt([])))}getProveedores(){let t=`${Ge.apiUrl}/proveedores`;return this.http.get(t,{headers:this.headers()}).pipe(xt(e=>Array.isArray(e)?e:e?.rows??e?.data??[]),xt(e=>e.map(n=>({_id:String(n?._id??""),nombre:String(n?.nombre??"")}))),xt(e=>[...e].sort((n,r)=>n.nombre.localeCompare(r.nombre,"es",{sensitivity:"base"}))),Pi(()=>lt([])))}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var br=(i,t,e)=>({"bi-caret-up-fill":i,"bi-caret-down-fill":t,"bi-caret-up":e});function AI(i,t){if(i&1){let e=ie();l(0,"button",49),E("click",function(){let r=T(e).$implicit,a=_(2);return P(a.selectProducto(r))}),l(1,"div",50),d(2),s(),l(3,"small",51),d(4),s()()}if(i&2){let e=t.$implicit;c(2),k(e.nombre||"(sin nombre)"),c(2),k(e.codigoBarras||"\u2014")}}function OI(i,t){if(i&1&&(l(0,"div",47),N(1,AI,5,2,"button",48),s()),i&2){let e=_();c(),p("ngForOf",e.prodOpts)}}function DI(i,t){if(i&1&&(l(0,"span"),d(1),s()),i&2){let e=_(2);c(),R(" \xB7 ",e.productoSel.codigoBarras,"")}}function RI(i,t){if(i&1){let e=ie();l(0,"div",52)(1,"span",53),d(2),N(3,DI,2,1,"span",33),s(),l(4,"button",54),E("click",function(){T(e);let r=_();return P(r.clearProducto())}),d(5,"Borrar"),s()()}if(i&2){let e=_();c(2),R(" ",e.productoSel.nombre," "),c(),p("ngIf",e.productoSel.codigoBarras)}}function NI(i,t){if(i&1&&(l(0,"option",55),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function BI(i,t){if(i&1&&(l(0,"div",56)(1,"small"),d(2),s()()),i&2){let e=_();c(2),k(e.nota)}}function LI(i,t){i&1&&(l(0,"div"),d(1,"\u2014"),s())}function VI(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=t.$implicit;c(),k(e.farmacia||"\u2014")}}function UI(i,t){i&1&&(l(0,"div"),d(1,"\u2014"),s())}function jI(i,t){if(i&1&&(l(0,"div"),d(1),F(2,"number"),s()),i&2){let e=t.$implicit;c(),k(oe(2,1,e.vendidos))}}function WI(i,t){if(i&1&&(l(0,"tr")(1,"td"),d(2),F(3,"date"),s(),l(4,"td"),d(5),s(),l(6,"td"),d(7),s(),l(8,"td"),d(9),s(),l(10,"td"),d(11),s(),l(12,"td",31),d(13),F(14,"currency"),s(),l(15,"td",35),d(16),F(17,"number"),s(),l(18,"td"),d(19),F(20,"date"),s(),l(21,"td",31),d(22),F(23,"number"),s(),l(24,"td",57),N(25,LI,2,0,"div",33)(26,VI,2,1,"div",32),s(),l(27,"td",58),N(28,UI,2,0,"div",33)(29,jI,3,3,"div",32),s()()),i&2){let e=t.$implicit;c(2),k(Y(3,13,e.fecCompra,"dd/MM/yyyy")),c(3),k(e.proveedor||"\u2014"),c(2),k(e.producto),c(2),k(e.cb),c(2),k(e.lote),c(2),k(oe(14,16,e.costo)),c(3),k(oe(17,18,e.cantidad)),c(3),k(e.caducidad?Y(20,20,e.caducidad,"dd/MM/yyyy"):"\u2014"),c(3),k(oe(23,23,e.existencia)),c(3),p("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),c(),p("ngForOf",e.ventasPorFarmacia),c(2),p("ngIf",((e.ventasPorFarmacia==null?null:e.ventasPorFarmacia.length)||0)===0),c(),p("ngForOf",e.ventasPorFarmacia)}}function HI(i,t){i&1&&(l(0,"tr")(1,"td",59),d(2,"Sin resultados"),s()())}var _c=class i{constructor(t,e){this.fb=t;this.reportesSvc=e}form;proveedores=[];prodOpts=[];productoSel=null;rows=[];cargando=!1;nota="";total=0;page=1;limit=20;get totalPaginas(){return Math.max(1,Math.ceil((this.total||0)/(this.limit||1)))}get totalPagina(){return this.rows.reduce((t,e)=>t+(e.costoTotal||0),0)}sumCantidad=0;sumExistencia=0;avgVendidosFarmacia=0;ngOnInit(){let t=new Date,e=t.getFullYear(),n=t.getMonth(),r=new Date(e,n,1).toISOString().slice(0,10),a=t.toISOString().slice(0,10);this.form=this.fb.group({fechaIni:[r],fechaFin:[a],productoId:[""],proveedorId:[""],lote:[""],codigoBarras:[""],sortBy:["caducidad"],sortDir:["asc"],limit:[this.limit]}),this.reportesSvc.getProveedores().subscribe(o=>this.proveedores=o),this.buscar(!0)}isSorted(t){return this.form?.value?.sortBy===t}isAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}isSort(t){return this.form?.value?.sortBy===t}dirIsAsc(){return(this.form?.value?.sortDir||"asc")==="asc"}clickSort(t){let e=this.form.value.sortBy,n=this.form.value.sortDir||"asc";e===t?n=n==="asc"?"desc":"asc":n="asc",this.form.patchValue({sortBy:t,sortDir:n}),this.page=1,this.runQuery()}runQuery(){let t=this.form.value,e=jt(Qe({},t),{page:this.page,limit:this.limit});this.cargando=!0,this.reportesSvc.getReporte(e).subscribe({next:n=>{this.rows=n?.rows??[],this.total=n?.paginacion?.total??0,this.page=n?.paginacion?.page??this.page,this.limit=n?.paginacion?.limit??this.limit,this.nota=n?.nota??"",this.sumCantidad=n?.resumen?.sumCantidad??0,this.sumExistencia=n?.resumen?.sumExistencia??0,this.avgVendidosFarmacia=n?.resumen?.avgVendidosFarmacia??0,this.cargando=!1,console.log("respuesta",n)},error:n=>{this.rows=[],this.total=0,this.nota="",this.sumCantidad=0,this.sumExistencia=0,this.avgVendidosFarmacia=0,this.cargando=!1}})}goToFirstPage(){this.page>1&&(this.page=1,this.runQuery())}goToPrevPage(){this.page>1&&(this.page--,this.runQuery())}goToNextPage(){this.page<this.totalPaginas&&(this.page++,this.runQuery())}goToLastPage(){let t=this.totalPaginas;this.page!==t&&(this.page=t,this.runQuery())}onChangeLimit(){this.page=1,this.runQuery()}onProductoInput(t){let e=(t||"").trim();if(e.length<2){this.prodOpts=[];return}this.reportesSvc.searchProductos(e).subscribe(n=>this.prodOpts=n.slice(0,10))}selectProducto(t){this.productoSel=t,this.prodOpts=[],this.form.patchValue({productoId:t._id})}clearProducto(t){this.productoSel=null,this.form.patchValue({productoId:""}),this.prodOpts=[],t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>t.focus(),0))}limpiar(){let t=new Date,e=t.getFullYear(),n=t.getMonth(),r=new Date(e,n,1).toISOString().slice(0,10),a=t.toISOString().slice(0,10);this.productoSel=null,this.prodOpts=[],this.form.reset({fechaIni:r,fechaFin:a,productoId:"",proveedorId:"",lote:"",codigoBarras:"",sortBy:"caducidad",sortDir:"asc",limit:this.limit}),this.buscar(!0)}goPage(t){t<1||t>this.totalPaginas||(this.page=t,this.buscar(!1))}buscar(t=!1){t&&(this.page=1),this.runQuery()}static \u0275fac=function(e){return new(e||i)(te(Jt),te(gc))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-compras-ventas"]],decls:112,vars:99,consts:[["prodInput",""],[1,"filtros"],[1,"titulo","text-center"],[1,"row","align-items-end",3,"formGroup"],[1,"col-sm-3"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control"],["type","date","formControlName","fechaFin",1,"form-control"],[1,"col-sm-4","position-relative"],["type","text","placeholder","Nombre o c\xF3digo (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled","value"],["class","suggest",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"col-sm-2"],["formControlName","proveedorId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","align-items-end","mt-3","mb-2"],["type","text","formControlName","lote","placeholder","contiene\u2026",1,"form-control"],["type","text","formControlName","codigoBarras","placeholder","contiene\u2026",1,"form-control"],["type","number","formControlName","limit","min","1","max","200",1,"form-control",3,"change"],[1,"col-sm-2","mt-4"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"col-sm-3","mt-4"],["type","button",1,"btn-gris",3,"click","disabled"],["class","nota",4,"ngIf"],[1,"tabla-wrapper"],[1,"tabla"],[1,"th-sort",3,"click"],[1,"bi",3,"ngClass"],[1,"th-sort","text-end",3,"click"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","6",1,"text-end"],[1,"text-end","colortxt-c"],[1,"text-end","colortxt-v"],[1,"d-flex","align-items-center","justify-content-center","my-2","paginacion"],["aria-label","Primera p\xE1gina","matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["aria-label","P\xE1gina anterior","matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"px-2"],["aria-label","P\xE1gina siguiente","matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["aria-label","\xDAltima p\xE1gina","matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],[1,"suggest"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"text-muted"],[1,"mt-1"],[1,"badge","bg-primary-subtle","text-primary","border"],["type","button",1,"btn","btn-link","btn-sm","ps-2",3,"click"],[3,"value"],[1,"nota"],[1,"multiline"],[1,"multiline","text-end","colortxt-v"],["colspan","12",1,"text-center","text-muted","p-2"]],template:function(e,n){if(e&1){let r=ie();l(0,"div",1)(1,"h4",2),d(2,"Compras contra Ventas por producto"),s(),l(3,"form",3)(4,"div",4)(5,"label",5),d(6,"Fecha inicial"),s(),y(7,"input",6),s(),l(8,"div",4)(9,"label",5),d(10,"Fecha final"),s(),y(11,"input",7),s(),l(12,"div",8)(13,"label",5),d(14,"Producto"),s(),l(15,"input",9,0),E("input",function(){T(r);let o=$t(16);return P(n.onProductoInput(o.value))}),s(),N(17,OI,2,1,"div",10)(18,RI,6,2,"div",11),s(),l(19,"div",12)(20,"label",5),d(21,"Proveedor"),s(),l(22,"select",13)(23,"option",14),d(24,"TODOS"),s(),N(25,NI,2,2,"option",15),s()(),l(26,"div",16)(27,"div",12)(28,"label",5),d(29,"Lote"),s(),y(30,"input",17),s(),l(31,"div",12)(32,"label",5),d(33,"CB"),s(),y(34,"input",18),s(),l(35,"div",12)(36,"label",5),d(37,"# por p\xE1gina"),s(),l(38,"input",19),E("change",function(){return T(r),n.limit=n.form.value.limit||20,P(n.onChangeLimit())}),s()(),l(39,"div",20)(40,"button",21),E("click",function(){return T(r),P(n.limpiar())}),y(41,"i",22),s()(),l(42,"div",23)(43,"button",24),E("click",function(){return T(r),P(n.buscar(!0))}),d(44),s()()()(),N(45,BI,3,1,"div",25),s(),l(46,"div",26)(47,"table",27)(48,"thead")(49,"tr")(50,"th",28),E("click",function(){return T(r),P(n.clickSort("fecCompra"))}),d(51," Fec. compra "),y(52,"i",29),s(),l(53,"th",28),E("click",function(){return T(r),P(n.clickSort("proveedor"))}),d(54," Proveedor "),y(55,"i",29),s(),l(56,"th",28),E("click",function(){return T(r),P(n.clickSort("producto"))}),d(57," Producto "),y(58,"i",29),s(),l(59,"th",28),E("click",function(){return T(r),P(n.clickSort("cb"))}),d(60," CB "),y(61,"i",29),s(),l(62,"th",28),E("click",function(){return T(r),P(n.clickSort("lote"))}),d(63," Lote "),y(64,"i",29),s(),l(65,"th",30),E("click",function(){return T(r),P(n.clickSort("costo"))}),d(66," Costo "),y(67,"i",29),s(),l(68,"th",30),E("click",function(){return T(r),P(n.clickSort("cantidad"))}),d(69," Comprados "),y(70,"i",29),s(),l(71,"th",28),E("click",function(){return T(r),P(n.clickSort("caducidad"))}),d(72," Caducidad "),y(73,"i",29),s(),l(74,"th",30),E("click",function(){return T(r),P(n.clickSort("existencia"))}),d(75," Almac\xE9n "),y(76,"i",29),s(),l(77,"th"),d(78,"Farmacia"),s(),l(79,"th",31),d(80,"Vendidos"),s()()(),l(81,"tbody"),N(82,WI,30,25,"tr",32)(83,HI,3,0,"tr",33),s(),l(84,"tfoot")(85,"tr")(86,"th",34),d(87,"\u2211 Comprados:"),s(),l(88,"th",35),d(89),F(90,"number"),s(),l(91,"th",31),d(92,"\u2211 Almac\xE9n:"),s(),l(93,"th",31),d(94),F(95,"number"),s(),l(96,"th",31),d(97,"Prom. Vend.:"),s(),l(98,"th",36),d(99),F(100,"number"),s()()()()(),l(101,"div",37)(102,"button",38),E("click",function(){return T(r),P(n.goToFirstPage())}),y(103,"i",39),s(),l(104,"button",40),E("click",function(){return T(r),P(n.goToPrevPage())}),y(105,"i",41),s(),l(106,"span",42),d(107),s(),l(108,"button",43),E("click",function(){return T(r),P(n.goToNextPage())}),y(109,"i",44),s(),l(110,"button",45),E("click",function(){return T(r),P(n.goToLastPage())}),y(111,"i",46),s()()}e&2&&(c(3),p("formGroup",n.form),c(12),p("disabled",!!n.productoSel)("value",(n.productoSel==null?null:n.productoSel.nombre)||""),c(2),p("ngIf",n.prodOpts.length&&!n.productoSel),c(),p("ngIf",n.productoSel),c(7),p("ngForOf",n.proveedores),c(18),p("disabled",n.cargando),c(),R(" ",n.cargando?"Buscando\u2026":"Buscar"," "),c(),p("ngIf",n.nota),c(5),Re("sorted",n.isSorted("fecCompra")),Je("aria-sort",n.isSorted("fecCompra")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(63,br,n.isSorted("fecCompra")&&n.isAsc(),n.isSorted("fecCompra")&&!n.isAsc(),!n.isSorted("fecCompra"))),c(),Re("sorted",n.isSorted("proveedor")),Je("aria-sort",n.isSorted("proveedor")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(67,br,n.isSorted("proveedor")&&n.isAsc(),n.isSorted("proveedor")&&!n.isAsc(),!n.isSorted("proveedor"))),c(),Re("sorted",n.isSorted("producto")),Je("aria-sort",n.isSorted("producto")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(71,br,n.isSorted("producto")&&n.isAsc(),n.isSorted("producto")&&!n.isAsc(),!n.isSorted("producto"))),c(),Re("sorted",n.isSorted("cb")),Je("aria-sort",n.isSorted("cb")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(75,br,n.isSorted("cb")&&n.isAsc(),n.isSorted("cb")&&!n.isAsc(),!n.isSorted("cb"))),c(),Re("sorted",n.isSorted("lote")),Je("aria-sort",n.isSorted("lote")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(79,br,n.isSorted("lote")&&n.isAsc(),n.isSorted("lote")&&!n.isAsc(),!n.isSorted("lote"))),c(),Re("sorted",n.isSorted("costo")),Je("aria-sort",n.isSorted("costo")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(83,br,n.isSorted("costo")&&n.isAsc(),n.isSorted("costo")&&!n.isAsc(),!n.isSorted("costo"))),c(),Re("sorted",n.isSorted("cantidad")),Je("aria-sort",n.isSorted("cantidad")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(87,br,n.isSorted("cantidad")&&n.isAsc(),n.isSorted("cantidad")&&!n.isAsc(),!n.isSorted("cantidad"))),c(),Re("sorted",n.isSorted("caducidad")),Je("aria-sort",n.isSorted("caducidad")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(91,br,n.isSorted("caducidad")&&n.isAsc(),n.isSorted("caducidad")&&!n.isAsc(),!n.isSorted("caducidad"))),c(),Re("sorted",n.isSorted("existencia")),Je("aria-sort",n.isSorted("existencia")?n.isAsc()?"ascending":"descending":"none"),c(2),p("ngClass",Wi(95,br,n.isSorted("existencia")&&n.isAsc(),n.isSorted("existencia")&&!n.isAsc(),!n.isSorted("existencia"))),c(6),p("ngForOf",n.rows),c(),p("ngIf",!n.cargando&&n.rows.length===0),c(6),k(oe(90,56,n.sumCantidad)),c(5),k(oe(95,58,n.sumExistencia)),c(5),k(Y(100,60,n.avgVendidosFarmacia,"1.0-2")),c(3),p("disabled",n.page<=1),c(2),p("disabled",n.page<=1),c(3),fn("P\xE1gina ",n.page," de ",n.totalPaginas,""),c(),p("disabled",n.page>=n.totalPaginas),c(2),p("disabled",n.page>=n.totalPaginas))},dependencies:[Ae,si,We,Be,Ct,Nt,Rt,Bt,Ft,it,nt,Xe,Gt,tt,ze,Mt,Bi,Kn,ci,di,Lt,ut],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.nota[_ngcontent-%COMP%]{margin-top:.5rem;color:#000091;text-align:center}.colortxt-c[_ngcontent-%COMP%]{color:#0453b3;font-weight:600}.colortxt-v[_ngcontent-%COMP%]{color:#b30404;font-weight:600}.suggest[_ngcontent-%COMP%]{position:absolute;z-index:10;background:#fff;border:1px solid #ddd;width:100%;max-height:260px;overflow:auto;border-radius:.5rem;box-shadow:0 8px 18px #00000014}.suggest-item[_ngcontent-%COMP%]{width:100%;text-align:left;padding:.5rem .75rem;background:#fff;border:0;border-bottom:1px solid #eee}.suggest-item[_ngcontent-%COMP%]:hover{background:#f6f8ff}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eaeaea;padding:.5rem;vertical-align:top}.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f3f8ff;cursor:pointer;white-space:nowrap}.text-end[_ngcontent-%COMP%]{text-align:right}.multiline[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1.35}.pager[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}table.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.sorted[_ngcontent-%COMP%]{text-decoration:underline}.sort-caret[_ngcontent-%COMP%]{margin-left:.25rem;font-size:.8em}.th-sort[_ngcontent-%COMP%]{cursor:pointer;white-space:nowrap;-webkit-user-select:none;user-select:none}.th-sort[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.35rem;opacity:.6;font-size:.9em}.th-sort.sorted[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}"]})};function Qg(i){let t=i.cloneNode(!0),e=t.querySelectorAll("[id]"),n=i.nodeName.toLowerCase();t.removeAttribute("id");for(let r=0;r<e.length;r++)e[r].removeAttribute("id");return n==="canvas"?Vg(i,t):(n==="input"||n==="select"||n==="textarea")&&Lg(i,t),Bg("canvas",i,t,Vg),Bg("input, textarea, select",i,t,Lg),t}function Bg(i,t,e,n){let r=t.querySelectorAll(i);if(r.length){let a=e.querySelectorAll(i);for(let o=0;o<r.length;o++)n(r[o],a[o])}}var zI=0;function Lg(i,t){t.type!=="file"&&(t.value=i.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${zI++}`)}function Vg(i,t){let e=t.getContext("2d");if(e)try{e.drawImage(i,0,0)}catch{}}function xd(i){let t=i.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function pd(i,t,e){let{top:n,bottom:r,left:a,right:o}=i;return e>=n&&e<=r&&t>=a&&t<=o}function os(i,t,e){i.top+=t,i.bottom=i.top+i.height,i.left+=e,i.right=i.left+i.width}function Ug(i,t,e,n){let{top:r,right:a,bottom:o,left:u,width:m,height:f}=i,h=m*t,g=f*t;return n>r-g&&n<o+g&&e>u-h&&e<a+h}var vc=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:xd(e)})})}handleScroll(t){let e=Yr(t),n=this.positions.get(e);if(!n)return null;let r=n.scrollPosition,a,o;if(e===this._document){let f=this.getViewportScrollPosition();a=f.top,o=f.left}else a=e.scrollTop,o=e.scrollLeft;let u=r.top-a,m=r.left-o;return this.positions.forEach((f,h)=>{f.clientRect&&e!==h&&e.contains(h)&&os(f.clientRect,u,m)}),r.top=a,r.left=o,{top:u,left:m}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function Jg(i,t){let e=i.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let n=t.createElement("div");return e.forEach(r=>n.appendChild(r)),n}function bd(i,t,e){for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];r?i.setProperty(n,r,e?.has(n)?"important":""):i.removeProperty(n)}return i}function co(i,t){let e=t?"":"none";bd(i.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function jg(i,t,e){bd(i.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function xc(i,t){return t&&t!="none"?i+" "+t:i}function Wg(i,t){i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.transform=bc(t.left,t.top)}function bc(i,t){return`translate3d(${Math.round(i)}px, ${Math.round(t)}px, 0)`}function Hg(i){let t=i.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(i)*t}function $I(i){let t=getComputedStyle(i),e=md(t,"transition-property"),n=e.find(u=>u==="transform"||u==="all");if(!n)return 0;let r=e.indexOf(n),a=md(t,"transition-duration"),o=md(t,"transition-delay");return Hg(a[r])+Hg(o[r])}function md(i,t){return i.getPropertyValue(t).split(",").map(n=>n.trim())}var GI=new Set(["position"]),hd=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,n,r,a,o,u,m,f,h){this._document=t,this._rootElement=e,this._direction=n,this._initialDomRect=r,this._previewTemplate=a,this._previewClass=o,this._pickupPositionOnPage=u,this._initialTransform=m,this._zIndex=f,this._renderer=h}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),zg(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return $I(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,n=t?t.template:null,r;if(n&&t){let a=t.matchSize?this._initialDomRect:null,o=t.viewContainer.createEmbeddedView(n,t.context);o.detectChanges(),r=Jg(o,this._document),this._previewEmbeddedView=o,t.matchSize?Wg(r,a):r.style.transform=bc(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else r=Qg(this._rootElement),Wg(r,this._initialDomRect),this._initialTransform&&(r.style.transform=this._initialTransform);return bd(r.style,{"pointer-events":"none",margin:zg(r)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},GI),co(r,!1),r.classList.add("cdk-drag-preview"),r.setAttribute("popover","manual"),r.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(a=>r.classList.add(a)):r.classList.add(e)),r}};function zg(i){return"showPopover"in i}var qI={passive:!0},$g={passive:!1},XI={passive:!1,capture:!0},KI=800,Gg=new Set(["position"]),gd=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=m0(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new yt;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=Gn.EMPTY;_pointerUpSubscription=Gn.EMPTY;_scrollSubscription=Gn.EMPTY;_resizeSubscription=Gn.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>co(e,t)))}_disabled=!1;beforeStarted=new yt;started=new yt;released=new yt;ended=new yt;entered=new yt;exited=new yt;dropped=new yt;moved=this._moveEvents;data;constrainPosition;constructor(t,e,n,r,a,o,u){this._config=e,this._document=n,this._ngZone=r,this._viewportRuler=a,this._dragDropRegistry=o,this._renderer=u,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new vc(n),o.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(n=>Pr(n)),this._handles.forEach(n=>co(n,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&e.add(n)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Pr(t);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[Tr(this._renderer,e,"mousedown",this._pointerDown,$g),Tr(this._renderer,e,"touchstart",this._pointerDown,qI),Tr(this._renderer,e,"dragstart",this._nativeDragStart,$g)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Pr(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),co(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),co(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let r=Math.abs(e.x-this._pickupPositionOnPage.x),a=Math.abs(e.y-this._pickupPositionOnPage.y);if(r+a>=this._config.dragStartThreshold){let u=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),m=this._dropContainer;if(!u){this._endDragSequence(t);return}(!m||!m.isDragging()&&!m.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let n=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(n),this._dropContainer)this._updateActiveDropContainer(n,e);else{let r=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,a=this._activeTransform;a.x=n.x-r.x+this._passiveTransform.x,a.y=n.y-r.y+this._passiveTransform.y,this._applyRootElementTransform(a.x,a.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:n,event:t,distance:this._getDragDistance(n),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){rs(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),n=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=Tr(this._renderer,e,"selectstart",YI,XI)}),n){let r=this._rootElement,a=r.parentNode,o=this._placeholder=this._createPlaceholderElement(),u=this._anchor=this._anchor||this._document.createComment("");a.insertBefore(u,r),this._initialTransform=r.style.transform||"",this._preview=new hd(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(a,e)),jg(r,!1,Gg),this._document.body.appendChild(a.replaceChild(o,r)),this.started.next({source:this,event:t}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let n=this.isDragging(),r=rs(e),a=!r&&e.button!==0,o=this._rootElement,u=Yr(e),m=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+KI>Date.now(),f=r?xf(e):vf(e);if(u&&u.draggable&&e.type==="mousedown"&&e.preventDefault(),n||a||m||f)return;if(this._handles.length){let v=o.style;this._rootElementTapHighlight=v.webkitTapHighlightColor||"",v.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(v=>this._updateOnScroll(v)),this._boundaryElement&&(this._boundaryRect=xd(this._boundaryElement));let h=this._previewTemplate;this._pickupPositionInElement=h&&h.template&&!h.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let g=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:g.x,y:g.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){jg(this._rootElement,!0,Gg),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,n=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),a=this._getDragDistance(r),o=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:a,dropPoint:r,event:t}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:o,distance:a,dropPoint:r,event:t}),e.drop(this,n,this._initialIndex,this._initialContainer,o,a,r,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:n,y:r}){let a=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!a&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(a=this._initialContainer),a&&a!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=a,this._dropContainer.enter(this,t,e,a===this._initialContainer&&a.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:a,currentIndex:a.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,r),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let r=u=>{(!u||this._preview&&Yr(u)===this._preview.element&&u.propertyName==="transform")&&(o(),n(),clearTimeout(a))},a=setTimeout(r,e*1.5),o=this._preview.addEventListener("transitionend",r)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,n;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),n=Jg(this._placeholderRef,this._document)):n=Qg(this._rootElement),n.style.pointerEvents="none",n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(t,e,n){let r=e===this._rootElement?null:e,a=r?r.getBoundingClientRect():t,o=rs(n)?n.targetTouches[0]:n,u=this._getViewportScrollPosition(),m=o.pageX-a.left-u.left,f=o.pageY-a.top-u.top;return{x:a.left-t.left+m,y:a.top-t.top+f}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),n=rs(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,r=n.pageX-e.left,a=n.pageY-e.top;if(this._ownerSVGElement){let o=this._ownerSVGElement.getScreenCTM();if(o){let u=this._ownerSVGElement.createSVGPoint();return u.x=r,u.y=a,u.matrixTransform(o.inverse())}}return{x:r,y:a}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:r}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?r=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:a,y:o}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,u=this._boundaryRect,{width:m,height:f}=this._getPreviewRect(),h=u.top+o,g=u.bottom-(f-o),v=u.left+a,b=u.right-(m-a);n=qg(n,v,b),r=qg(r,h,g)}return{x:n,y:r}}_updatePointerDirectionDelta(t){let{x:e,y:n}=t,r=this._pointerDirectionDelta,a=this._pointerPositionAtLastDirectionChange,o=Math.abs(e-a.x),u=Math.abs(n-a.y);return o>this._config.pointerDirectionChangeThreshold&&(r.x=e>a.x?1:-1,a.x=e),u>this._config.pointerDirectionChangeThreshold&&(r.y=n>a.y?1:-1,a.y=n),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,co(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let n=1/this.scale,r=bc(t*n,e*n),a=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=a.transform&&a.transform!="none"?a.transform:""),a.transform=xc(r,this._initialTransform)}_applyPreviewTransform(t,e){let n=this._previewTemplate?.template?void 0:this._initialTransform,r=bc(t,e);this._preview.setTransform(xc(r,n))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),r=this._boundaryElement.getBoundingClientRect();if(r.width===0&&r.height===0||n.width===0&&n.height===0)return;let a=r.left-n.left,o=n.right-r.right,u=r.top-n.top,m=n.bottom-r.bottom;r.width>n.width?(a>0&&(t+=a),o>0&&(t-=o)):t=0,r.height>n.height?(u>0&&(e+=u),m>0&&(e-=m)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:rs(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let n=Yr(t);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&os(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Gs(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let n=this._previewContainer||"global";if(n==="parent")return t;if(n==="global"){let r=this._document;return e||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement||r.msFullscreenElement||r.body}return Pr(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function qg(i,t,e){return Math.max(t,Math.min(e,i))}function rs(i){return i.type[0]==="t"}function YI(i){i.preventDefault()}function Zg(i,t,e){let n=Xg(t,i.length-1),r=Xg(e,i.length-1);if(n===r)return;let a=i[n],o=r<n?-1:1;for(let u=n;u!==r;u+=o)i[u]=i[u+o];i[r]=a}function Xg(i,t){return Math.max(0,Math.min(t,i))}var yc=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,n,r){let a=this._itemPositions,o=this._getItemIndexFromPointerPosition(t,e,n,r);if(o===-1&&a.length>0)return null;let u=this.orientation==="horizontal",m=a.findIndex(C=>C.drag===t),f=a[o],h=a[m].clientRect,g=f.clientRect,v=m>o?1:-1,b=this._getItemOffsetPx(h,g,v),w=this._getSiblingOffsetPx(m,a,v),x=a.slice();return Zg(a,m,o),a.forEach((C,U)=>{if(x[U]===C)return;let j=C.drag===t,H=j?b:w,K=j?t.getPlaceholderElement():C.drag.getRootElement();C.offset+=H;let ce=Math.round(C.offset*(1/C.drag.scale));u?(K.style.transform=xc(`translate3d(${ce}px, 0, 0)`,C.initialTransform),os(C.clientRect,0,H)):(K.style.transform=xc(`translate3d(0, ${ce}px, 0)`,C.initialTransform),os(C.clientRect,H,0))}),this._previousSwap.overlaps=pd(g,e,n),this._previousSwap.drag=f.drag,this._previousSwap.delta=u?r.x:r.y,{previousIndex:m,currentIndex:o}}enter(t,e,n,r){let a=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,n):r,o=this._activeDraggables,u=o.indexOf(t),m=t.getPlaceholderElement(),f=o[a];if(f===t&&(f=o[a+1]),!f&&(a==null||a===-1||a<o.length-1)&&this._shouldEnterAsFirstChild(e,n)&&(f=o[0]),u>-1&&o.splice(u,1),f&&!this._dragDropRegistry.isDragging(f)){let h=f.getRootElement();h.parentElement.insertBefore(m,h),o.splice(a,0,t)}else this._element.appendChild(m),o.push(t);m.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let n=this._itemPositions.find(r=>r.drag===t)?.initialTransform;e.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(n=>n.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:n})=>{os(n,t,e)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let n=e.getVisibleElement();return{drag:e,offset:0,initialTransform:n.style.transform||"",clientRect:xd(n)}}).sort((e,n)=>t?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_getItemOffsetPx(t,e,n){let r=this.orientation==="horizontal",a=r?e.left-t.left:e.top-t.top;return n===-1&&(a+=r?e.width-t.width:e.height-t.height),a}_getSiblingOffsetPx(t,e,n){let r=this.orientation==="horizontal",a=e[t].clientRect,o=e[t+n*-1],u=a[r?"width":"height"]*n;if(o){let m=r?"left":"top",f=r?"right":"bottom";n===-1?u-=o.clientRect[m]-a[f]:u+=a[m]-o.clientRect[f]}return u}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,r=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let o=n[n.length-1].clientRect;return r?t>=o.right:e>=o.bottom}else{let o=n[0].clientRect;return r?t<=o.left:e<=o.top}}_getItemIndexFromPointerPosition(t,e,n,r){let a=this.orientation==="horizontal",o=this._itemPositions.findIndex(({drag:u,clientRect:m})=>{if(u===t)return!1;if(r){let f=a?r.x:r.y;if(u===this._previousSwap.drag&&this._previousSwap.overlaps&&f===this._previousSwap.delta)return!1}return a?e>=Math.floor(m.left)&&e<Math.floor(m.right):n>=Math.floor(m.top)&&n<Math.floor(m.bottom)});return o===-1||!this._sortPredicate(o,t)?-1:o}},_d=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<e.length;n++){let r=e[n];this._relatedNodes.push([r,r.nextSibling])}this.withItems(t)}sort(t,e,n,r){let a=this._getItemIndexFromPointerPosition(t,e,n),o=this._previousSwap;if(a===-1||this._activeItems[a]===t)return null;let u=this._activeItems[a];if(o.drag===u&&o.overlaps&&o.deltaX===r.x&&o.deltaY===r.y)return null;let m=this.getItemIndex(t),f=t.getPlaceholderElement(),h=u.getRootElement();a>m?h.after(f):h.before(f),Zg(this._activeItems,m,a);let g=this._getRootNode().elementFromPoint(e,n);return o.deltaX=r.x,o.deltaY=r.y,o.drag=u,o.overlaps=h===g||h.contains(g),{previousIndex:m,currentIndex:a}}enter(t,e,n,r){let a=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,n):r;a===-1&&(a=this._getClosestItemIndexToPointer(t,e,n));let o=this._activeItems[a],u=this._activeItems.indexOf(t);u>-1&&this._activeItems.splice(u,1),o&&!this._dragDropRegistry.isDragging(o)?(this._activeItems.splice(a,0,t),o.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[r,a]=this._relatedNodes[n];r.parentNode===t&&r.nextSibling!==a&&(a===null?t.appendChild(r):a.parentNode===t&&t.insertBefore(r,a))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,n){let r=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(n)),a=r?this._activeItems.findIndex(o=>{let u=o.getRootElement();return r===u||u.contains(r)}):-1;return a===-1||!this._sortPredicate(a,t)?-1:a}_getRootNode(){return this._rootNode||(this._rootNode=Gs(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let r=1/0,a=-1;for(let o=0;o<this._activeItems.length;o++){let u=this._activeItems[o];if(u!==t){let{x:m,y:f}=u.getRootElement().getBoundingClientRect(),h=Math.hypot(e-m,n-f);h<r&&(r=h,a=o)}}return a}},Kg=.05,e1=.05,Fn=function(i){return i[i.NONE=0]="NONE",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i}(Fn||{}),Xi=function(i){return i[i.NONE=0]="NONE",i[i.LEFT=1]="LEFT",i[i.RIGHT=2]="RIGHT",i}(Xi||{}),vd=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new yt;entered=new yt;exited=new yt;dropped=new yt;sorted=new yt;receivingStarted=new yt;receivingStopped=new yt;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=Gn.EMPTY;_verticalScrollDirection=Fn.NONE;_horizontalScrollDirection=Xi.NONE;_scrollNode;_stopScrollTimers=new yt;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,n,r,a){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=a;let o=this.element=Pr(t);this._document=n,this.withOrientation("vertical").withElementContainer(o),e.registerDropContainer(this),this._parentPositions=new vc(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,n,r){this._draggingStarted(),r==null&&this.sortingDisabled&&(r=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,n,r),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,n,r,a,o,u,m={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:n,container:this,previousContainer:r,isPointerOverContainer:a,distance:o,dropPoint:u,event:m})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(e.filter(r=>r.isDragging()).every(r=>t.indexOf(r)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof yc&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new _d(this._document,this._dragDropRegistry);else{let e=new yc(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,n)=>this.sortPredicate(e,n,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Pr(this.element),n=this._scrollableElements.indexOf(this._container),r=this._scrollableElements.indexOf(t);return n>-1&&this._scrollableElements.splice(n,1),r>-1&&this._scrollableElements.splice(r,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,n,r){if(this.sortingDisabled||!this._domRect||!Ug(this._domRect,Kg,e,n))return;let a=this._sortStrategy.sort(t,e,n,r);a&&this.sorted.next({previousIndex:a.previousIndex,currentIndex:a.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let n,r=Fn.NONE,a=Xi.NONE;if(this._parentPositions.positions.forEach((o,u)=>{u===this._document||!o.clientRect||n||Ug(o.clientRect,Kg,t,e)&&([r,a]=QI(u,o.clientRect,this._direction,t,e),(r||a)&&(n=u))}),!r&&!a){let{width:o,height:u}=this._viewportRuler.getViewportSize(),m={width:o,height:u,top:0,right:o,bottom:u,left:0};r=t1(m,e),a=i1(m,t),n=window}n&&(r!==this._verticalScrollDirection||a!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=r,this._horizontalScrollDirection=a,this._scrollNode=n,(r||a)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),xm(0,hm).pipe(Fs(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Fn.UP?t.scrollBy(0,-e):this._verticalScrollDirection===Fn.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===Xi.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===Xi.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&pd(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,n){return this._siblings.find(r=>r._canReceive(t,e,n))}_canReceive(t,e,n){if(!this._domRect||!pd(this._domRect,e,n)||!this.enterPredicate(t,this))return!1;let r=this._getShadowRoot().elementFromPoint(e,n);return r?r===this._container||this._container.contains(r):!1}_startReceiving(t,e){let n=this._activeSiblings;!n.has(t)&&e.every(r=>this.enterPredicate(r,this)||this._draggables.indexOf(r)>-1)&&(n.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=Gs(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function t1(i,t){let{top:e,bottom:n,height:r}=i,a=r*e1;return t>=e-a&&t<=e+a?Fn.UP:t>=n-a&&t<=n+a?Fn.DOWN:Fn.NONE}function i1(i,t){let{left:e,right:n,width:r}=i,a=r*e1;return t>=e-a&&t<=e+a?Xi.LEFT:t>=n-a&&t<=n+a?Xi.RIGHT:Xi.NONE}function QI(i,t,e,n,r){let a=t1(t,r),o=i1(t,n),u=Fn.NONE,m=Xi.NONE;if(a){let f=i.scrollTop;a===Fn.UP?f>0&&(u=Fn.UP):i.scrollHeight-f>i.clientHeight&&(u=Fn.DOWN)}if(o){let f=i.scrollLeft;e==="rtl"?o===Xi.RIGHT?f<0&&(m=Xi.RIGHT):i.scrollWidth+f>i.clientWidth&&(m=Xi.LEFT):o===Xi.LEFT?f>0&&(m=Xi.LEFT):i.scrollWidth-f>i.clientWidth&&(m=Xi.RIGHT)}return[u,m]}var as={capture:!0},fd={passive:!1,capture:!0},JI=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Te({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(n,r){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return i})(),n1=(()=>{class i{_ngZone=je(Yi);_document=je(Oo);_styleLoader=je(Sf);_renderer=je(Fo).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=m0([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new yt;pointerUp=new yt;scroll=new yt;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=Tr(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,fd)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,n){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(JI),this._activeDragInstances.update(r=>[...r,e]),this._activeDragInstances().length===1)){let r=n.type.startsWith("touch"),a=u=>this.pointerUp.next(u),o=[["scroll",u=>this.scroll.next(u),as],["selectstart",this._preventDefaultWhileDragging,fd]];r?o.push(["touchend",a,as],["touchcancel",a,as]):o.push(["mouseup",a,as]),r||o.push(["mousemove",u=>this.pointerMove.next(u),fd]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=o.map(([u,m,f])=>Tr(this._renderer,this._document,u,m,f))})}}stopDragging(e){this._activeDragInstances.update(n=>{let r=n.indexOf(e);return r>-1?(n.splice(r,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let n=[this.scroll];return e&&e!==this._document&&n.push(new qn(r=>this._ngZone.runOutsideAngular(()=>{let a=Tr(this._renderer,e,"scroll",o=>{this._activeDragInstances().length&&r.next(o)},as);return()=>{a()}}))),zr(...n)}registerDirectiveNode(e,n){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,n)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ZI={dragStartThreshold:5,pointerDirectionChangeThreshold:5},r1=(()=>{class i{_document=je(Oo);_ngZone=je(Yi);_viewportRuler=je(Ys);_dragDropRegistry=je(n1);_renderer=je(Fo).createRenderer(null,null);constructor(){}createDrag(e,n=ZI){return new gd(e,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new vd(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Yg=new Sr("CDK_DRAG_PARENT");var eM=new Sr("CdkDragHandle");var tM=new Sr("CDK_DRAG_CONFIG"),iM=new Sr("CdkDropList"),a1=(()=>{class i{element=je(Io);dropContainer=je(iM,{optional:!0,skipSelf:!0});_ngZone=je(Yi);_viewContainerRef=je(Os);_dir=je(Ks,{optional:!0});_changeDetectorRef=je(Wt);_selfHandle=je(eM,{optional:!0,self:!0});_parentDrag=je(Yg,{optional:!0,skipSelf:!0});_dragDropRegistry=je(n1);_destroyed=new yt;_handles=new Xn([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new Yt;released=new Yt;ended=new Yt;entered=new Yt;exited=new Yt;dropped=new Yt;moved=new qn(e=>{let n=this._dragRef.moved.pipe(xt(r=>({source:this,pointerPosition:r.pointerPosition,event:r.event,delta:r.delta,distance:r.distance}))).subscribe(e);return()=>{n.unsubscribe()}});_injector=je(Ca);constructor(){let e=this.dropContainer,n=je(tM,{optional:!0}),r=je(r1);this._dragRef=r.createDrag(this.element,{dragStartThreshold:n&&n.dragStartThreshold!=null?n.dragStartThreshold:5,pointerDirectionChangeThreshold:n&&n.pointerDirectionChangeThreshold!=null?n.pointerDirectionChangeThreshold:5,zIndex:n?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),n&&this._assignDefaults(n),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(Fs(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){As(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let n=e.rootElementSelector,r=e.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let n=this._handles.getValue();n.push(e),this._handles.next(n)}_removeHandle(e){let n=this._handles.getValue(),r=n.indexOf(e);r>-1&&(n.splice(r,1),this._handles.next(n))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,n=e;this.rootElementSelector&&(n=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Pr(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let n=this._dir,r=this.dragStartDelay,a=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,o=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof r=="object"&&r?r:Cf(r),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(a).withPreviewTemplate(o).withPreviewContainer(this.previewContainer||"global"),n&&e.withDirection(n.value)}}),e.beforeStarted.pipe(Ms(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){let r=this._dragDropRegistry.getDragDirectiveForNode(n);if(r){e.withParent(r._dragRef);break}n=n.parentElement}})}_handleEvents(e){e.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),e.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(e){let{lockAxis:n,dragStartDelay:r,constrainPosition:a,previewClass:o,boundaryElement:u,draggingDisabled:m,rootElementSelector:f,previewContainer:h}=e;this.disabled=m??!1,this.dragStartDelay=r||0,n&&(this.lockAxis=n),a&&(this.constrainPosition=a),o&&(this.previewClass=o),u&&(this.boundaryElement=u),f&&(this.rootElementSelector=f),h&&(this.previewContainer=h)}_setupHandlesListener(){this._handles.pipe(mn(e=>{let n=e.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),Ui(e=>zr(...e.map(n=>n._stateChanges.pipe(Gr(n))))),Fs(this._destroyed)).subscribe(e=>{let n=this._dragRef,r=e.element.nativeElement;e.disabled?n.disableHandle(r):n.enableHandle(r)})}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ds({type:i,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,r){n&2&&Re("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",mr],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Mm]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Kr([{provide:Yg,useExisting:i}]),ya]})}return i})();var Cc=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ao({type:i});static \u0275inj=ko({providers:[r1],imports:[Qs]})}return i})();var F_=hi(Pu()),Vr=hi(ki());var yo=class i{constructor(t){this.http=t}base=`${Ge.apiUrl}/label-designs`;headers(){let t=localStorage.getItem("token")||"";return new qe({"x-auth-token":t})}list(){return this.http.get(this.base,{headers:this.headers()})}get(t){return this.http.get(`${this.base}/${t}`,{headers:this.headers()})}create(t){return this.http.post(this.base,t,{headers:this.headers()})}update(t,e){return this.http.put(`${this.base}/${t}`,e,{headers:this.headers()})}remove(t){return this.http.delete(`${this.base}/${t}`,{headers:this.headers()})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var n6=["barcodeSvg"];function r6(i,t){if(i&1){let e=ie();l(0,"div")(1,"h4",6),d(2,"Hoja (mm)"),s(),l(3,"div",7)(4,"label"),d(5,"Ancho p\xE1g."),s(),l(6,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.pageWidthMm,r)||(a.design.pageWidthMm=r),P(r)}),s(),l(7,"label"),d(8,"Alto p\xE1g."),s(),l(9,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.pageHeightMm,r)||(a.design.pageHeightMm=r),P(r)}),s(),l(10,"label"),d(11,"Cols"),s(),l(12,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.cols,r)||(a.design.cols=r),P(r)}),s(),l(13,"label"),d(14,"Rens"),s(),l(15,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.rows,r)||(a.design.rows=r),P(r)}),s(),l(16,"label"),d(17,"Gap X"),s(),l(18,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.gapXmm,r)||(a.design.gapXmm=r),P(r)}),s(),l(19,"label"),d(20,"Gap Y"),s(),l(21,"input",8),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.gapYmm,r)||(a.design.gapYmm=r),P(r)}),s()()()}if(i&2){let e=_();c(6),Q("ngModel",e.design.pageWidthMm),c(3),Q("ngModel",e.design.pageHeightMm),c(3),Q("ngModel",e.design.cols),c(3),Q("ngModel",e.design.rows),c(3),Q("ngModel",e.design.gapXmm),c(3),Q("ngModel",e.design.gapYmm)}}function a6(i,t){if(i&1){let e=ie();l(0,"div")(1,"h4",6),d(2,"Rollo"),s(),l(3,"div",7)(4,"label"),d(5,"Gap entre etiquetas (mm)"),s(),l(6,"input",37),Z("ngModelChange",function(r){T(e);let a=_();return J(a.design.rollGapMm,r)||(a.design.rollGapMm=r),P(r)}),s()(),l(7,"small"),d(8,"El ancho de la etiqueta debe coincidir con el ancho del rollo instalado en la QL-800."),s()()}if(i&2){let e=_();c(6),Q("ngModel",e.design.rollGapMm)}}function o6(i,t){if(i&1&&y(0,"div",38),i&2){let e=_();Ri("left",e.design.splitPct,"%")}}function s6(i,t){if(i&1&&(l(0,"div",43),d(1),s()),i&2){let e=_().$implicit,n=_();p("ngStyle",n.textStyle(e)),c(),R(" ",n.sampleValue(e)," ")}}function l6(i,t){if(i&1&&(l(0,"div",43),d(1),s()),i&2){let e=_().$implicit,n=_();p("ngStyle",n.textStyle(e)),c(),R(" ",n.formatPrice(123.45,e)," ")}}function c6(i,t){i&1&&(l(0,"div"),wm(),y(1,"svg",null,0),s())}function d6(i,t){if(i&1){let e=ie();l(0,"div",39),E("click",function(r){let a=T(e).$implicit,o=_();return r.stopPropagation(),P(o.selected=a)})("cdkDragEnded",function(r){let a=T(e).$implicit,o=_();return P(o.onDragEnd(r,a))}),at(1,40),N(2,s6,2,2,"div",41)(3,l6,2,2,"div",41)(4,c6,3,0,"div",42),ot(),s()}if(i&2){let e=t.$implicit,n=_();Ri("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),Re("selected",e===n.selected),c(),p("ngSwitch",e.type),c(),p("ngSwitchCase","text"),c(),p("ngSwitchCase","price"),c(),p("ngSwitchCase","barcode")}}function u6(i,t){if(i&1&&(l(0,"option",73),d(1),s()),i&2){let e=t.$implicit;p("ngValue",e.stack),c(),k(e.name)}}function m6(i,t){if(i&1){let e=ie();l(0,"div")(1,"div",62)(2,"label"),d(3,"Tipograf\xEDa:"),s(),l(4,"select",5),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.fontFamily,r)||(a.selected.fontFamily=r),P(r)}),N(5,u6,2,2,"option",63),s(),l(6,"label",64),d(7,"Fuente (pt):"),s(),l(8,"input",65),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.fontSize,r)||(a.selected.fontSize=r),P(r)}),s(),l(9,"label")(10,"input",13),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.bold,r)||(a.selected.bold=r),P(r)}),s(),d(11," Negritas"),s(),l(12,"label"),d(13,"Tracking (px):"),s(),l(14,"input",66),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.letterSpacing,r)||(a.selected.letterSpacing=r),P(r)}),s()(),l(15,"div",67)(16,"div",68)(17,"label")(18,"input",13),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.uppercase,r)||(a.selected.uppercase=r),P(r)}),s(),d(19," MAY\xDASCULAS"),s()(),l(20,"div",68)(21,"label"),d(22,"Alineaci\xF3n:\xA0"),s(),l(23,"select",5),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.align,r)||(a.selected.align=r),P(r)}),l(24,"option"),d(25,"left"),s(),l(26,"option"),d(27,"center"),s(),l(28,"option"),d(29,"right"),s()()(),l(30,"div",69)(31,"label"),d(32,"Pref.:\xA0"),l(33,"input",70),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.prefix,r)||(a.selected.prefix=r),P(r)}),s()()(),l(34,"div",71)(35,"label"),d(36,"Sufi.:\xA0"),l(37,"input",72),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.suffix,r)||(a.selected.suffix=r),P(r)}),s()()()()()}if(i&2){let e=_(2);c(4),Q("ngModel",e.selected.fontFamily),c(),p("ngForOf",e.fontOptions),c(3),Q("ngModel",e.selected.fontSize),c(2),Q("ngModel",e.selected.bold),c(4),Q("ngModel",e.selected.letterSpacing),c(4),Q("ngModel",e.selected.uppercase),c(5),Q("ngModel",e.selected.align),c(10),Q("ngModel",e.selected.prefix),c(4),Q("ngModel",e.selected.suffix)}}function f6(i,t){if(i&1){let e=ie();l(0,"div",74)(1,"div",22)(2,"label"),d(3,"CB ancho(px)\xA0"),s(),l(4,"input",75),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.barcode.width,r)||(a.selected.barcode.width=r),P(r)}),E("ngModelChange",function(){T(e);let r=_(2);return P(r.renderBarcodes())}),s()(),l(5,"div",22)(6,"label"),d(7,"CB alto(px)\xA0"),s(),l(8,"input",75),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.barcode.height,r)||(a.selected.barcode.height=r),P(r)}),E("ngModelChange",function(){T(e);let r=_(2);return P(r.renderBarcodes())}),s()(),l(9,"div",76)(10,"label")(11,"input",13),Z("ngModelChange",function(r){T(e);let a=_(2);return J(a.selected.barcode.displayValue,r)||(a.selected.barcode.displayValue=r),P(r)}),E("ngModelChange",function(){T(e);let r=_(2);return P(r.renderBarcodes())}),s(),d(12," Mostrar texto "),s()()()}if(i&2){let e=_(2);c(4),Q("ngModel",e.selected.barcode.width),c(4),Q("ngModel",e.selected.barcode.height),c(3),Q("ngModel",e.selected.barcode.displayValue)}}function p6(i,t){if(i&1){let e=ie();l(0,"div",44)(1,"h4",45),d(2,"Propiedades del elemento seleccionado"),s(),l(3,"div",46),d(4,"Tipo: "),l(5,"b"),d(6),s()(),l(7,"div",47)(8,"span",48),d(9,"Posici\xF3n:"),s(),l(10,"label"),d(11),F(12,"number"),s(),l(13,"button",49),E("click",function(){T(e);let r=_();return P(r.nudge(-r.stepX,0))}),y(14,"i",50),s(),l(15,"button",51),E("click",function(){T(e);let r=_();return P(r.nudge(r.stepX,0))}),y(16,"i",52),s(),l(17,"label"),d(18),F(19,"number"),s(),l(20,"button",53),E("click",function(){T(e);let r=_();return P(r.nudge(0,-r.stepY))}),y(21,"i",54),s(),l(22,"button",55),E("click",function(){T(e);let r=_();return P(r.nudge(0,r.stepY))}),y(23,"i",56),s()(),l(24,"div",57)(25,"span",48),d(26,"Tama\xF1o:"),s(),l(27,"label"),d(28,"Ancho (%)"),s(),l(29,"input",58),Z("ngModelChange",function(r){T(e);let a=_();return J(a.selected.w,r)||(a.selected.w=r),P(r)}),s(),l(30,"label"),d(31,"Alto (%)"),s(),l(32,"input",58),Z("ngModelChange",function(r){T(e);let a=_();return J(a.selected.h,r)||(a.selected.h=r),P(r)}),s()(),N(33,m6,38,9,"div",12)(34,f6,13,3,"div",59),l(35,"div",60)(36,"button",61),E("click",function(){T(e);let r=_();return P(r.deleteSelected())}),d(37,"Eliminar elemento"),s()()()}if(i&2){let e=_();c(6),k(e.selected.type),c(5),R("X=",Y(12,7,e.selected.x,"1.0-1"),"%"),c(7),R("Y=",Y(19,10,e.selected.y,"1.0-1"),"%"),c(11),Q("ngModel",e.selected.w),c(3),Q("ngModel",e.selected.h),c(),p("ngIf",e.selected.type!=="barcode"),c(),p("ngIf",e.selected.type==="barcode")}}function h6(i,t){if(i&1){let e=ie();l(0,"li",77),E("click",function(){let r=T(e).$implicit,a=_();return P(a.load(r))}),l(1,"span",78),d(2),s(),l(3,"button",79),E("click",function(r){let a=T(e).$implicit,o=_();return P(o.remove(a,r))}),d(4,"Borrar"),s()()}if(i&2){let e=t.$implicit,n=_();Re("active",e._id===n.design._id),c(2),k(e.nombre)}}var Nc=class i{constructor(t){this.svc=t}design=this.blankDesign();disenos=[];selected=null;zoom=2;gridStep=1;barcodeSvgs;fontOptions=[{name:"Inter",stack:"Inter, system-ui, Arial, sans-serif"},{name:"Roboto",stack:"Roboto, system-ui, Arial, sans-serif"},{name:"System UI",stack:"system-ui, Arial, sans-serif"},{name:"Arial",stack:"Arial, Helvetica, sans-serif"},{name:"Georgia",stack:'Georgia, "Times New Roman", serif'},{name:"Times New Roman",stack:'"Times New Roman", Times, serif'},{name:"Courier New",stack:'"Courier New", Courier, monospace'}];SAFE_TOP_MM=.8;stepX=1;stepY=1;keyboardNudgeActive=!0;ngOnInit(){this.refreshList()}nudge(t,e){if(!this.selected)return;let n=m=>Math.round(m*10)/10,r=Math.max(0,100-(this.selected.w??0)),a=Math.max(0,100-(this.selected.h??0)),o=Math.min(r,Math.max(0,(this.selected.x??0)+Number(t||0))),u=Math.min(a,Math.max(0,(this.selected.y??0)+Number(e||0)));this.selected.x=n(o),this.selected.y=n(u)}fromApi(t){return{_id:t._id,nombre:t.nombre??"",widthMm:t.size?.widthMm??t.widthMm??50,heightMm:t.size?.heightMm??t.heightMm??30,marginMm:t.size?.marginMm??t.marginMm??2,pageWidthMm:t.layout?.pageWidthMm??t.pageWidthMm??210,pageHeightMm:t.layout?.pageHeightMm??t.pageHeightMm??297,cols:t.layout?.columns??t.cols??4,rows:t.layout?.rows??t.rows??8,gapXmm:t.layout?.gapXmm??t.gapXmm??2,gapYmm:t.layout?.gapYmm??t.gapYmm??2,twoCols:t.twoCols??!1,splitPct:t.splitPct??50,elements:(t.elements||[]).map(e=>({type:e.type,field:e.field??"nombre",text:e.text??"",x:e.x??5,y:e.y??5,w:e.w??50,h:e.h??10,fontSize:e.fontSize??10,bold:!!e.bold,align:e.align??"left",uppercase:!!e.uppercase,prefix:e.prefix??"",suffix:e.suffix??"",barcode:e.barcode?{symbology:e.barcode.symbology??"CODE128",width:e.barcode.width??1,height:e.barcode.height??30,displayValue:e.barcode.displayValue??!0}:{symbology:"CODE128",width:1,height:30,displayValue:!0},fontFamily:e.fontFamily??"Inter, system-ui, Arial, sans-serif",letterSpacing:typeof e.letterSpacing=="number"?e.letterSpacing:0}))}}blankDesign(){return{nombre:"",widthMm:62,heightMm:30,marginMm:2,pageWidthMm:210,pageHeightMm:297,cols:4,rows:8,gapXmm:2,gapYmm:2,twoCols:!1,splitPct:50,mode:"roll",rollGapMm:0,elements:[]}}refreshList(){this.svc.list().subscribe(t=>{let e=t||[];this.disenos=e.map(n=>this.fromApi(n))})}normalizeDesign(t){return{_id:t?._id,nombre:t?.nombre??"",widthMm:t?.widthMm??t?.size?.widthMm??50,heightMm:t?.heightMm??t?.size?.heightMm??30,marginMm:t?.marginMm??t?.size?.marginMm??2,pageWidthMm:t?.pageWidthMm??t?.layout?.pageWidthMm??210,pageHeightMm:t?.pageHeightMm??t?.layout?.pageHeightMm??297,cols:t?.cols??t?.layout?.columns??3,rows:t?.rows??t?.layout?.rows??8,gapXmm:t?.gapXmm??t?.layout?.gapXmm??2,gapYmm:t?.gapYmm??t?.layout?.gapYmm??2,mode:t?.mode??"roll",rollGapMm:t?.rollGapMm??0,elements:t?.elements??[]}}ngAfterViewInit(){setTimeout(()=>this.renderBarcodes(),0),this.barcodeSvgs.changes.subscribe(()=>{this.renderBarcodes()})}load(t){t?._id?this.svc.get(t._id).subscribe(e=>{this.design=this.normalizeDesign(e),setTimeout(()=>this.renderBarcodes(),0)}):(this.design=this.normalizeDesign(t),setTimeout(()=>this.renderBarcodes(),0)),this.selected=null}nuevo(){this.design=this.blankDesign(),this.selected=null}addText(t){this.design.elements.push({type:"text",field:t,x:5,y:5,w:60,h:10,fontSize:11,align:"left",bold:!1,uppercase:!1,prefix:"",suffix:"",fontFamily:"Inter, system-ui, Arial, sans-serif",letterSpacing:0})}addPrice(){this.design.elements.push({type:"price",field:"precioVenta",x:5,y:20,w:60,h:15,fontSize:16,align:"left",bold:!0,prefix:"$",uppercase:!1,suffix:"",fontFamily:"Inter, system-ui, Arial, sans-serif",letterSpacing:0})}addBarcode(){this.design.elements.push({type:"barcode",field:"codigoBarras",x:5,y:40,w:80,h:25,barcode:{symbology:"CODE128",width:1,height:30,displayValue:!0}}),setTimeout(()=>this.renderBarcodes(),0)}deleteSelected(){this.selected&&(this.design.elements=this.design.elements.filter(t=>t!==this.selected),this.selected=null)}onDragEnd(t,e){let n=t.source.element.nativeElement,r=n.closest(".label-inner"),a=r.getBoundingClientRect(),o=n.getBoundingClientRect(),u=o.left-a.left,m=o.top-a.top,f=u/r.clientWidth*100,h=m/r.clientHeight*100,g=v=>Math.round(v/this.gridStep)*this.gridStep;e.x=Math.max(0,Math.min(100-(e.w??0),g(f))),e.y=Math.max(0,Math.min(100-(e.h??0),g(h))),t.source.reset()}textStyle(t){return{"font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"font-family":t.fontFamily||"system-ui, Arial, sans-serif","text-align":t.align||"left",width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start",overflow:"hidden","white-space":"nowrap","line-height":1,"letter-spacing.px":t.letterSpacing??0}}sampleValue(t){let e={nombre:"Ciprofloxacino 3.5 mg / Dexametasona 1 mg / 1 mL SONS C/5 mL Sol Oftalmica",renglon1:"Ciprofloxacino / Dexametasona",renglon2:"3.5 mg /1 mg / 1 mL C/5 mL",codigoBarras:"7501234567890",precioVenta:"123.45",custom:t.text||"Texto fijo"},n=t.field||"nombre",r=e[n]||"";return t.uppercase&&(r=String(r).toUpperCase()),`${t.prefix||""}${r}${t.suffix||""}`}formatPrice(t,e){let n=new Intl.NumberFormat("es-MX",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(Number(t)||0)),r=`${e.prefix||"$"}${n}${e.suffix||""}`;return e.uppercase?r.toUpperCase():r}renderBarcodes(){let t=this.barcodeSvgs?.toArray()||[],e=0;this.design.elements.forEach(n=>{if(n.type!=="barcode")return;let r=t[e++]?.nativeElement;if(!r)return;if(n.barcode?.symbology==="QR"){r.innerHTML="";return}let a=this.sampleValue(jt(Qe({},n),{field:"codigoBarras"}));(0,F_.default)(r,a,{format:n.barcode?.symbology||"CODE128",width:n.barcode?.width||1,height:n.barcode?.height||30,displayValue:n.barcode?.displayValue??!0,margin:0})})}save(){let t=this.design;if(!t||!t.nombre?.trim()){Vr.default.fire("Falta nombre","Ponle un nombre al dise\xF1o.","info");return}if(!t.widthMm||!t.heightMm){Vr.default.fire("Tama\xF1o incompleto","Define ancho/alto de la etiqueta (mm).","info");return}Array.isArray(t.elements)||(t.elements=[]);let e=jt(Qe({},t),{elements:(t.elements||[]).map(r=>({type:r.type,field:r.field,x:r.x,y:r.y,w:r.w,h:r.h,fontSize:r.fontSize,bold:r.bold,align:r.align,uppercase:r.uppercase,prefix:r.prefix,suffix:r.suffix,text:r.text,barcode:r.barcode?Qe({},r.barcode):void 0,fontFamily:r.fontFamily,letterSpacing:r.letterSpacing})),size:{widthMm:t.widthMm,heightMm:t.heightMm,marginMm:t.marginMm??0},layout:{pageWidthMm:t.pageWidthMm??210,pageHeightMm:t.pageHeightMm??297,columns:t.cols??1,rows:t.rows??1,gapXmm:t.gapXmm??0,gapYmm:t.gapYmm??0}});(t._id?this.svc.update(t._id,e):this.svc.create(e)).subscribe({next:r=>{this.design=this.fromApi(r),this.refreshList(),Vr.default.fire({icon:"success",title:"Guardado",timer:1200,showConfirmButton:!1})},error:r=>{console.error("Error al guardar dise\xF1o",r);let a=r?.error?.error||r?.error?.mensaje||r?.message||"No se pudo guardar el dise\xF1o";Vr.default.fire("Error",a,"error")}})}remove(t,e){e?.stopPropagation(),t?._id&&Vr.default.fire({title:"\xBFEliminar dise\xF1o?",html:`<b>${t.nombre}</b> se eliminar\xE1 de forma permanente.`,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,focusCancel:!0}).then(n=>{n.isConfirmed&&this.svc.remove(t._id).subscribe({next:()=>{this.design?._id===t._id&&this.nuevo(),this.refreshList(),Vr.default.fire({icon:"success",title:"Eliminado",timer:1200,showConfirmButton:!1})},error:r=>{console.error("Error eliminando dise\xF1o",r),Vr.default.fire("Error","No se pudo eliminar el dise\xF1o.","error")}})})}isTypingTarget(t){return!!t&&(t.isContentEditable||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)}keyStep(t,e){let n=t;return e.shiftKey&&(n*=10),e.altKey&&(n*=.1),n}onKeydown(t){if(!this.selected||!this.keyboardNudgeActive||this.isTypingTarget(t.target))return;let e=t.key.toLowerCase();if(!(e==="arrowleft"||e==="arrowright"||e==="arrowup"||e==="arrowdown")&&!(e==="a"||e==="d"||e==="w"||e==="s"))return;let a=e==="arrowleft"||e==="a"?-this.keyStep(this.stepX,t):e==="arrowright"||e==="d"?this.keyStep(this.stepX,t):0,o=e==="arrowup"||e==="w"?-this.keyStep(this.stepY,t):e==="arrowdown"||e==="s"?this.keyStep(this.stepY,t):0;(a!==0||o!==0)&&(t.preventDefault(),this.nudge(a,o))}static \u0275fac=function(e){return new(e||i)(te(yo))};static \u0275cmp=Te({type:i,selectors:[["app-label-designer"]],viewQuery:function(e,n){if(e&1&&Ot(n6,5),e&2){let r;St(r=wt())&&(n.barcodeSvgs=r)}},hostBindings:function(e,n){e&1&&E("keydown",function(a){return n.onKeydown(a)},!1,Tm)},decls:77,vars:22,consts:[["barcodeSvg",""],[1,"designer"],[1,"sidebar"],[1,"titulo","text-center"],[2,"margin-right","1rem"],[3,"ngModelChange","ngModel"],[1,"subtitulo","text-center","mt-1"],[1,"grid"],["type","number",3,"ngModelChange","ngModel"],["type","radio","value","sheet",3,"ngModelChange","ngModel"],[2,"margin-left","1rem"],["type","radio","value","roll",3,"ngModelChange","ngModel"],[4,"ngIf"],["type","checkbox",3,"ngModelChange","ngModel"],["type","number","min","10","max","90",3,"ngModelChange","ngModel"],[1,"mb-2"],[1,"row","mb-1"],[1,"col-4"],[1,"btn-gris-chico",3,"click"],[1,"col-4",2,"text-align","center"],[1,"col-4",2,"text-align","end"],[1,"row"],[1,"col-5"],[1,"col-7",2,"text-align","end"],[1,"col-7"],[1,"btn-verde-chico",3,"click"],[1,"col-5",2,"text-align","end"],["tabindex","0",1,"center-col"],[1,"canvas-wrap"],[1,"label-canvas",3,"click"],[1,"label-inner"],["class","two-cols-guide",3,"left",4,"ngIf"],["class","el","cdkDrag","","cdkDragBoundary",".label-inner",3,"selected","left","top","width","height","click","cdkDragEnded",4,"ngFor","ngForOf"],["class","props-card",4,"ngIf"],[1,"design-list"],[1,"titulo"],["class","name-label",3,"active","click",4,"ngFor","ngForOf"],["type","number","min","0",3,"ngModelChange","ngModel"],[1,"two-cols-guide"],["cdkDrag","","cdkDragBoundary",".label-inner",1,"el",3,"click","cdkDragEnded"],[3,"ngSwitch"],[3,"ngStyle",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"ngStyle"],[1,"props-card"],[1,"subtitulo",2,"text-align","center"],[2,"text-align","center"],[1,"row-pos"],[1,"lead"],["type","button","matTooltip","Izquierda",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-left"],["type","button","matTooltip","Derecha",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-right"],["type","button","matTooltip","Arriba",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-up"],["type","button","matTooltip","Abajo",1,"btn-amarillo-chico",3,"click"],[1,"fa","fa-arrow-down"],[1,"rowline"],["type","number","min","1","max","100",3,"ngModelChange","ngModel"],["class","row my-1",4,"ngIf"],[2,"display","flex","justify-content","center","margin-top",".5rem"],[1,"btn-rojo-chico",3,"click"],[1,"rowTexto"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"margin-right",".75rem"],["type","number",2,"width","3.5rem",3,"ngModelChange","ngModel"],["type","number","step","0.1",3,"ngModelChange","ngModel"],[1,"row","mt-2"],[1,"col-3"],[1,"col-3",2,"text-align","center"],[2,"width","7rem",3,"ngModelChange","ngModel"],[1,"col-3",2,"text-align","end"],[2,"width","6rem",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"row","my-1"],["type","number",2,"width","3rem",3,"ngModelChange","ngModel"],[1,"col-2",2,"text-align","end"],[1,"name-label",3,"click"],[1,"name"],[1,"mini","btn-rojo",3,"click"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"div",2)(2,"h3",3),d(3,"Dise\xF1o"),s(),l(4,"label",4),d(5,"Nombre"),s(),l(6,"input",5),Z("ngModelChange",function(a){return J(n.design.nombre,a)||(n.design.nombre=a),a}),s(),l(7,"h4",6),d(8,"Tama\xF1o etiqueta (mm)"),s(),l(9,"div",7)(10,"label"),d(11,"Ancho"),s(),l(12,"input",8),Z("ngModelChange",function(a){return J(n.design.widthMm,a)||(n.design.widthMm=a),a}),s(),l(13,"label"),d(14,"Alto"),s(),l(15,"input",8),Z("ngModelChange",function(a){return J(n.design.heightMm,a)||(n.design.heightMm=a),a}),s(),l(16,"label"),d(17,"Margen"),s(),l(18,"input",8),Z("ngModelChange",function(a){return J(n.design.marginMm,a)||(n.design.marginMm=a),a}),s()(),l(19,"h4",6),d(20,"Modo"),s(),l(21,"label")(22,"input",9),Z("ngModelChange",function(a){return J(n.design.mode,a)||(n.design.mode=a),a}),s(),d(23," Hoja (A4 / columnas)"),s(),l(24,"label",10)(25,"input",11),Z("ngModelChange",function(a){return J(n.design.mode,a)||(n.design.mode=a),a}),s(),d(26," Rollo (Brother QL-800)"),s(),N(27,r6,22,6,"div",12)(28,a6,9,1,"div",12),l(29,"h4",6),d(30,"Gu\xEDa: 2 columnas"),s(),l(31,"div",7)(32,"label"),d(33,"Activar"),s(),l(34,"input",13),Z("ngModelChange",function(a){return J(n.design.twoCols,a)||(n.design.twoCols=a),a}),s(),l(35,"label"),d(36,"Split (%)"),s(),l(37,"input",14),Z("ngModelChange",function(a){return J(n.design.splitPct,a)||(n.design.splitPct=a),a}),s()(),l(38,"div",15)(39,"h4",6),d(40,"Agregar elemento"),s(),l(41,"div",16)(42,"div",17)(43,"button",18),E("click",function(){return n.addText("nombre")}),d(44,"Nombre"),s()(),l(45,"div",19)(46,"button",18),E("click",function(){return n.addText("renglon1")}),d(47,"Rengl\xF3n 1"),s()(),l(48,"div",20)(49,"button",18),E("click",function(){return n.addText("renglon2")}),d(50,"Rengl\xF3n 2"),s()()(),l(51,"div",21)(52,"div",22)(53,"button",18),E("click",function(){return n.addPrice()}),d(54,"Precio"),s()(),l(55,"div",23)(56,"button",18),E("click",function(){return n.addBarcode()}),d(57,"C\xF3digo de barras"),s()()()(),l(58,"div",21)(59,"div",24)(60,"button",25),E("click",function(){return n.save()}),d(61,"Guardar dise\xF1o"),s()(),l(62,"div",26)(63,"button",25),E("click",function(){return n.nuevo()}),d(64,"Nuevo"),s()()()(),l(65,"div",27)(66,"div",28)(67,"div",29),E("click",function(){return n.selected=null}),l(68,"div",30),N(69,o6,1,2,"div",31)(70,d6,5,14,"div",32),s()()(),N(71,p6,38,13,"div",33),s(),l(72,"div",34)(73,"h4",35),d(74,"Mis dise\xF1os guardados"),s(),l(75,"ul"),N(76,h6,5,3,"li",36),s()()()),e&2&&(c(6),Q("ngModel",n.design.nombre),c(6),Q("ngModel",n.design.widthMm),c(3),Q("ngModel",n.design.heightMm),c(3),Q("ngModel",n.design.marginMm),c(4),Q("ngModel",n.design.mode),c(3),Q("ngModel",n.design.mode),c(2),p("ngIf",n.design.mode!=="roll"),c(),p("ngIf",n.design.mode==="roll"),c(6),Q("ngModel",n.design.twoCols),c(3),Q("ngModel",n.design.splitPct),c(30),Ri("width",n.design.widthMm+"mm")("height",n.design.heightMm+"mm")("transform","scale("+n.zoom+")"),c(),Ri("padding","calc("+(n.design.marginMm||0)+"mm + "+n.SAFE_TOP_MM+"mm) "+(n.design.marginMm||0)+"mm "+(n.design.marginMm||0)+"mm "+(n.design.marginMm||0)+"mm"),c(),p("ngIf",n.design.twoCols),c(),p("ngForOf",n.design.elements),c(),p("ngIf",n.selected),c(5),p("ngForOf",n.disenos))},dependencies:[rt,it,nt,Xe,Gt,li,tt,Er,ze,Bi,Kn,_t,Ae,We,Be,Ta,Ns,Bs,Ct,Cc,a1],styles:[".name-label[_ngcontent-%COMP%]{font-size:large;color:#0257ac}.name-label[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.designer[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr 280px;gap:12px;align-items:start}.sidebar[_ngcontent-%COMP%]{padding:8px;border:1px solid #eee;border-radius:8px;background:#fde1e1}.center-col[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto auto;gap:12px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:6px 8px;align-items:center}.canvas-wrap[_ngcontent-%COMP%]{overflow:auto;border:1px dashed #ddd;padding:12px;background:repeating-conic-gradient(#fafafa 0% 25%,transparent 0% 50%) 50% / 16px 16px;min-height:320px}.label-canvas[_ngcontent-%COMP%]{transform-origin:top left;position:relative;background:#fff;box-shadow:0 0 0 1px #e8e8e8}.label-inner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%;display:block}.el[_ngcontent-%COMP%]{position:absolute;cursor:move}.el.selected[_ngcontent-%COMP%]{outline:1px dashed #3c7cff}.el[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1}.two-cols-guide[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:0;border-left:1px dashed rgba(0,0,0,.25);pointer-events:none}.props-card[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:8px;padding:10px;background:#c7f9e8}.design-list[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:8px;padding:10px;background:#c0f0fa}.design-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.design-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;padding:6px 8px;border-bottom:1px solid #f0f0f0;cursor:pointer}.design-list[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#f5f9ff}.design-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:0}.mini[_ngcontent-%COMP%]{font-size:12px;padding:2px 6px}.row-pos[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 4rem 4rem 4rem 4rem 4rem 4rem;column-gap:8px;align-items:center;margin:6px 0}.rowTexto[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 12rem 6rem 6rem 6rem 7rem 3rem;column-gap:8px;align-items:center;margin:6px 0}.rowline[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 80px 80px 80px 80px;column-gap:8px;align-items:center;margin:6px 0}.rowline[_ngcontent-%COMP%]   .lead[_ngcontent-%COMP%]{margin-right:4px;white-space:nowrap}@media (max-width: 520px){.rowline[_ngcontent-%COMP%]{grid-template-columns:auto 80px 80px 80px 80px}}"]})};var A_=hi(Pu()),ku=hi(ki());var Bc=class i{constructor(t){this.http=t}api=`${Ge.apiUrl}/labels/products`;search(t){let e=new Ht().set("farmaciaId",t.farmaciaId);return t.nombre&&(e=e.set("nombre",t.nombre)),t.categoria&&(e=e.set("categoria",t.categoria)),t.page&&(e=e.set("page",String(t.page))),t.limit&&(e=e.set("limit",String(t.limit))),t.sortBy&&(e=e.set("sortBy",t.sortBy)),t.sortDir&&(e=e.set("sortDir",t.sortDir)),this.http.get(this.api,{params:e,headers:new qe({"x-auth-token":localStorage.getItem("token")||""})})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var _6=["printHost"];function v6(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function x6(i,t){if(i&1&&(l(0,"option",42),d(1),s()),i&2){let e=t.$implicit;p("value",e._id),c(),k(e.nombre)}}function b6(i,t){i&1&&(l(0,"span"),y(1,"i",43),s())}function y6(i,t){i&1&&(l(0,"span"),d(1,"Imprimiendo\u2026"),s())}function C6(i,t){if(i&1&&(l(0,"span",44),d(1),s()),i&2){let e=_();c(),k(e.sortDir==="asc"?"\u25B2":"\u25BC")}}function S6(i,t){if(i&1&&(l(0,"span",44),d(1),s()),i&2){let e=_();c(),k(e.sortDir==="asc"?"\u25B2":"\u25BC")}}function w6(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td")(2,"input",45),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a._checked,r)||(a._checked=r),P(r)}),E("ngModelChange",function(){let r=T(e).$implicit,a=_();return P(a.onToggleRow(r))}),s()(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td"),d(12),s(),l(13,"td"),d(14),F(15,"currency"),s(),l(16,"td"),d(17),s()()}if(i&2){let e=t.$implicit;c(2),Q("ngModel",e._checked),c(2),k(e.nombre),c(2),k(e.codigoBarras),c(2),k(e.renglon1),c(2),k(e.renglon2),c(2),k(e.categoria),c(2),k(oe(15,8,e.precioVenta)),c(3),k(e.existencia)}}function E6(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=_().$implicit,n=_().$implicit,r=_(2);c(),k(r.valorCampo(n,e))}}function T6(i,t){if(i&1&&(l(0,"div"),d(1),s()),i&2){let e=_().$implicit,n=_().$implicit,r=_(2);c(),k(r.valorPrecio(n,e))}}function P6(i,t){i&1&&y(0,"img",56)}function k6(i,t){if(i&1&&(at(0),l(1,"div",52),at(2,53),N(3,E6,2,1,"div",54)(4,T6,2,1,"div",54)(5,P6,1,0,"img",55),ot(),s(),ot()),i&2){let e=t.$implicit,n=_(3);c(),Ri("left",e.x,"%")("top",e.y,"%")("width",e.w,"%")("height",e.h,"%"),p("ngStyle",n.styleTexto(e)),c(),p("ngSwitch",e.type),c(),p("ngSwitchCase","text"),c(),p("ngSwitchCase","price"),c(),p("ngSwitchCase","barcode")}}function I6(i,t){if(i&1&&(l(0,"section",49)(1,"div",50),N(2,k6,6,13,"ng-container",51),s()()),i&2){let e=_(2);Ri("width",e.lblWmm,"mm")("height",e.lblHmm,"mm"),c(),Ri("padding",e.padMm,"mm"),c(),p("ngForOf",e.design.elements)}}function M6(i,t){if(i&1&&(l(0,"div",46)(1,"div",47,0),N(3,I6,3,7,"section",48),s()()),i&2){let e=_();c(3),p("ngForOf",e.itemsParaImprimir)}}var Lc=class i{constructor(t,e,n,r){this.designsSvc=t;this.prodSvc=e;this.farmacia=n;this.cdr=r}mostrarPrint=!1;itemsParaImprimir=[];get seleccionados(){return this.productos.filter(t=>t._checked)}trackById=(t,e)=>e?._id;get lblW(){return this.lblWmm}get lblH(){return this.lblHmm}get pad(){return this.padMm}styleTexto(t){return{position:"absolute","font-weight":t.bold?"700":"400","font-size.px":t.fontSize||10,"text-align":t.align||"left",overflow:"hidden",display:"flex","align-items":"center","justify-content":t.align==="center"?"center":t.align==="right"?"flex-end":"flex-start","white-space":"nowrap","min-height.px":1}}isPrinting=!1;disenos=[];designId=null;design=null;fNombre="";fCategoria="";productos=[];allChecked=!1;farmacias=[];farmaciaId="";printHost;selectedIds=new Set;selectedItems=new Map;get totalSeleccionados(){return this.selectedIds.size}page=1;limit=20;totalFiltrado=0;totalPages=1;sortBy="nombre";sortDir="asc";lastQuerySig="";get lblWmm(){return 62}get lblHmm(){return this.design?.heightMm??30}get padMm(){return this.design?.marginMm??0}formatMoneyNoCents(t){return new Intl.NumberFormat("es-MX",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(Number(t)||0))}ngOnInit(){this.designsSvc.list().subscribe(e=>{this.disenos=e,e.length&&(this.designId=e[0]._id,this.loadDesign())});let t=localStorage.getItem("farmaciaId_print")||"";this.farmaciaId=t,this.cargarFarmacias()}normalizeDesign(t){let e=t?.size||{},n=t?.layout||{};return jt(Qe({},t),{widthMm:e.widthMm??t.widthMm??0,heightMm:e.heightMm??t.heightMm??0,marginMm:e.marginMm??t.marginMm??0,pageWidthMm:n.pageWidthMm??t.pageWidthMm??210,pageHeightMm:n.pageHeightMm??t.pageHeightMm??297,cols:n.columns??t.cols??1,rows:n.rows??t.rows??1,gapXmm:n.gapXmm??t.gapXmm??0,gapYmm:n.gapYmm??t.gapYmm??0,elements:t.elements??[]})}loadDesign(){this.designId&&this.designsSvc.get(this.designId).subscribe(t=>this.design=this.normalizeDesign(t))}cargarFarmacias(){this.farmacia.obtenerFarmacias().subscribe({next:t=>{if(this.farmacias=t||[],this.farmacias.length){let e=this.farmacias.some(n=>n._id===this.farmaciaId);(!this.farmaciaId||!e)&&(this.farmaciaId=this.farmacias[0]._id,localStorage.setItem("farmaciaId_print",this.farmaciaId)),this.buscar()}},error:()=>{this.farmacias=[]}})}makeQuerySig(t,e,n){let r=a=>(a||"").trim().toLowerCase().split(/\s+/).filter(Boolean).sort().join(" ");return`${t}|${r(e)}|${r(n)}`}buscar(){let t=this.farmaciaId?.trim();if(!t){ku.default.fire({icon:"info",title:"Aviso",text:"Debes seleccionar una farmacia.",timer:1500,showConfirmButton:!1});return}let e=this.makeQuerySig(t,this.fNombre,this.fCategoria);e!==this.lastQuerySig&&(this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.lastQuerySig=e),this.prodSvc.search({farmaciaId:t,nombre:(this.fNombre||"").trim(),categoria:(this.fCategoria||"").trim(),page:this.page,limit:this.limit,sortBy:this.sortBy,sortDir:this.sortDir}).subscribe(n=>{this.productos=(n.rows||[]).map(r=>{let a=String(r._id);return jt(Qe({},r),{_id:a,_checked:this.selectedIds.has(a)})}),this.allChecked=this.productos.length>0&&this.productos.every(r=>r._checked),this.totalFiltrado=n?.paginacion?.total??this.productos.length,this.totalPages=n?.paginacion?.totalPages??1,this.page=n?.paginacion?.page??1,this.limit=n?.paginacion?.limit??this.limit})}onToggleRow(t){let e=String(t._id);t._checked?(this.selectedIds.add(e),this.selectedItems.set(e,t)):(this.selectedIds.delete(e),this.selectedItems.delete(e)),this.allChecked=this.productos.length>0&&this.productos.every(n=>this.selectedIds.has(String(n._id)))}toggleAll(t){this.allChecked=t.target.checked;for(let e of this.productos){let n=String(e._id);e._checked=this.allChecked,this.allChecked?(this.selectedIds.add(n),this.selectedItems.set(n,e)):(this.selectedIds.delete(n),this.selectedItems.delete(n))}}onFarmaciaChange(){localStorage.setItem("farmaciaId_print",this.farmaciaId),this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.buscar()}limpiar(){this.fCategoria="",this.fNombre="",this.selectedIds.clear(),this.selectedItems.clear(),this.page=1,this.lastQuerySig=this.makeQuerySig(this.farmaciaId?.trim()||"","",""),this.buscar()}irPrimera(){this.page!==1&&(this.page=1,this.buscar())}irAnterior(){this.page>1&&(this.page--,this.buscar())}irSiguiente(){this.page<this.totalPages&&(this.page++,this.buscar())}irUltima(){this.page!==this.totalPages&&(this.page=this.totalPages,this.buscar())}cambiarLimit(t){this.limit=Number(t)||20,this.page=1,this.buscar()}nb="\xA0";safe(t){return t==null?"":String(t)}valorCampo(t,e){let n={nombre:this.safe(t?.nombre),renglon1:this.safe(t?.renglon1),renglon2:this.safe(t?.renglon2),codigoBarras:this.safe(t?.codigoBarras),precioVenta:this.safe(t?.precioVenta)},r=e.field?n[e.field]??"":e.text??"";e.uppercase&&typeof r=="string"&&(r=r.toUpperCase());let a=`${e.prefix||""}${r}${e.suffix||""}`;return a.trim()===""?this.nb:a}valorPrecio(t,e){let n=t?.precioVenta;if(n==null||n==="")return"";let r=Number(n);if(!Number.isFinite(r))return"";let a=this.formatMoneyNoCents(r),o=`${e.prefix||"$"}${a}${e.suffix||""}`;return e.uppercase?o.toUpperCase():o}makeBarcodeSVG(t,e={}){let n=(t||"").trim();if(!n)return'<svg width="1" height="1"></svg>';let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("preserveAspectRatio","xMidYMid meet");try{(0,A_.default)(r,n,{format:e.format||"CODE128",width:e.width||1,height:e.height||5,displayValue:!!e.displayValue,margin:0})}catch{}return r.outerHTML}cssFont(t){let e=(t.fontFamily||"system-ui, Arial, sans-serif").trim(),n=t.letterSpacing??0;return`font-family:${e};line-height:1;letter-spacing:${n}px;`}elToHtml(t,e){let n=`position:absolute;left:${e.x}%;top:${e.y}%;width:${e.w}%;height:${e.h}%;`,r=(e.fontFamily||"system-ui, Arial, sans-serif").replace(/"/g,"'"),a=`font-weight:${e.bold?700:400};font-size:${e.fontSize||10}px;font-family:${r};letter-spacing:${e.letterSpacing??0}px;display:flex;align-items:center;justify-content:${e.align==="center"?"center":e.align==="right"?"flex-end":"flex-start"};white-space:nowrap;overflow:hidden;line-height:1;`;if(e.type==="text"){let o=this.valorCampo(t,e);return`<div class="el text" style="${n}${a}">${o}</div>`}if(e.type==="price"){let o=this.valorPrecio(t,e);return`<div class="el price" style="${n}${a}">${o}</div>`}if(e.type==="barcode"){let o=this.valorCampo(t,jt(Qe({},e),{field:"codigoBarras"})).trim(),u=this.makeBarcodeSVG(o,{format:e.barcode?.symbology,width:e.barcode?.width,height:e.barcode?.height,displayValue:e.barcode?.displayValue});return`<div class="el barcode" style="${n}">${u}</div>`}return""}labelToHtml(t){let e=this.padMm,n=(this.design?.elements||[]).map(r=>this.elToHtml(t,r)).join("");return`
<section class="sheet">
  <div class="label-inner" style="position:relative;width:100%;height:100%;padding:${e}mm">
    ${n}
  </div>
</section>`}toggleSort(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.page=1,this.buscar()}sanitizeItemsForDesign(t){let e="\xA0",n=r=>{let a=r==null?"":String(r);return a.trim()===""?e:a};return(t||[]).map(r=>jt(Qe({},r),{nombre:n(r?.nombre),renglon1:n(r?.renglon1),renglon2:n(r?.renglon2),codigoBarras:(r?.codigoBarras??"").toString().trim(),precioVenta:r?.precioVenta===""||r?.precioVenta===null||r?.precioVenta===void 0?null:Number.isFinite(Number(r?.precioVenta))?Number(r?.precioVenta):null}))}printViaIframeStrict(t){return Le(this,null,function*(){if(navigator.userAgent.toLowerCase().includes("edg/")){let u=this.wrapForAutoPrint(t),m=new Blob([u],{type:"text/html"}),f=URL.createObjectURL(m),h=window.open(f,"_blank");if(!h){alert("Edge bloque\xF3 la ventana emergente. Permite popups para este sitio.");return}let g=()=>{try{URL.revokeObjectURL(f)}catch{}};try{h.addEventListener("unload",g,{once:!0})}catch{}return}let n="label-print-frame";document.getElementById(n)?.remove();let r=document.createElement("iframe");r.id=n,r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="0",r.setAttribute("sandbox","allow-modals allow-same-origin allow-scripts"),r.srcdoc=t,document.body.appendChild(r),yield new Promise(u=>{let m=()=>u();r.addEventListener("load",m,{once:!0}),setTimeout(m,500)});let a=r.contentWindow;if(!a){r.remove();return}let o=()=>{try{r.remove()}catch{}};try{a.addEventListener("afterprint",()=>setTimeout(o,50),{once:!0})}catch{}try{(a.matchMedia&&a.matchMedia("print"))?.addEventListener?.("change",m=>{m.matches||setTimeout(o,50)})}catch{}yield new Promise(u=>requestAnimationFrame(()=>requestAnimationFrame(u)));try{a.focus()}catch{}})}buildPrintHTML(t,e,n,r){let a=Number(e)||62,o=Number(n)||30,u=Number(r)||0,m=2,f=2,h=this.collectFontImports(),g=`
      <style>
        @page { size: ${a}mm ${o}mm; margin: 0; }

        html, body {
          margin: 0 !important;
          padding: 0 !important;
          width: ${a}mm !important;
          height: auto !important;            /* que el body no imponga alto */
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
          background: #fff;
        }

        /* Cada etiqueta = 1 p\xE1gina */
        .sheet {
          width: ${a}mm;
          height: 100vh;                       /* === exactamente el alto de p\xE1gina */
          min-height: 100vh;
          max-height: 100vh;
          page-break-after: always;
          break-after: page;
          page-break-inside: avoid;
          break-inside: avoid-page;            /* evita que se parta */
          -webkit-region-break-inside: avoid;  /* WebKit legacy */
          margin: 0; padding: 0; overflow: hidden; position: relative;
          background: #fff;
        }
        .sheet:last-child { page-break-after: auto; break-after: auto; }

        .label-inner {
          position: relative;
          width: 100%;
          height: 100%;
          box-sizing: border-box;
          padding: calc(${u}mm + ${m}mm) ${u}mm calc(${u}mm + ${f}mm) ${u}mm;

        .el { position:absolute; overflow:hidden; }
        .el.barcode svg { display:block; width:100%; height:100%; }
        .el.text, .el.price { line-height:1; white-space:nowrap; }
      </style>`;return`<!doctype html><html><head><meta charset="utf-8">${h}${g}</head><body>${t}
      <script>
      (async function(){
        try{ if (document.fonts && document.fonts.ready) { await document.fonts.ready; } }catch(e){}
        requestAnimationFrame(()=>requestAnimationFrame(()=>{
          try{ window.focus(); }catch(e){}
          try{ window.print(); }catch(e){}
        }));
        try{
          window.addEventListener('afterprint', ()=>{ setTimeout(()=>{ try{ window.close(); }catch(e){} }, 100); }, {once:true});
        }catch(e){}
      })();
      <\/script></body></html>`}testQL(){return Le(this,null,function*(){let a=`
  <!doctype html><html><head><meta charset="utf-8">
    <style>
      @page { size: 62mm 20mm; margin:0; }
      html,body { margin:0; padding:0; -webkit-print-color-adjust:exact; print-color-adjust:exact; }
      .sheet { width:62mm; height:20mm; margin:0; padding:0; overflow:hidden;
               position:relative; page-break-after:always; break-after:page; }
      .label-inner { width:100%; height:100%; position:relative; }
      .el { position:absolute; }
    </style>
  </head><body>
    <section class="sheet">
      <div class="label-inner" style="position:relative;width:100%;height:100%;padding:2mm">
        <div class="el" style="position:absolute;left:5%;top:20%;font-size:12px;">TEST 62\xD720</div>
      </div>
    </section></body></html>`;yield new Promise(o=>{let u=document.createElement("iframe");u.style.position="fixed",u.style.right="0",u.style.bottom="0",u.style.width="0",u.style.height="0",u.style.border="0",document.body.appendChild(u);let m=()=>setTimeout(()=>{try{u.remove()}catch{}o()},300);u.onload=()=>Le(null,null,function*(){let f=u.contentWindow,h=!1,g=()=>{h||(h=!0,m())};f.addEventListener("afterprint",g,{once:!0}),setTimeout(g,6e3),yield new Promise(v=>requestAnimationFrame(()=>requestAnimationFrame(v)));try{f.focus()}catch{}f.print()}),u.srcdoc=a})})}wrapForAutoPrint(t){return`<!doctype html>
<html>
<head><meta charset="utf-8"></head>
<body>
${t}
<script>
(function () {
  function go(){ try{ window.focus(); }catch(e){}
    requestAnimationFrame(()=>requestAnimationFrame(()=>{ try{ window.print(); }catch(e){} }));
  }
  function bye(){ setTimeout(()=>{ try{ window.close(); }catch(e){} }, 120); }
  try{ window.addEventListener('afterprint', bye, {once:true}); }catch(e){}
  try{
    var mm = window.matchMedia && window.matchMedia('print');
    if (mm && mm.addEventListener) mm.addEventListener('change', e=>{ if(!e.matches) bye(); });
  }catch(e){}
  if (document.readyState === 'complete' || document.readyState === 'interactive') go();
  else window.addEventListener('DOMContentLoaded', go, {once:true});
})();
<\/script>
</body></html>`}previsualizar(){return Le(this,null,function*(){if(!(!this.design||this.selectedIds.size===0||this.isPrinting)){this.isPrinting=!0;try{let t=new Map;for(let o of this.selectedItems.values())t.set(String(o._id),o);let e=this.sanitizeItemsForDesign(Array.from(t.values()));if(navigator.userAgent.toLowerCase().includes("edg/")){yield ku.default.fire({icon:"warning",title:"Usa Chrome para imprimir etiquetas",html:`
      La impresi\xF3n de etiquetas no es estable en Microsoft Edge en este equipo.<br>
      Por favor abre este m\xF3dulo en <b>Google Chrome</b> y vuelve a intentarlo.
    `,confirmButtonText:"Entendido"});return}let r=e.map(o=>this.labelToHtml(o)).join(""),a=this.buildPrintHTML(r,this.lblWmm,this.lblHmm,this.padMm);yield this.printViaIframeStrict(a)}finally{this.isPrinting=!1,this.cdr.detectChanges()}}})}collectFontImports(){let t=new Set;return(this.design?.elements||[]).forEach(n=>{let r=(n.fontFamily||"").toLowerCase();r.includes("inter")&&t.add("Inter:wght@400;700"),r.includes("roboto")&&t.add("Roboto:wght@400;700"),r.includes("lato")&&t.add("Lato:wght@400;700"),r.includes("montserrat")&&t.add("Montserrat:wght@400;700"),r.includes("open sans")&&t.add("Open+Sans:wght@400;700"),r.includes("poppins")&&t.add("Poppins:wght@400;700"),r.includes("merriweather")&&t.add("Merriweather:wght@400;700"),r.includes("playfair")&&t.add("Playfair+Display:wght@400;700"),r.includes("noto sans")&&t.add("Noto+Sans:wght@400;700"),r.includes("noto serif")&&t.add("Noto+Serif:wght@400;700")}),t.size?['<link rel="preconnect" href="https://fonts.googleapis.com">','<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>',`<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=${Array.from(t).join("&family=")}&display=swap">`].join(""):""}static \u0275fac=function(e){return new(e||i)(te(yo),te(Bc),te(Zt),te(Wt))};static \u0275cmp=Te({type:i,selectors:[["app-etiquetas-print"]],viewQuery:function(e,n){if(e&1&&Ot(_6,5),e&2){let r;St(r=wt())&&(n.printHost=r.first)}},decls:93,vars:32,consts:[["printHost",""],[1,"etiquetas"],[1,"titulo","text-center"],[1,"filtros"],[1,"row","g-2","align-items-end"],[1,"col-md-2"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"col-md-3"],["placeholder","Nombre",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],["placeholder","Categor\xEDa",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],[1,"col-md-1"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"col-md-1",2,"margin-top","1.3rem"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click"],[1,"fas","fa-times"],[1,"row","g-2","align-items-end","mb-2"],[1,"col-md-6",2,"margin-top","1.3rem"],["matTooltip","Imprimir","aria-label","Imprimir",1,"btn-amarillo","btn-icon-only",3,"click","disabled"],[4,"ngIf"],[1,"col-md-6",2,"margin-top","1.3rem","text-align","end"],[1,"btn-gris",3,"click","disabled"],[1,"tabla"],["type","checkbox",3,"change","checked"],["title","Ordenar por nombre",1,"sortable",3,"click"],["class","sort",4,"ngIf"],["title","Ordenar por categor\xEDa",1,"sortable",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-2","paginacion"],["matTooltip","Inicio",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",3,"click","disabled"],[1,"fa","fa-angle-left"],["matTooltip","Siguiente",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["class","etiquetas-impresion",4,"ngIf"],[3,"value"],[1,"bi","bi-printer"],[1,"sort"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"etiquetas-impresion"],[1,"print-root"],["class","sheet",3,"width","height",4,"ngFor","ngForOf"],[1,"sheet"],[1,"label-inner"],[4,"ngFor","ngForOf"],[1,"el",3,"ngStyle"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","barcode",4,"ngSwitchCase"],[1,"barcode"]],template:function(e,n){e&1&&(l(0,"div",1)(1,"h2",2),d(2,"Impresi\xF3n de etiquetas"),s(),l(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),d(7,"Farmacia"),s(),l(8,"div")(9,"select",7),Z("ngModelChange",function(a){return J(n.farmaciaId,a)||(n.farmaciaId=a),a}),E("change",function(){return n.onFarmaciaChange()}),l(10,"option",8),d(11,"\u2014 Selecciona \u2014"),s(),N(12,v6,2,2,"option",9),s()()(),l(13,"div",5)(14,"label",6),d(15,"Dise\xF1o"),s(),l(16,"div")(17,"select",10),Z("ngModelChange",function(a){return J(n.designId,a)||(n.designId=a),a}),E("change",function(){return n.loadDesign()}),N(18,x6,2,2,"option",9),s()()(),l(19,"div",11)(20,"label",6),d(21,"Nombre"),s(),l(22,"div")(23,"input",12),Z("ngModelChange",function(a){return J(n.fNombre,a)||(n.fNombre=a),a}),E("keyup.enter",function(){return n.buscar()}),s()()(),l(24,"div",11)(25,"label",6),d(26,"Categor\xEDa"),s(),l(27,"div")(28,"input",13),Z("ngModelChange",function(a){return J(n.fCategoria,a)||(n.fCategoria=a),a}),E("keyup.enter",function(){return n.buscar()}),s()()(),l(29,"div",14)(30,"label",6),d(31,"x p\xE1g.:"),s(),l(32,"div")(33,"select",15),E("ngModelChange",function(a){return n.cambiarLimit(a)}),l(34,"option",16),d(35,"10"),s(),l(36,"option",16),d(37,"20"),s(),l(38,"option",16),d(39,"50"),s(),l(40,"option",16),d(41,"100"),s()()()(),l(42,"div",17)(43,"button",18),E("click",function(){return n.limpiar()}),y(44,"i",19),s()()(),l(45,"div",20)(46,"div",21)(47,"button",22),E("click",function(){return n.previsualizar()}),N(48,b6,2,0,"span",23)(49,y6,2,0,"span",23),s()(),l(50,"div",24)(51,"button",25),E("click",function(){return n.buscar()}),d(52,"Buscar"),s()()()(),l(53,"table",26)(54,"thead")(55,"tr")(56,"th")(57,"input",27),E("change",function(a){return n.toggleAll(a)}),s()(),l(58,"th",28),E("click",function(){return n.toggleSort("nombre")}),d(59," Nombre "),N(60,C6,2,1,"span",29),s(),l(61,"th"),d(62,"C\xF3digo barras"),s(),l(63,"th"),d(64,"Rengl\xF3n 1"),s(),l(65,"th"),d(66,"Rengl\xF3n 2"),s(),l(67,"th",30),E("click",function(){return n.toggleSort("categoria")}),d(68," Categor\xEDa "),N(69,S6,2,1,"span",29),s(),l(70,"th"),d(71,"Precio"),s(),l(72,"th"),d(73,"Exist."),s()()(),l(74,"tbody"),N(75,w6,18,10,"tr",31),s()()(),l(76,"div",32)(77,"span")(78,"b"),d(79,"Etiquetas a imprimir:"),s(),d(80),s()(),l(81,"div",32)(82,"button",33),E("click",function(){return n.irPrimera()}),y(83,"i",34),s(),l(84,"button",35),E("click",function(){return n.irAnterior()}),y(85,"i",36),s(),l(86,"span"),d(87),s(),l(88,"button",37),E("click",function(){return n.irSiguiente()}),y(89,"i",38),s(),l(90,"button",39),E("click",function(){return n.irUltima()}),y(91,"i",40),s()(),N(92,M6,4,1,"div",41)),e&2&&(c(9),Q("ngModel",n.farmaciaId),c(3),p("ngForOf",n.farmacias),c(5),Q("ngModel",n.designId),p("disabled",!n.farmaciaId||!(n.disenos&&n.disenos.length)),c(),p("ngForOf",n.disenos),c(5),Q("ngModel",n.fNombre),p("disabled",!n.farmaciaId),c(5),Q("ngModel",n.fCategoria),p("disabled",!n.farmaciaId),c(5),p("ngModel",n.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100),c(7),p("disabled",!n.farmaciaId||n.seleccionados.length===0||!n.design||n.isPrinting),c(),p("ngIf",!n.isPrinting),c(),p("ngIf",n.isPrinting),c(2),p("disabled",!n.farmaciaId),c(6),p("checked",n.allChecked),c(3),p("ngIf",n.sortBy==="nombre"),c(9),p("ngIf",n.sortBy==="categoria"),c(6),p("ngForOf",n.productos)("ngForTrackBy",n.trackById),c(5),R(" ",n.totalSeleccionados,""),c(2),p("disabled",n.page<=1),c(2),p("disabled",n.page<=1),c(3),Cn("\xA0 ",n.totalFiltrado," productos. P\xE1gina ",n.page," / ",n.totalPages," \xA0"),c(),p("disabled",n.page>=n.totalPages),c(2),p("disabled",n.page>=n.totalPages),c(2),p("ngIf",n.mostrarPrint))},dependencies:[rt,it,nt,Xe,li,tt,ze,_t,Ae,We,Be,Ta,Ns,Bs,Nt,Cc,Lt,ut],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.btn-icon-only[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;padding:0;display:inline-flex;align-items:center;justify-content:center;border-radius:.5rem}.btn-icon-only[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.sortable[_ngcontent-%COMP%]:hover{text-decoration:underline}.sort[_ngcontent-%COMP%]{margin-left:6px;font-size:.85em;opacity:.7}.barra[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:6px}.etiquetas-impresion[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;z-index:9999}.page[_ngcontent-%COMP%]{margin:0 auto;position:relative}.labels-grid[_ngcontent-%COMP%]{display:grid}.label-box[_ngcontent-%COMP%]{background:#fff;border:1px dashed transparent;position:relative}.print-root[_ngcontent-%COMP%]{width:62mm}.sheet[_ngcontent-%COMP%]{position:relative;margin:0;padding:0}.label-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}.el[_ngcontent-%COMP%]{position:absolute}img.barcode[_ngcontent-%COMP%]{display:block}@media print{body[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden!important}.etiquetas-impresion[_ngcontent-%COMP%], .etiquetas-impresion[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:visible!important}.etiquetas-impresion[_ngcontent-%COMP%]{position:static!important;margin:0!important;padding:0!important;inset:auto!important;z-index:auto!important;background:#fff!important;display:block!important}.sheet[_ngcontent-%COMP%]{margin:0!important;padding:0!important;page-break-after:always;break-after:page;page-break-inside:avoid;break-inside:avoid;overflow:hidden!important;position:relative}.sheet[_ngcontent-%COMP%]:last-child{page-break-after:auto;break-after:auto}svg[_ngcontent-%COMP%], img.barcode[_ngcontent-%COMP%]{display:block!important;max-width:100%!important;max-height:100%!important}}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}.page[_ngcontent-%COMP%]{width:100%;height:100%}img[_ngcontent-%COMP%]{image-rendering:auto}"]})};var Wn=hi(ki());var Vc=class i{constructor(t){this.http=t}api=Ge.apiUrl;getPresupuesto(t){let e=new Ht().set("fechaIni",t.fechaIni).set("fechaFin",t.fechaFin);t.categoria&&(e=e.set("categoria",t.categoria)),t.nombre&&(e=e.set("nombre",t.nombre)),t.soloExistMenorQueVentas!==void 0&&(e=e.set("soloExistMenorQueVentas",String(t.soloExistMenorQueVentas))),t.sortBy&&(e=e.set("sortBy",t.sortBy)),t.sortDir&&(e=e.set("sortDir",t.sortDir)),t.page&&(e=e.set("page",String(t.page))),t.limit&&(e=e.set("limit",String(t.limit)));let n=new qe({});return this.http.get(`${this.api}/reportes/presupuesto`,{params:e,headers:n})}grabar(t){let e=new qe({});return this.http.post(`${this.api}/reportes/presupuesto/grabar`,{items:t},{headers:e})}static \u0275fac=function(e){return new(e||i)(ct(dt))};static \u0275prov=Ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var A6=()=>({standalone:!0});function O6(i,t){if(i&1){let e=ie();l(0,"button",61),E("click",function(){T(e);let r=_();return P(r.limpiarNombre())}),y(1,"fa-icon",62),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function D6(i,t){if(i&1){let e=ie();l(0,"button",63),E("click",function(){T(e);let r=_();return P(r.limpiarCategoria())}),y(1,"fa-icon",62),s()}if(i&2){let e=_();c(),p("icon",e.faTimes)}}function R6(i,t){if(i&1){let e=ie();l(0,"tr")(1,"td")(2,"input",64),Z("ngModelChange",function(r){let a=T(e).$implicit;return J(a.grabar,r)||(a.grabar=r),P(r)}),E("ngModelChange",function(){T(e);let r=_();return P(r.onRowCheckChange())}),s()(),l(3,"td",65),d(4),s(),l(5,"td",66),d(6),s(),l(7,"td",65),d(8),s(),l(9,"td",67),d(10),s(),l(11,"td",67),d(12),s(),l(13,"td",67),d(14),s(),l(15,"td",68),d(16),s(),l(17,"td",67),d(18),s(),l(19,"td",67),d(20),s(),l(21,"td",67),d(22),s()()}if(i&2){let e=t.$implicit,n=_();c(2),Q("ngModel",e.grabar),p("ngModelOptions",Qt(18,A6)),c(),p0("title",e.producto),c(),k(e.producto),c(2),k(e.codigoBarras),c(),p0("title",e.categoria),c(),k(e.categoria),c(2),k(n.fmtNumber(e.existencia)),c(2),k(n.fmtNumber(e.stockMax)),c(2),k(n.fmtNumber(e.stockMin)),c(2),k(n.fmtNumber(e.vendidosSMaxE)),c(2),k(n.fmtNumber(e.sMinE)),c(),Re("text-danger",e.comprar>0)("fw-semibold",e.comprar>0),c(),R(" ",n.fmtNumber(e.comprar)," "),c(2),k(n.fmtMoney(e.costoEst))}}function N6(i,t){i&1&&(l(0,"tr")(1,"td",69),d(2,"Sin resultados"),s()())}var Uc=class i{constructor(t){this.svc=t}faTimes=_i;get totalPages(){return Math.max(Math.ceil(this.totalRows/this.limit),1)}isFirstPage(){return this.page===1}isLastPage(){return this.page>=this.totalPages}allRows=[];filteredAll=[];get filteredCount(){return this.filteredAll.length}fechaIni="";fechaFin="";categoria="";nombre="";soloExistMenorQueVentas=!1;rows=[];totalRows=0;totalCostoEst=0;page=1;limit=20;sortBy="nombre";sortDir="asc";cargando=!1;seleccionarTodos=!1;get selectedCount(){return this.allRows.reduce((t,e)=>t+(e.grabar?1:0),0)}ngOnInit(){this.setFechasPorDefecto()}limpiarCategoria(){this.categoria="",this.onFiltroChange()}limpiarNombre(){this.nombre="",this.onFiltroChange()}toLocalISODate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}setFechasPorDefecto(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaIni=this.toLocalISODate(e),this.fechaFin=this.toLocalISODate(t)}ordenarPor(t){this.sortBy===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.applyClientView()}cambiarPagina(t){let e=this.totalPages,n=this.page+t;n<1&&(n=1),n>e&&(n=e),n!==this.page&&(this.page=n,this.applyClientView())}irAPagina(t){let e=this.totalPages;t>=1&&t<=e&&(this.page=t,this.applyClientView())}cambiarLimit(t){this.limit=t,this.applyClientView(!0)}onFiltroChange(){this.applyClientView(!0)}toggleSeleccionTodos(){for(let t of this.filteredAll)t.grabar=this.seleccionarTodos;this.rows=[...this.rows]}onRowCheckChange(){this.recalcSeleccionTodos()}showLoader(t="Buscando..."){Wn.default.fire({title:t,text:"Contando ventas de los productos, calculando stocks",allowOutsideClick:!1,didOpen:()=>Wn.default.showLoading()})}closeLoader(){Wn.default.isVisible()&&Wn.default.close()}buscar(t=!1){return Le(this,null,function*(){if(!this.cargando){if(!this.fechaIni||!this.fechaFin){yield Wn.default.fire("Fechas requeridas","Debes elegir fecha inicial y final","info");return}t&&(this.page=1),this.cargando=!0,this.showLoader("Buscando...");try{let e=yield Ti(this.svc.getPresupuesto({fechaIni:this.fechaIni,fechaFin:this.fechaFin,page:1,limit:1e5}));this.allRows=(e?.rows||[]).map(n=>jt(Qe({},n),{grabar:n.grabar??!1})),this.applyClientView(!0),this.seleccionarTodos=!1}catch(e){console.error(e),yield Wn.default.fire("Error",e?.error?.mensaje||"No se pudo cargar el reporte","error")}finally{this.closeLoader(),this.cargando=!1}}})}recalcSeleccionTodos(){this.seleccionarTodos=this.filteredAll.length>0&&this.filteredAll.every(t=>!!t.grabar)}applyClientView(t=!1){t&&(this.page=1);let e=v=>(v||"").toLowerCase().trim(),n=v=>e(v).split(/\s+/).filter(Boolean),r=n(this.nombre),a=n(this.categoria),o=this.allRows.filter(v=>{let b=r.every(C=>v.producto?.toLowerCase().includes(C)),w=a.every(C=>v.categoria?.toLowerCase().includes(C)),x=!this.soloExistMenorQueVentas||(v.existencia??0)<(v.vendidosSMaxE??0);return b&&w&&x});this.filteredAll=o;let u=this.sortDir==="asc"?1:-1,m=v=>String(v??"").toLowerCase(),f=v=>Number.isFinite(v)?Number(v):0;o=[...o].sort((v,b)=>{switch(this.sortBy){case"nombre":return u*(m(v.producto)>m(b.producto)?1:-1);case"categoria":return u*(m(v.categoria)>m(b.categoria)?1:-1);case"existencia":return u*(f(v.existencia)-f(b.existencia));case"vendidos":return u*(f(v.vendidosSMaxE)-f(b.vendidosSMaxE));default:return 0}}),this.totalCostoEst=o.reduce((v,b)=>v+(b.costoEst??0),0),this.totalRows=o.length;let h=(this.page-1)*this.limit,g=h+this.limit;this.rows=o.slice(h,g),this.recalcSeleccionTodos()}grabarSeleccionados(){return Le(this,null,function*(){let t=this.allRows.filter(n=>n.grabar).map(n=>({productoId:n._id,vendidosSMaxE:n.vendidosSMaxE}));if(t.length===0){yield Wn.default.fire("Aviso","No hay renglones marcados para grabar","info");return}if((yield Wn.default.fire({icon:"question",title:"Confirmar actualizaci\xF3n",html:`
      Se actualizar\xE1 <b>stockM\xE1ximo = Vendidos SMaxE</b> y 
      <b>stockM\xEDnimo = ceil(30% de stockM\xE1ximo)</b> en ${t.length} productos.
      <br><br>\xBFDeseas continuar?
    `,showCancelButton:!0,confirmButtonText:"S\xED, actualizar",cancelButtonText:"Cancelar"})).isConfirmed){this.showLoader("Aplicando cambios...");try{let n=yield Ti(this.svc.grabar(t));yield Wn.default.fire("Listo",`Productos modificados: ${n?.modified??0}`,"success"),this.buscar(!1)}catch(n){console.error(n),yield Wn.default.fire("Error",n?.error?.mensaje||"No se pudo grabar","error")}finally{this.closeLoader()}}})}fmtNumber(t){return(t??0).toLocaleString("es-MX")}fmtMoney(t){return(t??0).toLocaleString("es-MX",{style:"currency",currency:"MXN",maximumFractionDigits:2})}exportarExcel(){let t=this.filteredAll.map(h=>({Producto:h.producto,"Cod. Barras":h.codigoBarras,Categor\u00EDa:h.categoria,Existencia:h.existencia??0,"Stock M\xE1x":h.stockMax??0,"Stock M\xEDn":h.stockMin??0,"Vendidos StockMax":h.vendidosSMaxE??0,"StockMin (30%)":h.sMinE??0,Comprar:h.comprar??0,"Costo Estimado":Number((h.costoEst??0).toFixed(2))})),e=rn.json_to_sheet(t,{header:["Producto","Cod. Barras","Categor\xEDa","Existencia","Stock M\xE1x","Stock M\xEDn","Vendidos StockMax","StockMin (30%)","Comprar","Costo Estimado"],skipHeader:!1});e["!cols"]=[{wch:40},{wch:14},{wch:18},{wch:12},{wch:12},{wch:12},{wch:16},{wch:14},{wch:12},{wch:16}];let n=t.length,r=this.filteredAll.reduce((h,g)=>h+(g.costoEst??0),0);rn.sheet_add_aoa(e,[["","","","","","","","","TOTAL Costo Est.:",Number(r.toFixed(2))]],{origin:-1});let a=2,o=a+n-1;for(let h=a;h<=o+1;h++){let g=rn.encode_cell({c:9,r:h-1}),v=e[g];v&&typeof v.v=="number"&&(v.z="#,##0.00")}let u=rn.book_new();rn.book_append_sheet(u,e,"Presupuesto");let m=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),f=`presupuesto_${this.fechaIni}_a_${this.fechaFin}_${m}.xlsx`;Kl(u,f)}static \u0275fac=function(e){return new(e||i)(te(Vc))};static \u0275cmp=Te({type:i,selectors:[["app-reporte-presupuesto"]],decls:128,vars:35,consts:[[1,"titulo",2,"text-align","center"],[1,"card-body"],[1,"row","mb-1",3,"ngSubmit"],[1,"col-sm-2"],[1,"form-label"],["type","date","name","fechaIni","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","fechaFin","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-sm-3"],[1,"form-label",2,"white-space","nowrap"],[1,"position-relative"],["type","text","name","nombre",1,"form-control",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar nombre","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],["type","text","name","categoria",1,"form-control",3,"ngModelChange","ngModel"],["type","button","matTooltip","Limpiar categor\xEDa","class","btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico",3,"click",4,"ngIf"],[1,"col-sm-2","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","name","soloExistMenorQueVentas",1,"form-check-input",3,"ngModelChange","ngModel"],["for","chkExist",1,"form-check-label"],[1,"col-sm-2","mt-2"],["name","limit",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"col-sm-10","d-flex","align-items-end","justify-content-end","mt-2"],["type","submit","matTooltip","Calcular y contar las ventas del periodo Fecha Inicial y Fecha Final",1,"btn-gris",3,"disabled"],[1,"d-flex","justify-content-between","align-items-center","mb-2","acciones-container"],["type","checkbox","id","chkTodos",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","chkTodos",1,"form-check-label"],[1,"d-flex","gap-2"],[1,"btn-amarillo",3,"click","disabled"],["matTooltip","Grabar nuevos stocks m\xEDn y m\xE1x, de los productos seleccionados",1,"btn-verde",3,"click","disabled"],[1,"table-responsive"],[1,"tabla"],[1,"col-grab"],[1,"col-prod"],[1,"col-cb"],[1,"col-cat"],[1,"col-n1"],[1,"col-num"],["matTooltip","Grabar stocks M\xE1x y M\xEDn estimados"],[1,"sortable",3,"click"],["matTooltip","Existencia en almac\xE9n",1,"sortable","text-end",3,"click"],["matTooltip","stock M\xE1x actual en almac\xE9n",1,"text-end"],["matTooltip","stock M\xEDn actual en almac\xE9n",1,"text-end"],["matTooltip","Productos vendidos, stock M\xE1x estimado.",1,"sortable","text-end",3,"click"],["matTooltip","Stock M\xEDn estimado",1,"text-end"],["matTooltip","# productos requeridos p/alcanzar stock M\xE1x estimado",1,"text-end"],["matTooltip","Costo estimado",1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","10",1,"text-end"],[1,"text-end"],[1,"d-flex","justify-content-between","align-items-center","mt-2","paginacion"],[1,"btn-group"],["matTooltip","Inicio",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-double-left"],["matTooltip","Anterior",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-left"],[1,"btn","btn-outline-secondary","btn-sm"],["matTooltip","Siguiente",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-right"],["matTooltip","Fin",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa","fa-angle-double-right"],["type","button","matTooltip","Limpiar nombre",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],[3,"icon"],["type","button","matTooltip","Limpiar categor\xEDa",1,"btn-icon-chico","btn-sm","btn-light","position-absolute","top-50","end-0","translate-middle-y","btn-rojo-chico",3,"click"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"truncate",3,"title"],[1,"mono"],[1,"text-end","nowrap"],[1,"text-end","nowrap","fw-semibold"],["colspan","11",1,"text-center","text-muted","py-3"]],template:function(e,n){e&1&&(l(0,"h3",0),d(1,"Reporte de Presupuesto"),s(),l(2,"div",1)(3,"form",2),E("ngSubmit",function(){return n.buscar(!0)}),l(4,"div",3)(5,"label",4),d(6,"Fecha inicial *"),s(),l(7,"input",5),Z("ngModelChange",function(a){return J(n.fechaIni,a)||(n.fechaIni=a),a}),s()(),l(8,"div",3)(9,"label",4),d(10,"Fecha final *"),s(),l(11,"input",6),Z("ngModelChange",function(a){return J(n.fechaFin,a)||(n.fechaFin=a),a}),s()(),l(12,"div",7)(13,"label",8),d(14,"Nombre"),s(),l(15,"div",9)(16,"input",10),Z("ngModelChange",function(a){return J(n.nombre,a)||(n.nombre=a),a}),E("ngModelChange",function(){return n.onFiltroChange()}),s(),N(17,O6,2,1,"button",11),s()(),l(18,"div",7)(19,"label",8),d(20,"Categor\xEDa"),s(),l(21,"div",9)(22,"input",12),Z("ngModelChange",function(a){return J(n.categoria,a)||(n.categoria=a),a}),E("ngModelChange",function(){return n.onFiltroChange()}),s(),N(23,D6,2,1,"button",13),s()(),l(24,"div",14)(25,"div",15)(26,"input",16),Z("ngModelChange",function(a){return J(n.soloExistMenorQueVentas,a)||(n.soloExistMenorQueVentas=a),a}),E("ngModelChange",function(){return n.onFiltroChange()}),s(),l(27,"label",17),d(28," Existencia < Vendidos "),s()()(),l(29,"div",18)(30,"label",4),d(31,"Registros por p\xE1gina"),s(),l(32,"select",19),E("ngModelChange",function(a){return n.cambiarLimit(a)}),l(33,"option",20),d(34,"10"),s(),l(35,"option",20),d(36,"20"),s(),l(37,"option",20),d(38,"50"),s(),l(39,"option",20),d(40,"100"),s()()(),l(41,"div",21)(42,"button",22),d(43),s()()(),l(44,"div",23)(45,"div",15)(46,"input",24),Z("ngModelChange",function(a){return J(n.seleccionarTodos,a)||(n.seleccionarTodos=a),a}),E("change",function(){return n.toggleSeleccionTodos()}),s(),l(47,"label",25),d(48," Seleccionar todos (Grabar stocks) "),s()(),l(49,"div",26)(50,"button",27),E("click",function(){return n.exportarExcel()}),d(51," Exportar a Excel "),s(),l(52,"button",28),E("click",function(){return n.grabarSeleccionados()}),d(53," Grabar seleccionados "),s()()(),l(54,"div",29)(55,"table",30)(56,"colgroup"),y(57,"col",31)(58,"col",32)(59,"col",33)(60,"col",34)(61,"col",35)(62,"col",35)(63,"col",35)(64,"col",36)(65,"col",36)(66,"col",35)(67,"col",36),s(),l(68,"thead")(69,"tr")(70,"th",37),d(71,"Gr"),s(),l(72,"th",38),E("click",function(){return n.ordenarPor("nombre")}),d(73,"Producto "),l(74,"span"),d(75,"\u25B2\u25BC"),s()(),l(76,"th"),d(77,"Cod. Barras"),s(),l(78,"th",38),E("click",function(){return n.ordenarPor("categoria")}),d(79,"Categor\xEDa "),l(80,"span"),d(81,"\u25B2\u25BC"),s()(),l(82,"th",39),E("click",function(){return n.ordenarPor("existencia")}),d(83,"Ex. "),l(84,"span"),d(85,"\u25B2\u25BC"),s()(),l(86,"th",40),d(87,"S M\xE1x"),s(),l(88,"th",41),d(89,"S M\xEDn"),s(),l(90,"th",42),E("click",function(){return n.ordenarPor("vendidos")}),d(91,"Vend. "),l(92,"span"),d(93,"\u25B2\u25BC"),s()(),l(94,"th",43),d(95,"Stk M\xEDn Es"),s(),l(96,"th",44),d(97,"Comp."),s(),l(98,"th",45),d(99,"Costo Est"),s()()(),l(100,"tbody"),N(101,R6,23,19,"tr",46)(102,N6,3,0,"tr",47),s(),l(103,"tfoot")(104,"tr")(105,"td",48)(106,"b"),d(107,"Total Costo Est. (todas las filas filtradas):"),s()(),l(108,"td",49)(109,"b"),d(110),s()()()()()(),l(111,"div",50)(112,"div"),d(113," Total: "),l(114,"b"),d(115),s(),d(116," productos "),s(),l(117,"div",51)(118,"button",52),E("click",function(){return n.irAPagina(1)}),y(119,"i",53),s(),l(120,"button",54),E("click",function(){return n.cambiarPagina(-1)}),y(121,"i",55),s(),l(122,"button",56),d(123),s(),l(124,"button",57),E("click",function(){return n.cambiarPagina(1)}),y(125,"i",58),s(),l(126,"button",59),E("click",function(){return n.irAPagina(n.totalPages)}),y(127,"i",60),s()()()()),e&2&&(c(7),Q("ngModel",n.fechaIni),c(4),Q("ngModel",n.fechaFin),c(5),Q("ngModel",n.nombre),c(),p("ngIf",n.nombre),c(5),Q("ngModel",n.categoria),c(),p("ngIf",n.categoria),c(3),Q("ngModel",n.soloExistMenorQueVentas),c(6),p("ngModel",n.limit),c(),p("ngValue",10),c(2),p("ngValue",20),c(2),p("ngValue",50),c(2),p("ngValue",100),c(3),p("disabled",n.cargando),c(),R(" ",n.cargando?"Contando y Calculando...":"Calcular ventas"," "),c(3),Q("ngModel",n.seleccionarTodos),c(4),p("disabled",n.filteredCount===0),c(2),p("disabled",n.cargando||n.selectedCount===0),c(22),Re("active",n.sortBy==="nombre"),c(6),Re("active",n.sortBy==="categoria"),c(4),Re("active",n.sortBy==="existencia"),c(8),Re("active",n.sortBy==="vendidos"),c(9),p("ngForOf",n.rows),c(),p("ngIf",n.rows.length===0&&!n.cargando),c(8),k(n.fmtMoney(n.totalCostoEst)),c(5),k(n.totalRows),c(3),p("disabled",n.isFirstPage()),c(2),p("disabled",n.isFirstPage()),c(3),fn(" P\xE1gina ",n.page," de ",n.totalPages," "),c(),p("disabled",n.isLastPage()),c(2),p("disabled",n.isLastPage()))},dependencies:[Ae,We,Be,rt,Ft,it,nt,Xe,li,tt,ze,Mt,ka,_t,wr,Lt,ut,ti,ei],styles:[".card[_ngcontent-%COMP%]{border-radius:14px;box-shadow:0 4px 16px #0000000d}.card-header[_ngcontent-%COMP%]{background:#f8f9fa;border-bottom:1px solid #eee}.sortable[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3;margin-left:6px;font-size:11px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.acciones-container[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0!important}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;table-layout:fixed}.col-grab[_ngcontent-%COMP%]{width:4%}.col-prod[_ngcontent-%COMP%]{width:auto}.col-cb[_ngcontent-%COMP%], .col-cat[_ngcontent-%COMP%]{width:10%}.col-n1[_ngcontent-%COMP%]{width:5%}.col-num[_ngcontent-%COMP%]{width:7%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.5rem .6rem}.nowrap[_ngcontent-%COMP%]{white-space:nowrap}.mono[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.sortable[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.45;margin-left:6px;font-size:11px}.sortable[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}@media (max-width: 1200px){.col-prod[_ngcontent-%COMP%]{width:26rem}.col-cat[_ngcontent-%COMP%]{width:12rem}}@media (max-width: 992px){.col-prod[_ngcontent-%COMP%]{width:20rem}.col-cat[_ngcontent-%COMP%], .col-cb[_ngcontent-%COMP%]{width:10rem}}@media (max-width: 768px){.col-prod[_ngcontent-%COMP%]{width:16rem}.col-cat[_ngcontent-%COMP%], .col-cb[_ngcontent-%COMP%]{width:9rem}.col-num[_ngcontent-%COMP%]{width:7rem}}"]})};var O_=[{path:"",component:oc,children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:rl},{path:"ventas",component:ul,canActivate:[Ji],data:{rolesPermitidos:["admin","empleado"]}},{path:"pedidos",component:ml,canActivate:[Ji],data:{rolesPermitidos:["admin","empleado"]}},{path:"devoluciones",component:hl,canActivate:[Ji],data:{rolesPermitidos:["admin","empleado"]}},{path:"inicio-turno",component:_l,canActivate:[Ji],data:{rolesPermitidos:["admin","empleado"]}},{path:"surtir-farmacia",component:Ql,canActivate:[Ji],data:{rolesPermitidos:["admin"]}},{path:"compras",component:Zl,canActivate:[Ji],data:{rolesPermitidos:["admin"]}},{path:"ajustes-inventario",component:nc,canActivate:[Ji],data:{rolesPermitidos:["admin"]}},{path:"farmacias",loadComponent:()=>import("./chunk-NODS3ML6.js").then(i=>i.FarmaciasComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"inventario-farmacias",loadComponent:()=>import("./chunk-H5B75PLT.js").then(i=>i.AjustesInventarioFarmaciaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"usuarios",loadComponent:()=>import("./chunk-6H4UJ3O6.js").then(i=>i.UsuariosComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"clientes",loadComponent:()=>import("./chunk-QO5ILPWS.js").then(i=>i.ClientesComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"proveedores",loadComponent:()=>import("./chunk-C6UAJRCA.js").then(i=>i.ProveedoresComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"cortes-de-caja",loadComponent:()=>import("./chunk-RHLWRC5Y.js").then(i=>i.CortesDeCajaComponent),data:{rolesPermitidos:["admin"]},canActivate:[Ji]},{path:"reporte/ventas-por-farmacia",component:sc},{path:"reporte/ventas-producto",component:lc},{path:"reporte/ventas",component:dc},{path:"reporte/pedidos",component:cc},{path:"reporte/resumen-utilidades",component:uc},{path:"reporte/utilidades",component:mc},{path:"reporte/compras",component:fc},{path:"reporte-presupuesto",component:Uc},{path:"reportes/devoluciones",loadComponent:()=>import("./chunk-FZ3DWXGL.js").then(i=>i.DevolucionesPageComponent),resolve:{cat:Ng}},{path:"reportes-compras",loadComponent:()=>import("./chunk-WFWOUKBL.js").then(i=>i.ComprasPageComponent)},{path:"reportes/compras-historial-producto",component:hc},{path:"reportes/cancelaciones",loadComponent:()=>import("./chunk-FUSVGFLP.js").then(i=>i.CancelacionesPageComponent)},{path:"reportes/compras-ventas",component:_c},{path:"etiquetas/print",component:Lc},{path:"etiquetas/design",component:Nc}]},{path:"login",component:Ba}];function D_(i){return new ft(3e3,!1)}function B6(){return new ft(3100,!1)}function L6(){return new ft(3101,!1)}function V6(i){return new ft(3001,!1)}function U6(i){return new ft(3003,!1)}function j6(i){return new ft(3004,!1)}function N_(i,t){return new ft(3005,!1)}function B_(){return new ft(3006,!1)}function L_(){return new ft(3007,!1)}function V_(i,t){return new ft(3008,!1)}function U_(i){return new ft(3002,!1)}function j_(i,t,e,n,r){return new ft(3010,!1)}function W_(){return new ft(3011,!1)}function H_(){return new ft(3012,!1)}function z_(){return new ft(3200,!1)}function $_(){return new ft(3202,!1)}function G_(){return new ft(3013,!1)}function q_(i){return new ft(3014,!1)}function X_(i){return new ft(3015,!1)}function K_(i){return new ft(3016,!1)}function Y_(i,t){return new ft(3404,!1)}function W6(i){return new ft(3502,!1)}function Q_(i){return new ft(3503,!1)}function J_(){return new ft(3300,!1)}function Z_(i){return new ft(3504,!1)}function ev(i){return new ft(3301,!1)}function tv(i,t){return new ft(3302,!1)}function iv(i){return new ft(3303,!1)}function nv(i,t){return new ft(3400,!1)}function rv(i){return new ft(3401,!1)}function av(i){return new ft(3402,!1)}function ov(i,t){return new ft(3505,!1)}function Cr(i){switch(i.length){case 0:return new ir;case 1:return i[0];default:return new Jr(i)}}function Au(i,t,e=new Map,n=new Map){let r=[],a=[],o=-1,u=null;if(t.forEach(m=>{let f=m.get("offset"),h=f==o,g=h&&u||new Map;m.forEach((v,b)=>{let w=b,x=v;if(b!=="offset")switch(w=i.normalizePropertyName(w,r),x){case ja:x=e.get(b);break;case En:x=n.get(b);break;default:x=i.normalizeStyleValue(b,w,x,r);break}g.set(w,x)}),h||a.push(g),u=g,o=f}),r.length)throw W6(r);return a}function jc(i,t,e,n){switch(t){case"start":i.onStart(()=>n(e&&Iu(e,"start",i)));break;case"done":i.onDone(()=>n(e&&Iu(e,"done",i)));break;case"destroy":i.onDestroy(()=>n(e&&Iu(e,"destroy",i)));break}}function Iu(i,t,e){let n=e.totalTime,r=!!e.disabled,a=Wc(i.element,i.triggerName,i.fromState,i.toState,t||i.phaseName,n??i.totalTime,r),o=i._data;return o!=null&&(a._data=o),a}function Wc(i,t,e,n,r="",a=0,o){return{element:i,triggerName:t,fromState:e,toState:n,phaseName:r,totalTime:a,disabled:!!o}}function sn(i,t,e){let n=i.get(t);return n||i.set(t,n=e),n}function Ou(i){let t=i.indexOf(":"),e=i.substring(1,t),n=i.slice(t+1);return[e,n]}var H6=typeof document>"u"?null:document.documentElement;function Hc(i){let t=i.parentNode||i.host||null;return t===H6?null:t}function z6(i){return i.substring(1,6)=="ebkit"}var ga=null,R_=!1;function sv(i){ga||(ga=$6()||{},R_=ga.style?"WebkitAppearance"in ga.style:!1);let t=!0;return ga.style&&!z6(i)&&(t=i in ga.style,!t&&R_&&(t="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in ga.style)),t}function $6(){return typeof document<"u"?document.body:null}function Du(i,t){for(;t;){if(t===i)return!0;t=Hc(t)}return!1}function Ru(i,t,e){if(e)return Array.from(i.querySelectorAll(t));let n=i.querySelector(t);return n?[n]:[]}var G6=1e3,Nu="{{",q6="}}",Bu="ng-enter",zc="ng-leave",xs="ng-trigger",bs=".ng-trigger",Lu="ng-animating",$c=".ng-animating";function cr(i){if(typeof i=="number")return i;let t=i.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:Mu(parseFloat(t[1]),t[2])}function Mu(i,t){switch(t){case"s":return i*G6;default:return i}}function ys(i,t,e){return i.hasOwnProperty("duration")?i:X6(i,t,e)}function X6(i,t,e){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,r,a=0,o="";if(typeof i=="string"){let u=i.match(n);if(u===null)return t.push(D_(i)),{duration:0,delay:0,easing:""};r=Mu(parseFloat(u[1]),u[2]);let m=u[3];m!=null&&(a=Mu(parseFloat(m),u[4]));let f=u[5];f&&(o=f)}else r=i;if(!e){let u=!1,m=t.length;r<0&&(t.push(B6()),u=!0),a<0&&(t.push(L6()),u=!0),u&&t.splice(m,0,D_(i))}return{duration:r,delay:a,easing:o}}function lv(i){return i.length?i[0]instanceof Map?i:i.map(t=>new Map(Object.entries(t))):[]}function Hn(i,t,e){t.forEach((n,r)=>{let a=Gc(r);e&&!e.has(r)&&e.set(r,i.style[a]),i.style[a]=n})}function Ur(i,t){t.forEach((e,n)=>{let r=Gc(n);i.style[r]=""})}function Co(i){return Array.isArray(i)?i.length==1?i[0]:up(i):i}function cv(i,t,e){let n=t.params||{},r=Vu(i);r.length&&r.forEach(a=>{n.hasOwnProperty(a)||e.push(V6(a))})}var Fu=new RegExp(`${Nu}\\s*(.+?)\\s*${q6}`,"g");function Vu(i){let t=[];if(typeof i=="string"){let e;for(;e=Fu.exec(i);)t.push(e[1]);Fu.lastIndex=0}return t}function So(i,t,e){let n=`${i}`,r=n.replace(Fu,(a,o)=>{let u=t[o];return u==null&&(e.push(U6(o)),u=""),u.toString()});return r==n?i:r}var K6=/-+([a-z0-9])/g;function Gc(i){return i.replace(K6,(...t)=>t[1].toUpperCase())}function dv(i,t){return i===0||t===0}function uv(i,t,e){if(e.size&&t.length){let n=t[0],r=[];if(e.forEach((a,o)=>{n.has(o)||r.push(o),n.set(o,a)}),r.length)for(let a=1;a<t.length;a++){let o=t[a];r.forEach(u=>o.set(u,qc(i,u)))}}return t}function ln(i,t,e){switch(t.type){case $e.Trigger:return i.visitTrigger(t,e);case $e.State:return i.visitState(t,e);case $e.Transition:return i.visitTransition(t,e);case $e.Sequence:return i.visitSequence(t,e);case $e.Group:return i.visitGroup(t,e);case $e.Animate:return i.visitAnimate(t,e);case $e.Keyframes:return i.visitKeyframes(t,e);case $e.Style:return i.visitStyle(t,e);case $e.Reference:return i.visitReference(t,e);case $e.AnimateChild:return i.visitAnimateChild(t,e);case $e.AnimateRef:return i.visitAnimateRef(t,e);case $e.Query:return i.visitQuery(t,e);case $e.Stagger:return i.visitStagger(t,e);default:throw j6(t.type)}}function qc(i,t){return window.getComputedStyle(i)[t]}var im=(()=>{class i{validateStyleProperty(e){return sv(e)}containsElement(e,n){return Du(e,n)}getParentElement(e){return Hc(e)}query(e,n,r){return Ru(e,n,r)}computeStyle(e,n,r){return r||""}animate(e,n,r,a,o,u=[],m){return new ir(r,a)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Ze({token:i,factory:i.\u0275fac})}return i})(),va=class{static NOOP=new im},xa=class{};var Y6=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Jc=class extends xa{normalizePropertyName(t,e){return Gc(t)}normalizeStyleValue(t,e,n,r){let a="",o=n.toString().trim();if(Y6.has(e)&&n!==0&&n!=="0")if(typeof n=="number")a="px";else{let u=n.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&u[1].length==0&&r.push(N_(t,n))}return o+a}};var Zc="*";function Q6(i,t){let e=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>J6(n,e,t)):e.push(i),e}function J6(i,t,e){if(i[0]==":"){let m=Z6(i,e);if(typeof m=="function"){t.push(m);return}i=m}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return e.push(X_(i)),t;let r=n[1],a=n[2],o=n[3];t.push(mv(r,o));let u=r==Zc&&o==Zc;a[0]=="<"&&!u&&t.push(mv(o,r))}function Z6(i,t){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,n)=>parseFloat(n)>parseFloat(e);case":decrement":return(e,n)=>parseFloat(n)<parseFloat(e);default:return t.push(K_(i)),"* => *"}}var Xc=new Set(["true","1"]),Kc=new Set(["false","0"]);function mv(i,t){let e=Xc.has(i)||Kc.has(i),n=Xc.has(t)||Kc.has(t);return(r,a)=>{let o=i==Zc||i==r,u=t==Zc||t==a;return!o&&e&&typeof r=="boolean"&&(o=r?Xc.has(i):Kc.has(i)),!u&&n&&typeof a=="boolean"&&(u=a?Xc.has(t):Kc.has(t)),o&&u}}var Cv=":self",e8=new RegExp(`s*${Cv}s*,?`,"g");function Sv(i,t,e,n){return new $u(i).build(t,e,n)}var fv="",$u=class{_driver;constructor(t){this._driver=t}build(t,e,n){let r=new Gu(e);return this._resetContextStyleTimingState(r),ln(this,Co(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector=fv,t.collectedStyles=new Map,t.collectedStyles.set(fv,new Map),t.currentTime=0}visitTrigger(t,e){let n=e.queryCount=0,r=e.depCount=0,a=[],o=[];return t.name.charAt(0)=="@"&&e.errors.push(B_()),t.definitions.forEach(u=>{if(this._resetContextStyleTimingState(e),u.type==$e.State){let m=u,f=m.name;f.toString().split(/\s*,\s*/).forEach(h=>{m.name=h,a.push(this.visitState(m,e))}),m.name=f}else if(u.type==$e.Transition){let m=this.visitTransition(u,e);n+=m.queryCount,r+=m.depCount,o.push(m)}else e.errors.push(L_())}),{type:$e.Trigger,name:t.name,states:a,transitions:o,queryCount:n,depCount:r,options:null}}visitState(t,e){let n=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(n.containsDynamicStyles){let a=new Set,o=r||{};n.styles.forEach(u=>{u instanceof Map&&u.forEach(m=>{Vu(m).forEach(f=>{o.hasOwnProperty(f)||a.add(f)})})}),a.size&&e.errors.push(V_(t.name,[...a.values()]))}return{type:$e.State,name:t.name,style:n,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;let n=ln(this,Co(t.animation),e),r=Q6(t.expr,e.errors);return{type:$e.Transition,matchers:r,animation:n,queryCount:e.queryCount,depCount:e.depCount,options:_a(t.options)}}visitSequence(t,e){return{type:$e.Sequence,steps:t.steps.map(n=>ln(this,n,e)),options:_a(t.options)}}visitGroup(t,e){let n=e.currentTime,r=0,a=t.steps.map(o=>{e.currentTime=n;let u=ln(this,o,e);return r=Math.max(r,e.currentTime),u});return e.currentTime=r,{type:$e.Group,steps:a,options:_a(t.options)}}visitAnimate(t,e){let n=r8(t.timings,e.errors);e.currentAnimateTimings=n;let r,a=t.styles?t.styles:pn({});if(a.type==$e.Keyframes)r=this.visitKeyframes(a,e);else{let o=t.styles,u=!1;if(!o){u=!0;let f={};n.easing&&(f.easing=n.easing),o=pn(f)}e.currentTime+=n.duration+n.delay;let m=this.visitStyle(o,e);m.isEmptyStep=u,r=m}return e.currentAnimateTimings=null,{type:$e.Animate,timings:n,style:r,options:null}}visitStyle(t,e){let n=this._makeStyleAst(t,e);return this._validateStyleAst(n,e),n}_makeStyleAst(t,e){let n=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let u of r)typeof u=="string"?u===En?n.push(u):e.errors.push(U_(u)):n.push(new Map(Object.entries(u)));let a=!1,o=null;return n.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(o=u.get("easing"),u.delete("easing")),!a)){for(let m of u.values())if(m.toString().indexOf(Nu)>=0){a=!0;break}}}),{type:$e.Style,styles:n,easing:o,offset:t.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(t,e){let n=e.currentAnimateTimings,r=e.currentTime,a=e.currentTime;n&&a>0&&(a-=n.duration+n.delay),t.styles.forEach(o=>{typeof o!="string"&&o.forEach((u,m)=>{let f=e.collectedStyles.get(e.currentQuerySelector),h=f.get(m),g=!0;h&&(a!=r&&a>=h.startTime&&r<=h.endTime&&(e.errors.push(j_(m,h.startTime,h.endTime,a,r)),g=!1),a=h.startTime),g&&f.set(m,{startTime:a,endTime:r}),e.options&&cv(u,e.options,e.errors)})})}visitKeyframes(t,e){let n={type:$e.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(W_()),n;let r=1,a=0,o=[],u=!1,m=!1,f=0,h=t.steps.map(U=>{let j=this._makeStyleAst(U,e),H=j.offset!=null?j.offset:n8(j.styles),K=0;return H!=null&&(a++,K=j.offset=H),m=m||K<0||K>1,u=u||K<f,f=K,o.push(K),j});m&&e.errors.push(H_()),u&&e.errors.push(z_());let g=t.steps.length,v=0;a>0&&a<g?e.errors.push($_()):a==0&&(v=r/(g-1));let b=g-1,w=e.currentTime,x=e.currentAnimateTimings,C=x.duration;return h.forEach((U,j)=>{let H=v>0?j==b?1:v*j:o[j],K=H*C;e.currentTime=w+x.delay+K,x.duration=K,this._validateStyleAst(U,e),U.offset=H,n.styles.push(U)}),n}visitReference(t,e){return{type:$e.Reference,animation:ln(this,Co(t.animation),e),options:_a(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:$e.AnimateChild,options:_a(t.options)}}visitAnimateRef(t,e){return{type:$e.AnimateRef,animation:this.visitReference(t.animation,e),options:_a(t.options)}}visitQuery(t,e){let n=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;let[a,o]=t8(t.selector);e.currentQuerySelector=n.length?n+" "+a:a,sn(e.collectedStyles,e.currentQuerySelector,new Map);let u=ln(this,Co(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=n,{type:$e.Query,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:u,originalSelector:t.selector,options:_a(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(G_());let n=t.timings==="full"?{duration:0,delay:0,easing:"full"}:ys(t.timings,e.errors,!0);return{type:$e.Stagger,animation:ln(this,Co(t.animation),e),timings:n,options:null}}};function t8(i){let t=!!i.split(/\s*,\s*/).find(e=>e==Cv);return t&&(i=i.replace(e8,"")),i=i.replace(/@\*/g,bs).replace(/@\w+/g,e=>bs+"-"+e.slice(1)).replace(/:animating/g,$c),[i,t]}function i8(i){return i?Qe({},i):null}var Gu=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(t){this.errors=t}};function n8(i){if(typeof i=="string")return null;let t=null;if(Array.isArray(i))i.forEach(e=>{if(e instanceof Map&&e.has("offset")){let n=e;t=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let e=i;t=parseFloat(e.get("offset")),e.delete("offset")}return t}function r8(i,t){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let a=ys(i,t).duration;return Uu(a,0,"")}let e=i;if(e.split(/\s+/).some(a=>a.charAt(0)=="{"&&a.charAt(1)=="{")){let a=Uu(0,0,"");return a.dynamic=!0,a.strValue=e,a}let r=ys(e,t);return Uu(r.duration,r.delay,r.easing)}function _a(i){return i?(i=Qe({},i),i.params&&(i.params=i8(i.params))):i={},i}function Uu(i,t,e){return{duration:i,delay:t,easing:e}}function nm(i,t,e,n,r,a,o=null,u=!1){return{type:1,element:i,keyframes:t,preStyleProps:e,postStyleProps:n,duration:r,delay:a,totalTime:r+a,easing:o,subTimeline:u}}var Ss=class{_map=new Map;get(t){return this._map.get(t)||[]}append(t,e){let n=this._map.get(t);n||this._map.set(t,n=[]),n.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}},a8=1,o8=":enter",s8=new RegExp(o8,"g"),l8=":leave",c8=new RegExp(l8,"g");function wv(i,t,e,n,r,a=new Map,o=new Map,u,m,f=[]){return new qu().buildKeyframes(i,t,e,n,r,a,o,u,m,f)}var qu=class{buildKeyframes(t,e,n,r,a,o,u,m,f,h=[]){f=f||new Ss;let g=new Xu(t,e,f,r,a,h,[]);g.options=m;let v=m.delay?cr(m.delay):0;g.currentTimeline.delayNextStep(v),g.currentTimeline.setStyles([o],null,g.errors,m),ln(this,n,g);let b=g.timelines.filter(w=>w.containsAnimation());if(b.length&&u.size){let w;for(let x=b.length-1;x>=0;x--){let C=b[x];if(C.element===e){w=C;break}}w&&!w.allowOnlyTimelineStyles()&&w.setStyles([u],null,g.errors,m)}return b.length?b.map(w=>w.buildKeyframes()):[nm(e,[],[],[],0,v,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){let n=e.subInstructions.get(e.element);if(n){let r=e.createSubContext(t.options),a=e.currentTimeline.currentTime,o=this._visitSubInstructions(n,r,r.options);a!=o&&e.transformIntoNewTimeline(o)}e.previousNode=t}visitAnimateRef(t,e){let n=e.createSubContext(t.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,n),this.visitReference(t.animation,n),e.transformIntoNewTimeline(n.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,n){for(let r of t){let a=r?.delay;if(a){let o=typeof a=="number"?a:cr(So(a,r?.params??{},e.errors));n.delayNextStep(o)}}}_visitSubInstructions(t,e,n){let a=e.currentTimeline.currentTime,o=n.duration!=null?cr(n.duration):null,u=n.delay!=null?cr(n.delay):null;return o!==0&&t.forEach(m=>{let f=e.appendInstructionToTimeline(m,o,u);a=Math.max(a,f.duration+f.delay)}),a}visitReference(t,e){e.updateOptions(t.options,!0),ln(this,t.animation,e),e.previousNode=t}visitSequence(t,e){let n=e.subContextCount,r=e,a=t.options;if(a&&(a.params||a.delay)&&(r=e.createSubContext(a),r.transformIntoNewTimeline(),a.delay!=null)){r.previousNode.type==$e.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=e0);let o=cr(a.delay);r.delayNextStep(o)}t.steps.length&&(t.steps.forEach(o=>ln(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){let n=[],r=e.currentTimeline.currentTime,a=t.options&&t.options.delay?cr(t.options.delay):0;t.steps.forEach(o=>{let u=e.createSubContext(t.options);a&&u.delayNextStep(a),ln(this,o,u),r=Math.max(r,u.currentTimeline.currentTime),n.push(u.currentTimeline)}),n.forEach(o=>e.currentTimeline.mergeTimelineCollectedStyles(o)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){let n=t.strValue,r=e.params?So(n,e.params,e.errors):n;return ys(r,e.errors)}else return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){let n=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;n.delay&&(e.incrementTime(n.delay),r.snapshotCurrentStyles());let a=t.style;a.type==$e.Keyframes?this.visitKeyframes(a,e):(e.incrementTime(n.duration),this.visitStyle(a,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){let n=e.currentTimeline,r=e.currentAnimateTimings;!r&&n.hasCurrentStyleProperties()&&n.forwardFrame();let a=r&&r.easing||t.easing;t.isEmptyStep?n.applyEmptyStep(a):n.setStyles(t.styles,a,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){let n=e.currentAnimateTimings,r=e.currentTimeline.duration,a=n.duration,u=e.createSubContext().currentTimeline;u.easing=n.easing,t.styles.forEach(m=>{let f=m.offset||0;u.forwardTime(f*a),u.setStyles(m.styles,m.easing,e.errors,e.options),u.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(u),e.transformIntoNewTimeline(r+a),e.previousNode=t}visitQuery(t,e){let n=e.currentTimeline.currentTime,r=t.options||{},a=r.delay?cr(r.delay):0;a&&(e.previousNode.type===$e.Style||n==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=e0);let o=n,u=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=u.length;let m=null;u.forEach((f,h)=>{e.currentQueryIndex=h;let g=e.createSubContext(t.options,f);a&&g.delayNextStep(a),f===e.element&&(m=g.currentTimeline),ln(this,t.animation,g),g.currentTimeline.applyStylesToKeyframe();let v=g.currentTimeline.currentTime;o=Math.max(o,v)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(o),m&&(e.currentTimeline.mergeTimelineCollectedStyles(m),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){let n=e.parentContext,r=e.currentTimeline,a=t.timings,o=Math.abs(a.duration),u=o*(e.currentQueryTotal-1),m=o*e.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":m=u-m;break;case"full":m=n.currentStaggerTime;break}let h=e.currentTimeline;m&&h.delayNextStep(m);let g=h.currentTime;ln(this,t.animation,e),e.previousNode=t,n.currentStaggerTime=r.currentTime-g+(r.startTime-n.currentTimeline.startTime)}},e0={},Xu=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=e0;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(t,e,n,r,a,o,u,m){this._driver=t,this.element=e,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=a,this.errors=o,this.timelines=u,this.currentTimeline=m||new t0(this._driver,e,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;let n=t,r=this.options;n.duration!=null&&(r.duration=cr(n.duration)),n.delay!=null&&(r.delay=cr(n.delay));let a=n.params;if(a){let o=r.params;o||(o=this.options.params={}),Object.keys(a).forEach(u=>{(!e||!o.hasOwnProperty(u))&&(o[u]=So(a[u],o,this.errors))})}}_copyOptions(){let t={};if(this.options){let e=this.options.params;if(e){let n=t.params={};Object.keys(e).forEach(r=>{n[r]=e[r]})}}return t}createSubContext(t=null,e,n){let r=e||this.element,a=new i(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(t){return this.previousNode=e0,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,n){let r={duration:e??t.duration,delay:this.currentTimeline.currentTime+(n??0)+t.delay,easing:""},a=new Ku(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(a),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,n,r,a,o){let u=[];if(r&&u.push(this.element),t.length>0){t=t.replace(s8,"."+this._enterClassName),t=t.replace(c8,"."+this._leaveClassName);let m=n!=1,f=this._driver.query(this.element,t,m);n!==0&&(f=n<0?f.slice(f.length+n,f.length):f.slice(0,n)),u.push(...f)}return!a&&u.length==0&&o.push(q_(e)),u}},t0=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(t,e,n,r){this._driver=t,this.element=e,this.startTime=n,this._elementTimelineStylesLookup=r,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new i(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=a8,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,n]of this._globalTimelineStyles)this._backFill.set(e,n||En),this._currentKeyframe.set(e,En);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,n,r){e&&this._previousKeyframe.set("easing",e);let a=r&&r.params||{},o=d8(t,this._globalTimelineStyles);for(let[u,m]of o){let f=So(m,a,n);this._pendingStyles.set(u,f),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??En),this._updateStyle(u,f)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,n)=>{let r=this._styleSummary.get(n);(!r||e.time>r.time)&&this._updateStyle(n,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let t=new Set,e=new Set,n=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((u,m)=>{let f=new Map([...this._backFill,...u]);f.forEach((h,g)=>{h===ja?t.add(g):h===En&&e.add(g)}),n||f.set("offset",m/this.duration),r.push(f)});let a=[...t.values()],o=[...e.values()];if(n){let u=r[0],m=new Map(u);u.set("offset",0),m.set("offset",1),r=[u,m]}return nm(this.element,r,a,o,this.duration,this.startTime,this.easing,!1)}},Ku=class extends t0{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(t,e,n,r,a,o,u=!1){super(t,e,o.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=a,this._stretchStartingKeyframe=u,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){let a=[],o=n+e,u=e/o,m=new Map(t[0]);m.set("offset",0),a.push(m);let f=new Map(t[0]);f.set("offset",pv(u)),a.push(f);let h=t.length-1;for(let g=1;g<=h;g++){let v=new Map(t[g]),b=v.get("offset"),w=e+b*n;v.set("offset",pv(w/o)),a.push(v)}n=o,e=0,r="",t=a}return nm(this.element,t,this.preStyleProps,this.postStyleProps,n,e,r,!0)}};function pv(i,t=3){let e=Math.pow(10,t-1);return Math.round(i*e)/e}function d8(i,t){let e=new Map,n;return i.forEach(r=>{if(r==="*"){n??=t.keys();for(let a of n)e.set(a,En)}else for(let[a,o]of r)e.set(a,o)}),e}function hv(i,t,e,n,r,a,o,u,m,f,h,g,v){return{type:0,element:i,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:a,toState:n,toStyles:o,timelines:u,queriedElements:m,preStyleProps:f,postStyleProps:h,totalTime:g,errors:v}}var ju={},i0=class{_triggerName;ast;_stateStyles;constructor(t,e,n){this._triggerName=t,this.ast=e,this._stateStyles=n}match(t,e,n,r){return u8(this.ast.matchers,t,e,n,r)}buildStyles(t,e,n){let r=this._stateStyles.get("*");return t!==void 0&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(e,n):new Map}build(t,e,n,r,a,o,u,m,f,h){let g=[],v=this.ast.options&&this.ast.options.params||ju,b=u&&u.params||ju,w=this.buildStyles(n,b,g),x=m&&m.params||ju,C=this.buildStyles(r,x,g),U=new Set,j=new Map,H=new Map,K=r==="void",ce={params:Ev(x,v),delay:this.ast.options?.delay},we=h?[]:wv(t,e,this.ast.animation,a,o,w,C,ce,f,g),W=0;return we.forEach(se=>{W=Math.max(se.duration+se.delay,W)}),g.length?hv(e,this._triggerName,n,r,K,w,C,[],[],j,H,W,g):(we.forEach(se=>{let ee=se.element,le=sn(j,ee,new Set);se.preStyleProps.forEach(me=>le.add(me));let ue=sn(H,ee,new Set);se.postStyleProps.forEach(me=>ue.add(me)),ee!==e&&U.add(ee)}),hv(e,this._triggerName,n,r,K,w,C,we,[...U.values()],j,H,W))}};function u8(i,t,e,n,r){return i.some(a=>a(t,e,n,r))}function Ev(i,t){let e=Qe({},t);return Object.entries(i).forEach(([n,r])=>{r!=null&&(e[n]=r)}),e}var Yu=class{styles;defaultParams;normalizer;constructor(t,e,n){this.styles=t,this.defaultParams=e,this.normalizer=n}buildStyles(t,e){let n=new Map,r=Ev(t,this.defaultParams);return this.styles.styles.forEach(a=>{typeof a!="string"&&a.forEach((o,u)=>{o&&(o=So(o,r,e));let m=this.normalizer.normalizePropertyName(u,e);o=this.normalizer.normalizeStyleValue(u,m,o,e),n.set(u,o)})}),n}};function m8(i,t,e){return new Qu(i,t,e)}var Qu=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(t,e,n){this.name=t,this.ast=e,this._normalizer=n,e.states.forEach(r=>{let a=r.options&&r.options.params||{};this.states.set(r.name,new Yu(r.style,a,n))}),gv(this.states,"true","1"),gv(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new i0(t,r,this.states))}),this.fallbackTransition=f8(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,n,r){return this.transitionFactories.find(o=>o.match(t,e,n,r))||null}matchStyles(t,e,n){return this.fallbackTransition.buildStyles(t,e,n)}};function f8(i,t,e){let n=[(o,u)=>!0],r={type:$e.Sequence,steps:[],options:null},a={type:$e.Transition,animation:r,matchers:n,options:null,queryCount:0,depCount:0};return new i0(i,a,t)}function gv(i,t,e){i.has(t)?i.has(e)||i.set(e,i.get(t)):i.has(e)&&i.set(t,i.get(e))}var p8=new Ss,Ju=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(t,e,n){this.bodyNode=t,this._driver=e,this._normalizer=n}register(t,e){let n=[],r=[],a=Sv(this._driver,e,n,r);if(n.length)throw Q_(n);this._animations.set(t,a)}_buildPlayer(t,e,n){let r=t.element,a=Au(this._normalizer,t.keyframes,e,n);return this._driver.animate(r,a,t.duration,t.delay,t.easing,[],!0)}create(t,e,n={}){let r=[],a=this._animations.get(t),o,u=new Map;if(a?(o=wv(this._driver,e,a,Bu,zc,new Map,new Map,n,p8,r),o.forEach(h=>{let g=sn(u,h.element,new Map);h.postStyleProps.forEach(v=>g.set(v,null))})):(r.push(J_()),o=[]),r.length)throw Z_(r);u.forEach((h,g)=>{h.forEach((v,b)=>{h.set(b,this._driver.computeStyle(g,b,En))})});let m=o.map(h=>{let g=u.get(h.element);return this._buildPlayer(h,new Map,g)}),f=Cr(m);return this._playersById.set(t,f),f.onDestroy(()=>this.destroy(t)),this.players.push(f),f}destroy(t){let e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);let n=this.players.indexOf(e);n>=0&&this.players.splice(n,1)}_getPlayer(t){let e=this._playersById.get(t);if(!e)throw ev(t);return e}listen(t,e,n,r){let a=Wc(e,"","","");return jc(this._getPlayer(t),n,a,r),()=>{}}command(t,e,n,r){if(n=="register"){this.register(t,r[0]);return}if(n=="create"){let o=r[0]||{};this.create(t,e,o);return}let a=this._getPlayer(t);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t);break}}},_v="ng-animate-queued",h8=".ng-animate-queued",Wu="ng-animate-disabled",g8=".ng-animate-disabled",_8="ng-star-inserted",v8=".ng-star-inserted",x8=[],Tv={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},b8={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},zn="__ng_removed",ws=class{namespaceId;value;options;get params(){return this.options.params}constructor(t,e=""){this.namespaceId=e;let n=t&&t.hasOwnProperty("value"),r=n?t.value:t;if(this.value=C8(r),n){let a=t,{value:o}=a,u=pm(a,["value"]);this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){let e=t.params;if(e){let n=this.options.params;Object.keys(e).forEach(r=>{n[r]==null&&(n[r]=e[r])})}}},Cs="void",Hu=new ws(Cs),Zu=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(t,e,n){this.id=t,this.hostElement=e,this._engine=n,this._hostClassName="ng-tns-"+t,Dn(e,this._hostClassName)}listen(t,e,n,r){if(!this._triggers.has(e))throw tv(n,e);if(n==null||n.length==0)throw iv(e);if(!S8(n))throw nv(n,e);let a=sn(this._elementListeners,t,[]),o={name:e,phase:n,callback:r};a.push(o);let u=sn(this._engine.statesByElement,t,new Map);return u.has(e)||(Dn(t,xs),Dn(t,xs+"-"+e),u.set(e,Hu)),()=>{this._engine.afterFlush(()=>{let m=a.indexOf(o);m>=0&&a.splice(m,1),this._triggers.has(e)||u.delete(e)})}}register(t,e){return this._triggers.has(t)?!1:(this._triggers.set(t,e),!0)}_getTrigger(t){let e=this._triggers.get(t);if(!e)throw rv(t);return e}trigger(t,e,n,r=!0){let a=this._getTrigger(e),o=new Es(this.id,e,t),u=this._engine.statesByElement.get(t);u||(Dn(t,xs),Dn(t,xs+"-"+e),this._engine.statesByElement.set(t,u=new Map));let m=u.get(e),f=new ws(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&m&&f.absorbOptions(m.options),u.set(e,f),m||(m=Hu),!(f.value===Cs)&&m.value===f.value){if(!T8(m.params,f.params)){let x=[],C=a.matchStyles(m.value,m.params,x),U=a.matchStyles(f.value,f.params,x);x.length?this._engine.reportError(x):this._engine.afterFlush(()=>{Ur(t,C),Hn(t,U)})}return}let v=sn(this._engine.playersByElement,t,[]);v.forEach(x=>{x.namespaceId==this.id&&x.triggerName==e&&x.queued&&x.destroy()});let b=a.matchTransition(m.value,f.value,t,f.params),w=!1;if(!b){if(!r)return;b=a.fallbackTransition,w=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:b,fromState:m,toState:f,player:o,isFallbackTransition:w}),w||(Dn(t,_v),o.onStart(()=>{wo(t,_v)})),o.onDone(()=>{let x=this.players.indexOf(o);x>=0&&this.players.splice(x,1);let C=this._engine.playersByElement.get(t);if(C){let U=C.indexOf(o);U>=0&&C.splice(U,1)}}),this.players.push(o),v.push(o),o}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,n)=>{this._elementListeners.set(n,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);let e=this._engine.playersByElement.get(t);e&&(e.forEach(n=>n.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){let n=this._engine.driver.query(t,bs,!0);n.forEach(r=>{if(r[zn])return;let a=this._engine.fetchNamespacesByElement(r);a.size?a.forEach(o=>o.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,n,r){let a=this._engine.statesByElement.get(t),o=new Map;if(a){let u=[];if(a.forEach((m,f)=>{if(o.set(f,m.value),this._triggers.has(f)){let h=this.trigger(t,f,Cs,r);h&&u.push(h)}}),u.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,o),n&&Cr(u).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){let e=this._elementListeners.get(t),n=this._engine.statesByElement.get(t);if(e&&n){let r=new Set;e.forEach(a=>{let o=a.name;if(r.has(o))return;r.add(o);let m=this._triggers.get(o).fallbackTransition,f=n.get(o)||Hu,h=new ws(Cs),g=new Es(this.id,o,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:o,transition:m,fromState:f,toState:h,player:g,isFallbackTransition:!0})})}}removeNode(t,e){let n=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(n.totalAnimations){let a=n.players.length?n.playersByQueriedElement.get(t):[];if(a&&a.length)r=!0;else{let o=t;for(;o=o.parentNode;)if(n.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)n.markElementAsRemoved(this.id,t,!1,e);else{let a=t[zn];(!a||a===Tv)&&(n.afterFlush(()=>this.clearElementCache(t)),n.destroyInnerAnimations(t),n._onRemovalComplete(t,e))}}insertNode(t,e){Dn(t,this._hostClassName)}drainQueuedTransitions(t){let e=[];return this._queue.forEach(n=>{let r=n.player;if(r.destroyed)return;let a=n.element,o=this._elementListeners.get(a);o&&o.forEach(u=>{if(u.name==n.triggerName){let m=Wc(a,n.triggerName,n.fromState.value,n.toState.value);m._data=t,jc(n.player,u.phase,m,u.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(n)}),this._queue=[],e.sort((n,r)=>{let a=n.transition.ast.depCount,o=r.transition.ast.depCount;return a==0||o==0?a-o:this._engine.driver.containsElement(n.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}},em=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(t,e)=>{};_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}constructor(t,e,n){this.bodyNode=t,this.driver=e,this._normalizer=n}get queuedPlayers(){let t=[];return this._namespaceList.forEach(e=>{e.players.forEach(n=>{n.queued&&t.push(n)})}),t}createNamespace(t,e){let n=new Zu(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(n,e):(this.newHostElements.set(e,n),this.collectEnterElement(e)),this._namespaceLookup[t]=n}_balanceNamespaceList(t,e){let n=this._namespaceList,r=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,u=this.driver.getParentElement(e);for(;u;){let m=r.get(u);if(m){let f=n.indexOf(m);n.splice(f+1,0,t),o=!0;break}u=this.driver.getParentElement(u)}o||n.unshift(t)}else n.push(t);return r.set(e,t),t}register(t,e){let n=this._namespaceLookup[t];return n||(n=this.createNamespace(t,e)),n}registerTrigger(t,e,n){let r=this._namespaceLookup[t];r&&r.register(e,n)&&this.totalAnimations++}destroy(t,e){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(t);this.namespacesByHostElement.delete(n.hostElement);let r=this._namespaceList.indexOf(n);r>=0&&this._namespaceList.splice(r,1),n.destroy(e),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){let e=new Set,n=this.statesByElement.get(t);if(n){for(let r of n.values())if(r.namespaceId){let a=this._fetchNamespace(r.namespaceId);a&&e.add(a)}}return e}trigger(t,e,n,r){if(Yc(e)){let a=this._fetchNamespace(t);if(a)return a.trigger(e,n,r),!0}return!1}insertNode(t,e,n,r){if(!Yc(e))return;let a=e[zn];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;let o=this.collectedLeaveElements.indexOf(e);o>=0&&this.collectedLeaveElements.splice(o,1)}if(t){let o=this._fetchNamespace(t);o&&o.insertNode(e,n)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Dn(t,Wu)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),wo(t,Wu))}removeNode(t,e,n){if(Yc(e)){let r=t?this._fetchNamespace(t):null;r?r.removeNode(e,n):this.markElementAsRemoved(t,e,!1,n);let a=this.namespacesByHostElement.get(e);a&&a.id!==t&&a.removeNode(e,n)}else this._onRemovalComplete(e,n)}markElementAsRemoved(t,e,n,r,a){this.collectedLeaveElements.push(e),e[zn]={namespaceId:t,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:a}}listen(t,e,n,r,a){return Yc(e)?this._fetchNamespace(t).listen(e,n,r,a):()=>{}}_buildInstruction(t,e,n,r,a){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,n,r,t.fromState.options,t.toState.options,e,a)}destroyInnerAnimations(t){let e=this.driver.query(t,bs,!0);e.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(t,$c,!0),e.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(t){let e=this.playersByElement.get(t);e&&e.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(t){let e=this.playersByQueriedElement.get(t);e&&e.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Cr(this.players).onDone(()=>t());t()})}processLeaveNode(t){let e=t[zn];if(e&&e.setForRemoval){if(t[zn]=Tv,e.namespaceId){this.destroyInnerAnimations(t);let n=this._fetchNamespace(e.namespaceId);n&&n.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}t.classList?.contains(Wu)&&this.markElementAsDisabled(t,!1),this.driver.query(t,g8,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,r)=>this._balanceNamespaceList(n,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let r=this.collectedEnterElements[n];Dn(r,_8)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{e=this._flushAnimations(n,t)}finally{for(let r=0;r<n.length;r++)n[r]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let r=this.collectedLeaveElements[n];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],e.length?Cr(e).onDone(()=>{n.forEach(r=>r())}):n.forEach(r=>r())}}reportError(t){throw av(t)}_flushAnimations(t,e){let n=new Ss,r=[],a=new Map,o=[],u=new Map,m=new Map,f=new Map,h=new Set;this.disabledNodes.forEach(be=>{h.add(be);let Ee=this.driver.query(be,h8,!0);for(let ke=0;ke<Ee.length;ke++)h.add(Ee[ke])});let g=this.bodyNode,v=Array.from(this.statesByElement.keys()),b=bv(v,this.collectedEnterElements),w=new Map,x=0;b.forEach((be,Ee)=>{let ke=Bu+x++;w.set(Ee,ke),be.forEach(Ue=>Dn(Ue,ke))});let C=[],U=new Set,j=new Set;for(let be=0;be<this.collectedLeaveElements.length;be++){let Ee=this.collectedLeaveElements[be],ke=Ee[zn];ke&&ke.setForRemoval&&(C.push(Ee),U.add(Ee),ke.hasAnimation?this.driver.query(Ee,v8,!0).forEach(Ue=>U.add(Ue)):j.add(Ee))}let H=new Map,K=bv(v,Array.from(U));K.forEach((be,Ee)=>{let ke=zc+x++;H.set(Ee,ke),be.forEach(Ue=>Dn(Ue,ke))}),t.push(()=>{b.forEach((be,Ee)=>{let ke=w.get(Ee);be.forEach(Ue=>wo(Ue,ke))}),K.forEach((be,Ee)=>{let ke=H.get(Ee);be.forEach(Ue=>wo(Ue,ke))}),C.forEach(be=>{this.processLeaveNode(be)})});let ce=[],we=[];for(let be=this._namespaceList.length-1;be>=0;be--)this._namespaceList[be].drainQueuedTransitions(e).forEach(ke=>{let Ue=ke.player,et=ke.element;if(ce.push(Ue),this.collectedEnterElements.length){let ye=et[zn];if(ye&&ye.setForMove){if(ye.previousTriggersValues&&ye.previousTriggersValues.has(ke.triggerName)){let Oe=ye.previousTriggersValues.get(ke.triggerName),Se=this.statesByElement.get(ke.element);if(Se&&Se.has(ke.triggerName)){let he=Se.get(ke.triggerName);he.value=Oe,Se.set(ke.triggerName,he)}}Ue.destroy();return}}let Vt=!g||!this.driver.containsElement(g,et),B=H.get(et),re=w.get(et),L=this._buildInstruction(ke,n,re,B,Vt);if(L.errors&&L.errors.length){we.push(L);return}if(Vt){Ue.onStart(()=>Ur(et,L.fromStyles)),Ue.onDestroy(()=>Hn(et,L.toStyles)),r.push(Ue);return}if(ke.isFallbackTransition){Ue.onStart(()=>Ur(et,L.fromStyles)),Ue.onDestroy(()=>Hn(et,L.toStyles)),r.push(Ue);return}let V=[];L.timelines.forEach(ye=>{ye.stretchStartingKeyframe=!0,this.disabledNodes.has(ye.element)||V.push(ye)}),L.timelines=V,n.append(et,L.timelines);let fe={instruction:L,player:Ue,element:et};o.push(fe),L.queriedElements.forEach(ye=>sn(u,ye,[]).push(Ue)),L.preStyleProps.forEach((ye,Oe)=>{if(ye.size){let Se=m.get(Oe);Se||m.set(Oe,Se=new Set),ye.forEach((he,ht)=>Se.add(ht))}}),L.postStyleProps.forEach((ye,Oe)=>{let Se=f.get(Oe);Se||f.set(Oe,Se=new Set),ye.forEach((he,ht)=>Se.add(ht))})});if(we.length){let be=[];we.forEach(Ee=>{be.push(ov(Ee.triggerName,Ee.errors))}),ce.forEach(Ee=>Ee.destroy()),this.reportError(be)}let W=new Map,se=new Map;o.forEach(be=>{let Ee=be.element;n.has(Ee)&&(se.set(Ee,Ee),this._beforeAnimationBuild(be.player.namespaceId,be.instruction,W))}),r.forEach(be=>{let Ee=be.element;this._getPreviousPlayers(Ee,!1,be.namespaceId,be.triggerName,null).forEach(Ue=>{sn(W,Ee,[]).push(Ue),Ue.destroy()})});let ee=C.filter(be=>yv(be,m,f)),le=new Map;xv(le,this.driver,j,f,En).forEach(be=>{yv(be,m,f)&&ee.push(be)});let me=new Map;b.forEach((be,Ee)=>{xv(me,this.driver,new Set(be),m,ja)}),ee.forEach(be=>{let Ee=le.get(be),ke=me.get(be);le.set(be,new Map([...Ee?.entries()??[],...ke?.entries()??[]]))});let Me=[],mt=[],De={};o.forEach(be=>{let{element:Ee,player:ke,instruction:Ue}=be;if(n.has(Ee)){if(h.has(Ee)){ke.onDestroy(()=>Hn(Ee,Ue.toStyles)),ke.disabled=!0,ke.overrideTotalTime(Ue.totalTime),r.push(ke);return}let et=De;if(se.size>1){let B=Ee,re=[];for(;B=B.parentNode;){let L=se.get(B);if(L){et=L;break}re.push(B)}re.forEach(L=>se.set(L,et))}let Vt=this._buildAnimation(ke.namespaceId,Ue,W,a,me,le);if(ke.setRealPlayer(Vt),et===De)Me.push(ke);else{let B=this.playersByElement.get(et);B&&B.length&&(ke.parentPlayer=Cr(B)),r.push(ke)}}else Ur(Ee,Ue.fromStyles),ke.onDestroy(()=>Hn(Ee,Ue.toStyles)),mt.push(ke),h.has(Ee)&&r.push(ke)}),mt.forEach(be=>{let Ee=a.get(be.element);if(Ee&&Ee.length){let ke=Cr(Ee);be.setRealPlayer(ke)}}),r.forEach(be=>{be.parentPlayer?be.syncPlayerEvents(be.parentPlayer):be.destroy()});for(let be=0;be<C.length;be++){let Ee=C[be],ke=Ee[zn];if(wo(Ee,zc),ke&&ke.hasAnimation)continue;let Ue=[];if(u.size){let Vt=u.get(Ee);Vt&&Vt.length&&Ue.push(...Vt);let B=this.driver.query(Ee,$c,!0);for(let re=0;re<B.length;re++){let L=u.get(B[re]);L&&L.length&&Ue.push(...L)}}let et=Ue.filter(Vt=>!Vt.destroyed);et.length?w8(this,Ee,et):this.processLeaveNode(Ee)}return C.length=0,Me.forEach(be=>{this.players.push(be),be.onDone(()=>{be.destroy();let Ee=this.players.indexOf(be);this.players.splice(Ee,1)}),be.play()}),Me}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,n,r,a){let o=[];if(e){let u=this.playersByQueriedElement.get(t);u&&(o=u)}else{let u=this.playersByElement.get(t);if(u){let m=!a||a==Cs;u.forEach(f=>{f.queued||!m&&f.triggerName!=r||o.push(f)})}}return(n||r)&&(o=o.filter(u=>!(n&&n!=u.namespaceId||r&&r!=u.triggerName))),o}_beforeAnimationBuild(t,e,n){let r=e.triggerName,a=e.element,o=e.isRemovalTransition?void 0:t,u=e.isRemovalTransition?void 0:r;for(let m of e.timelines){let f=m.element,h=f!==a,g=sn(n,f,[]);this._getPreviousPlayers(f,h,o,u,e.toState).forEach(b=>{let w=b.getRealPlayer();w.beforeDestroy&&w.beforeDestroy(),b.destroy(),g.push(b)})}Ur(a,e.fromStyles)}_buildAnimation(t,e,n,r,a,o){let u=e.triggerName,m=e.element,f=[],h=new Set,g=new Set,v=e.timelines.map(w=>{let x=w.element;h.add(x);let C=x[zn];if(C&&C.removedBeforeQueried)return new ir(w.duration,w.delay);let U=x!==m,j=E8((n.get(x)||x8).map(W=>W.getRealPlayer())).filter(W=>{let se=W;return se.element?se.element===x:!1}),H=a.get(x),K=o.get(x),ce=Au(this._normalizer,w.keyframes,H,K),we=this._buildPlayer(w,ce,j);if(w.subTimeline&&r&&g.add(x),U){let W=new Es(t,u,x);W.setRealPlayer(we),f.push(W)}return we});f.forEach(w=>{sn(this.playersByQueriedElement,w.element,[]).push(w),w.onDone(()=>y8(this.playersByQueriedElement,w.element,w))}),h.forEach(w=>Dn(w,Lu));let b=Cr(v);return b.onDestroy(()=>{h.forEach(w=>wo(w,Lu)),Hn(m,e.toStyles)}),g.forEach(w=>{sn(r,w,[]).push(b)}),b}_buildPlayer(t,e,n){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,n):new ir(t.duration,t.delay)}},Es=class{namespaceId;triggerName;element;_player=new ir;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(t,e,n){this.namespaceId=t,this.triggerName=e,this.element=n}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,n)=>{e.forEach(r=>jc(t,n,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){let e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){sn(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){let e=this._player;e.triggerCallback&&e.triggerCallback(t)}};function y8(i,t,e){let n=i.get(t);if(n){if(n.length){let r=n.indexOf(e);n.splice(r,1)}n.length==0&&i.delete(t)}return n}function C8(i){return i??null}function Yc(i){return i&&i.nodeType===1}function S8(i){return i=="start"||i=="done"}function vv(i,t){let e=i.style.display;return i.style.display=t??"none",e}function xv(i,t,e,n,r){let a=[];e.forEach(m=>a.push(vv(m)));let o=[];n.forEach((m,f)=>{let h=new Map;m.forEach(g=>{let v=t.computeStyle(f,g,r);h.set(g,v),(!v||v.length==0)&&(f[zn]=b8,o.push(f))}),i.set(f,h)});let u=0;return e.forEach(m=>vv(m,a[u++])),o}function bv(i,t){let e=new Map;if(i.forEach(u=>e.set(u,[])),t.length==0)return e;let n=1,r=new Set(t),a=new Map;function o(u){if(!u)return n;let m=a.get(u);if(m)return m;let f=u.parentNode;return e.has(f)?m=f:r.has(f)?m=n:m=o(f),a.set(u,m),m}return t.forEach(u=>{let m=o(u);m!==n&&e.get(m).push(u)}),e}function Dn(i,t){i.classList?.add(t)}function wo(i,t){i.classList?.remove(t)}function w8(i,t,e){Cr(e).onDone(()=>i.processLeaveNode(t))}function E8(i){let t=[];return Pv(i,t),t}function Pv(i,t){for(let e=0;e<i.length;e++){let n=i[e];n instanceof Jr?Pv(n.players,t):t.push(n)}}function T8(i,t){let e=Object.keys(i),n=Object.keys(t);if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++){let a=e[r];if(!t.hasOwnProperty(a)||i[a]!==t[a])return!1}return!0}function yv(i,t,e){let n=e.get(i);if(!n)return!1;let r=t.get(i);return r?n.forEach(a=>r.add(a)):t.set(i,n),e.delete(i),!0}var Eo=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(t,e)=>{};constructor(t,e,n){this._driver=e,this._normalizer=n,this._transitionEngine=new em(t.body,e,n),this._timelineEngine=new Ju(t.body,e,n),this._transitionEngine.onRemovalComplete=(r,a)=>this.onRemovalComplete(r,a)}registerTrigger(t,e,n,r,a){let o=t+"-"+r,u=this._triggerCache[o];if(!u){let m=[],f=[],h=Sv(this._driver,a,m,f);if(m.length)throw Y_(r,m);u=m8(r,h,this._normalizer),this._triggerCache[o]=u}this._transitionEngine.registerTrigger(e,r,u)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,n,r){this._transitionEngine.insertNode(t,e,n,r)}onRemove(t,e,n){this._transitionEngine.removeNode(t,e,n)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,n,r){if(n.charAt(0)=="@"){let[a,o]=Ou(n),u=r;this._timelineEngine.command(a,e,o,u)}else this._transitionEngine.trigger(t,e,n,r)}listen(t,e,n,r,a){if(n.charAt(0)=="@"){let[o,u]=Ou(n);return this._timelineEngine.listen(o,e,u,a)}return this._transitionEngine.listen(t,e,n,r,a)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}};function P8(i,t){let e=null,n=null;return Array.isArray(t)&&t.length?(e=zu(t[0]),t.length>1&&(n=zu(t[t.length-1]))):t instanceof Map&&(e=zu(t)),e||n?new k8(i,e,n):null}var k8=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,n,r){this._element=e,this._startStyles=n,this._endStyles=r;let a=i.initialStylesByElement.get(e);a||i.initialStylesByElement.set(e,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&Hn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Hn(this._element,this._initialStyles),this._endStyles&&(Hn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(Ur(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ur(this._element,this._endStyles),this._endStyles=null),Hn(this._element,this._initialStyles),this._state=3)}}return i})();function zu(i){let t=null;return i.forEach((e,n)=>{I8(n)&&(t=t||new Map,t.set(n,e))}),t}function I8(i){return i==="display"||i==="position"}var n0=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(t,e,n,r){this.element=t,this.keyframes=e,this.options=n,this._specialStyles=r,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;let e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){let e=[];return t.forEach(n=>{e.push(Object.fromEntries(n))}),e}_triggerWebAnimation(t,e,n){return t.animate(this._convertKeyframesToObject(e),n)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,r)=>{r!=="offset"&&t.set(r,this._finished?n:qc(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){let e=t==="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},r0=class{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}containsElement(t,e){return Du(t,e)}getParentElement(t){return Hc(t)}query(t,e,n){return Ru(t,e,n)}computeStyle(t,e,n){return qc(t,e)}animate(t,e,n,r,a,o=[]){let u=r==0?"both":"forwards",m={duration:n,delay:r,fill:u};a&&(m.easing=a);let f=new Map,h=o.filter(b=>b instanceof n0);dv(n,r)&&h.forEach(b=>{b.currentSnapshot.forEach((w,x)=>f.set(x,w))});let g=lv(e).map(b=>new Map(b));g=uv(t,g,f);let v=P8(t,g);return new n0(t,g,m,v)}};var Qc="@",kv="@.disabled",a0=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(t,e,n,r){this.namespaceId=t,this.delegate=e,this.engine=n,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,n,r=!0){this.delegate.insertBefore(t,e,n),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,n){this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,n,r){this.delegate.setAttribute(t,e,n,r)}removeAttribute(t,e,n){this.delegate.removeAttribute(t,e,n)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,n,r){this.delegate.setStyle(t,e,n,r)}removeStyle(t,e,n){this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){e.charAt(0)==Qc&&e==kv?this.disableAnimations(t,!!n):this.delegate.setProperty(t,e,n)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,n,r){return this.delegate.listen(t,e,n,r)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}},tm=class extends a0{factory;constructor(t,e,n,r,a){super(e,n,r,a),this.factory=t,this.namespaceId=e}setProperty(t,e,n){e.charAt(0)==Qc?e.charAt(1)=="."&&e==kv?(n=n===void 0?!0:!!n,this.disableAnimations(t,n)):this.engine.process(this.namespaceId,t,e.slice(1),n):this.delegate.setProperty(t,e,n)}listen(t,e,n,r){if(e.charAt(0)==Qc){let a=M8(t),o=e.slice(1),u="";return o.charAt(0)!=Qc&&([o,u]=F8(o)),this.engine.listen(this.namespaceId,a,o,u,m=>{let f=m._data||-1;this.factory.scheduleListenerCallback(f,n,m)})}return this.delegate.listen(t,e,n,r)}};function M8(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function F8(i){let t=i.indexOf("."),e=i.substring(0,t),n=i.slice(t+1);return[e,n]}var o0=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(t,e,n){this.delegate=t,this.engine=e,this._zone=n,e.onRemovalComplete=(r,a)=>{a?.removeChild(null,r)}}createRenderer(t,e){let n="",r=this.delegate.createRenderer(t,e);if(!t||!e?.data?.animation){let f=this._rendererCache,h=f.get(r);if(!h){let g=()=>f.delete(r);h=new a0(n,r,this.engine,g),f.set(r,h)}return h}let a=e.id,o=e.id+"-"+this._currentId;this._currentId++,this.engine.register(o,t);let u=f=>{Array.isArray(f)?f.forEach(u):this.engine.registerTrigger(a,o,t,f.name,f)};return e.data.animation.forEach(u),new tm(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,n){if(t>=0&&t<this._microtaskId){this._zone.run(()=>e(n));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(a=>{let[o,u]=a;o(u)}),this._animationCallbacksBuffer=[]})}),r.push([e,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(t){this.engine.flush(),this.delegate.componentReplaced?.(t)}};var O8=(()=>{class i extends Eo{constructor(e,n,r){super(e,n,r)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(ct(Oo),ct(va),ct(xa))};static \u0275prov=Ze({token:i,factory:i.\u0275fac})}return i})();function D8(){return new Jc}function R8(i,t,e){return new o0(i,t,e)}var Iv=[{provide:xa,useFactory:D8},{provide:Eo,useClass:O8},{provide:Fo,useFactory:R8,deps:[Fm,Eo,Yi]}],PW=[{provide:va,useClass:im},{provide:Mo,useValue:"NoopAnimations"},...Iv],N8=[{provide:va,useFactory:()=>new r0},{provide:Mo,useFactory:()=>"BrowserAnimations"},...Iv];function Mv(){return Em("NgEagerAnimations"),[...N8]}Am(il,{providers:[Bm(O_),Mv(),Om(Dm([(i,t)=>{let e=localStorage.getItem("token");if(e){let n=i.clone({setHeaders:{"x-auth-token":e}});return t(n)}return t(i)}]))]}).catch(i=>console.error(i));
