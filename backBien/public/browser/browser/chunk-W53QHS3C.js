import{a as Fe}from"./chunk-ESWG6PAM.js";import{a as Pe}from"./chunk-3QU2DFXI.js";import{T as we,U as Oe}from"./chunk-BH6ZDK2X.js";import{$ as Q,B as H,Cd as xe,Db as n,Dd as be,Eb as t,Ed as Ce,F as L,Fb as v,Fd as he,Gb as E,Hb as I,Hd as Se,Jb as O,Lb as S,Mb as d,Md as ye,Nc as Z,Nd as Ee,Oc as ee,Od as Ie,Pc as te,Q as z,Qc as ne,Rb as Y,Rc as ie,Sb as q,T as N,Tb as J,Vc as ae,W as K,Wb as $,Xb as r,Xc as re,Yb as m,Yc as oe,Za as l,Zb as x,Zc as le,aa as V,cb as R,ed as ce,f as U,fd as se,gc as b,gd as me,ia as C,ja as h,jb as G,jc as W,jd as B,k as F,lc as u,mc as _,md as pe,nb as g,nc as y,nd as D,p as w,pd as de,qc as X,qd as ue,ub as s,vd as ge,wd as fe,x as j,xd as _e,z as k,zd as ve}from"./chunk-ZBSVT2Z7.js";import{a as M,b as A}from"./chunk-EQDQRRRY.js";var T=class i{constructor(a){this.http=a}base=`${B.apiUrl}/reportes`;headers(){return new ce({"x-auth-token":localStorage.getItem("auth_token")||""})}params(a){let e=new se;return Object.entries(a||{}).forEach(([o,c])=>{c!=null&&String(c).trim()!==""&&(e=e.set(o,String(c)))}),e}getResumen(a){return this.http.get(`${this.base}/cancelaciones-resumen`,{params:this.params(a),headers:this.headers()})}getAgrupado(a,e){return this.http.get(`${this.base}/cancelaciones-${a}`,{params:this.params(e),headers:this.headers()})}searchClientes(a){let e=`${B.apiUrl}/clientes/buscar?q=${encodeURIComponent(a)}&limit=50`;return this.http.get(e,{headers:this.headers()}).pipe(w(o=>o?.data??o?.rows??o??[]),k(()=>F([])))}static \u0275fac=function(e){return new(e||i)(Q(me))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};var Me=["cliInput"],Ae=i=>({t:"Cancelaciones",v:i}),Ne=i=>({t:"Total Devuelto",v:i,money:!0}),Ve=i=>({t:"Devuelto en efectivo",v:i,money:!0}),Re=i=>({t:"Devuelto en monedero",v:i,money:!0}),$e=i=>({t:"Ticket Prom. Devuelto",v:i,money:!0}),Be=i=>({t:"% sobre pedidos",v:i,pct:!0}),Ue=i=>({t:"Prom. d\xEDas a cancelar",v:i}),je=(i,a,e,o,c,p,f)=>[i,a,e,o,c,p,f];function He(i,a){if(i&1&&(n(0,"option",31),r(1),t()),i&2){let e=a.$implicit;s("value",e._id),l(),x(" ",e.nombre," ")}}function Le(i,a){if(i&1&&(n(0,"span"),r(1),t()),i&2){let e=d().$implicit;l(),x(" \u2014 ",e.farmacia.nombre,"")}}function ze(i,a){if(i&1&&(n(0,"span",33),r(1),t()),i&2){let e=d().$implicit;l(),x(" (",e.rol,")")}}function Ke(i,a){if(i&1&&(n(0,"option",31),r(1),u(2,"titlecase"),g(3,Le,2,1,"span",30)(4,ze,2,1,"span",32),t()),i&2){let e=a.$implicit;s("value",e._id),l(),x(" ",_(2,4,e.nombre||e.usuario)," "),l(2),s("ngIf",e.farmacia==null?null:e.farmacia.nombre),l(),s("ngIf",e.rol)}}function Qe(i,a){if(i&1){let e=O();n(0,"button",36),S("click",function(){let c=C(e).$implicit,p=d(2);return h(p.selectCliente(c))}),n(1,"div",37),r(2),t(),n(3,"small",33),r(4),t()()}if(i&2){let e=a.$implicit;l(2),m(e.nombre||"(sin nombre)"),l(2),m(e.telefono||"\u2014")}}function Ge(i,a){if(i&1&&(n(0,"div",34),g(1,Qe,5,2,"button",35),t()),i&2){let e=d();l(),s("ngForOf",e.clienteOpts)}}function Ye(i,a){if(i&1&&(n(0,"span"),r(1),t()),i&2){let e=d(2);l(),x("\xB7 ",e.clienteSel.telefono,"")}}function qe(i,a){if(i&1){let e=O();n(0,"div",38)(1,"span",39),r(2),g(3,Ye,2,1,"span",30),t(),n(4,"button",40),S("click",function(){C(e);let c=d(),p=$(41);return h(c.clearCliente(p))}),r(5," Borrar "),t()()}if(i&2){let e=d();l(2),x(" ",e.clienteSel.nombre," "),l(),s("ngIf",e.clienteSel.telefono)}}function Je(i,a){i&1&&(E(0),n(1,"div",12)(2,"label",13),r(3,"Top N"),t(),v(4,"input",41),t(),n(5,"div",12)(6,"label",13),r(7,"Orden"),t(),n(8,"select",42)(9,"option",43),r(10,"Importe"),t(),n(11,"option",44),r(12,"# Cancelaciones"),t(),n(13,"option",45),r(14,"Prom. D\xEDas"),t()()(),n(15,"div",12)(16,"label",13),r(17,"Direcci\xF3n"),t(),n(18,"select",46)(19,"option",47),r(20,"Desc"),t(),n(21,"option",48),r(22,"Asc"),t()()(),I())}function We(i,a){i&1&&(n(0,"div",12)(1,"label",13),r(2,"Agrupar por"),t(),n(3,"select",49)(4,"option",50),r(5,"Usuario"),t(),n(6,"option",51),r(7,"Farmacia"),t(),n(8,"option",52),r(9,"Cliente"),t()()(),n(10,"div",12)(11,"label",13),r(12,"Top N"),t(),v(13,"input",53),t(),n(14,"div",12)(15,"label",13),r(16,"Orden"),t(),n(17,"select",54)(18,"option",43),r(19,"Importe"),t(),n(20,"option",44),r(21,"# Cancelaciones"),t(),n(22,"option",45),r(23,"Prom. D\xEDas"),t()()(),n(24,"div",12)(25,"label",13),r(26,"Direcci\xF3n"),t(),n(27,"select",55)(28,"option",47),r(29,"Desc"),t(),n(30,"option",48),r(31,"Asc"),t()()())}function Xe(i,a){if(i&1&&(E(0),n(1,"div",64)(2,"div",65)(3,"div",66),r(4),t(),n(5,"div",67),r(6),u(7,"number"),u(8,"currency"),u(9,"number"),t()()(),I()),i&2){let e=a.$implicit;l(4),m(e.t),l(2),x(" ",e.v===null?"\u2014":e.pct?y(7,2,e.v,"1.0-2")+"%":e.money?_(8,5,e.v):y(9,7,e.v,"1.0-2")," ")}}function Ze(i,a){if(i&1&&(n(0,"tr")(1,"td"),r(2),t(),n(3,"td"),r(4),u(5,"currency"),t(),n(6,"td"),r(7),u(8,"currency"),t(),n(9,"td"),r(10),u(11,"currency"),t(),n(12,"td"),r(13),t(),n(14,"td"),r(15),u(16,"number"),t()()),i&2){let e=a.$implicit;l(2),m(e.nombre||e.farmaciaId),l(2),m(_(5,6,e.importe)),l(3),m(_(8,8,e.dinero)),l(3),m(_(11,10,e.vale)),l(3),m(e.cancelaciones),l(2),m(e.avgDias===null?"\u2014":y(16,12,e.avgDias,"1.0-2"))}}function et(i,a){i&1&&(n(0,"tr")(1,"td",68),r(2,"Sin datos"),t()())}function tt(i,a){if(i&1&&(n(0,"tr")(1,"td"),r(2),t(),n(3,"td"),r(4),u(5,"currency"),t(),n(6,"td"),r(7),u(8,"currency"),t(),n(9,"td"),r(10),u(11,"currency"),t(),n(12,"td"),r(13),t(),n(14,"td"),r(15),u(16,"number"),t()()),i&2){let e=a.$implicit;l(2),m(e.nombre||e.usuarioId),l(2),m(_(5,6,e.importe)),l(3),m(_(8,8,e.dinero)),l(3),m(_(11,10,e.vale)),l(3),m(e.cancelaciones),l(2),m(e.avgDias===null?"\u2014":y(16,12,e.avgDias,"1.0-2"))}}function nt(i,a){i&1&&(n(0,"tr")(1,"td",68),r(2,"Sin datos"),t()())}function it(i,a){if(i&1&&(n(0,"tr")(1,"td"),r(2),t(),n(3,"td"),r(4),t(),n(5,"td"),r(6),u(7,"currency"),t(),n(8,"td"),r(9),u(10,"currency"),t(),n(11,"td"),r(12),u(13,"currency"),t(),n(14,"td"),r(15),t(),n(16,"td"),r(17),u(18,"number"),t()()),i&2){let e=a.$implicit;l(2),m(e.nombre||e.clienteId),l(2),m(e.telefono||"\u2014"),l(2),m(_(7,7,e.importe)),l(3),m(_(10,9,e.dinero)),l(3),m(_(13,11,e.vale)),l(3),m(e.cancelaciones),l(2),m(e.avgDias===null?"\u2014":y(18,13,e.avgDias,"1.0-2"))}}function at(i,a){i&1&&(n(0,"tr")(1,"td",69),r(2,"Sin datos"),t()())}function rt(i,a){if(i&1&&(E(0),n(1,"div",56),g(2,Xe,10,10,"ng-container",57),t(),n(3,"div",58)(4,"div",59)(5,"div",60),r(6,"Top Farmacias"),t(),n(7,"div",61)(8,"table",62)(9,"thead")(10,"tr")(11,"th"),r(12,"Farmacia"),t(),n(13,"th"),r(14,"Importe"),t(),n(15,"th"),r(16,"Dinero"),t(),n(17,"th"),r(18,"Vale"),t(),n(19,"th"),r(20,"#"),t(),n(21,"th"),r(22,"Prom. D\xEDas"),t()()(),n(23,"tbody"),g(24,Ze,17,15,"tr",57)(25,et,3,0,"tr",30),t()()()(),n(26,"div",59)(27,"div",60),r(28,"Top Usuarios"),t(),n(29,"div",61)(30,"table",62)(31,"thead")(32,"tr")(33,"th"),r(34,"Usuario"),t(),n(35,"th"),r(36,"Importe"),t(),n(37,"th"),r(38,"Dinero"),t(),n(39,"th"),r(40,"Vale"),t(),n(41,"th"),r(42,"#"),t(),n(43,"th"),r(44,"Prom. D\xEDas"),t()()(),n(45,"tbody"),g(46,tt,17,15,"tr",57)(47,nt,3,0,"tr",30),t()()()(),n(48,"div",63)(49,"div",60),r(50,"Top Clientes"),t(),n(51,"div",61)(52,"table",62)(53,"thead")(54,"tr")(55,"th"),r(56,"Cliente"),t(),n(57,"th"),r(58,"Tel\xE9fono"),t(),n(59,"th"),r(60,"Importe"),t(),n(61,"th"),r(62,"Dinero"),t(),n(63,"th"),r(64,"Vale"),t(),n(65,"th"),r(66,"#"),t(),n(67,"th"),r(68,"Prom. D\xEDas"),t()()(),n(69,"tbody"),g(70,it,19,16,"tr",57)(71,at,3,0,"tr",30),t()()()()(),I()),i&2){let e=a.ngIf;l(2),s("ngForOf",W(21,je,b(7,Ae,e.kpis.numCancelaciones),b(9,Ne,e.kpis.totalDevuelto),b(11,Ve,e.kpis.dineroDevuelto),b(13,Re,e.kpis.valeDevuelto),b(15,$e,e.kpis.ticketPromedioDevuelto),b(17,Be,e.kpis.porcCancelacionesSobrePedidos),b(19,Ue,e.kpis.avgDiasACancelar))),l(22),s("ngForOf",e.topFarmacias),l(),s("ngIf",!(e.topFarmacias!=null&&e.topFarmacias.length)),l(21),s("ngForOf",e.topUsuarios),l(),s("ngIf",!(e.topUsuarios!=null&&e.topUsuarios.length)),l(23),s("ngForOf",e.topClientes),l(),s("ngIf",!(e.topClientes!=null&&e.topClientes.length))}}function ot(i,a){if(i&1&&(n(0,"th"),r(1),t()),i&2){let e=a.$implicit;l(),m(e)}}function lt(i,a){if(i&1&&(n(0,"span"),r(1),u(2,"currency"),t()),i&2){let e=d().$implicit,o=d().$implicit;l(),m(_(2,1,o[e]))}}function ct(i,a){if(i&1&&(n(0,"span"),r(1),u(2,"currency"),t()),i&2){let e=d().$implicit,o=d().$implicit;l(),m(_(2,1,o[e]))}}function st(i,a){if(i&1&&(n(0,"span"),r(1),u(2,"currency"),t()),i&2){let e=d().$implicit,o=d().$implicit;l(),m(_(2,1,o[e]))}}function mt(i,a){if(i&1&&(n(0,"span"),r(1),u(2,"number"),t()),i&2){let e=d().$implicit,o=d().$implicit;l(),m(o[e]===null?"\u2014":y(2,1,o[e],"1.0-2"))}}function pt(i,a){if(i&1&&(n(0,"span"),r(1),t()),i&2){let e=d().$implicit,o=d().$implicit;l(),m(o[e])}}function dt(i,a){if(i&1&&(n(0,"td"),E(1,73),g(2,lt,3,3,"span",74)(3,ct,3,3,"span",74)(4,st,3,3,"span",74)(5,mt,3,4,"span",74)(6,pt,2,1,"span",75),I(),t()),i&2){let e=a.$implicit;l(),s("ngSwitch",e),l(),s("ngSwitchCase","importe"),l(),s("ngSwitchCase","dinero"),l(),s("ngSwitchCase","vale"),l(),s("ngSwitchCase","avgDias")}}function ut(i,a){if(i&1&&(n(0,"tr"),g(1,dt,7,5,"td",57),t()),i&2){let e=d(2);l(),s("ngForOf",e.displayKeys)}}function gt(i,a){i&1&&(n(0,"tr")(1,"td",76),r(2,"Sin datos"),t()())}function ft(i,a){if(i&1){let e=O();E(0),n(1,"div",70)(2,"button",71),S("click",function(){C(e);let c=d();return h(c.exportarCsv())}),r(3,"Exportar CSV"),t()(),n(4,"div",61)(5,"table",72)(6,"thead")(7,"tr"),g(8,ot,2,1,"th",57),t()(),n(9,"tbody"),g(10,ut,2,1,"tr",57)(11,gt,3,0,"tr",30),t()()(),I()}if(i&2){let e=d();l(2),s("disabled",!e.rowsAgrupado.length),l(6),s("ngForOf",e.displayKeys),l(2),s("ngForOf",e.rowsAgrupado),l(),s("ngIf",!e.rowsAgrupado.length)}}var ke=class i{constructor(a,e){this.farmaciaService=a;this.usuarioService=e}fb=V(ye);svc=V(T);filtroForm;cargando=!1;resumen=null;rowsAgrupado=[];displayKeys=[];clienteInput$=new U;clienteOpts=[];clienteSel=null;_lastCliQ="";farmacias=[];usuarios=[];usuariosOrdenados=[];trackById=(a,e)=>e?._id;cliInputRef;norm(a=""){return String(a).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}filterClientesLocal(a,e){let o=this.norm(e),c=e.replace(/\D/g,"");return(a||[]).filter(p=>{let f=this.norm(p?.nombre).includes(o),P=c?String(p?.telefono||"").includes(c):!1;return f||P})}ngOnInit(){let a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1),o=c=>new Date(c.getTime()-c.getTimezoneOffset()*6e4).toISOString().slice(0,10);this.filtroForm=this.fb.group({vista:["resumen",D.required],fechaIni:[o(e),D.required],fechaFin:[o(a),D.required],farmaciaId:[""],usuarioId:[""],clienteId:[""],topN:[10],orden:["importe"],dir:["desc"],agrupacion:["usuario"],topNAgr:[10],ordenAgr:["importe"],dirAgr:["desc"]}),this.clienteInput$.pipe(w(c=>(c||"").trim()),N(c=>{this._lastCliQ=c}),N(c=>{c.length<2&&(this.clienteOpts=[])}),j(c=>c.length>=2),H(250),L(),z(c=>this.svc.searchClientes(c).pipe(w(p=>this.filterClientesLocal(Array.isArray(p)?p:[],c)),k(()=>F([]))))).subscribe(c=>{this.clienteOpts=this.filterClientesLocal(c,this._lastCliQ)}),this.cargarFarmacias(),this.cargarUsuarios(),this.buscar()}cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe(a=>{this.farmacias=(a||[]).filter(e=>e.activo!==!1).sort((e,o)=>e.nombre.localeCompare(o.nombre,"es",{sensitivity:"base"}))})}cargarUsuarios(){this.usuarioService.obtenerUsuarios().subscribe(a=>{this.usuarios=a||[],this.usuariosOrdenados=[...this.usuarios].sort((e,o)=>{let c=(e.nombre||e.usuario||"").trim(),p=(o.nombre||o.usuario||"").trim(),f=c.localeCompare(p,"es",{sensitivity:"base"});if(f!==0)return f;let P=e.farmacia?.nombre||"",De=o.farmacia?.nombre||"";return P.localeCompare(De,"es",{sensitivity:"base"})})})}onClienteInput(a){let e=(a||"").trim();if(e.length<2){this.clienteOpts=[];return}this.svc.searchClientes(e).subscribe(o=>{this.clienteOpts=Array.isArray(o)?o:[]})}selectCliente(a){this.clienteSel=a,this.clienteOpts=[],this.filtroForm.patchValue({clienteId:a._id})}clearCliente(a){this.clienteSel=null,this.filtroForm.patchValue({clienteId:""}),this.clienteOpts=[],a&&(a.value="",a.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>a.focus(),0))}buscar(){if(this.cargando)return;this.cargando=!0;let a=this.filtroForm.getRawValue(),e={fechaIni:a.fechaIni,fechaFin:a.fechaFin,farmaciaId:a.farmaciaId||void 0,usuarioId:a.usuarioId||void 0,clienteId:a.clienteId||void 0};if(a.vista==="resumen")this.svc.getResumen(A(M({},e),{topN:a.topN,orden:a.orden,dir:a.dir})).subscribe({next:o=>{this.resumen=o,this.rowsAgrupado=[],this.displayKeys=[],this.cargando=!1},error:o=>{console.error(o),this.cargando=!1}});else{let o=a.agrupacion;this.svc.getAgrupado(o,A(M({},e),{topN:a.topNAgr,orden:a.ordenAgr,dir:a.dirAgr})).subscribe({next:c=>{this.resumen=null,this.rowsAgrupado=c?.rows||[],this.displayKeys=this.buildDisplayKeys(o,this.rowsAgrupado),this.cargando=!1},error:c=>{console.error(c),this.cargando=!1}})}}buildDisplayKeys(a,e){if(!e?.length)return[];let o=Object.keys(e[0]),c={usuario:["usuarioId","_id"],farmacia:["farmaciaId","_id"],cliente:["clienteId","_id"],_:[]},p=c[a]??c._;return o.filter(f=>!p.includes(f))}limpiar(){let a=this.filtroForm.value.vista,e=new Date,o=new Date(e.getFullYear(),e.getMonth(),1),c=f=>new Date(f.getTime()-f.getTimezoneOffset()*6e4).toISOString().slice(0,10);this.filtroForm.reset({vista:a,fechaIni:c(o),fechaFin:c(e),farmaciaId:"",usuarioId:"",clienteId:"",topN:10,orden:"importe",dir:"desc",agrupacion:"usuario",topNAgr:10,ordenAgr:"importe",dirAgr:"desc"}),this.clienteSel=null,this.clienteOpts=[],this.filtroForm.patchValue({clienteId:""});let p=this.cliInputRef?.nativeElement;p&&(p.value="",p.dispatchEvent(new Event("input",{bubbles:!0}))),this.buscar()}exportarCsv(){if(!this.rowsAgrupado?.length)return;let a=this.displayKeys,e=this.rowsAgrupado.map(f=>a.map(P=>`"${String(f[P]??"").replace(/"/g,'""')}"`).join(",")),o=[a.join(","),...e].join(`
`),c=URL.createObjectURL(new Blob([o],{type:"text/csv;charset=utf-8;"})),p=document.createElement("a");p.href=c,p.download="cancelaciones-agrupado.csv",p.click(),URL.revokeObjectURL(c)}static \u0275fac=function(e){return new(e||i)(R(Pe),R(Fe))};static \u0275cmp=G({type:i,selectors:[["app-cancelaciones-page"]],viewQuery:function(e,o){if(e&1&&Y(Me,5),e&2){let c;q(c=J())&&(o.cliInputRef=c.first)}},decls:55,vars:18,consts:[["cliInput",""],["agrControls",""],[1,"titulo","text-center"],[1,"filtros",3,"ngSubmit","formGroup"],[1,"row","g-2","align-items-end"],[1,"mb-2","row"],[1,"col-md-3"],[1,"form-label","d-block","mb-1"],[1,"d-flex","gap-2","flex-wrap"],[1,"report-chip"],["type","radio","formControlName","vista","value","resumen"],["type","radio","formControlName","vista","value","agrupado"],[1,"col-md-2"],[1,"form-label"],["type","date","formControlName","fechaIni",1,"form-control",3,"disabled"],["type","date","formControlName","fechaFin",1,"form-control",3,"disabled"],["formControlName","farmaciaId",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["formControlName","usuarioId",1,"form-select",3,"disabled"],[1,"col-md-4","position-relative"],["type","text","placeholder","Nombre (m\xEDn. 2 letras)",1,"form-control",3,"input","disabled"],["class","suggest-panel",4,"ngIf"],["class","mt-1 d-flex align-items-center gap-2 flex-wrap",4,"ngIf"],["type","hidden","formControlName","clienteId"],[4,"ngIf","ngIfElse"],[1,"col-auto","ms-auto"],["type","button","matTooltip","Limpiar filtros",1,"btn-rojo",3,"click","disabled"],[1,"fas","fa-times"],["type","submit",1,"btn-gris",2,"margin-left","3rem",3,"disabled"],[4,"ngIf"],[3,"value"],["class","text-muted",4,"ngIf"],[1,"text-muted"],[1,"suggest-panel"],["type","button","class","suggest-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"suggest-item",3,"click"],[1,"fw-semibold"],[1,"mt-1","d-flex","align-items-center","gap-2","flex-wrap"],[1,"badge","bg-primary-subtle","text-primary","border","mb-0"],["type","button",1,"btn","btn-link","btn-sm","p-0",3,"click"],["type","number","min","1","formControlName","topN",1,"form-control"],["formControlName","orden",1,"form-select"],["value","importe"],["value","cancelaciones"],["value","avgDias"],["formControlName","dir",1,"form-select"],["value","desc"],["value","asc"],["formControlName","agrupacion",1,"form-select"],["value","usuario"],["value","farmacia"],["value","cliente"],["type","number","min","1","formControlName","topNAgr",1,"form-control"],["formControlName","ordenAgr",1,"form-select"],["formControlName","dirAgr",1,"form-select"],[1,"row","row-cols-2","row-cols-sm-3","row-cols-lg-5","g-2",2,"margin-top","1rem"],[4,"ngFor","ngForOf"],[1,"row","g-1","mt-2"],[1,"col-12","col-lg-6"],[1,"subtitulo","text-center","mb-0","mt-3"],[1,"table-responsive"],[1,"tabla","w-100","mt-0"],[1,"col-12"],[1,"col"],[1,"kpi-card","h-100"],[1,"kpi-title"],[1,"kpi-value"],["colspan","6",1,"text-center","text-muted"],["colspan","7",1,"text-center","text-muted"],[1,"d-flex","justify-content-end","mb-1"],[1,"btn-amarillo","mt-2",3,"click","disabled"],[1,"tabla","w-100"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["colspan","20",1,"text-center","text-muted"]],template:function(e,o){if(e&1){let c=O();n(0,"h2",2),r(1,"Reportes de cancelaciones de pedidos"),t(),n(2,"form",3),S("ngSubmit",function(){return C(c),h(o.buscar())}),n(3,"div",4)(4,"div",5)(5,"div",6)(6,"label",7),r(7,"Vista"),t(),n(8,"div",8)(9,"label",9),v(10,"input",10),r(11,"Resumen"),t(),n(12,"label",9),v(13,"input",11),r(14,"Agrupado"),t()()(),n(15,"div",12)(16,"label",13),r(17,"Desde"),t(),v(18,"input",14),t(),n(19,"div",12)(20,"label",13),r(21,"Hasta"),t(),v(22,"input",15),t(),n(23,"div",12)(24,"label",13),r(25,"Farmacia"),t(),n(26,"select",16)(27,"option",17),r(28,"Todas"),t(),g(29,He,2,2,"option",18),t()(),n(30,"div",6)(31,"label",13),r(32,"Usuario"),t(),n(33,"select",19)(34,"option",17),r(35,"Todos"),t(),g(36,Ke,5,6,"option",18),t()()(),n(37,"div",20)(38,"label",13),r(39,"Cliente"),t(),n(40,"input",21,0),S("input",function(f){return C(c),h(o.clienteInput$.next(f.target.value))}),t(),g(42,Ge,2,1,"div",22)(43,qe,6,2,"div",23),v(44,"input",24),t(),g(45,Je,23,0,"ng-container",25)(46,We,32,0,"ng-template",null,1,X),n(48,"div",26)(49,"button",27),S("click",function(){return C(c),h(o.limpiar())}),v(50,"i",28),t(),n(51,"button",29),r(52,"Buscar"),t()()()(),g(53,rt,72,29,"ng-container",30)(54,ft,12,4,"ng-container",30)}if(e&2){let c,p=$(47);l(2),s("formGroup",o.filtroForm),l(16),s("disabled",o.cargando),l(4),s("disabled",o.cargando),l(4),s("disabled",o.cargando),l(3),s("ngForOf",o.farmacias)("ngForTrackBy",o.trackById),l(4),s("disabled",o.cargando),l(3),s("ngForOf",o.usuariosOrdenados)("ngForTrackBy",o.trackById),l(4),s("disabled",o.cargando||!!o.clienteSel),l(2),s("ngIf",!o.clienteSel&&((c=o.clienteOpts==null?null:o.clienteOpts.length)!==null&&c!==void 0?c:0)>0),l(),s("ngIf",o.clienteSel),l(2),s("ngIf",o.filtroForm.value.vista==="resumen")("ngIfElse",p),l(4),s("disabled",o.cargando),l(2),s("disabled",o.cargando),l(2),s("ngIf",o.filtroForm.value.vista==="resumen"&&o.resumen),l(),s("ngIf",o.filtroForm.value.vista==="agrupado")}},dependencies:[le,Z,ee,te,ne,ie,re,ae,oe,Ie,ge,Ce,he,pe,fe,be,_e,de,ue,Se,ve,xe,Ee,Oe,we],styles:[".filtros[_ngcontent-%COMP%]{border-bottom:2px solid #0453b3;padding-bottom:1rem}.form-label[_ngcontent-%COMP%]{margin-bottom:0}.report-chip[_ngcontent-%COMP%]{border:1px solid #d0d7de;border-radius:9999px;padding:.375rem .75rem;cursor:pointer;-webkit-user-select:none;user-select:none;display:inline-flex;align-items:center;gap:.5rem;transition:all .15s ease-in-out}.report-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.report-chip[_ngcontent-%COMP%]:hover{background:#a5d1fa}.report-chip[_ngcontent-%COMP%]:has(input:checked){border-color:#0d6efd;background:#e7f1ff;color:#0d6efd;font-weight:600;box-shadow:0 0 0 2px #0d6efd26 inset}.suggest-panel[_ngcontent-%COMP%]{position:absolute;z-index:20;left:0;right:0;top:100%;background:#fff;border:1px solid #d0d7de;border-radius:.5rem;padding:.25rem;margin-top:.25rem;max-height:240px;overflow:auto}.suggest-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:.375rem .5rem;border:0;background:transparent}.suggest-item[_ngcontent-%COMP%]:hover{background:#f2f6ff}.kpi-card[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:.75rem;padding:.75rem;background:#fff}.kpi-title[_ngcontent-%COMP%]{font-size:.85rem;color:#6b7280}.kpi-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subtitulo[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#64b5f6;color:#0a2239;font-weight:600;padding:.5rem}.tabla[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;border-top:1px solid #e5e7eb}.tabla[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#e3f2fd}.tabla[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#cfe8ff}.btn-amarillo[_ngcontent-%COMP%]{background:#ffd54f;border:1px solid #e0b100;font-weight:600;padding:.375rem .75rem}.btn-amarillo[_ngcontent-%COMP%]:hover{filter:brightness(.95)}.kpi-card[_ngcontent-%COMP%]{border:1.5px solid #256dfc;border-radius:.75rem;padding:.75rem .9rem;background:#edf69a;align-items:center;text-align:center}.kpi-title[_ngcontent-%COMP%]{font-size:.8rem;color:#256dfc}.kpi-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700}"]})};export{ke as CancelacionesPageComponent};
