import{a as R}from"./chunk-LZEE2TKV.js";import{M as Z,N as ee}from"./chunk-NTPU3Q3U.js";import{Ab as m,Bb as x,Cb as h,Dc as D,Ec as u,Gc as B,Hc as G,Hd as Y,Ja as o,Mc as P,Na as y,Nb as k,Pb as T,Qc as q,Tc as z,Ua as I,Ya as b,bd as j,cb as S,cd as O,d as ie,db as l,dd as $,ed as te,fd as U,gc as V,gd as H,hb as t,hc as N,hd as J,ia as g,ib as i,ja as _,jb as s,lc as M,mb as w,md as K,ob as f,oc as L,pb as F,td as Q,ud as W,xd as X}from"./chunk-X7GQVALB.js";var d=ie(te());function re(c,r){if(c&1&&(t(0,"small",31),m(1),k(2,"date"),i()),c&2){let a=F().$implicit;o(),h(" ",T(2,1,a.firmaUpdatedAt,"dd-MM-yyyy")," ")}}function ne(c,r){if(c&1){let a=w();t(0,"tr")(1,"td"),m(2),i(),t(3,"td"),m(4),i(),t(5,"td"),m(6),i(),t(7,"td")(8,"span",26),m(9,"Secreta"),i(),b(10,re,3,4,"small",27),i(),t(11,"td")(12,"button",28),f("click",function(){let n=g(a).$implicit,v=F();return _(v.editar(n))}),s(13,"fa-icon",3),i(),t(14,"button",29),f("click",function(){let n=g(a).$implicit,v=F();return _(v.eliminar(n._id))}),s(15,"fa-icon",3),i(),t(16,"button",30),f("click",function(){let n=g(a).$implicit,v=F();return _(v.abrirCambiarFirma(n))}),s(17,"fa-icon",3),i()()()}if(c&2){let a=r.$implicit;o(2),x(a.nombre),o(2),x(a.direccion),o(2),x(a.telefono),o(4),l("ngIf",a.firmaUpdatedAt),o(3),l("icon","pen"),o(2),l("icon","trash"),o(2),l("icon","pen")}}function oe(c,r){if(c&1){let a=w();t(0,"div",19)(1,"label"),m(2,"Firma actual (requerida para cambiarla):"),i(),t(3,"div",20),s(4,"input",39),t(5,"button",38),f("click",function(){g(a);let n=F(2);return _(n.showFirma=!n.showFirma)}),s(6,"fa-icon",3),i()()()}if(c&2){let a=F(2);o(4),l("type",a.showFirma?"text":"password"),o(),l("matTooltip",a.showFirma?"Ocultar":"Mostrar"),S("aria-pressed",a.showFirma),o(),l("icon",a.showFirma?"eye-slash":"eye")}}function me(c,r){c&1&&(t(0,"div",40),m(1," La nueva firma debe tener al menos 6 caracteres. "),i())}function le(c,r){c&1&&(t(0,"div",40),m(1," La nueva firma no puede ser igual a la actual. "),i())}function ce(c,r){if(c&1){let a=w();t(0,"form",32)(1,"div",19)(2,"label"),m(3,"Nombre:"),i(),s(4,"input",33),i(),t(5,"div",19)(6,"label"),m(7,"Direcci\xF3n:"),i(),s(8,"input",34),i(),t(9,"div",19)(10,"label"),m(11,"Tel\xE9fono:"),i(),s(12,"input",35),i(),b(13,oe,7,4,"div",36),t(14,"div",19)(15,"label"),m(16),i(),t(17,"div",20),s(18,"input",37),t(19,"button",38),f("click",function(){g(a);let n=F();return _(n.showFirmaConfirm=!n.showFirmaConfirm)}),s(20,"fa-icon",3),i()(),b(21,me,2,0,"div",25)(22,le,2,0,"div",25),i()()}if(c&2){let a,e,n=F();l("formGroup",n.formFarmacia),o(13),l("ngIf",n.modoEdicion),o(3),h("Nueva firma ",n.modoEdicion?"(m\xEDn. 6, distinta a la actual)":"(obligatoria, m\xEDn. 6)",""),o(2),l("type",n.showFirmaConfirm?"text":"password"),o(),l("matTooltip",n.showFirmaConfirm?"Ocultar":"Mostrar"),S("aria-pressed",n.showFirmaConfirm),o(),l("icon",n.showFirmaConfirm?"eye-slash":"eye"),o(),l("ngIf",((a=n.formFarmacia.get("nuevaFirma"))==null?null:a.hasError("minlength"))&&((a=n.formFarmacia.get("nuevaFirma"))==null?null:a.touched)),o(),l("ngIf",(n.formFarmacia.errors==null?null:n.formFarmacia.errors.nuevaIgualAActual)&&(((e=n.formFarmacia.get("nuevaFirma"))==null?null:e.touched)||((e=n.formFarmacia.get("firmaActual"))==null?null:e.touched)))}}function se(c,r){c&1&&(t(0,"div",40),m(1," Las firmas no coinciden. "),i())}var ae=class c{constructor(r,a,e){this.fb=r;this.farmaciaService=a;this.library=e;e.addIcons(W,X,Y,Q,K),this.formFarmacia=this.fb.group({nombre:["",u.required],direccion:[""],telefono:[""],firma:["",u.required]})}formFarmacia;farmacias=[];guardando=!1;modoEdicion=!1;farmaciaEditandoId=null;showFirma=!1;showFirmaConfirm=!1;formCambiarFirma;guardandoFirma=!1;showAdminPass=!1;showNueva=!1;showConfirm=!1;farmaciaTarget=null;ngOnInit(){this.cargarFarmacias(),this.formFarmacia=this.fb.group({nombre:["",[u.required,u.minLength(2)]],direccion:[""],telefono:[""],firmaActual:[""],nuevaFirma:[""]},{validators:[this.nuevaDistintaDeActualValidator]}),this.formCambiarFirma=this.fb.group({adminPassword:["",[u.required,u.minLength(4)]],nuevaFirma:["",[u.required,u.minLength(4)]],confirmFirma:["",[u.required]]},{validators:[this.firmasIgualesValidatorCambiar]})}nuevaDistintaDeActualValidator=r=>{let a=(r.get("firmaActual")?.value||"").trim(),e=(r.get("nuevaFirma")?.value||"").trim();return!a||!e?null:a===e?{nuevaIgualAActual:!0}:null};configurarValidadoresFirma(){let r=this.formFarmacia.get("firmaActual"),a=this.formFarmacia.get("nuevaFirma");this.modoEdicion?(a.value||"").trim()?(r.setValidators([u.required]),a.setValidators([u.minLength(6)])):(r.clearValidators(),a.clearValidators()):(r.clearValidators(),a.setValidators([u.required,u.minLength(6)])),r.updateValueAndValidity({emitEvent:!1}),a.updateValueAndValidity({emitEvent:!1})}onNuevaFirmaChange(){this.configurarValidadoresFirma()}editar(r){let a=document.getElementById("modalAgregarFarmacia");if(!a)return;this.modoEdicion=!0,this.farmaciaEditandoId=r._id||null,this.formFarmacia.reset({nombre:r.nombre,direccion:r.direccion,telefono:r.telefono,firmaActual:"",nuevaFirma:""}),this.configurarValidadoresFirma(),new bootstrap.Modal(a,{backdrop:"static",keyboard:!1}).show()}firmasIgualesValidatorCambiar=r=>{let a=(r.get("nuevaFirma")?.value||"").trim(),e=(r.get("confirmFirma")?.value||"").trim();return!a&&!e||a===e?null:{firmaNoCoincide:!0}};abrirCambiarFirma(r){this.farmaciaTarget=r,this.formCambiarFirma.reset();let a=document.getElementById("modalCambiarFirma");a&&new bootstrap.Modal(a,{backdrop:"static",keyboard:!1}).show()}confirmarCambioFirma(){if(this.formCambiarFirma.invalid||!this.farmaciaTarget?._id)return;this.guardandoFirma=!0;let{adminPassword:r,nuevaFirma:a}=this.formCambiarFirma.value;this.farmaciaService.cambiarFirma(this.farmaciaTarget._id,{adminPassword:r,nuevaFirma:(a||"").trim()}).subscribe({next:e=>{d.default.fire("Actualizada","La firma se cambi\xF3 correctamente","success").then(()=>{let n=document.getElementById("modalCambiarFirma");n&&bootstrap.Modal.getInstance(n)?.hide(),this.guardandoFirma=!1,this.cargarFarmacias()})},error:e=>{console.error(e),this.guardandoFirma=!1,d.default.fire("Error",e.error?.mensaje||"No se pudo cambiar la firma","error")}})}firmasIgualesValidator=r=>{let a=(r.get("firma")?.value||"").trim(),e=(r.get("firmaConfirm")?.value||"").trim();return!a&&!e?null:a!==e?{firmaNoCoincide:!0}:null};cargarFarmacias(){this.farmaciaService.obtenerFarmacias().subscribe({next:r=>this.farmacias=r,error:()=>d.default.fire("Error","No se pudieron cargar las farmacias","error")})}abrirModalAgregar(){let r=document.getElementById("modalAgregarFarmacia");if(!r)return;this.modoEdicion=!1,this.farmaciaEditandoId=null,this.formFarmacia.reset({nombre:"",direccion:"",telefono:"",firma:"",firmaConfirm:""}),this.configurarValidadoresFirma(),new bootstrap.Modal(r,{backdrop:"static",keyboard:!1}).show()}guardar(){if(this.guardando)return;if(this.configurarValidadoresFirma(),this.formFarmacia.invalid){this.formFarmacia.markAllAsTouched(),d.default.fire("Datos incompletos","Revisa los campos del formulario.","warning");return}this.guardando=!0;let{nombre:r,direccion:a,telefono:e,firmaActual:n,nuevaFirma:v}=this.formFarmacia.value,C={nombre:(r||"").trim(),direccion:(a||"").trim(),telefono:(e||"").trim()},A=()=>{let p=document.getElementById("modalAgregarFarmacia");p&&bootstrap.Modal.getInstance(p)?.hide(),this.formFarmacia.reset(),this.farmaciaEditandoId=null,this.modoEdicion=!1,this.guardando=!1,this.cargarFarmacias()};if(this.modoEdicion&&this.farmaciaEditandoId){let p=(v||"").trim();if(p){if(p.length<6){this.formFarmacia.get("nuevaFirma")?.markAsTouched(),this.guardando=!1,d.default.fire("Firma inv\xE1lida","La nueva firma debe tener al menos 6 caracteres.","warning");return}if(this.formFarmacia.errors?.nuevaIgualAActual){this.formFarmacia.get("nuevaFirma")?.markAsTouched(),this.formFarmacia.get("firmaActual")?.markAsTouched(),this.guardando=!1,d.default.fire("Firma inv\xE1lida","La nueva firma no puede ser igual a la actual.","warning");return}C.firmaActual=(n||"").trim(),C.nuevaFirma=p}this.farmaciaService.actualizarFarmacia(this.farmaciaEditandoId,C).subscribe({next:()=>d.default.fire({icon:"success",title:"Actualizaci\xF3n",text:"Farmacia actualizada correctamente.",timer:1500,showConfirmButton:!1}).then(A),error:E=>{console.error(E),this.guardando=!1,d.default.fire("Error",E?.error?.mensaje||"No se pudo actualizar","error")}})}else{let p=(v||"").trim();if(!p||p.length<6){this.formFarmacia.get("nuevaFirma")?.markAsTouched(),this.guardando=!1,d.default.fire("Firma requerida","La firma debe tener al menos 6 caracteres.","warning");return}C.firma=p,this.farmaciaService.crearFarmacia(C).subscribe({next:()=>d.default.fire({icon:"success",title:"Creaci\xF3n",text:"Farmacia creada correctamente.",timer:1500,showConfirmButton:!1}).then(A),error:E=>{console.error(E),this.guardando=!1,d.default.fire("Error",E?.error?.mensaje||"No se pudo crear","error")}})}}eliminar(r){d.default.fire({title:"\xBFEst\xE1s seguro?",text:"La farmacia ser\xE1 desactivada",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&this.farmaciaService.eliminarFarmacia(r).subscribe({next:()=>{d.default.fire("Desactivada","La farmacia fue desactivada","success"),this.cargarFarmacias()},error:()=>d.default.fire("Error","No se pudo eliminar la farmacia","error")})})}static \u0275fac=function(a){return new(a||c)(y(j),y(R),y(U))};static \u0275cmp=I({type:c,selectors:[["app-farmacias"]],decls:70,vars:17,consts:[[1,"container","mt-4"],[1,"titulo"],[1,"btn-verde","mb-3",3,"click"],[3,"icon"],[1,"tabla"],[4,"ngFor","ngForOf"],["id","modalAgregarFarmacia","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","p-3",2,"background-color","azure"],[1,"modal-header"],[1,"modal-title","titulo"],["type","button","data-bs-dismiss","modal","aria-label","Cerrar",1,"btn-close"],[1,"modal-body"],[3,"formGroup",4,"ngIf"],[1,"modal-footer","d-flex","justify-content-between"],["data-bs-dismiss","modal",1,"btn-rojo"],[1,"btn-gris",3,"click","disabled"],["id","modalCambiarFirma","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-body",3,"formGroup"],[1,"mb-2"],[1,"input-group"],["formControlName","adminPassword","autocomplete","current-password",1,"form-control",3,"type"],["type","button",1,"btn-gris",3,"click"],["formControlName","nuevaFirma","autocomplete","new-password",1,"form-control",3,"type"],["formControlName","confirmFirma","autocomplete","new-password",1,"form-control",3,"type"],["class","text-danger mt-1",4,"ngIf"],[1,"badge","bg-secondary"],["class","text-muted d-block",4,"ngIf"],["matTooltip","Editar",1,"btn-icon-chico","btn-gris-chico",3,"click"],["matTooltip","Eliminar",1,"btn-icon-chico","btn-rojo-chico",3,"click"],["matTooltip","Cambiar firma",1,"btn-icon-chico","btn-verde-chico",3,"click"],[1,"text-muted","d-block"],[3,"formGroup"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","direccion",1,"form-control"],["type","text","formControlName","telefono",1,"form-control"],["class","mb-2",4,"ngIf"],["formControlName","nuevaFirma","autocomplete","new-password","spellcheck","false","autocapitalize","off",1,"form-control",3,"type"],["type","button",1,"btn-gris",3,"click","matTooltip"],["formControlName","firmaActual","autocomplete","current-password","spellcheck","false","autocapitalize","off",1,"form-control",3,"type"],[1,"text-danger","mt-1"]],template:function(a,e){if(a&1&&(t(0,"div",0)(1,"h2",1),m(2,"Mantenimiento de Farmacias"),i(),t(3,"button",2),f("click",function(){return e.abrirModalAgregar()}),s(4,"fa-icon",3),m(5," Agregar Farmacia "),i(),t(6,"table",4)(7,"thead")(8,"tr")(9,"th"),m(10,"Nombre"),i(),t(11,"th"),m(12,"Direcci\xF3n"),i(),t(13,"th"),m(14,"Tel\xE9fono"),i(),t(15,"th"),m(16,"Firma"),i(),t(17,"th"),m(18,"Acciones"),i()()(),t(19,"tbody"),b(20,ne,18,7,"tr",5),i()(),t(21,"div",6)(22,"div",7)(23,"div",8)(24,"div",9)(25,"h5",10),m(26),i(),s(27,"button",11),i(),t(28,"div",12),b(29,ce,23,9,"form",13),i(),t(30,"div",14)(31,"button",15),m(32,"Cancelar"),i(),t(33,"button",16),f("click",function(){return e.guardar()}),m(34),i()()()()(),t(35,"div",17)(36,"div",7)(37,"div",8)(38,"div",9)(39,"h5",10),m(40),i(),s(41,"button",11),i(),t(42,"div",18)(43,"div",19)(44,"label"),m(45,"Tu contrase\xF1a (admin):"),i(),t(46,"div",20),s(47,"input",21),t(48,"button",22),f("click",function(){return e.showAdminPass=!e.showAdminPass}),s(49,"fa-icon",3),i()()(),t(50,"div",19)(51,"label"),m(52,"Nueva firma:"),i(),t(53,"div",20),s(54,"input",23),t(55,"button",22),f("click",function(){return e.showNueva=!e.showNueva}),s(56,"fa-icon",3),i()()(),t(57,"div",19)(58,"label"),m(59,"Confirmar nueva firma:"),i(),t(60,"div",20),s(61,"input",24),t(62,"button",22),f("click",function(){return e.showConfirm=!e.showConfirm}),s(63,"fa-icon",3),i()(),b(64,se,2,0,"div",25),i()(),t(65,"div",14)(66,"button",15),m(67,"Cancelar"),i(),t(68,"button",16),f("click",function(){return e.confirmarCambioFirma()}),m(69),i()()()()()()),a&2){let n;o(4),l("icon","plus"),o(16),l("ngForOf",e.farmacias),o(6),h(" ",e.modoEdicion?"Editar farmacia":"Agregar nueva farmacia"," "),o(3),l("ngIf",e.formFarmacia),o(4),l("disabled",e.formFarmacia.invalid||e.guardando),o(),h(" ",e.guardando?"Guardando...":e.modoEdicion?"Actualizar":"Guardar"," "),o(6),h("Cambiar firma de ",e.farmaciaTarget==null?null:e.farmaciaTarget.nombre,""),o(2),l("formGroup",e.formCambiarFirma),o(5),l("type",e.showAdminPass?"text":"password"),o(2),l("icon",e.showAdminPass?"eye-slash":"eye"),o(5),l("type",e.showNueva?"text":"password"),o(2),l("icon",e.showNueva?"eye-slash":"eye"),o(5),l("type",e.showConfirm?"text":"password"),o(2),l("icon",e.showConfirm?"eye-slash":"eye"),o(),l("ngIf",(e.formCambiarFirma.errors==null?null:e.formCambiarFirma.errors.firmaNoCoincide)&&(((n=e.formCambiarFirma.get("confirmFirma"))==null?null:n.touched)||((n=e.formCambiarFirma.get("nuevaFirma"))==null?null:n.touched))),o(4),l("disabled",e.formCambiarFirma.invalid||e.guardandoFirma),o(),h(" ",e.guardandoFirma?"Guardando...":"Actualizar firma"," ")}},dependencies:[L,V,N,M,J,H,$,P,D,B,G,q,z,O,ee,Z],encapsulation:2})};export{ae as FarmaciasComponent};
