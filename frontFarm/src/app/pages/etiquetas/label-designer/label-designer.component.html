<div class="designer">
  <div class="sidebar">
    <h3 class="titulo text-center">Diseño</h3>
    <label style="margin-right: 1rem;">Nombre</label>
    <input [(ngModel)]="design.nombre" />

    <h4 class="subtitulo text-center mt-1">Tamaño etiqueta (mm)</h4>
    <div class="grid">
      <label>Ancho</label><input type="number" [(ngModel)]="design.widthMm">
      <label>Alto</label><input type="number" [(ngModel)]="design.heightMm">
      <label>Margen</label><input type="number" [(ngModel)]="design.marginMm">
    </div>

    <h4 class="subtitulo text-center mt-1">Hoja (mm)</h4>
    <div class="grid">
      <label>Ancho pág.</label><input type="number" [(ngModel)]="design.pageWidthMm">
      <label>Alto pág.</label><input type="number" [(ngModel)]="design.pageHeightMm">
      <label>Cols</label><input type="number" [(ngModel)]="design.cols">
      <label>Rens</label><input type="number" [(ngModel)]="design.rows">
      <label>Gap X</label><input type="number" [(ngModel)]="design.gapXmm">
      <label>Gap Y</label><input type="number" [(ngModel)]="design.gapYmm">
    </div>

    <div>
      <h4 class="subtitulo text-center mt-1">Agregar elemento</h4>
      <div class="row mb-1">
        <div class="col-4">
          <button class="btn-rojo-chico" (click)="addText('nombre')">Nombre</button>
        </div>
        <div class="col-4" style="text-align: center;">
          <button class="btn-rojo-chico" (click)="addText('renglon1')">Renglón 1</button>
        </div>
        <div class="col-4" style="text-align: end;">
          <button class="btn-rojo-chico" (click)="addText('renglon2')">Renglón 2</button>
        </div>
      </div>
      <div class="row">
        <div class="col-5">
          <button class="btn-rojo-chico" (click)="addPrice()">Precio</button>
        </div>
        <div class="col-7" style="text-align: end;">
          <button class="btn-rojo-chico" (click)="addBarcode()">Código de barras</button>
        </div>
      </div>
    </div>

    <div *ngIf="selected">
      <h4 class="subtitulo text-center mt-1">Propiedades</h4>
      <div style="text-align: center;">Tipo: <span><strong>{{selected.type}}</strong></span></div>
      <div *ngIf="selected.type!=='barcode'">
        <div>
          <label style="margin-right: 1rem;">Fuente (pt)</label><input type="number" [(ngModel)]="selected.fontSize"
            style="width: 4rem;">
        </div>
        <div class="row">
          <div class="col-5">
            <label><input type="checkbox" [(ngModel)]="selected.bold"> Negritas</label>
          </div>
          <div class="col-7" style="text-align: end;">
            <label style="margin-right: 0.5rem;">Alineación</label>
            <select [(ngModel)]="selected.align">
              <option>left</option>
              <option>center</option>
              <option>right</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <label style="margin-right: 0.5rem;">Prefix</label><input [(ngModel)]="selected.prefix">
          </div>
          <div class="col-6">
            <label style="margin-right: 0.5rem; text-align: end;">Suffix</label><input [(ngModel)]="selected.suffix">
          </div>
          <label><input type="checkbox" [(ngModel)]="selected.uppercase"> MAYÚSCULAS</label>
        </div>
      </div>

      <div *ngIf="selected.type==='barcode'">
        <label>Símbolo</label>
        <select [(ngModel)]="selected.barcode!.symbology">
          <option>CODE128</option>
          <option>EAN13</option>
          <option>EAN8</option>
          <option>QR</option>
        </select>
        <label>Width(px)</label><input type="number" [(ngModel)]="selected.barcode!.width">
        <label>Height(px)</label><input type="number" [(ngModel)]="selected.barcode!.height">
        <label><input type="checkbox" [(ngModel)]="selected.barcode!.displayValue"> Mostrar texto</label>
      </div>

      <button (click)="deleteSelected()">Eliminar elemento</button>
    </div>

    <div class="acciones">
      <button (click)="save()">Guardar diseño</button>
      <button (click)="nuevo()">Nuevo</button>
    </div>
  </div>

  <!-- Área de etiqueta (preview) -->
  <div class="canvas-wrap">
    <div class="label-canvas" [style.width]="design.widthMm + 'mm'" [style.height]="design.heightMm + 'mm'"
      (click)="selected=null">

      <div class="label-inner" [style.padding]="(design.marginMm || 0) + 'mm'">
        <div *ngFor="let el of design.elements; let idx = index" class="el" [class.selected]="el===selected"
          [style.left.%]="el.x" [style.top.%]="el.y" [style.width.%]="el.w" [style.height.%]="el.h"
          (click)="$event.stopPropagation(); selected=el" cdkDrag (cdkDragEnded)="onDragEnd($event, el)">

          <ng-container [ngSwitch]="el.type">
            <div *ngSwitchCase="'text'" [ngStyle]="textStyle(el)">
              {{ sampleValue(el) }}
            </div>

            <div *ngSwitchCase="'price'" [ngStyle]="textStyle(el)">
              {{ formatPrice(123.45, el) }}
            </div>

            <div *ngSwitchCase="'barcode'">
              <svg #barcodeSvg></svg>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="design-list">
      <h4>Mis diseños guardados</h4>
      <ul>
        <li *ngFor="let d of disenos" (click)="load(d)" [class.active]="d._id===design._id">
          {{ d.nombre }}
          <button class="mini" (click)="remove(d, $event)">Borrar</button>
        </li>
      </ul>
    </div>
  </div>
</div>