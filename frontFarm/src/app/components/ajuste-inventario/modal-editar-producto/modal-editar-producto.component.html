<div class="modal-overlay">
    <div class="modal-content">

        <h3 class="titulo">Almacen editar producto</h3>

        <form [formGroup]="formulario">
            <div class="edit-seccion">
                <label>Nombre:</label>
                <input type="text" formControlName="nombre" style="width: 60%;">
            </div>
            <div class="edit-seccion">
                <label>Ingredientes activos:</label>
                <input type="text" formControlName="ingreActivo" style="width: 60%;">
            </div>

            <div class="edit-seccion">
                <label>Renglón 1:</label>
                <input type="text" formControlName="renglon1" style="width: 36%;">

                <label>Renglón 2:</label>
                <input type="text" formControlName="renglon2" style="width: 36%;">
            </div>
            <div class="edit-seccion">
                <label>Último proveedor:</label>
                <select formControlName="ultimoProveedorId" style="width: 18rem;">
                    <option [ngValue]="null">— Sin proveedor —</option>
                    <option *ngFor="let pr of proveedores" [ngValue]="pr._id">
                    {{ pr.nombre }}
                    </option>
                </select>
            </div>

            <div class="edit-seccion">
                <label>Cod. Barras:</label>
                <input type="text" formControlName="codigoBarras" style="width: 10rem;">

                <label>Categoría:</label>
                <input type="text" formControlName="categoria" style="width: 12rem;">

                <label>Unidad:</label>
                <input type="text" formControlName="unidad" style="width: 5rem;">

                <label >Costo:</label>
                <input type="number" formControlName="costo"step="0.1" style="width: 5rem;">
            </div>
            <div class="edit-seccion"> 
                <label >Ubicación:</label>
                <input type="text" formControlName="ubicacion" style="width: 11rem;">
                <label>Stock Minimo:</label>
                <input type="number" formControlName="stockMinimo" style="width: 4rem;">
                <label>Stock Maximo:</label>
                <input type="number" formControlName="stockMaximo" style="width: 4rem;">
                <label>IVA:</label>
                <input type="checkbox" formControlName="iva">
                <label>Genérico:</label>
                <input type="checkbox" formControlName="generico">
            </div>

            <div>
                <!-- <label style="margin-right: 10px;">INAPAM:</label>
                <input type="checkbox" formControlName="descuentoINAPAM"> -->
                <!-- <label style="margin-left: 2rem; margin-right: 10px;">Costo:</label>
                <input type="number" formControlName="costo" style="width: 5rem;" step="0.1"> -->
                <!-- <label style="margin-left: 2rem; margin-right: 10px;">Precio:</label>
                <input type="number" formControlName="precio" style="width: 5rem;"> 
                    <small *ngIf="utilPct !== null; else sinDato" [style.color]="utilColor" style="text-align: left;">
                        Util. {{ utilPct | number:'1.0-2' }}%
                    </small>
                    <ng-template #sinDato>—</ng-template>
                    <small *ngIf="utilAbs !== null" [style.color]="utilColor">
                        ({{ utilAbs | currency }})
                    </small> -->

                   <!--  <label style="margin-left: 2rem; margin-right: 10px;">Ubicación:</label>
                    <input type="text" formControlName="ubicacion" style="width: 11rem;"> -->
            </div>
            <!-- Lotes -->
            <div formArrayName="lotes">
                <div style="text-align: center;">
                    <label class="subtitulo-edit"><strong>Lotes:</strong></label>
                </div>
                <div *ngFor="let lote of lotesFormArray.controls; let i = index" [formGroupName]="i"
                    class="edit-seccion">
                    <label>Lote:</label>
                    <input type="text" formControlName="lote" style="width: 7rem;">

                    <label>Caducidad:</label>
                    <input
                        type="text"
                        formControlName="fechaCaducidad"
                        inputmode="numeric"
                        maxlength="4"
                        placeholder="MMAA"
                        (input)="onCaducidadInput(i)"
                        style="width: 4rem;"
                    >
                    <small class="text-muted" *ngIf="getCaducidadPreview(i) as prev">
                        <strong style="color:rebeccapurple">{{ prev }}</strong>
                    </small>

                    <label style="margin-left: 3rem;">Cantidad:</label>
                    <input type="number" formControlName="cantidad" style="width: 5rem;">

                    <button class="btn-rojo-chico" type="button" (click)="eliminarLote(i)">Eliminar</button>

                    <div class="text-danger" style="font-size: 12px; margin-left: 10rem;"
                        *ngIf="lotesFormArray.at(i).get('fechaCaducidad')?.touched &&
                                lotesFormArray.at(i).get('fechaCaducidad')?.invalid">
                        <span *ngIf="lotesFormArray.at(i).get('fechaCaducidad')?.hasError('mmaaFormato')">
                            Captura 4 dígitos en formato MMAA (ej. 0228).
                        </span>
                        <span *ngIf="lotesFormArray.at(i).get('fechaCaducidad')?.hasError('mmaaMes')">
                            Mes inválido (01 a 12).
                        </span>
                        <span *ngIf="lotesFormArray.at(i).get('fechaCaducidad')?.hasError('mmaaPasada')">
                            No se permite una caducidad menor a hoy.
                        </span>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button type="button" (click)="agregarLote()" class="btn-gris-chico">Agregar Lote</button>
                </div>
            </div>

            <!-- Promociones -->
            <!-- <label class="subtitulo-edit">Promociones:</label>
            <div class="edit-seccion">
                <label class="subtitulo-edit">Cantidad Requerida:</label>
                <label style="margin-left: 1rem;">Tipo:</label>
                <select formControlName="promoCantidadRequerida" style="margin-right: 2rem;">
                    <option [ngValue]="null">--</option>
                    <option [ngValue]="2">2x1</option>
                    <option [ngValue]="3">3x2</option>
                    <option [ngValue]="4">4x3</option>
                </select>

                <label>Inicio:</label>
                <input type="date" formControlName="inicioPromoCantidad">

                <label>Fin:</label>
                <input type="date" formControlName="finPromoCantidad">
            </div>

            <div formGroupName="promoDeTemporada" class="edit-seccion">
                <label class="subtitulo-edit">Temporada:</label>

                <label style="margin-left: 1.5rem;">% desc.:</label>
                <input type="number" formControlName="porcentaje" style="width:60px">

                <label>Inicio:</label>
                <input type="date" formControlName="inicio">

                <label>Fin:</label>
                <input type="date" formControlName="fin">

                <label>Monedero:</label>
                <input type="checkbox" formControlName="monedero">

            </div>

            <div formGroupName="promosPorDia">
                <div *ngFor="let dia of ['Lunes','Martes','Miercoles','Jueves','Viernes','Sabado','Domingo']">
                    <div [formGroupName]="'promo' + dia" class="row promo-dia">
                        <div class="col-2"><label class="subtitulo-edit">{{ dia }}</label></div>

                        <div class="col-2"><label>% desc.:</label>
                            <input type="number" formControlName="porcentaje" style="width:60px">
                        </div>
                        <div class="col-3"><label>Inicio:</label>
                            <input type="date" formControlName="inicio">
                        </div>
                        <div class="col-3"><label>Fin:</label>
                            <input type="date" formControlName="fin">
                        </div>
                        <div class="col-2"><label>Monedero:</label>
                            <input type="checkbox" formControlName="monedero">
                        </div>
                    </div>
                </div>
            </div> -->
            
        </form>
        <hr>
        <div class="modal-buttons">
            <button class="btn-rojo-chico" (click)="cerrarModal()">Cancelar</button>
            <button class="btn-verde-chico btn-right" (click)="guardarProducto()"
                [disabled]="!formOkSinLotes()">Guardar</button>
        </div>

    </div>
</div>