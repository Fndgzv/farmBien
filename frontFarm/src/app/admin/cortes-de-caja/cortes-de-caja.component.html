<div class="cortes-caja-container">
    <div class="titulo-container">
        <h1 class="titulo">Cortes de Caja</h1>
    </div>

    <form [formGroup]="filtroForm" class="row mb-2 filter-container">
        <div class="col-md-3">
            <div class="d-flex align-items-center position-relative w-100">
                <label class="me-2 mb-0" style="white-space: nowrap;">Desde:</label>

                <input type="date" formControlName="fechaInicioDesde" class="form-control pe-5 flex-grow-1" />

                <button *ngIf="filtroForm.get('fechaInicioDesde')?.value" type="button" matTooltip="Limpiar fecha desde"
                    class="btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico"
                    style="z-index: 2; margin-right: 6px;" (click)="filtroForm.get('fechaInicioDesde')?.setValue('')">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
        </div>

        <div class="col-md-3">
            <div class="d-flex align-items-center position-relative w-100">
                <label class="me-2 mb-0" style="white-space: nowrap;">Hasta:</label>

                <input type="date" formControlName="fechaInicioHasta" class="form-control pe-5 flex-grow-1" />

                <button *ngIf="filtroForm.get('fechaInicioHasta')?.value" type="button" matTooltip="Limpiar fecha hasta"
                    class="btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico"
                    style="z-index: 2; margin-right: 6px;" (click)="filtroForm.get('fechaInicioHasta')?.setValue('')">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
        </div>

        <div class="col-md-4">
            <div class="d-flex align-items-center position-relative w-100">
                <label class="me-2 mb-0" style="white-space: nowrap;">Usuario:</label>

                <input type="text" formControlName="nombreUsuario" class="form-control pe-4 flex-grow-1" />

                <button *ngIf="filtroForm.get('nombreUsuario')?.value" type="button" matTooltip="Limpiar usuario"
                    class="btn-icon-chico btn-sm btn-light position-absolute top-50 end-0 translate-middle-y btn-rojo-chico"
                    (click)="filtroForm.get('nombreUsuario')?.setValue('')">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
        </div>

        <div class="col-md-2">
            <button (click)="buscarCortes()" class="btn-gris">Buscar</button>
        </div>
    </form>

    <div class="mt-3 d-flex justify-content-center" *ngIf="cortes && cortes.length > 0; else sinResultados">
        <table class="tabla mx-auto">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Efec. inicial</th>
                    <th>Efectivo</th>
                    <th>Tarjeta</th>
                    <th>Transferencia</th>
                    <th>Monedero</th>
                    <th>Abonos Monedero</th>
                    <th>Fecha Inicio</th>
                    <th>Fecha Fin</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let corte of cortes">
                    <td>{{ ($any(corte.usuario)?.nombre) || 'N/A' }}</td>
                    <td>{{ corte.efectivoInicial | currency }}</td>
                    <td>{{ corte.totalEfectivoEnCaja | currency }}</td>
                    <td>{{ corte.totalTarjeta | currency }}</td>
                    <td>{{ corte.totalTransferencia | currency }}</td>
                    <td>{{ corte.totalVale | currency }}</td>
                    <td>{{ corte.abonosMonederos | currency }}</td>
                    <td>{{ corte.fechaInicio | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>{{ corte.fechaFin ? (corte.fechaFin | date:'dd/MM/yyyy HH:mm') : 'abierto' }}</td>
                    <td>
                        <button class="btn-icon-chico btn-verde-chico" (click)="mostrarDetalle(corte)"
                            matTooltip="Vista del corte">
                            <fa-icon [icon]="'eye'"></fa-icon>
                        </button>
                        <button class="btn-icon-chico btn-rojo-chico" (click)="eliminarCorte(corte)"
                            [disabled]="cargando || !esEliminable(corte)"
                            [matTooltip]="!esEliminable(corte) ? 'No puedes eliminar un corte activo' : 'Eliminar corte'">
                            <fa-icon [icon]="'trash'"></fa-icon>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <ng-template #sinResultados>
        <p style="color: brown;">No hay cortes de caja para mostrar.</p>
    </ng-template>
</div>